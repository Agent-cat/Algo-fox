{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/vishnu/Documents/projects/Algo-fox/components/classroom/ClassroomSidebar.tsx"],"sourcesContent":["\"use client\";\n\nimport { Trophy, Activity, Download, LayoutDashboard, ChevronRight } from \"lucide-react\";\nimport { motion, AnimatePresence } from \"framer-motion\";\n\ninterface SidebarProps {\n    activeTab: 'leaderboard' | 'tracking' | 'assignments' | 'contests';\n    onTabChange: (tab: 'leaderboard' | 'tracking' | 'assignments' | 'contests') => void;\n    onDownload: () => void;\n    showDownload: boolean;\n    isTeacher: boolean;\n    classroomName: string;\n}\n\nexport function ClassroomSidebar({ activeTab, onTabChange, onDownload, showDownload, isTeacher, classroomName }: SidebarProps) {\n    const menuItems = [\n        { id: 'leaderboard', label: 'Leaderboard', icon: Trophy },\n        { id: 'assignments', label: 'Assignments', icon: LayoutDashboard }, // Using LayoutDashboard temporarily\n        ...(isTeacher ? [\n            { id: 'contests', label: 'Contest Verification', icon: Activity },\n            { id: 'tracking', label: 'Live Tracking', icon: Activity }\n        ] : [])\n    ];\n\n    return (\n        <aside className=\"w-72 h-screen fixed left-0 top-0 pt-24 pb-8 z-40 bg-white/80 dark:bg-[#141414]/90 backdrop-blur-xl border-r border-gray-200/50 dark:border-[#262626] shadow-[4px_0_24px_-12px_rgba(0,0,0,0.1)]\">\n            <div className=\"px-6 mb-6\">\n                <p className=\"text-xs font-semibold text-gray-400 dark:text-gray-500 uppercase tracking-wider mb-2\">\n                    Classroom\n                </p>\n                <h3 className=\"text-sm font-bold text-gray-900 dark:text-white truncate\" title={classroomName}>\n                    {classroomName}\n                </h3>\n            </div>\n\n            <nav className=\"px-4 space-y-1\">\n                {menuItems.map((item) => {\n                    const isActive = activeTab === item.id;\n                    const Icon = item.icon;\n\n                    return (\n                        <button\n                            key={item.id}\n                            onClick={() => onTabChange(item.id as any)}\n                            className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium mb-1 group transition-all ${\n                                isActive\n                                    ? \"bg-orange-600 text-white shadow-lg shadow-orange-200 dark:shadow-none\"\n                                    : \"text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-[#1a1a1a] hover:text-gray-900 dark:hover:text-gray-200\"\n                            }`}\n                        >\n                            <div\n                                className={`p-1.5 rounded-lg transition-colors ${\n                                    isActive\n                                        ? \"bg-white/20 text-white\"\n                                        : \"bg-gray-100 dark:bg-[#1a1a1a] text-gray-500 dark:text-gray-400 group-hover:bg-white dark:group-hover:bg-[#262626] group-hover:shadow-sm\"\n                                }`}\n                            >\n                                <Icon className=\"w-4 h-4\" />\n                            </div>\n                            <span>{item.label}</span>\n                            {isActive && <ChevronRight className=\"w-4 h-4 ml-auto text-white/50\" />}\n                        </button>\n                    );\n                })}\n            </nav>\n\n            <div className=\"absolute bottom-8 left-0 right-0 px-4 space-y-2\">\n                {showDownload && (\n                     <button\n                        onClick={onDownload}\n                        className=\"w-full flex items-center justify-center gap-2 px-4 py-3 bg-gray-50 dark:bg-[#1a1a1a] border border-gray-200 dark:border-[#262626] rounded-xl text-xs font-bold uppercase tracking-wider text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-[#262626] hover:text-orange-600 dark:hover:text-orange-500 transition-colors\"\n                    >\n                        <Download className=\"w-4 h-4\" />\n                        Export Data\n                    </button>\n                )}\n            </div>\n\n            {/* Decorative bg element */}\n            <div className=\"absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-white dark:from-[#141414] to-transparent pointer-events-none -z-10\" />\n        </aside>\n    );\n}\n"],"names":[],"mappings":";;;;;AAEA;AAAA;AAAA;AAAA;AAAA;AAFA;;;AAcO,SAAS,iBAAiB,EAAE,SAAS,EAAE,WAAW,EAAE,UAAU,EAAE,YAAY,EAAE,SAAS,EAAE,aAAa,EAAgB;IACzH,MAAM,YAAY;QACd;YAAE,IAAI;YAAe,OAAO;YAAe,MAAM,gNAAM;QAAC;QACxD;YAAE,IAAI;YAAe,OAAO;YAAe,MAAM,+OAAe;QAAC;WAC7D,YAAY;YACZ;gBAAE,IAAI;gBAAY,OAAO;gBAAwB,MAAM,sNAAQ;YAAC;YAChE;gBAAE,IAAI;gBAAY,OAAO;gBAAiB,MAAM,sNAAQ;YAAC;SAC5D,GAAG,EAAE;KACT;IAED,qBACI,8OAAC;QAAM,WAAU;;0BACb,8OAAC;gBAAI,WAAU;;kCACX,8OAAC;wBAAE,WAAU;kCAAuF;;;;;;kCAGpG,8OAAC;wBAAG,WAAU;wBAA2D,OAAO;kCAC3E;;;;;;;;;;;;0BAIT,8OAAC;gBAAI,WAAU;0BACV,UAAU,GAAG,CAAC,CAAC;oBACZ,MAAM,WAAW,cAAc,KAAK,EAAE;oBACtC,MAAM,OAAO,KAAK,IAAI;oBAEtB,qBACI,8OAAC;wBAEG,SAAS,IAAM,YAAY,KAAK,EAAE;wBAClC,WAAW,CAAC,kGAAkG,EAC1G,WACM,0EACA,0HACR;;0CAEF,8OAAC;gCACG,WAAW,CAAC,mCAAmC,EAC3C,WACM,2BACA,2IACR;0CAEF,cAAA,8OAAC;oCAAK,WAAU;;;;;;;;;;;0CAEpB,8OAAC;0CAAM,KAAK,KAAK;;;;;;4BAChB,0BAAY,8OAAC,sOAAY;gCAAC,WAAU;;;;;;;uBAlBhC,KAAK,EAAE;;;;;gBAqBxB;;;;;;0BAGJ,8OAAC;gBAAI,WAAU;0BACV,8BACI,8OAAC;oBACE,SAAS;oBACT,WAAU;;sCAEV,8OAAC,sNAAQ;4BAAC,WAAU;;;;;;wBAAY;;;;;;;;;;;;0BAO5C,8OAAC;gBAAI,WAAU;;;;;;;;;;;;AAG3B"}},
    {"offset": {"line": 163, "column": 0}, "map": {"version":3,"sources":["file:///home/vishnu/Documents/projects/Algo-fox/actions/classroom.ts"],"sourcesContent":["\"use server\";\n\nimport { prisma } from \"@/lib/prisma\";\nimport redis from \"@/lib/redis\";\nimport { auth } from \"@/lib/auth\";\nimport { headers } from \"next/headers\";\nimport { z } from \"zod\";\nimport { revalidatePath, revalidateTag, unstable_cache } from \"next/cache\";\nimport { cacheKey, cachedFetch, CACHE_CONFIG, deleteFromCache } from \"@/lib/cache-utils\";\n\nconst classroomSchema = z.object({\n    name: z.string().min(2, \"Name must be at least 2 characters\"),\n    section: z.string().optional().or(z.literal(\"\")),\n    subject: z.string().optional().or(z.literal(\"\")),\n    institutionId: z.string(),\n});\n\nfunction generateJoinCode() {\n    const chars = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\";\n    let code = \"\";\n    for (let i = 0; i < 6; i++) {\n        code += chars.charAt(Math.floor(Math.random() * chars.length));\n    }\n    return code;\n}\n\n/**\n * Creates a new classroom.\n * Only ADMIN, INSTITUTION_MANAGER, or TEACHER roles can create classrooms.\n */\nexport async function createClassroom(data: z.infer<typeof classroomSchema>) {\n    const session = await auth.api.getSession({\n        headers: await headers(),\n    });\n\n    if (!session?.user) {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    const currentUser = session.user as any;\n\n    // Security check\n    if (![\"ADMIN\", \"INSTITUTION_MANAGER\", \"TEACHER\"].includes(currentUser.role)) {\n        return { success: false, error: \"Unauthorized. Only teachers or managers can create classrooms.\" };\n    }\n\n    try {\n        const validatedData = classroomSchema.parse(data);\n\n        // Generate unique 6-character join code\n        let joinCode = \"\";\n        let isUnique = false;\n        let attempts = 0;\n        while (!isUnique && attempts < 10) {\n            joinCode = generateJoinCode();\n            const existing = await prisma.classroom.findUnique({\n                where: { joinCode },\n            });\n            if (!existing) isUnique = true;\n            attempts++;\n        }\n\n        if (!isUnique) {\n            return { success: false, error: \"Failed to generate a unique join code. Please try again.\" };\n        }\n\n        const classroom = await prisma.classroom.create({\n            data: {\n                name: validatedData.name,\n                section: validatedData.section || null,\n                subject: validatedData.subject || null,\n                joinCode,\n                institutionId: validatedData.institutionId,\n                teacherId: currentUser.id,\n            },\n        });\n\n        // Invalidate relevant caches\n        revalidateTag(`teacher-classrooms-${currentUser.id}`, \"max\");\n        revalidateTag(`institution-classrooms-${validatedData.institutionId}`, \"max\");\n        revalidatePath(\"/dashboard/institution/classrooms\");\n\n        return { success: true, data: classroom };\n    } catch (error) {\n        if (error instanceof z.ZodError) {\n            return { success: false, error: error.issues[0].message };\n        }\n        console.error(\"Failed to create classroom:\", error);\n        return { success: false, error: \"Failed to create classroom\" };\n    }\n}\n\n/**\n * Allows a student to join a classroom using a 6-character code.\n * Also onboards the student to the institution if they are not already associated.\n */\nexport async function joinClassroom(code: string) {\n    const session = await auth.api.getSession({\n        headers: await headers(),\n    });\n\n    if (!session?.user) {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    const currentUser = session.user as any;\n\n    try {\n\n        const classroom = await prisma.classroom.findUnique({\n            where: { joinCode: code.toUpperCase() },\n            include: {\n                students: {\n                    where: { id: currentUser.id },\n                },\n            },\n        });\n\n        if (!classroom) {\n            return { success: false, error: \"Invalid join code.\" };\n        }\n\n        if (classroom.students.length > 0) {\n            return { success: false, error: \"You are already enrolled in this classroom.\" };\n        }\n\n\n        // Institution Check:\n        // 1. If user belongs to an institution, they can only join classrooms from THAT institution.\n        // 2. If user has NO institution, they are assigned to this classroom's institution.\n\n        if (currentUser.institutionId && currentUser.institutionId !== classroom.institutionId) {\n             return {\n                success: false,\n                error: \"You cannot join this classroom because it belongs to a different institution.\"\n             };\n        }\n\n        // Add student to classroom\n        await prisma.classroom.update({\n            where: { id: classroom.id },\n            data: {\n                students: {\n                    connect: { id: currentUser.id },\n                },\n            },\n        });\n\n        // Onboard student to institution if null\n        const updateData: any = {\n            onboardingCompleted: true,\n        };\n\n        if (!currentUser.institutionId) {\n            updateData.institutionId = classroom.institutionId;\n        }\n\n        await prisma.user.update({\n            where: { id: currentUser.id },\n            data: updateData,\n        });\n\n        // Redis Integration: Cache student IDs per classroom\n        const redisKey = `classroom:students:${classroom.id}`;\n        await redis.sadd(redisKey, currentUser.id);\n\n        // Invalidate caches\n        revalidateTag(`student-classrooms-${currentUser.id}`, \"max\");\n        revalidateTag(`classroom-${classroom.id}`, \"max\");\n        revalidatePath(\"/dashboard/classrooms\");\n\n        return { success: true, message: `Successfully joined ${classroom.name}` };\n    } catch (error) {\n        console.error(\"Failed to join classroom:\", error);\n        return { success: false, error: \"Failed to join classroom\" };\n    }\n}\n\n/**\n * Fetches basic details of a classroom by its join code.\n * Used for the join classroom page.\n */\nexport async function getClassroomByCode(code: string) {\n    try {\n        const classroom = await prisma.classroom.findUnique({\n            where: { joinCode: code.toUpperCase() },\n            select: {\n                id: true,\n                name: true,\n                subject: true,\n                section: true,\n                teacher: {\n                    select: {\n                        id: true,\n                        name: true,\n                        image: true,\n                    }\n                },\n                _count: {\n                    select: { students: true }\n                }\n            }\n        });\n\n        if (!classroom) {\n            return { success: false, error: \"Classroom not found\" };\n        }\n\n        const session = await auth.api.getSession({\n            headers: await headers(),\n        });\n\n        const isEnrolled = session?.user ? await prisma.classroom.findFirst({\n            where: {\n                id: classroom.id,\n                students: { some: { id: session.user.id } }\n            }\n        }) : false;\n\n        return {\n            success: true,\n            classroom,\n            isEnrolled: !!isEnrolled\n        };\n    } catch (error) {\n        console.error(\"Failed to fetch classroom by code:\", error);\n        return { success: false, error: \"Failed to fetch classroom\" };\n    }\n}\n\n/**\n * Fetches classrooms created by the currently logged-in teacher (CACHED).\n */\nexport async function getTeacherClassrooms() {\n    const session = await auth.api.getSession({\n        headers: await headers(),\n    });\n\n    if (!session?.user) {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    const userId = session.user.id;\n\n    const fetchClassrooms = unstable_cache(\n        async () => {\n            return await prisma.classroom.findMany({\n                where: { teacherId: userId },\n                include: {\n                    _count: {\n                        select: { students: true },\n                    },\n                },\n                orderBy: { createdAt: \"desc\" },\n            });\n        },\n        [`teacher-classrooms-${userId}`],\n        { tags: [`teacher-classrooms-${userId}`], revalidate: 120 }\n    );\n\n    try {\n        const classrooms = await fetchClassrooms();\n        return { success: true, classrooms };\n    } catch (error) {\n        console.error(\"Failed to fetch teacher classrooms:\", error);\n        return { success: false, error: \"Failed to fetch classrooms\" };\n    }\n}\n\n/**\n * Fetches classrooms where the currently logged-in student is enrolled (CACHED).\n */\nexport async function getStudentClassrooms() {\n    const session = await auth.api.getSession({\n        headers: await headers(),\n    });\n\n    if (!session?.user) {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    const userId = session.user.id;\n\n    const fetchClassrooms = unstable_cache(\n        async () => {\n            const user = await prisma.user.findUnique({\n                where: { id: userId },\n                include: {\n                    enrolledClassrooms: {\n                        include: {\n                            teacher: {\n                                select: { name: true },\n                            },\n                        },\n                        orderBy: { createdAt: \"desc\" },\n                    },\n                },\n            });\n            return user?.enrolledClassrooms || [];\n        },\n        [`student-classrooms-${userId}`],\n        { tags: [`student-classrooms-${userId}`], revalidate: 120 }\n    );\n\n    try {\n        const classrooms = await fetchClassrooms();\n        return { success: true, classrooms };\n    } catch (error) {\n        console.error(\"Failed to fetch student classrooms:\", error);\n        return { success: false, error: \"Failed to fetch classrooms\" };\n    }\n}\n\n/**\n * Fetches details of a specific classroom, including the student list for the leaderboard (CACHED).\n * Supports pagination for large student lists.\n */\nexport async function getClassroomWithStudents(\n    id: string,\n    page: number = 1,\n    limit: number = 50\n) {\n    const session = await auth.api.getSession({\n        headers: await headers(),\n    });\n\n    if (!session?.user) {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    const skip = (page - 1) * limit;\n\n    const fetchClassroom = unstable_cache(\n        async () => {\n            const [classroom, totalStudents] = await Promise.all([\n                prisma.classroom.findUnique({\n                    where: { id },\n                    select: {\n                        id: true,\n                        name: true,\n                        subject: true,\n                        section: true,\n                        joinCode: true,\n                        isTrackingActive: true,\n                        trackingStartedAt: true,\n                        teacher: {\n                            select: { name: true, id: true },\n                        },\n                        students: {\n                            select: {\n                                id: true,\n                                name: true,\n                                totalScore: true,\n                                image: true,\n                            },\n                            orderBy: { totalScore: \"desc\" },\n                            skip,\n                            take: limit,\n                        },\n                    },\n                }),\n                prisma.user.count({\n                    where: {\n                        enrolledClassrooms: {\n                            some: { id }\n                        }\n                    }\n                })\n            ]);\n\n            return { classroom, totalStudents };\n        },\n        [`classroom-${id}-page-${page}`],\n        { tags: [`classroom-${id}`], revalidate: 60 }\n    );\n\n    try {\n        const { classroom, totalStudents } = await fetchClassroom();\n\n        if (!classroom) {\n            return { success: false, error: \"Classroom not found\" };\n        }\n\n        return {\n            success: true,\n            classroom,\n            pagination: {\n                total: totalStudents,\n                pages: Math.ceil(totalStudents / limit),\n                current: page,\n                limit\n            }\n        };\n    } catch (error) {\n        console.error(\"Failed to fetch classroom detail:\", error);\n        return { success: false, error: \"Failed to fetch classroom\" };\n    }\n}\n\nexport async function toggleClassroomTracking(classroomId: string, active: boolean) {\n    const session = await auth.api.getSession({\n        headers: await headers(),\n    });\n\n    if (!session?.user) return { success: false, error: \"Unauthorized\" };\n\n    const classroom = await prisma.classroom.findUnique({\n        where: { id: classroomId },\n        select: { teacherId: true }\n    });\n\n    if (!classroom || (classroom.teacherId !== session.user.id && (session.user as any).role !== \"ADMIN\")) {\n        return { success: false, error: \"Access denied\" };\n    }\n\n    await prisma.classroom.update({\n        where: { id: classroomId },\n        data: {\n            isTrackingActive: active,\n            trackingStartedAt: active ? new Date() : null\n        }\n    });\n\n    await deleteFromCache(cacheKey(\"live-tracking\", classroomId));\n    revalidateTag(`classroom-${classroomId}`, \"max\");\n    revalidatePath(`/dashboard/classrooms/${classroomId}`);\n    return { success: true };\n}\n\nexport async function getClassroomLiveTracking(classroomId: string) {\n    const session = await auth.api.getSession({\n        headers: await headers(),\n    });\n\n    if (!session?.user) return { success: false, error: \"Unauthorized\" };\n\n    // Use Redis cache for live tracking data (short TTL)\n    const cacheKeyName = cacheKey(\"live-tracking\", classroomId);\n\n    const fetchTracking = async () => {\n        const classroom = await prisma.classroom.findUnique({\n            where: { id: classroomId },\n            select: {\n                isTrackingActive: true,\n                trackingStartedAt: true,\n                students: {\n                    select: {\n                        id: true,\n                        name: true,\n                        image: true,\n                        submissions: {\n                            where: {\n                                mode: \"SUBMIT\",\n                            },\n                            orderBy: { createdAt: 'desc' },\n                            take: 20,\n                            include: {\n                                problem: { select: { title: true } }\n                            }\n                        }\n                    }\n                }\n            }\n        });\n\n        if (!classroom) return null;\n\n        // Filter submissions if tracking is active\n        const studentsData = classroom.students.map(student => {\n            const filteredSubmissions = student.submissions.filter(sub =>\n                classroom.isTrackingActive &&\n                classroom.trackingStartedAt &&\n                new Date(sub.createdAt) >= new Date(classroom.trackingStartedAt)\n            ).map(sub => ({\n                id: sub.id,\n                code: sub.code,\n                status: sub.status,\n                problemTitle: sub.problem.title,\n                createdAt: sub.createdAt\n            }));\n\n            return {\n                id: student.id,\n                name: student.name,\n                image: student.image,\n                submissions: filteredSubmissions\n            };\n        });\n\n        return {\n            isTrackingActive: classroom.isTrackingActive,\n            trackingStartedAt: classroom.trackingStartedAt,\n            students: studentsData\n        };\n    };\n\n    try {\n        const data = await cachedFetch(cacheKeyName, fetchTracking, CACHE_CONFIG.SHORT.ttl);\n\n        if (!data) {\n            return { success: false, error: \"Classroom not found\" };\n        }\n\n        return {\n            success: true,\n            ...data\n        };\n    } catch (error) {\n        console.error(\"Failed to fetch live tracking:\", error);\n        return { success: false, error: \"Failed to fetch tracking data\" };\n    }\n}\n\n/**\n * Fetches all classrooms for an institution (CACHED with pagination).\n */\nexport async function getInstitutionClassrooms(page: number = 1, limit: number = 20) {\n    const session = await auth.api.getSession({\n        headers: await headers(),\n    });\n\n    if (!session?.user) {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    const currentUser = session.user as any;\n\n    if (currentUser.role !== \"ADMIN\" && currentUser.role !== \"INSTITUTION_MANAGER\") {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    const institutionId = currentUser.institutionId;\n    const skip = (page - 1) * limit;\n\n    const fetchClassrooms = unstable_cache(\n        async () => {\n            const [classrooms, total] = await Promise.all([\n                prisma.classroom.findMany({\n                    where: { institutionId },\n                    include: {\n                        teacher: {\n                            select: { name: true, email: true }\n                        },\n                        _count: {\n                            select: { students: true }\n                        }\n                    },\n                    orderBy: { createdAt: \"desc\" },\n                    skip,\n                    take: limit,\n                }),\n                prisma.classroom.count({\n                    where: { institutionId }\n                })\n            ]);\n\n            return { classrooms, total };\n        },\n        [`institution-classrooms-${institutionId}-page-${page}`],\n        { tags: [`institution-classrooms-${institutionId}`], revalidate: 120 }\n    );\n\n    try {\n        const { classrooms, total } = await fetchClassrooms();\n        return {\n            success: true,\n            classrooms,\n            pagination: {\n                total,\n                pages: Math.ceil(total / limit),\n                current: page,\n                limit\n            }\n        };\n    } catch (error) {\n        console.error(\"Failed to fetch institution classrooms:\", error);\n        return { success: false, error: \"Failed to fetch classrooms\" };\n    }\n}\n\nexport async function removeStudentFromClassroom(classroomId: string, studentId: string) {\n    const session = await auth.api.getSession({\n        headers: await headers(),\n    });\n\n    if (!session?.user) {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    const currentUser = session.user as any;\n    const isPowerful = [\"ADMIN\", \"INSTITUTION_MANAGER\"].includes(currentUser.role);\n\n    try {\n        const classroom = await prisma.classroom.findUnique({\n            where: { id: classroomId },\n            select: { teacherId: true, institutionId: true },\n        });\n\n        if (!classroom) {\n            return { success: false, error: \"Classroom not found\" };\n        }\n\n        // Only allow if powerful role OR if current user is the teacher\n        if (!isPowerful && classroom.teacherId !== currentUser.id) {\n            return { success: false, error: \"Unauthorized\" };\n        }\n\n        await prisma.classroom.update({\n            where: { id: classroomId },\n            data: {\n                students: {\n                    disconnect: { id: studentId },\n                },\n            },\n        });\n\n        // Remove from Redis set\n        const redisKey = `classroom:students:${classroomId}`;\n        await redis.srem(redisKey, studentId);\n\n        // Invalidate caches\n        revalidateTag(`classroom-${classroomId}`, \"max\");\n        revalidateTag(`student-classrooms-${studentId}`, \"max\");\n        revalidatePath(`/dashboard/classrooms/${classroomId}`);\n\n        return { success: true };\n    } catch (error) {\n        console.error(\"Failed to remove student:\", error);\n        return { success: false, error: \"Failed to remove student\" };\n    }\n}\n"],"names":[],"mappings":";;;;;;;IAokBsB,6BAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA"}},
    {"offset": {"line": 175, "column": 0}, "map": {"version":3,"sources":["file:///home/vishnu/Documents/projects/Algo-fox/components/classroom/ClassroomLeaderboard.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useMemo } from \"react\";\nimport { Trophy, Search, ChevronLeft, ChevronRight, User, Trash2, Loader2 } from \"lucide-react\";\nimport Link from \"next/link\";\nimport Image from \"next/image\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport { removeStudentFromClassroom } from \"@/actions/classroom\";\nimport { toast } from \"sonner\";\n\ninterface Student {\n    id: string;\n    name: string | null;\n    totalScore: number;\n    image: string | null;\n}\n\ninterface ClassroomLeaderboardProps {\n    students: Student[];\n    isTeacher?: boolean;\n    classroomId?: string;\n}\n\nconst ITEMS_PER_PAGE = 20;\n\nexport function ClassroomLeaderboard({ students, isTeacher, classroomId }: ClassroomLeaderboardProps) {\n    const [searchQuery, setSearchQuery] = useState(\"\");\n    const [currentPage, setCurrentPage] = useState(1);\n    const [sortBy, setSortBy] = useState<'score_desc' | 'score_asc' | 'name_asc' | 'name_desc'>('score_desc');\n    const [minScore, setMinScore] = useState(0);\n    const [removingId, setRemovingId] = useState<string | null>(null);\n\n    const filteredStudents = useMemo(() => {\n        const filtered = students.filter(student =>\n            (student.name || \"Anonymous User\").toLowerCase().includes(searchQuery.toLowerCase()) &&\n            student.totalScore >= minScore\n        );\n\n        return filtered.sort((a, b) => {\n            if (sortBy === 'score_desc') return b.totalScore - a.totalScore;\n            if (sortBy === 'score_asc') return a.totalScore - b.totalScore;\n\n            const nameA = a.name || \"Anonymous\";\n            const nameB = b.name || \"Anonymous\";\n\n            if (sortBy === 'name_asc') return nameA.localeCompare(nameB);\n            if (sortBy === 'name_desc') return nameB.localeCompare(nameA);\n            return 0;\n        });\n    }, [students, searchQuery, sortBy, minScore]);\n\n    const totalPages = Math.ceil(filteredStudents.length / ITEMS_PER_PAGE);\n    const paginatedStudents = filteredStudents.slice(\n        (currentPage - 1) * ITEMS_PER_PAGE,\n        currentPage * ITEMS_PER_PAGE\n    );\n\n    const handleRemoveStudent = async (studentId: string, studentName: string) => {\n        if (!classroomId) return;\n\n        if (!confirm(`Are you sure you want to remove ${studentName || \"this student\"} from the classroom?`)) {\n            return;\n        }\n\n        setRemovingId(studentId);\n        try {\n            const res = await removeStudentFromClassroom(classroomId, studentId);\n            if (res.success) {\n                toast.success(\"Student removed successfully\");\n            } else {\n                toast.error(res.error || \"Failed to remove student\");\n            }\n        } catch (error) {\n            toast.error(\"Something went wrong\");\n        } finally {\n            setRemovingId(null);\n        }\n    };\n\n    if (students.length === 0) {\n        return (\n            <div className=\"bg-white dark:bg-[#141414] p-16 text-center border-t border-gray-100 dark:border-[#262626]\">\n                <Trophy className=\"w-12 h-12 text-gray-200 dark:text-gray-700 mx-auto mb-4\" />\n                <h3 className=\"text-xl font-black text-gray-900 dark:text-white mb-1\">Leaderboard Empty</h3>\n                <p className=\"text-gray-400 dark:text-gray-500 font-medium text-sm\">Waiting for students to start solving ranking problems.</p>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"bg-white dark:bg-[#141414]\">\n            {/* Header / Search Area */}\n            <div className=\"p-6 border-b border-gray-100 dark:border-[#262626] flex flex-col xl:flex-row gap-6 justify-between\">\n                <div className=\"flex items-center gap-2\">\n                    <Trophy className=\"w-5 h-5 text-orange-500\" />\n                    <h2 className=\"text-lg font-black text-gray-900 dark:text-white uppercase tracking-tight\">Leaderboard</h2>\n                    <span className=\"text-[10px] font-black text-gray-300 dark:text-gray-600 ml-2 uppercase tracking-[0.2em]\">{students.length} Total</span>\n                </div>\n\n                <div className=\"flex flex-col md:flex-row gap-4 w-full xl:w-auto\">\n                    {/* Search */}\n                    <div className=\"relative group flex-1 md:w-80\">\n                        <Search className=\"absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 dark:text-gray-500 group-focus-within:text-orange-500 transition-colors\" />\n                        <input\n                            type=\"text\"\n                            placeholder=\"Search student name...\"\n                            value={searchQuery}\n                            onChange={(e) => {\n                                setSearchQuery(e.target.value);\n                                setCurrentPage(1);\n                            }}\n                            className=\"w-full pl-11 pr-4 py-2.5 bg-gray-50 dark:bg-[#1a1a1a] border border-gray-100 dark:border-[#333] rounded-lg focus:bg-white dark:focus:bg-[#0a0a0a] focus:border-orange-500 focus:outline-none focus:ring-4 focus:ring-orange-500/5 transition-all text-sm font-bold placeholder:text-gray-300 dark:placeholder:text-gray-600 text-black dark:text-white\"\n                        />\n                    </div>\n\n                    {/* Filters */}\n                    <div className=\"flex gap-2\">\n                         <select\n                            value={sortBy}\n                            onChange={(e) => setSortBy(e.target.value as any)}\n                            className=\"px-4 py-2.5 bg-gray-50 dark:bg-[#1a1a1a] border border-gray-100 dark:border-[#333] rounded-lg text-sm font-bold text-gray-700 dark:text-gray-200 focus:border-orange-500 focus:outline-none outline-none appearance-none cursor-pointer\"\n                        >\n                            <option value=\"score_desc\">Highest Score</option>\n                            <option value=\"score_asc\">Lowest Score</option>\n                            <option value=\"name_asc\">Name (A-Z)</option>\n                            <option value=\"name_desc\">Name (Z-A)</option>\n                        </select>\n\n                        <select\n                            value={minScore}\n                            onChange={(e) => setMinScore(Number(e.target.value))}\n                            className=\"px-4 py-2.5 bg-gray-50 dark:bg-[#1a1a1a] border border-gray-100 dark:border-[#333] rounded-lg text-sm font-bold text-gray-700 dark:text-gray-200 focus:border-orange-500 focus:outline-none outline-none appearance-none cursor-pointer\"\n                        >\n                            <option value={0}>All Scores</option>\n                            <option value={100}>&gt; 100 Points</option>\n                            <option value={500}>&gt; 500 Points</option>\n                            <option value={1000}>&gt; 1000 Points</option>\n                        </select>\n                    </div>\n                </div>\n            </div>\n\n            {/* Systematic Table - No rounded corners on container, full width */}\n            <div className=\"overflow-x-auto\">\n                <table className=\"w-full text-left border-collapse\">\n                    <thead>\n                        <tr className=\"bg-gray-50/50 dark:bg-[#1a1a1a]/50 border-b border-gray-100 dark:border-[#262626]\">\n                            <th className=\"px-6 py-4 text-[10px] font-black text-gray-400 dark:text-gray-500 uppercase tracking-[0.2em] w-20 text-center\">Rank</th>\n                            <th className=\"px-6 py-4 text-[10px] font-black text-gray-400 dark:text-gray-500 uppercase tracking-[0.2em]\">Student</th>\n                            <th className=\"px-6 py-4 text-[10px] font-black text-gray-400 dark:text-gray-500 uppercase tracking-[0.2em] text-right\">Points</th>\n                            <th className=\"px-6 py-4 text-[10px] font-black text-gray-400 dark:text-gray-500 uppercase tracking-[0.2em] text-center w-32\">Action</th>\n                        </tr>\n                    </thead>\n                    <tbody className=\"divide-y divide-gray-100 dark:divide-[#262626]\">\n                        <AnimatePresence mode=\"popLayout\">\n                            {paginatedStudents.map((student, index) => {\n                                const actualIndex = (currentPage - 1) * ITEMS_PER_PAGE + index;\n                                return (\n                                    <motion.tr\n                                        layout\n                                        initial={{ opacity: 0 }}\n                                        animate={{ opacity: 1 }}\n                                        exit={{ opacity: 0 }}\n                                        key={student.id}\n                                        className=\"hover:bg-gray-50/50 dark:hover:bg-[#1a1a1a]/50 transition-colors group\"\n                                    >\n                                        <td className=\"px-6 py-4 text-center\">\n                                            <span className={`text-lg font-black ${actualIndex === 0 ? \"text-orange-500\" : \"text-gray-300 dark:text-gray-600\"} group-hover:text-orange-600 transition-colors`}>\n                                                #{actualIndex + 1}\n                                            </span>\n                                        </td>\n                                        <td className=\"px-6 py-4\">\n                                            <div className=\"flex items-center gap-4\">\n                                                <div className=\"relative w-10 h-10 rounded overflow-hidden bg-gray-50 dark:bg-[#262626] border border-gray-100 dark:border-[#333] group-hover:border-orange-200 dark:group-hover:border-orange-900 transition-all\">\n                                                    {student.image ? (\n                                                        <Image\n                                                            src={student.image}\n                                                            alt={student.name || \"Student\"}\n                                                            fill\n                                                            className=\"object-cover\"\n                                                        />\n                                                    ) : (\n                                                        <div className=\"w-full h-full flex items-center justify-center bg-orange-50 dark:bg-orange-500/10 text-orange-600 dark:text-orange-500 font-bold text-sm\">\n                                                            {student.name?.charAt(0).toUpperCase()}\n                                                        </div>\n                                                    )}\n                                                </div>\n                                                <div className=\"flex flex-col\">\n                                                    <span className=\"text-sm font-bold text-gray-900 dark:text-gray-200 group-hover:text-orange-600 transition-colors\">\n                                                        {student.name || \"Anonymous User\"}\n                                                    </span>\n                                                    <span className=\"text-[10px] font-black text-gray-300 dark:text-gray-600 uppercase tracking-widest leading-none mt-1\">\n                                                        Enrolled Student\n                                                    </span>\n                                                </div>\n                                            </div>\n                                        </td>\n                                        <td className=\"px-6 py-4 text-right\">\n                                            <span className=\"text-xl font-black text-gray-950 dark:text-white tabular-nums group-hover:text-orange-600 transition-colors\">\n                                                {student.totalScore.toLocaleString()}\n                                            </span>\n                                        </td>\n                                        <td className=\"px-6 py-4 text-center\">\n                                            <div className=\"flex items-center justify-center gap-2\">\n                                                <Link\n                                                    href={`/profile/${student.id}`}\n                                                    className=\"inline-flex items-center justify-center p-2 text-gray-400 dark:text-gray-600 hover:text-orange-600 dark:hover:text-orange-500 transition-colors\"\n                                                    title=\"View Profile\"\n                                                >\n                                                    <User className=\"w-4 h-4\" />\n                                                </Link>\n                                                {isTeacher && (\n                                                    <button\n                                                        onClick={() => handleRemoveStudent(student.id, student.name || \"\")}\n                                                        disabled={removingId === student.id}\n                                                        className=\"inline-flex items-center justify-center p-2 text-gray-400 dark:text-gray-600 hover:text-red-600 dark:hover:text-red-500 transition-colors disabled:opacity-50\"\n                                                        title=\"Remove Student\"\n                                                    >\n                                                        {removingId === student.id ? (\n                                                            <Loader2 className=\"w-4 h-4 animate-spin\" />\n                                                        ) : (\n                                                            <Trash2 className=\"w-4 h-4\" />\n                                                        )}\n                                                    </button>\n                                                )}\n                                            </div>\n                                        </td>\n                                    </motion.tr>\n                                );\n                            })}\n                        </AnimatePresence>\n                    </tbody>\n                </table>\n            </div>\n\n            {/* Pagination squared layout */}\n            {totalPages > 1 && (\n                <div className=\"p-6 border-t border-gray-100 dark:border-[#262626] flex items-center justify-between\">\n                    <p className=\"text-[10px] font-black text-gray-400 dark:text-gray-500 uppercase tracking-widest\">\n                        Page <span className=\"text-gray-900 dark:text-white\">{currentPage}</span> of {totalPages}\n                    </p>\n                    <div className=\"flex items-center gap-2\">\n                        <button\n                            onClick={() => {\n                                setCurrentPage(prev => Math.max(1, prev - 1));\n                                window.scrollTo({ top: 0, behavior: 'smooth' });\n                            }}\n                            disabled={currentPage === 1}\n                            className=\"px-4 py-2 border border-gray-100 dark:border-[#333] text-xs font-black uppercase tracking-widest text-black dark:text-white hover:text-orange-600 dark:hover:text-orange-500 hover:border-orange-500 dark:hover:border-orange-500 disabled:opacity-30 transition-all\"\n                        >\n                            Previous\n                        </button>\n                        <button\n                            onClick={() => {\n                                setCurrentPage(prev => Math.min(totalPages, prev + 1));\n                                window.scrollTo({ top: 0, behavior: 'smooth' });\n                            }}\n                            disabled={currentPage === totalPages}\n                            className=\"px-4 py-2 border border-black dark:border-white bg-black dark:bg-white text-white dark:text-black text-xs font-black uppercase tracking-widest hover:bg-orange-600 dark:hover:bg-gray-200 hover:border-orange-600 dark:hover:border-gray-200 disabled:opacity-30 transition-all\"\n                        >\n                            Next\n                        </button>\n                    </div>\n                </div>\n            )}\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 794, "column": 0}, "map": {"version":3,"sources":["file:///home/vishnu/Documents/projects/Algo-fox/actions/classroom.ts"],"sourcesContent":["\"use server\";\n\nimport { prisma } from \"@/lib/prisma\";\nimport redis from \"@/lib/redis\";\nimport { auth } from \"@/lib/auth\";\nimport { headers } from \"next/headers\";\nimport { z } from \"zod\";\nimport { revalidatePath, revalidateTag, unstable_cache } from \"next/cache\";\nimport { cacheKey, cachedFetch, CACHE_CONFIG, deleteFromCache } from \"@/lib/cache-utils\";\n\nconst classroomSchema = z.object({\n    name: z.string().min(2, \"Name must be at least 2 characters\"),\n    section: z.string().optional().or(z.literal(\"\")),\n    subject: z.string().optional().or(z.literal(\"\")),\n    institutionId: z.string(),\n});\n\nfunction generateJoinCode() {\n    const chars = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\";\n    let code = \"\";\n    for (let i = 0; i < 6; i++) {\n        code += chars.charAt(Math.floor(Math.random() * chars.length));\n    }\n    return code;\n}\n\n/**\n * Creates a new classroom.\n * Only ADMIN, INSTITUTION_MANAGER, or TEACHER roles can create classrooms.\n */\nexport async function createClassroom(data: z.infer<typeof classroomSchema>) {\n    const session = await auth.api.getSession({\n        headers: await headers(),\n    });\n\n    if (!session?.user) {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    const currentUser = session.user as any;\n\n    // Security check\n    if (![\"ADMIN\", \"INSTITUTION_MANAGER\", \"TEACHER\"].includes(currentUser.role)) {\n        return { success: false, error: \"Unauthorized. Only teachers or managers can create classrooms.\" };\n    }\n\n    try {\n        const validatedData = classroomSchema.parse(data);\n\n        // Generate unique 6-character join code\n        let joinCode = \"\";\n        let isUnique = false;\n        let attempts = 0;\n        while (!isUnique && attempts < 10) {\n            joinCode = generateJoinCode();\n            const existing = await prisma.classroom.findUnique({\n                where: { joinCode },\n            });\n            if (!existing) isUnique = true;\n            attempts++;\n        }\n\n        if (!isUnique) {\n            return { success: false, error: \"Failed to generate a unique join code. Please try again.\" };\n        }\n\n        const classroom = await prisma.classroom.create({\n            data: {\n                name: validatedData.name,\n                section: validatedData.section || null,\n                subject: validatedData.subject || null,\n                joinCode,\n                institutionId: validatedData.institutionId,\n                teacherId: currentUser.id,\n            },\n        });\n\n        // Invalidate relevant caches\n        revalidateTag(`teacher-classrooms-${currentUser.id}`, \"max\");\n        revalidateTag(`institution-classrooms-${validatedData.institutionId}`, \"max\");\n        revalidatePath(\"/dashboard/institution/classrooms\");\n\n        return { success: true, data: classroom };\n    } catch (error) {\n        if (error instanceof z.ZodError) {\n            return { success: false, error: error.issues[0].message };\n        }\n        console.error(\"Failed to create classroom:\", error);\n        return { success: false, error: \"Failed to create classroom\" };\n    }\n}\n\n/**\n * Allows a student to join a classroom using a 6-character code.\n * Also onboards the student to the institution if they are not already associated.\n */\nexport async function joinClassroom(code: string) {\n    const session = await auth.api.getSession({\n        headers: await headers(),\n    });\n\n    if (!session?.user) {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    const currentUser = session.user as any;\n\n    try {\n\n        const classroom = await prisma.classroom.findUnique({\n            where: { joinCode: code.toUpperCase() },\n            include: {\n                students: {\n                    where: { id: currentUser.id },\n                },\n            },\n        });\n\n        if (!classroom) {\n            return { success: false, error: \"Invalid join code.\" };\n        }\n\n        if (classroom.students.length > 0) {\n            return { success: false, error: \"You are already enrolled in this classroom.\" };\n        }\n\n\n        // Institution Check:\n        // 1. If user belongs to an institution, they can only join classrooms from THAT institution.\n        // 2. If user has NO institution, they are assigned to this classroom's institution.\n\n        if (currentUser.institutionId && currentUser.institutionId !== classroom.institutionId) {\n             return {\n                success: false,\n                error: \"You cannot join this classroom because it belongs to a different institution.\"\n             };\n        }\n\n        // Add student to classroom\n        await prisma.classroom.update({\n            where: { id: classroom.id },\n            data: {\n                students: {\n                    connect: { id: currentUser.id },\n                },\n            },\n        });\n\n        // Onboard student to institution if null\n        const updateData: any = {\n            onboardingCompleted: true,\n        };\n\n        if (!currentUser.institutionId) {\n            updateData.institutionId = classroom.institutionId;\n        }\n\n        await prisma.user.update({\n            where: { id: currentUser.id },\n            data: updateData,\n        });\n\n        // Redis Integration: Cache student IDs per classroom\n        const redisKey = `classroom:students:${classroom.id}`;\n        await redis.sadd(redisKey, currentUser.id);\n\n        // Invalidate caches\n        revalidateTag(`student-classrooms-${currentUser.id}`, \"max\");\n        revalidateTag(`classroom-${classroom.id}`, \"max\");\n        revalidatePath(\"/dashboard/classrooms\");\n\n        return { success: true, message: `Successfully joined ${classroom.name}` };\n    } catch (error) {\n        console.error(\"Failed to join classroom:\", error);\n        return { success: false, error: \"Failed to join classroom\" };\n    }\n}\n\n/**\n * Fetches basic details of a classroom by its join code.\n * Used for the join classroom page.\n */\nexport async function getClassroomByCode(code: string) {\n    try {\n        const classroom = await prisma.classroom.findUnique({\n            where: { joinCode: code.toUpperCase() },\n            select: {\n                id: true,\n                name: true,\n                subject: true,\n                section: true,\n                teacher: {\n                    select: {\n                        id: true,\n                        name: true,\n                        image: true,\n                    }\n                },\n                _count: {\n                    select: { students: true }\n                }\n            }\n        });\n\n        if (!classroom) {\n            return { success: false, error: \"Classroom not found\" };\n        }\n\n        const session = await auth.api.getSession({\n            headers: await headers(),\n        });\n\n        const isEnrolled = session?.user ? await prisma.classroom.findFirst({\n            where: {\n                id: classroom.id,\n                students: { some: { id: session.user.id } }\n            }\n        }) : false;\n\n        return {\n            success: true,\n            classroom,\n            isEnrolled: !!isEnrolled\n        };\n    } catch (error) {\n        console.error(\"Failed to fetch classroom by code:\", error);\n        return { success: false, error: \"Failed to fetch classroom\" };\n    }\n}\n\n/**\n * Fetches classrooms created by the currently logged-in teacher (CACHED).\n */\nexport async function getTeacherClassrooms() {\n    const session = await auth.api.getSession({\n        headers: await headers(),\n    });\n\n    if (!session?.user) {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    const userId = session.user.id;\n\n    const fetchClassrooms = unstable_cache(\n        async () => {\n            return await prisma.classroom.findMany({\n                where: { teacherId: userId },\n                include: {\n                    _count: {\n                        select: { students: true },\n                    },\n                },\n                orderBy: { createdAt: \"desc\" },\n            });\n        },\n        [`teacher-classrooms-${userId}`],\n        { tags: [`teacher-classrooms-${userId}`], revalidate: 120 }\n    );\n\n    try {\n        const classrooms = await fetchClassrooms();\n        return { success: true, classrooms };\n    } catch (error) {\n        console.error(\"Failed to fetch teacher classrooms:\", error);\n        return { success: false, error: \"Failed to fetch classrooms\" };\n    }\n}\n\n/**\n * Fetches classrooms where the currently logged-in student is enrolled (CACHED).\n */\nexport async function getStudentClassrooms() {\n    const session = await auth.api.getSession({\n        headers: await headers(),\n    });\n\n    if (!session?.user) {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    const userId = session.user.id;\n\n    const fetchClassrooms = unstable_cache(\n        async () => {\n            const user = await prisma.user.findUnique({\n                where: { id: userId },\n                include: {\n                    enrolledClassrooms: {\n                        include: {\n                            teacher: {\n                                select: { name: true },\n                            },\n                        },\n                        orderBy: { createdAt: \"desc\" },\n                    },\n                },\n            });\n            return user?.enrolledClassrooms || [];\n        },\n        [`student-classrooms-${userId}`],\n        { tags: [`student-classrooms-${userId}`], revalidate: 120 }\n    );\n\n    try {\n        const classrooms = await fetchClassrooms();\n        return { success: true, classrooms };\n    } catch (error) {\n        console.error(\"Failed to fetch student classrooms:\", error);\n        return { success: false, error: \"Failed to fetch classrooms\" };\n    }\n}\n\n/**\n * Fetches details of a specific classroom, including the student list for the leaderboard (CACHED).\n * Supports pagination for large student lists.\n */\nexport async function getClassroomWithStudents(\n    id: string,\n    page: number = 1,\n    limit: number = 50\n) {\n    const session = await auth.api.getSession({\n        headers: await headers(),\n    });\n\n    if (!session?.user) {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    const skip = (page - 1) * limit;\n\n    const fetchClassroom = unstable_cache(\n        async () => {\n            const [classroom, totalStudents] = await Promise.all([\n                prisma.classroom.findUnique({\n                    where: { id },\n                    select: {\n                        id: true,\n                        name: true,\n                        subject: true,\n                        section: true,\n                        joinCode: true,\n                        isTrackingActive: true,\n                        trackingStartedAt: true,\n                        teacher: {\n                            select: { name: true, id: true },\n                        },\n                        students: {\n                            select: {\n                                id: true,\n                                name: true,\n                                totalScore: true,\n                                image: true,\n                            },\n                            orderBy: { totalScore: \"desc\" },\n                            skip,\n                            take: limit,\n                        },\n                    },\n                }),\n                prisma.user.count({\n                    where: {\n                        enrolledClassrooms: {\n                            some: { id }\n                        }\n                    }\n                })\n            ]);\n\n            return { classroom, totalStudents };\n        },\n        [`classroom-${id}-page-${page}`],\n        { tags: [`classroom-${id}`], revalidate: 60 }\n    );\n\n    try {\n        const { classroom, totalStudents } = await fetchClassroom();\n\n        if (!classroom) {\n            return { success: false, error: \"Classroom not found\" };\n        }\n\n        return {\n            success: true,\n            classroom,\n            pagination: {\n                total: totalStudents,\n                pages: Math.ceil(totalStudents / limit),\n                current: page,\n                limit\n            }\n        };\n    } catch (error) {\n        console.error(\"Failed to fetch classroom detail:\", error);\n        return { success: false, error: \"Failed to fetch classroom\" };\n    }\n}\n\nexport async function toggleClassroomTracking(classroomId: string, active: boolean) {\n    const session = await auth.api.getSession({\n        headers: await headers(),\n    });\n\n    if (!session?.user) return { success: false, error: \"Unauthorized\" };\n\n    const classroom = await prisma.classroom.findUnique({\n        where: { id: classroomId },\n        select: { teacherId: true }\n    });\n\n    if (!classroom || (classroom.teacherId !== session.user.id && (session.user as any).role !== \"ADMIN\")) {\n        return { success: false, error: \"Access denied\" };\n    }\n\n    await prisma.classroom.update({\n        where: { id: classroomId },\n        data: {\n            isTrackingActive: active,\n            trackingStartedAt: active ? new Date() : null\n        }\n    });\n\n    await deleteFromCache(cacheKey(\"live-tracking\", classroomId));\n    revalidateTag(`classroom-${classroomId}`, \"max\");\n    revalidatePath(`/dashboard/classrooms/${classroomId}`);\n    return { success: true };\n}\n\nexport async function getClassroomLiveTracking(classroomId: string) {\n    const session = await auth.api.getSession({\n        headers: await headers(),\n    });\n\n    if (!session?.user) return { success: false, error: \"Unauthorized\" };\n\n    // Use Redis cache for live tracking data (short TTL)\n    const cacheKeyName = cacheKey(\"live-tracking\", classroomId);\n\n    const fetchTracking = async () => {\n        const classroom = await prisma.classroom.findUnique({\n            where: { id: classroomId },\n            select: {\n                isTrackingActive: true,\n                trackingStartedAt: true,\n                students: {\n                    select: {\n                        id: true,\n                        name: true,\n                        image: true,\n                        submissions: {\n                            where: {\n                                mode: \"SUBMIT\",\n                            },\n                            orderBy: { createdAt: 'desc' },\n                            take: 20,\n                            include: {\n                                problem: { select: { title: true } }\n                            }\n                        }\n                    }\n                }\n            }\n        });\n\n        if (!classroom) return null;\n\n        // Filter submissions if tracking is active\n        const studentsData = classroom.students.map(student => {\n            const filteredSubmissions = student.submissions.filter(sub =>\n                classroom.isTrackingActive &&\n                classroom.trackingStartedAt &&\n                new Date(sub.createdAt) >= new Date(classroom.trackingStartedAt)\n            ).map(sub => ({\n                id: sub.id,\n                code: sub.code,\n                status: sub.status,\n                problemTitle: sub.problem.title,\n                createdAt: sub.createdAt\n            }));\n\n            return {\n                id: student.id,\n                name: student.name,\n                image: student.image,\n                submissions: filteredSubmissions\n            };\n        });\n\n        return {\n            isTrackingActive: classroom.isTrackingActive,\n            trackingStartedAt: classroom.trackingStartedAt,\n            students: studentsData\n        };\n    };\n\n    try {\n        const data = await cachedFetch(cacheKeyName, fetchTracking, CACHE_CONFIG.SHORT.ttl);\n\n        if (!data) {\n            return { success: false, error: \"Classroom not found\" };\n        }\n\n        return {\n            success: true,\n            ...data\n        };\n    } catch (error) {\n        console.error(\"Failed to fetch live tracking:\", error);\n        return { success: false, error: \"Failed to fetch tracking data\" };\n    }\n}\n\n/**\n * Fetches all classrooms for an institution (CACHED with pagination).\n */\nexport async function getInstitutionClassrooms(page: number = 1, limit: number = 20) {\n    const session = await auth.api.getSession({\n        headers: await headers(),\n    });\n\n    if (!session?.user) {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    const currentUser = session.user as any;\n\n    if (currentUser.role !== \"ADMIN\" && currentUser.role !== \"INSTITUTION_MANAGER\") {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    const institutionId = currentUser.institutionId;\n    const skip = (page - 1) * limit;\n\n    const fetchClassrooms = unstable_cache(\n        async () => {\n            const [classrooms, total] = await Promise.all([\n                prisma.classroom.findMany({\n                    where: { institutionId },\n                    include: {\n                        teacher: {\n                            select: { name: true, email: true }\n                        },\n                        _count: {\n                            select: { students: true }\n                        }\n                    },\n                    orderBy: { createdAt: \"desc\" },\n                    skip,\n                    take: limit,\n                }),\n                prisma.classroom.count({\n                    where: { institutionId }\n                })\n            ]);\n\n            return { classrooms, total };\n        },\n        [`institution-classrooms-${institutionId}-page-${page}`],\n        { tags: [`institution-classrooms-${institutionId}`], revalidate: 120 }\n    );\n\n    try {\n        const { classrooms, total } = await fetchClassrooms();\n        return {\n            success: true,\n            classrooms,\n            pagination: {\n                total,\n                pages: Math.ceil(total / limit),\n                current: page,\n                limit\n            }\n        };\n    } catch (error) {\n        console.error(\"Failed to fetch institution classrooms:\", error);\n        return { success: false, error: \"Failed to fetch classrooms\" };\n    }\n}\n\nexport async function removeStudentFromClassroom(classroomId: string, studentId: string) {\n    const session = await auth.api.getSession({\n        headers: await headers(),\n    });\n\n    if (!session?.user) {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    const currentUser = session.user as any;\n    const isPowerful = [\"ADMIN\", \"INSTITUTION_MANAGER\"].includes(currentUser.role);\n\n    try {\n        const classroom = await prisma.classroom.findUnique({\n            where: { id: classroomId },\n            select: { teacherId: true, institutionId: true },\n        });\n\n        if (!classroom) {\n            return { success: false, error: \"Classroom not found\" };\n        }\n\n        // Only allow if powerful role OR if current user is the teacher\n        if (!isPowerful && classroom.teacherId !== currentUser.id) {\n            return { success: false, error: \"Unauthorized\" };\n        }\n\n        await prisma.classroom.update({\n            where: { id: classroomId },\n            data: {\n                students: {\n                    disconnect: { id: studentId },\n                },\n            },\n        });\n\n        // Remove from Redis set\n        const redisKey = `classroom:students:${classroomId}`;\n        await redis.srem(redisKey, studentId);\n\n        // Invalidate caches\n        revalidateTag(`classroom-${classroomId}`, \"max\");\n        revalidateTag(`student-classrooms-${studentId}`, \"max\");\n        revalidatePath(`/dashboard/classrooms/${classroomId}`);\n\n        return { success: true };\n    } catch (error) {\n        console.error(\"Failed to remove student:\", error);\n        return { success: false, error: \"Failed to remove student\" };\n    }\n}\n"],"names":[],"mappings":";;;;;;;IA6asB,2BAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA"}},
    {"offset": {"line": 806, "column": 0}, "map": {"version":3,"sources":["file:///home/vishnu/Documents/projects/Algo-fox/actions/classroom.ts"],"sourcesContent":["\"use server\";\n\nimport { prisma } from \"@/lib/prisma\";\nimport redis from \"@/lib/redis\";\nimport { auth } from \"@/lib/auth\";\nimport { headers } from \"next/headers\";\nimport { z } from \"zod\";\nimport { revalidatePath, revalidateTag, unstable_cache } from \"next/cache\";\nimport { cacheKey, cachedFetch, CACHE_CONFIG, deleteFromCache } from \"@/lib/cache-utils\";\n\nconst classroomSchema = z.object({\n    name: z.string().min(2, \"Name must be at least 2 characters\"),\n    section: z.string().optional().or(z.literal(\"\")),\n    subject: z.string().optional().or(z.literal(\"\")),\n    institutionId: z.string(),\n});\n\nfunction generateJoinCode() {\n    const chars = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\";\n    let code = \"\";\n    for (let i = 0; i < 6; i++) {\n        code += chars.charAt(Math.floor(Math.random() * chars.length));\n    }\n    return code;\n}\n\n/**\n * Creates a new classroom.\n * Only ADMIN, INSTITUTION_MANAGER, or TEACHER roles can create classrooms.\n */\nexport async function createClassroom(data: z.infer<typeof classroomSchema>) {\n    const session = await auth.api.getSession({\n        headers: await headers(),\n    });\n\n    if (!session?.user) {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    const currentUser = session.user as any;\n\n    // Security check\n    if (![\"ADMIN\", \"INSTITUTION_MANAGER\", \"TEACHER\"].includes(currentUser.role)) {\n        return { success: false, error: \"Unauthorized. Only teachers or managers can create classrooms.\" };\n    }\n\n    try {\n        const validatedData = classroomSchema.parse(data);\n\n        // Generate unique 6-character join code\n        let joinCode = \"\";\n        let isUnique = false;\n        let attempts = 0;\n        while (!isUnique && attempts < 10) {\n            joinCode = generateJoinCode();\n            const existing = await prisma.classroom.findUnique({\n                where: { joinCode },\n            });\n            if (!existing) isUnique = true;\n            attempts++;\n        }\n\n        if (!isUnique) {\n            return { success: false, error: \"Failed to generate a unique join code. Please try again.\" };\n        }\n\n        const classroom = await prisma.classroom.create({\n            data: {\n                name: validatedData.name,\n                section: validatedData.section || null,\n                subject: validatedData.subject || null,\n                joinCode,\n                institutionId: validatedData.institutionId,\n                teacherId: currentUser.id,\n            },\n        });\n\n        // Invalidate relevant caches\n        revalidateTag(`teacher-classrooms-${currentUser.id}`, \"max\");\n        revalidateTag(`institution-classrooms-${validatedData.institutionId}`, \"max\");\n        revalidatePath(\"/dashboard/institution/classrooms\");\n\n        return { success: true, data: classroom };\n    } catch (error) {\n        if (error instanceof z.ZodError) {\n            return { success: false, error: error.issues[0].message };\n        }\n        console.error(\"Failed to create classroom:\", error);\n        return { success: false, error: \"Failed to create classroom\" };\n    }\n}\n\n/**\n * Allows a student to join a classroom using a 6-character code.\n * Also onboards the student to the institution if they are not already associated.\n */\nexport async function joinClassroom(code: string) {\n    const session = await auth.api.getSession({\n        headers: await headers(),\n    });\n\n    if (!session?.user) {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    const currentUser = session.user as any;\n\n    try {\n\n        const classroom = await prisma.classroom.findUnique({\n            where: { joinCode: code.toUpperCase() },\n            include: {\n                students: {\n                    where: { id: currentUser.id },\n                },\n            },\n        });\n\n        if (!classroom) {\n            return { success: false, error: \"Invalid join code.\" };\n        }\n\n        if (classroom.students.length > 0) {\n            return { success: false, error: \"You are already enrolled in this classroom.\" };\n        }\n\n\n        // Institution Check:\n        // 1. If user belongs to an institution, they can only join classrooms from THAT institution.\n        // 2. If user has NO institution, they are assigned to this classroom's institution.\n\n        if (currentUser.institutionId && currentUser.institutionId !== classroom.institutionId) {\n             return {\n                success: false,\n                error: \"You cannot join this classroom because it belongs to a different institution.\"\n             };\n        }\n\n        // Add student to classroom\n        await prisma.classroom.update({\n            where: { id: classroom.id },\n            data: {\n                students: {\n                    connect: { id: currentUser.id },\n                },\n            },\n        });\n\n        // Onboard student to institution if null\n        const updateData: any = {\n            onboardingCompleted: true,\n        };\n\n        if (!currentUser.institutionId) {\n            updateData.institutionId = classroom.institutionId;\n        }\n\n        await prisma.user.update({\n            where: { id: currentUser.id },\n            data: updateData,\n        });\n\n        // Redis Integration: Cache student IDs per classroom\n        const redisKey = `classroom:students:${classroom.id}`;\n        await redis.sadd(redisKey, currentUser.id);\n\n        // Invalidate caches\n        revalidateTag(`student-classrooms-${currentUser.id}`, \"max\");\n        revalidateTag(`classroom-${classroom.id}`, \"max\");\n        revalidatePath(\"/dashboard/classrooms\");\n\n        return { success: true, message: `Successfully joined ${classroom.name}` };\n    } catch (error) {\n        console.error(\"Failed to join classroom:\", error);\n        return { success: false, error: \"Failed to join classroom\" };\n    }\n}\n\n/**\n * Fetches basic details of a classroom by its join code.\n * Used for the join classroom page.\n */\nexport async function getClassroomByCode(code: string) {\n    try {\n        const classroom = await prisma.classroom.findUnique({\n            where: { joinCode: code.toUpperCase() },\n            select: {\n                id: true,\n                name: true,\n                subject: true,\n                section: true,\n                teacher: {\n                    select: {\n                        id: true,\n                        name: true,\n                        image: true,\n                    }\n                },\n                _count: {\n                    select: { students: true }\n                }\n            }\n        });\n\n        if (!classroom) {\n            return { success: false, error: \"Classroom not found\" };\n        }\n\n        const session = await auth.api.getSession({\n            headers: await headers(),\n        });\n\n        const isEnrolled = session?.user ? await prisma.classroom.findFirst({\n            where: {\n                id: classroom.id,\n                students: { some: { id: session.user.id } }\n            }\n        }) : false;\n\n        return {\n            success: true,\n            classroom,\n            isEnrolled: !!isEnrolled\n        };\n    } catch (error) {\n        console.error(\"Failed to fetch classroom by code:\", error);\n        return { success: false, error: \"Failed to fetch classroom\" };\n    }\n}\n\n/**\n * Fetches classrooms created by the currently logged-in teacher (CACHED).\n */\nexport async function getTeacherClassrooms() {\n    const session = await auth.api.getSession({\n        headers: await headers(),\n    });\n\n    if (!session?.user) {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    const userId = session.user.id;\n\n    const fetchClassrooms = unstable_cache(\n        async () => {\n            return await prisma.classroom.findMany({\n                where: { teacherId: userId },\n                include: {\n                    _count: {\n                        select: { students: true },\n                    },\n                },\n                orderBy: { createdAt: \"desc\" },\n            });\n        },\n        [`teacher-classrooms-${userId}`],\n        { tags: [`teacher-classrooms-${userId}`], revalidate: 120 }\n    );\n\n    try {\n        const classrooms = await fetchClassrooms();\n        return { success: true, classrooms };\n    } catch (error) {\n        console.error(\"Failed to fetch teacher classrooms:\", error);\n        return { success: false, error: \"Failed to fetch classrooms\" };\n    }\n}\n\n/**\n * Fetches classrooms where the currently logged-in student is enrolled (CACHED).\n */\nexport async function getStudentClassrooms() {\n    const session = await auth.api.getSession({\n        headers: await headers(),\n    });\n\n    if (!session?.user) {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    const userId = session.user.id;\n\n    const fetchClassrooms = unstable_cache(\n        async () => {\n            const user = await prisma.user.findUnique({\n                where: { id: userId },\n                include: {\n                    enrolledClassrooms: {\n                        include: {\n                            teacher: {\n                                select: { name: true },\n                            },\n                        },\n                        orderBy: { createdAt: \"desc\" },\n                    },\n                },\n            });\n            return user?.enrolledClassrooms || [];\n        },\n        [`student-classrooms-${userId}`],\n        { tags: [`student-classrooms-${userId}`], revalidate: 120 }\n    );\n\n    try {\n        const classrooms = await fetchClassrooms();\n        return { success: true, classrooms };\n    } catch (error) {\n        console.error(\"Failed to fetch student classrooms:\", error);\n        return { success: false, error: \"Failed to fetch classrooms\" };\n    }\n}\n\n/**\n * Fetches details of a specific classroom, including the student list for the leaderboard (CACHED).\n * Supports pagination for large student lists.\n */\nexport async function getClassroomWithStudents(\n    id: string,\n    page: number = 1,\n    limit: number = 50\n) {\n    const session = await auth.api.getSession({\n        headers: await headers(),\n    });\n\n    if (!session?.user) {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    const skip = (page - 1) * limit;\n\n    const fetchClassroom = unstable_cache(\n        async () => {\n            const [classroom, totalStudents] = await Promise.all([\n                prisma.classroom.findUnique({\n                    where: { id },\n                    select: {\n                        id: true,\n                        name: true,\n                        subject: true,\n                        section: true,\n                        joinCode: true,\n                        isTrackingActive: true,\n                        trackingStartedAt: true,\n                        teacher: {\n                            select: { name: true, id: true },\n                        },\n                        students: {\n                            select: {\n                                id: true,\n                                name: true,\n                                totalScore: true,\n                                image: true,\n                            },\n                            orderBy: { totalScore: \"desc\" },\n                            skip,\n                            take: limit,\n                        },\n                    },\n                }),\n                prisma.user.count({\n                    where: {\n                        enrolledClassrooms: {\n                            some: { id }\n                        }\n                    }\n                })\n            ]);\n\n            return { classroom, totalStudents };\n        },\n        [`classroom-${id}-page-${page}`],\n        { tags: [`classroom-${id}`], revalidate: 60 }\n    );\n\n    try {\n        const { classroom, totalStudents } = await fetchClassroom();\n\n        if (!classroom) {\n            return { success: false, error: \"Classroom not found\" };\n        }\n\n        return {\n            success: true,\n            classroom,\n            pagination: {\n                total: totalStudents,\n                pages: Math.ceil(totalStudents / limit),\n                current: page,\n                limit\n            }\n        };\n    } catch (error) {\n        console.error(\"Failed to fetch classroom detail:\", error);\n        return { success: false, error: \"Failed to fetch classroom\" };\n    }\n}\n\nexport async function toggleClassroomTracking(classroomId: string, active: boolean) {\n    const session = await auth.api.getSession({\n        headers: await headers(),\n    });\n\n    if (!session?.user) return { success: false, error: \"Unauthorized\" };\n\n    const classroom = await prisma.classroom.findUnique({\n        where: { id: classroomId },\n        select: { teacherId: true }\n    });\n\n    if (!classroom || (classroom.teacherId !== session.user.id && (session.user as any).role !== \"ADMIN\")) {\n        return { success: false, error: \"Access denied\" };\n    }\n\n    await prisma.classroom.update({\n        where: { id: classroomId },\n        data: {\n            isTrackingActive: active,\n            trackingStartedAt: active ? new Date() : null\n        }\n    });\n\n    await deleteFromCache(cacheKey(\"live-tracking\", classroomId));\n    revalidateTag(`classroom-${classroomId}`, \"max\");\n    revalidatePath(`/dashboard/classrooms/${classroomId}`);\n    return { success: true };\n}\n\nexport async function getClassroomLiveTracking(classroomId: string) {\n    const session = await auth.api.getSession({\n        headers: await headers(),\n    });\n\n    if (!session?.user) return { success: false, error: \"Unauthorized\" };\n\n    // Use Redis cache for live tracking data (short TTL)\n    const cacheKeyName = cacheKey(\"live-tracking\", classroomId);\n\n    const fetchTracking = async () => {\n        const classroom = await prisma.classroom.findUnique({\n            where: { id: classroomId },\n            select: {\n                isTrackingActive: true,\n                trackingStartedAt: true,\n                students: {\n                    select: {\n                        id: true,\n                        name: true,\n                        image: true,\n                        submissions: {\n                            where: {\n                                mode: \"SUBMIT\",\n                            },\n                            orderBy: { createdAt: 'desc' },\n                            take: 20,\n                            include: {\n                                problem: { select: { title: true } }\n                            }\n                        }\n                    }\n                }\n            }\n        });\n\n        if (!classroom) return null;\n\n        // Filter submissions if tracking is active\n        const studentsData = classroom.students.map(student => {\n            const filteredSubmissions = student.submissions.filter(sub =>\n                classroom.isTrackingActive &&\n                classroom.trackingStartedAt &&\n                new Date(sub.createdAt) >= new Date(classroom.trackingStartedAt)\n            ).map(sub => ({\n                id: sub.id,\n                code: sub.code,\n                status: sub.status,\n                problemTitle: sub.problem.title,\n                createdAt: sub.createdAt\n            }));\n\n            return {\n                id: student.id,\n                name: student.name,\n                image: student.image,\n                submissions: filteredSubmissions\n            };\n        });\n\n        return {\n            isTrackingActive: classroom.isTrackingActive,\n            trackingStartedAt: classroom.trackingStartedAt,\n            students: studentsData\n        };\n    };\n\n    try {\n        const data = await cachedFetch(cacheKeyName, fetchTracking, CACHE_CONFIG.SHORT.ttl);\n\n        if (!data) {\n            return { success: false, error: \"Classroom not found\" };\n        }\n\n        return {\n            success: true,\n            ...data\n        };\n    } catch (error) {\n        console.error(\"Failed to fetch live tracking:\", error);\n        return { success: false, error: \"Failed to fetch tracking data\" };\n    }\n}\n\n/**\n * Fetches all classrooms for an institution (CACHED with pagination).\n */\nexport async function getInstitutionClassrooms(page: number = 1, limit: number = 20) {\n    const session = await auth.api.getSession({\n        headers: await headers(),\n    });\n\n    if (!session?.user) {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    const currentUser = session.user as any;\n\n    if (currentUser.role !== \"ADMIN\" && currentUser.role !== \"INSTITUTION_MANAGER\") {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    const institutionId = currentUser.institutionId;\n    const skip = (page - 1) * limit;\n\n    const fetchClassrooms = unstable_cache(\n        async () => {\n            const [classrooms, total] = await Promise.all([\n                prisma.classroom.findMany({\n                    where: { institutionId },\n                    include: {\n                        teacher: {\n                            select: { name: true, email: true }\n                        },\n                        _count: {\n                            select: { students: true }\n                        }\n                    },\n                    orderBy: { createdAt: \"desc\" },\n                    skip,\n                    take: limit,\n                }),\n                prisma.classroom.count({\n                    where: { institutionId }\n                })\n            ]);\n\n            return { classrooms, total };\n        },\n        [`institution-classrooms-${institutionId}-page-${page}`],\n        { tags: [`institution-classrooms-${institutionId}`], revalidate: 120 }\n    );\n\n    try {\n        const { classrooms, total } = await fetchClassrooms();\n        return {\n            success: true,\n            classrooms,\n            pagination: {\n                total,\n                pages: Math.ceil(total / limit),\n                current: page,\n                limit\n            }\n        };\n    } catch (error) {\n        console.error(\"Failed to fetch institution classrooms:\", error);\n        return { success: false, error: \"Failed to fetch classrooms\" };\n    }\n}\n\nexport async function removeStudentFromClassroom(classroomId: string, studentId: string) {\n    const session = await auth.api.getSession({\n        headers: await headers(),\n    });\n\n    if (!session?.user) {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    const currentUser = session.user as any;\n    const isPowerful = [\"ADMIN\", \"INSTITUTION_MANAGER\"].includes(currentUser.role);\n\n    try {\n        const classroom = await prisma.classroom.findUnique({\n            where: { id: classroomId },\n            select: { teacherId: true, institutionId: true },\n        });\n\n        if (!classroom) {\n            return { success: false, error: \"Classroom not found\" };\n        }\n\n        // Only allow if powerful role OR if current user is the teacher\n        if (!isPowerful && classroom.teacherId !== currentUser.id) {\n            return { success: false, error: \"Unauthorized\" };\n        }\n\n        await prisma.classroom.update({\n            where: { id: classroomId },\n            data: {\n                students: {\n                    disconnect: { id: studentId },\n                },\n            },\n        });\n\n        // Remove from Redis set\n        const redisKey = `classroom:students:${classroomId}`;\n        await redis.srem(redisKey, studentId);\n\n        // Invalidate caches\n        revalidateTag(`classroom-${classroomId}`, \"max\");\n        revalidateTag(`student-classrooms-${studentId}`, \"max\");\n        revalidatePath(`/dashboard/classrooms/${classroomId}`);\n\n        return { success: true };\n    } catch (error) {\n        console.error(\"Failed to remove student:\", error);\n        return { success: false, error: \"Failed to remove student\" };\n    }\n}\n"],"names":[],"mappings":";;;;;;;IA+YsB,0BAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA"}},
    {"offset": {"line": 818, "column": 0}, "map": {"version":3,"sources":["file:///home/vishnu/Documents/projects/Algo-fox/components/classroom/LiveTracking.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState, useCallback, useMemo } from \"react\";\nimport { getClassroomLiveTracking, toggleClassroomTracking } from \"@/actions/classroom\";\nimport { toast } from \"sonner\";\nimport { Play, Square, Loader2, Code, Clock, CheckCircle2, XCircle, ChevronRight, Activity, Filter, Search, BarChart3, Users } from \"lucide-react\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport Image from \"next/image\";\n\ninterface LiveTrackingProps {\n    classroomId: string;\n}\n\nexport function LiveTracking({ classroomId }: LiveTrackingProps) {\n    const [data, setData] = useState<any>(null);\n    const [isLoading, setIsLoading] = useState(true);\n    const [isToggling, setIsToggling] = useState(false);\n    const [selectedSubmission, setSelectedSubmission] = useState<any>(null);\n\n    // Filters\n    const [searchTerm, setSearchTerm] = useState(\"\");\n    const [minSubmissions, setMinSubmissions] = useState(0);\n\n    const fetchTrackingData = useCallback(async () => {\n        const res = await getClassroomLiveTracking(classroomId);\n        if (res.success) {\n            setData(res);\n        }\n        setIsLoading(false);\n    }, [classroomId]);\n\n    useEffect(() => {\n        fetchTrackingData();\n        const interval = setInterval(fetchTrackingData, 2000);\n        return () => clearInterval(interval);\n    }, [fetchTrackingData]);\n\n    const handleToggle = async (active: boolean) => {\n        setIsToggling(true);\n        const res = await toggleClassroomTracking(classroomId, active);\n        if (res.success) {\n            toast.success(active ? \"Tracking session started\" : \"Tracking session ended\");\n            fetchTrackingData();\n        } else {\n            toast.error(res.error || \"Operation failed\");\n        }\n        setIsToggling(false);\n    };\n\n    // Derived Statistics & Filtered Data\n    const { stats, filteredStudents } = useMemo(() => {\n        if (!data?.students) return { stats: null, filteredStudents: [] };\n\n        let activeCount = 0;\n        let totalSubs = 0;\n        let acceptedSubs = 0;\n\n        const allStudents = data.students;\n\n        // Calculate Global Stats\n        allStudents.forEach((s: any) => {\n            if (s.submissions.length > 0) {\n                activeCount++;\n                totalSubs += s.submissions.length;\n                acceptedSubs += s.submissions.filter((sub: any) => sub.status === 'ACCEPTED').length;\n            }\n        });\n\n        const acceptanceRate = totalSubs > 0 ? Math.round((acceptedSubs / totalSubs) * 100) : 0;\n\n        // Filter Students\n        const filtered = allStudents.filter((student: any) => {\n            const matchesSearch = student.name.toLowerCase().includes(searchTerm.toLowerCase());\n            const matchesMinSubs = student.submissions.length >= minSubmissions;\n            return matchesSearch && matchesMinSubs;\n        });\n\n        return {\n            stats: {\n                activeStudents: activeCount,\n                totalSubmissions: totalSubs,\n                acceptanceRate,\n                totalStudents: allStudents.length\n            },\n            filteredStudents: filtered\n        };\n    }, [data, searchTerm, minSubmissions]);\n\n    if (isLoading && !data) {\n        return (\n            <div className=\"flex items-center justify-center p-20\">\n                <Loader2 className=\"w-8 h-8 text-orange-600 animate-spin\" />\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"space-y-8 max-w-[1600px] mx-auto\">\n            {/* Header Control Panel */}\n            <div className=\"bg-white dark:bg-[#141414] border border-gray-100 dark:border-[#262626] rounded-2xl p-6 shadow-sm\">\n                <div className=\"flex flex-col xl:flex-row xl:items-center justify-between gap-8\">\n                    <div>\n                        <div className=\"flex items-center gap-3 mb-2\">\n                             <div className={`flex items-center justify-center w-8 h-8 rounded-lg ${data?.isTrackingActive ? 'bg-orange-100 dark:bg-orange-900/20' : 'bg-gray-100 dark:bg-[#1a1a1a]'}`}>\n                                <Activity className={`w-4 h-4 ${data?.isTrackingActive ? 'text-orange-600 animate-pulse' : 'text-gray-400'}`} />\n                            </div>\n                            <span className=\"text-[10px] font-black text-gray-400 dark:text-gray-500 uppercase tracking-widest\">Live Session Hub</span>\n                        </div>\n                        <h2 className=\"text-2xl font-black text-gray-900 dark:text-white uppercase tracking-tight\">Real-Time Monitor</h2>\n                        <div className=\"flex items-center gap-2 mt-2 text-sm text-gray-500 dark:text-gray-400 font-medium\">\n                            {data?.isTrackingActive ? (\n                                <>\n                                    <span className=\"w-2 h-2 bg-emerald-500 rounded-full animate-pulse\" />\n                                    Monitoring activity since {new Date(data.trackingStartedAt).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\n                                </>\n                            ) : (\n                                <>\n                                    <span className=\"w-2 h-2 bg-gray-300 rounded-full\" />\n                                    Session inactive. Start tracking to collect data.\n                                </>\n                            )}\n                        </div>\n                    </div>\n\n                    <div className=\"flex items-center gap-4\">\n                         {/* Stats Pill */}\n                        {data?.isTrackingActive && stats && (\n                            <div className=\"hidden md:flex bg-gray-50 dark:bg-[#1a1a1a] rounded-xl p-1 gap-1\">\n                                <div className=\"px-4 py-2 bg-white dark:bg-[#262626] rounded-lg shadow-sm border border-gray-100 dark:border-transparent\">\n                                    <div className=\"text-[10px] font-black text-gray-400 uppercase tracking-wider mb-0.5\">Active</div>\n                                    <div className=\"text-lg font-black text-gray-900 dark:text-white leading-none\">{stats.activeStudents}<span className=\"text-gray-300 text-xs font-normal\">/{stats.totalStudents}</span></div>\n                                </div>\n                                <div className=\"px-4 py-2 bg-white dark:bg-[#262626] rounded-lg shadow-sm border border-gray-100 dark:border-transparent\">\n                                    <div className=\"text-[10px] font-black text-gray-400 uppercase tracking-wider mb-0.5\">Submitted</div>\n                                    <div className=\"text-lg font-black text-gray-900 dark:text-white leading-none\">{stats.totalSubmissions}</div>\n                                </div>\n                                <div className=\"px-4 py-2 bg-white dark:bg-[#262626] rounded-lg shadow-sm border border-gray-100 dark:border-transparent\">\n                                    <div className=\"text-[10px] font-black text-gray-400 uppercase tracking-wider mb-0.5\">Success Rate</div>\n                                    <div className=\"text-lg font-black text-emerald-500 leading-none\">{stats.acceptanceRate}%</div>\n                                </div>\n                            </div>\n                        )}\n\n                        <button\n                            onClick={() => handleToggle(!data?.isTrackingActive)}\n                            disabled={isToggling}\n                            className={`h-14 px-8 rounded-xl text-xs font-black uppercase tracking-widest transition-all flex items-center gap-3 shadow-lg ${\n                                data?.isTrackingActive\n                                    ? \"bg-white text-red-600 border-2 border-red-50 hover:bg-red-50 hover:border-red-100 shadow-red-100/50\"\n                                    : \"bg-orange-600 text-white hover:bg-orange-500 shadow-orange-200 dark:shadow-none border-2 border-transparent\"\n                            }`}\n                        >\n                            {isToggling ? (\n                                <Loader2 className=\"w-4 h-4 animate-spin\" />\n                            ) : (\n                                data?.isTrackingActive ? <Square className=\"w-4 h-4 fill-current\" /> : <Play className=\"w-4 h-4 fill-current\" />\n                            )}\n                            {data?.isTrackingActive ? \"Stop Session\" : \"Start Session\"}\n                        </button>\n                    </div>\n                </div>\n\n                {/* Filters Toolbar */}\n                {data?.isTrackingActive && (\n                    <div className=\"mt-8 pt-6 border-t border-gray-100 dark:border-[#262626] flex flex-col md:flex-row gap-4\">\n                        <div className=\"relative flex-1\">\n                            <Search className=\"absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400\" />\n                            <input\n                                type=\"text\"\n                                placeholder=\"Search by student name...\"\n                                value={searchTerm}\n                                onChange={(e) => setSearchTerm(e.target.value)}\n                                className=\"w-full h-12 pl-11 pr-4 bg-gray-50 dark:bg-[#1a1a1a] border-none rounded-xl text-sm font-medium focus:ring-2 focus:ring-orange-500/20 outline-none transition-all placeholder:text-gray-400 dark:text-white\"\n                            />\n                        </div>\n                        <div className=\"flex gap-4\">\n                             <div className=\"relative group\">\n                                <div className=\"absolute left-4 top-1/2 -translate-y-1/2 pointer-events-none\">\n                                    <Filter className=\"w-4 h-4 text-gray-400\" />\n                                </div>\n                                <select\n                                    value={minSubmissions}\n                                    onChange={(e) => setMinSubmissions(Number(e.target.value))}\n                                    className=\"h-12 pl-11 pr-8 bg-gray-50 dark:bg-[#1a1a1a] hover:bg-gray-100 dark:hover:bg-[#262626] rounded-xl text-sm font-bold text-gray-700 dark:text-gray-200 border-none outline-none appearance-none cursor-pointer transition-all min-w-[200px]\"\n                                >\n                                    <option value={0}>All Submissions</option>\n                                    <option value={1}>At least 1 submission</option>\n                                    <option value={3}>At least 3 submissions</option>\n                                    <option value={5}>More than 5 submissions</option>\n                                    <option value={10}>More than 10 submissions</option>\n                                </select>\n                                <div className=\"absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none\">\n                                    <ChevronRight className=\"w-3 h-3 text-gray-400 rotate-90\" />\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                )}\n            </div>\n\n            {/* Students Grid */}\n            <div className=\"grid grid-cols-1 md:grid-cols-2 2xl:grid-cols-3 gap-6\">\n                {filteredStudents.length > 0 ? (\n                    filteredStudents.map((student: any) => {\n                        const total = student.submissions.length;\n                        const accepted = student.submissions.filter((s: any) => s.status === 'ACCEPTED').length;\n                        const rate = total > 0 ? Math.round((accepted / total) * 100) : 0;\n\n                        return (\n                            <div\n                                key={student.id}\n                                className=\"bg-white dark:bg-[#141414] border border-gray-100 dark:border-[#262626] rounded-2xl overflow-hidden hover:shadow-lg dark:hover:shadow-non hover:border-orange-100 dark:hover:border-orange-900/30 transition-all duration-300 group\"\n                            >\n                                {/* Card Header */}\n                                <div className=\"p-6 pb-4 flex items-start justify-between\">\n                                    <div className=\"flex items-center gap-4\">\n                                        <div className=\"w-14 h-14 bg-gray-50 dark:bg-[#1a1a1a] rounded-xl border border-gray-100 dark:border-[#333] relative overflow-hidden\">\n                                            {student.image ? (\n                                                <Image src={student.image} alt={student.name} fill className=\"object-cover\" />\n                                            ) : (\n                                                <div className=\"w-full h-full flex items-center justify-center text-orange-600 dark:text-orange-500 font-black text-xl bg-orange-50 dark:bg-orange-900/10\">\n                                                    {student.name?.charAt(0)}\n                                                </div>\n                                            )}\n                                        </div>\n                                        <div>\n                                            <h3 className=\"font-bold text-gray-900 dark:text-white mb-1 line-clamp-1\">{student.name}</h3>\n                                            <div className=\"flex items-center gap-2\">\n                                                <span className=\"text-[10px] font-bold text-gray-400 dark:text-gray-500 uppercase tracking-widest bg-gray-100 dark:bg-[#1a1a1a] px-2 py-0.5 rounded-full\">\n                                                    #{student.id.slice(-4)}\n                                                </span>\n                                            </div>\n                                        </div>\n                                    </div>\n                                    <div className=\"text-right\">\n                                        <div className=\"text-2xl font-black text-gray-900 dark:text-white leading-none mb-1\">\n                                            {total}\n                                        </div>\n                                        <div className=\"text-[9px] font-black text-gray-400 uppercase tracking-widest\">Total Subs</div>\n                                    </div>\n                                </div>\n\n                                {/* Stats Bar */}\n                                {total > 0 && (\n                                    <div className=\"px-6 mb-4\">\n                                        <div className=\"flex items-center justify-between text-[10px] font-bold text-gray-500 mb-1.5 uppercase tracking-wide\">\n                                            <span className=\"text-emerald-600\">{accepted} Accepted</span>\n                                            <span className=\"text-red-500\">{total - accepted} Errors</span>\n                                        </div>\n                                        <div className=\"h-1.5 w-full bg-gray-100 dark:bg-[#1a1a1a] rounded-full overflow-hidden flex\">\n                                            <div className=\"h-full bg-emerald-500\" style={{ width: `${rate}%` }} />\n                                            <div className=\"h-full bg-red-400\" style={{ width: `${100 - rate}%` }} />\n                                        </div>\n                                    </div>\n                                )}\n\n                                {/* Recent Activity Feed */}\n                                <div className=\"border-t border-gray-100 dark:border-[#262626] bg-gray-50/30 dark:bg-black/20\">\n                                    <div className=\"max-h-[220px] overflow-y-auto custom-scrollbar p-2\">\n                                        {student.submissions.length > 0 ? (\n                                            student.submissions.map((sub: any) => (\n                                                <button\n                                                    key={sub.id}\n                                                    onClick={() => setSelectedSubmission({ ...sub, student })}\n                                                    className=\"w-full flex items-center justify-between p-3 rounded-lg hover:bg-white dark:hover:bg-[#1a1a1a] hover:shadow-sm transition-all group/item text-left mb-1\"\n                                                >\n                                                    <div className=\"flex items-start gap-3 min-w-0\">\n                                                        <div className={`mt-0.5 ${\n                                                            sub.status === 'ACCEPTED' ? 'text-emerald-500' :\n                                                            sub.status === 'PENDING' ? 'text-orange-500' : 'text-red-500'\n                                                        }`}>\n                                                            {sub.status === 'ACCEPTED' ? <CheckCircle2 className=\"w-4 h-4\" /> :\n                                                             sub.status === 'PENDING' ? <Loader2 className=\"w-4 h-4 animate-spin\" /> :\n                                                             <XCircle className=\"w-4 h-4\" />}\n                                                        </div>\n                                                        <div className=\"min-w-0 flex-1\">\n                                                            <div className=\"font-bold text-xs text-gray-700 dark:text-gray-300 truncate group-hover/item:text-orange-600 transition-colors\">\n                                                                {sub.problemTitle}\n                                                            </div>\n                                                            <div className=\"text-[9px] font-medium text-gray-400 mt-0.5\">\n                                                                {new Date(sub.createdAt).toLocaleTimeString()}\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                    <ChevronRight className=\"w-3 h-3 text-gray-300 opacity-0 group-hover/item:opacity-100 -translate-x-2 group-hover/item:translate-x-0 transition-all\" />\n                                                </button>\n                                            ))\n                                        ) : (\n                                            <div className=\"py-8 text-center\">\n                                                <Clock className=\"w-5 h-5 text-gray-300 dark:text-gray-700 mx-auto mb-2\" />\n                                                <span className=\"text-[10px] font-bold text-gray-400 dark:text-gray-600 uppercase tracking-widest\">No Activity Yet</span>\n                                            </div>\n                                        )}\n                                    </div>\n                                </div>\n                            </div>\n                        );\n                    })\n                ) : (\n                    <div className=\"col-span-full py-20 text-center bg-gray-50/50 dark:bg-[#141414] border-2 border-dashed border-gray-200 dark:border-[#262626] rounded-3xl\">\n                        <Users className=\"w-10 h-10 text-gray-300 dark:text-gray-600 mx-auto mb-4\" />\n                        <h3 className=\"text-lg font-bold text-gray-900 dark:text-white mb-1\">No Students Found</h3>\n                        <p className=\"text-gray-500 text-sm\">Adjust filters or search criteria to see results.</p>\n                    </div>\n                )}\n            </div>\n\n             {/* Code Preview Modal */}\n            <AnimatePresence>\n                {selectedSubmission && (\n                    <div className=\"fixed inset-0 z-[100] flex items-center justify-center p-4\">\n                        <motion.div\n                            initial={{ opacity: 0 }}\n                            animate={{ opacity: 1 }}\n                            exit={{ opacity: 0 }}\n                            onClick={() => setSelectedSubmission(null)}\n                            className=\"absolute inset-0 bg-white/80 dark:bg-black/80 backdrop-blur-sm\"\n                        />\n                        <motion.div\n                            initial={{ opacity: 0, scale: 0.95, y: 20 }}\n                            animate={{ opacity: 1, scale: 1, y: 0 }}\n                            exit={{ opacity: 0, scale: 0.95, y: 20 }}\n                            className=\"relative w-full max-w-4xl bg-white dark:bg-[#141414] rounded-2xl shadow-2xl overflow-hidden flex flex-col h-[80vh] border border-gray-100 dark:border-[#333]\"\n                        >\n                            {/* Modal Header */}\n                            <div className=\"p-6 border-b border-gray-100 dark:border-[#262626] flex items-center justify-between bg-white dark:bg-[#141414]\">\n                                <div className=\"flex items-center gap-5\">\n                                    <div className=\"w-10 h-10 bg-orange-50 dark:bg-orange-500/10 text-orange-600 dark:text-orange-500 rounded-lg flex items-center justify-center font-black text-lg\">\n                                        {selectedSubmission.student.name?.charAt(0)}\n                                    </div>\n                                    <div>\n                                        <div className=\"flex items-center gap-3\">\n                                            <h3 className=\"text-lg font-black text-gray-900 dark:text-white uppercase tracking-tight\">\n                                                {selectedSubmission.student.name}\n                                            </h3>\n                                            <span className={`px-2.5 py-1 text-[9px] font-black uppercase tracking-widest rounded-md ${\n                                                selectedSubmission.status === 'ACCEPTED' ? 'bg-emerald-50 dark:bg-emerald-500/10 text-emerald-600 dark:text-emerald-500' : 'bg-red-50 dark:bg-red-500/10 text-red-600 dark:text-red-500'\n                                            }`}>\n                                                {selectedSubmission.status}\n                                            </span>\n                                        </div>\n                                        <div className=\"text-[10px] font-bold text-gray-400 dark:text-gray-500 uppercase tracking-widest mt-0.5\">\n                                            {selectedSubmission.problemTitle}  {new Date(selectedSubmission.createdAt).toLocaleString()}\n                                        </div>\n                                    </div>\n                                </div>\n                                <button\n                                    onClick={() => setSelectedSubmission(null)}\n                                    className=\"h-8 px-4 bg-gray-900 dark:bg-white text-white dark:text-black hover:bg-orange-600 dark:hover:bg-gray-200 transition-colors uppercase text-[9px] font-black tracking-widest rounded-lg\"\n                                >\n                                    Close\n                                </button>\n                            </div>\n\n                            {/* Modal Content */}\n                            <div className=\"flex-1 overflow-auto bg-gray-50 dark:bg-[#0c0c0c] p-0\">\n                                <div className=\"p-8\">\n                                    <pre className=\"font-mono text-sm leading-relaxed whitespace-pre-wrap text-gray-800 dark:text-gray-200 bg-white dark:bg-[#141414] p-6 rounded-xl border border-gray-100 dark:border-[#262626]\">\n                                        <code>{selectedSubmission.code}</code>\n                                    </pre>\n                                </div>\n                            </div>\n                        </motion.div>\n                    </div>\n                )}\n            </AnimatePresence>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1826, "column": 0}, "map": {"version":3,"sources":["file:///home/vishnu/Documents/projects/Algo-fox/components/ui/input.tsx"],"sourcesContent":["import * as React from \"react\"\nimport { cn } from \"@/lib/utils\"\n\nexport interface InputProps\n  extends React.InputHTMLAttributes<HTMLInputElement> {}\n\nconst Input = React.forwardRef<HTMLInputElement, InputProps>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n"],"names":[],"mappings":";;;;;AAAA;AACA;;;;AAKA,MAAM,sBAAQ,mNAAgB,CAC5B,CAAC,EAAE,SAAS,EAAE,IAAI,EAAE,GAAG,OAAO,EAAE;IAC9B,qBACE,8OAAC;QACC,MAAM;QACN,WAAW,IAAA,kHAAE,EACX,yUACA;QAEF,KAAK;QACJ,GAAG,KAAK;;;;;;AAGf;AAEF,MAAM,WAAW,GAAG"}},
    {"offset": {"line": 1854, "column": 0}, "map": {"version":3,"sources":["file:///home/vishnu/Documents/projects/Algo-fox/actions/assignment.ts"],"sourcesContent":["\"use server\";\n\nimport { prisma } from \"@/lib/prisma\";\nimport { auth } from \"@/lib/auth\";\nimport { headers } from \"next/headers\";\nimport { revalidateTag, unstable_cache } from \"next/cache\";\nimport { cacheKey, cachedFetch, CACHE_CONFIG } from \"@/lib/cache-utils\";\n\n/**\n * Get all assignments for a specific classroom (CACHED with pagination)\n */\nexport async function getClassroomAssignments(\n    classroomId: string,\n    page: number = 1,\n    limit: number = 20\n) {\n    // Filter out assignments older than 3 weeks\n    const threeWeeksAgo = new Date();\n    threeWeeksAgo.setDate(threeWeeksAgo.getDate() - 21);\n    const skip = (page - 1) * limit;\n\n    const fetchAssignments = unstable_cache(\n        async () => {\n            const [assignments, total] = await Promise.all([\n                prisma.assignment.findMany({\n                    where: {\n                        classroomId,\n                        createdAt: { gte: threeWeeksAgo }\n                    },\n                    include: {\n                        _count: {\n                            select: { problems: true }\n                        }\n                    },\n                    orderBy: { createdAt: \"desc\" },\n                    skip,\n                    take: limit,\n                }),\n                prisma.assignment.count({\n                    where: {\n                        classroomId,\n                        createdAt: { gte: threeWeeksAgo }\n                    }\n                })\n            ]);\n\n            return { assignments, total };\n        },\n        [`classroom-assignments-${classroomId}-page-${page}`],\n        { tags: [`assignments-classroom-${classroomId}`, 'assignments-all'], revalidate: 60 }\n    );\n\n    const { assignments, total } = await fetchAssignments();\n\n    return {\n        assignments,\n        pagination: {\n            total,\n            pages: Math.ceil(total / limit),\n            current: page,\n            limit\n        }\n    };\n}\n\n/**\n * Get all assignments for a specific classroom (UNCACHED)\n * Use this for refetching after mutations to get fresh data\n */\nexport async function refreshClassroomAssignments(classroomId: string) {\n    const threeWeeksAgo = new Date();\n    threeWeeksAgo.setDate(threeWeeksAgo.getDate() - 21);\n\n    return await prisma.assignment.findMany({\n        where: {\n            classroomId,\n            createdAt: { gte: threeWeeksAgo }\n        },\n        include: {\n            _count: {\n                select: { problems: true }\n            }\n        },\n        orderBy: { createdAt: \"desc\" }\n    });\n}\n\n/**\n * Create a new assignment for a classroom\n */\nexport async function createAssignment(\n    classroomId: string,\n    data: {\n        title: string;\n        description?: string;\n        dueDate?: Date;\n        problemIds: string[];\n    }\n) {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n\n    if (!session?.user || session.user.role !== \"TEACHER\") {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    try {\n        // Verify teacher owns the classroom\n        const classroom = await prisma.classroom.findUnique({\n            where: { id: classroomId },\n            select: { teacherId: true }\n        });\n\n        if (!classroom || classroom.teacherId !== session.user.id) {\n            return { success: false, error: \"Unauthorized access to classroom\" };\n        }\n\n        const assignment = await prisma.assignment.create({\n            data: {\n                title: data.title,\n                description: data.description,\n                dueDate: data.dueDate,\n                classroomId,\n                problems: {\n                    create: data.problemIds.map((id, index) => ({\n                        problemId: id,\n                        order: index\n                    }))\n                }\n            }\n        });\n\n        // Revalidate classroom-specific and global assignment caches\n        revalidateTag(`assignments-classroom-${classroomId}`, \"max\");\n        revalidateTag('assignments-all', \"max\"); // Invalidate student assignments cache\n\n        return { success: true, assignmentId: assignment.id };\n    } catch (error) {\n        console.error(\"Create assignment error:\", error);\n        return { success: false, error: \"Failed to create assignment\" };\n    }\n}\n\n/**\n * Get details of a specific assignment, including problems (CACHED)\n */\nexport async function getAssignmentDetails(assignmentId: string) {\n    const fetchDetails = unstable_cache(\n        async () => {\n            return await prisma.assignment.findUnique({\n                where: { id: assignmentId },\n                include: {\n                    problems: {\n                        include: {\n                            problem: {\n                                select: {\n                                    id: true,\n                                    title: true,\n                                    slug: true,\n                                    difficulty: true,\n                                    type: true,\n                                    domain: true,\n                                }\n                            }\n                        },\n                        orderBy: { order: \"asc\" }\n                    },\n                    classroom: {\n                        select: {\n                            name: true,\n                            id: true\n                        }\n                    }\n                }\n            });\n        },\n        [`assignment-details-${assignmentId}`],\n        { tags: [`assignment-${assignmentId}`], revalidate: 3600 } // Cache for 1 hour\n    );\n\n    return await fetchDetails();\n}\n\n/**\n * Get all assignments for the current student across all enrolled classrooms (CACHED with pagination)\n */\nexport async function getStudentAssignments(page: number = 1, limit: number = 20) {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n\n    if (!session?.user) return { assignments: [], pagination: null };\n\n    // Filter out assignments older than 3 weeks\n    const threeWeeksAgo = new Date();\n    threeWeeksAgo.setDate(threeWeeksAgo.getDate() - 21);\n    const skip = (page - 1) * limit;\n    const userId = session.user.id;\n\n    const fetchStudentAssignments = unstable_cache(\n        async () => {\n            // First get enrolled classrooms\n            const user = await prisma.user.findUnique({\n                where: { id: userId },\n                select: {\n                    enrolledClassrooms: {\n                        select: { id: true }\n                    }\n                }\n            });\n\n            if (!user || user.enrolledClassrooms.length === 0) {\n                return { assignments: [], total: 0 };\n            }\n\n            const classroomIds = user.enrolledClassrooms.map(c => c.id);\n\n            // Fetch assignments for these classrooms with count\n            const [assignments, total] = await Promise.all([\n                prisma.assignment.findMany({\n                    where: {\n                        classroomId: { in: classroomIds },\n                        createdAt: { gte: threeWeeksAgo }\n                    },\n                    include: {\n                        classroom: {\n                            select: { name: true }\n                        },\n                        _count: {\n                            select: { problems: true }\n                        }\n                    },\n                    orderBy: { dueDate: \"asc\" }, // Due soonest first\n                    skip,\n                    take: limit,\n                }),\n                prisma.assignment.count({\n                    where: {\n                        classroomId: { in: classroomIds },\n                        createdAt: { gte: threeWeeksAgo }\n                    }\n                })\n            ]);\n\n            return { assignments, total };\n        },\n        [`student-assignments-${userId}-page-${page}`],\n        { tags: [`student-assignments-${userId}`, 'assignments-all'], revalidate: 60 }\n    );\n\n    const { assignments, total } = await fetchStudentAssignments();\n\n    return {\n        assignments,\n        pagination: total > 0 ? {\n            total,\n            pages: Math.ceil(total / limit),\n            current: page,\n            limit\n        } : null\n    };\n}\n\n/**\n * Check completion status of problems in an assignment for a specific user (CACHED short-term)\n */\nexport async function getAssignmentProgress(assignmentId: string, userId?: string) {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n\n    const targetUserId = userId || session?.user?.id;\n    if (!targetUserId) return null;\n\n    // Get assignment problems (cached)\n    const assignment = await getAssignmentDetails(assignmentId);\n    if (!assignment) return null;\n\n    const problemIds = assignment.problems.map(p => p.problemId);\n\n    // Use Redis cache for progress (short TTL since submissions update frequently)\n    const progressCacheKey = cacheKey(\"assignment-progress\", assignmentId, targetUserId);\n\n    const progress = await cachedFetch(\n        progressCacheKey,\n        async () => {\n            // Fetch successful submissions for these problems by the user\n            const submissions = await prisma.submission.findMany({\n                where: {\n                    userId: targetUserId,\n                    problemId: { in: problemIds },\n                    status: \"ACCEPTED\"\n                },\n                select: {\n                    problemId: true\n                },\n                distinct: [\"problemId\"]\n            });\n\n            const solvedProblemIds = new Set(submissions.map(s => s.problemId));\n\n            const progressMap: Record<string, boolean> = {};\n            let completedCount = 0;\n\n            assignment.problems.forEach(p => {\n                const isSolved = solvedProblemIds.has(p.problemId);\n                progressMap[p.problemId] = isSolved;\n                if (isSolved) completedCount++;\n            });\n\n            return {\n                total: assignment.problems.length,\n                completed: completedCount,\n                progressMap\n            };\n        },\n        CACHE_CONFIG.SHORT.ttl // 30 seconds cache\n    );\n\n    return progress;\n}\n\n/**\n * Teacher Analytics: Get progress of all students in a classroom for a specific assignment (CACHED)\n */\nexport async function getTeacherAssignmentAnalytics(\n    assignmentId: string,\n    classroomId: string,\n    page: number = 1,\n    limit: number = 50\n) {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n\n    if (!session?.user || session.user.role !== \"TEACHER\") {\n        throw new Error(\"Unauthorized\");\n    }\n\n    const skip = (page - 1) * limit;\n    const analyticsCacheKey = cacheKey(\"assignment-analytics\", assignmentId, classroomId, String(page));\n\n    const analytics = await cachedFetch(\n        analyticsCacheKey,\n        async () => {\n            // Parallel fetch for better performance\n            const [classroom, assignment, totalStudents] = await Promise.all([\n                prisma.classroom.findUnique({\n                    where: { id: classroomId },\n                    select: {\n                        students: {\n                            select: {\n                                id: true,\n                                name: true,\n                                image: true,\n                                email: true\n                            },\n                            skip,\n                            take: limit,\n                        }\n                    }\n                }),\n                prisma.assignment.findUnique({\n                    where: { id: assignmentId },\n                    include: {\n                        problems: {\n                            select: { problemId: true }\n                        }\n                    }\n                }),\n                prisma.user.count({\n                    where: {\n                        enrolledClassrooms: {\n                            some: { id: classroomId }\n                        }\n                    }\n                })\n            ]);\n\n            if (!classroom || !assignment) return null;\n\n            const studentIds = classroom.students.map(s => s.id);\n            const problemIds = assignment.problems.map(p => p.problemId);\n\n            // Get all accepted submissions in one query\n            const submissions = await prisma.submission.findMany({\n                where: {\n                    userId: { in: studentIds },\n                    problemId: { in: problemIds },\n                    status: \"ACCEPTED\"\n                },\n                select: {\n                    userId: true,\n                    problemId: true\n                }\n            });\n\n            // Build submission index for O(1) lookup\n            const submissionIndex = new Map<string, Set<string>>();\n            submissions.forEach(s => {\n                if (!submissionIndex.has(s.userId)) {\n                    submissionIndex.set(s.userId, new Set());\n                }\n                submissionIndex.get(s.userId)!.add(s.problemId);\n            });\n\n            // Build analytics\n            const studentAnalytics = classroom.students.map(student => {\n                const solvedSet = submissionIndex.get(student.id) || new Set();\n\n                return {\n                    student,\n                    completedCount: solvedSet.size,\n                    totalCount: problemIds.length,\n                    completionPercentage: problemIds.length > 0\n                        ? (solvedSet.size / problemIds.length) * 100\n                        : 0,\n                    hasCompletedAll: solvedSet.size === problemIds.length\n                };\n            });\n\n            return {\n                analytics: studentAnalytics,\n                pagination: {\n                    total: totalStudents,\n                    pages: Math.ceil(totalStudents / limit),\n                    current: page,\n                    limit\n                }\n            };\n        },\n        CACHE_CONFIG.MEDIUM.ttl // 2 minutes cache\n    );\n\n    return analytics;\n}\n\n/**\n * Delete an assignment\n */\nexport async function deleteAssignment(assignmentId: string) {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n\n    if (!session?.user || session.user.role !== \"TEACHER\") {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    try {\n        const assignment = await prisma.assignment.findUnique({\n            where: { id: assignmentId },\n            include: {\n                classroom: {\n                    select: { teacherId: true, id: true }\n                }\n            }\n        });\n\n        if (!assignment || assignment.classroom.teacherId !== session.user.id) {\n            return { success: false, error: \"Unauthorized\" };\n        }\n\n        // Delete assignment problems first, then assignment\n        await prisma.$transaction([\n            prisma.assignmentProblem.deleteMany({\n                where: { assignmentId }\n            }),\n            prisma.assignment.delete({\n                where: { id: assignmentId }\n            })\n        ]);\n\n        // Invalidate caches\n        revalidateTag(`assignment-${assignmentId}`, \"max\");\n        revalidateTag(`assignments-classroom-${assignment.classroom.id}`, \"max\");\n        revalidateTag('assignments-all', \"max\");\n\n        return { success: true };\n    } catch (error) {\n        console.error(\"Delete assignment error:\", error);\n        return { success: false, error: \"Failed to delete assignment\" };\n    }\n}\n"],"names":[],"mappings":";;;;;;;IA0FsB,mBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA"}},
    {"offset": {"line": 1866, "column": 0}, "map": {"version":3,"sources":["file:///home/vishnu/Documents/projects/Algo-fox/actions/problems.ts"],"sourcesContent":["\"use server\";\n\nimport { ProblemService } from \"@/core/services/problem.service\";\nimport { Difficulty, ProblemType, ProblemDomain } from \"@prisma/client\";\nimport { headers } from \"next/headers\";\nimport { auth } from \"@/lib/auth\";\nimport { revalidatePath, updateTag, cacheTag, cacheLife } from \"next/cache\";\n\n// GETTING PUBLIC PROBLEMS\n\nexport async function getProblems(\n    page: number = 1,\n    pageSize: number = 10,\n    type: ProblemType = \"PRACTICE\",\n    domain: ProblemDomain = \"DSA\",\n    difficulty?: Difficulty,\n    tags?: string[],\n    cursor?: string\n) {\n    \"use cache: private\"; // Must be at top - allows headers() inside\n    cacheLife({ stale: 900, revalidate: 900 }); // 15 minutes default\n\n    // CHECKING IF USER IS AUTHENTICATED\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n    const userId = session?.user?.id;\n\n    const tagKey = `problems-${domain}-${type}${difficulty ? `-${difficulty}` : ''}${tags && tags.length > 0 ? `-${tags.join('-')}` : ''}${cursor ? `-cursor-${cursor}` : `-page-${page}`}${userId ? `-user-${userId}` : ''}`;\n    cacheTag(tagKey, 'problems-list', `problems-${domain}-${type}`);\n\n    return ProblemService.getProblems(page, pageSize, type, domain, userId, difficulty, tags || [], cursor);\n}\n\n// GETTING ADMIN PROBLEMS\n\nexport async function getAdminProblems(\n    page: number = 1,\n    pageSize: number = 50,\n    domain?: ProblemDomain,\n    excludeDifficulty?: Difficulty,\n    type?: ProblemType\n) {\n    \"use cache: private\"; // Must be at top - allows headers() inside\n    cacheLife({ stale: 900, revalidate: 900 }); // 15 minutes default\n\n    // CHECKING IF USER IS AUTHENTICATED\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n\n    if (!session || session.user.role !== \"ADMIN\") {\n        throw new Error(\"Unauthorized\");\n    }\n\n    const tagKey = `admin-problems-${domain || 'all'}${excludeDifficulty ? `-exclude-${excludeDifficulty}` : ''}${type ? `-type-${type}` : ''}-page-${page}`;\n    cacheTag(tagKey, 'admin-problems-list');\n\n    return ProblemService.getAdminProblems(page, pageSize, domain, excludeDifficulty, type);\n}\n\n// SEARCHING FOR PROBLEMS\n\nexport async function searchProblems(\n    term: string,\n    type: ProblemType = \"PRACTICE\",\n    domain: ProblemDomain = \"DSA\"\n) {\n    \"use cache: private\"; // Must be at top - allows headers() inside\n    cacheLife({ stale: 300, revalidate: 300 }); // 5 minutes for search results\n\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n    const userId = session?.user?.id;\n\n    const tagKey = `search-${domain}-${type}-${term.toLowerCase().slice(0, 20)}${userId ? `-user-${userId}` : ''}`;\n    cacheTag(tagKey, 'problems-search');\n\n    return ProblemService.searchProblems(term, type, domain, userId);\n}\n\n// GETTING A PROBLEM BY SLUG CACHED\n\nexport async function getProblem(slug: string) {\n    \"use cache\";\n    cacheLife({ stale: 900, revalidate: 900 }); // 15 minutes default\n\n    cacheTag(`problem-${slug}`, 'problems-list');\n\n    return ProblemService.getProblem(slug);\n}\n\n\n// CREATING A PROBLEM --> ADMIN ONLY\n\nexport async function createProblem(data: {\n    title: string;\n    description: string;\n    difficulty: Difficulty;\n    slug: string;\n    hidden: boolean;\n    hiddenQuery?: string | null;\n    domain?: ProblemDomain;\n    testCases: { input: string; output: string; hidden?: boolean }[];\n    tags?: string[];\n    useFunctionTemplate?: boolean;\n    functionTemplates?: { languageId: number; functionTemplate: string; driverCode: string }[];\n    solution?: string | null;\n}) {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n\n    if (!session || session.user.role !== \"ADMIN\") {\n        throw new Error(\"Unauthorized\");\n    }\n\n    const result = await ProblemService.createProblem(data);\n\n    if (result.success) {\n        revalidatePath(\"/problems\");\n        revalidatePath(\"/problems/dsa\");\n        revalidatePath(\"/problems/sql\");\n        revalidatePath(\"/admin/problems\");\n        revalidatePath(\"/admin/dsa/problems\");\n        revalidatePath(\"/admin/sql/problems\");\n\n        updateTag('admin-problems-list');\n        updateTag('problems-list');\n        updateTag('problems-SQL-PRACTICE');\n        updateTag('problems-DSA-PRACTICE');\n    }\n\n    return result;\n}\n\n\n// GETTING A PROBLEM BY ID\nexport async function getProblemById(id: string) {\n    \"use cache\";\n    cacheLife({ stale: 900, revalidate: 900 }); // 15 minutes default\n\n    cacheTag(`problem-id-${id}`, 'problems-list');\n\n    return ProblemService.getProblemById(id);\n}\n\n// NAVIGATION ACTIONS\n\nexport async function getNextProblem(currentCreatedAt: Date, domain: ProblemDomain, type: ProblemType) {\n    \"use cache: private\";\n    cacheLife({ stale: 300, revalidate: 300 });\n    return ProblemService.getNextProblem(currentCreatedAt, domain, type);\n}\n\nexport async function getPreviousProblem(currentCreatedAt: Date, domain: ProblemDomain, type: ProblemType) {\n    \"use cache: private\";\n    cacheLife({ stale: 300, revalidate: 300 });\n    return ProblemService.getPreviousProblem(currentCreatedAt, domain, type);\n}\n\nexport async function getRandomProblem(domain: ProblemDomain, type: ProblemType) {\n    // No cache for random\n    return ProblemService.getRandomProblem(domain, type);\n}\n\n\n// UPDATING A PROBLEM --> ADMIN ONLY\nexport async function updateProblem(id: string, data: any) {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n\n    // CHECKING IF USER IS ADMIN --> THROWING AN ERROR IF NOT ADMIN\n\n    if (!session || session.user.role !== \"ADMIN\") {\n        throw new Error(\"Unauthorized\");\n    }\n\n    const result = await ProblemService.updateProblem(id, data);\n\n    if (result.success) {\n        revalidatePath(\"/problems\");\n        revalidatePath(\"/problems/dsa\");\n        revalidatePath(\"/problems/sql\");\n        revalidatePath(`/admin/problems`);\n        revalidatePath(\"/admin/dsa/problems\");\n        revalidatePath(\"/admin/sql/problems\");\n\n        updateTag('admin-problems-list');\n        updateTag('problems-list');\n        updateTag(`problems-${result.data?.domain || 'DSA'}-${result.data?.type || 'PRACTICE'}`);\n        updateTag(`problem-${result.data?.slug}`);\n    }\n\n    return result;\n}\n\n\n// DELETING A PROBLEM --> ADMIN ONLY\nexport async function deleteProblem(id: string) {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n\n    // CHECKING IF USER IS ADMIN --> THROWING AN ERROR IF NOT ADMIN\n\n    if (!session || session.user.role !== \"ADMIN\") {\n        throw new Error(\"Unauthorized\");\n    }\n\n    const result = await ProblemService.deleteProblem(id);\n\n    if (result.success) {\n        revalidatePath(\"/problems\");\n        revalidatePath(\"/problems/dsa\");\n        revalidatePath(\"/problems/sql\");\n        revalidatePath(`/admin/problems`);\n        revalidatePath(\"/admin/dsa/problems\");\n        revalidatePath(\"/admin/sql/problems\");\n\n        updateTag('admin-problems-list');\n        updateTag('problems-list');\n    }\n\n    return result;\n}\n"],"names":[],"mappings":";;;;;;;IA+DsB,iBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA"}},
    {"offset": {"line": 1878, "column": 0}, "map": {"version":3,"sources":["file:///home/vishnu/Documents/projects/Algo-fox/components/classroom/assignments/CreateAssignmentModal.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState } from \"react\";\nimport { useRouter } from \"next/navigation\";\nimport { Dialog, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { CalendarIcon, Loader2, Search, X, Plus } from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport { createAssignment } from \"@/actions/assignment\";\nimport { searchProblems } from \"@/actions/problems\";\n\ninterface CreateAssignmentModalProps {\n    isOpen: boolean;\n    onClose: () => void;\n    classroomId: string;\n    onSuccess: () => void;\n}\n\nexport function CreateAssignmentModal({ isOpen, onClose, classroomId, onSuccess }: CreateAssignmentModalProps) {\n    const router = useRouter();\n    const [title, setTitle] = useState(\"\");\n    const [description, setDescription] = useState(\"\");\n    const [dueDate, setDueDate] = useState(\"\");\n    const [isSubmitting, setIsSubmitting] = useState(false);\n\n    // Problem Selection\n    const [searchQuery, setSearchQuery] = useState(\"\");\n    const [searchResults, setSearchResults] = useState<any[]>([]);\n    const [isSearching, setIsSearching] = useState(false);\n    const [selectedProblems, setSelectedProblems] = useState<any[]>([]);\n\n    const handleSearch = async (term: string) => {\n        setSearchQuery(term);\n        if (term.length < 2) {\n            setSearchResults([]);\n            return;\n        }\n\n        setIsSearching(true);\n        try {\n            const results = await searchProblems(term);\n            const problems = results.problems || [];\n\n            // Filter out already selected\n            const selectedIds = new Set(selectedProblems.map(p => p.id));\n            setSearchResults(problems.filter((p: any) => !selectedIds.has(p.id)));\n        } catch (error) {\n            console.error(\"Search failed\", error);\n        } finally {\n            setIsSearching(false);\n        }\n    };\n\n    const addProblem = (problem: any) => {\n        if (selectedProblems.some(p => p.id === problem.id)) return;\n        setSelectedProblems([...selectedProblems, problem]);\n        setSearchResults(searchResults.filter(p => p.id !== problem.id));\n        setSearchQuery(\"\");\n    };\n\n    const removeProblem = (problemId: string) => {\n        setSelectedProblems(selectedProblems.filter(p => p.id !== problemId));\n    };\n\n    const handleSubmit = async () => {\n        if (!title.trim()) return toast.error(\"Title is required\");\n        if (selectedProblems.length === 0) return toast.error(\"Select at least one problem\");\n\n        setIsSubmitting(true);\n        try {\n            const res = await createAssignment(classroomId, {\n                title,\n                description,\n                dueDate: dueDate ? new Date(dueDate) : undefined,\n                problemIds: selectedProblems.map(p => p.id)\n            });\n\n            if (res.success) {\n                toast.success(\"Assignment created!\");\n                // Reset form\n                setTitle(\"\");\n                setDescription(\"\");\n                setDueDate(\"\");\n                setSelectedProblems([]);\n                router.refresh(); // Force refresh to update cache\n                onSuccess();\n            } else {\n                toast.error(res.error || \"Failed to create assignment\");\n            }\n        } catch (error) {\n            toast.error(\"Something went wrong\");\n        } finally {\n            setIsSubmitting(false);\n        }\n    };\n\n    return (\n        <Dialog open={isOpen} onOpenChange={(open) => !open && onClose()}>\n            <div className=\"max-w-3xl max-h-[80vh] overflow-y-auto\">\n                <DialogHeader>\n                    <DialogTitle>Create Assignment</DialogTitle>\n                </DialogHeader>\n\n                <div className=\"space-y-6 py-4\">\n                    {/* Basic Info */}\n                    <div className=\"grid grid-cols-2 gap-4\">\n                        <div className=\"space-y-2 col-span-2\">\n                            <label className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">Assignment Title</label>\n                            <Input\n                                value={title}\n                                onChange={(e) => setTitle(e.target.value)}\n                                placeholder=\"e.g. Week 1: Array Basics\"\n                            />\n                        </div>\n\n                        <div className=\"space-y-2 col-span-2\">\n                            <label className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">Description (Optional)</label>\n                            <textarea\n                                value={description}\n                                onChange={(e) => setDescription(e.target.value)}\n                                placeholder=\"Instructions for students...\"\n                                className=\"flex min-h-[80px] w-full rounded-md border border-gray-200 dark:border-[#333] bg-white dark:bg-[#1a1a1a] px-3 py-2 text-sm ring-offset-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-orange-500 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\"\n                            />\n                        </div>\n\n                        <div className=\"space-y-2 col-span-2\">\n                            <label className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">Due Date & Time (Optional)</label>\n                            <div className=\"relative\">\n                                <CalendarIcon className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400\" />\n                                <input\n                                    type=\"datetime-local\"\n                                    value={dueDate}\n                                    onChange={(e) => setDueDate(e.target.value)}\n                                    className=\"flex h-10 w-full rounded-md border border-gray-200 dark:border-[#333] bg-white dark:bg-[#1a1a1a] pl-10 pr-3 py-2 text-sm ring-offset-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-orange-500\"\n                                />\n                            </div>\n                        </div>\n                    </div>\n\n                    {/* Problem Selection */}\n                    <div className=\"space-y-4\">\n                        <label className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">Problems ({selectedProblems.length})</label>\n\n                        <div className=\"relative\">\n                            <Search className=\"absolute left-3 top-3 h-4 w-4 text-gray-400\" />\n                            <Input\n                                value={searchQuery}\n                                onChange={(e) => handleSearch(e.target.value)}\n                                placeholder=\"Search for problems to add...\"\n                                className=\"pl-9\"\n                            />\n                            {isSearching && (\n                                <div className=\"absolute right-3 top-3\">\n                                    <Loader2 className=\"h-4 w-4 animate-spin text-gray-400\" />\n                                </div>\n                            )}\n\n                            {/* Search Results Dropdown */}\n                            {searchResults.length > 0 && (\n                                <div className=\"absolute z-10 w-full mt-1 bg-white dark:bg-[#1a1a1a] border border-gray-200 dark:border-[#333] rounded-lg shadow-lg max-h-60 overflow-y-auto\">\n                                    {searchResults.map(problem => (\n                                        <button\n                                            key={problem.id}\n                                            onClick={() => addProblem(problem)}\n                                            className=\"w-full text-left px-4 py-2 hover:bg-gray-50 dark:hover:bg-[#262626] flex items-center justify-between group\"\n                                        >\n                                            <div>\n                                                <div className=\"text-sm font-medium text-gray-900 dark:text-gray-100\">{problem.title}</div>\n                                                <div className=\"text-xs text-gray-500\">{problem.difficulty}  {problem.domain}</div>\n                                            </div>\n                                            <Plus className=\"w-4 h-4 text-gray-400 group-hover:text-orange-500\" />\n                                        </button>\n                                    ))}\n                                </div>\n                            )}\n                        </div>\n\n                        {/* Selected Problems List */}\n                        {selectedProblems.length > 0 ? (\n                            <div className=\"space-y-2 max-h-60 overflow-y-auto pr-2\">\n                                {selectedProblems.map((problem, index) => (\n                                    <div\n                                        key={problem.id}\n                                        className=\"flex items-center gap-3 p-3 bg-gray-50 dark:bg-[#1f1f1f] rounded-lg border border-gray-100 dark:border-[#333] group\"\n                                    >\n                                        <div className=\"text-xs font-bold text-gray-400 w-6\">#{index + 1}</div>\n                                        <div className=\"flex-1\">\n                                            <div className=\"text-sm font-bold text-gray-900 dark:text-gray-100\">{problem.title}</div>\n                                            <div className=\"flex items-center gap-2 mt-0.5\">\n                                                <span className={`text-[10px] px-1.5 py-0.5 rounded font-bold uppercase ${\n                                                    problem.difficulty === \"EASY\" ? \"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400\" :\n                                                    problem.difficulty === \"MEDIUM\" ? \"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400\" :\n                                                    \"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400\"\n                                                }`}>\n                                                    {problem.difficulty}\n                                                </span>\n                                                <span className=\"text-[10px] text-gray-500\">{problem.domain}</span>\n                                            </div>\n                                        </div>\n                                        <button\n                                            onClick={() => removeProblem(problem.id)}\n                                            className=\"p-1.5 text-gray-400 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition-colors\"\n                                        >\n                                            <X className=\"w-4 h-4\" />\n                                        </button>\n                                    </div>\n                                ))}\n                            </div>\n                        ) : (\n                            <div className=\"text-center py-8 border-2 border-dashed border-gray-200 dark:border-[#262626] rounded-xl text-gray-500 text-sm\">\n                                No problems selected yet\n                            </div>\n                        )}\n                    </div>\n                </div>\n\n                <DialogFooter>\n                    <Button variant=\"outline\" onClick={onClose} disabled={isSubmitting}>Cancel</Button>\n                    <Button onClick={handleSubmit} disabled={isSubmitting || selectedProblems.length === 0} className=\"bg-orange-600 hover:bg-orange-700 text-white\">\n                        {isSubmitting && <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />}\n                        Create Assignment\n                    </Button>\n                </DialogFooter>\n            </div>\n        </Dialog>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2368, "column": 0}, "map": {"version":3,"sources":["file:///home/vishnu/Documents/projects/Algo-fox/actions/assignment.ts"],"sourcesContent":["\"use server\";\n\nimport { prisma } from \"@/lib/prisma\";\nimport { auth } from \"@/lib/auth\";\nimport { headers } from \"next/headers\";\nimport { revalidateTag, unstable_cache } from \"next/cache\";\nimport { cacheKey, cachedFetch, CACHE_CONFIG } from \"@/lib/cache-utils\";\n\n/**\n * Get all assignments for a specific classroom (CACHED with pagination)\n */\nexport async function getClassroomAssignments(\n    classroomId: string,\n    page: number = 1,\n    limit: number = 20\n) {\n    // Filter out assignments older than 3 weeks\n    const threeWeeksAgo = new Date();\n    threeWeeksAgo.setDate(threeWeeksAgo.getDate() - 21);\n    const skip = (page - 1) * limit;\n\n    const fetchAssignments = unstable_cache(\n        async () => {\n            const [assignments, total] = await Promise.all([\n                prisma.assignment.findMany({\n                    where: {\n                        classroomId,\n                        createdAt: { gte: threeWeeksAgo }\n                    },\n                    include: {\n                        _count: {\n                            select: { problems: true }\n                        }\n                    },\n                    orderBy: { createdAt: \"desc\" },\n                    skip,\n                    take: limit,\n                }),\n                prisma.assignment.count({\n                    where: {\n                        classroomId,\n                        createdAt: { gte: threeWeeksAgo }\n                    }\n                })\n            ]);\n\n            return { assignments, total };\n        },\n        [`classroom-assignments-${classroomId}-page-${page}`],\n        { tags: [`assignments-classroom-${classroomId}`, 'assignments-all'], revalidate: 60 }\n    );\n\n    const { assignments, total } = await fetchAssignments();\n\n    return {\n        assignments,\n        pagination: {\n            total,\n            pages: Math.ceil(total / limit),\n            current: page,\n            limit\n        }\n    };\n}\n\n/**\n * Get all assignments for a specific classroom (UNCACHED)\n * Use this for refetching after mutations to get fresh data\n */\nexport async function refreshClassroomAssignments(classroomId: string) {\n    const threeWeeksAgo = new Date();\n    threeWeeksAgo.setDate(threeWeeksAgo.getDate() - 21);\n\n    return await prisma.assignment.findMany({\n        where: {\n            classroomId,\n            createdAt: { gte: threeWeeksAgo }\n        },\n        include: {\n            _count: {\n                select: { problems: true }\n            }\n        },\n        orderBy: { createdAt: \"desc\" }\n    });\n}\n\n/**\n * Create a new assignment for a classroom\n */\nexport async function createAssignment(\n    classroomId: string,\n    data: {\n        title: string;\n        description?: string;\n        dueDate?: Date;\n        problemIds: string[];\n    }\n) {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n\n    if (!session?.user || session.user.role !== \"TEACHER\") {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    try {\n        // Verify teacher owns the classroom\n        const classroom = await prisma.classroom.findUnique({\n            where: { id: classroomId },\n            select: { teacherId: true }\n        });\n\n        if (!classroom || classroom.teacherId !== session.user.id) {\n            return { success: false, error: \"Unauthorized access to classroom\" };\n        }\n\n        const assignment = await prisma.assignment.create({\n            data: {\n                title: data.title,\n                description: data.description,\n                dueDate: data.dueDate,\n                classroomId,\n                problems: {\n                    create: data.problemIds.map((id, index) => ({\n                        problemId: id,\n                        order: index\n                    }))\n                }\n            }\n        });\n\n        // Revalidate classroom-specific and global assignment caches\n        revalidateTag(`assignments-classroom-${classroomId}`, \"max\");\n        revalidateTag('assignments-all', \"max\"); // Invalidate student assignments cache\n\n        return { success: true, assignmentId: assignment.id };\n    } catch (error) {\n        console.error(\"Create assignment error:\", error);\n        return { success: false, error: \"Failed to create assignment\" };\n    }\n}\n\n/**\n * Get details of a specific assignment, including problems (CACHED)\n */\nexport async function getAssignmentDetails(assignmentId: string) {\n    const fetchDetails = unstable_cache(\n        async () => {\n            return await prisma.assignment.findUnique({\n                where: { id: assignmentId },\n                include: {\n                    problems: {\n                        include: {\n                            problem: {\n                                select: {\n                                    id: true,\n                                    title: true,\n                                    slug: true,\n                                    difficulty: true,\n                                    type: true,\n                                    domain: true,\n                                }\n                            }\n                        },\n                        orderBy: { order: \"asc\" }\n                    },\n                    classroom: {\n                        select: {\n                            name: true,\n                            id: true\n                        }\n                    }\n                }\n            });\n        },\n        [`assignment-details-${assignmentId}`],\n        { tags: [`assignment-${assignmentId}`], revalidate: 3600 } // Cache for 1 hour\n    );\n\n    return await fetchDetails();\n}\n\n/**\n * Get all assignments for the current student across all enrolled classrooms (CACHED with pagination)\n */\nexport async function getStudentAssignments(page: number = 1, limit: number = 20) {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n\n    if (!session?.user) return { assignments: [], pagination: null };\n\n    // Filter out assignments older than 3 weeks\n    const threeWeeksAgo = new Date();\n    threeWeeksAgo.setDate(threeWeeksAgo.getDate() - 21);\n    const skip = (page - 1) * limit;\n    const userId = session.user.id;\n\n    const fetchStudentAssignments = unstable_cache(\n        async () => {\n            // First get enrolled classrooms\n            const user = await prisma.user.findUnique({\n                where: { id: userId },\n                select: {\n                    enrolledClassrooms: {\n                        select: { id: true }\n                    }\n                }\n            });\n\n            if (!user || user.enrolledClassrooms.length === 0) {\n                return { assignments: [], total: 0 };\n            }\n\n            const classroomIds = user.enrolledClassrooms.map(c => c.id);\n\n            // Fetch assignments for these classrooms with count\n            const [assignments, total] = await Promise.all([\n                prisma.assignment.findMany({\n                    where: {\n                        classroomId: { in: classroomIds },\n                        createdAt: { gte: threeWeeksAgo }\n                    },\n                    include: {\n                        classroom: {\n                            select: { name: true }\n                        },\n                        _count: {\n                            select: { problems: true }\n                        }\n                    },\n                    orderBy: { dueDate: \"asc\" }, // Due soonest first\n                    skip,\n                    take: limit,\n                }),\n                prisma.assignment.count({\n                    where: {\n                        classroomId: { in: classroomIds },\n                        createdAt: { gte: threeWeeksAgo }\n                    }\n                })\n            ]);\n\n            return { assignments, total };\n        },\n        [`student-assignments-${userId}-page-${page}`],\n        { tags: [`student-assignments-${userId}`, 'assignments-all'], revalidate: 60 }\n    );\n\n    const { assignments, total } = await fetchStudentAssignments();\n\n    return {\n        assignments,\n        pagination: total > 0 ? {\n            total,\n            pages: Math.ceil(total / limit),\n            current: page,\n            limit\n        } : null\n    };\n}\n\n/**\n * Check completion status of problems in an assignment for a specific user (CACHED short-term)\n */\nexport async function getAssignmentProgress(assignmentId: string, userId?: string) {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n\n    const targetUserId = userId || session?.user?.id;\n    if (!targetUserId) return null;\n\n    // Get assignment problems (cached)\n    const assignment = await getAssignmentDetails(assignmentId);\n    if (!assignment) return null;\n\n    const problemIds = assignment.problems.map(p => p.problemId);\n\n    // Use Redis cache for progress (short TTL since submissions update frequently)\n    const progressCacheKey = cacheKey(\"assignment-progress\", assignmentId, targetUserId);\n\n    const progress = await cachedFetch(\n        progressCacheKey,\n        async () => {\n            // Fetch successful submissions for these problems by the user\n            const submissions = await prisma.submission.findMany({\n                where: {\n                    userId: targetUserId,\n                    problemId: { in: problemIds },\n                    status: \"ACCEPTED\"\n                },\n                select: {\n                    problemId: true\n                },\n                distinct: [\"problemId\"]\n            });\n\n            const solvedProblemIds = new Set(submissions.map(s => s.problemId));\n\n            const progressMap: Record<string, boolean> = {};\n            let completedCount = 0;\n\n            assignment.problems.forEach(p => {\n                const isSolved = solvedProblemIds.has(p.problemId);\n                progressMap[p.problemId] = isSolved;\n                if (isSolved) completedCount++;\n            });\n\n            return {\n                total: assignment.problems.length,\n                completed: completedCount,\n                progressMap\n            };\n        },\n        CACHE_CONFIG.SHORT.ttl // 30 seconds cache\n    );\n\n    return progress;\n}\n\n/**\n * Teacher Analytics: Get progress of all students in a classroom for a specific assignment (CACHED)\n */\nexport async function getTeacherAssignmentAnalytics(\n    assignmentId: string,\n    classroomId: string,\n    page: number = 1,\n    limit: number = 50\n) {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n\n    if (!session?.user || session.user.role !== \"TEACHER\") {\n        throw new Error(\"Unauthorized\");\n    }\n\n    const skip = (page - 1) * limit;\n    const analyticsCacheKey = cacheKey(\"assignment-analytics\", assignmentId, classroomId, String(page));\n\n    const analytics = await cachedFetch(\n        analyticsCacheKey,\n        async () => {\n            // Parallel fetch for better performance\n            const [classroom, assignment, totalStudents] = await Promise.all([\n                prisma.classroom.findUnique({\n                    where: { id: classroomId },\n                    select: {\n                        students: {\n                            select: {\n                                id: true,\n                                name: true,\n                                image: true,\n                                email: true\n                            },\n                            skip,\n                            take: limit,\n                        }\n                    }\n                }),\n                prisma.assignment.findUnique({\n                    where: { id: assignmentId },\n                    include: {\n                        problems: {\n                            select: { problemId: true }\n                        }\n                    }\n                }),\n                prisma.user.count({\n                    where: {\n                        enrolledClassrooms: {\n                            some: { id: classroomId }\n                        }\n                    }\n                })\n            ]);\n\n            if (!classroom || !assignment) return null;\n\n            const studentIds = classroom.students.map(s => s.id);\n            const problemIds = assignment.problems.map(p => p.problemId);\n\n            // Get all accepted submissions in one query\n            const submissions = await prisma.submission.findMany({\n                where: {\n                    userId: { in: studentIds },\n                    problemId: { in: problemIds },\n                    status: \"ACCEPTED\"\n                },\n                select: {\n                    userId: true,\n                    problemId: true\n                }\n            });\n\n            // Build submission index for O(1) lookup\n            const submissionIndex = new Map<string, Set<string>>();\n            submissions.forEach(s => {\n                if (!submissionIndex.has(s.userId)) {\n                    submissionIndex.set(s.userId, new Set());\n                }\n                submissionIndex.get(s.userId)!.add(s.problemId);\n            });\n\n            // Build analytics\n            const studentAnalytics = classroom.students.map(student => {\n                const solvedSet = submissionIndex.get(student.id) || new Set();\n\n                return {\n                    student,\n                    completedCount: solvedSet.size,\n                    totalCount: problemIds.length,\n                    completionPercentage: problemIds.length > 0\n                        ? (solvedSet.size / problemIds.length) * 100\n                        : 0,\n                    hasCompletedAll: solvedSet.size === problemIds.length\n                };\n            });\n\n            return {\n                analytics: studentAnalytics,\n                pagination: {\n                    total: totalStudents,\n                    pages: Math.ceil(totalStudents / limit),\n                    current: page,\n                    limit\n                }\n            };\n        },\n        CACHE_CONFIG.MEDIUM.ttl // 2 minutes cache\n    );\n\n    return analytics;\n}\n\n/**\n * Delete an assignment\n */\nexport async function deleteAssignment(assignmentId: string) {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n\n    if (!session?.user || session.user.role !== \"TEACHER\") {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    try {\n        const assignment = await prisma.assignment.findUnique({\n            where: { id: assignmentId },\n            include: {\n                classroom: {\n                    select: { teacherId: true, id: true }\n                }\n            }\n        });\n\n        if (!assignment || assignment.classroom.teacherId !== session.user.id) {\n            return { success: false, error: \"Unauthorized\" };\n        }\n\n        // Delete assignment problems first, then assignment\n        await prisma.$transaction([\n            prisma.assignmentProblem.deleteMany({\n                where: { assignmentId }\n            }),\n            prisma.assignment.delete({\n                where: { id: assignmentId }\n            })\n        ]);\n\n        // Invalidate caches\n        revalidateTag(`assignment-${assignmentId}`, \"max\");\n        revalidateTag(`assignments-classroom-${assignment.classroom.id}`, \"max\");\n        revalidateTag('assignments-all', \"max\");\n\n        return { success: true };\n    } catch (error) {\n        console.error(\"Delete assignment error:\", error);\n        return { success: false, error: \"Failed to delete assignment\" };\n    }\n}\n"],"names":[],"mappings":";;;;;;;IAWsB,0BAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA"}},
    {"offset": {"line": 2380, "column": 0}, "map": {"version":3,"sources":["file:///home/vishnu/Documents/projects/Algo-fox/actions/assignment.ts"],"sourcesContent":["\"use server\";\n\nimport { prisma } from \"@/lib/prisma\";\nimport { auth } from \"@/lib/auth\";\nimport { headers } from \"next/headers\";\nimport { revalidateTag, unstable_cache } from \"next/cache\";\nimport { cacheKey, cachedFetch, CACHE_CONFIG } from \"@/lib/cache-utils\";\n\n/**\n * Get all assignments for a specific classroom (CACHED with pagination)\n */\nexport async function getClassroomAssignments(\n    classroomId: string,\n    page: number = 1,\n    limit: number = 20\n) {\n    // Filter out assignments older than 3 weeks\n    const threeWeeksAgo = new Date();\n    threeWeeksAgo.setDate(threeWeeksAgo.getDate() - 21);\n    const skip = (page - 1) * limit;\n\n    const fetchAssignments = unstable_cache(\n        async () => {\n            const [assignments, total] = await Promise.all([\n                prisma.assignment.findMany({\n                    where: {\n                        classroomId,\n                        createdAt: { gte: threeWeeksAgo }\n                    },\n                    include: {\n                        _count: {\n                            select: { problems: true }\n                        }\n                    },\n                    orderBy: { createdAt: \"desc\" },\n                    skip,\n                    take: limit,\n                }),\n                prisma.assignment.count({\n                    where: {\n                        classroomId,\n                        createdAt: { gte: threeWeeksAgo }\n                    }\n                })\n            ]);\n\n            return { assignments, total };\n        },\n        [`classroom-assignments-${classroomId}-page-${page}`],\n        { tags: [`assignments-classroom-${classroomId}`, 'assignments-all'], revalidate: 60 }\n    );\n\n    const { assignments, total } = await fetchAssignments();\n\n    return {\n        assignments,\n        pagination: {\n            total,\n            pages: Math.ceil(total / limit),\n            current: page,\n            limit\n        }\n    };\n}\n\n/**\n * Get all assignments for a specific classroom (UNCACHED)\n * Use this for refetching after mutations to get fresh data\n */\nexport async function refreshClassroomAssignments(classroomId: string) {\n    const threeWeeksAgo = new Date();\n    threeWeeksAgo.setDate(threeWeeksAgo.getDate() - 21);\n\n    return await prisma.assignment.findMany({\n        where: {\n            classroomId,\n            createdAt: { gte: threeWeeksAgo }\n        },\n        include: {\n            _count: {\n                select: { problems: true }\n            }\n        },\n        orderBy: { createdAt: \"desc\" }\n    });\n}\n\n/**\n * Create a new assignment for a classroom\n */\nexport async function createAssignment(\n    classroomId: string,\n    data: {\n        title: string;\n        description?: string;\n        dueDate?: Date;\n        problemIds: string[];\n    }\n) {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n\n    if (!session?.user || session.user.role !== \"TEACHER\") {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    try {\n        // Verify teacher owns the classroom\n        const classroom = await prisma.classroom.findUnique({\n            where: { id: classroomId },\n            select: { teacherId: true }\n        });\n\n        if (!classroom || classroom.teacherId !== session.user.id) {\n            return { success: false, error: \"Unauthorized access to classroom\" };\n        }\n\n        const assignment = await prisma.assignment.create({\n            data: {\n                title: data.title,\n                description: data.description,\n                dueDate: data.dueDate,\n                classroomId,\n                problems: {\n                    create: data.problemIds.map((id, index) => ({\n                        problemId: id,\n                        order: index\n                    }))\n                }\n            }\n        });\n\n        // Revalidate classroom-specific and global assignment caches\n        revalidateTag(`assignments-classroom-${classroomId}`, \"max\");\n        revalidateTag('assignments-all', \"max\"); // Invalidate student assignments cache\n\n        return { success: true, assignmentId: assignment.id };\n    } catch (error) {\n        console.error(\"Create assignment error:\", error);\n        return { success: false, error: \"Failed to create assignment\" };\n    }\n}\n\n/**\n * Get details of a specific assignment, including problems (CACHED)\n */\nexport async function getAssignmentDetails(assignmentId: string) {\n    const fetchDetails = unstable_cache(\n        async () => {\n            return await prisma.assignment.findUnique({\n                where: { id: assignmentId },\n                include: {\n                    problems: {\n                        include: {\n                            problem: {\n                                select: {\n                                    id: true,\n                                    title: true,\n                                    slug: true,\n                                    difficulty: true,\n                                    type: true,\n                                    domain: true,\n                                }\n                            }\n                        },\n                        orderBy: { order: \"asc\" }\n                    },\n                    classroom: {\n                        select: {\n                            name: true,\n                            id: true\n                        }\n                    }\n                }\n            });\n        },\n        [`assignment-details-${assignmentId}`],\n        { tags: [`assignment-${assignmentId}`], revalidate: 3600 } // Cache for 1 hour\n    );\n\n    return await fetchDetails();\n}\n\n/**\n * Get all assignments for the current student across all enrolled classrooms (CACHED with pagination)\n */\nexport async function getStudentAssignments(page: number = 1, limit: number = 20) {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n\n    if (!session?.user) return { assignments: [], pagination: null };\n\n    // Filter out assignments older than 3 weeks\n    const threeWeeksAgo = new Date();\n    threeWeeksAgo.setDate(threeWeeksAgo.getDate() - 21);\n    const skip = (page - 1) * limit;\n    const userId = session.user.id;\n\n    const fetchStudentAssignments = unstable_cache(\n        async () => {\n            // First get enrolled classrooms\n            const user = await prisma.user.findUnique({\n                where: { id: userId },\n                select: {\n                    enrolledClassrooms: {\n                        select: { id: true }\n                    }\n                }\n            });\n\n            if (!user || user.enrolledClassrooms.length === 0) {\n                return { assignments: [], total: 0 };\n            }\n\n            const classroomIds = user.enrolledClassrooms.map(c => c.id);\n\n            // Fetch assignments for these classrooms with count\n            const [assignments, total] = await Promise.all([\n                prisma.assignment.findMany({\n                    where: {\n                        classroomId: { in: classroomIds },\n                        createdAt: { gte: threeWeeksAgo }\n                    },\n                    include: {\n                        classroom: {\n                            select: { name: true }\n                        },\n                        _count: {\n                            select: { problems: true }\n                        }\n                    },\n                    orderBy: { dueDate: \"asc\" }, // Due soonest first\n                    skip,\n                    take: limit,\n                }),\n                prisma.assignment.count({\n                    where: {\n                        classroomId: { in: classroomIds },\n                        createdAt: { gte: threeWeeksAgo }\n                    }\n                })\n            ]);\n\n            return { assignments, total };\n        },\n        [`student-assignments-${userId}-page-${page}`],\n        { tags: [`student-assignments-${userId}`, 'assignments-all'], revalidate: 60 }\n    );\n\n    const { assignments, total } = await fetchStudentAssignments();\n\n    return {\n        assignments,\n        pagination: total > 0 ? {\n            total,\n            pages: Math.ceil(total / limit),\n            current: page,\n            limit\n        } : null\n    };\n}\n\n/**\n * Check completion status of problems in an assignment for a specific user (CACHED short-term)\n */\nexport async function getAssignmentProgress(assignmentId: string, userId?: string) {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n\n    const targetUserId = userId || session?.user?.id;\n    if (!targetUserId) return null;\n\n    // Get assignment problems (cached)\n    const assignment = await getAssignmentDetails(assignmentId);\n    if (!assignment) return null;\n\n    const problemIds = assignment.problems.map(p => p.problemId);\n\n    // Use Redis cache for progress (short TTL since submissions update frequently)\n    const progressCacheKey = cacheKey(\"assignment-progress\", assignmentId, targetUserId);\n\n    const progress = await cachedFetch(\n        progressCacheKey,\n        async () => {\n            // Fetch successful submissions for these problems by the user\n            const submissions = await prisma.submission.findMany({\n                where: {\n                    userId: targetUserId,\n                    problemId: { in: problemIds },\n                    status: \"ACCEPTED\"\n                },\n                select: {\n                    problemId: true\n                },\n                distinct: [\"problemId\"]\n            });\n\n            const solvedProblemIds = new Set(submissions.map(s => s.problemId));\n\n            const progressMap: Record<string, boolean> = {};\n            let completedCount = 0;\n\n            assignment.problems.forEach(p => {\n                const isSolved = solvedProblemIds.has(p.problemId);\n                progressMap[p.problemId] = isSolved;\n                if (isSolved) completedCount++;\n            });\n\n            return {\n                total: assignment.problems.length,\n                completed: completedCount,\n                progressMap\n            };\n        },\n        CACHE_CONFIG.SHORT.ttl // 30 seconds cache\n    );\n\n    return progress;\n}\n\n/**\n * Teacher Analytics: Get progress of all students in a classroom for a specific assignment (CACHED)\n */\nexport async function getTeacherAssignmentAnalytics(\n    assignmentId: string,\n    classroomId: string,\n    page: number = 1,\n    limit: number = 50\n) {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n\n    if (!session?.user || session.user.role !== \"TEACHER\") {\n        throw new Error(\"Unauthorized\");\n    }\n\n    const skip = (page - 1) * limit;\n    const analyticsCacheKey = cacheKey(\"assignment-analytics\", assignmentId, classroomId, String(page));\n\n    const analytics = await cachedFetch(\n        analyticsCacheKey,\n        async () => {\n            // Parallel fetch for better performance\n            const [classroom, assignment, totalStudents] = await Promise.all([\n                prisma.classroom.findUnique({\n                    where: { id: classroomId },\n                    select: {\n                        students: {\n                            select: {\n                                id: true,\n                                name: true,\n                                image: true,\n                                email: true\n                            },\n                            skip,\n                            take: limit,\n                        }\n                    }\n                }),\n                prisma.assignment.findUnique({\n                    where: { id: assignmentId },\n                    include: {\n                        problems: {\n                            select: { problemId: true }\n                        }\n                    }\n                }),\n                prisma.user.count({\n                    where: {\n                        enrolledClassrooms: {\n                            some: { id: classroomId }\n                        }\n                    }\n                })\n            ]);\n\n            if (!classroom || !assignment) return null;\n\n            const studentIds = classroom.students.map(s => s.id);\n            const problemIds = assignment.problems.map(p => p.problemId);\n\n            // Get all accepted submissions in one query\n            const submissions = await prisma.submission.findMany({\n                where: {\n                    userId: { in: studentIds },\n                    problemId: { in: problemIds },\n                    status: \"ACCEPTED\"\n                },\n                select: {\n                    userId: true,\n                    problemId: true\n                }\n            });\n\n            // Build submission index for O(1) lookup\n            const submissionIndex = new Map<string, Set<string>>();\n            submissions.forEach(s => {\n                if (!submissionIndex.has(s.userId)) {\n                    submissionIndex.set(s.userId, new Set());\n                }\n                submissionIndex.get(s.userId)!.add(s.problemId);\n            });\n\n            // Build analytics\n            const studentAnalytics = classroom.students.map(student => {\n                const solvedSet = submissionIndex.get(student.id) || new Set();\n\n                return {\n                    student,\n                    completedCount: solvedSet.size,\n                    totalCount: problemIds.length,\n                    completionPercentage: problemIds.length > 0\n                        ? (solvedSet.size / problemIds.length) * 100\n                        : 0,\n                    hasCompletedAll: solvedSet.size === problemIds.length\n                };\n            });\n\n            return {\n                analytics: studentAnalytics,\n                pagination: {\n                    total: totalStudents,\n                    pages: Math.ceil(totalStudents / limit),\n                    current: page,\n                    limit\n                }\n            };\n        },\n        CACHE_CONFIG.MEDIUM.ttl // 2 minutes cache\n    );\n\n    return analytics;\n}\n\n/**\n * Delete an assignment\n */\nexport async function deleteAssignment(assignmentId: string) {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n\n    if (!session?.user || session.user.role !== \"TEACHER\") {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    try {\n        const assignment = await prisma.assignment.findUnique({\n            where: { id: assignmentId },\n            include: {\n                classroom: {\n                    select: { teacherId: true, id: true }\n                }\n            }\n        });\n\n        if (!assignment || assignment.classroom.teacherId !== session.user.id) {\n            return { success: false, error: \"Unauthorized\" };\n        }\n\n        // Delete assignment problems first, then assignment\n        await prisma.$transaction([\n            prisma.assignmentProblem.deleteMany({\n                where: { assignmentId }\n            }),\n            prisma.assignment.delete({\n                where: { id: assignmentId }\n            })\n        ]);\n\n        // Invalidate caches\n        revalidateTag(`assignment-${assignmentId}`, \"max\");\n        revalidateTag(`assignments-classroom-${assignment.classroom.id}`, \"max\");\n        revalidateTag('assignments-all', \"max\");\n\n        return { success: true };\n    } catch (error) {\n        console.error(\"Delete assignment error:\", error);\n        return { success: false, error: \"Failed to delete assignment\" };\n    }\n}\n"],"names":[],"mappings":";;;;;;;IAqEsB,8BAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA"}},
    {"offset": {"line": 2392, "column": 0}, "map": {"version":3,"sources":["file:///home/vishnu/Documents/projects/Algo-fox/actions/assignment.ts"],"sourcesContent":["\"use server\";\n\nimport { prisma } from \"@/lib/prisma\";\nimport { auth } from \"@/lib/auth\";\nimport { headers } from \"next/headers\";\nimport { revalidateTag, unstable_cache } from \"next/cache\";\nimport { cacheKey, cachedFetch, CACHE_CONFIG } from \"@/lib/cache-utils\";\n\n/**\n * Get all assignments for a specific classroom (CACHED with pagination)\n */\nexport async function getClassroomAssignments(\n    classroomId: string,\n    page: number = 1,\n    limit: number = 20\n) {\n    // Filter out assignments older than 3 weeks\n    const threeWeeksAgo = new Date();\n    threeWeeksAgo.setDate(threeWeeksAgo.getDate() - 21);\n    const skip = (page - 1) * limit;\n\n    const fetchAssignments = unstable_cache(\n        async () => {\n            const [assignments, total] = await Promise.all([\n                prisma.assignment.findMany({\n                    where: {\n                        classroomId,\n                        createdAt: { gte: threeWeeksAgo }\n                    },\n                    include: {\n                        _count: {\n                            select: { problems: true }\n                        }\n                    },\n                    orderBy: { createdAt: \"desc\" },\n                    skip,\n                    take: limit,\n                }),\n                prisma.assignment.count({\n                    where: {\n                        classroomId,\n                        createdAt: { gte: threeWeeksAgo }\n                    }\n                })\n            ]);\n\n            return { assignments, total };\n        },\n        [`classroom-assignments-${classroomId}-page-${page}`],\n        { tags: [`assignments-classroom-${classroomId}`, 'assignments-all'], revalidate: 60 }\n    );\n\n    const { assignments, total } = await fetchAssignments();\n\n    return {\n        assignments,\n        pagination: {\n            total,\n            pages: Math.ceil(total / limit),\n            current: page,\n            limit\n        }\n    };\n}\n\n/**\n * Get all assignments for a specific classroom (UNCACHED)\n * Use this for refetching after mutations to get fresh data\n */\nexport async function refreshClassroomAssignments(classroomId: string) {\n    const threeWeeksAgo = new Date();\n    threeWeeksAgo.setDate(threeWeeksAgo.getDate() - 21);\n\n    return await prisma.assignment.findMany({\n        where: {\n            classroomId,\n            createdAt: { gte: threeWeeksAgo }\n        },\n        include: {\n            _count: {\n                select: { problems: true }\n            }\n        },\n        orderBy: { createdAt: \"desc\" }\n    });\n}\n\n/**\n * Create a new assignment for a classroom\n */\nexport async function createAssignment(\n    classroomId: string,\n    data: {\n        title: string;\n        description?: string;\n        dueDate?: Date;\n        problemIds: string[];\n    }\n) {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n\n    if (!session?.user || session.user.role !== \"TEACHER\") {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    try {\n        // Verify teacher owns the classroom\n        const classroom = await prisma.classroom.findUnique({\n            where: { id: classroomId },\n            select: { teacherId: true }\n        });\n\n        if (!classroom || classroom.teacherId !== session.user.id) {\n            return { success: false, error: \"Unauthorized access to classroom\" };\n        }\n\n        const assignment = await prisma.assignment.create({\n            data: {\n                title: data.title,\n                description: data.description,\n                dueDate: data.dueDate,\n                classroomId,\n                problems: {\n                    create: data.problemIds.map((id, index) => ({\n                        problemId: id,\n                        order: index\n                    }))\n                }\n            }\n        });\n\n        // Revalidate classroom-specific and global assignment caches\n        revalidateTag(`assignments-classroom-${classroomId}`, \"max\");\n        revalidateTag('assignments-all', \"max\"); // Invalidate student assignments cache\n\n        return { success: true, assignmentId: assignment.id };\n    } catch (error) {\n        console.error(\"Create assignment error:\", error);\n        return { success: false, error: \"Failed to create assignment\" };\n    }\n}\n\n/**\n * Get details of a specific assignment, including problems (CACHED)\n */\nexport async function getAssignmentDetails(assignmentId: string) {\n    const fetchDetails = unstable_cache(\n        async () => {\n            return await prisma.assignment.findUnique({\n                where: { id: assignmentId },\n                include: {\n                    problems: {\n                        include: {\n                            problem: {\n                                select: {\n                                    id: true,\n                                    title: true,\n                                    slug: true,\n                                    difficulty: true,\n                                    type: true,\n                                    domain: true,\n                                }\n                            }\n                        },\n                        orderBy: { order: \"asc\" }\n                    },\n                    classroom: {\n                        select: {\n                            name: true,\n                            id: true\n                        }\n                    }\n                }\n            });\n        },\n        [`assignment-details-${assignmentId}`],\n        { tags: [`assignment-${assignmentId}`], revalidate: 3600 } // Cache for 1 hour\n    );\n\n    return await fetchDetails();\n}\n\n/**\n * Get all assignments for the current student across all enrolled classrooms (CACHED with pagination)\n */\nexport async function getStudentAssignments(page: number = 1, limit: number = 20) {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n\n    if (!session?.user) return { assignments: [], pagination: null };\n\n    // Filter out assignments older than 3 weeks\n    const threeWeeksAgo = new Date();\n    threeWeeksAgo.setDate(threeWeeksAgo.getDate() - 21);\n    const skip = (page - 1) * limit;\n    const userId = session.user.id;\n\n    const fetchStudentAssignments = unstable_cache(\n        async () => {\n            // First get enrolled classrooms\n            const user = await prisma.user.findUnique({\n                where: { id: userId },\n                select: {\n                    enrolledClassrooms: {\n                        select: { id: true }\n                    }\n                }\n            });\n\n            if (!user || user.enrolledClassrooms.length === 0) {\n                return { assignments: [], total: 0 };\n            }\n\n            const classroomIds = user.enrolledClassrooms.map(c => c.id);\n\n            // Fetch assignments for these classrooms with count\n            const [assignments, total] = await Promise.all([\n                prisma.assignment.findMany({\n                    where: {\n                        classroomId: { in: classroomIds },\n                        createdAt: { gte: threeWeeksAgo }\n                    },\n                    include: {\n                        classroom: {\n                            select: { name: true }\n                        },\n                        _count: {\n                            select: { problems: true }\n                        }\n                    },\n                    orderBy: { dueDate: \"asc\" }, // Due soonest first\n                    skip,\n                    take: limit,\n                }),\n                prisma.assignment.count({\n                    where: {\n                        classroomId: { in: classroomIds },\n                        createdAt: { gte: threeWeeksAgo }\n                    }\n                })\n            ]);\n\n            return { assignments, total };\n        },\n        [`student-assignments-${userId}-page-${page}`],\n        { tags: [`student-assignments-${userId}`, 'assignments-all'], revalidate: 60 }\n    );\n\n    const { assignments, total } = await fetchStudentAssignments();\n\n    return {\n        assignments,\n        pagination: total > 0 ? {\n            total,\n            pages: Math.ceil(total / limit),\n            current: page,\n            limit\n        } : null\n    };\n}\n\n/**\n * Check completion status of problems in an assignment for a specific user (CACHED short-term)\n */\nexport async function getAssignmentProgress(assignmentId: string, userId?: string) {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n\n    const targetUserId = userId || session?.user?.id;\n    if (!targetUserId) return null;\n\n    // Get assignment problems (cached)\n    const assignment = await getAssignmentDetails(assignmentId);\n    if (!assignment) return null;\n\n    const problemIds = assignment.problems.map(p => p.problemId);\n\n    // Use Redis cache for progress (short TTL since submissions update frequently)\n    const progressCacheKey = cacheKey(\"assignment-progress\", assignmentId, targetUserId);\n\n    const progress = await cachedFetch(\n        progressCacheKey,\n        async () => {\n            // Fetch successful submissions for these problems by the user\n            const submissions = await prisma.submission.findMany({\n                where: {\n                    userId: targetUserId,\n                    problemId: { in: problemIds },\n                    status: \"ACCEPTED\"\n                },\n                select: {\n                    problemId: true\n                },\n                distinct: [\"problemId\"]\n            });\n\n            const solvedProblemIds = new Set(submissions.map(s => s.problemId));\n\n            const progressMap: Record<string, boolean> = {};\n            let completedCount = 0;\n\n            assignment.problems.forEach(p => {\n                const isSolved = solvedProblemIds.has(p.problemId);\n                progressMap[p.problemId] = isSolved;\n                if (isSolved) completedCount++;\n            });\n\n            return {\n                total: assignment.problems.length,\n                completed: completedCount,\n                progressMap\n            };\n        },\n        CACHE_CONFIG.SHORT.ttl // 30 seconds cache\n    );\n\n    return progress;\n}\n\n/**\n * Teacher Analytics: Get progress of all students in a classroom for a specific assignment (CACHED)\n */\nexport async function getTeacherAssignmentAnalytics(\n    assignmentId: string,\n    classroomId: string,\n    page: number = 1,\n    limit: number = 50\n) {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n\n    if (!session?.user || session.user.role !== \"TEACHER\") {\n        throw new Error(\"Unauthorized\");\n    }\n\n    const skip = (page - 1) * limit;\n    const analyticsCacheKey = cacheKey(\"assignment-analytics\", assignmentId, classroomId, String(page));\n\n    const analytics = await cachedFetch(\n        analyticsCacheKey,\n        async () => {\n            // Parallel fetch for better performance\n            const [classroom, assignment, totalStudents] = await Promise.all([\n                prisma.classroom.findUnique({\n                    where: { id: classroomId },\n                    select: {\n                        students: {\n                            select: {\n                                id: true,\n                                name: true,\n                                image: true,\n                                email: true\n                            },\n                            skip,\n                            take: limit,\n                        }\n                    }\n                }),\n                prisma.assignment.findUnique({\n                    where: { id: assignmentId },\n                    include: {\n                        problems: {\n                            select: { problemId: true }\n                        }\n                    }\n                }),\n                prisma.user.count({\n                    where: {\n                        enrolledClassrooms: {\n                            some: { id: classroomId }\n                        }\n                    }\n                })\n            ]);\n\n            if (!classroom || !assignment) return null;\n\n            const studentIds = classroom.students.map(s => s.id);\n            const problemIds = assignment.problems.map(p => p.problemId);\n\n            // Get all accepted submissions in one query\n            const submissions = await prisma.submission.findMany({\n                where: {\n                    userId: { in: studentIds },\n                    problemId: { in: problemIds },\n                    status: \"ACCEPTED\"\n                },\n                select: {\n                    userId: true,\n                    problemId: true\n                }\n            });\n\n            // Build submission index for O(1) lookup\n            const submissionIndex = new Map<string, Set<string>>();\n            submissions.forEach(s => {\n                if (!submissionIndex.has(s.userId)) {\n                    submissionIndex.set(s.userId, new Set());\n                }\n                submissionIndex.get(s.userId)!.add(s.problemId);\n            });\n\n            // Build analytics\n            const studentAnalytics = classroom.students.map(student => {\n                const solvedSet = submissionIndex.get(student.id) || new Set();\n\n                return {\n                    student,\n                    completedCount: solvedSet.size,\n                    totalCount: problemIds.length,\n                    completionPercentage: problemIds.length > 0\n                        ? (solvedSet.size / problemIds.length) * 100\n                        : 0,\n                    hasCompletedAll: solvedSet.size === problemIds.length\n                };\n            });\n\n            return {\n                analytics: studentAnalytics,\n                pagination: {\n                    total: totalStudents,\n                    pages: Math.ceil(totalStudents / limit),\n                    current: page,\n                    limit\n                }\n            };\n        },\n        CACHE_CONFIG.MEDIUM.ttl // 2 minutes cache\n    );\n\n    return analytics;\n}\n\n/**\n * Delete an assignment\n */\nexport async function deleteAssignment(assignmentId: string) {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n\n    if (!session?.user || session.user.role !== \"TEACHER\") {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    try {\n        const assignment = await prisma.assignment.findUnique({\n            where: { id: assignmentId },\n            include: {\n                classroom: {\n                    select: { teacherId: true, id: true }\n                }\n            }\n        });\n\n        if (!assignment || assignment.classroom.teacherId !== session.user.id) {\n            return { success: false, error: \"Unauthorized\" };\n        }\n\n        // Delete assignment problems first, then assignment\n        await prisma.$transaction([\n            prisma.assignmentProblem.deleteMany({\n                where: { assignmentId }\n            }),\n            prisma.assignment.delete({\n                where: { id: assignmentId }\n            })\n        ]);\n\n        // Invalidate caches\n        revalidateTag(`assignment-${assignmentId}`, \"max\");\n        revalidateTag(`assignments-classroom-${assignment.classroom.id}`, \"max\");\n        revalidateTag('assignments-all', \"max\");\n\n        return { success: true };\n    } catch (error) {\n        console.error(\"Delete assignment error:\", error);\n        return { success: false, error: \"Failed to delete assignment\" };\n    }\n}\n"],"names":[],"mappings":";;;;;;;IAsUsB,gCAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA"}},
    {"offset": {"line": 2404, "column": 0}, "map": {"version":3,"sources":["file:///home/vishnu/Documents/projects/Algo-fox/components/classroom/assignments/AssignmentAnalyticsView.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport { ArrowLeft, CheckCircle2, Search, Mail, Download } from \"lucide-react\";\nimport { getTeacherAssignmentAnalytics } from \"@/actions/assignment\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport Image from \"next/image\";\n\ninterface AssignmentAnalyticsViewProps {\n    assignmentId: string;\n    classroomId: string;\n    onBack: () => void;\n}\n\nexport function AssignmentAnalyticsView({ assignmentId, classroomId, onBack }: AssignmentAnalyticsViewProps) {\n    const [analytics, setAnalytics] = useState<any[]>([]);\n    const [isLoading, setIsLoading] = useState(true);\n    const [searchQuery, setSearchQuery] = useState(\"\");\n\n    useEffect(() => {\n        const fetchAnalytics = async () => {\n            try {\n                const result = await getTeacherAssignmentAnalytics(assignmentId, classroomId);\n                // Handle new paginated return type\n                if (result && 'analytics' in result) {\n                    setAnalytics(result.analytics || []);\n                } else if (Array.isArray(result)) {\n                    setAnalytics(result);\n                } else {\n                    setAnalytics([]);\n                }\n            } catch (error) {\n                console.error(\"Failed to fetch analytics\", error);\n            } finally {\n                setIsLoading(false);\n            }\n        };\n\n        fetchAnalytics();\n    }, [assignmentId, classroomId]);\n\n    const filteredAnalytics = analytics.filter(item =>\n        item.student.name?.toLowerCase().includes(searchQuery.toLowerCase()) ||\n        item.student.email?.toLowerCase().includes(searchQuery.toLowerCase())\n    );\n\n    const exportToExcel = () => {\n        const headers = [\"Student Name\", \"Email\", \"Completed Problems\", \"Total Problems\", \"Completion %\", \"Status\"];\n        const rows = analytics.map(item => [\n            item.student.name || \"Unknown\",\n            item.student.email,\n            item.completedCount,\n            item.totalCount,\n            `${item.completionPercentage.toFixed(1)}%`,\n            item.hasCompletedAll ? \"Completed\" : \"In Progress\"\n        ]);\n\n        const csvContent = [\n            headers.join(\",\"),\n            ...rows.map(r => r.join(\",\"))\n        ].join(\"\\n\");\n\n        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\n        const link = document.createElement(\"a\");\n        const url = URL.createObjectURL(blob);\n        link.setAttribute(\"href\", url);\n        link.setAttribute(\"download\", \"assignment_report.csv\");\n        link.style.visibility = 'hidden';\n        document.body.appendChild(link);\n        link.click();\n        document.body.removeChild(link);\n    };\n\n    if (isLoading) {\n        return <div className=\"p-8 text-center text-gray-500\">Loading analytics...</div>;\n    }\n\n    // Calculate Summary Stats\n    const totalStudents = analytics.length;\n    const fullyCompleted = analytics.filter(a => a.hasCompletedAll).length;\n    const avgProgress = totalStudents > 0\n        ? analytics.reduce((acc, curr) => acc + curr.completionPercentage, 0) / totalStudents\n        : 0;\n\n    return (\n        <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n            {/* Header */}\n            <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center gap-4\">\n                    <Button variant=\"ghost\" size=\"icon\" onClick={onBack} className=\"rounded-full\">\n                        <ArrowLeft className=\"w-5 h-5\" />\n                    </Button>\n                    <div>\n                        <h2 className=\"text-xl font-bold text-gray-900 dark:text-white\">Assignment Analytics</h2>\n                        <p className=\"text-sm text-gray-500\">Track student progress and submissions</p>\n                    </div>\n                </div>\n                <Button onClick={exportToExcel} variant=\"outline\" className=\"gap-2\">\n                    <Download className=\"w-4 h-4\" />\n                    Export CSV\n                </Button>\n            </div>\n\n            {/* Stats Cards */}\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                <div className=\"p-6 bg-white dark:bg-[#1a1a1a] border border-gray-100 dark:border-[#262626] rounded-xl shadow-sm\">\n                    <div className=\"text-sm text-gray-500 mb-1 font-medium\">Completion Rate</div>\n                    <div className=\"text-3xl font-black text-gray-900 dark:text-white\">\n                        {Math.round((fullyCompleted / totalStudents) * 100) || 0}%\n                    </div>\n                    <div className=\"text-xs text-gray-400 mt-2\">\n                        {fullyCompleted} of {totalStudents} students completed all problems\n                    </div>\n                </div>\n                <div className=\"p-6 bg-white dark:bg-[#1a1a1a] border border-gray-100 dark:border-[#262626] rounded-xl shadow-sm\">\n                    <div className=\"text-sm text-gray-500 mb-1 font-medium\">Avg. Progress</div>\n                    <div className=\"text-3xl font-black text-gray-900 dark:text-white\">\n                        {Math.round(avgProgress)}%\n                    </div>\n                    <div className=\"h-1.5 mt-3 bg-gray-100 dark:bg-[#333] rounded-full overflow-hidden\">\n                        <div className=\"h-full bg-orange-500 rounded-full transition-all\" style={{ width: `${avgProgress}%` }} />\n                    </div>\n                </div>\n                <div className=\"p-6 bg-white dark:bg-[#1a1a1a] border border-gray-100 dark:border-[#262626] rounded-xl shadow-sm\">\n                    <div className=\"text-sm text-gray-500 mb-1 font-medium\">Pending</div>\n                    <div className=\"text-3xl font-black text-orange-600 dark:text-orange-500\">\n                        {totalStudents - fullyCompleted}\n                    </div>\n                    <div className=\"text-xs text-gray-400 mt-2\">Students still working</div>\n                </div>\n            </div>\n\n            {/* Student List */}\n            <div className=\"bg-white dark:bg-[#1a1a1a] border border-gray-100 dark:border-[#262626] rounded-xl overflow-hidden shadow-sm\">\n                <div className=\"p-4 border-b border-gray-50 dark:border-[#262626] flex items-center justify-between gap-4\">\n                    <h3 className=\"font-bold text-gray-900 dark:text-white\">Student Progress ({filteredAnalytics.length})</h3>\n                    <div className=\"relative w-64\">\n                        <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400\" />\n                        <Input\n                            placeholder=\"Search students...\"\n                            value={searchQuery}\n                            onChange={(e) => setSearchQuery(e.target.value)}\n                            className=\"pl-9 h-9\"\n                        />\n                    </div>\n                </div>\n\n                <div className=\"overflow-x-auto\">\n                    <table className=\"w-full text-sm text-left\">\n                        <thead className=\"text-xs text-gray-500 uppercase bg-gray-50/50 dark:bg-[#202020]\">\n                            <tr>\n                                <th className=\"px-6 py-3 font-medium\">Student</th>\n                                <th className=\"px-6 py-3 font-medium\">Progress</th>\n                                <th className=\"px-6 py-3 font-medium text-center\">Solved</th>\n                                <th className=\"px-6 py-3 font-medium text-right\">Status</th>\n                            </tr>\n                        </thead>\n                        <tbody className=\"divide-y divide-gray-50 dark:divide-[#262626]\">\n                            {filteredAnalytics.map((item) => (\n                                <tr key={item.student.id} className=\"hover:bg-gray-50/50 dark:hover:bg-[#1f1f1f] transition-colors\">\n                                    <td className=\"px-6 py-4\">\n                                        <div className=\"flex items-center gap-3\">\n                                            <div className=\"w-8 h-8 rounded-full bg-gray-100 dark:bg-[#333] overflow-hidden flex items-center justify-center text-[10px] font-bold text-gray-500\">\n                                                {item.student.image ? (\n                                                    <Image src={item.student.image} alt={item.student.name || ''} width={32} height={32} className=\"object-cover\" />\n                                                ) : (\n                                                    item.student.name?.charAt(0).toUpperCase()\n                                                )}\n                                            </div>\n                                            <div>\n                                                <div className=\"font-bold text-gray-900 dark:text-white\">{item.student.name || \"Unknown\"}</div>\n                                                <div className=\"text-xs text-gray-400 flex items-center gap-1\">\n                                                    <Mail className=\"w-3 h-3\" />\n                                                    {item.student.email}\n                                                </div>\n                                            </div>\n                                        </div>\n                                    </td>\n                                    <td className=\"px-6 py-4 w-1/3\">\n                                        <div className=\"flex items-center gap-3\">\n                                            <div className={`h-2 flex-1 rounded-full overflow-hidden ${item.hasCompletedAll ? 'bg-green-100 dark:bg-green-900/20' : 'bg-gray-100 dark:bg-[#333]'}`}>\n                                                <div className={`h-full rounded-full transition-all ${item.hasCompletedAll ? 'bg-green-500' : 'bg-orange-500'}`} style={{ width: `${item.completionPercentage}%` }} />\n                                            </div>\n                                            <span className=\"text-xs font-bold w-9 text-right\">{Math.round(item.completionPercentage)}%</span>\n                                        </div>\n                                    </td>\n                                    <td className=\"px-6 py-4 text-center\">\n                                        <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800 dark:bg-[#333] dark:text-gray-300\">\n                                            {item.completedCount} / {item.totalCount}\n                                        </span>\n                                    </td>\n                                    <td className=\"px-6 py-4 text-right\">\n                                        {item.hasCompletedAll ? (\n                                            <span className=\"inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-bold bg-green-100 text-green-700 dark:bg-green-500/10 dark:text-green-400\">\n                                                <CheckCircle2 className=\"w-3.5 h-3.5\" />\n                                                Done\n                                            </span>\n                                        ) : (\n                                            <span className=\"inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-bold bg-orange-50 text-orange-700 dark:bg-orange-500/10 dark:text-orange-400\">\n                                                <div className=\"w-1.5 h-1.5 rounded-full bg-orange-500 animate-pulse\" />\n                                                Pending\n                                            </span>\n                                        )}\n                                    </td>\n                                </tr>\n                            ))}\n                        </tbody>\n                    </table>\n                </div>\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3029, "column": 0}, "map": {"version":3,"sources":["file:///home/vishnu/Documents/projects/Algo-fox/components/classroom/assignments/AssignmentsTab.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport { Plus, Calendar, CheckCircle2, ChevronRight, BarChart2 } from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport { CreateAssignmentModal } from \"./CreateAssignmentModal\";\nimport { getClassroomAssignments, refreshClassroomAssignments } from \"@/actions/assignment\";\nimport { AssignmentAnalyticsView } from \"./AssignmentAnalyticsView\";\nimport Link from \"next/link\";\nimport { toast } from \"sonner\";\n\ninterface AssignmentsTabProps {\n    classroomId: string;\n    isTeacher: boolean;\n}\n\nexport function AssignmentsTab({ classroomId, isTeacher }: AssignmentsTabProps) {\n    const [assignments, setAssignments] = useState<any[]>([]);\n    const [isLoading, setIsLoading] = useState(true);\n    const [isCreateModalOpen, setIsCreateModalOpen] = useState(false);\n    const [selectedAssignmentId, setSelectedAssignmentId] = useState<string | null>(null);\n\n    // Initial load uses cached version\n    const fetchAssignments = async () => {\n        try {\n            const result = await getClassroomAssignments(classroomId);\n            // Handle new paginated return type\n            setAssignments(result.assignments || []);\n        } catch (error) {\n            console.error(\"Failed to fetch assignments\", error);\n            toast.error(\"Failed to load assignments\");\n        } finally {\n            setIsLoading(false);\n        }\n    };\n\n    // Refresh uses uncached version for fresh data\n    const refreshAssignments = async () => {\n        try {\n            const data = await refreshClassroomAssignments(classroomId);\n            setAssignments(data);\n        } catch (error) {\n            console.error(\"Failed to refresh assignments\", error);\n        }\n    };\n\n    useEffect(() => {\n        fetchAssignments();\n    }, [classroomId]);\n\n    if (selectedAssignmentId && isTeacher) {\n        return (\n            <AssignmentAnalyticsView\n                assignmentId={selectedAssignmentId}\n                classroomId={classroomId}\n                onBack={() => setSelectedAssignmentId(null)}\n            />\n        );\n    }\n\n    return (\n        <div className=\"space-y-6\">\n            <div className=\"flex items-center justify-between\">\n                <h2 className=\"text-xl font-bold text-gray-900 dark:text-gray-100\">Assignments</h2>\n                {isTeacher && (\n                    <button\n                        onClick={() => setIsCreateModalOpen(true)}\n                        className=\"px-4 py-2 bg-orange-600 text-white text-sm font-bold rounded-lg hover:bg-orange-700 flex items-center gap-2 transition-colors\"\n                    >\n                        <Plus className=\"w-4 h-4\" />\n                        Create Assignment\n                    </button>\n                )}\n            </div>\n\n            {isLoading ? (\n                <div className=\"text-center py-12 text-gray-500\">Loading assignments...</div>\n            ) : assignments.length === 0 ? (\n                <div className=\"text-center py-16 bg-gray-50 border border-gray-100 dark:bg-[#1a1a1a] dark:border-[#262626] rounded-2xl\">\n                    <div className=\"w-16 h-16 bg-orange-100 dark:bg-orange-500/10 rounded-full flex items-center justify-center mx-auto mb-4 text-orange-600 dark:text-orange-500\">\n                        <Calendar className=\"w-8 h-8\" />\n                    </div>\n                    <h3 className=\"text-lg font-bold text-gray-900 dark:text-white mb-2\">No assignments yet</h3>\n                    <p className=\"text-gray-500 max-w-md mx-auto mb-6\">\n                        {isTeacher\n                            ? \"Create your first assignment to track student progress on specific problems.\"\n                            : \"Your teacher hasn't posted any assignments yet.\"}\n                    </p>\n                    {isTeacher && (\n                        <button\n                            onClick={() => setIsCreateModalOpen(true)}\n                            className=\"px-6 py-3 bg-white border border-gray-200 text-gray-900 hover:bg-gray-50 text-sm font-bold rounded-lg transition-colors\"\n                        >\n                            Create Assignment\n                        </button>\n                    )}\n                </div>\n            ) : (\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                    {assignments.map(assignment => (\n                        <div\n                            key={assignment.id}\n                            className=\"bg-white dark:bg-[#1a1a1a] border border-gray-100 dark:border-[#262626] rounded-xl p-6 hover:shadow-lg transition-all group relative cursor-pointer\"\n                            onClick={() => {\n                                if (isTeacher) {\n                                    setSelectedAssignmentId(assignment.id);\n                                } else {\n                                    // Navigate to student assignment view (needs implementation)\n                                    // For now, let's just use a Link\n                                }\n                            }}\n                        >\n                             {/* Floating actions */}\n                            {!isTeacher && (\n                                <Link\n                                    href={`/my-assignments/${assignment.id}`}\n                                    className=\"absolute inset-0 z-10\"\n                                />\n                            )}\n\n                            <div className=\"flex items-start justify-between mb-4\">\n                                <div className=\"p-3 bg-orange-50 dark:bg-orange-500/10 rounded-lg text-orange-600 dark:text-orange-500\">\n                                    <CheckCircle2 className=\"w-6 h-6\" />\n                                </div>\n                                {assignment.dueDate && (\n                                    <span className=\"text-xs font-bold text-gray-400 bg-gray-50 dark:bg-[#262626] px-2 py-1 rounded\">\n                                        Due {format(new Date(assignment.dueDate), \"MMM d\")}\n                                    </span>\n                                )}\n                            </div>\n\n                            <h3 className=\"text-lg font-bold text-gray-900 dark:text-white mb-2 group-hover:text-orange-600 transition-colors\">\n                                {assignment.title}\n                            </h3>\n\n                            <p className=\"text-sm text-gray-500 mb-6 line-clamp-2 min-h-[40px]\">\n                                {assignment.description || \"No description provided\"}\n                            </p>\n\n                            <div className=\"flex items-center justify-between pt-4 border-t border-gray-50 dark:border-[#262626]\">\n                                <span className=\"text-xs font-bold text-gray-500\">\n                                    {assignment._count.problems} Problems\n                                </span>\n\n                                {isTeacher ? (\n                                    <div className=\"flex items-center gap-1 text-xs font-bold text-orange-600 hover:underline\">\n                                        <BarChart2 className=\"w-3 h-3\" />\n                                        View Analytics\n                                    </div>\n                                ) : (\n                                    <span className=\"flex items-center gap-1 text-xs font-bold text-gray-900 dark:text-white group-hover:translate-x-1 transition-transform\">\n                                        Start\n                                        <ChevronRight className=\"w-3 h-3\" />\n                                    </span>\n                                )}\n                            </div>\n                        </div>\n                    ))}\n                </div>\n            )}\n\n            {isTeacher && (\n                <CreateAssignmentModal\n                    isOpen={isCreateModalOpen}\n                    onClose={() => setIsCreateModalOpen(false)}\n                    classroomId={classroomId}\n                    onSuccess={() => {\n                        setIsCreateModalOpen(false);\n                        refreshAssignments(); // Use uncached fetch for immediate fresh data\n                    }}\n                />\n            )}\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3351, "column": 0}, "map": {"version":3,"sources":["file:///home/vishnu/Documents/projects/Algo-fox/actions/classroom-contest.action.ts"],"sourcesContent":["\"use server\";\n\nimport { prisma } from \"@/lib/prisma\";\nimport { checkExternalParticipation } from \"./contest-checker.action\";\nimport { getUpcomingContests, Contest as ExternalContest } from \"./external-contests.action\";\n\n// Re-export external checker for ease of use in client components\nexport { checkExternalParticipation };\n\nexport type InternalContestParticipation = {\n    userId: string;\n    name: string;\n    email: string;\n    participated: boolean;\n    score: number;\n    rank?: number;\n    problemsSolved: number;\n    finishedAt?: Date | null;\n    isFinished: boolean;\n};\n\nexport async function checkInternalContestParticipation(\n    contestId: string,\n    classroomId: string\n): Promise<{ success: boolean; results?: InternalContestParticipation[]; error?: string }> {\n    try {\n        // 1. Verify contest exists\n        const contest = await prisma.contest.findUnique({\n            where: { id: contestId },\n            select: { id: true, title: true }\n        });\n\n        if (!contest) {\n            return { success: false, error: \"Contest not found\" };\n        }\n\n        // 2. Get all students in the classroom\n        const classroom = await prisma.classroom.findUnique({\n            where: { id: classroomId },\n            include: {\n                students: {\n                    select: { id: true, name: true, email: true },\n                    orderBy: { name: 'asc' }\n                }\n            }\n        });\n\n        if (!classroom) {\n            return { success: false, error: \"Classroom not found\" };\n        }\n\n        // 3. Get participation records for this contest and these students\n        const participations = await prisma.contestParticipation.findMany({\n            where: {\n                contestId: contestId,\n                userId: {\n                    in: classroom.students.map(s => s.id)\n                }\n            },\n            include: {\n                user: {\n                    select: {\n                         submissions: {\n                            where: { contestId: contestId, status: \"ACCEPTED\" },\n                            select: { problemId: true, problem: { select: { score: true } } }\n                         }\n                    }\n                }\n            }\n        });\n\n        // 4. Map results\n        const participationMap = new Map();\n        participations.forEach(p => {\n            // Calculate score based on unique problems solved\n            const uniqueSolved = new Set();\n            let totalScore = 0;\n\n            p.user.submissions.forEach(sub => {\n                if (!uniqueSolved.has(sub.problemId)) {\n                    uniqueSolved.add(sub.problemId);\n                    totalScore += sub.problem.score;\n                }\n            });\n\n            participationMap.set(p.userId, {\n                participated: true,\n                finishedAt: p.finishedAt,\n                isFinished: p.isFinished,\n                score: totalScore,\n                problemsSolved: uniqueSolved.size\n            });\n        });\n\n        const results: InternalContestParticipation[] = classroom.students.map(student => {\n            const data = participationMap.get(student.id);\n            return {\n                userId: student.id,\n                name: student.name || \"Unknown\",\n                email: student.email,\n                participated: !!data,\n                score: data?.score || 0,\n                problemsSolved: data?.problemsSolved || 0,\n                finishedAt: data?.finishedAt || null,\n                isFinished: data?.isFinished || false\n            };\n        });\n\n        // Add ranks for those who participated\n        // Rank by Score (desc), then Time (asc) - not implementing complex time penalty logic here for simplicity,\n        // just score.\n        results\n            .filter(r => r.participated)\n            .sort((a, b) => b.score - a.score)\n            .forEach((r, idx) => {\n                r.rank = idx + 1;\n            });\n\n        return { success: true, results };\n\n    } catch (error: any) {\n        console.error(\"Internal contest check failed:\", error);\n        return { success: false, error: \"Failed to fetch participation data\" };\n    }\n}\n\nexport async function getRecentContests(classroomId: string) {\n    try {\n        // 1. Fetch Internal Contests (Past 30 days)\n        const thirtyDaysAgo = new Date();\n        thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);\n\n        const internalContests = await prisma.contest.findMany({\n            where: {\n                endTime: {\n                    lt: new Date(), // Completed\n                    gt: thirtyDaysAgo\n                },\n                OR: [\n                    { visibility: \"PUBLIC\" },\n                    {\n                        visibility: \"CLASSROOM\",\n                        classroomId: classroomId\n                    },\n                    {\n                        visibility: \"INSTITUTION\",\n                        institution: {\n                            classrooms: {\n                                some: { id: classroomId }\n                            }\n                        }\n                    }\n                ]\n            },\n            orderBy: {\n                endTime: 'desc'\n            },\n            take: 10,\n            select: {\n                id: true,\n                title: true,\n                endTime: true,\n                slug: true\n            }\n        });\n\n        // 2. Fetch External Contests\n        // We reuse the getUpcomingContests which now includes recent past contests\n        const { contests: externalContests } = await getUpcomingContests();\n\n        // Filter for only FINISHED external contests\n        const recentExternal = externalContests.filter((c: ExternalContest) => c.status === \"FINISHED\");\n\n        return {\n            success: true,\n            internal: internalContests,\n            external: recentExternal\n        };\n\n    } catch (error) {\n        console.error(\"Failed to fetch recent contests:\", error);\n        return { success: false, internal: [], external: [] };\n    }\n}\n"],"names":[],"mappings":";;;;;;;IAqBsB,oCAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA"}},
    {"offset": {"line": 3363, "column": 0}, "map": {"version":3,"sources":["file:///home/vishnu/Documents/projects/Algo-fox/actions/classroom-contest.action.ts"],"sourcesContent":["\"use server\";\n\nimport { prisma } from \"@/lib/prisma\";\nimport { checkExternalParticipation } from \"./contest-checker.action\";\nimport { getUpcomingContests, Contest as ExternalContest } from \"./external-contests.action\";\n\n// Re-export external checker for ease of use in client components\nexport { checkExternalParticipation };\n\nexport type InternalContestParticipation = {\n    userId: string;\n    name: string;\n    email: string;\n    participated: boolean;\n    score: number;\n    rank?: number;\n    problemsSolved: number;\n    finishedAt?: Date | null;\n    isFinished: boolean;\n};\n\nexport async function checkInternalContestParticipation(\n    contestId: string,\n    classroomId: string\n): Promise<{ success: boolean; results?: InternalContestParticipation[]; error?: string }> {\n    try {\n        // 1. Verify contest exists\n        const contest = await prisma.contest.findUnique({\n            where: { id: contestId },\n            select: { id: true, title: true }\n        });\n\n        if (!contest) {\n            return { success: false, error: \"Contest not found\" };\n        }\n\n        // 2. Get all students in the classroom\n        const classroom = await prisma.classroom.findUnique({\n            where: { id: classroomId },\n            include: {\n                students: {\n                    select: { id: true, name: true, email: true },\n                    orderBy: { name: 'asc' }\n                }\n            }\n        });\n\n        if (!classroom) {\n            return { success: false, error: \"Classroom not found\" };\n        }\n\n        // 3. Get participation records for this contest and these students\n        const participations = await prisma.contestParticipation.findMany({\n            where: {\n                contestId: contestId,\n                userId: {\n                    in: classroom.students.map(s => s.id)\n                }\n            },\n            include: {\n                user: {\n                    select: {\n                         submissions: {\n                            where: { contestId: contestId, status: \"ACCEPTED\" },\n                            select: { problemId: true, problem: { select: { score: true } } }\n                         }\n                    }\n                }\n            }\n        });\n\n        // 4. Map results\n        const participationMap = new Map();\n        participations.forEach(p => {\n            // Calculate score based on unique problems solved\n            const uniqueSolved = new Set();\n            let totalScore = 0;\n\n            p.user.submissions.forEach(sub => {\n                if (!uniqueSolved.has(sub.problemId)) {\n                    uniqueSolved.add(sub.problemId);\n                    totalScore += sub.problem.score;\n                }\n            });\n\n            participationMap.set(p.userId, {\n                participated: true,\n                finishedAt: p.finishedAt,\n                isFinished: p.isFinished,\n                score: totalScore,\n                problemsSolved: uniqueSolved.size\n            });\n        });\n\n        const results: InternalContestParticipation[] = classroom.students.map(student => {\n            const data = participationMap.get(student.id);\n            return {\n                userId: student.id,\n                name: student.name || \"Unknown\",\n                email: student.email,\n                participated: !!data,\n                score: data?.score || 0,\n                problemsSolved: data?.problemsSolved || 0,\n                finishedAt: data?.finishedAt || null,\n                isFinished: data?.isFinished || false\n            };\n        });\n\n        // Add ranks for those who participated\n        // Rank by Score (desc), then Time (asc) - not implementing complex time penalty logic here for simplicity,\n        // just score.\n        results\n            .filter(r => r.participated)\n            .sort((a, b) => b.score - a.score)\n            .forEach((r, idx) => {\n                r.rank = idx + 1;\n            });\n\n        return { success: true, results };\n\n    } catch (error: any) {\n        console.error(\"Internal contest check failed:\", error);\n        return { success: false, error: \"Failed to fetch participation data\" };\n    }\n}\n\nexport async function getRecentContests(classroomId: string) {\n    try {\n        // 1. Fetch Internal Contests (Past 30 days)\n        const thirtyDaysAgo = new Date();\n        thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);\n\n        const internalContests = await prisma.contest.findMany({\n            where: {\n                endTime: {\n                    lt: new Date(), // Completed\n                    gt: thirtyDaysAgo\n                },\n                OR: [\n                    { visibility: \"PUBLIC\" },\n                    {\n                        visibility: \"CLASSROOM\",\n                        classroomId: classroomId\n                    },\n                    {\n                        visibility: \"INSTITUTION\",\n                        institution: {\n                            classrooms: {\n                                some: { id: classroomId }\n                            }\n                        }\n                    }\n                ]\n            },\n            orderBy: {\n                endTime: 'desc'\n            },\n            take: 10,\n            select: {\n                id: true,\n                title: true,\n                endTime: true,\n                slug: true\n            }\n        });\n\n        // 2. Fetch External Contests\n        // We reuse the getUpcomingContests which now includes recent past contests\n        const { contests: externalContests } = await getUpcomingContests();\n\n        // Filter for only FINISHED external contests\n        const recentExternal = externalContests.filter((c: ExternalContest) => c.status === \"FINISHED\");\n\n        return {\n            success: true,\n            internal: internalContests,\n            external: recentExternal\n        };\n\n    } catch (error) {\n        console.error(\"Failed to fetch recent contests:\", error);\n        return { success: false, internal: [], external: [] };\n    }\n}\n"],"names":[],"mappings":";;;;;;;IA8HsB,oBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA"}},
    {"offset": {"line": 3375, "column": 0}, "map": {"version":3,"sources":["file:///home/vishnu/Documents/projects/Algo-fox/actions/contest-checker.action.ts"],"sourcesContent":["\"use server\";\n\nimport { prisma } from \"@/lib/prisma\";\nimport { User } from \"@prisma/client\";\n\nexport type ParticipationStatus = {\n  userId: string;\n  name: string;\n  handle: string | null;\n  participated: boolean;\n  rank?: number;\n  score?: number;\n  details?: any;\n  error?: string;\n};\n\n// --- Codeforces ---\n\nasync function checkCodeforcesParticipation(contestId: string, users: User[]): Promise<ParticipationStatus[]> {\n  const usersWithHandle = users.filter(u => u.codeforcesHandle);\n  const handleMap = new Map<string, User>();\n  usersWithHandle.forEach(u => handleMap.set(u.codeforcesHandle!.toLowerCase(), u));\n\n  if (usersWithHandle.length === 0) {\n    return users.map(u => ({\n      userId: u.id,\n      name: u.name,\n      handle: u.codeforcesHandle || null,\n      participated: false,\n      error: \"No Codeforces handle linked\"\n    }));\n  }\n\n  // Codeforces allows multiple handles in one request (up to some limit, usually 10000 characters url length)\n  // chunk handles if necessary\n  const chunks = [];\n  const chunkSize = 100; // conservative batch size\n  for (let i = 0; i < usersWithHandle.length; i += chunkSize) {\n    chunks.push(usersWithHandle.slice(i, i + chunkSize));\n  }\n\n  const results: ParticipationStatus[] = [];\n  // Initialize all as not participated\n  users.forEach(u => {\n      if (!u.codeforcesHandle) {\n          results.push({\n              userId: u.id,\n              name: u.name,\n              handle: null,\n              participated: false,\n              error: \"No handle\"\n          });\n      }\n  });\n\n  for (const chunk of chunks) {\n    const handles = chunk.map(u => u.codeforcesHandle).join(\";\");\n    try {\n      const res = await fetch(`https://codeforces.com/api/contest.standings?contestId=${contestId}&handles=${handles}&showUnofficial=true`);\n      const data = await res.json();\n\n      if (data.status !== \"OK\") {\n        chunk.forEach(u => results.push({\n          userId: u.id,\n          name: u.name,\n          handle: u.codeforcesHandle,\n          participated: false,\n          error: data.comment || \"Codeforces API Error\"\n        }));\n        continue;\n      }\n\n      // Process rows\n      const rows = data.result.rows;\n      // Mark those present as participated\n      const foundHandles = new Set<string>();\n\n      rows.forEach((row: any) => {\n        // row.party.members contains the handles\n        row.party.members.forEach((member: any) => {\n           const handle = member.handle.toLowerCase();\n           const user = handleMap.get(handle);\n           if (user) {\n             foundHandles.add(handle);\n             results.push({\n               userId: user.id,\n               name: user.name,\n               handle: user.codeforcesHandle,\n               participated: true,\n               rank: row.rank,\n               score: row.points,\n               details: {\n                 penalty: row.penalty,\n                 successfulHackCount: row.successfulHackCount\n               }\n             });\n           }\n        });\n      });\n\n      // Those in the chunk but not found in rows => did not participate\n      chunk.forEach(u => {\n        if (u.codeforcesHandle && !foundHandles.has(u.codeforcesHandle.toLowerCase())) {\n          results.push({\n            userId: u.id,\n            name: u.name,\n            handle: u.codeforcesHandle,\n            participated: false\n          });\n        }\n      });\n\n    } catch (e: any) {\n      chunk.forEach(u => results.push({\n        userId: u.id,\n        name: u.name,\n        handle: u.codeforcesHandle,\n        participated: false,\n        error: e.message\n      }));\n    }\n  }\n\n  return results;\n}\n\n// --- LeetCode ---\n\nasync function checkLeetCodeParticipation(contestSlug: string, users: User[]): Promise<ParticipationStatus[]> {\n  // LeetCode doesn't have a batch check. We must check each user.\n  // We'll run in parallel with concurrency limit.\n\n  const results: ParticipationStatus[] = [];\n\n  const checkUser = async (user: User) => {\n    if (!user.leetCodeHandle) {\n      return {\n        userId: user.id,\n        name: user.name,\n        handle: null,\n        participated: false,\n        error: \"No handle\"\n      };\n    }\n\n    try {\n      // Query user's contest history\n      const query = `\n        query userContestRankingInfo($username: String!) {\n          userContestRankingHistory(username: $username) {\n            attended\n            contest {\n              titleSlug\n              startTime\n            }\n            ranking\n            finishTimeInSeconds\n          }\n        }\n      `;\n\n      const res = await fetch(\"https://leetcode.com/graphql\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          \"Referer\": `https://leetcode.com/u/${user.leetCodeHandle}/`\n        },\n        body: JSON.stringify({\n          query,\n          variables: { username: user.leetCodeHandle }\n        }),\n        cache: \"no-store\"\n      });\n\n      const data = await res.json();\n      if (data.errors) {\n         return {\n            userId: user.id,\n            name: user.name,\n            handle: user.leetCodeHandle,\n            participated: false,\n            error: data.errors[0]?.message\n         };\n      }\n\n      const history = data.data.userContestRankingHistory || [];\n      // Find the contest\n      const participation = history.find((p: any) => p.contest?.titleSlug === contestSlug);\n\n      if (participation && participation.attended) {\n        return {\n          userId: user.id,\n          name: user.name,\n          handle: user.leetCodeHandle,\n          participated: true,\n          rank: participation.ranking,\n          details: {\n            finishTime: participation.finishTimeInSeconds\n          }\n        };\n      } else {\n        return {\n          userId: user.id,\n          name: user.name,\n          handle: user.leetCodeHandle,\n          participated: false\n        };\n      }\n\n    } catch (e: any) {\n      return {\n        userId: user.id,\n        name: user.name,\n        handle: user.leetCodeHandle,\n        participated: false,\n        error: e.message\n      };\n    }\n  };\n\n  // Process in chunks to avoid rate limits\n  const chunkSize = 5;\n  for (let i = 0; i < users.length; i += chunkSize) {\n    const chunk = users.slice(i, i + chunkSize);\n    const chunkResults = await Promise.all(chunk.map(checkUser));\n    results.push(...chunkResults);\n  }\n\n  return results;\n}\n\n// --- CodeChef ---\n\nasync function checkCodeChefParticipation(contestCode: string, users: User[]): Promise<ParticipationStatus[]> {\n  const results: ParticipationStatus[] = [];\n\n  const checkUser = async (user: User) => {\n    if (!user.codeChefHandle) {\n      return {\n        userId: user.id,\n        name: user.name,\n        handle: null,\n        participated: false,\n        error: \"No handle\"\n      };\n    }\n\n    try {\n      // Use the ranking search API\n      const res = await fetch(`https://www.codechef.com/api/rankings/${contestCode}?itemsPerPage=1&search=${user.codeChefHandle}`, {\n          cache: \"no-store\"\n      });\n\n      if (!res.ok) { // Contest might be invalid or other error\n         return {\n            userId: user.id,\n            name: user.name,\n            handle: user.codeChefHandle,\n            participated: false,\n            error: `API Status: ${res.status}`\n         };\n      }\n\n      const data = await res.json();\n\n      // data.list contains the rows\n      // We searched for the specific handle. If it's there and exact match...\n      const entry = data.list?.find((item: any) => item.user_handle?.toLowerCase() === user.codeChefHandle?.toLowerCase());\n\n      if (entry) {\n        return {\n          userId: user.id,\n          name: user.name,\n          handle: user.codeChefHandle,\n          participated: true,\n          rank: entry.rank,\n          score: parseFloat(entry.score),\n          details: {\n             penalty: entry.penalty\n          }\n        };\n      } else {\n        return {\n          userId: user.id,\n          name: user.name,\n          handle: user.codeChefHandle,\n          participated: false\n        };\n      }\n\n    } catch (e: any) {\n      return {\n        userId: user.id,\n        name: user.name,\n        handle: user.codeChefHandle,\n        participated: false,\n        error: e.message\n      };\n    }\n  };\n\n   // Process in chunks\n  const chunkSize = 5;\n  for (let i = 0; i < users.length; i += chunkSize) {\n    const chunk = users.slice(i, i + chunkSize);\n    const chunkResults = await Promise.all(chunk.map(checkUser));\n    results.push(...chunkResults);\n  }\n\n  return results;\n}\n\n\n// --- Main Action ---\n\nexport async function checkExternalParticipation(\n  platform: \"CodeForces\" | \"LeetCode\" | \"CodeChef\",\n  contestIdentifier: string, // ID for CF, Slug for LC, Code for CC\n  userFilters?: {\n      institutionId?: string;\n      classroomId?: string;\n  }\n) {\n\n  // 1. Fetch Users\n  const where: any = {\n      role: \"STUDENT\" // Mostly we care about students\n  };\n\n  if (userFilters?.institutionId) {\n      where.institutionId = userFilters.institutionId;\n  }\n\n  // Note: Classroom logic might need recursive fetch if not directly on user,\n  // but User model has `enrolledClassrooms`.\n  if (userFilters?.classroomId) {\n      where.enrolledClassrooms = {\n          some: {\n              id: userFilters.classroomId\n          }\n      };\n  }\n\n  const users = await prisma.user.findMany({\n    where,\n    select: {\n      id: true,\n      name: true,\n      email: true,\n      codeforcesHandle: true,\n      leetCodeHandle: true,\n      codeChefHandle: true\n    }\n  });\n\n  if (users.length === 0) {\n      return { success: true, results: [] };\n  }\n\n  let results: ParticipationStatus[] = [];\n\n  try {\n      if (platform === \"CodeForces\") {\n          results = await checkCodeforcesParticipation(contestIdentifier, users as User[]);\n      } else if (platform === \"LeetCode\") {\n          results = await checkLeetCodeParticipation(contestIdentifier, users as User[]);\n      } else if (platform === \"CodeChef\") {\n          results = await checkCodeChefParticipation(contestIdentifier, users as User[]);\n      }\n\n      return { success: true, results };\n  } catch (error: any) {\n      console.error(\"Check participation error:\", error);\n      return { success: false, error: error.message };\n  }\n}\n"],"names":[],"mappings":";;;;;;;IA2TsB,6BAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA"}},
    {"offset": {"line": 3387, "column": 0}, "map": {"version":3,"sources":["file:///home/vishnu/Documents/projects/Algo-fox/components/classroom/contests/ContestVerificationTab.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport { checkInternalContestParticipation, InternalContestParticipation, getRecentContests } from \"@/actions/classroom-contest.action\";\nimport { checkExternalParticipation, ParticipationStatus } from \"@/actions/contest-checker.action\";\nimport { Search, Loader2, Trophy, Globe, CheckCircle2, XCircle, ExternalLink, Calendar, ChevronDown } from \"lucide-react\";\n\ninterface ContestVerificationTabProps {\n    classroomId: string;\n}\n\nexport function ContestVerificationTab({ classroomId }: ContestVerificationTabProps) {\n    const [mode, setMode] = useState<\"internal\" | \"external\">(\"internal\");\n\n    // Recent Contests Data\n    const [recentInternal, setRecentInternal] = useState<any[]>([]);\n    const [recentExternal, setRecentExternal] = useState<any[]>([]);\n    const [isFetchingRecents, setIsFetchingRecents] = useState(true);\n\n    // Internal State\n    const [internalContestId, setInternalContestId] = useState(\"\");\n    const [internalResults, setInternalResults] = useState<InternalContestParticipation[] | null>(null);\n\n    // External State\n    const [platform, setPlatform] = useState<\"CodeForces\" | \"LeetCode\" | \"CodeChef\">(\"CodeForces\");\n    const [externalContestId, setExternalContestId] = useState(\"\");\n    const [externalResults, setExternalResults] = useState<ParticipationStatus[] | null>(null);\n\n    const [isLoading, setIsLoading] = useState(false);\n    const [error, setError] = useState(\"\");\n\n    useEffect(() => {\n        async function fetchRecents() {\n            setIsFetchingRecents(true);\n            const res = await getRecentContests(classroomId);\n            if (res.success) {\n                setRecentInternal(res.internal);\n                setRecentExternal(res.external);\n            }\n            setIsFetchingRecents(false);\n        }\n        fetchRecents();\n    }, [classroomId]);\n\n    const handleInternalCheck = async () => {\n        if (!internalContestId) {\n            setError(\"Please enter a Contest ID\");\n            return;\n        }\n        setIsLoading(true);\n        setError(\"\");\n        setInternalResults(null);\n\n        const res = await checkInternalContestParticipation(internalContestId, classroomId);\n\n        if (res.success) {\n            setInternalResults(res.results!);\n        } else {\n            setError(res.error || \"Failed to fetch data\");\n        }\n        setIsLoading(false);\n    };\n\n    const handleExternalCheck = async () => {\n        if (!externalContestId) {\n            setError(\"Please enter a Contest ID/Slug\");\n            return;\n        }\n        setIsLoading(true);\n        setError(\"\");\n        setExternalResults(null);\n\n        const res = await checkExternalParticipation(platform, externalContestId, { classroomId });\n\n        if (res.success) {\n            setExternalResults(res.results!);\n        } else {\n            setError(res.error || \"Failed to fetch data\");\n        }\n        setIsLoading(false);\n    };\n\n    const handleSelectRecentInternal = (id: string) => {\n        setInternalContestId(id);\n    };\n\n    const handleSelectRecentExternal = (id: string, site: string) => {\n        setExternalContestId(id);\n        if (site === \"CodeForces\") setPlatform(\"CodeForces\");\n        if (site === \"CodeChef\") setPlatform(\"CodeChef\");\n        if (site === \"LeetCode\") setPlatform(\"LeetCode\");\n    };\n\n    return (\n        <div className=\"space-y-6\">\n            <div className=\"flex items-center justify-between\">\n                <div>\n                     <h2 className=\"text-xl font-bold text-gray-900 dark:text-white\">Contest Participation Verification</h2>\n                     <p className=\"text-sm text-gray-500 dark:text-gray-400\">Verify if your students attended internal or external contests.</p>\n                </div>\n\n                <div className=\"flex bg-gray-100 dark:bg-[#1a1a1a] p-1 rounded-lg\">\n                    <button\n                        onClick={() => setMode(\"internal\")}\n                        className={`px-4 py-1.5 rounded-md text-sm font-medium transition-all ${\n                            mode === \"internal\"\n                            ? \"bg-white dark:bg-[#262626] text-orange-600 dark:text-orange-500 shadow-sm\"\n                            : \"text-gray-500 hover:text-gray-900 dark:hover:text-gray-200\"\n                        }`}\n                    >\n                        Internal\n                    </button>\n                     <button\n                        onClick={() => setMode(\"external\")}\n                        className={`px-4 py-1.5 rounded-md text-sm font-medium transition-all ${\n                            mode === \"external\"\n                            ? \"bg-white dark:bg-[#262626] text-orange-600 dark:text-orange-500 shadow-sm\"\n                            : \"text-gray-500 hover:text-gray-900 dark:hover:text-gray-200\"\n                        }`}\n                    >\n                        External\n                    </button>\n                </div>\n            </div>\n\n            <div className=\"bg-white dark:bg-[#141414] border border-gray-200 dark:border-[#262626] rounded-xl p-6 shadow-sm\">\n\n                {mode === \"internal\" ? (\n                    <div className=\"space-y-4\">\n                        {/* Recent Internal Selector */}\n                        <div>\n                             <label className=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 block\">Recently Completed</label>\n                             {isFetchingRecents ? (\n                                 <div className=\"h-10 w-full bg-gray-50 dark:bg-[#1a1a1a] rounded-lg animate-pulse\" />\n                             ) : recentInternal.length > 0 ? (\n                                 <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-2\">\n                                     {recentInternal.map(c => (\n                                         <button\n                                            key={c.id}\n                                            onClick={() => handleSelectRecentInternal(c.id)}\n                                            className={`text-left px-3 py-2 rounded-lg border text-sm transition-all ${\n                                                internalContestId === c.id\n                                                ? \"border-orange-500 bg-orange-50 dark:bg-orange-500/10 text-orange-700 dark:text-orange-400\"\n                                                : \"border-gray-200 dark:border-[#333] hover:border-orange-300 dark:hover:border-orange-700 bg-white dark:bg-[#1a1a1a]\"\n                                            }`}\n                                         >\n                                             <div className=\"font-medium truncate\">{c.title}</div>\n                                             <div className=\"text-xs text-gray-500 dark:text-gray-400\">{new Date(c.endTime).toLocaleDateString()}</div>\n                                         </button>\n                                     ))}\n                                 </div>\n                             ) : (\n                                 <div className=\"text-sm text-gray-400 italic\">No recent contests found.</div>\n                             )}\n                        </div>\n\n                        <div className=\"flex flex-col md:flex-row gap-4 items-end pt-4 border-t border-gray-100 dark:border-[#262626]\">\n                            <div className=\"flex-1 space-y-2 w-full\">\n                                <label className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">Algo-Fox Contest ID</label>\n                                <div className=\"relative\">\n                                    <Trophy className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400\" />\n                                    <input\n                                        type=\"text\"\n                                        value={internalContestId}\n                                        onChange={(e) => setInternalContestId(e.target.value)}\n                                        placeholder=\"Enter manually or select above...\"\n                                        className=\"w-full h-10 pl-10 pr-3 rounded-lg border border-gray-200 dark:border-[#333] bg-white dark:bg-[#1a1a1a] text-sm focus:outline-none focus:ring-2 focus:ring-orange-500/20\"\n                                    />\n                                </div>\n                            </div>\n                            <button\n                                onClick={handleInternalCheck}\n                                disabled={isLoading}\n                                className=\"w-full md:w-auto px-6 h-10 bg-orange-600 hover:bg-orange-700 text-white rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-2 disabled:opacity-50\"\n                            >\n                                {isLoading ? <Loader2 className=\"w-4 h-4 animate-spin\" /> : <Search className=\"w-4 h-4\" />}\n                                Check\n                            </button>\n                        </div>\n                    </div>\n                ) : (\n                    <div className=\"space-y-4\">\n                        {/* Recent External Selector */}\n                        <div>\n                             <label className=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 block\">Recently Completed (External)</label>\n                             {isFetchingRecents ? (\n                                 <div className=\"h-10 w-full bg-gray-50 dark:bg-[#1a1a1a] rounded-lg animate-pulse\" />\n                             ) : recentExternal.length > 0 ? (\n                                 <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2 max-h-48 overflow-y-auto\">\n                                     {recentExternal.map(c => {\n                                         // Parse ID correctly for filling input\n                                         // Format returned by API: \"leetcode-weekly-contest-390\"\n                                         const parts = c.id.split('-');\n                                         const site = parts[0] === \"leetcode\" ? \"LeetCode\" : parts[0] === \"codeforces\" ? \"CodeForces\" : \"CodeChef\";\n                                         const realId = parts.slice(1).join('-');\n\n                                         // For Codeforces, realId is contest ID. For LeetCode, slug. For CodeChef, code.\n                                         // The API returns normalized IDs.\n\n                                         return (\n                                            <button\n                                                key={c.id}\n                                                onClick={() => handleSelectRecentExternal(realId, site)}\n                                                className={`text-left px-3 py-2 rounded-lg border text-sm transition-all ${\n                                                    externalContestId === realId && platform === site\n                                                    ? \"border-orange-500 bg-orange-50 dark:bg-orange-500/10 text-orange-700 dark:text-orange-400\"\n                                                    : \"border-gray-200 dark:border-[#333] hover:border-orange-300 dark:hover:border-orange-700 bg-white dark:bg-[#1a1a1a]\"\n                                                }`}\n                                            >\n                                                <div className=\"flex items-center gap-2 mb-1\">\n                                                    <span className={`text-[10px] uppercase font-bold px-1.5 py-0.5 rounded ${\n                                                        site === \"LeetCode\" ? \"bg-yellow-100 text-yellow-700\" :\n                                                        site === \"CodeForces\" ? \"bg-red-100 text-red-700\" :\n                                                        \"bg-amber-100 text-amber-700\"\n                                                    }`}>\n                                                        {site}\n                                                    </span>\n                                                    <span className=\"text-xs text-gray-400\">{new Date(c.end_time).toLocaleDateString()}</span>\n                                                </div>\n                                                <div className=\"font-medium truncate\" title={c.name}>{c.name}</div>\n                                            </button>\n                                        );\n                                     })}\n                                 </div>\n                             ) : (\n                                 <div className=\"text-sm text-gray-400 italic\">No recent external contests found.</div>\n                             )}\n                        </div>\n\n                        <div className=\"flex flex-col md:flex-row gap-4 items-end pt-4 border-t border-gray-100 dark:border-[#262626]\">\n                             <div className=\"space-y-2 w-full md:w-48\">\n                                <label className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">Platform</label>\n                                <select\n                                    value={platform}\n                                    onChange={(e) => setPlatform(e.target.value as any)}\n                                    className=\"w-full h-10 px-3 rounded-lg border border-gray-200 dark:border-[#333] bg-white dark:bg-[#1a1a1a] text-sm focus:outline-none focus:ring-2 focus:ring-orange-500/20\"\n                                >\n                                    <option value=\"CodeForces\">CodeForces</option>\n                                    <option value=\"LeetCode\">LeetCode</option>\n                                    <option value=\"CodeChef\">CodeChef</option>\n                                </select>\n                            </div>\n                            <div className=\"flex-1 space-y-2 w-full\">\n                                <label className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\n                                    {platform === \"CodeForces\" ? \"Contest ID\" : platform === \"LeetCode\" ? \"Contest Slug\" : \"Contest Code\"}\n                                </label>\n                                <div className=\"relative\">\n                                    <Globe className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400\" />\n                                    <input\n                                        type=\"text\"\n                                        value={externalContestId}\n                                        onChange={(e) => setExternalContestId(e.target.value)}\n                                        placeholder={\n                                            platform === \"CodeForces\" ? \"e.g. 1950\" :\n                                            platform === \"LeetCode\" ? \"e.g. weekly-contest-390\" :\n                                            \"e.g. START128\"\n                                        }\n                                        className=\"w-full h-10 pl-10 pr-3 rounded-lg border border-gray-200 dark:border-[#333] bg-white dark:bg-[#1a1a1a] text-sm focus:outline-none focus:ring-2 focus:ring-orange-500/20\"\n                                    />\n                                </div>\n                            </div>\n                             <button\n                                onClick={handleExternalCheck}\n                                disabled={isLoading}\n                                className=\"w-full md:w-auto px-6 h-10 bg-orange-600 hover:bg-orange-700 text-white rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-2 disabled:opacity-50\"\n                            >\n                                {isLoading ? <Loader2 className=\"w-4 h-4 animate-spin\" /> : <Search className=\"w-4 h-4\" />}\n                                Check\n                            </button>\n                        </div>\n                    </div>\n                )}\n\n\n                {error && (\n                    <div className=\"mt-4 p-3 bg-red-50 dark:bg-red-900/10 text-red-600 dark:text-red-400 text-sm rounded-lg flex items-center gap-2\">\n                        <XCircle className=\"w-4 h-4\" />\n                        {error}\n                    </div>\n                )}\n            </div>\n\n            {/* Internal Results */}\n            {mode === \"internal\" && internalResults && (\n                <div className=\"bg-white dark:bg-[#141414] border border-gray-200 dark:border-[#262626] rounded-xl overflow-hidden shadow-sm\">\n                     <div className=\"px-6 py-4 border-b border-gray-200 dark:border-[#262626] bg-gray-50/50 dark:bg-[#1a1a1a]/50 flex justify-between items-center\">\n                        <h3 className=\"font-semibold text-gray-900 dark:text-white\">Results ({internalResults.length})</h3>\n                        <div className=\"flex gap-4 text-sm\">\n                            <span className=\"text-green-600 dark:text-green-500 font-medium\">\n                                {internalResults.filter(r => r.participated).length} Present\n                            </span>\n                            <span className=\"text-red-600 dark:text-red-500 font-medium\">\n                                {internalResults.filter(r => !r.participated).length} Absent\n                            </span>\n                        </div>\n                    </div>\n                    <div className=\"overflow-x-auto\">\n                        <table className=\"w-full text-sm text-left\">\n                            <thead className=\"bg-gray-50 dark:bg-[#1a1a1a] text-gray-500 dark:text-gray-400 font-medium border-b border-gray-200 dark:border-[#262626]\">\n                                <tr>\n                                    <th className=\"px-6 py-3\">Student</th>\n                                    <th className=\"px-6 py-3\">Email</th>\n                                    <th className=\"px-6 py-3\">Status</th>\n                                    <th className=\"px-6 py-3\">Score</th>\n                                    <th className=\"px-6 py-3\">Solved</th>\n                                    <th className=\"px-6 py-3\">Finished At</th>\n                                </tr>\n                            </thead>\n                            <tbody className=\"divide-y divide-gray-200 dark:divide-[#262626]\">\n                                {internalResults.map((r) => (\n                                    <tr key={r.userId} className=\"hover:bg-gray-50 dark:hover:bg-[#1a1a1a]/50 transition-colors\">\n                                        <td className=\"px-6 py-3 font-medium text-gray-900 dark:text-white\">{r.name}</td>\n                                        <td className=\"px-6 py-3 text-gray-500 dark:text-gray-400\">{r.email}</td>\n                                        <td className=\"px-6 py-3\">\n                                            {r.participated ? (\n                                                <span className=\"inline-flex items-center gap-1 px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-500\">\n                                                    Present\n                                                </span>\n                                            ) : (\n                                                <span className=\"inline-flex items-center gap-1 px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-500\">\n                                                    Absent\n                                                </span>\n                                            )}\n                                        </td>\n                                        <td className=\"px-6 py-3 font-mono\">{r.score}</td>\n                                        <td className=\"px-6 py-3 font-mono\">{r.problemsSolved}</td>\n                                        <td className=\"px-6 py-3 text-gray-500 dark:text-gray-400\">\n                                            {r.finishedAt ? new Date(r.finishedAt).toLocaleString() : \"-\"}\n                                        </td>\n                                    </tr>\n                                ))}\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n            )}\n\n            {/* External Results */}\n            {mode === \"external\" && externalResults && (\n                <div className=\"bg-white dark:bg-[#141414] border border-gray-200 dark:border-[#262626] rounded-xl overflow-hidden shadow-sm\">\n                    <div className=\"px-6 py-4 border-b border-gray-200 dark:border-[#262626] bg-gray-50/50 dark:bg-[#1a1a1a]/50 flex justify-between items-center\">\n                        <h3 className=\"font-semibold text-gray-900 dark:text-white\">Results ({externalResults.length})</h3>\n                         <div className=\"flex gap-4 text-sm\">\n                            <span className=\"text-green-600 dark:text-green-500 font-medium\">\n                                {externalResults.filter(r => r.participated).length} Present\n                            </span>\n                            <span className=\"text-red-600 dark:text-red-500 font-medium\">\n                                {externalResults.filter(r => !r.participated).length} Absent\n                            </span>\n                        </div>\n                    </div>\n                    <div className=\"overflow-x-auto\">\n                        <table className=\"w-full text-sm text-left\">\n                             <thead className=\"bg-gray-50 dark:bg-[#1a1a1a] text-gray-500 dark:text-gray-400 font-medium border-b border-gray-200 dark:border-[#262626]\">\n                                <tr>\n                                    <th className=\"px-6 py-3\">Student</th>\n                                    <th className=\"px-6 py-3\">Handle</th>\n                                    <th className=\"px-6 py-3\">Status</th>\n                                    <th className=\"px-6 py-3\">Rank</th>\n                                    <th className=\"px-6 py-3\">Details</th>\n                                </tr>\n                            </thead>\n                             <tbody className=\"divide-y divide-gray-200 dark:divide-[#262626]\">\n                                {externalResults.map((r) => (\n                                    <tr key={r.userId} className=\"hover:bg-gray-50 dark:hover:bg-[#1a1a1a]/50 transition-colors\">\n                                        <td className=\"px-6 py-3 font-medium text-gray-900 dark:text-white\">{r.name}</td>\n                                        <td className=\"px-6 py-3 text-gray-500 dark:text-gray-400 font-mono\">\n                                            {r.handle ? (\n                                                <a href={\n                                                    platform === \"CodeForces\" ? `https://codeforces.com/profile/${r.handle}` :\n                                                    platform === \"LeetCode\" ? `https://leetcode.com/u/${r.handle}` :\n                                                    `https://www.codechef.com/users/${r.handle}`\n                                                } target=\"_blank\" rel=\"noopener noreferrer\" className=\"hover:text-orange-500 flex items-center gap-1\">\n                                                    {r.handle}\n                                                    <ExternalLink className=\"w-3 h-3\" />\n                                                </a>\n                                            ) : (\n                                                <span className=\"text-gray-400 italic\">Not linked</span>\n                                            )}\n                                        </td>\n                                         <td className=\"px-6 py-3\">\n                                            {r.error ? (\n                                                <span className=\"inline-flex items-center gap-1 px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-500\">\n                                                    Error\n                                                </span>\n                                            ) : r.participated ? (\n                                                <span className=\"inline-flex items-center gap-1 px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-500\">\n                                                    Participated\n                                                </span>\n                                            ) : (\n                                                <span className=\"inline-flex items-center gap-1 px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-500\">\n                                                    Absent\n                                                </span>\n                                            )}\n                                        </td>\n                                        <td className=\"px-6 py-3 text-gray-600 dark:text-gray-400\">\n                                            {r.rank ? `#${r.rank}` : \"-\"}\n                                        </td>\n                                        <td className=\"px-6 py-3 text-xs text-gray-500 dark:text-gray-400 max-w-xs truncate\">\n                                             {r.error ? r.error : JSON.stringify(r.details || {})}\n                                        </td>\n                                    </tr>\n                                ))}\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n            )}\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4409, "column": 0}, "map": {"version":3,"sources":["file:///home/vishnu/Documents/projects/Algo-fox/components/classroom/ClassroomDashboard.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport { ClassroomSidebar } from \"./ClassroomSidebar\";\nimport { ClassroomLeaderboard } from \"./ClassroomLeaderboard\";\nimport { LiveTracking } from \"./LiveTracking\";\nimport { AssignmentsTab } from \"./assignments/AssignmentsTab\";\nimport { ContestVerificationTab } from \"./contests/ContestVerificationTab\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport Link from \"next/link\";\nimport { ArrowLeft, ChevronRight, Copy, Check } from \"lucide-react\";\nimport { toast } from \"sonner\";\n\ninterface Student {\n    id: string;\n    name: string | null;\n    totalScore: number;\n    image: string | null;\n}\n\ninterface ClassroomDashboardProps {\n    classroom: {\n        id: string;\n        name: string;\n        subject?: string | null;\n        section?: string | null;\n        joinCode: string;\n        students: Student[];\n        teacher: {\n            id: string;\n            name: string | null;\n        };\n    };\n    currentUserId: string;\n}\n\nexport function ClassroomDashboard({ classroom, currentUserId }: ClassroomDashboardProps) {\n    const [activeTab, setActiveTab] = useState<'leaderboard' | 'tracking' | 'assignments' | 'contests'>('leaderboard');\n    const [isCopied, setIsCopied] = useState(false);\n    const isTeacher = classroom.teacher.id === currentUserId;\n\n    const handleCopyLink = () => {\n        const url = `${window.location.origin}/join-classroom/${classroom.joinCode}`;\n        navigator.clipboard.writeText(url);\n        setIsCopied(true);\n        toast.success(\"Invitation link copied to clipboard\");\n        setTimeout(() => setIsCopied(false), 2000);\n    };\n\n    const handleDownload = () => {\n        const headers = [\"Rank\", \"Student ID\", \"Name\", \"Total Score\"];\n        const rows = classroom.students.map((s, i) => [\n            i + 1,\n            s.id,\n            s.name || \"Anonymous\",\n            s.totalScore\n        ]);\n\n        const csvContent = [\n            headers.join(\",\"),\n            ...rows.map(r => r.join(\",\"))\n        ].join(\"\\n\");\n\n        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\n        const link = document.createElement(\"a\");\n        const url = URL.createObjectURL(blob);\n        link.setAttribute(\"href\", url);\n        link.setAttribute(\"download\", `${classroom.name.replace(/\\s+/g, '_')}_leaderboard.csv`);\n        link.style.visibility = 'hidden';\n        document.body.appendChild(link);\n        link.click();\n        document.body.removeChild(link);\n    };\n\n    return (\n        <div className={`min-h-screen ${isTeacher ? 'pl-0 md:pl-72' : ''}`}>\n             {isTeacher && (\n                <ClassroomSidebar\n                    activeTab={activeTab}\n                    onTabChange={setActiveTab}\n                    onDownload={handleDownload}\n                    showDownload={activeTab === 'leaderboard'}\n                    isTeacher={isTeacher}\n                    classroomName={classroom.name}\n                />\n            )}\n\n            <div className={`bg-gray-50/30 dark:bg-[#0a0a0a] min-h-screen ${isTeacher ? '' : 'max-w-7xl mx-auto px-6'}`}>\n                 {/* Header Section */}\n                 <div className={`pt-24 pb-8 border-b border-gray-100 dark:border-[#262626] ${isTeacher ? 'px-8 md:px-12' : ''}`}>\n                     <div className={isTeacher ? \"\" : \"max-w-7xl mx-auto\"}>\n                        <div className=\"flex items-center gap-2 text-xs font-bold text-gray-400 uppercase tracking-widest mb-6\">\n                            <Link href=\"/dashboard/classrooms\" className=\"hover:text-orange-600 dark:hover:text-orange-500\">Classrooms</Link>\n                            <ChevronRight className=\"w-3 h-3\" />\n                            <span className=\"text-gray-900 dark:text-white\">{classroom.name}</span>\n                        </div>\n\n                        <div className=\"flex flex-col md:flex-row md:items-end justify-between gap-6\">\n                            <div>\n                                <h1 className=\"text-4xl md:text-5xl font-black text-gray-900 dark:text-white tracking-tighter mb-4\">\n                                    {classroom.name}\n                                </h1>\n                                <div className=\"flex flex-wrap items-center gap-x-8 gap-y-2\">\n                                    <div className=\"flex flex-col\">\n                                        <span className=\"text-[10px] font-black text-gray-400 uppercase tracking-[0.2em] mb-1\">Instructor</span>\n                                        <span className=\"text-sm font-bold text-gray-900 dark:text-gray-200 flex items-center gap-2\">\n                                            <div className=\"w-5 h-5 bg-orange-100 dark:bg-orange-500/10 rounded text-[10px] flex items-center justify-center text-orange-600 dark:text-orange-500\">\n                                                {classroom.teacher.name?.charAt(0).toUpperCase()}\n                                            </div>\n                                            {classroom.teacher.name}\n                                        </span>\n                                    </div>\n                                    <div className=\"flex flex-col\">\n                                        <span className=\"text-[10px] font-black text-gray-400 uppercase tracking-[0.2em] mb-1\">Subject</span>\n                                        <span className=\"text-sm font-bold text-gray-900 dark:text-gray-200\">{classroom.subject || \"Logic & Coding\"}</span>\n                                    </div>\n                                    <div className=\"flex flex-col\">\n                                        <span className=\"text-[10px] font-black text-gray-400 uppercase tracking-[0.2em] mb-1\">Section</span>\n                                        <span className=\"text-sm font-bold text-gray-900 dark:text-gray-200\">{classroom.section || \"General\"}</span>\n                                    </div>\n                                    {isTeacher && (\n                                        <div className=\"flex flex-col\">\n                                            <span className=\"text-[10px] font-black text-gray-400 uppercase tracking-[0.2em] mb-1\">Join Link</span>\n                                            <button\n                                                onClick={handleCopyLink}\n                                                className=\"flex items-center gap-2 group\"\n                                            >\n                                                <span className=\"text-sm font-mono font-black text-orange-600 tracking-wider\">\n                                                    {classroom.joinCode}\n                                                </span>\n                                                <div className=\"p-1.5 bg-orange-50 dark:bg-orange-500/10 rounded-lg text-orange-600 dark:text-orange-500 hover:bg-orange-100 dark:hover:bg-orange-500/20 transition-all\">\n                                                    {isCopied ? <Check className=\"w-3.5 h-3.5\" /> : <Copy className=\"w-3.5 h-3.5\" />}\n                                                </div>\n                                            </button>\n                                        </div>\n                                    )}\n                                </div>\n                            </div>\n\n                            <div className=\"flex items-center gap-4\">\n                                <Link\n                                    href=\"/problems\"\n                                    className=\"px-6 py-3 bg-gray-900 dark:bg-white text-white dark:text-black text-xs font-black uppercase tracking-widest hover:bg-orange-600 dark:hover:bg-gray-200 transition-all shadow-xl shadow-gray-200 dark:shadow-none\"\n                                >\n                                    Solve Problems\n                                </Link>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                {/* Content Section */}\n                <div className={`py-12 ${isTeacher ? 'px-8 md:px-12' : ''}`}>\n                    <AnimatePresence mode=\"wait\">\n                        {activeTab === 'leaderboard' && (\n                            <motion.div\n                                key=\"leaderboard\"\n                                initial={{ opacity: 0 }}\n                                animate={{ opacity: 1 }}\n                                exit={{ opacity: 0 }}\n                                transition={{ duration: 0.25 }}\n                                className={`bg-white dark:bg-[#141414] rounded-2xl ${\n                                    isTeacher ? \"border-2 border-orange-50 dark:border-[#262626]\" : \"border border-gray-100 dark:border-[#262626] shadow-xl dark:shadow-none\"\n                                }`}\n                            >\n                                <ClassroomLeaderboard\n                                    students={classroom.students}\n                                    isTeacher={isTeacher}\n                                    classroomId={classroom.id}\n                                />\n                            </motion.div>\n                        )}\n                        {activeTab === 'assignments' && (\n                            <motion.div\n                                key=\"assignments\"\n                                initial={{ opacity: 0 }}\n                                animate={{ opacity: 1 }}\n                                exit={{ opacity: 0 }}\n                                transition={{ duration: 0.25 }}\n                            >\n                                <AssignmentsTab classroomId={classroom.id} isTeacher={isTeacher} />\n                            </motion.div>\n                        )}\n                        {activeTab === 'contests' && (\n                            <motion.div\n                                key=\"contests\"\n                                initial={{ opacity: 0 }}\n                                animate={{ opacity: 1 }}\n                                exit={{ opacity: 0 }}\n                                transition={{ duration: 0.25 }}\n                            >\n                                <ContestVerificationTab classroomId={classroom.id} />\n                            </motion.div>\n                        )}\n                        {activeTab === 'tracking' && (\n                            <motion.div\n                                key=\"tracking\"\n                                initial={{ opacity: 0 }}\n                                animate={{ opacity: 1 }}\n                                exit={{ opacity: 0 }}\n                                transition={{ duration: 0.25 }}\n                            >\n                                <LiveTracking classroomId={classroom.id} />\n                            </motion.div>\n                        )}\n                    </AnimatePresence>\n                </div>\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}}]
}