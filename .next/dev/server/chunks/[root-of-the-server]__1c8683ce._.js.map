{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 136, "column": 0}, "map": {"version":3,"sources":["file:///home/vishnu/Documents/projects/Algo-fox/lib/redis.ts"],"sourcesContent":["import IORedis from \"ioredis\";\n\nconst connection = new IORedis({\n  host: process.env.REDIS_HOST || \"127.0.0.1\",\n  port: parseInt(process.env.REDIS_PORT || \"6379\"),\n  maxRetriesPerRequest: null,\n  enableReadyCheck: false,\n});\n\nconnection.on(\"error\", (error) => {\n  if (process.env.NODE_ENV !== \"production\") {\n    console.warn(\"[Redis] Connection error:\", error);\n  }\n});\n\nexport default connection;\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,aAAa,IAAI,oJAAO,CAAC;IAC7B,MAAM,QAAQ,GAAG,CAAC,UAAU,IAAI;IAChC,MAAM,SAAS,QAAQ,GAAG,CAAC,UAAU,IAAI;IACzC,sBAAsB;IACtB,kBAAkB;AACpB;AAEA,WAAW,EAAE,CAAC,SAAS,CAAC;IACtB,wCAA2C;QACzC,QAAQ,IAAI,CAAC,6BAA6B;IAC5C;AACF;uCAEe"}},
    {"offset": {"line": 164, "column": 0}, "map": {"version":3,"sources":["file:///home/vishnu/Documents/projects/Algo-fox/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\n\nconst prismaClientSingleton = () => {\n    return new PrismaClient({\n        log: process.env.NODE_ENV === 'development' ? ['error', 'warn'] : ['error'],\n    }).$extends({\n        query: {\n            $allModels: {\n                async $allOperations({ operation, model, args, query }) {\n                    const start = performance.now();\n                    const result = await query(args);\n                    const end = performance.now();\n\n                    // Warn about slow queries (>1 second)\n                    if (end - start > 1000) {\n                        console.warn(`Slow query: ${model}.${operation} took ${(end - start).toFixed(2)}ms`);\n                    }\n\n                    return result;\n                },\n            },\n        },\n    });\n};\n\ntype PrismaClientSingleton = ReturnType<typeof prismaClientSingleton>;\n\ndeclare global {\n    var prisma_fox: PrismaClientSingleton | undefined;\n}\n\nconst prisma = globalThis.prisma_fox ?? prismaClientSingleton();\n\nexport { prisma };\n\nif (process.env.NODE_ENV !== \"production\") globalThis.prisma_fox = prisma;\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,wBAAwB;IAC1B,OAAO,IAAI,6IAAY,CAAC;QACpB,KAAK,uCAAyC;YAAC;YAAS;SAAO,GAAG;IACtE,GAAG,QAAQ,CAAC;QACR,OAAO;YACH,YAAY;gBACR,MAAM,gBAAe,EAAE,SAAS,EAAE,KAAK,EAAE,IAAI,EAAE,KAAK,EAAE;oBAClD,MAAM,QAAQ,YAAY,GAAG;oBAC7B,MAAM,SAAS,MAAM,MAAM;oBAC3B,MAAM,MAAM,YAAY,GAAG;oBAE3B,sCAAsC;oBACtC,IAAI,MAAM,QAAQ,MAAM;wBACpB,QAAQ,IAAI,CAAC,CAAC,YAAY,EAAE,MAAM,CAAC,EAAE,UAAU,MAAM,EAAE,CAAC,MAAM,KAAK,EAAE,OAAO,CAAC,GAAG,EAAE,CAAC;oBACvF;oBAEA,OAAO;gBACX;YACJ;QACJ;IACJ;AACJ;AAQA,MAAM,SAAS,WAAW,UAAU,IAAI;;AAIxC,wCAA2C,WAAW,UAAU,GAAG"}},
    {"offset": {"line": 200, "column": 0}, "map": {"version":3,"sources":["file:///home/vishnu/Documents/projects/Algo-fox/lib/auth.ts"],"sourcesContent":["import { betterAuth } from \"better-auth\";\nimport { admin } from \"better-auth/plugins\";\nimport { prismaAdapter } from \"better-auth/adapters/prisma\";\nimport { prisma } from \"./prisma\";\n\nexport const auth = betterAuth({\n  database: prismaAdapter(prisma, {\n    provider: \"postgresql\",\n  }),\n  emailAndPassword: {\n    enabled: true,\n    disableSignUp: true,\n  },\n  socialProviders: {\n    google: {\n      enabled: true,\n      clientId: process.env.GOOGLE_CLIENT_ID as string,\n      clientSecret: process.env.GOOGLE_CLIENT_SECRET as string,\n    },\n    microsoft: {\n      enabled: true,\n      clientId: process.env.MICROSOFT_CLIENT_ID as string,\n      clientSecret: process.env.MICROSOFT_CLIENT_SECRET as string,\n    },\n  },\n  user: {\n    additionalFields: {\n      role: {\n        type: \"string\",\n        required: false,\n        defaultValue: \"STUDENT\",\n      },\n      institutionId: {\n        type: \"string\",\n        required: false,\n      },\n      onboardingCompleted: {\n        type: \"boolean\",\n        required: false,\n        defaultValue: false,\n        input: false,\n      },\n    },\n  },\n\n  plugins: [\n    admin({\n      adminRoles: [\"ADMIN\"],\n      defaultRole: \"STUDENT\",\n      adminUserIds: [\"jvp0LDpaCm0Y2VpUVP75vCNQnDioEdpm\"], // vishnu\n    }),\n  ],\n});\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AACA;;;;;AAEO,MAAM,OAAO,IAAA,qKAAU,EAAC;IAC7B,UAAU,IAAA,8MAAa,EAAC,uHAAM,EAAE;QAC9B,UAAU;IACZ;IACA,kBAAkB;QAChB,SAAS;QACT,eAAe;IACjB;IACA,iBAAiB;QACf,QAAQ;YACN,SAAS;YACT,UAAU,QAAQ,GAAG,CAAC,gBAAgB;YACtC,cAAc,QAAQ,GAAG,CAAC,oBAAoB;QAChD;QACA,WAAW;YACT,SAAS;YACT,UAAU,QAAQ,GAAG,CAAC,mBAAmB;YACzC,cAAc,QAAQ,GAAG,CAAC,uBAAuB;QACnD;IACF;IACA,MAAM;QACJ,kBAAkB;YAChB,MAAM;gBACJ,MAAM;gBACN,UAAU;gBACV,cAAc;YAChB;YACA,eAAe;gBACb,MAAM;gBACN,UAAU;YACZ;YACA,qBAAqB;gBACnB,MAAM;gBACN,UAAU;gBACV,cAAc;gBACd,OAAO;YACT;QACF;IACF;IAEA,SAAS;QACP,IAAA,6KAAK,EAAC;YACJ,YAAY;gBAAC;aAAQ;YACrB,aAAa;YACb,cAAc;gBAAC;aAAmC;QACpD;KACD;AACH"}},
    {"offset": {"line": 270, "column": 0}, "map": {"version":3,"sources":["file:///home/vishnu/Documents/projects/Algo-fox/proxy.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport type { NextRequest } from \"next/server\";\nimport redis from \"@/lib/redis\";\nimport { auth } from \"@/lib/auth\";\n\n// RATE LIMITS\nconst RATE_LIMITS = {\n  \"/api\": { requests: 200, window: 60 }, // 100 requests per minute\n  \"/problems\": { requests: 100, window: 60 }, // 200 requests per minute\n} as const;\n\nexport default async function proxy(request: NextRequest) {\n  const pathname = request.nextUrl.pathname;\n\n  const cacheType = redis.status === \"ready\" ? \"Redis\" : \"Inbuilt\";\n  console.log(`[Cache: ${cacheType}] ${request.method} ${pathname}`);\n\n  const isAuthProtected =\n    pathname.startsWith(\"/admin\") ||\n    pathname.startsWith(\"/dashboard/institution\") ||\n    pathname.startsWith(\"/dashboard/teacher\") ||\n    pathname.startsWith(\"/dashboard/contests\");\n\n  if (isAuthProtected) {\n    try {\n      const session = await auth.api.getSession({\n        headers: request.headers,\n      });\n\n      if (!session) {\n        return NextResponse.redirect(new URL(\"/signin\", request.url));\n      }\n\n      const userRole = (session.user as any).role;\n\n      // ADMIN PROTECTION\n      if (pathname.startsWith(\"/admin\") && userRole !== \"ADMIN\") {\n        return NextResponse.redirect(new URL(\"/\", request.url));\n      }\n\n      // INSTUTION MANAGER PROTECTION\n      if (\n        pathname.startsWith(\"/dashboard/institution\") &&\n        userRole !== \"INSTITUTION_MANAGER\"\n      ) {\n        return NextResponse.redirect(new URL(\"/\", request.url));\n      }\n\n      // TEACHER & CONTESTMANAGER PROTECTION\n      if (\n        (pathname.startsWith(\"/dashboard/teacher\") ||\n          pathname.startsWith(\"/dashboard/contests\")) &&\n        ![\n          \"TEACHER\",\n          \"ADMIN\",\n          \"INSTITUTION_MANAGER\",\n          \"CONTEST_MANAGER\",\n        ].includes(userRole)\n      ) {\n        return NextResponse.redirect(new URL(\"/\", request.url));\n      }\n    } catch (error) {\n      console.error(\"Auth middleware error:\", error);\n      return NextResponse.redirect(new URL(\"/signin\", request.url));\n    }\n  }\n\n  // RATE LIMITING\n  const ip =\n    request.headers.get(\"x-forwarded-for\") ??\n    request.headers.get(\"x-real-ip\") ??\n    \"unknown\";\n\n  // FINDING MATCHING RATE LIMIT CONFIGURATION\n  const limitEntry = Object.entries(RATE_LIMITS).find(([path]) =>\n    pathname.startsWith(path)\n  );\n\n  if (!limitEntry) {\n    return NextResponse.next();\n  }\n\n  const [, limit] = limitEntry;\n  const key = `rate-limit:${ip}:${pathname.split(\"/\").slice(0, 3).join(\"/\")}`;\n\n  try {\n    const count = await redis.incr(key);\n\n    // SETTING EXPIRY ON FIRST REQUEST\n    if (count === 1) {\n      await redis.expire(key, limit.window);\n    }\n\n    // CHECKING IF RATE LIMIT EXCEEDED\n    if (count > limit.requests) {\n      return NextResponse.json(\n        {\n          error: \"Rate limit exceeded\",\n          retryAfter: limit.window,\n        },\n        {\n          status: 429,\n          headers: {\n            \"Retry-After\": limit.window.toString(),\n            \"X-RateLimit-Limit\": limit.requests.toString(),\n            \"X-RateLimit-Remaining\": \"0\",\n            \"X-RateLimit-Reset\": (Date.now() + limit.window * 1000).toString(),\n          },\n        }\n      );\n    }\n\n    // ADDING RATE LIMIT HEADERS TO RESPONSE\n    const response = NextResponse.next();\n    response.headers.set(\"X-RateLimit-Limit\", limit.requests.toString());\n    response.headers.set(\n      \"X-RateLimit-Remaining\",\n      (limit.requests - count).toString()\n    );\n\n    return response;\n  } catch (error) {\n    console.error(\"Rate limiting error:\", error);\n    return NextResponse.next();\n  }\n}\n\n// CONFIGURING WHICH ROUTES TO APPLY MIDDLEWARE TO\nexport const config = {\n  matcher: [\n    \"/api/:path*\",\n    \"/problems/:path*\",\n    \"/admin/:path*\",\n    \"/dashboard/institution/:path*\",\n    \"/dashboard/teacher/:path*\",\n    \"/dashboard/contests/:path*\",\n  ],\n};\n"],"names":[],"mappings":"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"}}]
}