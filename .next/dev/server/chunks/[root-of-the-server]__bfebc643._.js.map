{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///home/vishnu/Documents/projects/Algo-fox/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\n\nconst prismaClientSingleton = () => {\n    return new PrismaClient({\n        log: process.env.NODE_ENV === 'development' ? ['error', 'warn'] : ['error'],\n    }).$extends({\n        query: {\n            $allModels: {\n                async $allOperations({ operation, model, args, query }) {\n                    const start = performance.now();\n                    const result = await query(args);\n                    const end = performance.now();\n\n                    // Warn about slow queries (>1 second)\n                    if (end - start > 1000) {\n                        console.warn(`Slow query: ${model}.${operation} took ${(end - start).toFixed(2)}ms`);\n                    }\n\n                    return result;\n                },\n            },\n        },\n    });\n};\n\ntype PrismaClientSingleton = ReturnType<typeof prismaClientSingleton>;\n\ndeclare global {\n    var prisma_fox: PrismaClientSingleton | undefined;\n}\n\nconst prisma = globalThis.prisma_fox ?? prismaClientSingleton();\n\nexport { prisma };\n\nif (process.env.NODE_ENV !== \"production\") globalThis.prisma_fox = prisma;\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,wBAAwB;IAC1B,OAAO,IAAI,6IAAY,CAAC;QACpB,KAAK,uCAAyC;YAAC;YAAS;SAAO,GAAG;IACtE,GAAG,QAAQ,CAAC;QACR,OAAO;YACH,YAAY;gBACR,MAAM,gBAAe,EAAE,SAAS,EAAE,KAAK,EAAE,IAAI,EAAE,KAAK,EAAE;oBAClD,MAAM,QAAQ,YAAY,GAAG;oBAC7B,MAAM,SAAS,MAAM,MAAM;oBAC3B,MAAM,MAAM,YAAY,GAAG;oBAE3B,sCAAsC;oBACtC,IAAI,MAAM,QAAQ,MAAM;wBACpB,QAAQ,IAAI,CAAC,CAAC,YAAY,EAAE,MAAM,CAAC,EAAE,UAAU,MAAM,EAAE,CAAC,MAAM,KAAK,EAAE,OAAO,CAAC,GAAG,EAAE,CAAC;oBACvF;oBAEA,OAAO;gBACX;YACJ;QACJ;IACJ;AACJ;AAQA,MAAM,SAAS,WAAW,UAAU,IAAI;;AAIxC,wCAA2C,WAAW,UAAU,GAAG"}},
    {"offset": {"line": 88, "column": 0}, "map": {"version":3,"sources":["file:///home/vishnu/Documents/projects/Algo-fox/lib/auth.ts"],"sourcesContent":["import { betterAuth } from \"better-auth\";\nimport { admin } from \"better-auth/plugins\";\nimport { prismaAdapter } from \"better-auth/adapters/prisma\";\nimport { prisma } from \"./prisma\";\n\nexport const auth = betterAuth({\n  database: prismaAdapter(prisma, {\n    provider: \"postgresql\",\n  }),\n  emailAndPassword: {\n    enabled: true,\n    disableSignUp: true,\n  },\n  socialProviders: {\n    google: {\n      enabled: true,\n      clientId: process.env.GOOGLE_CLIENT_ID as string,\n      clientSecret: process.env.GOOGLE_CLIENT_SECRET as string,\n    },\n    microsoft: {\n      enabled: true,\n      clientId: process.env.MICROSOFT_CLIENT_ID as string,\n      clientSecret: process.env.MICROSOFT_CLIENT_SECRET as string,\n    },\n  },\n  user: {\n    additionalFields: {\n      role: {\n        type: \"string\",\n        required: false,\n        defaultValue: \"STUDENT\",\n      },\n      institutionId: {\n        type: \"string\",\n        required: false,\n      },\n      onboardingCompleted: {\n        type: \"boolean\",\n        required: false,\n        defaultValue: false,\n        input: false,\n      },\n    },\n  },\n\n  plugins: [\n    admin({\n      adminRoles: [\"ADMIN\"],\n      defaultRole: \"STUDENT\",\n      adminUserIds: [\"jvp0LDpaCm0Y2VpUVP75vCNQnDioEdpm\"], // vishnu\n    }),\n  ],\n});\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AACA;;;;;AAEO,MAAM,OAAO,IAAA,uKAAU,EAAC;IAC7B,UAAU,IAAA,gNAAa,EAAC,yHAAM,EAAE;QAC9B,UAAU;IACZ;IACA,kBAAkB;QAChB,SAAS;QACT,eAAe;IACjB;IACA,iBAAiB;QACf,QAAQ;YACN,SAAS;YACT,UAAU,QAAQ,GAAG,CAAC,gBAAgB;YACtC,cAAc,QAAQ,GAAG,CAAC,oBAAoB;QAChD;QACA,WAAW;YACT,SAAS;YACT,UAAU,QAAQ,GAAG,CAAC,mBAAmB;YACzC,cAAc,QAAQ,GAAG,CAAC,uBAAuB;QACnD;IACF;IACA,MAAM;QACJ,kBAAkB;YAChB,MAAM;gBACJ,MAAM;gBACN,UAAU;gBACV,cAAc;YAChB;YACA,eAAe;gBACb,MAAM;gBACN,UAAU;YACZ;YACA,qBAAqB;gBACnB,MAAM;gBACN,UAAU;gBACV,cAAc;gBACd,OAAO;YACT;QACF;IACF;IAEA,SAAS;QACP,IAAA,+KAAK,EAAC;YACJ,YAAY;gBAAC;aAAQ;YACrB,aAAa;YACb,cAAc;gBAAC;aAAmC;QACpD;KACD;AACH"}},
    {"offset": {"line": 248, "column": 0}, "map": {"version":3,"sources":["file:///home/vishnu/Documents/projects/Algo-fox/app/api/sse/submission/%5Bid%5D/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { auth } from \"@/lib/auth\";\nimport { headers } from \"next/headers\";\nimport { prisma } from \"@/lib/prisma\";\nimport IORedis from \"ioredis\";\n\n// SSE Endpoint\nexport async function GET(\n    req: NextRequest,\n    context: { params: Promise<{ id: string }> } // Explicit type for params\n) {\n    const { id: submissionId } = await context.params;\n\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n\n    if (!session || !session.user) {\n        return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n    }\n\n    // Verify ownership\n    const submission = await prisma.submission.findUnique({\n        where: { id: submissionId },\n        select: { userId: true, status: true }\n    });\n\n    if (!submission) {\n        return NextResponse.json({ error: \"Not found\" }, { status: 404 });\n    }\n\n    if (submission.userId !== session.user.id) {\n        return NextResponse.json({ error: \"Unauthorized\" }, { status: 403 });\n    }\n\n    // Create a new Redis client for subscription\n    const redis = new IORedis({\n        host: process.env.REDIS_HOST || \"127.0.0.1\",\n        port: parseInt(process.env.REDIS_PORT || \"6379\"),\n        maxRetriesPerRequest: null,\n        enableReadyCheck: false, // Prevent ioredis from trying to run INFO commands\n    });\n\n    // Create a ReadableStream for SSE\n    const stream = new ReadableStream({\n        async start(controller) {\n\n            // 1. Send Initial State (In case we missed events or are reconnecting)\n            // Fetch latest from DB\n            const latest = await prisma.submission.findUnique({\n                 where: { id: submissionId },\n                 include: { testCases: true }\n            });\n\n            if (latest) {\n                 const completedCases = latest.testCases.filter(tc => tc.status !== \"PENDING\");\n                 if (completedCases.length > 0) {\n                     const data = JSON.stringify({\n                         type: \"CASE_UPDATE\",\n                         data: completedCases.map(tc => ({\n                             index: tc.index,\n                             status: tc.status,\n                             time: tc.time,\n                             memory: tc.memory,\n                             errorMessage: tc.errorMessage,\n                             stdout: tc.stdout\n                         }))\n                     });\n                     controller.enqueue(`data: ${data}\\n\\n`);\n                 }\n\n                 if (latest.status !== \"PENDING\") {\n                     const data = JSON.stringify({\n                         type: \"COMPLETE\",\n                         data: {\n                             status: latest.status,\n                             time: latest.time,\n                             memory: latest.memory\n                         }\n                     });\n                     controller.enqueue(`data: ${data}\\n\\n`);\n                     // If already complete, we can close stream\n                     controller.close();\n                     redis.quit();\n                     return;\n                 }\n            }\n\n            // 2. Subscribe to Redis Channel\n            await redis.subscribe(`submission:${submissionId}`);\n\n            redis.on(\"message\", (channel, message) => {\n                if (channel === `submission:${submissionId}`) {\n                    controller.enqueue(`data: ${message}\\n\\n`);\n\n                    // If complete, close connection\n                    const parsed = JSON.parse(message);\n                    if (parsed.type === \"COMPLETE\") {\n                        controller.close();\n                        redis.quit();\n                    }\n                }\n            });\n        },\n        cancel() {\n            redis.quit();\n        }\n    });\n\n    return new NextResponse(stream, {\n        headers: {\n            \"Content-Type\": \"text/event-stream\",\n            \"Cache-Control\": \"no-cache\",\n            \"Connection\": \"keep-alive\",\n        },\n    });\n}\n"],"names":[],"mappings":"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"}}]
}