{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/vishnu/Documents/projects/Algo-fox/components/ui/table.tsx"],"sourcesContent":["import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\n      \"p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]\",\n      className\n    )}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AAAA;AAEA;;;;AAEA,MAAM,sBAAQ,2KAAgB,MAG5B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QAAI,WAAU;kBACb,cAAA,6LAAC;YACC,KAAK;YACL,WAAW,IAAA,qHAAE,EAAC,iCAAiC;YAC9C,GAAG,KAAK;;;;;;;;;;;;AAIf,MAAM,WAAW,GAAG;AAEpB,MAAM,4BAAc,2KAAgB,OAGlC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QAAM,KAAK;QAAK,WAAW,IAAA,qHAAE,EAAC,mBAAmB;QAAa,GAAG,KAAK;;;;;;;AAEzE,YAAY,WAAW,GAAG;AAE1B,MAAM,0BAAY,2KAAgB,OAGhC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,qHAAE,EAAC,8BAA8B;QAC3C,GAAG,KAAK;;;;;;;AAGb,UAAU,WAAW,GAAG;AAExB,MAAM,4BAAc,2KAAgB,OAGlC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,qHAAE,EACX,2DACA;QAED,GAAG,KAAK;;;;;;;AAGb,YAAY,WAAW,GAAG;AAE1B,MAAM,yBAAW,2KAAgB,OAG/B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,qHAAE,EACX,+EACA;QAED,GAAG,KAAK;;;;;;;AAGb,SAAS,WAAW,GAAG;AAEvB,MAAM,0BAAY,2KAAgB,QAGhC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,qHAAE,EACX,0IACA;QAED,GAAG,KAAK;;;;;;;AAGb,UAAU,WAAW,GAAG;AAExB,MAAM,0BAAY,2KAAgB,QAGhC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,qHAAE,EACX,wFACA;QAED,GAAG,KAAK;;;;;;;AAGb,UAAU,WAAW,GAAG;AAExB,MAAM,6BAAe,2KAAgB,QAGnC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,qHAAE,EAAC,sCAAsC;QACnD,GAAG,KAAK;;;;;;;AAGb,aAAa,WAAW,GAAG"}},
    {"offset": {"line": 148, "column": 0}, "map": {"version":3,"sources":["file:///home/vishnu/Documents/projects/Algo-fox/components/ui/input.tsx"],"sourcesContent":["import * as React from \"react\"\nimport { cn } from \"@/lib/utils\"\n\nexport interface InputProps\n  extends React.InputHTMLAttributes<HTMLInputElement> {}\n\nconst Input = React.forwardRef<HTMLInputElement, InputProps>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n"],"names":[],"mappings":";;;;;AAAA;AACA;;;;AAKA,MAAM,sBAAQ,2KAAgB,MAC5B,CAAC,EAAE,SAAS,EAAE,IAAI,EAAE,GAAG,OAAO,EAAE;IAC9B,qBACE,6LAAC;QACC,MAAM;QACN,WAAW,IAAA,qHAAE,EACX,yUACA;QAEF,KAAK;QACJ,GAAG,KAAK;;;;;;AAGf;;AAEF,MAAM,WAAW,GAAG"}},
    {"offset": {"line": 183, "column": 0}, "map": {"version":3,"sources":["file:///home/vishnu/Documents/projects/Algo-fox/components/ui/badge.tsx"],"sourcesContent":["import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n        orange: \"border-transparent bg-orange-100 text-orange-800 border-orange-200\",\n        green: \"border-transparent bg-green-100 text-green-800 border-green-200\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n"],"names":[],"mappings":";;;;;;;AACA;AAEA;;;;AAEA,MAAM,gBAAgB,IAAA,0KAAG,EACvB,wKACA;IACE,UAAU;QACR,SAAS;YACP,SACE;YACF,WACE;YACF,aACE;YACF,SAAS;YACT,QAAQ;YACR,OAAO;QACT;IACF;IACA,iBAAiB;QACf,SAAS;IACX;AACF;AAOF,SAAS,MAAM,EAAE,SAAS,EAAE,OAAO,EAAE,GAAG,OAAmB;IACzD,qBACE,6LAAC;QAAI,WAAW,IAAA,qHAAE,EAAC,cAAc;YAAE;QAAQ,IAAI;QAAa,GAAG,KAAK;;;;;;AAExE;KAJS"}},
    {"offset": {"line": 233, "column": 0}, "map": {"version":3,"sources":["file:///home/vishnu/Documents/projects/Algo-fox/components/ui/select.tsx"],"sourcesContent":["import * as React from \"react\"\nimport { cn } from \"@/lib/utils\"\n\nexport interface SelectProps extends React.SelectHTMLAttributes<HTMLSelectElement> {}\n\nconst Select = React.forwardRef<HTMLSelectElement, SelectProps>(\n  ({ className, children, ...props }, ref) => {\n    return (\n      <div className=\"relative\">\n        <select\n          className={cn(\n            \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 appearance-none\",\n            className\n          )}\n          ref={ref}\n          {...props}\n        >\n            {children}\n        </select>\n        <div className=\"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none opacity-50\">\n            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><path d=\"m6 9 6 6 6-6\"/></svg>\n        </div>\n      </div>\n    )\n  }\n)\nSelect.displayName = \"Select\"\n\nexport { Select }\n"],"names":[],"mappings":";;;;;AAAA;AACA;;;;AAIA,MAAM,uBAAS,2KAAgB,MAC7B,CAAC,EAAE,SAAS,EAAE,QAAQ,EAAE,GAAG,OAAO,EAAE;IAClC,qBACE,6LAAC;QAAI,WAAU;;0BACb,6LAAC;gBACC,WAAW,IAAA,qHAAE,EACX,mSACA;gBAEF,KAAK;gBACJ,GAAG,KAAK;0BAEN;;;;;;0BAEL,6LAAC;gBAAI,WAAU;0BACX,cAAA,6LAAC;oBAAI,OAAM;oBAA6B,OAAM;oBAAK,QAAO;oBAAK,SAAQ;oBAAY,MAAK;oBAAO,QAAO;oBAAe,aAAY;oBAAI,eAAc;oBAAQ,gBAAe;8BAAQ,cAAA,6LAAC;wBAAK,GAAE;;;;;;;;;;;;;;;;;;;;;;AAIpM;;AAEF,OAAO,WAAW,GAAG"}},
    {"offset": {"line": 306, "column": 0}, "map": {"version":3,"sources":["file:///home/vishnu/Documents/projects/Algo-fox/actions/admin/user.action.ts"],"sourcesContent":["\"use server\";\n\nimport { prisma } from \"@/lib/prisma\";\nimport { auth } from \"@/lib/auth\";\nimport { headers } from \"next/headers\";\nimport { Role } from \"@prisma/client\";\nimport { revalidateTag } from \"next/cache\";\nimport redis from \"@/lib/redis\";\n\nexport async function getFilteredUsers(params: {\n    page: number;\n    limit: number;\n    search?: string;\n    roles?: Role[];\n    institutionId?: string;\n}) {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n\n    if (session?.user?.role !== \"ADMIN\") {\n        throw new Error(\"Unauthorized\");\n    }\n\n    const { page, limit, search, roles, institutionId } = params;\n    const skip = (page - 1) * limit;\n\n    const where: any = {};\n\n    if (search) {\n        where.OR = [\n            { name: { contains: search, mode: \"insensitive\" } },\n            { email: { contains: search, mode: \"insensitive\" } },\n        ];\n    }\n\n    if (roles && roles.length > 0) {\n        where.role = { in: roles };\n    }\n\n    if (institutionId && institutionId !== \"all\") {\n        if (institutionId === \"none\") {\n            where.institutionId = null;\n        } else {\n            where.institutionId = institutionId;\n        }\n    }\n\n    const [users, total] = await Promise.all([\n        prisma.user.findMany({\n            where,\n            skip,\n            take: limit,\n            orderBy: { createdAt: \"desc\" },\n            select: {\n                id: true,\n                name: true,\n                email: true,\n                role: true,\n                institutionId: true,\n                createdAt: true,\n                banned: true,\n            }\n        }),\n        prisma.user.count({ where })\n    ]);\n\n    return {\n        users,\n        total,\n    };\n}\n\nexport async function deleteUserAction(userId: string) {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n\n    if (session?.user?.role !== \"ADMIN\") {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    if (session.user.id === userId) {\n        return { success: false, error: \"You cannot delete yourself\" };\n    }\n\n    try {\n        await prisma.$transaction(async (tx) => {\n            // 1. Check for dependent classrooms\n            const classrooms = await tx.classroom.count({ where: { teacherId: userId } });\n            if (classrooms > 0) {\n                // Option A: Hard delete classrooms (dangerous but fulfills \"delete\" request)\n                await tx.classroom.deleteMany({ where: { teacherId: userId } });\n            }\n\n            // 2. Handle Problems (Nullable userId usually means we can keep the problem but orphan it)\n            await tx.problem.updateMany({\n                where: { userId: userId },\n                data: { userId: null }\n            });\n\n            // 3. Contests have onDelete: Cascade for creatorId, but let's be safe\n            // However, prisma might still need manual help if there are other relations\n\n            // Final Delete\n            await tx.user.delete({\n                where: { id: userId }\n            });\n        });\n\n        return { success: true };\n    } catch (error: any) {\n        console.error(\"Failed to delete user:\", error);\n        return { success: false, error: error.message || \"Failed to delete user\" };\n    }\n}\n\nexport async function updateUserRoleAction(userId: string, role: string) {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n\n    if (session?.user?.role !== \"ADMIN\") {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    try {\n        await prisma.user.update({\n            where: { id: userId },\n            data: { role: role as Role }\n        });\n\n        // Invalidate dashboard cache\n        revalidateTag(`dashboard-${userId}`, \"max\");\n        await redis.del(`dashboard:stats:${userId}`);\n\n        return { success: true };\n    } catch (error: any) {\n        console.error(\"Failed to update role:\", error);\n        return { success: false, error: error.message || \"Failed to update role\" };\n    }\n}\n"],"names":[],"mappings":";;;;;;;IAyEsB,mBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 321, "column": 0}, "map": {"version":3,"sources":["file:///home/vishnu/Documents/projects/Algo-fox/actions/admin/user.action.ts"],"sourcesContent":["\"use server\";\n\nimport { prisma } from \"@/lib/prisma\";\nimport { auth } from \"@/lib/auth\";\nimport { headers } from \"next/headers\";\nimport { Role } from \"@prisma/client\";\nimport { revalidateTag } from \"next/cache\";\nimport redis from \"@/lib/redis\";\n\nexport async function getFilteredUsers(params: {\n    page: number;\n    limit: number;\n    search?: string;\n    roles?: Role[];\n    institutionId?: string;\n}) {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n\n    if (session?.user?.role !== \"ADMIN\") {\n        throw new Error(\"Unauthorized\");\n    }\n\n    const { page, limit, search, roles, institutionId } = params;\n    const skip = (page - 1) * limit;\n\n    const where: any = {};\n\n    if (search) {\n        where.OR = [\n            { name: { contains: search, mode: \"insensitive\" } },\n            { email: { contains: search, mode: \"insensitive\" } },\n        ];\n    }\n\n    if (roles && roles.length > 0) {\n        where.role = { in: roles };\n    }\n\n    if (institutionId && institutionId !== \"all\") {\n        if (institutionId === \"none\") {\n            where.institutionId = null;\n        } else {\n            where.institutionId = institutionId;\n        }\n    }\n\n    const [users, total] = await Promise.all([\n        prisma.user.findMany({\n            where,\n            skip,\n            take: limit,\n            orderBy: { createdAt: \"desc\" },\n            select: {\n                id: true,\n                name: true,\n                email: true,\n                role: true,\n                institutionId: true,\n                createdAt: true,\n                banned: true,\n            }\n        }),\n        prisma.user.count({ where })\n    ]);\n\n    return {\n        users,\n        total,\n    };\n}\n\nexport async function deleteUserAction(userId: string) {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n\n    if (session?.user?.role !== \"ADMIN\") {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    if (session.user.id === userId) {\n        return { success: false, error: \"You cannot delete yourself\" };\n    }\n\n    try {\n        await prisma.$transaction(async (tx) => {\n            // 1. Check for dependent classrooms\n            const classrooms = await tx.classroom.count({ where: { teacherId: userId } });\n            if (classrooms > 0) {\n                // Option A: Hard delete classrooms (dangerous but fulfills \"delete\" request)\n                await tx.classroom.deleteMany({ where: { teacherId: userId } });\n            }\n\n            // 2. Handle Problems (Nullable userId usually means we can keep the problem but orphan it)\n            await tx.problem.updateMany({\n                where: { userId: userId },\n                data: { userId: null }\n            });\n\n            // 3. Contests have onDelete: Cascade for creatorId, but let's be safe\n            // However, prisma might still need manual help if there are other relations\n\n            // Final Delete\n            await tx.user.delete({\n                where: { id: userId }\n            });\n        });\n\n        return { success: true };\n    } catch (error: any) {\n        console.error(\"Failed to delete user:\", error);\n        return { success: false, error: error.message || \"Failed to delete user\" };\n    }\n}\n\nexport async function updateUserRoleAction(userId: string, role: string) {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n\n    if (session?.user?.role !== \"ADMIN\") {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    try {\n        await prisma.user.update({\n            where: { id: userId },\n            data: { role: role as Role }\n        });\n\n        // Invalidate dashboard cache\n        revalidateTag(`dashboard-${userId}`, \"max\");\n        await redis.del(`dashboard:stats:${userId}`);\n\n        return { success: true };\n    } catch (error: any) {\n        console.error(\"Failed to update role:\", error);\n        return { success: false, error: error.message || \"Failed to update role\" };\n    }\n}\n"],"names":[],"mappings":";;;;;;;IAqHsB,uBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 336, "column": 0}, "map": {"version":3,"sources":["file:///home/vishnu/Documents/projects/Algo-fox/components/admin/users/UserActions.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Dialog, DialogFooter, DialogHeader, DialogTitle, DialogDescription } from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select } from \"@/components/ui/select\";\nimport { toast } from \"sonner\";\nimport { authClient } from \"@/lib/auth-client\";\nimport { Ban, CheckCircle, Trash2, UserCog, Key, LogIn, Loader2 } from \"lucide-react\";\nimport { useRouter } from \"next/navigation\";\nimport { deleteUserAction, updateUserRoleAction } from \"@/actions/admin/user.action\";\n\ninterface UserActionsProps {\n    user: any; // Type from better-auth\n    onUpdate?: () => void;\n}\n\nexport default function UserActions({ user, onUpdate }: UserActionsProps) {\n    const router = useRouter();\n    const [loading, setLoading] = useState(false);\n    const [actionDialog, setActionDialog] = useState<\"ban\" | \"role\" | \"delete\" | null>(null);\n    const [banReason, setBanReason] = useState(\"\");\n    const [selectedRole, setSelectedRole] = useState(user.role || \"user\");\n\n    const handleImpersonate = async () => {\n        try {\n            setLoading(true);\n            const { data, error } = await authClient.admin.impersonateUser({\n                userId: user.id\n            });\n            if (error) throw error;\n            toast.success(`Impersonating ${user.name}`);\n            window.location.href = \"/dashboard\"; // Redirect to dashboard as user\n        } catch (err: any) {\n            toast.error(err.message || \"Failed to impersonate\");\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const handleBan = async () => {\n        try {\n            setLoading(true);\n            const { error } = await authClient.admin.banUser({\n                userId: user.id,\n                banReason: banReason || \"No reason provided\"\n            });\n            if (error) throw error;\n            toast.success(\"User banned successfully\");\n            setActionDialog(null);\n            router.refresh();\n            onUpdate?.();\n        } catch (err: any) {\n            toast.error(err.message || \"Failed to ban user\");\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const handleUnban = async () => {\n        try {\n            setLoading(true);\n            const { error } = await authClient.admin.unbanUser({\n                userId: user.id\n            });\n            if (error) throw error;\n            toast.success(\"User unbanned successfully\");\n            router.refresh();\n            onUpdate?.();\n        } catch (err: any) {\n            toast.error(err.message || \"Failed to unban user\");\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const handleSetRole = async () => {\n        try {\n            setLoading(true);\n            const res = await updateUserRoleAction(user.id, selectedRole);\n            if (!res.success) throw new Error(res.error);\n\n            toast.success(\"Role updated successfully\");\n            setActionDialog(null);\n            router.refresh();\n            onUpdate?.();\n        } catch (err: any) {\n            toast.error(err.message || \"Failed to update role\");\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const handleDelete = async () => {\n        try {\n            setLoading(true);\n            const res = await deleteUserAction(user.id);\n            if (!res.success) throw new Error(res.error);\n\n            toast.success(\"User deleted successfully\");\n            setActionDialog(null);\n            router.refresh();\n            onUpdate?.();\n        } catch (err: any) {\n            toast.error(err.message || \"Failed to delete user\");\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    return (\n        <div className=\"flex items-center gap-2\">\n            <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                title=\"Impersonate\"\n                onClick={handleImpersonate}\n                disabled={loading}\n            >\n                <LogIn className=\"w-4 h-4 text-blue-500\" />\n            </Button>\n\n            {user.banned ? (\n                <Button\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    title=\"Unban\"\n                    onClick={handleUnban}\n                    disabled={loading}\n                >\n                    <CheckCircle className=\"w-4 h-4 text-green-500\" />\n                </Button>\n            ) : (\n                <Button\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    title=\"Ban\"\n                    onClick={() => setActionDialog(\"ban\")}\n                    disabled={loading}\n                >\n                    <Ban className=\"w-4 h-4 text-orange-500\" />\n                </Button>\n            )}\n\n            <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                title=\"Change Role\"\n                onClick={() => setActionDialog(\"role\")}\n                disabled={loading}\n            >\n                <UserCog className=\"w-4 h-4 text-gray-500\" />\n            </Button>\n\n            <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                title=\"Delete User\"\n                className=\"hover:bg-red-50 dark:hover:bg-red-500/10\"\n                onClick={() => setActionDialog(\"delete\")}\n                disabled={loading}\n            >\n                <Trash2 className=\"w-4 h-4 text-red-500\" />\n            </Button>\n\n            {/* Ban Dialog */}\n            <Dialog open={actionDialog === \"ban\"} onOpenChange={(open) => !open && setActionDialog(null)}>\n                <DialogHeader>\n                    <DialogTitle>Ban User</DialogTitle>\n                    <DialogDescription>\n                        Are you sure you want to ban {user.name}? They will not be able to log in.\n                    </DialogDescription>\n                </DialogHeader>\n                <div className=\"py-4\">\n                    <label className=\"text-sm font-medium mb-2 block text-gray-700 dark:text-gray-300\">Reason</label>\n                    <Input\n                        value={banReason}\n                        onChange={(e) => setBanReason(e.target.value)}\n                        placeholder=\"Violation of terms...\"\n                        className=\"bg-white dark:bg-[#1a1a1a] dark:border-[#333] dark:text-white\"\n                    />\n                </div>\n                <DialogFooter>\n                    <Button variant=\"ghost\" onClick={() => setActionDialog(null)}>Cancel</Button>\n                    <Button variant=\"destructive\" onClick={handleBan} disabled={loading}>\n                        {loading && <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />}\n                        Ban User\n                    </Button>\n                </DialogFooter>\n            </Dialog>\n\n            {/* Role Dialog */}\n            <Dialog open={actionDialog === \"role\"} onOpenChange={(open) => !open && setActionDialog(null)}>\n                <DialogHeader>\n                    <DialogTitle>Change Role</DialogTitle>\n                    <DialogDescription>\n                        Update the role for {user.name}.\n                    </DialogDescription>\n                </DialogHeader>\n                <div className=\"py-4\">\n                    <label className=\"text-sm font-medium mb-2 block text-gray-700 dark:text-gray-300\">Role</label>\n                    <Select value={selectedRole} onChange={(e) => setSelectedRole(e.target.value)} className=\"bg-white dark:bg-[#1a1a1a] dark:border-[#333] dark:text-white\">\n                        <option value=\"user\">User</option>\n                        <option value=\"admin\">Admin</option>\n                        <option value=\"INSTITUTION_MANAGER\">Institution Manager</option>\n                        <option value=\"TEACHER\">Teacher</option>\n                    </Select>\n                </div>\n                <DialogFooter>\n                    <Button variant=\"ghost\" onClick={() => setActionDialog(null)}>Cancel</Button>\n                    <Button onClick={handleSetRole} disabled={loading} className=\"bg-orange-600 text-white\">\n                        {loading && <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />}\n                        Update Role\n                    </Button>\n                </DialogFooter>\n            </Dialog>\n\n            {/* Delete Dialog */}\n            <Dialog open={actionDialog === \"delete\"} onOpenChange={(open) => !open && setActionDialog(null)}>\n                <DialogHeader>\n                    <DialogTitle>Delete User</DialogTitle>\n                    <DialogDescription>\n                        Are you sure you want to delete {user.name}? This action cannot be undone.\n                    </DialogDescription>\n                </DialogHeader>\n                <DialogFooter>\n                    <Button variant=\"ghost\" onClick={() => setActionDialog(null)}>Cancel</Button>\n                    <Button variant=\"destructive\" onClick={handleDelete} disabled={loading}>\n                        {loading && <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />}\n                        Delete User\n                    </Button>\n                </DialogFooter>\n            </Dialog>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 874, "column": 0}, "map": {"version":3,"sources":["file:///home/vishnu/Documents/projects/Algo-fox/actions/admin/institution.ts"],"sourcesContent":["\"use server\";\n\nimport { InstitutionService } from \"@/core/services/institution.service\";\nimport { z } from \"zod\";\nimport { revalidatePath, revalidateTag } from \"next/cache\";\nimport redis from \"@/lib/redis\";\n\nconst institutionSchema = z.object({\n    name: z.string().min(2, \"Name must be at least 2 characters\"),\n    slug: z.string().min(2, \"Slug must be at least 2 characters\").regex(/^[a-z0-9-]+$/, \"Slug must be lowercase alphanumeric and hyphens\"),\n    logo: z.string().url().optional().or(z.literal(\"\")),\n    domain: z.string().optional().or(z.literal(\"\")),\n});\n\nconst updateInstitutionSchema = institutionSchema.partial();\n\nexport async function getInstitutions() {\n    try {\n        const institutions = await InstitutionService.getInstitutions();\n        return { success: true, institutions };\n    } catch (error) {\n        console.error(\"Failed to fetch institutions:\", error);\n        return { success: false, error: \"Failed to fetch institutions\" };\n    }\n}\n\nexport async function getInstitutionById(id: string) {\n    try {\n        const institution = await InstitutionService.getInstitutionById(id);\n        if (!institution) return { success: false, error: \"Institution not found\" };\n        return { success: true, institution };\n    } catch (error) {\n        console.error(\"Failed to fetch institution:\", error);\n        return { success: false, error: \"Failed to fetch institution\" };\n    }\n}\n\n\n// Redefining create in Service for clarity\nexport async function createInstitutionAction(data: z.infer<typeof institutionSchema>) {\n    try {\n        const validatedData = institutionSchema.parse(data);\n        // Directly use prisma for create if not in service yet\n        const { prisma } = await import(\"@/lib/prisma\");\n        const institution = await prisma.institution.create({\n            data: {\n                name: validatedData.name,\n                slug: validatedData.slug,\n                logo: validatedData.logo || null,\n                domain: validatedData.domain || null,\n            },\n        });\n\n        revalidatePath(\"/admin/institutions\");\n        return { success: true, data: institution };\n    } catch (error) {\n        if (error instanceof z.ZodError) {\n            return { success: false, error: error.issues[0].message };\n        }\n        console.error(\"Failed to create institution:\", error);\n        return { success: false, error: \"Failed to create institution\" };\n    }\n}\n\nexport async function updateInstitutionAction(id: string, data: z.infer<typeof updateInstitutionSchema>) {\n    try {\n        const validatedData = updateInstitutionSchema.parse(data);\n        const institution = await InstitutionService.updateInstitution(id, {\n            ...validatedData,\n            logo: validatedData.logo || undefined,\n            domain: validatedData.domain || undefined,\n        });\n\n        revalidatePath(\"/admin/institutions\");\n        revalidatePath(`/admin/institutions/${id}`);\n        return { success: true, data: institution };\n    } catch (error) {\n        if (error instanceof z.ZodError) {\n            return { success: false, error: error.issues[0].message };\n        }\n        console.error(\"Failed to update institution:\", error);\n        return { success: false, error: \"Failed to update institution\" };\n    }\n}\n\nexport async function assignInstitutionManager(email: string, institutionId: string) {\n    try {\n        const { prisma } = await import(\"@/lib/prisma\");\n        const user = await prisma.user.findUnique({\n            where: { email },\n        });\n\n        if (!user) {\n            return { success: false, error: \"User not found\" };\n        }\n\n        const updatedUser = await prisma.user.update({\n            where: { id: user.id },\n            data: {\n                role: \"INSTITUTION_MANAGER\",\n                institutionId: institutionId,\n            },\n        });\n\n        revalidatePath(\"/admin/users\");\n        revalidatePath(`/admin/institutions/${institutionId}`);\n        revalidateTag(`dashboard-${user.id}`, \"max\");\n        await redis.del(`dashboard:stats:${user.id}`);\n\n        return { success: true, data: updatedUser };\n    } catch (error) {\n        console.error(\"Failed to assign institution manager:\", error);\n        return { success: false, error: \"Failed to assign institution manager\" };\n    }\n}\n\nexport async function searchUsersByEmail(query: string) {\n    try {\n        const { prisma } = await import(\"@/lib/prisma\");\n        const users = await prisma.user.findMany({\n            where: {\n                email: {\n                    contains: query,\n                    mode: \"insensitive\",\n                },\n            },\n            select: {\n                id: true,\n                email: true,\n                name: true,\n            },\n            take: 5,\n        });\n\n        return { success: true, users };\n    } catch (error) {\n        console.error(\"Failed to search users:\", error);\n        return { success: false, error: \"Failed to search users\" };\n    }\n}\n\nexport async function removeInstitutionManager(userId: string, institutionId: string) {\n    try {\n        const { prisma } = await import(\"@/lib/prisma\");\n\n        // Downgrade to STUDENT and remove institution assignment\n        await prisma.user.update({\n            where: { id: userId },\n            data: {\n                role: \"STUDENT\",\n                institutionId: null,\n            },\n        });\n\n        revalidatePath(`/admin/institutions/${institutionId}`);\n        revalidateTag(`dashboard-${userId}`, \"max\");\n        await redis.del(`dashboard:stats:${userId}`);\n\n        return { success: true };\n    } catch (error) {\n        console.error(\"Failed to remove manager:\", error);\n        return { success: false, error: \"Failed to remove administrative access\" };\n    }\n}\n\nexport async function deleteInstitutionAction(id: string) {\n    try {\n        // First disconnect all users from this institution\n        const { prisma } = await import(\"@/lib/prisma\");\n\n        // This is a safety measure to avoid orphan institution IDs on users\n        await prisma.user.updateMany({\n            where: { institutionId: id },\n            data: { institutionId: null },\n        });\n\n        await InstitutionService.deleteInstitution(id);\n\n        revalidatePath(\"/admin/institutions\");\n        return { success: true };\n    } catch (error) {\n        console.error(\"Failed to delete institution:\", error);\n        return { success: false, error: \"Failed to delete institution. Ensure it has no active classrooms.\" };\n    }\n}\n\nexport async function getInstitutionUsers(institutionId: string, page: number = 1, searchQuery: string = \"\") {\n    try {\n        const { prisma } = await import(\"@/lib/prisma\");\n        const limit = 20;\n        const skip = (page - 1) * limit;\n\n        const where: any = {\n            institutionId,\n        };\n\n        if (searchQuery) {\n            where.OR = [\n                { name: { contains: searchQuery, mode: \"insensitive\" } },\n                { email: { contains: searchQuery, mode: \"insensitive\" } },\n            ];\n        }\n\n        const [users, total] = await Promise.all([\n            prisma.user.findMany({\n                where,\n                skip,\n                take: limit,\n                orderBy: { createdAt: \"desc\" },\n                select: {\n                    id: true,\n                    name: true,\n                    email: true,\n                    role: true,\n                    createdAt: true,\n                },\n            }),\n            prisma.user.count({ where }),\n        ]);\n\n        return { success: true, users, total };\n    } catch (error) {\n        console.error(\"Failed to fetch institution users:\", error);\n        return { success: false, error: \"Failed to fetch institution users\" };\n    }\n}\n\nexport async function removeUserFromInstitution(userId: string) {\n    try {\n        const { prisma } = await import(\"@/lib/prisma\");\n\n        const user = await prisma.user.update({\n            where: { id: userId },\n            data: {\n                institutionId: null,\n                // If they were a manager, teacher, etc. specifically for this institution,\n                // we might want to downgrade them to STUDENT, but for now we'll just remove the link.\n            },\n        });\n\n        revalidateTag(`user-${userId}`, \"max\");\n        revalidateTag(`dashboard-${userId}`, \"max\");\n\n        // Clear redis if it exists\n        try {\n            const redis = (await import(\"@/lib/redis\")).default;\n            await redis.del(`dashboard:stats:${userId}`);\n        } catch (e) {}\n\n        return { success: true };\n    } catch (error) {\n        console.error(\"Failed to remove user from institution:\", error);\n        return { success: false, error: \"Failed to remove user from institution\" };\n    }\n}\n"],"names":[],"mappings":";;;;;;;IAgBsB,kBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 889, "column": 0}, "map": {"version":3,"sources":["file:///home/vishnu/Documents/projects/Algo-fox/actions/admin/user.action.ts"],"sourcesContent":["\"use server\";\n\nimport { prisma } from \"@/lib/prisma\";\nimport { auth } from \"@/lib/auth\";\nimport { headers } from \"next/headers\";\nimport { Role } from \"@prisma/client\";\nimport { revalidateTag } from \"next/cache\";\nimport redis from \"@/lib/redis\";\n\nexport async function getFilteredUsers(params: {\n    page: number;\n    limit: number;\n    search?: string;\n    roles?: Role[];\n    institutionId?: string;\n}) {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n\n    if (session?.user?.role !== \"ADMIN\") {\n        throw new Error(\"Unauthorized\");\n    }\n\n    const { page, limit, search, roles, institutionId } = params;\n    const skip = (page - 1) * limit;\n\n    const where: any = {};\n\n    if (search) {\n        where.OR = [\n            { name: { contains: search, mode: \"insensitive\" } },\n            { email: { contains: search, mode: \"insensitive\" } },\n        ];\n    }\n\n    if (roles && roles.length > 0) {\n        where.role = { in: roles };\n    }\n\n    if (institutionId && institutionId !== \"all\") {\n        if (institutionId === \"none\") {\n            where.institutionId = null;\n        } else {\n            where.institutionId = institutionId;\n        }\n    }\n\n    const [users, total] = await Promise.all([\n        prisma.user.findMany({\n            where,\n            skip,\n            take: limit,\n            orderBy: { createdAt: \"desc\" },\n            select: {\n                id: true,\n                name: true,\n                email: true,\n                role: true,\n                institutionId: true,\n                createdAt: true,\n                banned: true,\n            }\n        }),\n        prisma.user.count({ where })\n    ]);\n\n    return {\n        users,\n        total,\n    };\n}\n\nexport async function deleteUserAction(userId: string) {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n\n    if (session?.user?.role !== \"ADMIN\") {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    if (session.user.id === userId) {\n        return { success: false, error: \"You cannot delete yourself\" };\n    }\n\n    try {\n        await prisma.$transaction(async (tx) => {\n            // 1. Check for dependent classrooms\n            const classrooms = await tx.classroom.count({ where: { teacherId: userId } });\n            if (classrooms > 0) {\n                // Option A: Hard delete classrooms (dangerous but fulfills \"delete\" request)\n                await tx.classroom.deleteMany({ where: { teacherId: userId } });\n            }\n\n            // 2. Handle Problems (Nullable userId usually means we can keep the problem but orphan it)\n            await tx.problem.updateMany({\n                where: { userId: userId },\n                data: { userId: null }\n            });\n\n            // 3. Contests have onDelete: Cascade for creatorId, but let's be safe\n            // However, prisma might still need manual help if there are other relations\n\n            // Final Delete\n            await tx.user.delete({\n                where: { id: userId }\n            });\n        });\n\n        return { success: true };\n    } catch (error: any) {\n        console.error(\"Failed to delete user:\", error);\n        return { success: false, error: error.message || \"Failed to delete user\" };\n    }\n}\n\nexport async function updateUserRoleAction(userId: string, role: string) {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n\n    if (session?.user?.role !== \"ADMIN\") {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    try {\n        await prisma.user.update({\n            where: { id: userId },\n            data: { role: role as Role }\n        });\n\n        // Invalidate dashboard cache\n        revalidateTag(`dashboard-${userId}`, \"max\");\n        await redis.del(`dashboard:stats:${userId}`);\n\n        return { success: true };\n    } catch (error: any) {\n        console.error(\"Failed to update role:\", error);\n        return { success: false, error: error.message || \"Failed to update role\" };\n    }\n}\n"],"names":[],"mappings":";;;;;;;IASsB,mBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 904, "column": 0}, "map": {"version":3,"sources":["file:///home/vishnu/Documents/projects/Algo-fox/components/admin/users/UserList.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Loader2, Search, ChevronLeft, ChevronRight } from \"lucide-react\";\nimport UserActions from \"./UserActions\";\nimport { format } from \"date-fns\";\nimport { getInstitutions } from \"@/actions/admin/institution\";\nimport { getFilteredUsers } from \"@/actions/admin/user.action\";\nimport { Role } from \"@prisma/client\";\nimport { Filter, X } from \"lucide-react\";\n\nexport default function UserList() {\n    const [users, setUsers] = useState<any[]>([]);\n    const [loading, setLoading] = useState(true);\n    const [total, setTotal] = useState(0);\n    const [page, setPage] = useState(1);\n    const [limit] = useState(10);\n    const [search, setSearch] = useState(\"\");\n    const [debouncedSearch, setDebouncedSearch] = useState(\"\");\n    const [institutions, setInstitutions] = useState<Record<string, string>>({});\n    const [selectedRoles, setSelectedRoles] = useState<Role[]>([]);\n    const [selectedInstitutionId, setSelectedInstitutionId] = useState<string>(\"all\");\n    const [isFilterOpen, setIsFilterOpen] = useState(false);\n\n    // Debounce search\n    useEffect(() => {\n        const timer = setTimeout(() => {\n            setDebouncedSearch(search);\n            setPage(1); // Reset to page 1 on search\n        }, 500);\n        return () => clearTimeout(timer);\n    }, [search]);\n\n    const fetchUsers = async () => {\n        setLoading(true);\n        try {\n            const res = await getFilteredUsers({\n                page,\n                limit,\n                search: debouncedSearch,\n                roles: selectedRoles,\n                institutionId: selectedInstitutionId,\n            });\n\n            if (res) {\n                setUsers(res.users);\n                setTotal(res.total || 0);\n            }\n        } catch (err) {\n            console.error(\"Failed to fetch users\", err);\n        } finally {\n            setLoading(false);\n        }\n    };\n    const fetchInstitutions = async () => {\n        const res = await getInstitutions();\n        if (res.success && res.institutions) {\n            const instMap: Record<string, string> = {};\n            res.institutions.forEach((inst: any) => {\n                instMap[inst.id] = inst.name;\n            });\n            setInstitutions(instMap);\n        }\n    };\n\n    useEffect(() => {\n        fetchUsers();\n    }, [page, limit, debouncedSearch, selectedRoles, selectedInstitutionId]);\n\n    useEffect(() => {\n        fetchInstitutions();\n    }, []);\n\n    const totalPages = Math.ceil(total / limit);\n\n    return (\n        <div>\n            {/* Toolbar */}\n            <div className=\"p-4 border-b border-gray-100 dark:border-[#262626] flex items-center justify-between gap-4 bg-gray-50/50 dark:bg-[#1a1a1a]\">\n                <div className=\"relative w-full max-w-sm\">\n                    <Search className=\"absolute left-2.5 top-2.5 h-4 w-4 text-gray-500 dark:text-gray-400\" />\n                    <Input\n                        placeholder=\"Search users...\"\n                        className=\"pl-9 bg-white dark:bg-[#141414] dark:border-[#333] dark:text-white dark:placeholder:text-gray-500\"\n                        value={search}\n                        onChange={(e) => setSearch(e.target.value)}\n                    />\n                </div>\n                <div className=\"flex items-center gap-2\">\n                    <Button\n                        variant={isFilterOpen ? \"secondary\" : \"outline\"}\n                        size=\"sm\"\n                        onClick={() => setIsFilterOpen(!isFilterOpen)}\n                        className=\"gap-2\"\n                    >\n                        <Filter className=\"w-4 h-4\" />\n                        Filters\n                    </Button>\n                    <Button variant=\"ghost\" size=\"icon\" onClick={fetchUsers} title=\"Refresh List\">\n                        <Loader2 className={`w-4 h-4 ${loading ? \"animate-spin\" : \"\"}`} />\n                    </Button>\n                    <div className=\"text-sm text-gray-500 dark:text-gray-400\">\n                        Total: <span className=\"font-medium text-gray-900 dark:text-white\">{total}</span> users\n                    </div>\n                </div>\n            </div>\n\n            {/* Filter Bar */}\n            {isFilterOpen && (\n                <div className=\"p-4 border-b border-gray-100 dark:border-[#262626] bg-white dark:bg-[#141414] animate-in slide-in-from-top-2 duration-200\">\n                    <div className=\"flex flex-col md:flex-row gap-6\">\n                        {/* Roles Filter */}\n                        <div className=\"flex-1\">\n                            <label className=\"text-[10px] font-black text-gray-400 uppercase tracking-widest mb-3 block\">Filter by Roles</label>\n                            <div className=\"flex flex-wrap gap-4\">\n                                {[\"ADMIN\", \"TEACHER\", \"INSTITUTION_MANAGER\", \"STUDENT\", \"CONTEST_MANAGER\"].map((role) => (\n                                    <label key={role} className=\"flex items-center gap-2 cursor-pointer group\">\n                                        <input\n                                            type=\"checkbox\"\n                                            className=\"w-4 h-4 rounded border-gray-300 dark:border-[#333] text-orange-600 focus:ring-orange-500 bg-white dark:bg-[#1a1a1a]\"\n                                            checked={selectedRoles.includes(role as Role)}\n                                            onChange={(e) => {\n                                                if (e.target.checked) {\n                                                    setSelectedRoles([...selectedRoles, role as Role]);\n                                                } else {\n                                                    setSelectedRoles(selectedRoles.filter(r => r !== role));\n                                                }\n                                                setPage(1);\n                                            }}\n                                        />\n                                        <span className=\"text-xs font-bold text-gray-600 dark:text-gray-400 group-hover:text-gray-900 dark:group-hover:text-gray-200 transition-colors uppercase tracking-tight\">\n                                            {role.replace('_', ' ')}\n                                        </span>\n                                    </label>\n                                ))}\n                            </div>\n                        </div>\n\n                        {/* Institution Filter */}\n                        <div className=\"w-full md:w-64\">\n                            <label className=\"text-[10px] font-black text-gray-400 uppercase tracking-widest mb-3 block\">Filter by Institution</label>\n                            <select\n                                className=\"w-full bg-gray-50 dark:bg-[#1a1a1a] border border-gray-200 dark:border-[#333] rounded-lg px-3 py-2 text-xs font-bold text-gray-900 dark:text-white focus:ring-2 focus:ring-orange-500 outline-none uppercase tracking-tighter\"\n                                value={selectedInstitutionId}\n                                onChange={(e) => {\n                                    setSelectedInstitutionId(e.target.value);\n                                    setPage(1);\n                                }}\n                            >\n                                <option value=\"all\">All Institutions</option>\n                                <option value=\"none\">Independent Users</option>\n                                {Object.entries(institutions).map(([id, name]) => (\n                                    <option key={id} value={id}>{name}</option>\n                                ))}\n                            </select>\n                        </div>\n                    </div>\n\n                    <div className=\"mt-4 pt-4 border-t border-gray-50 dark:border-[#1a1a1a] flex justify-end\">\n                        <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            className=\"text-[10px] uppercase tracking-widest font-black text-gray-400 hover:text-red-500\"\n                            onClick={() => {\n                                setSelectedRoles([]);\n                                setSelectedInstitutionId(\"all\");\n                                setPage(1);\n                            }}\n                        >\n                            Reset All Filters\n                        </Button>\n                    </div>\n                </div>\n            )}\n\n            {/* Table */}\n            <div className=\"relative min-h-[400px]\">\n                <Table>\n                    <TableHeader>\n                        <TableRow className=\"hover:bg-transparent border-gray-100 dark:border-[#262626]\">\n                            <TableHead className=\"text-gray-500 dark:text-gray-400\">User</TableHead>\n                            <TableHead className=\"text-gray-500 dark:text-gray-400\">Role</TableHead>\n                            <TableHead className=\"text-gray-500 dark:text-gray-400\">Institute</TableHead>\n                            <TableHead className=\"text-gray-500 dark:text-gray-400\">Status</TableHead>\n                            <TableHead className=\"text-gray-500 dark:text-gray-400\">Joined</TableHead>\n                            <TableHead className=\"text-right text-gray-500 dark:text-gray-400\">Actions</TableHead>\n                        </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                        {loading ? (\n                            <TableRow>\n                                <TableCell colSpan={5} className=\"h-[400px] text-center\">\n                                    <div className=\"flex flex-col items-center justify-center text-gray-500\">\n                                        <Loader2 className=\"w-8 h-8 animate-spin mb-2 text-orange-500\" />\n                                        <p>Loading users...</p>\n                                    </div>\n                                </TableCell>\n                            </TableRow>\n                        ) : users.length === 0 ? (\n                            <TableRow>\n                                <TableCell colSpan={5} className=\"h-[200px] text-center text-gray-500\">\n                                    No users found.\n                                </TableCell>\n                            </TableRow>\n                        ) : (\n                            users.map((user) => (\n                                <TableRow key={user.id} className=\"group hover:bg-orange-50/30 dark:hover:bg-orange-500/5 transition-colors border-gray-100 dark:border-[#262626]\">\n                                    <TableCell>\n                                        <div className=\"flex flex-col\">\n                                            <span className=\"font-medium text-gray-900 dark:text-gray-100\">{user.name}</span>\n                                            <span className=\"text-xs text-gray-500 dark:text-gray-400\">{user.email}</span>\n                                        </div>\n                                    </TableCell>\n                                    <TableCell>\n                                        <Badge variant=\"outline\" className=\"capitalize bg-white dark:bg-[#1a1a1a] shadow-sm dark:border-[#333] dark:text-gray-300\">\n                                            {user.role || \"user\"}\n                                        </Badge>\n                                    </TableCell>\n                                    <TableCell>\n                                        <span className=\"text-sm text-gray-600 dark:text-gray-400\">\n                                            {user.institutionId ? institutions[user.institutionId] || user.institutionId : \"None\"}\n                                        </span>\n                                    </TableCell>\n                                    <TableCell>\n                                        {user.banned ? (\n                                            <Badge variant=\"destructive\" className=\"items-center gap-1\">\n                                                Banned\n                                            </Badge>\n                                        ) : (\n                                            <Badge variant=\"secondary\" className=\"bg-green-100 dark:bg-green-500/10 text-green-700 dark:text-green-400 border-green-200 dark:border-green-500/20 hover:bg-green-100 dark:hover:bg-green-500/10\">\n                                                Active\n                                            </Badge>\n                                        )}\n                                    </TableCell>\n                                    <TableCell className=\"text-gray-500 dark:text-gray-400 text-sm\">\n                                        {user.createdAt ? format(new Date(user.createdAt), \"MMM d, yyyy\") : \"-\"}\n                                    </TableCell>\n                                    <TableCell className=\"text-right\">\n                                        <UserActions user={user} onUpdate={fetchUsers} />\n                                    </TableCell>\n                                </TableRow>\n                            ))\n                        )}\n                    </TableBody>\n                </Table>\n            </div>\n\n            {/* Pagination */}\n            <div className=\"p-4 border-t border-gray-100 dark:border-[#262626] flex items-center justify-between bg-gray-50/50 dark:bg-[#1a1a1a]\">\n                <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => setPage((p) => Math.max(1, p - 1))}\n                    disabled={page === 1 || loading}\n                    className=\"dark:bg-[#141414] dark:border-[#333] dark:text-gray-300 dark:hover:bg-[#262626]\"\n                >\n                    <ChevronLeft className=\"w-4 h-4 mr-2\" />\n                    Previous\n                </Button>\n                <div className=\"text-sm text-gray-500 dark:text-gray-400\">\n                    Page {page} of {Math.max(1, totalPages)}\n                </div>\n                <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => setPage((p) => Math.min(totalPages, p + 1))}\n                    disabled={page >= totalPages || loading}\n                    className=\"dark:bg-[#141414] dark:border-[#333] dark:text-gray-300 dark:hover:bg-[#262626]\"\n                >\n                    Next\n                    <ChevronRight className=\"w-4 h-4 ml-2\" />\n                </Button>\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1608, "column": 0}, "map": {"version":3,"sources":["file:///home/vishnu/Documents/projects/Algo-fox/components/admin/users/CreateUserDialog.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState } from \"react\";\nimport { Dialog, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select } from \"@/components/ui/select\";\nimport { toast } from \"sonner\";\nimport { authClient } from \"@/lib/auth-client\";\nimport { Plus, Loader2 } from \"lucide-react\";\nimport { useRouter } from \"next/navigation\";\n\n// Since I implemented a custom Dialog in the previous step that uses different exports (Dialog, DialogHeader... but not DialogContent/Trigger in the exact way radix does),\n// I need to adjust my usage or update the Dialog component.\n// My custom Dialog implementation in step 127 exported Dialog, DialogHeader, etc directly.\n// But typically Shadcn uses DialogTrigger, DialogContent.\n// My implementation: <Dialog open={open} onOpenChange={setOpen}> <children> </Dialog>\n// So I will wrap it myself.\n\nexport default function CreateUserDialog() {\n    const [open, setOpen] = useState(false);\n    const [loading, setLoading] = useState(false);\n    const router = useRouter();\n\n    const [formData, setFormData] = useState({\n        name: \"\",\n        email: \"\",\n        password: \"\",\n        role: \"user\"\n    });\n\n    const handleSubmit = async (e: React.FormEvent) => {\n        e.preventDefault();\n        setLoading(true);\n\n        try {\n            const { data, error } = await authClient.admin.createUser({\n                name: formData.name,\n                email: formData.email,\n                password: formData.password,\n                role: formData.role as any\n            });\n\n            if (error) {\n                toast.error(error.message || \"Failed to create user\");\n            } else {\n                toast.success(\"User created successfully\");\n                setOpen(false);\n                setFormData({ name: \"\", email: \"\", password: \"\", role: \"user\" });\n                router.refresh(); // Refresh to show new user\n            }\n        } catch (err) {\n            toast.error(\"An unexpected error occurred\");\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    return (\n        <>\n            <Button onClick={() => setOpen(true)} className=\"bg-orange-600 hover:bg-orange-700 text-white\">\n                <Plus className=\"w-4 h-4 mr-2\" />\n                Add User\n            </Button>\n\n            <Dialog open={open} onOpenChange={setOpen}>\n                <DialogHeader>\n                    <DialogTitle>Create New User</DialogTitle>\n                    <DialogDescription>\n                        Add a new user to the system. They will receive an email with their login details.\n                    </DialogDescription>\n                </DialogHeader>\n\n                <form onSubmit={handleSubmit} className=\"space-y-4 py-4\">\n                    <div className=\"space-y-2\">\n                        <label className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">Name</label>\n                        <Input\n                            required\n                            placeholder=\"John Doe\"\n                            value={formData.name}\n                            onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                            className=\"bg-white dark:bg-[#1a1a1a] dark:border-[#333] dark:text-white\"\n                        />\n                    </div>\n                    <div className=\"space-y-2\">\n                        <label className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">Email</label>\n                        <Input\n                            required\n                            type=\"email\"\n                            placeholder=\"john@example.com\"\n                            value={formData.email}\n                            onChange={(e) => setFormData({ ...formData, email: e.target.value })}\n                            className=\"bg-white dark:bg-[#1a1a1a] dark:border-[#333] dark:text-white\"\n                        />\n                    </div>\n                    <div className=\"space-y-2\">\n                        <label className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">Password</label>\n                        <Input\n                            required\n                            type=\"password\"\n                            placeholder=\"\"\n                            value={formData.password}\n                            onChange={(e) => setFormData({ ...formData, password: e.target.value })}\n                            className=\"bg-white dark:bg-[#1a1a1a] dark:border-[#333] dark:text-white\"\n                        />\n                    </div>\n                    <div className=\"space-y-2\">\n                        <label className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">Role</label>\n                        <Select\n                            value={formData.role}\n                            onChange={(e) => setFormData({ ...formData, role: e.target.value })}\n                            className=\"bg-white dark:bg-[#1a1a1a] dark:border-[#333] dark:text-white\"\n                        >\n                            <option value=\"user\">User</option>\n                            <option value=\"admin\">Admin</option>\n                            <option value=\"INSTITUTION_MANAGER\">Institution Manager</option>\n                            <option value=\"TEACHER\">Teacher</option>\n                        </Select>\n                    </div>\n\n                    <DialogFooter>\n                        <Button type=\"button\" variant=\"ghost\" onClick={() => setOpen(false)}>\n                            Cancel\n                        </Button>\n                        <Button type=\"submit\" disabled={loading} className=\"bg-orange-600 hover:bg-orange-700 text-white\">\n                            {loading && <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />}\n                            Create User\n                        </Button>\n                    </DialogFooter>\n                </form>\n            </Dialog>\n        </>\n    );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;;;AAVA;;;;;;;;;;AAmBe,SAAS;;IACpB,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,yKAAQ,EAAC;IACjC,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAC;IACvC,MAAM,SAAS,IAAA,kJAAS;IAExB,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAAC;QACrC,MAAM;QACN,OAAO;QACP,UAAU;QACV,MAAM;IACV;IAEA,MAAM,eAAe,OAAO;QACxB,EAAE,cAAc;QAChB,WAAW;QAEX,IAAI;YACA,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,sIAAU,CAAC,KAAK,CAAC,UAAU,CAAC;gBACtD,MAAM,SAAS,IAAI;gBACnB,OAAO,SAAS,KAAK;gBACrB,UAAU,SAAS,QAAQ;gBAC3B,MAAM,SAAS,IAAI;YACvB;YAEA,IAAI,OAAO;gBACP,oJAAK,CAAC,KAAK,CAAC,MAAM,OAAO,IAAI;YACjC,OAAO;gBACH,oJAAK,CAAC,OAAO,CAAC;gBACd,QAAQ;gBACR,YAAY;oBAAE,MAAM;oBAAI,OAAO;oBAAI,UAAU;oBAAI,MAAM;gBAAO;gBAC9D,OAAO,OAAO,IAAI,2BAA2B;YACjD;QACJ,EAAE,OAAO,KAAK;YACV,oJAAK,CAAC,KAAK,CAAC;QAChB,SAAU;YACN,WAAW;QACf;IACJ;IAEA,qBACI;;0BACI,6LAAC,wIAAM;gBAAC,SAAS,IAAM,QAAQ;gBAAO,WAAU;;kCAC5C,6LAAC,6MAAI;wBAAC,WAAU;;;;;;oBAAiB;;;;;;;0BAIrC,6LAAC,wIAAM;gBAAC,MAAM;gBAAM,cAAc;;kCAC9B,6LAAC,8IAAY;;0CACT,6LAAC,6IAAW;0CAAC;;;;;;0CACb,6LAAC,mJAAiB;0CAAC;;;;;;;;;;;;kCAKvB,6LAAC;wBAAK,UAAU;wBAAc,WAAU;;0CACpC,6LAAC;gCAAI,WAAU;;kDACX,6LAAC;wCAAM,WAAU;kDAAuD;;;;;;kDACxE,6LAAC,sIAAK;wCACF,QAAQ;wCACR,aAAY;wCACZ,OAAO,SAAS,IAAI;wCACpB,UAAU,CAAC,IAAM,YAAY;gDAAE,GAAG,QAAQ;gDAAE,MAAM,EAAE,MAAM,CAAC,KAAK;4CAAC;wCACjE,WAAU;;;;;;;;;;;;0CAGlB,6LAAC;gCAAI,WAAU;;kDACX,6LAAC;wCAAM,WAAU;kDAAuD;;;;;;kDACxE,6LAAC,sIAAK;wCACF,QAAQ;wCACR,MAAK;wCACL,aAAY;wCACZ,OAAO,SAAS,KAAK;wCACrB,UAAU,CAAC,IAAM,YAAY;gDAAE,GAAG,QAAQ;gDAAE,OAAO,EAAE,MAAM,CAAC,KAAK;4CAAC;wCAClE,WAAU;;;;;;;;;;;;0CAGlB,6LAAC;gCAAI,WAAU;;kDACX,6LAAC;wCAAM,WAAU;kDAAuD;;;;;;kDACxE,6LAAC,sIAAK;wCACF,QAAQ;wCACR,MAAK;wCACL,aAAY;wCACZ,OAAO,SAAS,QAAQ;wCACxB,UAAU,CAAC,IAAM,YAAY;gDAAE,GAAG,QAAQ;gDAAE,UAAU,EAAE,MAAM,CAAC,KAAK;4CAAC;wCACrE,WAAU;;;;;;;;;;;;0CAGlB,6LAAC;gCAAI,WAAU;;kDACX,6LAAC;wCAAM,WAAU;kDAAuD;;;;;;kDACxE,6LAAC,wIAAM;wCACH,OAAO,SAAS,IAAI;wCACpB,UAAU,CAAC,IAAM,YAAY;gDAAE,GAAG,QAAQ;gDAAE,MAAM,EAAE,MAAM,CAAC,KAAK;4CAAC;wCACjE,WAAU;;0DAEV,6LAAC;gDAAO,OAAM;0DAAO;;;;;;0DACrB,6LAAC;gDAAO,OAAM;0DAAQ;;;;;;0DACtB,6LAAC;gDAAO,OAAM;0DAAsB;;;;;;0DACpC,6LAAC;gDAAO,OAAM;0DAAU;;;;;;;;;;;;;;;;;;0CAIhC,6LAAC,8IAAY;;kDACT,6LAAC,wIAAM;wCAAC,MAAK;wCAAS,SAAQ;wCAAQ,SAAS,IAAM,QAAQ;kDAAQ;;;;;;kDAGrE,6LAAC,wIAAM;wCAAC,MAAK;wCAAS,UAAU;wCAAS,WAAU;;4CAC9C,yBAAW,6LAAC,+NAAO;gDAAC,WAAU;;;;;;4CAA+B;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQ1F;GAlHwB;;QAGL,kJAAS;;;KAHJ"}}]
}