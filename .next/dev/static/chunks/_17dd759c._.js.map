{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/vishnu/Documents/projects/Algo-fox/components/classroom/TeacherClassroomList.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState } from \"react\";\nimport { toast } from \"sonner\";\nimport Link from \"next/link\";\n\ninterface Classroom {\n    id: string;\n    name: string;\n    section: string | null;\n    subject: string | null;\n    joinCode: string;\n    _count: {\n        students: number;\n    };\n    createdAt: Date;\n}\n\ninterface TeacherClassroomListProps {\n    classrooms: Classroom[];\n}\n\nexport function TeacherClassroomList({ classrooms }: TeacherClassroomListProps) {\n    const [copiedId, setCopiedId] = useState<string | null>(null);\n\n    const copyLink = (code: string, id: string) => {\n        const url = `${window.location.origin}/join-classroom/${code}`;\n        navigator.clipboard.writeText(url);\n        setCopiedId(id);\n        toast.success(\"Join link copied!\");\n        setTimeout(() => setCopiedId(null), 2000);\n    };\n\n    if (classrooms.length === 0) {\n        return (\n            <div className=\"text-center py-20 bg-gray-50/50 dark:bg-[#141414] rounded-2xl border border-dashed border-gray-200 dark:border-[#262626]\">\n                <h3 className=\"text-sm font-bold text-gray-900 dark:text-white uppercase tracking-widest mb-2\">No Active Classrooms</h3>\n                <p className=\"text-xs text-gray-500 dark:text-gray-400 font-medium\">Create your first learning environment above.</p>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n            {classrooms.map((classroom) => (\n                <div\n                    key={classroom.id}\n                    className=\"group flex flex-col bg-white dark:bg-[#141414] border border-gray-100 dark:border-[#262626] p-6 rounded-md hover:border-orange-500 dark:hover:border-orange-500 shadow-sm dark:shadow-none\"\n                >\n                    <div className=\"flex justify-between items-start mb-6\">\n                        <div className=\"flex flex-col\">\n                            <span className=\"text-[10px] font-bold text-orange-600 uppercase tracking-widest mb-1\">\n                                Classroom\n                            </span>\n                            <h3 className=\"text-xl font-bold text-black dark:text-white group-hover:text-orange-600 transition-colors\">\n                                {classroom.name}\n                            </h3>\n                        </div>\n                        <div className=\"px-2 py-1 bg-gray-50 dark:bg-[#1a1a1a] text-gray-400 dark:text-gray-500 text-[10px] font-bold uppercase rounded\">\n                            {classroom._count.students} Students\n                        </div>\n                    </div>\n\n                    <div className=\"flex-grow flex flex-wrap gap-2 mb-6\">\n                        {classroom.subject && (\n                            <span className=\"text-[10px] font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wide px-2 py-1 bg-gray-50 dark:bg-[#1a1a1a] rounded\">\n                                {classroom.subject}\n                            </span>\n                        )}\n                        {classroom.section && (\n                            <span className=\"text-[10px] font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wide px-2 py-1 bg-gray-50 dark:bg-[#1a1a1a] rounded\">\n                                Sec {classroom.section}\n                            </span>\n                        )}\n                    </div>\n\n                    <div className=\"flex flex-col gap-4 pt-4 border-t border-gray-50 dark:border-[#262626]\">\n                        <div className=\"flex items-center justify-between\">\n                            <div className=\"space-y-1\">\n                                <span className=\"text-[9px] font-bold text-gray-300 dark:text-gray-600 uppercase block\">Join Link</span>\n                                <button\n                                    onClick={() => copyLink(classroom.joinCode, classroom.id)}\n                                    className=\"text-lg font-bold font-mono text-black dark:text-white hover:text-orange-600 dark:hover:text-orange-500 transition-colors\"\n                                >\n                                    {classroom.joinCode}\n                                    <span className=\"ml-2 text-[8px] font-bold text-orange-600 uppercase opacity-0 group-hover:opacity-100 transition-opacity\">\n                                        {copiedId === classroom.id ? \"Copied\" : \"Copy Link\"}\n                                    </span>\n                                </button>\n                            </div>\n                        </div>\n\n                        <Link\n                            href={`/dashboard/classrooms/${classroom.id}`}\n                            className=\"w-full py-2.5 bg-black dark:bg-white text-white dark:text-black text-center font-bold text-xs uppercase rounded-md hover:bg-orange-600 dark:hover:bg-gray-200 transition-all\"\n                        >\n                            Open\n                        </Link>\n                    </div>\n                </div>\n            ))}\n        </div>\n    );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;;;AAJA;;;;AAsBO,SAAS,qBAAqB,EAAE,UAAU,EAA6B;;IAC1E,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAAgB;IAExD,MAAM,WAAW,CAAC,MAAc;QAC5B,MAAM,MAAM,GAAG,OAAO,QAAQ,CAAC,MAAM,CAAC,gBAAgB,EAAE,MAAM;QAC9D,UAAU,SAAS,CAAC,SAAS,CAAC;QAC9B,YAAY;QACZ,oJAAK,CAAC,OAAO,CAAC;QACd,WAAW,IAAM,YAAY,OAAO;IACxC;IAEA,IAAI,WAAW,MAAM,KAAK,GAAG;QACzB,qBACI,6LAAC;YAAI,WAAU;;8BACX,6LAAC;oBAAG,WAAU;8BAAiF;;;;;;8BAC/F,6LAAC;oBAAE,WAAU;8BAAuD;;;;;;;;;;;;IAGhF;IAEA,qBACI,6LAAC;QAAI,WAAU;kBACV,WAAW,GAAG,CAAC,CAAC,0BACb,6LAAC;gBAEG,WAAU;;kCAEV,6LAAC;wBAAI,WAAU;;0CACX,6LAAC;gCAAI,WAAU;;kDACX,6LAAC;wCAAK,WAAU;kDAAuE;;;;;;kDAGvF,6LAAC;wCAAG,WAAU;kDACT,UAAU,IAAI;;;;;;;;;;;;0CAGvB,6LAAC;gCAAI,WAAU;;oCACV,UAAU,MAAM,CAAC,QAAQ;oCAAC;;;;;;;;;;;;;kCAInC,6LAAC;wBAAI,WAAU;;4BACV,UAAU,OAAO,kBACd,6LAAC;gCAAK,WAAU;0CACX,UAAU,OAAO;;;;;;4BAGzB,UAAU,OAAO,kBACd,6LAAC;gCAAK,WAAU;;oCAAgI;oCACvI,UAAU,OAAO;;;;;;;;;;;;;kCAKlC,6LAAC;wBAAI,WAAU;;0CACX,6LAAC;gCAAI,WAAU;0CACX,cAAA,6LAAC;oCAAI,WAAU;;sDACX,6LAAC;4CAAK,WAAU;sDAAwE;;;;;;sDACxF,6LAAC;4CACG,SAAS,IAAM,SAAS,UAAU,QAAQ,EAAE,UAAU,EAAE;4CACxD,WAAU;;gDAET,UAAU,QAAQ;8DACnB,6LAAC;oDAAK,WAAU;8DACX,aAAa,UAAU,EAAE,GAAG,WAAW;;;;;;;;;;;;;;;;;;;;;;;0CAMxD,6LAAC,0KAAI;gCACD,MAAM,CAAC,sBAAsB,EAAE,UAAU,EAAE,EAAE;gCAC7C,WAAU;0CACb;;;;;;;;;;;;;eAjDA,UAAU,EAAE;;;;;;;;;;AAyDrC;GAjFgB;KAAA"}},
    {"offset": {"line": 217, "column": 0}, "map": {"version":3,"sources":["file:///home/vishnu/Documents/projects/Algo-fox/actions/classroom.ts"],"sourcesContent":["\"use server\";\n\nimport { prisma } from \"@/lib/prisma\";\nimport redis from \"@/lib/redis\";\nimport { auth } from \"@/lib/auth\";\nimport { headers } from \"next/headers\";\nimport { z } from \"zod\";\nimport { revalidatePath, revalidateTag, unstable_cache } from \"next/cache\";\nimport { cacheKey, cachedFetch, CACHE_CONFIG, deleteFromCache } from \"@/lib/cache-utils\";\n\nconst classroomSchema = z.object({\n    name: z.string().min(2, \"Name must be at least 2 characters\"),\n    section: z.string().optional().or(z.literal(\"\")),\n    subject: z.string().optional().or(z.literal(\"\")),\n    institutionId: z.string(),\n});\n\nfunction generateJoinCode() {\n    const chars = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\";\n    let code = \"\";\n    for (let i = 0; i < 6; i++) {\n        code += chars.charAt(Math.floor(Math.random() * chars.length));\n    }\n    return code;\n}\n\n/**\n * Creates a new classroom.\n * Only ADMIN, INSTITUTION_MANAGER, or TEACHER roles can create classrooms.\n */\nexport async function createClassroom(data: z.infer<typeof classroomSchema>) {\n    const session = await auth.api.getSession({\n        headers: await headers(),\n    });\n\n    if (!session?.user) {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    const currentUser = session.user as any;\n\n    // Security check\n    if (![\"ADMIN\", \"INSTITUTION_MANAGER\", \"TEACHER\"].includes(currentUser.role)) {\n        return { success: false, error: \"Unauthorized. Only teachers or managers can create classrooms.\" };\n    }\n\n    try {\n        const validatedData = classroomSchema.parse(data);\n\n        // Generate unique 6-character join code\n        let joinCode = \"\";\n        let isUnique = false;\n        let attempts = 0;\n        while (!isUnique && attempts < 10) {\n            joinCode = generateJoinCode();\n            const existing = await prisma.classroom.findUnique({\n                where: { joinCode },\n            });\n            if (!existing) isUnique = true;\n            attempts++;\n        }\n\n        if (!isUnique) {\n            return { success: false, error: \"Failed to generate a unique join code. Please try again.\" };\n        }\n\n        const classroom = await prisma.classroom.create({\n            data: {\n                name: validatedData.name,\n                section: validatedData.section || null,\n                subject: validatedData.subject || null,\n                joinCode,\n                institutionId: validatedData.institutionId,\n                teacherId: currentUser.id,\n            },\n        });\n\n        // Invalidate relevant caches\n        revalidateTag(`teacher-classrooms-${currentUser.id}`, \"max\");\n        revalidateTag(`institution-classrooms-${validatedData.institutionId}`, \"max\");\n        revalidatePath(\"/dashboard/institution/classrooms\");\n\n        return { success: true, data: classroom };\n    } catch (error) {\n        if (error instanceof z.ZodError) {\n            return { success: false, error: error.issues[0].message };\n        }\n        console.error(\"Failed to create classroom:\", error);\n        return { success: false, error: \"Failed to create classroom\" };\n    }\n}\n\n/**\n * Allows a student to join a classroom using a 6-character code.\n * Also onboards the student to the institution if they are not already associated.\n */\nexport async function joinClassroom(code: string) {\n    const session = await auth.api.getSession({\n        headers: await headers(),\n    });\n\n    if (!session?.user) {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    const currentUser = session.user as any;\n\n    try {\n\n        const classroom = await prisma.classroom.findUnique({\n            where: { joinCode: code.toUpperCase() },\n            include: {\n                students: {\n                    where: { id: currentUser.id },\n                },\n            },\n        });\n\n        if (!classroom) {\n            return { success: false, error: \"Invalid join code.\" };\n        }\n\n        if (classroom.students.length > 0) {\n            return { success: false, error: \"You are already enrolled in this classroom.\" };\n        }\n\n\n        // Institution Check:\n        // 1. If user belongs to an institution, they can only join classrooms from THAT institution.\n        // 2. If user has NO institution, they are assigned to this classroom's institution.\n\n        if (currentUser.institutionId && currentUser.institutionId !== classroom.institutionId) {\n             return {\n                success: false,\n                error: \"You cannot join this classroom because it belongs to a different institution.\"\n             };\n        }\n\n        // Add student to classroom\n        await prisma.classroom.update({\n            where: { id: classroom.id },\n            data: {\n                students: {\n                    connect: { id: currentUser.id },\n                },\n            },\n        });\n\n        // Onboard student to institution if null\n        const updateData: any = {\n            onboardingCompleted: true,\n        };\n\n        if (!currentUser.institutionId) {\n            updateData.institutionId = classroom.institutionId;\n        }\n\n        await prisma.user.update({\n            where: { id: currentUser.id },\n            data: updateData,\n        });\n\n        // Redis Integration: Cache student IDs per classroom\n        const redisKey = `classroom:students:${classroom.id}`;\n        await redis.sadd(redisKey, currentUser.id);\n\n        // Invalidate caches\n        revalidateTag(`student-classrooms-${currentUser.id}`, \"max\");\n        revalidateTag(`classroom-${classroom.id}`, \"max\");\n        revalidatePath(\"/dashboard/classrooms\");\n\n        return { success: true, message: `Successfully joined ${classroom.name}` };\n    } catch (error) {\n        console.error(\"Failed to join classroom:\", error);\n        return { success: false, error: \"Failed to join classroom\" };\n    }\n}\n\n/**\n * Fetches basic details of a classroom by its join code.\n * Used for the join classroom page.\n */\nexport async function getClassroomByCode(code: string) {\n    try {\n        const classroom = await prisma.classroom.findUnique({\n            where: { joinCode: code.toUpperCase() },\n            select: {\n                id: true,\n                name: true,\n                subject: true,\n                section: true,\n                teacher: {\n                    select: {\n                        id: true,\n                        name: true,\n                        image: true,\n                    }\n                },\n                _count: {\n                    select: { students: true }\n                }\n            }\n        });\n\n        if (!classroom) {\n            return { success: false, error: \"Classroom not found\" };\n        }\n\n        const session = await auth.api.getSession({\n            headers: await headers(),\n        });\n\n        const isEnrolled = session?.user ? await prisma.classroom.findFirst({\n            where: {\n                id: classroom.id,\n                students: { some: { id: session.user.id } }\n            }\n        }) : false;\n\n        return {\n            success: true,\n            classroom,\n            isEnrolled: !!isEnrolled\n        };\n    } catch (error) {\n        console.error(\"Failed to fetch classroom by code:\", error);\n        return { success: false, error: \"Failed to fetch classroom\" };\n    }\n}\n\n/**\n * Fetches classrooms created by the currently logged-in teacher (CACHED).\n */\nexport async function getTeacherClassrooms() {\n    const session = await auth.api.getSession({\n        headers: await headers(),\n    });\n\n    if (!session?.user) {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    const userId = session.user.id;\n\n    const fetchClassrooms = unstable_cache(\n        async () => {\n            return await prisma.classroom.findMany({\n                where: { teacherId: userId },\n                include: {\n                    _count: {\n                        select: { students: true },\n                    },\n                },\n                orderBy: { createdAt: \"desc\" },\n            });\n        },\n        [`teacher-classrooms-${userId}`],\n        { tags: [`teacher-classrooms-${userId}`], revalidate: 120 }\n    );\n\n    try {\n        const classrooms = await fetchClassrooms();\n        return { success: true, classrooms };\n    } catch (error) {\n        console.error(\"Failed to fetch teacher classrooms:\", error);\n        return { success: false, error: \"Failed to fetch classrooms\" };\n    }\n}\n\n/**\n * Fetches classrooms where the currently logged-in student is enrolled (CACHED).\n */\nexport async function getStudentClassrooms() {\n    const session = await auth.api.getSession({\n        headers: await headers(),\n    });\n\n    if (!session?.user) {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    const userId = session.user.id;\n\n    const fetchClassrooms = unstable_cache(\n        async () => {\n            const user = await prisma.user.findUnique({\n                where: { id: userId },\n                include: {\n                    enrolledClassrooms: {\n                        include: {\n                            teacher: {\n                                select: { name: true },\n                            },\n                        },\n                        orderBy: { createdAt: \"desc\" },\n                    },\n                },\n            });\n            return user?.enrolledClassrooms || [];\n        },\n        [`student-classrooms-${userId}`],\n        { tags: [`student-classrooms-${userId}`], revalidate: 120 }\n    );\n\n    try {\n        const classrooms = await fetchClassrooms();\n        return { success: true, classrooms };\n    } catch (error) {\n        console.error(\"Failed to fetch student classrooms:\", error);\n        return { success: false, error: \"Failed to fetch classrooms\" };\n    }\n}\n\n/**\n * Fetches details of a specific classroom, including the student list for the leaderboard (CACHED).\n * Supports pagination for large student lists.\n */\nexport async function getClassroomWithStudents(\n    id: string,\n    page: number = 1,\n    limit: number = 50\n) {\n    const session = await auth.api.getSession({\n        headers: await headers(),\n    });\n\n    if (!session?.user) {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    const skip = (page - 1) * limit;\n\n    const fetchClassroom = unstable_cache(\n        async () => {\n            const [classroom, totalStudents] = await Promise.all([\n                prisma.classroom.findUnique({\n                    where: { id },\n                    select: {\n                        id: true,\n                        name: true,\n                        subject: true,\n                        section: true,\n                        joinCode: true,\n                        isTrackingActive: true,\n                        trackingStartedAt: true,\n                        teacher: {\n                            select: { name: true, id: true },\n                        },\n                        students: {\n                            select: {\n                                id: true,\n                                name: true,\n                                totalScore: true,\n                                image: true,\n                            },\n                            orderBy: { totalScore: \"desc\" },\n                            skip,\n                            take: limit,\n                        },\n                    },\n                }),\n                prisma.user.count({\n                    where: {\n                        enrolledClassrooms: {\n                            some: { id }\n                        }\n                    }\n                })\n            ]);\n\n            return { classroom, totalStudents };\n        },\n        [`classroom-${id}-page-${page}`],\n        { tags: [`classroom-${id}`], revalidate: 60 }\n    );\n\n    try {\n        const { classroom, totalStudents } = await fetchClassroom();\n\n        if (!classroom) {\n            return { success: false, error: \"Classroom not found\" };\n        }\n\n        return {\n            success: true,\n            classroom,\n            pagination: {\n                total: totalStudents,\n                pages: Math.ceil(totalStudents / limit),\n                current: page,\n                limit\n            }\n        };\n    } catch (error) {\n        console.error(\"Failed to fetch classroom detail:\", error);\n        return { success: false, error: \"Failed to fetch classroom\" };\n    }\n}\n\nexport async function toggleClassroomTracking(classroomId: string, active: boolean) {\n    const session = await auth.api.getSession({\n        headers: await headers(),\n    });\n\n    if (!session?.user) return { success: false, error: \"Unauthorized\" };\n\n    const classroom = await prisma.classroom.findUnique({\n        where: { id: classroomId },\n        select: { teacherId: true }\n    });\n\n    if (!classroom || (classroom.teacherId !== session.user.id && (session.user as any).role !== \"ADMIN\")) {\n        return { success: false, error: \"Access denied\" };\n    }\n\n    await prisma.classroom.update({\n        where: { id: classroomId },\n        data: {\n            isTrackingActive: active,\n            trackingStartedAt: active ? new Date() : null\n        }\n    });\n\n    await deleteFromCache(cacheKey(\"live-tracking\", classroomId));\n    revalidateTag(`classroom-${classroomId}`, \"max\");\n    revalidatePath(`/dashboard/classrooms/${classroomId}`);\n    return { success: true };\n}\n\nexport async function getClassroomLiveTracking(classroomId: string) {\n    const session = await auth.api.getSession({\n        headers: await headers(),\n    });\n\n    if (!session?.user) return { success: false, error: \"Unauthorized\" };\n\n    // Use Redis cache for live tracking data (short TTL)\n    const cacheKeyName = cacheKey(\"live-tracking\", classroomId);\n\n    const fetchTracking = async () => {\n        const classroom = await prisma.classroom.findUnique({\n            where: { id: classroomId },\n            select: {\n                isTrackingActive: true,\n                trackingStartedAt: true,\n                students: {\n                    select: {\n                        id: true,\n                        name: true,\n                        image: true,\n                        submissions: {\n                            where: {\n                                mode: \"SUBMIT\",\n                            },\n                            orderBy: { createdAt: 'desc' },\n                            take: 20,\n                            include: {\n                                problem: { select: { title: true } }\n                            }\n                        }\n                    }\n                }\n            }\n        });\n\n        if (!classroom) return null;\n\n        // Filter submissions if tracking is active\n        const studentsData = classroom.students.map(student => {\n            const filteredSubmissions = student.submissions.filter(sub =>\n                classroom.isTrackingActive &&\n                classroom.trackingStartedAt &&\n                new Date(sub.createdAt) >= new Date(classroom.trackingStartedAt)\n            ).map(sub => ({\n                id: sub.id,\n                code: sub.code,\n                status: sub.status,\n                problemTitle: sub.problem.title,\n                createdAt: sub.createdAt\n            }));\n\n            return {\n                id: student.id,\n                name: student.name,\n                image: student.image,\n                submissions: filteredSubmissions\n            };\n        });\n\n        return {\n            isTrackingActive: classroom.isTrackingActive,\n            trackingStartedAt: classroom.trackingStartedAt,\n            students: studentsData\n        };\n    };\n\n    try {\n        const data = await cachedFetch(cacheKeyName, fetchTracking, CACHE_CONFIG.SHORT.ttl);\n\n        if (!data) {\n            return { success: false, error: \"Classroom not found\" };\n        }\n\n        return {\n            success: true,\n            ...data\n        };\n    } catch (error) {\n        console.error(\"Failed to fetch live tracking:\", error);\n        return { success: false, error: \"Failed to fetch tracking data\" };\n    }\n}\n\n/**\n * Fetches all classrooms for an institution (CACHED with pagination).\n */\nexport async function getInstitutionClassrooms(page: number = 1, limit: number = 20) {\n    const session = await auth.api.getSession({\n        headers: await headers(),\n    });\n\n    if (!session?.user) {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    const currentUser = session.user as any;\n\n    if (currentUser.role !== \"ADMIN\" && currentUser.role !== \"INSTITUTION_MANAGER\") {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    const institutionId = currentUser.institutionId;\n    const skip = (page - 1) * limit;\n\n    const fetchClassrooms = unstable_cache(\n        async () => {\n            const [classrooms, total] = await Promise.all([\n                prisma.classroom.findMany({\n                    where: { institutionId },\n                    include: {\n                        teacher: {\n                            select: { name: true, email: true }\n                        },\n                        _count: {\n                            select: { students: true }\n                        }\n                    },\n                    orderBy: { createdAt: \"desc\" },\n                    skip,\n                    take: limit,\n                }),\n                prisma.classroom.count({\n                    where: { institutionId }\n                })\n            ]);\n\n            return { classrooms, total };\n        },\n        [`institution-classrooms-${institutionId}-page-${page}`],\n        { tags: [`institution-classrooms-${institutionId}`], revalidate: 120 }\n    );\n\n    try {\n        const { classrooms, total } = await fetchClassrooms();\n        return {\n            success: true,\n            classrooms,\n            pagination: {\n                total,\n                pages: Math.ceil(total / limit),\n                current: page,\n                limit\n            }\n        };\n    } catch (error) {\n        console.error(\"Failed to fetch institution classrooms:\", error);\n        return { success: false, error: \"Failed to fetch classrooms\" };\n    }\n}\n\nexport async function removeStudentFromClassroom(classroomId: string, studentId: string) {\n    const session = await auth.api.getSession({\n        headers: await headers(),\n    });\n\n    if (!session?.user) {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    const currentUser = session.user as any;\n    const isPowerful = [\"ADMIN\", \"INSTITUTION_MANAGER\"].includes(currentUser.role);\n\n    try {\n        const classroom = await prisma.classroom.findUnique({\n            where: { id: classroomId },\n            select: { teacherId: true, institutionId: true },\n        });\n\n        if (!classroom) {\n            return { success: false, error: \"Classroom not found\" };\n        }\n\n        // Only allow if powerful role OR if current user is the teacher\n        if (!isPowerful && classroom.teacherId !== currentUser.id) {\n            return { success: false, error: \"Unauthorized\" };\n        }\n\n        await prisma.classroom.update({\n            where: { id: classroomId },\n            data: {\n                students: {\n                    disconnect: { id: studentId },\n                },\n            },\n        });\n\n        // Remove from Redis set\n        const redisKey = `classroom:students:${classroomId}`;\n        await redis.srem(redisKey, studentId);\n\n        // Invalidate caches\n        revalidateTag(`classroom-${classroomId}`, \"max\");\n        revalidateTag(`student-classrooms-${studentId}`, \"max\");\n        revalidatePath(`/dashboard/classrooms/${classroomId}`);\n\n        return { success: true };\n    } catch (error) {\n        console.error(\"Failed to remove student:\", error);\n        return { success: false, error: \"Failed to remove student\" };\n    }\n}\n"],"names":[],"mappings":";;;;;;;IA8BsB,kBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 232, "column": 0}, "map": {"version":3,"sources":["file:///home/vishnu/Documents/projects/Algo-fox/components/classroom/CreateClassroomDialog.tsx"],"sourcesContent":["\"use client\";\n\nimport { useForm } from \"react-hook-form\";\nimport { useState } from \"react\";\nimport { toast } from \"sonner\";\nimport { createClassroom } from \"@/actions/classroom\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport * as z from \"zod\";\n\nconst classroomSchema = z.object({\n    name: z.string().min(2, \"Name must be at least 2 characters\"),\n    section: z.string().optional().or(z.literal(\"\")),\n    subject: z.string().optional().or(z.literal(\"\")),\n    institutionId: z.string().min(1, \"Institution is required\"),\n});\n\ntype FormData = z.infer<typeof classroomSchema>;\n\ninterface CreateClassroomDialogProps {\n    isOpen: boolean;\n    onClose: () => void;\n    institutionId: string;\n}\n\nexport function CreateClassroomDialog({ isOpen, onClose, institutionId }: CreateClassroomDialogProps) {\n    const [isLoading, setIsLoading] = useState(false);\n\n    const { register, handleSubmit, formState: { errors }, reset } = useForm<FormData>({\n        resolver: zodResolver(classroomSchema),\n        defaultValues: {\n            name: \"\",\n            section: \"\",\n            subject: \"\",\n            institutionId: institutionId,\n        }\n    });\n\n    const onSubmit = async (data: FormData) => {\n        setIsLoading(true);\n        try {\n            const res = await createClassroom(data);\n            if (res.success) {\n                toast.success(\"Classroom created successfully!\");\n                reset();\n                onClose();\n            } else {\n                toast.error(res.error || \"Failed to create classroom\");\n            }\n        } catch (error) {\n            toast.error(\"Something went wrong\");\n        } finally {\n            setIsLoading(false);\n        }\n    };\n\n    if (!isOpen) return null;\n\n    return (\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/20 dark:bg-black/50 backdrop-blur-sm\">\n            <div className=\"bg-white dark:bg-[#141414] w-full max-w-lg overflow-hidden border border-gray-100 dark:border-[#262626] rounded-md shadow-2xl dark:shadow-black/50 animate-in fade-in zoom-in-95 duration-300\">\n                <div className=\"px-8 py-6 border-b border-gray-50 dark:border-[#262626] flex justify-between items-center\">\n                    <div>\n                        <h2 className=\"text-xl font-bold text-black dark:text-white tracking-tight\">New Classroom</h2>\n                        <p className=\"text-xs text-gray-400 dark:text-gray-500 font-medium mt-1\">Setup your learning environment.</p>\n                    </div>\n                    <button\n                        onClick={onClose}\n                        className=\"text-[10px] font-bold text-gray-300 dark:text-gray-600 hover:text-black dark:hover:text-white uppercase tracking-widest transition-colors\"\n                    >\n                        Close\n                    </button>\n                </div>\n\n                <form onSubmit={handleSubmit(onSubmit)} className=\"p-8 space-y-6\">\n                    {/* Name */}\n                    <div className=\"space-y-2\">\n                        <label className=\"text-[10px] font-bold text-black dark:text-gray-300 uppercase tracking-widest block\">\n                            Name\n                        </label>\n                        <input\n                            {...register(\"name\")}\n                            className=\"w-full px-4 py-2 bg-gray-50/50 dark:bg-[#1a1a1a] border border-gray-100 dark:border-[#333] rounded-md focus:border-orange-500 focus:outline-none font-bold text-sm placeholder:text-gray-200 dark:placeholder:text-gray-700 text-black dark:text-white\"\n                            placeholder=\"e.g. Data Structures\"\n                        />\n                        {errors.name && <p className=\"text-[10px] font-bold text-orange-600 uppercase tracking-wider\">{errors.name.message}</p>}\n                    </div>\n\n                    <div className=\"grid grid-cols-2 gap-6\">\n                        {/* Subject */}\n                        <div className=\"space-y-2\">\n                            <label className=\"text-[10px] font-bold text-black dark:text-gray-300 uppercase tracking-widest block\">\n                                Subject\n                            </label>\n                            <input\n                                {...register(\"subject\")}\n                                className=\"w-full px-4 py-2 bg-gray-50/50 dark:bg-[#1a1a1a] border border-gray-100 dark:border-[#333] rounded-md focus:border-orange-500 focus:outline-none font-bold text-sm placeholder:text-gray-200 dark:placeholder:text-gray-700 text-black dark:text-white\"\n                                placeholder=\"e.g. CS-101\"\n                            />\n                        </div>\n\n                        {/* Section */}\n                        <div className=\"space-y-2\">\n                            <label className=\"text-[10px] font-bold text-black dark:text-gray-300 uppercase tracking-widest block\">\n                                Section\n                            </label>\n                            <input\n                                {...register(\"section\")}\n                                className=\"w-full px-4 py-2 bg-gray-50/50 dark:bg-[#1a1a1a] border border-gray-100 dark:border-[#333] rounded-md focus:border-orange-500 focus:outline-none font-bold text-sm placeholder:text-gray-200 dark:placeholder:text-gray-700 text-black dark:text-white\"\n                                placeholder=\"e.g. A\"\n                            />\n                        </div>\n                    </div>\n\n                    <div className=\"pt-4 flex items-center justify-end gap-4\">\n                        <button\n                            type=\"button\"\n                            onClick={onClose}\n                            className=\"text-[10px] font-bold text-gray-400 dark:text-gray-600 hover:text-black dark:hover:text-white uppercase tracking-widest transition-colors\"\n                        >\n                            Cancel\n                        </button>\n                        <button\n                            type=\"submit\"\n                            disabled={isLoading}\n                            className=\"px-6 py-2.5 bg-black dark:bg-white text-white dark:text-black rounded-md font-bold text-[11px] uppercase tracking-widest hover:bg-orange-600 dark:hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed\"\n                        >\n                            {isLoading ? \"Creating...\" : \"Confirm\"}\n                        </button>\n                    </div>\n                </form>\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAPA;;;;;;;AASA,MAAM,kBAAkB,4JAAQ,CAAC;IAC7B,MAAM,4JAAQ,GAAG,GAAG,CAAC,GAAG;IACxB,SAAS,4JAAQ,GAAG,QAAQ,GAAG,EAAE,CAAC,6JAAS,CAAC;IAC5C,SAAS,4JAAQ,GAAG,QAAQ,GAAG,EAAE,CAAC,6JAAS,CAAC;IAC5C,eAAe,4JAAQ,GAAG,GAAG,CAAC,GAAG;AACrC;AAUO,SAAS,sBAAsB,EAAE,MAAM,EAAE,OAAO,EAAE,aAAa,EAA8B;;IAChG,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAC;IAE3C,MAAM,EAAE,QAAQ,EAAE,YAAY,EAAE,WAAW,EAAE,MAAM,EAAE,EAAE,KAAK,EAAE,GAAG,IAAA,4KAAO,EAAW;QAC/E,UAAU,IAAA,gLAAW,EAAC;QACtB,eAAe;YACX,MAAM;YACN,SAAS;YACT,SAAS;YACT,eAAe;QACnB;IACJ;IAEA,MAAM,WAAW,OAAO;QACpB,aAAa;QACb,IAAI;YACA,MAAM,MAAM,MAAM,IAAA,qKAAe,EAAC;YAClC,IAAI,IAAI,OAAO,EAAE;gBACb,oJAAK,CAAC,OAAO,CAAC;gBACd;gBACA;YACJ,OAAO;gBACH,oJAAK,CAAC,KAAK,CAAC,IAAI,KAAK,IAAI;YAC7B;QACJ,EAAE,OAAO,OAAO;YACZ,oJAAK,CAAC,KAAK,CAAC;QAChB,SAAU;YACN,aAAa;QACjB;IACJ;IAEA,IAAI,CAAC,QAAQ,OAAO;IAEpB,qBACI,6LAAC;QAAI,WAAU;kBACX,cAAA,6LAAC;YAAI,WAAU;;8BACX,6LAAC;oBAAI,WAAU;;sCACX,6LAAC;;8CACG,6LAAC;oCAAG,WAAU;8CAA8D;;;;;;8CAC5E,6LAAC;oCAAE,WAAU;8CAA4D;;;;;;;;;;;;sCAE7E,6LAAC;4BACG,SAAS;4BACT,WAAU;sCACb;;;;;;;;;;;;8BAKL,6LAAC;oBAAK,UAAU,aAAa;oBAAW,WAAU;;sCAE9C,6LAAC;4BAAI,WAAU;;8CACX,6LAAC;oCAAM,WAAU;8CAAsF;;;;;;8CAGvG,6LAAC;oCACI,GAAG,SAAS,OAAO;oCACpB,WAAU;oCACV,aAAY;;;;;;gCAEf,OAAO,IAAI,kBAAI,6LAAC;oCAAE,WAAU;8CAAkE,OAAO,IAAI,CAAC,OAAO;;;;;;;;;;;;sCAGtH,6LAAC;4BAAI,WAAU;;8CAEX,6LAAC;oCAAI,WAAU;;sDACX,6LAAC;4CAAM,WAAU;sDAAsF;;;;;;sDAGvG,6LAAC;4CACI,GAAG,SAAS,UAAU;4CACvB,WAAU;4CACV,aAAY;;;;;;;;;;;;8CAKpB,6LAAC;oCAAI,WAAU;;sDACX,6LAAC;4CAAM,WAAU;sDAAsF;;;;;;sDAGvG,6LAAC;4CACI,GAAG,SAAS,UAAU;4CACvB,WAAU;4CACV,aAAY;;;;;;;;;;;;;;;;;;sCAKxB,6LAAC;4BAAI,WAAU;;8CACX,6LAAC;oCACG,MAAK;oCACL,SAAS;oCACT,WAAU;8CACb;;;;;;8CAGD,6LAAC;oCACG,MAAK;oCACL,UAAU;oCACV,WAAU;8CAET,YAAY,gBAAgB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAOzD;GA7GgB;;QAGqD,4KAAO;;;KAH5D"}},
    {"offset": {"line": 496, "column": 0}, "map": {"version":3,"sources":["file:///home/vishnu/Documents/projects/Algo-fox/app/%28main%29/dashboard/teacher/classrooms/TeacherDashboardContent.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState } from \"react\";\nimport Link from \"next/link\";\nimport { TeacherClassroomList } from \"@/components/classroom/TeacherClassroomList\";\nimport { CreateClassroomDialog } from \"@/components/classroom/CreateClassroomDialog\";\n\ninterface TeacherDashboardContentProps {\n    classrooms: any[];\n    institutionId: string | null;\n}\n\nexport function TeacherDashboardContent({ classrooms, institutionId }: TeacherDashboardContentProps) {\n    const [isDialogOpen, setIsDialogOpen] = useState(false);\n\n    return (\n        <div className=\"min-h-screen bg-[#FFFFFF] dark:bg-[#0a0a0a]\">\n            <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12\">\n                {/* Header Section */}\n                <div className=\"flex flex-col md:flex-row md:items-end justify-between gap-6 mb-12 border-b border-gray-100 dark:border-[#262626] pb-8\">\n                    <div className=\"space-y-3\">\n                        <Link\n                            href=\"/dashboard\"\n                            className=\"text-[10px] font-black text-orange-600 dark:text-orange-500 uppercase tracking-[0.2em] hover:text-black dark:hover:text-white transition-colors\"\n                        >\n                            ‚Üê Dashboard\n                        </Link>\n                        <div>\n                            <h1 className=\"text-4xl font-black text-gray-900 dark:text-white tracking-tight mb-2\">\n                                Classrooms\n                            </h1>\n                            <p className=\"text-gray-500 dark:text-gray-400 font-medium text-lg max-w-lg\">\n                                Manage your learning environments and track student performance.\n                            </p>\n                        </div>\n                    </div>\n\n                    {institutionId && (\n                        <button\n                            onClick={() => setIsDialogOpen(true)}\n                            className=\"inline-flex items-center justify-center px-6 py-3 bg-gray-900 dark:bg-white text-white dark:text-black rounded-xl text-sm font-bold hover:bg-orange-600 dark:hover:bg-gray-200 transition-all shadow-lg active:scale-[0.98]\"\n                        >\n                            Create Classroom\n                        </button>\n                    )}\n                </div>\n\n                {/* Main Content */}\n                <TeacherClassroomList classrooms={classrooms} />\n\n                {/* Dialogs */}\n                {institutionId && (\n                    <CreateClassroomDialog\n                        isOpen={isDialogOpen}\n                        onClose={() => setIsDialogOpen(false)}\n                        institutionId={institutionId}\n                    />\n                )}\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;;;AALA;;;;;AAYO,SAAS,wBAAwB,EAAE,UAAU,EAAE,aAAa,EAAgC;;IAC/F,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,yKAAQ,EAAC;IAEjD,qBACI,6LAAC;QAAI,WAAU;kBACX,cAAA,6LAAC;YAAI,WAAU;;8BAEX,6LAAC;oBAAI,WAAU;;sCACX,6LAAC;4BAAI,WAAU;;8CACX,6LAAC,0KAAI;oCACD,MAAK;oCACL,WAAU;8CACb;;;;;;8CAGD,6LAAC;;sDACG,6LAAC;4CAAG,WAAU;sDAAwE;;;;;;sDAGtF,6LAAC;4CAAE,WAAU;sDAAgE;;;;;;;;;;;;;;;;;;wBAMpF,+BACG,6LAAC;4BACG,SAAS,IAAM,gBAAgB;4BAC/B,WAAU;sCACb;;;;;;;;;;;;8BAOT,6LAAC,2KAAoB;oBAAC,YAAY;;;;;;gBAGjC,+BACG,6LAAC,6KAAqB;oBAClB,QAAQ;oBACR,SAAS,IAAM,gBAAgB;oBAC/B,eAAe;;;;;;;;;;;;;;;;;AAMvC;GAjDgB;KAAA"}}]
}