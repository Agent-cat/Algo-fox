{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/vishnu/Documents/projects/Algo-fox/actions/user.action.ts"],"sourcesContent":["\"use server\";\n\nimport { UserService } from \"@/core/services/user.service\";\nimport { auth } from \"@/lib/auth\";\nimport { headers } from \"next/headers\";\nimport { prisma } from \"@/lib/prisma\";\nimport { revalidatePath, updateTag, cacheTag, cacheLife } from \"next/cache\";\n\n/**\n * Get user's total score (cached for 5 minutes)\n * Cache is invalidated when user solves a problem via updateTag\n */\n\nexport async function getUserScore(): Promise<number> {\n    \"use cache: private\"; // Must be at top - allows headers() inside\n    cacheLife({ stale: 300, revalidate: 300 }); // 5 minutes\n\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n\n    if (!session?.user?.id) {\n        return 0;\n    }\n\n    const userId = session.user.id;\n\n    cacheTag(`user-score-${userId}`, `user-${userId}`);\n\n    return UserService.getUserScore(userId);\n}\n\n/**\n * Recalculate user's total score based on their solved problems\n * This fixes any incorrect scores in the database\n */\nexport async function recalculateUserScore(): Promise<{ success: boolean; newScore: number }> {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n\n    if (!session?.user?.id) {\n        throw new Error(\"Unauthorized\");\n    }\n\n    const userId = session.user.id;\n\n    return UserService.recalculateUserScore(userId);\n}\n\n/**\n * Complete user onboarding process\n * Updates user profile information and marks onboarding as complete\n */\nexport async function completeOnboarding(data: {\n    name?: string;\n    bio?: string;\n    collegeId: string;\n    year?: string;\n    leetCodeHandle?: string;\n    codeChefHandle?: string;\n    hackerrankHandle?: string;\n    githubHandle?: string;\n}): Promise<{ success: boolean; error?: string }> {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n\n    if (!session?.user?.id) {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    const userId = session.user.id;\n\n    const res = await UserService.completeOnboarding(userId, data);\n\n    if (res.success) {\n        // Invalidate Redis cache (redundant but good to have here too)\n        try {\n            const redis = (await import(\"@/lib/redis\")).default;\n            await redis.del(`dashboard:stats:${userId}`);\n        } catch (error) {\n            console.error(\"Failed to invalidate dashboard redis cache:\", error);\n        }\n\n        revalidatePath(\"/dashboard\");\n        updateTag(`user-${userId}`);\n        updateTag(`dashboard-${userId}`);\n        updateTag('dashboard-stats');\n    }\n\n    return res;\n}\n\n/**\n * Update user profile information\n */\nexport async function updateUserInfo(data: {\n    name?: string;\n    bio?: string;\n    leetCodeHandle?: string;\n    codeChefHandle?: string;\n    hackerrankHandle?: string;\n    codeforcesHandle?: string;\n    githubHandle?: string;\n}): Promise<{ success: boolean; error?: string }> {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n\n    if (!session?.user?.id) {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    const userId = session.user.id;\n\n    try {\n        await prisma.user.update({\n            where: { id: userId },\n            data: {\n                name: data.name,\n                bio: data.bio,\n                leetCodeHandle: data.leetCodeHandle,\n                codeChefHandle: data.codeChefHandle,\n                codeforcesHandle: data.codeforcesHandle,\n                githubHandle: data.githubHandle,\n            }\n        });\n\n        // Invalidate Redis cache\n        try {\n            const redis = (await import(\"@/lib/redis\")).default;\n            await redis.del(`dashboard:stats:${userId}`);\n        } catch (error) {\n            console.error(\"Failed to invalidate dashboard redis cache:\", error);\n        }\n\n        revalidatePath(\"/dashboard\");\n        updateTag(`user-${userId}`);\n        updateTag(`user-score-${userId}`);\n        updateTag(`dashboard-${userId}`);\n        updateTag('dashboard-stats');\n        return { success: true };\n    } catch (error) {\n        console.error(\"Failed to update user info:\", error);\n        return { success: false, error: \"Failed to update profile\" };\n    }\n}\n\n/**\n * Sync user profile and stats\n * Clears all caches related to the user and revalidates dashboard\n */\nexport async function syncUserProfile(): Promise<{ success: boolean; error?: string }> {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n\n    if (!session?.user?.id) {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    const userId = session.user.id;\n\n    try {\n        // Invalidate Redis cache\n        try {\n            const redis = (await import(\"@/lib/redis\")).default;\n            await redis.del(`dashboard:stats:${userId}`);\n            await redis.del(`user-score-${userId}`);\n        } catch (error) {\n            console.error(\"Failed to invalidate redis cache during sync:\", error);\n        }\n\n        // Revalidate Next.js cache\n        revalidatePath(\"/dashboard\");\n        updateTag(`user-${userId}`);\n        updateTag(`user-score-${userId}`);\n        updateTag('dashboard-stats');\n\n        return { success: true };\n    } catch (error) {\n        console.error(\"Sync failed:\", error);\n        return { success: false, error: \"Failed to sync profile\" };\n    }\n}\n\n/**\n * Get user settings data (cached)\n */\nexport async function getUserSettings() {\n    \"use cache: private\";\n    cacheLife({ stale: 300, revalidate: 300 });\n\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n\n    if (!session?.user?.id) {\n        return null;\n    }\n\n    const userId = session.user.id;\n    cacheTag(`user-${userId}`);\n\n    const user = await prisma.user.findUnique({\n        where: { id: userId },\n        include: {\n            institution: true\n        }\n    });\n\n    if (!user) return null;\n\n    return {\n        id: user.id,\n        name: user.name,\n        email: user.email,\n        image: user.image,\n        bio: user.bio,\n        institutionName: user.institution?.name\n    };\n}\n"],"names":[],"mappings":";;;;;;;IAiGsB,iBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 19, "column": 0}, "map": {"version":3,"sources":["file:///home/vishnu/Documents/projects/Algo-fox/actions/platform.action.ts"],"sourcesContent":["\"use server\";\n\nimport { JSDOM } from \"jsdom\";\nimport { auth } from \"@/lib/auth\";\nimport { prisma } from \"@/lib/prisma\";\nimport { revalidatePath, revalidateTag } from \"next/cache\";\nimport { headers } from \"next/headers\";\n\nexport async function checkCodeChefUser(handle: string) {\n    try {\n        const resdata = await fetch(\n            `https://www.codechef.com/users/${handle}`,\n            { cache: 'no-store' }\n        );\n\n        if (resdata.status == 200) {\n\n            let d = await resdata.text();\n            let data = { data: d };\n\n            // Heatmap data extraction\n            let heatMapDataCursour1 =\n                data.data.search(\"var userDailySubmissionsStats =\") +\n                \"var userDailySubmissionsStats =\".length;\n            let heatMapDataCursour2 = data.data.search(\"'#js-heatmap\") - 34;\n            let heatDataString = data.data.substring(\n                heatMapDataCursour1,\n                heatMapDataCursour2\n            );\n\n            let headMapData = null;\n            try {\n                 headMapData = JSON.parse(heatDataString);\n            } catch (e) {\n                console.log(\"Error parsing heatmap data\", e);\n            }\n\n            // Rating data extraction\n            let allRating =\n                data.data.search(\"var all_rating = \") + \"var all_rating = \".length;\n            let allRating2 = data.data.search(\"var current_user_rating =\") - 6;\n\n            let ratingData = null;\n            try {\n                 ratingData = JSON.parse(data.data.substring(allRating, allRating2));\n            } catch (e) {\n                console.log(\"Error parsing rating data\", e);\n            }\n\n            let dom = new JSDOM(data.data);\n            let document = dom.window.document;\n\n            const name = document.querySelector(\".user-details-container\")?.children[0]\n                ?.children[1]?.textContent || \"\";\n\n            // Safe extraction with optional chaining\n            const profile = document.querySelector(\".user-details-container\")?.children[0]\n                ?.children[0]?.getAttribute(\"src\") || \"\";\n\n            const currentRatingText = document.querySelector(\".rating-number\")?.textContent;\n            const currentRating = currentRatingText ? parseInt(currentRatingText) : 0;\n\n            const highestRatingText = document.querySelector(\".rating-number\")?.parentNode?.children[4]?.textContent?.split(\"Rating\")[1];\n            const highestRating = highestRatingText ? parseInt(highestRatingText) : 0;\n\n            const countryFlag = document.querySelector(\".user-country-flag\")?.getAttribute(\"src\") || \"\";\n            const countryName = document.querySelector(\".user-country-name\")?.textContent || \"\";\n\n            const globalRankText = document.querySelector(\".rating-ranks\")?.children[0]?.children[0]\n                ?.children[0]?.children[0]?.innerHTML;\n            const globalRank = globalRankText ? parseInt(globalRankText) : 0;\n\n            const countryRankText = document.querySelector(\".rating-ranks\")?.children[0]?.children[1]\n                ?.children[0]?.children[0]?.innerHTML;\n            const countryRank = countryRankText ? parseInt(countryRankText) : 0;\n\n            const stars = document.querySelector(\".rating\")?.textContent || \"unrated\";\n\n            return {\n                success: true,\n                status: resdata.status,\n                profile,\n                name,\n                currentRating,\n                highestRating,\n                countryFlag,\n                countryName,\n                globalRank,\n                countryRank,\n                stars,\n                heatMap: headMapData,\n                ratingData,\n            };\n        }\n        else {\n            return { success: false, status: resdata.status }\n        }\n    } catch (e) {\n        console.log(e)\n        return { success: false, status: 404 }\n    }\n}\n\nexport async function verifyCodeChefOwnership(handle: string, verificationCode: string) {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n    if (!session || !session.user) {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    const result = await checkCodeChefUser(handle);\n\n    if (result.success && result.name) {\n        // Check if the verification code is present in the name\n        // The user edits their \"Name\" field to include the code\n        if (result.name.includes(verificationCode)) {\n             try {\n                await prisma.user.update({\n                    where: { id: session.user.id },\n                    data: {\n                        codeChefVerified: true,\n                        // Ensure the verified handle is the one stored\n                        codeChefHandle: handle\n                    }\n                });\n                revalidatePath(\"/dashboard/settings\"); // Revalidate settings pages\n                revalidateTag(`user-${session.user.id}`); // Invalidate user cache tag\n                return { success: true };\n            } catch (error) {\n                console.error(\"Database update error:\", error);\n                return { success: false, error: \"Failed to update verification status\" };\n            }\n        } else {\n             return { success: false, error: \"Verification code not found in CodeChef name. Please ensure you have updated your profile name.\" };\n        }\n    }\n\n    return { success: false, error: \"Failed to fetch CodeChef profile\" };\n}\n// ... (existing imports and functions)\n\nexport async function checkCodeforcesUser(handle: string) {\n    try {\n        const userInfoRes = await fetch(\n            `https://codeforces.com/api/user.info?handles=${handle}`,\n            { cache: 'no-store' }\n        );\n\n        if (userInfoRes.ok) {\n            const userData = await userInfoRes.json();\n            if (userData.status === \"OK\" && userData.result.length > 0) {\n                const user = userData.result[0];\n                return {\n                    success: true,\n                    status: 200,\n                    firstName: user.firstName,\n                    // Check other fields if needed for existence or display\n                    rating: user.rating,\n                    rank: user.rank,\n                    avatar: user.titlePhoto || user.avatar\n                };\n            }\n        }\n        return { success: false, status: userInfoRes.status };\n    } catch (e) {\n        console.error(e);\n        return { success: false, status: 500 };\n    }\n}\n\nexport async function verifyCodeforcesOwnership(handle: string, verificationCode: string) {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n    if (!session || !session.user) {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    const result = await checkCodeforcesUser(handle);\n\n    if (result.success) {\n        // Check if the verification code is present in the first name\n        // Codeforces allows changing First Name in settings\n        if (result.firstName && result.firstName.includes(verificationCode)) {\n             try {\n                await prisma.user.update({\n                    where: { id: session.user.id },\n                    data: {\n                        codeforcesVerified: true,\n                        // Ensure the verified handle is the one stored\n                        codeforcesHandle: handle\n                    }\n                });\n                revalidatePath(\"/dashboard/settings\"); // Revalidate settings pages\n                revalidateTag(`user-${session.user.id}`); // Invalidate user cache tag\n                return { success: true };\n            } catch (error) {\n                console.error(\"Database update error:\", error);\n                return { success: false, error: \"Failed to update verification status\" };\n            }\n        } else {\n             return { success: false, error: \"Verification code not found in Codeforces First Name. Please ensure you have updated it in your profile settings.\" };\n        }\n    }\n\n    return { success: false, error: \"Failed to fetch Codeforces profile\" };\n}\n"],"names":[],"mappings":";;;;;;;IAQsB,oBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 34, "column": 0}, "map": {"version":3,"sources":["file:///home/vishnu/Documents/projects/Algo-fox/actions/platform.action.ts"],"sourcesContent":["\"use server\";\n\nimport { JSDOM } from \"jsdom\";\nimport { auth } from \"@/lib/auth\";\nimport { prisma } from \"@/lib/prisma\";\nimport { revalidatePath, revalidateTag } from \"next/cache\";\nimport { headers } from \"next/headers\";\n\nexport async function checkCodeChefUser(handle: string) {\n    try {\n        const resdata = await fetch(\n            `https://www.codechef.com/users/${handle}`,\n            { cache: 'no-store' }\n        );\n\n        if (resdata.status == 200) {\n\n            let d = await resdata.text();\n            let data = { data: d };\n\n            // Heatmap data extraction\n            let heatMapDataCursour1 =\n                data.data.search(\"var userDailySubmissionsStats =\") +\n                \"var userDailySubmissionsStats =\".length;\n            let heatMapDataCursour2 = data.data.search(\"'#js-heatmap\") - 34;\n            let heatDataString = data.data.substring(\n                heatMapDataCursour1,\n                heatMapDataCursour2\n            );\n\n            let headMapData = null;\n            try {\n                 headMapData = JSON.parse(heatDataString);\n            } catch (e) {\n                console.log(\"Error parsing heatmap data\", e);\n            }\n\n            // Rating data extraction\n            let allRating =\n                data.data.search(\"var all_rating = \") + \"var all_rating = \".length;\n            let allRating2 = data.data.search(\"var current_user_rating =\") - 6;\n\n            let ratingData = null;\n            try {\n                 ratingData = JSON.parse(data.data.substring(allRating, allRating2));\n            } catch (e) {\n                console.log(\"Error parsing rating data\", e);\n            }\n\n            let dom = new JSDOM(data.data);\n            let document = dom.window.document;\n\n            const name = document.querySelector(\".user-details-container\")?.children[0]\n                ?.children[1]?.textContent || \"\";\n\n            // Safe extraction with optional chaining\n            const profile = document.querySelector(\".user-details-container\")?.children[0]\n                ?.children[0]?.getAttribute(\"src\") || \"\";\n\n            const currentRatingText = document.querySelector(\".rating-number\")?.textContent;\n            const currentRating = currentRatingText ? parseInt(currentRatingText) : 0;\n\n            const highestRatingText = document.querySelector(\".rating-number\")?.parentNode?.children[4]?.textContent?.split(\"Rating\")[1];\n            const highestRating = highestRatingText ? parseInt(highestRatingText) : 0;\n\n            const countryFlag = document.querySelector(\".user-country-flag\")?.getAttribute(\"src\") || \"\";\n            const countryName = document.querySelector(\".user-country-name\")?.textContent || \"\";\n\n            const globalRankText = document.querySelector(\".rating-ranks\")?.children[0]?.children[0]\n                ?.children[0]?.children[0]?.innerHTML;\n            const globalRank = globalRankText ? parseInt(globalRankText) : 0;\n\n            const countryRankText = document.querySelector(\".rating-ranks\")?.children[0]?.children[1]\n                ?.children[0]?.children[0]?.innerHTML;\n            const countryRank = countryRankText ? parseInt(countryRankText) : 0;\n\n            const stars = document.querySelector(\".rating\")?.textContent || \"unrated\";\n\n            return {\n                success: true,\n                status: resdata.status,\n                profile,\n                name,\n                currentRating,\n                highestRating,\n                countryFlag,\n                countryName,\n                globalRank,\n                countryRank,\n                stars,\n                heatMap: headMapData,\n                ratingData,\n            };\n        }\n        else {\n            return { success: false, status: resdata.status }\n        }\n    } catch (e) {\n        console.log(e)\n        return { success: false, status: 404 }\n    }\n}\n\nexport async function verifyCodeChefOwnership(handle: string, verificationCode: string) {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n    if (!session || !session.user) {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    const result = await checkCodeChefUser(handle);\n\n    if (result.success && result.name) {\n        // Check if the verification code is present in the name\n        // The user edits their \"Name\" field to include the code\n        if (result.name.includes(verificationCode)) {\n             try {\n                await prisma.user.update({\n                    where: { id: session.user.id },\n                    data: {\n                        codeChefVerified: true,\n                        // Ensure the verified handle is the one stored\n                        codeChefHandle: handle\n                    }\n                });\n                revalidatePath(\"/dashboard/settings\"); // Revalidate settings pages\n                revalidateTag(`user-${session.user.id}`); // Invalidate user cache tag\n                return { success: true };\n            } catch (error) {\n                console.error(\"Database update error:\", error);\n                return { success: false, error: \"Failed to update verification status\" };\n            }\n        } else {\n             return { success: false, error: \"Verification code not found in CodeChef name. Please ensure you have updated your profile name.\" };\n        }\n    }\n\n    return { success: false, error: \"Failed to fetch CodeChef profile\" };\n}\n// ... (existing imports and functions)\n\nexport async function checkCodeforcesUser(handle: string) {\n    try {\n        const userInfoRes = await fetch(\n            `https://codeforces.com/api/user.info?handles=${handle}`,\n            { cache: 'no-store' }\n        );\n\n        if (userInfoRes.ok) {\n            const userData = await userInfoRes.json();\n            if (userData.status === \"OK\" && userData.result.length > 0) {\n                const user = userData.result[0];\n                return {\n                    success: true,\n                    status: 200,\n                    firstName: user.firstName,\n                    // Check other fields if needed for existence or display\n                    rating: user.rating,\n                    rank: user.rank,\n                    avatar: user.titlePhoto || user.avatar\n                };\n            }\n        }\n        return { success: false, status: userInfoRes.status };\n    } catch (e) {\n        console.error(e);\n        return { success: false, status: 500 };\n    }\n}\n\nexport async function verifyCodeforcesOwnership(handle: string, verificationCode: string) {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n    if (!session || !session.user) {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    const result = await checkCodeforcesUser(handle);\n\n    if (result.success) {\n        // Check if the verification code is present in the first name\n        // Codeforces allows changing First Name in settings\n        if (result.firstName && result.firstName.includes(verificationCode)) {\n             try {\n                await prisma.user.update({\n                    where: { id: session.user.id },\n                    data: {\n                        codeforcesVerified: true,\n                        // Ensure the verified handle is the one stored\n                        codeforcesHandle: handle\n                    }\n                });\n                revalidatePath(\"/dashboard/settings\"); // Revalidate settings pages\n                revalidateTag(`user-${session.user.id}`); // Invalidate user cache tag\n                return { success: true };\n            } catch (error) {\n                console.error(\"Database update error:\", error);\n                return { success: false, error: \"Failed to update verification status\" };\n            }\n        } else {\n             return { success: false, error: \"Verification code not found in Codeforces First Name. Please ensure you have updated it in your profile settings.\" };\n        }\n    }\n\n    return { success: false, error: \"Failed to fetch Codeforces profile\" };\n}\n"],"names":[],"mappings":";;;;;;;IA8IsB,sBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 49, "column": 0}, "map": {"version":3,"sources":["file:///home/vishnu/Documents/projects/Algo-fox/actions/platform.action.ts"],"sourcesContent":["\"use server\";\n\nimport { JSDOM } from \"jsdom\";\nimport { auth } from \"@/lib/auth\";\nimport { prisma } from \"@/lib/prisma\";\nimport { revalidatePath, revalidateTag } from \"next/cache\";\nimport { headers } from \"next/headers\";\n\nexport async function checkCodeChefUser(handle: string) {\n    try {\n        const resdata = await fetch(\n            `https://www.codechef.com/users/${handle}`,\n            { cache: 'no-store' }\n        );\n\n        if (resdata.status == 200) {\n\n            let d = await resdata.text();\n            let data = { data: d };\n\n            // Heatmap data extraction\n            let heatMapDataCursour1 =\n                data.data.search(\"var userDailySubmissionsStats =\") +\n                \"var userDailySubmissionsStats =\".length;\n            let heatMapDataCursour2 = data.data.search(\"'#js-heatmap\") - 34;\n            let heatDataString = data.data.substring(\n                heatMapDataCursour1,\n                heatMapDataCursour2\n            );\n\n            let headMapData = null;\n            try {\n                 headMapData = JSON.parse(heatDataString);\n            } catch (e) {\n                console.log(\"Error parsing heatmap data\", e);\n            }\n\n            // Rating data extraction\n            let allRating =\n                data.data.search(\"var all_rating = \") + \"var all_rating = \".length;\n            let allRating2 = data.data.search(\"var current_user_rating =\") - 6;\n\n            let ratingData = null;\n            try {\n                 ratingData = JSON.parse(data.data.substring(allRating, allRating2));\n            } catch (e) {\n                console.log(\"Error parsing rating data\", e);\n            }\n\n            let dom = new JSDOM(data.data);\n            let document = dom.window.document;\n\n            const name = document.querySelector(\".user-details-container\")?.children[0]\n                ?.children[1]?.textContent || \"\";\n\n            // Safe extraction with optional chaining\n            const profile = document.querySelector(\".user-details-container\")?.children[0]\n                ?.children[0]?.getAttribute(\"src\") || \"\";\n\n            const currentRatingText = document.querySelector(\".rating-number\")?.textContent;\n            const currentRating = currentRatingText ? parseInt(currentRatingText) : 0;\n\n            const highestRatingText = document.querySelector(\".rating-number\")?.parentNode?.children[4]?.textContent?.split(\"Rating\")[1];\n            const highestRating = highestRatingText ? parseInt(highestRatingText) : 0;\n\n            const countryFlag = document.querySelector(\".user-country-flag\")?.getAttribute(\"src\") || \"\";\n            const countryName = document.querySelector(\".user-country-name\")?.textContent || \"\";\n\n            const globalRankText = document.querySelector(\".rating-ranks\")?.children[0]?.children[0]\n                ?.children[0]?.children[0]?.innerHTML;\n            const globalRank = globalRankText ? parseInt(globalRankText) : 0;\n\n            const countryRankText = document.querySelector(\".rating-ranks\")?.children[0]?.children[1]\n                ?.children[0]?.children[0]?.innerHTML;\n            const countryRank = countryRankText ? parseInt(countryRankText) : 0;\n\n            const stars = document.querySelector(\".rating\")?.textContent || \"unrated\";\n\n            return {\n                success: true,\n                status: resdata.status,\n                profile,\n                name,\n                currentRating,\n                highestRating,\n                countryFlag,\n                countryName,\n                globalRank,\n                countryRank,\n                stars,\n                heatMap: headMapData,\n                ratingData,\n            };\n        }\n        else {\n            return { success: false, status: resdata.status }\n        }\n    } catch (e) {\n        console.log(e)\n        return { success: false, status: 404 }\n    }\n}\n\nexport async function verifyCodeChefOwnership(handle: string, verificationCode: string) {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n    if (!session || !session.user) {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    const result = await checkCodeChefUser(handle);\n\n    if (result.success && result.name) {\n        // Check if the verification code is present in the name\n        // The user edits their \"Name\" field to include the code\n        if (result.name.includes(verificationCode)) {\n             try {\n                await prisma.user.update({\n                    where: { id: session.user.id },\n                    data: {\n                        codeChefVerified: true,\n                        // Ensure the verified handle is the one stored\n                        codeChefHandle: handle\n                    }\n                });\n                revalidatePath(\"/dashboard/settings\"); // Revalidate settings pages\n                revalidateTag(`user-${session.user.id}`); // Invalidate user cache tag\n                return { success: true };\n            } catch (error) {\n                console.error(\"Database update error:\", error);\n                return { success: false, error: \"Failed to update verification status\" };\n            }\n        } else {\n             return { success: false, error: \"Verification code not found in CodeChef name. Please ensure you have updated your profile name.\" };\n        }\n    }\n\n    return { success: false, error: \"Failed to fetch CodeChef profile\" };\n}\n// ... (existing imports and functions)\n\nexport async function checkCodeforcesUser(handle: string) {\n    try {\n        const userInfoRes = await fetch(\n            `https://codeforces.com/api/user.info?handles=${handle}`,\n            { cache: 'no-store' }\n        );\n\n        if (userInfoRes.ok) {\n            const userData = await userInfoRes.json();\n            if (userData.status === \"OK\" && userData.result.length > 0) {\n                const user = userData.result[0];\n                return {\n                    success: true,\n                    status: 200,\n                    firstName: user.firstName,\n                    // Check other fields if needed for existence or display\n                    rating: user.rating,\n                    rank: user.rank,\n                    avatar: user.titlePhoto || user.avatar\n                };\n            }\n        }\n        return { success: false, status: userInfoRes.status };\n    } catch (e) {\n        console.error(e);\n        return { success: false, status: 500 };\n    }\n}\n\nexport async function verifyCodeforcesOwnership(handle: string, verificationCode: string) {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n    if (!session || !session.user) {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    const result = await checkCodeforcesUser(handle);\n\n    if (result.success) {\n        // Check if the verification code is present in the first name\n        // Codeforces allows changing First Name in settings\n        if (result.firstName && result.firstName.includes(verificationCode)) {\n             try {\n                await prisma.user.update({\n                    where: { id: session.user.id },\n                    data: {\n                        codeforcesVerified: true,\n                        // Ensure the verified handle is the one stored\n                        codeforcesHandle: handle\n                    }\n                });\n                revalidatePath(\"/dashboard/settings\"); // Revalidate settings pages\n                revalidateTag(`user-${session.user.id}`); // Invalidate user cache tag\n                return { success: true };\n            } catch (error) {\n                console.error(\"Database update error:\", error);\n                return { success: false, error: \"Failed to update verification status\" };\n            }\n        } else {\n             return { success: false, error: \"Verification code not found in Codeforces First Name. Please ensure you have updated it in your profile settings.\" };\n        }\n    }\n\n    return { success: false, error: \"Failed to fetch Codeforces profile\" };\n}\n"],"names":[],"mappings":";;;;;;;IAuGsB,0BAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///home/vishnu/Documents/projects/Algo-fox/actions/platform.action.ts"],"sourcesContent":["\"use server\";\n\nimport { JSDOM } from \"jsdom\";\nimport { auth } from \"@/lib/auth\";\nimport { prisma } from \"@/lib/prisma\";\nimport { revalidatePath, revalidateTag } from \"next/cache\";\nimport { headers } from \"next/headers\";\n\nexport async function checkCodeChefUser(handle: string) {\n    try {\n        const resdata = await fetch(\n            `https://www.codechef.com/users/${handle}`,\n            { cache: 'no-store' }\n        );\n\n        if (resdata.status == 200) {\n\n            let d = await resdata.text();\n            let data = { data: d };\n\n            // Heatmap data extraction\n            let heatMapDataCursour1 =\n                data.data.search(\"var userDailySubmissionsStats =\") +\n                \"var userDailySubmissionsStats =\".length;\n            let heatMapDataCursour2 = data.data.search(\"'#js-heatmap\") - 34;\n            let heatDataString = data.data.substring(\n                heatMapDataCursour1,\n                heatMapDataCursour2\n            );\n\n            let headMapData = null;\n            try {\n                 headMapData = JSON.parse(heatDataString);\n            } catch (e) {\n                console.log(\"Error parsing heatmap data\", e);\n            }\n\n            // Rating data extraction\n            let allRating =\n                data.data.search(\"var all_rating = \") + \"var all_rating = \".length;\n            let allRating2 = data.data.search(\"var current_user_rating =\") - 6;\n\n            let ratingData = null;\n            try {\n                 ratingData = JSON.parse(data.data.substring(allRating, allRating2));\n            } catch (e) {\n                console.log(\"Error parsing rating data\", e);\n            }\n\n            let dom = new JSDOM(data.data);\n            let document = dom.window.document;\n\n            const name = document.querySelector(\".user-details-container\")?.children[0]\n                ?.children[1]?.textContent || \"\";\n\n            // Safe extraction with optional chaining\n            const profile = document.querySelector(\".user-details-container\")?.children[0]\n                ?.children[0]?.getAttribute(\"src\") || \"\";\n\n            const currentRatingText = document.querySelector(\".rating-number\")?.textContent;\n            const currentRating = currentRatingText ? parseInt(currentRatingText) : 0;\n\n            const highestRatingText = document.querySelector(\".rating-number\")?.parentNode?.children[4]?.textContent?.split(\"Rating\")[1];\n            const highestRating = highestRatingText ? parseInt(highestRatingText) : 0;\n\n            const countryFlag = document.querySelector(\".user-country-flag\")?.getAttribute(\"src\") || \"\";\n            const countryName = document.querySelector(\".user-country-name\")?.textContent || \"\";\n\n            const globalRankText = document.querySelector(\".rating-ranks\")?.children[0]?.children[0]\n                ?.children[0]?.children[0]?.innerHTML;\n            const globalRank = globalRankText ? parseInt(globalRankText) : 0;\n\n            const countryRankText = document.querySelector(\".rating-ranks\")?.children[0]?.children[1]\n                ?.children[0]?.children[0]?.innerHTML;\n            const countryRank = countryRankText ? parseInt(countryRankText) : 0;\n\n            const stars = document.querySelector(\".rating\")?.textContent || \"unrated\";\n\n            return {\n                success: true,\n                status: resdata.status,\n                profile,\n                name,\n                currentRating,\n                highestRating,\n                countryFlag,\n                countryName,\n                globalRank,\n                countryRank,\n                stars,\n                heatMap: headMapData,\n                ratingData,\n            };\n        }\n        else {\n            return { success: false, status: resdata.status }\n        }\n    } catch (e) {\n        console.log(e)\n        return { success: false, status: 404 }\n    }\n}\n\nexport async function verifyCodeChefOwnership(handle: string, verificationCode: string) {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n    if (!session || !session.user) {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    const result = await checkCodeChefUser(handle);\n\n    if (result.success && result.name) {\n        // Check if the verification code is present in the name\n        // The user edits their \"Name\" field to include the code\n        if (result.name.includes(verificationCode)) {\n             try {\n                await prisma.user.update({\n                    where: { id: session.user.id },\n                    data: {\n                        codeChefVerified: true,\n                        // Ensure the verified handle is the one stored\n                        codeChefHandle: handle\n                    }\n                });\n                revalidatePath(\"/dashboard/settings\"); // Revalidate settings pages\n                revalidateTag(`user-${session.user.id}`); // Invalidate user cache tag\n                return { success: true };\n            } catch (error) {\n                console.error(\"Database update error:\", error);\n                return { success: false, error: \"Failed to update verification status\" };\n            }\n        } else {\n             return { success: false, error: \"Verification code not found in CodeChef name. Please ensure you have updated your profile name.\" };\n        }\n    }\n\n    return { success: false, error: \"Failed to fetch CodeChef profile\" };\n}\n// ... (existing imports and functions)\n\nexport async function checkCodeforcesUser(handle: string) {\n    try {\n        const userInfoRes = await fetch(\n            `https://codeforces.com/api/user.info?handles=${handle}`,\n            { cache: 'no-store' }\n        );\n\n        if (userInfoRes.ok) {\n            const userData = await userInfoRes.json();\n            if (userData.status === \"OK\" && userData.result.length > 0) {\n                const user = userData.result[0];\n                return {\n                    success: true,\n                    status: 200,\n                    firstName: user.firstName,\n                    // Check other fields if needed for existence or display\n                    rating: user.rating,\n                    rank: user.rank,\n                    avatar: user.titlePhoto || user.avatar\n                };\n            }\n        }\n        return { success: false, status: userInfoRes.status };\n    } catch (e) {\n        console.error(e);\n        return { success: false, status: 500 };\n    }\n}\n\nexport async function verifyCodeforcesOwnership(handle: string, verificationCode: string) {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n    if (!session || !session.user) {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    const result = await checkCodeforcesUser(handle);\n\n    if (result.success) {\n        // Check if the verification code is present in the first name\n        // Codeforces allows changing First Name in settings\n        if (result.firstName && result.firstName.includes(verificationCode)) {\n             try {\n                await prisma.user.update({\n                    where: { id: session.user.id },\n                    data: {\n                        codeforcesVerified: true,\n                        // Ensure the verified handle is the one stored\n                        codeforcesHandle: handle\n                    }\n                });\n                revalidatePath(\"/dashboard/settings\"); // Revalidate settings pages\n                revalidateTag(`user-${session.user.id}`); // Invalidate user cache tag\n                return { success: true };\n            } catch (error) {\n                console.error(\"Database update error:\", error);\n                return { success: false, error: \"Failed to update verification status\" };\n            }\n        } else {\n             return { success: false, error: \"Verification code not found in Codeforces First Name. Please ensure you have updated it in your profile settings.\" };\n        }\n    }\n\n    return { success: false, error: \"Failed to fetch Codeforces profile\" };\n}\n"],"names":[],"mappings":";;;;;;;IA2KsB,4BAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 79, "column": 0}, "map": {"version":3,"sources":["file:///home/vishnu/Documents/projects/Algo-fox/components/settings/VerificationModal.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState } from \"react\";\nimport { Copy, Loader2, X, ExternalLink } from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport { verifyCodeChefOwnership, verifyCodeforcesOwnership } from \"@/actions/platform.action\";\n\ninterface VerificationModalProps {\n    platform: string;\n    handle: string;\n    onClose: () => void;\n    onSuccess: () => void;\n}\n\n// ... (existing imports)\n\nexport function VerificationModal({ platform, handle, onClose, onSuccess }: VerificationModalProps) {\n    const [step, setStep] = useState(1);\n    const [isLoading, setIsLoading] = useState(false);\n    // Generate a random 8-character code\n    const [verificationCode] = useState(() => Math.random().toString(36).substring(2, 10));\n\n    const isCodeforces = platform === \"Codeforces\";\n    const editUrl = isCodeforces\n        ? \"https://codeforces.com/settings/social\"\n        : `https://www.codechef.com/users/${handle}/edit`;\n\n    const fieldName = isCodeforces ? \"First Name\" : \"Name\";\n\n    const handleCopy = () => {\n        navigator.clipboard.writeText(verificationCode);\n        toast.success(\"Code copied to clipboard\");\n    };\n\n    const handleVerify = async () => {\n        setIsLoading(true);\n        try {\n            const verifyFn = isCodeforces ? verifyCodeforcesOwnership : verifyCodeChefOwnership;\n            // Imported dynamically or handled via a switch if both were imported.\n            // Since verifyCodeforcesOwnership is a server action, better to import both and choose.\n            // Assuming both are exported from actions/platform.action.ts\n\n            const res = await (isCodeforces ? verifyCodeforcesOwnership(handle, verificationCode) : verifyCodeChefOwnership(handle, verificationCode));\n\n            if (res.success) {\n                toast.success(`${platform} profile verified successfully!`);\n                onSuccess();\n                onClose();\n            } else {\n                toast.error(res.error || `Verification failed. Please check if the ${fieldName} is updated correctly.`);\n            }\n        } catch (error) {\n            toast.error(\"An error occurred during verification\");\n        } finally {\n            setIsLoading(false);\n        }\n    };\n\n    return (\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm\">\n            <div className=\"bg-white dark:bg-[#1a1a1a] rounded-2xl w-full max-w-md p-6 shadow-2xl border border-gray-200 dark:border-[#333] relative animate-in zoom-in-95 duration-200\">\n                <button\n                    onClick={onClose}\n                    className=\"absolute top-4 right-4 p-2 text-gray-500 hover:bg-gray-100 dark:hover:bg-[#262626] rounded-full transition-colors\"\n                >\n                    <X className=\"w-5 h-5\" />\n                </button>\n\n                <div className=\"mb-6 text-center\">\n                    <h2 className=\"text-xl font-bold text-gray-900 dark:text-gray-100 mb-2\">\n                        Verify your {platform} profile\n                    </h2>\n                    <p className=\"text-sm text-gray-500 dark:text-gray-400\">\n                        Step {step} / 3\n                    </p>\n                </div>\n\n                {step === 1 && (\n                    <div className=\"space-y-6\">\n                        <div className=\"text-center space-y-4\">\n                            <p className=\"text-gray-600 dark:text-gray-300\">\n                                Open your {platform} profile settings in a new tab.\n                            </p>\n                            <a\n                                href={editUrl}\n                                target=\"_blank\"\n                                rel=\"noopener noreferrer\"\n                                className=\"inline-flex items-center gap-2 px-6 py-3 bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-400 rounded-xl font-medium hover:bg-orange-200 dark:hover:bg-orange-900/50 transition-colors\"\n                            >\n                                Open {platform} Settings <ExternalLink className=\"w-4 h-4\" />\n                            </a>\n                        </div>\n                        <button\n                            onClick={() => setStep(2)}\n                            className=\"w-full py-3 bg-orange-600 hover:bg-orange-700 text-white font-medium rounded-xl transition-colors\"\n                        >\n                            Continue\n                        </button>\n                    </div>\n                )}\n\n                {step === 2 && (\n                    <div className=\"space-y-6\">\n                         <div className=\"space-y-4\">\n                            <div className=\"text-center\">\n                                <p className=\"text-gray-600 dark:text-gray-300 mb-2\">\n                                    Paste this verification code in your <strong>{fieldName}</strong>\n                                </p>\n                                <p className=\"text-xs text-gray-400\">\n                                    (You can change it back after verification)\n                                </p>\n                            </div>\n\n                            <div className=\"flex items-center gap-2 p-3 bg-gray-50 dark:bg-[#0a0a0a] border border-gray-200 dark:border-[#333] rounded-xl\">\n                                <code className=\"flex-1 text-center font-mono text-lg font-bold text-gray-900 dark:text-gray-100 tracking-wider\">\n                                    {verificationCode}\n                                </code>\n                                <button\n                                    onClick={handleCopy}\n                                    className=\"p-2 text-gray-500 hover:text-orange-600 hover:bg-orange-50 dark:hover:bg-orange-900/20 rounded-lg transition-colors\"\n                                    title=\"Copy Code\"\n                                >\n                                    <Copy className=\"w-5 h-5\" />\n                                </button>\n                            </div>\n                        </div>\n\n                        <div className=\"flex gap-3\">\n                            <button\n                                onClick={() => setStep(1)}\n                                className=\"flex-1 py-3 bg-gray-100 dark:bg-[#262626] text-gray-700 dark:text-gray-300 font-medium rounded-xl hover:bg-gray-200 dark:hover:bg-[#333] transition-colors\"\n                            >\n                                Back\n                            </button>\n                            <button\n                                onClick={() => setStep(3)}\n                                className=\"flex-1 py-3 bg-orange-600 hover:bg-orange-700 text-white font-medium rounded-xl transition-colors\"\n                            >\n                                I've pasted the code\n                            </button>\n                        </div>\n                    </div>\n                )}\n\n                {step === 3 && (\n                    <div className=\"space-y-6\">\n                        <div className=\"text-center space-y-4\">\n                            <p className=\"text-gray-600 dark:text-gray-300\">\n                                Make sure you saved your profile changes on {platform} using the verification code.\n                            </p>\n                             <p className=\"text-sm text-gray-500\">\n                                Click verify below to confirm ownership.\n                            </p>\n                        </div>\n\n                        <div className=\"flex gap-3\">\n                            <button\n                                onClick={() => setStep(2)}\n                                disabled={isLoading}\n                                className=\"flex-1 py-3 bg-gray-100 dark:bg-[#262626] text-gray-700 dark:text-gray-300 font-medium rounded-xl hover:bg-gray-200 dark:hover:bg-[#333] transition-colors disabled:opacity-50\"\n                            >\n                                Back\n                            </button>\n                            <button\n                                onClick={handleVerify}\n                                disabled={isLoading}\n                                className=\"flex-1 py-3 bg-orange-600 hover:bg-orange-700 text-white font-medium rounded-xl transition-colors flex items-center justify-center gap-2 disabled:opacity-70\"\n                            >\n                                {isLoading ? <Loader2 className=\"w-5 h-5 animate-spin\" /> : `Verify ${platform} Profile`}\n                            </button>\n                        </div>\n                    </div>\n                )}\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 457, "column": 0}, "map": {"version":3,"sources":["file:///home/vishnu/Documents/projects/Algo-fox/components/settings/PlatformSettings.tsx"],"sourcesContent":["\"use client\";\n\nimport { useForm, UseFormReturn } from \"react-hook-form\";\nimport { useState, useCallback, useEffect } from \"react\";\nimport { Loader2, Trash2, Check, Github, AlertCircle, ExternalLink, X, ShieldCheck, Link as LinkIcon } from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport { updateUserInfo } from \"@/actions/user.action\";\nimport { checkCodeChefUser, checkCodeforcesUser } from \"@/actions/platform.action\";\nimport Image from \"next/image\";\nimport { VerificationModal } from \"@/components/settings/VerificationModal\";\nimport { useRouter } from \"next/navigation\";\n\ninterface PlatformSettingsProps {\n    user: {\n        leetCodeHandle?: string | null;\n        codeChefHandle?: string | null;\n        codeChefVerified?: boolean | null;\n        codeforcesHandle?: string | null;\n        codeforcesVerified?: boolean | null;\n        githubHandle?: string | null;\n    };\n}\n\ninterface FormData {\n    leetCodeHandle: string;\n    codeChefHandle: string;\n    codeforcesHandle: string;\n    githubHandle: string;\n}\n\ninterface PlatformRowProps {\n    id: keyof FormData;\n    label: string;\n    iconSrc: string | React.ReactNode;\n    placeholder: string;\n    urlPrefix?: string;\n    form: UseFormReturn<FormData>;\n    onSubmit: (platform: keyof FormData) => Promise<void>;\n    handleDisconnect: (platform: keyof FormData) => Promise<void>;\n    isLoading: string | null;\n    initialValue: string;\n    onVerify?: (handle: string) => void;\n    isVerified?: boolean;\n}\n\n// Debounce helper\nfunction useDebounce<T>(value: T, delay: number): T {\n    const [debouncedValue, setDebouncedValue] = useState(value);\n    useEffect(() => {\n        const handler = setTimeout(() => {\n            setDebouncedValue(value);\n        }, delay);\n        return () => {\n            clearTimeout(handler);\n        };\n    }, [value, delay]);\n    return debouncedValue;\n}\n\nconst PlatformRow = ({\n    id,\n    label,\n    iconSrc,\n    placeholder,\n    urlPrefix,\n    form,\n    onSubmit,\n    handleDisconnect,\n    isLoading,\n    initialValue,\n    onVerify,\n    isVerified\n}: PlatformRowProps) => {\n    const { register, watch, formState: { errors } } = form;\n    const value = watch(id);\n    const debouncedValue = useDebounce(value, 500);\n    const [isValid, setIsValid] = useState<boolean | null>(null);\n    const [isChecking, setIsChecking] = useState(false);\n\n    // Show connected state only if value is saved (matches initial) and not empty\n    const isSaved = value === initialValue && !!value;\n\n    // Existence check effect\n    useEffect(() => {\n        const checkExistence = async () => {\n            if (!debouncedValue || debouncedValue === initialValue) {\n                setIsValid(null);\n                return;\n            }\n\n            // Check CodeChef\n            if (id === \"codeChefHandle\") {\n                setIsChecking(true);\n                const res = await checkCodeChefUser(debouncedValue);\n                setIsChecking(false);\n                setIsValid(res.success);\n            }\n\n            // Check Codeforces\n            if (id === \"codeforcesHandle\") {\n                setIsChecking(true);\n                const res = await checkCodeforcesUser(debouncedValue);\n                setIsChecking(false);\n                setIsValid(res.success);\n            }\n        };\n\n        checkExistence();\n    }, [debouncedValue, id, initialValue]);\n\n    return (\n            <div className=\"flex items-center justify-between p-4 bg-gray-50 dark:bg-[#1a1a1a]/50 rounded-xl border border-gray-100 dark:border-[#262626]\">\n            <div className=\"flex items-center gap-3 w-1/4\">\n                {typeof iconSrc === \"string\" ? (\n                    <Image src={iconSrc} alt={label} width={24} height={24} className=\"rounded-sm object-contain\" />\n                ) : (\n                    iconSrc\n                )}\n                <span className=\"font-medium text-gray-900 dark:text-gray-100\">{label}</span>\n            </div>\n\n            <div className=\"flex-1 flex gap-2\">\n                    <div className=\"flex-1 flex items-center bg-white dark:bg-[#0a0a0a] border border-gray-200 dark:border-[#333] rounded-lg px-3 overflow-hidden relative\">\n                        {urlPrefix && <span className=\"text-gray-400 text-sm whitespace-nowrap mr-1\">{urlPrefix}</span>}\n                        <input\n                            {...register(id)}\n                            className=\"flex-1 py-2 bg-transparent border-none outline-none text-sm\"\n                            placeholder={placeholder}\n                        />\n                        {/* Status Icon inside input */}\n                        <div className=\"absolute right-3 top-1/2 -translate-y-1/2\">\n                            {isChecking ? (\n                                <Loader2 className=\"w-4 h-4 animate-spin text-gray-400\" />\n                            ) : isValid === true ? (\n                                <Check className=\"w-4 h-4 text-green-500\" />\n                            ) : isValid === false && debouncedValue ? (\n                                <X className=\"w-4 h-4 text-red-500\" />\n                            ) : null}\n                        </div>\n                    </div>\n\n                    {isSaved ? (\n                    <div className=\"flex items-center gap-2\">\n                            {/* Verification Button or Verified Badge */}\n                            {isVerified ? (\n                                <div className=\"flex items-center gap-1.5 px-3 py-2 bg-green-100 dark:bg-green-900/20 text-green-700 dark:text-green-400 text-xs font-bold rounded-lg border border-green-200 dark:border-green-800\">\n                                    <ShieldCheck className=\"w-4 h-4\" />\n                                    <span>Verified</span>\n                                </div>\n                            ) : onVerify ? (\n                                <button\n                                    onClick={() => onVerify(value)}\n                                    className=\"px-3 py-2 bg-blue-100 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 text-xs font-medium rounded-lg hover:bg-blue-200 dark:hover:bg-blue-900/40 transition-colors\"\n                                >\n                                    Verify Now\n                                </button>\n                            ) : (\n                                // Neutral \"Linked\" state for other platforms\n                                <div className=\"flex items-center justify-center w-10 h-10 bg-gray-100 dark:bg-gray-800 text-gray-500 rounded-lg\" title=\"Linked\">\n                                    <LinkIcon className=\"w-4 h-4\" />\n                                </div>\n                            )}\n\n                            <button\n                                onClick={() => handleDisconnect(id)}\n                                className=\"flex items-center justify-center w-10 h-10 border border-gray-200 dark:border-[#333] hover:bg-red-50 dark:hover:bg-red-900/20 hover:text-red-600 hover:border-red-200 dark:hover:border-red-800 rounded-lg transition-colors\"\n                                title=\"Disconnect\"\n                            >\n                                <Trash2 className=\"w-4 h-4\" />\n                            </button>\n                    </div>\n                    ) : (\n                        <button\n                        onClick={() => onSubmit(id)}\n                        disabled={isLoading === id || isValid === false}\n                        className=\"px-4 py-2 bg-white dark:bg-[#0a0a0a] border border-gray-200 dark:border-[#333] hover:bg-gray-50 dark:hover:bg-[#1a1a1a] text-sm font-medium rounded-lg transition-colors min-w-[80px] disabled:opacity-50\"\n                    >\n                        {isLoading === id ? <Loader2 className=\"w-4 h-4 animate-spin mx-auto\" /> : \"Save\"}\n                    </button>\n                    )}\n            </div>\n        </div>\n    );\n};\n\nexport function PlatformSettings({ user }: PlatformSettingsProps) {\n    const router = useRouter();\n    const [isLoading, setIsLoading] = useState<string | null>(null);\n    const [verifyingHandle, setVerifyingHandle] = useState<{ platform: string, handle: string } | null>(null);\n\n    const form = useForm<FormData>({\n        defaultValues: {\n            leetCodeHandle: user.leetCodeHandle || \"\",\n            codeChefHandle: user.codeChefHandle || \"\",\n            codeforcesHandle: user.codeforcesHandle || \"\",\n            githubHandle: user.githubHandle || \"\",\n        }\n    });\n\n    const { getValues, setValue, watch, reset } = form;\n\n    const isGithubConnected = !!user.githubHandle || !!watch(\"githubHandle\");\n\n    const onSubmit = async (platform: keyof FormData) => {\n        setIsLoading(platform);\n        const data = getValues();\n\n        try {\n            const updatePayload = {\n                leetCodeHandle: data.leetCodeHandle,\n                codeChefHandle: data.codeChefHandle,\n                codeforcesHandle: data.codeforcesHandle,\n                githubHandle: data.githubHandle,\n            };\n\n            const res = await updateUserInfo(updatePayload);\n            if (res.success) {\n                toast.success(`${platform} handle updated successfully`);\n                reset(data);\n            } else {\n                toast.error(res.error || \"Failed to update profile\");\n            }\n        } catch (error) {\n            toast.error(\"Something went wrong\");\n        } finally {\n            setIsLoading(null);\n        }\n    };\n\n    const handleDisconnect = async (platform: keyof FormData) => {\n         setValue(platform, \"\");\n         await onSubmit(platform);\n    };\n\n    return (\n        <div className=\"space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n            {verifyingHandle && (\n                <VerificationModal\n                    platform={verifyingHandle.platform}\n                    handle={verifyingHandle.handle}\n                    onClose={() => setVerifyingHandle(null)}\n                    onSuccess={() => {\n                        setVerifyingHandle(null);\n                        router.refresh();\n                        toast.success(\"CodeChef profile verified successfully\");\n                    }}\n                />\n            )}\n\n            <div>\n                <h1 className=\"text-2xl font-bold font-mono text-gray-900 dark:text-gray-100\">Platforms</h1>\n                <p className=\"text-gray-500 dark:text-gray-400 text-sm mt-1\">\n                    You can update and verify your platform details here.\n                </p>\n            </div>\n\n            <div className=\"space-y-4\">\n                <h2 className=\"text-lg font-medium font-mono text-gray-900 dark:text-gray-100\">Development</h2>\n\n                <div className=\"flex items-center justify-between p-4 bg-gray-50 dark:bg-[#1a1a1a]/50 rounded-xl border border-gray-100 dark:border-[#262626]\">\n                    <div className=\"flex items-center gap-3\">\n                        <Github className=\"w-6 h-6 text-gray-900 dark:text-gray-100\" />\n                        <span className=\"font-medium text-gray-900 dark:text-gray-100\">Github</span>\n                    </div>\n                    {isGithubConnected ? (\n                         <button className=\"px-4 py-2 bg-white dark:bg-[#0a0a0a] border border-gray-200 dark:border-[#333] text-sm font-medium rounded-lg\">\n                            Connected as {watch(\"githubHandle\")}\n                         </button>\n                    ) : (\n                        <button className=\"px-4 py-2 bg-gray-900 text-white dark:bg-white dark:text-gray-900 text-sm font-medium rounded-lg hover:opacity-90 transition-opacity\">\n                            Connect\n                        </button>\n                    )}\n                </div>\n            </div>\n\n            <div className=\"space-y-4\">\n                <h2 className=\"text-lg font-medium font-mono text-gray-900 dark:text-gray-100\">Problem Solving</h2>\n                <div className=\"space-y-3\">\n                    <PlatformRow\n                        id=\"leetCodeHandle\"\n                        label=\"LeetCode\"\n                        iconSrc=\"/handles_logos/leetcode.png\"\n                        placeholder=\"username\"\n                        urlPrefix=\"https://leetcode.com/u/\"\n                        form={form}\n                        onSubmit={onSubmit}\n                        handleDisconnect={handleDisconnect}\n                        isLoading={isLoading}\n                        initialValue={user.leetCodeHandle || \"\"}\n                    />\n                    <PlatformRow\n                        id=\"codeChefHandle\"\n                        label=\"CodeChef\"\n                        iconSrc=\"/handles_logos/codechef.png\"\n                        placeholder=\"username\"\n                        urlPrefix=\"https://www.codechef.com/users/\"\n                        form={form}\n                        onSubmit={onSubmit}\n                        handleDisconnect={handleDisconnect}\n                        isLoading={isLoading}\n                        initialValue={user.codeChefHandle || \"\"}\n                        onVerify={(handle) => setVerifyingHandle({ platform: \"CodeChef\", handle })}\n                        isVerified={user.codeChefVerified || false}\n                    />\n                    <PlatformRow\n                        id=\"codeforcesHandle\"\n                        label=\"CodeForces\"\n                        iconSrc=\"/handles_logos/codeforces.png\"\n                        placeholder=\"username\"\n                        urlPrefix=\"https://codeforces.com/profile/\"\n                        form={form}\n                        onSubmit={onSubmit}\n                        handleDisconnect={handleDisconnect}\n                        isLoading={isLoading}\n                        initialValue={user.codeforcesHandle || \"\"}\n                        onVerify={(handle) => setVerifyingHandle({ platform: \"Codeforces\", handle })}\n                        isVerified={user.codeforcesVerified || false}\n                    />\n                </div>\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;;;AAVA;;;;;;;;;;AA6CA,kBAAkB;AAClB,SAAS,YAAe,KAAQ,EAAE,KAAa;;IAC3C,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,yKAAQ,EAAC;IACrD,IAAA,0KAAS;iCAAC;YACN,MAAM,UAAU;iDAAW;oBACvB,kBAAkB;gBACtB;gDAAG;YACH;yCAAO;oBACH,aAAa;gBACjB;;QACJ;gCAAG;QAAC;QAAO;KAAM;IACjB,OAAO;AACX;GAXS;AAaT,MAAM,cAAc,CAAC,EACjB,EAAE,EACF,KAAK,EACL,OAAO,EACP,WAAW,EACX,SAAS,EACT,IAAI,EACJ,QAAQ,EACR,gBAAgB,EAChB,SAAS,EACT,YAAY,EACZ,QAAQ,EACR,UAAU,EACK;;IACf,MAAM,EAAE,QAAQ,EAAE,KAAK,EAAE,WAAW,EAAE,MAAM,EAAE,EAAE,GAAG;IACnD,MAAM,QAAQ,MAAM;IACpB,MAAM,iBAAiB,YAAY,OAAO;IAC1C,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAiB;IACvD,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,yKAAQ,EAAC;IAE7C,8EAA8E;IAC9E,MAAM,UAAU,UAAU,gBAAgB,CAAC,CAAC;IAE5C,yBAAyB;IACzB,IAAA,0KAAS;iCAAC;YACN,MAAM;wDAAiB;oBACnB,IAAI,CAAC,kBAAkB,mBAAmB,cAAc;wBACpD,WAAW;wBACX;oBACJ;oBAEA,iBAAiB;oBACjB,IAAI,OAAO,kBAAkB;wBACzB,cAAc;wBACd,MAAM,MAAM,MAAM,IAAA,uKAAiB,EAAC;wBACpC,cAAc;wBACd,WAAW,IAAI,OAAO;oBAC1B;oBAEA,mBAAmB;oBACnB,IAAI,OAAO,oBAAoB;wBAC3B,cAAc;wBACd,MAAM,MAAM,MAAM,IAAA,yKAAmB,EAAC;wBACtC,cAAc;wBACd,WAAW,IAAI,OAAO;oBAC1B;gBACJ;;YAEA;QACJ;gCAAG;QAAC;QAAgB;QAAI;KAAa;IAErC,qBACQ,6LAAC;QAAI,WAAU;;0BACf,6LAAC;gBAAI,WAAU;;oBACV,OAAO,YAAY,yBAChB,6LAAC,2IAAK;wBAAC,KAAK;wBAAS,KAAK;wBAAO,OAAO;wBAAI,QAAQ;wBAAI,WAAU;;;;;mEAElE;kCAEJ,6LAAC;wBAAK,WAAU;kCAAgD;;;;;;;;;;;;0BAGpE,6LAAC;gBAAI,WAAU;;kCACP,6LAAC;wBAAI,WAAU;;4BACV,2BAAa,6LAAC;gCAAK,WAAU;0CAAgD;;;;;;0CAC9E,6LAAC;gCACI,GAAG,SAAS,GAAG;gCAChB,WAAU;gCACV,aAAa;;;;;;0CAGjB,6LAAC;gCAAI,WAAU;0CACV,2BACG,6LAAC,+NAAO;oCAAC,WAAU;;;;;+EACnB,YAAY,qBACZ,6LAAC,gNAAK;oCAAC,WAAU;;;;;+EACjB,YAAY,SAAS,+BACrB,6LAAC,oMAAC;oCAAC,WAAU;;;;;+EACb;;;;;;;;;;;;oBAIX,wBACD,6LAAC;wBAAI,WAAU;;4BAEN,2BACG,6LAAC;gCAAI,WAAU;;kDACX,6LAAC,sOAAW;wCAAC,WAAU;;;;;;kDACvB,6LAAC;kDAAK;;;;;;;;;;;2EAEV,yBACA,6LAAC;gCACG,SAAS,IAAM,SAAS;gCACxB,WAAU;0CACb;;;;;2EAID,6CAA6C;0CAC7C,6LAAC;gCAAI,WAAU;gCAAmG,OAAM;0CACpH,cAAA,6LAAC,6MAAQ;oCAAC,WAAU;;;;;;;;;;;0CAI5B,6LAAC;gCACG,SAAS,IAAM,iBAAiB;gCAChC,WAAU;gCACV,OAAM;0CAEN,cAAA,6LAAC,uNAAM;oCAAC,WAAU;;;;;;;;;;;;;;;;iFAI1B,6LAAC;wBACD,SAAS,IAAM,SAAS;wBACxB,UAAU,cAAc,MAAM,YAAY;wBAC1C,WAAU;kCAET,cAAc,mBAAK,6LAAC,+NAAO;4BAAC,WAAU;;;;;uEAAoC;;;;;;;;;;;;;;;;;;AAMnG;IA5HM;;QAgBqB;;;KAhBrB;AA8HC,SAAS,iBAAiB,EAAE,IAAI,EAAyB;;IAC5D,MAAM,SAAS,IAAA,kJAAS;IACxB,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAgB;IAC1D,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,IAAA,yKAAQ,EAA8C;IAEpG,MAAM,OAAO,IAAA,4KAAO,EAAW;QAC3B,eAAe;YACX,gBAAgB,KAAK,cAAc,IAAI;YACvC,gBAAgB,KAAK,cAAc,IAAI;YACvC,kBAAkB,KAAK,gBAAgB,IAAI;YAC3C,cAAc,KAAK,YAAY,IAAI;QACvC;IACJ;IAEA,MAAM,EAAE,SAAS,EAAE,QAAQ,EAAE,KAAK,EAAE,KAAK,EAAE,GAAG;IAE9C,MAAM,oBAAoB,CAAC,CAAC,KAAK,YAAY,IAAI,CAAC,CAAC,MAAM;IAEzD,MAAM,WAAW,OAAO;QACpB,aAAa;QACb,MAAM,OAAO;QAEb,IAAI;YACA,MAAM,gBAAgB;gBAClB,gBAAgB,KAAK,cAAc;gBACnC,gBAAgB,KAAK,cAAc;gBACnC,kBAAkB,KAAK,gBAAgB;gBACvC,cAAc,KAAK,YAAY;YACnC;YAEA,MAAM,MAAM,MAAM,IAAA,oKAAc,EAAC;YACjC,IAAI,IAAI,OAAO,EAAE;gBACb,oJAAK,CAAC,OAAO,CAAC,GAAG,SAAS,4BAA4B,CAAC;gBACvD,MAAM;YACV,OAAO;gBACH,oJAAK,CAAC,KAAK,CAAC,IAAI,KAAK,IAAI;YAC7B;QACJ,EAAE,OAAO,OAAO;YACZ,oJAAK,CAAC,KAAK,CAAC;QAChB,SAAU;YACN,aAAa;QACjB;IACJ;IAEA,MAAM,mBAAmB,OAAO;QAC3B,SAAS,UAAU;QACnB,MAAM,SAAS;IACpB;IAEA,qBACI,6LAAC;QAAI,WAAU;;YACV,iCACG,6LAAC,oKAAiB;gBACd,UAAU,gBAAgB,QAAQ;gBAClC,QAAQ,gBAAgB,MAAM;gBAC9B,SAAS,IAAM,mBAAmB;gBAClC,WAAW;oBACP,mBAAmB;oBACnB,OAAO,OAAO;oBACd,oJAAK,CAAC,OAAO,CAAC;gBAClB;;;;;;0BAIR,6LAAC;;kCACG,6LAAC;wBAAG,WAAU;kCAAgE;;;;;;kCAC9E,6LAAC;wBAAE,WAAU;kCAAgD;;;;;;;;;;;;0BAKjE,6LAAC;gBAAI,WAAU;;kCACX,6LAAC;wBAAG,WAAU;kCAAiE;;;;;;kCAE/E,6LAAC;wBAAI,WAAU;;0CACX,6LAAC;gCAAI,WAAU;;kDACX,6LAAC,mNAAM;wCAAC,WAAU;;;;;;kDAClB,6LAAC;wCAAK,WAAU;kDAA+C;;;;;;;;;;;;4BAElE,kCACI,6LAAC;gCAAO,WAAU;;oCAAgH;oCACjH,MAAM;;;;;;qDAGxB,6LAAC;gCAAO,WAAU;0CAAuI;;;;;;;;;;;;;;;;;;0BAOrK,6LAAC;gBAAI,WAAU;;kCACX,6LAAC;wBAAG,WAAU;kCAAiE;;;;;;kCAC/E,6LAAC;wBAAI,WAAU;;0CACX,6LAAC;gCACG,IAAG;gCACH,OAAM;gCACN,SAAQ;gCACR,aAAY;gCACZ,WAAU;gCACV,MAAM;gCACN,UAAU;gCACV,kBAAkB;gCAClB,WAAW;gCACX,cAAc,KAAK,cAAc,IAAI;;;;;;0CAEzC,6LAAC;gCACG,IAAG;gCACH,OAAM;gCACN,SAAQ;gCACR,aAAY;gCACZ,WAAU;gCACV,MAAM;gCACN,UAAU;gCACV,kBAAkB;gCAClB,WAAW;gCACX,cAAc,KAAK,cAAc,IAAI;gCACrC,UAAU,CAAC,SAAW,mBAAmB;wCAAE,UAAU;wCAAY;oCAAO;gCACxE,YAAY,KAAK,gBAAgB,IAAI;;;;;;0CAEzC,6LAAC;gCACG,IAAG;gCACH,OAAM;gCACN,SAAQ;gCACR,aAAY;gCACZ,WAAU;gCACV,MAAM;gCACN,UAAU;gCACV,kBAAkB;gCAClB,WAAW;gCACX,cAAc,KAAK,gBAAgB,IAAI;gCACvC,UAAU,CAAC,SAAW,mBAAmB;wCAAE,UAAU;wCAAc;oCAAO;gCAC1E,YAAY,KAAK,kBAAkB,IAAI;;;;;;;;;;;;;;;;;;;;;;;;AAM/D;IA1IgB;;QACG,kJAAS;QAIX,4KAAO;;;MALR"}}]
}