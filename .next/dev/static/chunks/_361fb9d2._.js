(globalThis.TURBOPACK || (globalThis.TURBOPACK = [])).push([typeof document === "object" ? document.currentScript : undefined,
"[project]/actions/data:1d6c22 [app-client] (ecmascript) <text/javascript>", ((__turbopack_context__) => {
"use strict";

/* __next_internal_action_entry_do_not_use__ [{"60ab32f1cc26748b4afce6a433ca3e6dc394836698":"startContestSession"},"actions/contest.ts",""] */ __turbopack_context__.s([
    "startContestSession",
    ()=>startContestSession
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-client] (ecmascript)");
"use turbopack no side effects";
;
var startContestSession = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["createServerReference"])("60ab32f1cc26748b4afce6a433ca3e6dc394836698", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["findSourceMapURL"], "startContestSession"); //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vY29udGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzZXJ2ZXJcIjtcblxuaW1wb3J0IHsgcHJpc21hIH0gZnJvbSBcIkAvbGliL3ByaXNtYVwiO1xuaW1wb3J0IHsgYXV0aCB9IGZyb20gXCJAL2xpYi9hdXRoXCI7XG5pbXBvcnQgeyBoZWFkZXJzIH0gZnJvbSBcIm5leHQvaGVhZGVyc1wiO1xuaW1wb3J0IHsgeiB9IGZyb20gXCJ6b2RcIjtcbmltcG9ydCB7IHJldmFsaWRhdGVQYXRoLCByZXZhbGlkYXRlVGFnIH0gZnJvbSBcIm5leHQvY2FjaGVcIjtcbmltcG9ydCB7IHVuc3RhYmxlX2NhY2hlIGFzIGNhY2hlLCB1bnN0YWJsZV9ub1N0b3JlIGFzIG5vU3RvcmUgfSBmcm9tIFwibmV4dC9jYWNoZVwiO1xuaW1wb3J0IHsgY2FjaGVUYWcsIGNhY2hlTGlmZSB9IGZyb20gXCJuZXh0L2NhY2hlXCI7XG5pbXBvcnQgeyBhZnRlciB9IGZyb20gXCJuZXh0L3NlcnZlclwiOyAvLyBGb3IgYmFja2dyb3VuZCB0YXNrc1xuXG5jb25zdCBjb250ZXN0U2NoZW1hID0gei5vYmplY3Qoe1xuICAgIHRpdGxlOiB6LnN0cmluZygpLm1pbigzLCBcIlRpdGxlIG11c3QgYmUgYXQgbGVhc3QgMyBjaGFyYWN0ZXJzXCIpLFxuICAgIGRlc2NyaXB0aW9uOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgc3RhcnRUaW1lOiB6LmNvZXJjZS5kYXRlKCksXG4gICAgZW5kVGltZTogei5jb2VyY2UuZGF0ZSgpLFxuICAgIHZpc2liaWxpdHk6IHouZW51bShbXCJQVUJMSUNcIiwgXCJJTlNUSVRVVElPTlwiLCBcIkNMQVNTUk9PTVwiXSksXG4gICAgY2xhc3Nyb29tSWQ6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgICBpbnN0aXR1dGlvbklkOiB6LnN0cmluZygpLm9wdGlvbmFsKCkubnVsbGFibGUoKSxcbiAgICBwcm9ibGVtczogei5hcnJheSh6LnN0cmluZygpKS5taW4oMSwgXCJTZWxlY3QgYXQgbGVhc3Qgb25lIHByb2JsZW1cIiksXG4gICAgY29udGVzdFBhc3N3b3JkOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgcmFuZG9taXplUXVlc3Rpb25zOiB6LmJvb2xlYW4oKS5kZWZhdWx0KGZhbHNlKSxcbn0pO1xuXG5jb25zdCBjb250ZXN0V2l0aFByb2JsZW1zU2NoZW1hID0gei5vYmplY3Qoe1xuICAgIHRpdGxlOiB6LnN0cmluZygpLm1pbigzLCBcIlRpdGxlIG11c3QgYmUgYXQgbGVhc3QgMyBjaGFyYWN0ZXJzXCIpLFxuICAgIHNsdWc6IHouc3RyaW5nKCkubWluKDMsIFwiU2x1ZyBtdXN0IGJlIGF0IGxlYXN0IDMgY2hhcmFjdGVyc1wiKSxcbiAgICBkZXNjcmlwdGlvbjogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAgIHN0YXJ0VGltZTogei5kYXRlKCksXG4gICAgZW5kVGltZTogei5kYXRlKCksXG4gICAgdmlzaWJpbGl0eTogei5lbnVtKFtcIlBVQkxJQ1wiLCBcIklOU1RJVFVUSU9OXCIsIFwiQ0xBU1NST09NXCJdKSxcbiAgICBoaWRkZW46IHouYm9vbGVhbigpLmRlZmF1bHQoZmFsc2UpLFxuICAgIGNsYXNzcm9vbUlkOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgaW5zdGl0dXRpb25JZDogei5zdHJpbmcoKS5vcHRpb25hbCgpLm51bGxhYmxlKCksXG4gICAgYmFja2dyb3VuZEltYWdlOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgcHJpemVzOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgcnVsZXM6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgICBwcm9ibGVtczogei5hcnJheSh6LmFueSgpKSwgLy8gRnVsbCBwcm9ibGVtIGRhdGEgb2JqZWN0c1xuICAgIGNvbnRlc3RQYXNzd29yZDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAgIHJhbmRvbWl6ZVF1ZXN0aW9uczogei5ib29sZWFuKCkuZGVmYXVsdChmYWxzZSksXG59KTtcblxuLyoqXG4gKiBGZXRjaGVzIGNvbnRlc3RzIHZpc2libGUgdG8gdGhlIGN1cnJlbnQgdXNlci5cbiAqL1xuLyoqXG4gKiBDYWNoZWQgZmV0Y2ggZm9yIHB1YmxpYyBjb250ZXN0c1xuICovXG5hc3luYyBmdW5jdGlvbiBnZXRQdWJsaWNDb250ZXN0cygpIHtcbiAgICBcInVzZSBjYWNoZVwiXG4gICAgY2FjaGVUYWcoXCJjb250ZXN0cy1wdWJsaWNcIik7XG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIGNhY2hlTGlmZShcImNvbnRlc3RzXCIpO1xuXG4gICAgcmV0dXJuIHByaXNtYS5jb250ZXN0LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgIHZpc2liaWxpdHk6IFwiUFVCTElDXCIsXG4gICAgICAgICAgICBoaWRkZW46IGZhbHNlLFxuICAgICAgICB9LFxuICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICBfY291bnQ6IHsgc2VsZWN0OiB7IHByb2JsZW1zOiB0cnVlIH0gfVxuICAgICAgICB9LFxuICAgICAgICBvcmRlckJ5OiB7IHN0YXJ0VGltZTogXCJkZXNjXCIgfSxcbiAgICB9KTtcbn1cblxuLyoqXG4gKiBGZXRjaGVzIGNvbnRlc3RzIHZpc2libGUgdG8gdGhlIGN1cnJlbnQgdXNlci5cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFZpc2libGVDb250ZXN0cygpIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIHRyeSB7XG4gICAgICAgIGlmICghc2Vzc2lvbj8udXNlcikge1xuICAgICAgICAgICAgY29uc3QgY29udGVzdHMgPSBhd2FpdCBnZXRQdWJsaWNDb250ZXN0cygpO1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgY29udGVzdHMgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gc2Vzc2lvbi51c2VyIGFzIGFueTtcblxuICAgICAgICBpZiAoY3VycmVudFVzZXIucm9sZSA9PT0gXCJBRE1JTlwiKSB7XG4gICAgICAgICAgICBjb25zdCBjb250ZXN0cyA9IGF3YWl0IHByaXNtYS5jb250ZXN0LmZpbmRNYW55KHtcbiAgICAgICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgICAgIF9jb3VudDogeyBzZWxlY3Q6IHsgcHJvYmxlbXM6IHRydWUgfSB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBvcmRlckJ5OiB7IHN0YXJ0VGltZTogXCJkZXNjXCIgfSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgY29udGVzdHMgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGNvbnRlc3RzID0gYXdhaXQgcHJpc21hLmNvbnRlc3QuZmluZE1hbnkoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICBPUjogW1xuICAgICAgICAgICAgICAgICAgICB7IHZpc2liaWxpdHk6IFwiUFVCTElDXCIgfSxcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgQU5EOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeyB2aXNpYmlsaXR5OiBcIklOU1RJVFVUSU9OXCIgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IGluc3RpdHV0aW9uSWQ6IGN1cnJlbnRVc2VyLmluc3RpdHV0aW9uSWQgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIEFORDogW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgdmlzaWJpbGl0eTogXCJDTEFTU1JPT01cIiB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgT1I6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgY2xhc3Nyb29tOiB7IHN0dWRlbnRzOiB7IHNvbWU6IHsgaWQ6IGN1cnJlbnRVc2VyLmlkIH0gfSB9IH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IGNyZWF0b3JJZDogY3VycmVudFVzZXIuaWQgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgeyBjcmVhdG9ySWQ6IGN1cnJlbnRVc2VyLmlkIH0sXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgX2NvdW50OiB7IHNlbGVjdDogeyBwcm9ibGVtczogdHJ1ZSB9IH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvcmRlckJ5OiB7IHN0YXJ0VGltZTogXCJkZXNjXCIgfSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgY29udGVzdHMgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGZldGNoIGNvbnRlc3RzOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZmV0Y2ggY29udGVzdHNcIiB9O1xuICAgIH1cbn1cblxuXG4vKipcbiAqIEZldGNoZXMgYSBzaW5nbGUgY29udGVzdCdzIGRldGFpbHMgd2l0aCBhdXRob3JpemF0aW9uLlxuICovXG4vKipcbiAqIEZldGNoZXMgYSBzaW5nbGUgY29udGVzdCdzIGRldGFpbHMgd2l0aCBhdXRob3JpemF0aW9uLlxuICovXG4vKipcbiAqIENhY2hlZCBjb250ZXN0IGRldGFpbCBmZXRjaGVyXG4gKiBSZXR1cm5zIGNvbnRlc3QgZGF0YSB3aXRob3V0IHVzZXItc3BlY2lmaWMgY29udGV4dFxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRDYWNoZWRDb250ZXN0KGNvbnRlc3RJZDogc3RyaW5nKSB7XG4gICAgXCJ1c2UgY2FjaGVcIlxuICAgIGNhY2hlVGFnKGBjb250ZXN0LSR7Y29udGVzdElkfWApO1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBjYWNoZUxpZmUoXCJjb250ZXN0LWRldGFpbFwiKTtcblxuICAgIHJldHVybiBwcmlzbWEuY29udGVzdC5maW5kVW5pcXVlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6IGNvbnRlc3RJZCB9LFxuICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICBfY291bnQ6IHtcbiAgICAgICAgICAgICAgICBzZWxlY3Q6IHsgcHJvYmxlbXM6IHRydWUgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwcm9ibGVtczoge1xuICAgICAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICAgICAgcHJvYmxlbToge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlmZmljdWx0eTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbHVnOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9yZGVyQnk6IHsgb3JkZXI6IFwiYXNjXCIgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgfSk7XG59XG5cbi8qKlxuICogRmV0Y2hlcyBhIHNpbmdsZSBjb250ZXN0J3MgZGV0YWlscyB3aXRoIGF1dGhvcml6YXRpb24uXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRDb250ZXN0RGV0YWlsKGNvbnRlc3RJZDogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjb250ZXN0ID0gYXdhaXQgZ2V0Q2FjaGVkQ29udGVzdChjb250ZXN0SWQpO1xuXG4gICAgICAgIGlmICghY29udGVzdCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkNvbnRlc3Qgbm90IGZvdW5kXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gc2Vzc2lvbj8udXNlciBhcyBhbnk7XG4gICAgICAgIGNvbnN0IHBhcnRpY2lwYXRpb24gPSBjdXJyZW50VXNlciA/IGF3YWl0IHByaXNtYS5jb250ZXN0UGFydGljaXBhdGlvbi5maW5kVW5pcXVlKHtcbiAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgdXNlcklkX2NvbnRlc3RJZDoge1xuICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IGN1cnJlbnRVc2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkgOiBudWxsO1xuXG4gICAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgICAgIGNvbnN0IGhhc1N0YXJ0ZWQgPSBub3cgPj0gY29udGVzdC5zdGFydFRpbWU7XG4gICAgICAgIGNvbnN0IGlzQ3JlYXRvciA9IGN1cnJlbnRVc2VyPy5pZCA9PT0gY29udGVzdC5jcmVhdG9ySWQ7XG4gICAgICAgIGNvbnN0IGlzQWRtaW4gPSBjdXJyZW50VXNlcj8ucm9sZSA9PT0gXCJBRE1JTlwiO1xuXG4gICAgICAgIC8vIFZpc2liaWxpdHkgQ2hlY2tcbiAgICAgICAgbGV0IGlzQXV0aG9yaXplZCA9IGZhbHNlO1xuICAgICAgICBpZiAoY29udGVzdC52aXNpYmlsaXR5ID09PSBcIlBVQkxJQ1wiKSB7XG4gICAgICAgICAgICBpc0F1dGhvcml6ZWQgPSB0cnVlO1xuICAgICAgICB9IGVsc2UgaWYgKGlzQWRtaW4pIHtcbiAgICAgICAgICAgIGlzQXV0aG9yaXplZCA9IHRydWU7XG4gICAgICAgIH0gZWxzZSBpZiAoY3VycmVudFVzZXIpIHtcbiAgICAgICAgICAgIGlmIChpc0NyZWF0b3IpIHtcbiAgICAgICAgICAgICAgICBpc0F1dGhvcml6ZWQgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChjb250ZXN0LnZpc2liaWxpdHkgPT09IFwiSU5TVElUVVRJT05cIikge1xuICAgICAgICAgICAgICAgIC8vIFVzZSA9PSBmb3IgbnVsbC91bmRlZmluZWQgbG9vc2UgZXF1YWxpdHkgY2hlY2tcbiAgICAgICAgICAgICAgICBpc0F1dGhvcml6ZWQgPSBjdXJyZW50VXNlci5pbnN0aXR1dGlvbklkID09IGNvbnRlc3QuaW5zdGl0dXRpb25JZDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoY29udGVzdC52aXNpYmlsaXR5ID09PSBcIkNMQVNTUk9PTVwiKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZW5yb2xsbWVudCA9IGF3YWl0IHByaXNtYS5jbGFzc3Jvb20uZmluZEZpcnN0KHtcbiAgICAgICAgICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBjb250ZXN0LmNsYXNzcm9vbUlkIGFzIHN0cmluZyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0dWRlbnRzOiB7IHNvbWU6IHsgaWQ6IGN1cnJlbnRVc2VyLmlkIH0gfSxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpc0F1dGhvcml6ZWQgPSAhIWVucm9sbG1lbnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIWlzQXV0aG9yaXplZCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZCBhY2Nlc3MgdG8gdGhpcyBjb250ZXN0LlwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBjYW5TZWVQcm9ibGVtcyA9IChoYXNTdGFydGVkIHx8IGlzQWRtaW4gfHwgaXNDcmVhdG9yKSAmJiAocGFydGljaXBhdGlvbj8uYWNjZXB0ZWRSdWxlcyB8fCBpc0NyZWF0b3IgfHwgaXNBZG1pbik7XG5cbiAgICAgICAgLy8gRml4OiBJZiB0aGUgY29udGVzdCBpcyBvdmVyLCBhbGxvd2VkIHJvbGVzIHNob3VsZCBjaGVjayBwYXJ0aWNpcGF0aW9uIHByb3Blcmx5LFxuICAgICAgICAvLyBidXQgdHlwaWNhbGx5IGFsbG93cyB2aWV3aW5nIGlmIHB1YmxpYy9hdXRob3JpemVkLlxuICAgICAgICAvLyBCdXQgZm9yIFwiTGl2ZVwiIGNvbnRlc3RzLCB0aGUgY3VycmVudCBsb2dpYyBpcyBjb3JyZWN0LlxuXG4gICAgICAgIGNvbnN0IHJlcXVpcmVzUGFzc3dvcmQgPSAhIWNvbnRlc3QuY29udGVzdFBhc3N3b3JkO1xuXG4gICAgICAgIC8vIFNodWZmbGUgcHJvYmxlbXMgaWYgcmFuZG9taXplUXVlc3Rpb25zIGlzIGVuYWJsZWRcbiAgICAgICAgLy8gVXNlIGEgc2ltcGxlIHNlZWRlZCBzaHVmZmxlIGJhc2VkIG9uIHVzZXJJZCArIGNvbnRlc3RJZCBmb3IgY29uc2lzdGVuY3lcbiAgICAgICAgbGV0IHZpc2libGVQcm9ibGVtcyA9IGNhblNlZVByb2JsZW1zID8gY29udGVzdC5wcm9ibGVtcyA6IFtdO1xuXG4gICAgICAgIGlmIChjb250ZXN0LnJhbmRvbWl6ZVF1ZXN0aW9ucyAmJiBjdXJyZW50VXNlciAmJiB2aXNpYmxlUHJvYmxlbXMubGVuZ3RoID4gMCAmJiAhaXNBZG1pbiAmJiAhaXNDcmVhdG9yKSB7XG4gICAgICAgICAgICAvLyBTaW1wbGUgc3RyaW5nIGhhc2ggZnVuY3Rpb24gZm9yIHNlZWRpbmdcbiAgICAgICAgICAgIGNvbnN0IHNlZWRTdHIgPSBgJHtjdXJyZW50VXNlci5pZH0tJHtjb250ZXN0SWR9YDtcbiAgICAgICAgICAgIGxldCBzZWVkID0gMDtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2VlZFN0ci5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHNlZWQgPSAoKHNlZWQgPDwgNSkgLSBzZWVkKSArIHNlZWRTdHIuY2hhckNvZGVBdChpKTtcbiAgICAgICAgICAgICAgICBzZWVkIHw9IDA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIERldGVybWluaXN0aWMgc2h1ZmZsZVxuICAgICAgICAgICAgdmlzaWJsZVByb2JsZW1zID0gWy4uLnZpc2libGVQcm9ibGVtc10uc29ydCgoYSwgYikgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHggPSBNYXRoLnNpbihzZWVkKyspICogMTAwMDA7XG4gICAgICAgICAgICAgICAgcmV0dXJuICh4IC0gTWF0aC5mbG9vcih4KSkgLSAwLjU7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEZldGNoIHVzZXIncyBzb2x2ZWQgcHJvYmxlbXMgZm9yIHRoaXMgY29udGVzdFxuICAgICAgICBjb25zdCBzb2x2ZWRQcm9ibGVtSWRzID0gbmV3IFNldDxzdHJpbmc+KCk7XG4gICAgICAgIGlmIChjdXJyZW50VXNlcikge1xuICAgICAgICAgICAgY29uc3Qgc29sdmVkU3VibWlzc2lvbnMgPSBhd2FpdCBwcmlzbWEuc3VibWlzc2lvbi5maW5kTWFueSh7XG4gICAgICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkOiBjdXJyZW50VXNlci5pZCxcbiAgICAgICAgICAgICAgICAgICAgY29udGVzdElkOiBjb250ZXN0SWQsXG4gICAgICAgICAgICAgICAgICAgIHN0YXR1czogXCJBQ0NFUFRFRFwiLFxuICAgICAgICAgICAgICAgICAgICBwcm9ibGVtSWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGluOiB2aXNpYmxlUHJvYmxlbXMubWFwKHAgPT4gcC5wcm9ibGVtLmlkKVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBzZWxlY3Q6IHsgcHJvYmxlbUlkOiB0cnVlIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgc29sdmVkU3VibWlzc2lvbnMuZm9yRWFjaChzID0+IHNvbHZlZFByb2JsZW1JZHMuYWRkKHMucHJvYmxlbUlkKSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRlc3Q6IHtcbiAgICAgICAgICAgICAgICAuLi5jb250ZXN0LFxuICAgICAgICAgICAgICAgIHByb2JsZW1zOiB2aXNpYmxlUHJvYmxlbXMubWFwKHZwID0+ICh7XG4gICAgICAgICAgICAgICAgICAgIC4uLnZwLFxuICAgICAgICAgICAgICAgICAgICBpc1NvbHZlZDogc29sdmVkUHJvYmxlbUlkcy5oYXModnAucHJvYmxlbS5pZClcbiAgICAgICAgICAgICAgICB9KSksXG4gICAgICAgICAgICAgICAgaGFzU3RhcnRlZCxcbiAgICAgICAgICAgICAgICBoYXNFbmRlZDogbm93ID4gY29udGVzdC5lbmRUaW1lLFxuICAgICAgICAgICAgICAgIGNhbk1hbmFnZTogaXNBZG1pbiB8fCBpc0NyZWF0b3IsXG4gICAgICAgICAgICAgICAgaGFzQWNjZXB0ZWRSdWxlczogcGFydGljaXBhdGlvbj8uYWNjZXB0ZWRSdWxlcyB8fCBmYWxzZSxcbiAgICAgICAgICAgICAgICBpc0ZpbmlzaGVkOiBwYXJ0aWNpcGF0aW9uPy5pc0ZpbmlzaGVkIHx8IGZhbHNlLFxuICAgICAgICAgICAgICAgIHJlcXVpcmVzUGFzc3dvcmQsXG4gICAgICAgICAgICAgICAgY29udGVzdFBhc3N3b3JkOiBudWxsLCAvLyBOZXZlciByZXR1cm4gcGxhaW4gcGFzc3dvcmRcbiAgICAgICAgICAgICAgICBzZXNzaW9uSWQ6IHBhcnRpY2lwYXRpb24/LnNlc3Npb25JZCAvLyBSZXR1cm4gc2Vzc2lvbklkIGZvciBwcm90ZWN0aW9uXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBmZXRjaCBjb250ZXN0IGRldGFpbDpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGZldGNoIGNvbnRlc3RcIiB9O1xuICAgIH1cbn1cblxuLy8gLi4uIGV4aXN0aW5nIGNvZGUgLi4uXG5cbi8vIC4uLiBleGlzdGluZyBjb2RlIC4uLlxuXG4vLyAuLi4gZXhpc3RpbmcgY29kZSAuLi5cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUNvbnRlc3QoZGF0YTogei5pbmZlcjx0eXBlb2YgY29udGVzdFNjaGVtYT4pIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIGlmICghc2Vzc2lvbj8udXNlcikge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcbiAgICB9XG5cbiAgICBjb25zdCBjdXJyZW50VXNlciA9IHNlc3Npb24udXNlciBhcyBhbnk7XG5cbiAgICBpZiAoIVtcIkFETUlOXCIsIFwiSU5TVElUVVRJT05fTUFOQUdFUlwiLCBcIkNPTlRFU1RfTUFOQUdFUlwiLCBcIlRFQUNIRVJcIl0uaW5jbHVkZXMoY3VycmVudFVzZXIucm9sZSkpIHtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgdmFsaWRhdGVkRGF0YSA9IGNvbnRlc3RTY2hlbWEucGFyc2UoZGF0YSk7XG5cbiAgICAgICAgLy8gR2VuZXJhdGUgYSBtb3JlIHJvYnVzdCB1bmlxdWUgc2x1Z1xuICAgICAgICBjb25zdCBiYXNlU2x1ZyA9IHZhbGlkYXRlZERhdGEudGl0bGUudG9Mb3dlckNhc2UoKS5yZXBsYWNlKC9bXmEtejAtOV0rL2csIFwiLVwiKS5yZXBsYWNlKC8oXi18LSQpL2csIFwiXCIpO1xuICAgICAgICBjb25zdCB1bmlxdWVTbHVnID0gYCR7YmFzZVNsdWd9LSR7RGF0ZS5ub3coKX1gO1xuXG4gICAgICAgIGNvbnN0IGNvbnRlc3QgPSBhd2FpdCBwcmlzbWEuY29udGVzdC5jcmVhdGUoe1xuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgIHRpdGxlOiB2YWxpZGF0ZWREYXRhLnRpdGxlLFxuICAgICAgICAgICAgICAgIHNsdWc6IHVuaXF1ZVNsdWcsXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHZhbGlkYXRlZERhdGEuZGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgc3RhcnRUaW1lOiB2YWxpZGF0ZWREYXRhLnN0YXJ0VGltZSxcbiAgICAgICAgICAgICAgICBlbmRUaW1lOiB2YWxpZGF0ZWREYXRhLmVuZFRpbWUsXG4gICAgICAgICAgICAgICAgdmlzaWJpbGl0eTogdmFsaWRhdGVkRGF0YS52aXNpYmlsaXR5IGFzIGFueSxcbiAgICAgICAgICAgICAgICBpbnN0aXR1dGlvbklkOiB2YWxpZGF0ZWREYXRhLnZpc2liaWxpdHkgIT09IFwiUFVCTElDXCIgPyAodmFsaWRhdGVkRGF0YS5pbnN0aXR1dGlvbklkIHx8IG51bGwpIDogbnVsbCxcbiAgICAgICAgICAgICAgICBjbGFzc3Jvb21JZDogdmFsaWRhdGVkRGF0YS52aXNpYmlsaXR5ID09PSBcIkNMQVNTUk9PTVwiID8gKHZhbGlkYXRlZERhdGEuY2xhc3Nyb29tSWQgfHwgbnVsbCkgOiBudWxsLFxuICAgICAgICAgICAgICAgIGNyZWF0b3JJZDogY3VycmVudFVzZXIuaWQsXG4gICAgICAgICAgICAgICAgY29udGVzdFBhc3N3b3JkOiB2YWxpZGF0ZWREYXRhLmNvbnRlc3RQYXNzd29yZCB8fCBudWxsLFxuICAgICAgICAgICAgICAgIHJhbmRvbWl6ZVF1ZXN0aW9uczogdmFsaWRhdGVkRGF0YS5yYW5kb21pemVRdWVzdGlvbnMgfHwgZmFsc2UsXG4gICAgICAgICAgICAgICAgcHJvYmxlbXM6IHtcbiAgICAgICAgICAgICAgICAgICAgY3JlYXRlOiB2YWxpZGF0ZWREYXRhLnByb2JsZW1zLm1hcCgocHJvYmxlbUlkLCBpbmRleCkgPT4gKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2JsZW1JZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG9yZGVyOiBpbmRleCxcbiAgICAgICAgICAgICAgICAgICAgfSkpLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcblxuICAgICAgICByZXZhbGlkYXRlUGF0aChcIi9kYXNoYm9hcmQvY29udGVzdHNcIik7XG4gICAgICAgIHJldmFsaWRhdGVQYXRoKFwiL2NvbnRlc3RcIik7XG4gICAgICAgIHJldmFsaWRhdGVUYWcoXCJjb250ZXN0c1wiLCBcIm1heFwiKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgY29udGVzdElkOiBjb250ZXN0LmlkIH07XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBjb250ZXN0OlwiLCBlcnJvcik7XG4gICAgICAgIC8vIFJldHVybiBjbGVhcmVyIGVycm9yIG1lc3NhZ2VzXG4gICAgICAgIGxldCBlcnJvck1lc3NhZ2UgPSBcIkZhaWxlZCB0byBjcmVhdGUgY29udGVzdFwiO1xuICAgICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiB6LlpvZEVycm9yKSB7XG4gICAgICAgICAgICAgZXJyb3JNZXNzYWdlID0gKGVycm9yIGFzIGFueSkuZXJyb3JzLm1hcCgoZTogYW55KSA9PiBlLm1lc3NhZ2UpLmpvaW4oXCIsIFwiKTtcbiAgICAgICAgfSBlbHNlIGlmIChlcnJvciBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgICAgICAgICAgZXJyb3JNZXNzYWdlID0gZXJyb3IubWVzc2FnZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVycm9yTWVzc2FnZSB9O1xuICAgIH1cbiAgICB9XG5cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUNvbnRlc3RXaXRoUHJvYmxlbXMoZGF0YTogei5pbmZlcjx0eXBlb2YgY29udGVzdFdpdGhQcm9ibGVtc1NjaGVtYT4pIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIGlmICghc2Vzc2lvbj8udXNlcikge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcbiAgICB9XG5cbiAgICBjb25zdCBjdXJyZW50VXNlciA9IHNlc3Npb24udXNlciBhcyBhbnk7XG5cbiAgICBpZiAoIVtcIkFETUlOXCIsIFwiSU5TVElUVVRJT05fTUFOQUdFUlwiLCBcIkNPTlRFU1RfTUFOQUdFUlwiLCBcIlRFQUNIRVJcIl0uaW5jbHVkZXMoY3VycmVudFVzZXIucm9sZSkpIHtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgdmFsaWRhdGVkRGF0YSA9IGNvbnRlc3RXaXRoUHJvYmxlbXNTY2hlbWEucGFyc2UoZGF0YSk7XG5cbiAgICAgICAgY29uc3QgY29udGVzdCA9IGF3YWl0IHByaXNtYS4kdHJhbnNhY3Rpb24oYXN5bmMgKHR4KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjb250ZXN0ID0gYXdhaXQgdHguY29udGVzdC5jcmVhdGUoe1xuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHZhbGlkYXRlZERhdGEudGl0bGUsXG4gICAgICAgICAgICAgICAgICAgIHNsdWc6IHZhbGlkYXRlZERhdGEuc2x1ZyxcbiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHZhbGlkYXRlZERhdGEuZGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0VGltZTogdmFsaWRhdGVkRGF0YS5zdGFydFRpbWUsXG4gICAgICAgICAgICAgICAgICAgIGVuZFRpbWU6IHZhbGlkYXRlZERhdGEuZW5kVGltZSxcbiAgICAgICAgICAgICAgICAgICAgdmlzaWJpbGl0eTogdmFsaWRhdGVkRGF0YS52aXNpYmlsaXR5IGFzIGFueSxcbiAgICAgICAgICAgICAgICAgICAgaGlkZGVuOiB2YWxpZGF0ZWREYXRhLmhpZGRlbixcbiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZEltYWdlOiB2YWxpZGF0ZWREYXRhLmJhY2tncm91bmRJbWFnZSxcbiAgICAgICAgICAgICAgICAgICAgcHJpemVzOiB2YWxpZGF0ZWREYXRhLnByaXplcyxcbiAgICAgICAgICAgICAgICAgICAgcnVsZXM6IHZhbGlkYXRlZERhdGEucnVsZXMsXG4gICAgICAgICAgICAgICAgICAgIGluc3RpdHV0aW9uSWQ6IHZhbGlkYXRlZERhdGEudmlzaWJpbGl0eSAhPT0gXCJQVUJMSUNcIiA/ICh2YWxpZGF0ZWREYXRhLmluc3RpdHV0aW9uSWQgfHwgbnVsbCkgOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICBjbGFzc3Jvb21JZDogdmFsaWRhdGVkRGF0YS52aXNpYmlsaXR5ID09PSBcIkNMQVNTUk9PTVwiID8gKHZhbGlkYXRlZERhdGEuY2xhc3Nyb29tSWQgfHwgbnVsbCkgOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICBjcmVhdG9ySWQ6IGN1cnJlbnRVc2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0UGFzc3dvcmQ6IHZhbGlkYXRlZERhdGEuY29udGVzdFBhc3N3b3JkIHx8IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIHJhbmRvbWl6ZVF1ZXN0aW9uczogdmFsaWRhdGVkRGF0YS5yYW5kb21pemVRdWVzdGlvbnMgfHwgZmFsc2UsXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmFsaWRhdGVkRGF0YS5wcm9ibGVtcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGNvbnN0IHAgPSB2YWxpZGF0ZWREYXRhLnByb2JsZW1zW2ldO1xuICAgICAgICAgICAgICAgIC8vIEdlbmVyYXRlIHVuaXF1ZSBzbHVnIGJ5IGFwcGVuZGluZyBjb250ZXN0IHNsdWcgYW5kIGluZGV4XG4gICAgICAgICAgICAgICAgY29uc3QgdW5pcXVlU2x1ZyA9IGAke3ZhbGlkYXRlZERhdGEuc2x1Z30tJHtwLnNsdWcgfHwgcC50aXRsZS50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoL1xccysvZywgJy0nKX0tJHtEYXRlLm5vdygpfS0ke2l9YDtcbiAgICAgICAgICAgICAgICBjb25zdCBwcm9ibGVtID0gYXdhaXQgdHgucHJvYmxlbS5jcmVhdGUoe1xuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogcC50aXRsZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBwLmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGlmZmljdWx0eTogcC5kaWZmaWN1bHR5LFxuICAgICAgICAgICAgICAgICAgICAgICAgc2x1ZzogdW5pcXVlU2x1ZyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3JlOiBwLnNjb3JlIHx8IDEwLFxuICAgICAgICAgICAgICAgICAgICAgICAgZG9tYWluOiBwLmRvbWFpbixcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiQ09OVEVTVFwiLCAvLyBDb250ZXN0IHByb2JsZW1zIGFyZSBtYXJrZWQgc2VwYXJhdGVseVxuICAgICAgICAgICAgICAgICAgICAgICAgaGlkZGVuOiB0cnVlLCAvLyBDb250ZXN0IHByb2JsZW1zIGFyZSBoaWRkZW4gZnJvbSBtYWluIGJhbmtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlc3RDYXNlczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZTogcC50ZXN0Q2FzZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgdGFnczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbm5lY3Q6IHAudGFncz8ubWFwKCh0OiBzdHJpbmcpID0+ICh7IG5hbWU6IHQgfSkpIHx8IFtdLFxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBhd2FpdCB0eC5jb250ZXN0UHJvYmxlbS5jcmVhdGUoe1xuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3QuaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9ibGVtSWQ6IHByb2JsZW0uaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBvcmRlcjogaSxcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gY29udGVzdDtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL2NvbnRlc3RzXCIpO1xuICAgICAgICByZXZhbGlkYXRlUGF0aChcIi9jb250ZXN0c1wiKTtcbiAgICAgICAgcmV2YWxpZGF0ZVBhdGgoXCIvY29udGVzdFwiKTtcbiAgICAgICAgcmV2YWxpZGF0ZVRhZyhcImNvbnRlc3RzXCIsIFwibWF4XCIpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBjb250ZXN0SWQ6IGNvbnRlc3QuaWQgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBjb250ZXN0IHdpdGggcHJvYmxlbXM6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBjcmVhdGUgY29udGVzdFwiIH07XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0SW5zdGl0dXRpb25hbENsYXNzcm9vbXMoaW5zdGl0dXRpb25JZDogc3RyaW5nKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgY2xhc3Nyb29tcyA9IGF3YWl0IHByaXNtYS5jbGFzc3Jvb20uZmluZE1hbnkoe1xuICAgICAgICAgICAgd2hlcmU6IHsgaW5zdGl0dXRpb25JZCB9LFxuICAgICAgICAgICAgc2VsZWN0OiB7IGlkOiB0cnVlLCBuYW1lOiB0cnVlLCBzZWN0aW9uOiB0cnVlIH0sXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBjbGFzc3Jvb21zIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBmZXRjaCBjbGFzc3Jvb21zOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZmV0Y2ggY2xhc3Nyb29tc1wiIH07XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0U2VsZWN0YWJsZVByb2JsZW1zKHNlYXJjaDogc3RyaW5nKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcHJvYmxlbXMgPSBhd2FpdCBwcmlzbWEucHJvYmxlbS5maW5kTWFueSh7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgIE9SOiBbXG4gICAgICAgICAgICAgICAgICAgIHsgdGl0bGU6IHsgY29udGFpbnM6IHNlYXJjaCwgbW9kZTogXCJpbnNlbnNpdGl2ZVwiIH0gfSxcbiAgICAgICAgICAgICAgICAgICAgeyBzbHVnOiB7IGNvbnRhaW5zOiBzZWFyY2gsIG1vZGU6IFwiaW5zZW5zaXRpdmVcIiB9IH0sXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBoaWRkZW46IGZhbHNlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNlbGVjdDogeyBpZDogdHJ1ZSwgdGl0bGU6IHRydWUsIGRpZmZpY3VsdHk6IHRydWUsIHNsdWc6IHRydWUgfSxcbiAgICAgICAgICAgIHRha2U6IDEwLFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgcHJvYmxlbXMgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGZldGNoIHByb2JsZW1zOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZmV0Y2ggcHJvYmxlbXNcIiB9O1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGFjY2VwdENvbnRlc3RSdWxlcyhjb250ZXN0SWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcblxuICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHByaXNtYS5jb250ZXN0UGFydGljaXBhdGlvbi51cHNlcnQoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1cGRhdGU6IHsgYWNjZXB0ZWRSdWxlczogdHJ1ZSB9LFxuICAgICAgICAgICAgY3JlYXRlOiB7XG4gICAgICAgICAgICAgICAgdXNlcklkOiBzZXNzaW9uLnVzZXIuaWQsXG4gICAgICAgICAgICAgICAgY29udGVzdElkOiBjb250ZXN0SWQsXG4gICAgICAgICAgICAgICAgYWNjZXB0ZWRSdWxlczogdHJ1ZVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV2YWxpZGF0ZVBhdGgoYC9jb250ZXN0LyR7Y29udGVzdElkfWApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBhY2NlcHQgcnVsZXNcIiB9O1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGZpbmlzaENvbnRlc3RBY3Rpb24oY29udGVzdElkOiBzdHJpbmcpIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIGlmICghc2Vzc2lvbj8udXNlcikgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG5cbiAgICB0cnkge1xuICAgICAgICBhd2FpdCBwcmlzbWEuY29udGVzdFBhcnRpY2lwYXRpb24udXBzZXJ0KHtcbiAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgdXNlcklkX2NvbnRlc3RJZDoge1xuICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IHNlc3Npb24udXNlci5pZCxcbiAgICAgICAgICAgICAgICAgICAgY29udGVzdElkOiBjb250ZXN0SWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdXBkYXRlOiB7XG4gICAgICAgICAgICAgICAgaXNGaW5pc2hlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBmaW5pc2hlZEF0OiBuZXcgRGF0ZSgpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY3JlYXRlOiB7XG4gICAgICAgICAgICAgICAgdXNlcklkOiBzZXNzaW9uLnVzZXIuaWQsXG4gICAgICAgICAgICAgICAgY29udGVzdElkOiBjb250ZXN0SWQsXG4gICAgICAgICAgICAgICAgYWNjZXB0ZWRSdWxlczogdHJ1ZSxcbiAgICAgICAgICAgICAgICBpc0ZpbmlzaGVkOiB0cnVlLFxuICAgICAgICAgICAgICAgIGZpbmlzaGVkQXQ6IG5ldyBEYXRlKClcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldmFsaWRhdGVQYXRoKGAvY29udGVzdC8ke2NvbnRlc3RJZH1gKTtcbiAgICAgICAgcmV2YWxpZGF0ZVBhdGgoYC9wcm9ibGVtc2ApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBmaW5pc2ggY29udGVzdFwiIH07XG4gICAgfVxufVxuXG4vKipcbiAqIEZpbmFsaXplIENvbnRlc3QgJiBBd2FyZCBCYWRnZXNcbiAqIC0gQ2FsY3VsYXRlcyBsZWFkZXJib2FyZFxuICogLSBBd2FyZHMgR29sZCwgU2lsdmVyLCBCcm9uemUgdG8gVG9wIDNcbiAqIC0gTWFya3MgY29udGVzdCBhcyBmaW5hbGl6ZWRcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGZpbmFsaXplQ29udGVzdChjb250ZXN0SWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcblxuICAgIC8vIE9ubHkgYWRtaW5zIG9yIGNvbnRlc3QgbWFuYWdlcnMgY2FuIGZpbmFsaXplXG4gICAgY29uc3QgY3VycmVudFVzZXIgPSBzZXNzaW9uLnVzZXIgYXMgYW55O1xuICAgIGlmICghW1wiQURNSU5cIiwgXCJDT05URVNUX01BTkFHRVJcIiwgXCJJTlNUSVRVVElPTl9NQU5BR0VSXCIsIFwiVEVBQ0hFUlwiXS5pbmNsdWRlcyhjdXJyZW50VXNlci5yb2xlKSkge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjb250ZXN0ID0gYXdhaXQgcHJpc21hLmNvbnRlc3QuZmluZFVuaXF1ZSh7XG4gICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IGNvbnRlc3RJZCB9LFxuICAgICAgICAgICAgIHNlbGVjdDogeyBpc0ZpbmFsaXplZDogdHJ1ZSwgdGl0bGU6IHRydWUgfVxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoIWNvbnRlc3QpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJDb250ZXN0IG5vdCBmb3VuZFwiIH07XG4gICAgICAgIGlmIChjb250ZXN0LmlzRmluYWxpemVkKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiQ29udGVzdCBpcyBhbHJlYWR5IGZpbmFsaXplZFwiIH07XG5cbiAgICAgICAgLy8gUmV1c2UgbGVhZGVyYm9hcmQgbG9naWMgdG8gZ2V0IHJhbmtpbmdzXG4gICAgICAgIGNvbnN0IGxlYWRlcmJvYXJkID0gYXdhaXQgZ2V0Q29udGVzdExlYWRlcmJvYXJkKGNvbnRlc3RJZCk7XG4gICAgICAgIGlmICghbGVhZGVyYm9hcmQuc3VjY2VzcyB8fCAhbGVhZGVyYm9hcmQuc3R1ZGVudHMpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZmV0Y2ggbGVhZGVyYm9hcmRcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgc3R1ZGVudHMgPSBsZWFkZXJib2FyZC5zdHVkZW50cyBhcyBhbnlbXTtcblxuICAgICAgICAvLyBBdCBsZWFzdCAxIHN0dWRlbnQgbmVlZGVkXG4gICAgICAgIGlmIChzdHVkZW50cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICBhd2FpdCBwcmlzbWEuY29udGVzdC51cGRhdGUoe1xuICAgICAgICAgICAgICAgICB3aGVyZTogeyBpZDogY29udGVzdElkIH0sXG4gICAgICAgICAgICAgICAgIGRhdGE6IHsgaXNGaW5hbGl6ZWQ6IHRydWUgfVxuICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIG1lc3NhZ2U6IFwiQ29udGVzdCBmaW5hbGl6ZWQgKG5vIHBhcnRpY2lwYW50cylcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVG9wIDMgSURzXG4gICAgICAgIGNvbnN0IGdvbGRVc2VySWQgPSBzdHVkZW50c1swXT8uaWQ7XG4gICAgICAgIGNvbnN0IHNpbHZlclVzZXJJZCA9IHN0dWRlbnRzWzFdPy5pZDtcbiAgICAgICAgY29uc3QgYnJvbnplVXNlcklkID0gc3R1ZGVudHNbMl0/LmlkO1xuXG4gICAgICAgIGF3YWl0IHByaXNtYS4kdHJhbnNhY3Rpb24oYXN5bmMgKHR4KSA9PiB7XG4gICAgICAgICAgICAvLyBBd2FyZCBHb2xkXG4gICAgICAgICAgICBpZiAoZ29sZFVzZXJJZCkge1xuICAgICAgICAgICAgICAgIGF3YWl0IHR4LnVzZXIudXBkYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IGdvbGRVc2VySWQgfSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogeyBnb2xkQmFkZ2VzOiB7IGluY3JlbWVudDogMSB9IH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIEF3YXJkIFNpbHZlclxuICAgICAgICAgICAgaWYgKHNpbHZlclVzZXJJZCkge1xuICAgICAgICAgICAgICAgIGF3YWl0IHR4LnVzZXIudXBkYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IHNpbHZlclVzZXJJZCB9LFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7IHNpbHZlckJhZGdlczogeyBpbmNyZW1lbnQ6IDEgfSB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBBd2FyZCBCcm9uemVcbiAgICAgICAgICAgIGlmIChicm9uemVVc2VySWQpIHtcbiAgICAgICAgICAgICAgICBhd2FpdCB0eC51c2VyLnVwZGF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIHdoZXJlOiB7IGlkOiBicm9uemVVc2VySWQgfSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogeyBicm9uemVCYWRnZXM6IHsgaW5jcmVtZW50OiAxIH0gfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBNYXJrIEZpbmFsaXplZFxuICAgICAgICAgICAgYXdhaXQgdHguY29udGVzdC51cGRhdGUoe1xuICAgICAgICAgICAgICAgIHdoZXJlOiB7IGlkOiBjb250ZXN0SWQgfSxcbiAgICAgICAgICAgICAgICBkYXRhOiB7IGlzRmluYWxpemVkOiB0cnVlIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICByZXZhbGlkYXRlUGF0aChgL2Rhc2hib2FyZGApO1xuICAgICAgICByZXZhbGlkYXRlUGF0aChgL3Byb2ZpbGUvJHtnb2xkVXNlcklkfWApO1xuICAgICAgICBpZihzaWx2ZXJVc2VySWQpIHJldmFsaWRhdGVQYXRoKGAvcHJvZmlsZS8ke3NpbHZlclVzZXJJZH1gKTtcbiAgICAgICAgaWYoYnJvbnplVXNlcklkKSByZXZhbGlkYXRlUGF0aChgL3Byb2ZpbGUvJHticm9uemVVc2VySWR9YCk7XG4gICAgICAgIHJldmFsaWRhdGVQYXRoKGAvY29udGVzdC8ke2NvbnRlc3RJZH1gKTtcbiAgICAgICAgcmV2YWxpZGF0ZVRhZyhgY29udGVzdC0ke2NvbnRlc3RJZH1gLCBcIm1heFwiKTtcbiAgICAgICAgcmV2YWxpZGF0ZVRhZyhgbGVhZGVyYm9hcmQtJHtjb250ZXN0SWR9YCwgXCJtYXhcIik7XG5cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gZmluYWxpemUgY29udGVzdDpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGZpbmFsaXplIGNvbnRlc3RcIiB9O1xuICAgIH1cbn1cblxuLyoqXG4gKiBWZXJpZnkgY29udGVzdCBwYXNzd29yZCB3aXRob3V0IHN0YXJ0aW5nIHNlc3Npb24uXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB2ZXJpZnlDb250ZXN0UGFzc3dvcmQoY29udGVzdElkOiBzdHJpbmcsIHBhc3N3b3JkPzogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICBpZiAoIXNlc3Npb24/LnVzZXIpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgY29udGVzdCA9IGF3YWl0IHByaXNtYS5jb250ZXN0LmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IGNvbnRlc3RJZCB9LFxuICAgICAgICAgICAgc2VsZWN0OiB7IGNvbnRlc3RQYXNzd29yZDogdHJ1ZSB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICghY29udGVzdCkgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkNvbnRlc3Qgbm90IGZvdW5kXCIgfTtcblxuICAgICAgICBpZiAoY29udGVzdC5jb250ZXN0UGFzc3dvcmQgJiYgY29udGVzdC5jb250ZXN0UGFzc3dvcmQgIT09IHBhc3N3b3JkKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiSW52YWxpZCBjb250ZXN0IHBhc3N3b3JkXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIHZlcmlmeSBjb250ZXN0IHBhc3N3b3JkOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gdmVyaWZ5IHBhc3N3b3JkXCIgfTtcbiAgICB9XG59XG5cblxuLyoqXG4gKiBTdGFydCBhIGNvbnRlc3Qgc2Vzc2lvbiAtIHZhbGlkYXRlcyB0aW1lIGJvdW5kcyBhbmQgY3JlYXRlcyBzZXNzaW9uIElEXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzdGFydENvbnRlc3RTZXNzaW9uKGNvbnRlc3RJZDogc3RyaW5nLCBwYXNzd29yZD86IHN0cmluZykge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcblxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRlc3QgPSBhd2FpdCBwcmlzbWEuY29udGVzdC5maW5kVW5pcXVlKHtcbiAgICAgICAgICAgIHdoZXJlOiB7IGlkOiBjb250ZXN0SWQgfSxcbiAgICAgICAgICAgIHNlbGVjdDogeyBzdGFydFRpbWU6IHRydWUsIGVuZFRpbWU6IHRydWUsIGNvbnRlc3RQYXNzd29yZDogdHJ1ZSB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICghY29udGVzdCkgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkNvbnRlc3Qgbm90IGZvdW5kXCIgfTtcblxuICAgICAgICBpZiAoY29udGVzdC5jb250ZXN0UGFzc3dvcmQgJiYgY29udGVzdC5jb250ZXN0UGFzc3dvcmQgIT09IHBhc3N3b3JkKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiSW52YWxpZCBjb250ZXN0IHBhc3N3b3JkXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG5cbiAgICAgICAgLy8gVGltZSBib3VuZHMgY2hlY2tcbiAgICAgICAgaWYgKG5vdyA8IGNvbnRlc3Quc3RhcnRUaW1lKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiQ29udGVzdCBoYXMgbm90IHN0YXJ0ZWQgeWV0XCIgfTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobm93ID4gY29udGVzdC5lbmRUaW1lKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiQ29udGVzdCBoYXMgYWxyZWFkeSBlbmRlZFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBHZW5lcmF0ZSB1bmlxdWUgc2Vzc2lvbiBJRFxuICAgICAgICBjb25zdCBzZXNzaW9uSWQgPSBgJHtzZXNzaW9uLnVzZXIuaWR9LSR7Y29udGVzdElkfS0ke0RhdGUubm93KCl9YDtcblxuICAgICAgICAvLyBDaGVjayBmb3IgZXhpc3RpbmcgYWN0aXZlIHNlc3Npb24gKG11bHRpLXRhYiBkZXRlY3Rpb24pXG4gICAgICAgIGNvbnN0IGV4aXN0aW5nUGFydGljaXBhdGlvbiA9IGF3YWl0IHByaXNtYS5jb250ZXN0UGFydGljaXBhdGlvbi5maW5kVW5pcXVlKHtcbiAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgdXNlcklkX2NvbnRlc3RJZDoge1xuICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IHNlc3Npb24udXNlci5pZCxcbiAgICAgICAgICAgICAgICAgICAgY29udGVzdElkOiBjb250ZXN0SWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChleGlzdGluZ1BhcnRpY2lwYXRpb24/LmlzQmxvY2tlZCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIllvdSBoYXZlIGJlZW4gYmxvY2tlZCBmcm9tIHRoaXMgY29udGVzdCBkdWUgdG8gdmlvbGF0aW9uc1wiIH07XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZXhpc3RpbmdQYXJ0aWNpcGF0aW9uPy5pc0ZpbmlzaGVkKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiWW91IGhhdmUgYWxyZWFkeSBmaW5pc2hlZCB0aGlzIGNvbnRlc3RcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVXBkYXRlIG9yIGNyZWF0ZSBwYXJ0aWNpcGF0aW9uIHdpdGggbmV3IHNlc3Npb25cbiAgICAgICAgY29uc3QgcGFydGljaXBhdGlvbiA9IGF3YWl0IHByaXNtYS5jb250ZXN0UGFydGljaXBhdGlvbi51cHNlcnQoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1cGRhdGU6IHtcbiAgICAgICAgICAgICAgICBzZXNzaW9uSWQsXG4gICAgICAgICAgICAgICAgc2Vzc2lvblN0YXJ0ZWRBdDogbm93LFxuICAgICAgICAgICAgICAgIGFjY2VwdGVkUnVsZXM6IHRydWVcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjcmVhdGU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWQ6IHNlc3Npb24udXNlci5pZCxcbiAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZCxcbiAgICAgICAgICAgICAgICBzZXNzaW9uSWQsXG4gICAgICAgICAgICAgICAgc2Vzc2lvblN0YXJ0ZWRBdDogbm93LFxuICAgICAgICAgICAgICAgIGFjY2VwdGVkUnVsZXM6IHRydWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgICBzZXNzaW9uSWQsXG4gICAgICAgICAgICBwYXJ0aWNpcGF0aW9uSWQ6IHBhcnRpY2lwYXRpb24uaWQsXG4gICAgICAgICAgICB0b3RhbFZpb2xhdGlvbnM6IHBhcnRpY2lwYXRpb24udG90YWxWaW9sYXRpb25zLFxuICAgICAgICAgICAgaXNGbGFnZ2VkOiBwYXJ0aWNpcGF0aW9uLmlzRmxhZ2dlZFxuICAgICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gc3RhcnQgY29udGVzdCBzZXNzaW9uOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gc3RhcnQgY29udGVzdCBzZXNzaW9uXCIgfTtcbiAgICB9XG59XG5cbi8qKlxuICogTG9nIGEgY29udGVzdCB2aW9sYXRpb24gLSByZWNvcmRzIHRvIGRhdGFiYXNlIGFuZCB1cGRhdGVzIGNvdW50ZXJzXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBsb2dDb250ZXN0VmlvbGF0aW9uKFxuICAgIGNvbnRlc3RJZDogc3RyaW5nLFxuICAgIHR5cGU6IFwiVEFCX1NXSVRDSFwiIHwgXCJGVUxMU0NSRUVOX0VYSVRcIiB8IFwiQ09QWV9QQVNURVwiIHwgXCJERVZUT09MU19PUEVOXCIgfCBcIktFWUJPQVJEX1NIT1JUQ1VUXCIgfCBcIk5BVklHQVRJT05fQVRURU1QVFwiIHwgXCJNVUxUSV9UQUJcIiB8IFwiU1VTUElDSU9VU19JTlBVVFwiLFxuICAgIG1lc3NhZ2U/OiBzdHJpbmcsXG4gICAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+XG4pIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIGlmICghc2Vzc2lvbj8udXNlcikgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBwYXJ0aWNpcGF0aW9uID0gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKCFwYXJ0aWNpcGF0aW9uKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiTm8gYWN0aXZlIHBhcnRpY2lwYXRpb24gZm91bmRcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gRGV0ZXJtaW5lIHdoaWNoIGNvdW50ZXIgdG8gaW5jcmVtZW50XG4gICAgICAgIGNvbnN0IGNvdW50ZXJGaWVsZCA9IHtcbiAgICAgICAgICAgIFRBQl9TV0lUQ0g6IFwidGFiU3dpdGNoQ291bnRcIixcbiAgICAgICAgICAgIEZVTExTQ1JFRU5fRVhJVDogXCJmdWxsc2NyZWVuRXhpdENvdW50XCIsXG4gICAgICAgICAgICBDT1BZX1BBU1RFOiBcImNvcHlQYXN0ZUNvdW50XCIsXG4gICAgICAgICAgICBERVZUT09MU19PUEVOOiBcImRldlRvb2xzQ291bnRcIixcbiAgICAgICAgICAgIEtFWUJPQVJEX1NIT1JUQ1VUOiBcImtleWJvYXJkQ291bnRcIixcbiAgICAgICAgICAgIE5BVklHQVRJT05fQVRURU1QVDogXCJuYXZpZ2F0aW9uQ291bnRcIixcbiAgICAgICAgICAgIE1VTFRJX1RBQjogXCJ0YWJTd2l0Y2hDb3VudFwiLFxuICAgICAgICAgICAgU1VTUElDSU9VU19JTlBVVDogXCJjb3B5UGFzdGVDb3VudFwiXG4gICAgICAgIH1bdHlwZV0gYXMgc3RyaW5nO1xuXG4gICAgICAgIC8vIFVzZSB0cmFuc2FjdGlvbiB0byBlbnN1cmUgYXRvbWljIHVwZGF0ZVxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBwcmlzbWEuJHRyYW5zYWN0aW9uKGFzeW5jICh0eCkgPT4ge1xuICAgICAgICAgICAgLy8gQ2hlY2sgbGFzdCB2aW9sYXRpb24gdGltZSB0byBwcmV2ZW50IHJhcGlkLWZpcmUgZHVwbGljYXRlcyAoU2VydmVyLXNpZGUgZGVib3VuY2UpXG4gICAgICAgICAgICBjb25zdCBsYXN0VmlvbGF0aW9uID0gYXdhaXQgdHguY29udGVzdFZpb2xhdGlvbi5maW5kRmlyc3Qoe1xuICAgICAgICAgICAgICAgIHdoZXJlOiB7IHBhcnRpY2lwYXRpb25JZDogcGFydGljaXBhdGlvbi5pZCB9LFxuICAgICAgICAgICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnZGVzYycgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmIChsYXN0VmlvbGF0aW9uKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdGltZURpZmYgPSBEYXRlLm5vdygpIC0gbGFzdFZpb2xhdGlvbi5jcmVhdGVkQXQuZ2V0VGltZSgpO1xuICAgICAgICAgICAgICAgIC8vIElmIGxlc3MgdGhhbiAyIHNlY29uZHMgc2luY2UgbGFzdCB2aW9sYXRpb24sIGlnbm9yZSB0aGlzIG9uZVxuICAgICAgICAgICAgICAgIGlmICh0aW1lRGlmZiA8IDIwMDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLnBhcnRpY2lwYXRpb24sIC8vIFJldHVybiBleGlzdGluZyBzdGF0ZVxuICAgICAgICAgICAgICAgICAgICAgICAgaXNGbGFnZ2VkOiBwYXJ0aWNpcGF0aW9uLmlzRmxhZ2dlZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzQmxvY2tlZDogcGFydGljaXBhdGlvbi5pc0Jsb2NrZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICB0b3RhbFZpb2xhdGlvbnM6IHBhcnRpY2lwYXRpb24udG90YWxWaW9sYXRpb25zLFxuICAgICAgICAgICAgICAgICAgICAgICAgcGVybWFuZW50bHlCbG9ja2VkOiBwYXJ0aWNpcGF0aW9uLnBlcm1hbmVudGx5QmxvY2tlZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBCbG9ja2VkVW50aWw6IHBhcnRpY2lwYXRpb24udGVtcEJsb2NrZWRVbnRpbFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQ3JlYXRlIHZpb2xhdGlvbiByZWNvcmRcbiAgICAgICAgICAgIGF3YWl0IHR4LmNvbnRlc3RWaW9sYXRpb24uY3JlYXRlKHtcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIHBhcnRpY2lwYXRpb25JZDogcGFydGljaXBhdGlvbi5pZCxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogdHlwZSBhcyBhbnksXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UsXG4gICAgICAgICAgICAgICAgICAgIG1ldGFkYXRhOiBtZXRhZGF0YSA/PyB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIG5ldyB0b3RhbCBhbmQgZGV0ZXJtaW5lIGJsb2NraW5nIHRpZXJcbiAgICAgICAgICAgIGNvbnN0IG5ld1RvdGFsVmlvbGF0aW9ucyA9IHBhcnRpY2lwYXRpb24udG90YWxWaW9sYXRpb25zICsgMTtcbiAgICAgICAgICAgIGNvbnN0IHNob3VsZEZsYWcgPSBuZXdUb3RhbFZpb2xhdGlvbnMgPj0gMztcblxuICAgICAgICAgICAgLy8gVGllcmVkIGJsb2NraW5nIGxvZ2ljXG4gICAgICAgICAgICBsZXQgdGVtcEJsb2NrZWRVbnRpbDogRGF0ZSB8IG51bGwgPSBudWxsO1xuICAgICAgICAgICAgbGV0IHBlcm1hbmVudGx5QmxvY2tlZCA9IGZhbHNlO1xuICAgICAgICAgICAgbGV0IGlzQmxvY2tlZCA9IGZhbHNlO1xuXG4gICAgICAgICAgICBpZiAobmV3VG90YWxWaW9sYXRpb25zID49IDYpIHtcbiAgICAgICAgICAgICAgICAvLyA2KyB2aW9sYXRpb25zID0gcGVybWFuZW50IGJsb2NrXG4gICAgICAgICAgICAgICAgcGVybWFuZW50bHlCbG9ja2VkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBpc0Jsb2NrZWQgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChuZXdUb3RhbFZpb2xhdGlvbnMgPj0gNCkge1xuICAgICAgICAgICAgICAgIC8vIDQtNSB2aW9sYXRpb25zID0gNSBtaW51dGUgdGVtcCBibG9ja1xuICAgICAgICAgICAgICAgIHRlbXBCbG9ja2VkVW50aWwgPSBuZXcgRGF0ZShEYXRlLm5vdygpICsgNSAqIDYwICogMTAwMCk7IC8vIDUgbWludXRlc1xuICAgICAgICAgICAgICAgIGlzQmxvY2tlZCA9IHRydWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZWQgPSBhd2FpdCB0eC5jb250ZXN0UGFydGljaXBhdGlvbi51cGRhdGUoe1xuICAgICAgICAgICAgICAgIHdoZXJlOiB7IGlkOiBwYXJ0aWNpcGF0aW9uLmlkIH0sXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBbY291bnRlckZpZWxkXTogeyBpbmNyZW1lbnQ6IDEgfSxcbiAgICAgICAgICAgICAgICAgICAgdG90YWxWaW9sYXRpb25zOiB7IGluY3JlbWVudDogMSB9LFxuICAgICAgICAgICAgICAgICAgICBpc0ZsYWdnZWQ6IHNob3VsZEZsYWcgfHwgcGFydGljaXBhdGlvbi5pc0ZsYWdnZWQsXG4gICAgICAgICAgICAgICAgICAgIGlzQmxvY2tlZCxcbiAgICAgICAgICAgICAgICAgICAgdGVtcEJsb2NrZWRVbnRpbCxcbiAgICAgICAgICAgICAgICAgICAgcGVybWFuZW50bHlCbG9ja2VkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiB1cGRhdGVkO1xuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgIHRvdGFsVmlvbGF0aW9uczogcmVzdWx0LnRvdGFsVmlvbGF0aW9ucyxcbiAgICAgICAgICAgIGlzRmxhZ2dlZDogcmVzdWx0LmlzRmxhZ2dlZCxcbiAgICAgICAgICAgIGlzQmxvY2tlZDogcmVzdWx0LmlzQmxvY2tlZCxcbiAgICAgICAgICAgIHRlbXBCbG9ja2VkVW50aWw6IHJlc3VsdC50ZW1wQmxvY2tlZFVudGlsPy50b0lTT1N0cmluZygpIHx8IG51bGwsXG4gICAgICAgICAgICBwZXJtYW5lbnRseUJsb2NrZWQ6IHJlc3VsdC5wZXJtYW5lbnRseUJsb2NrZWRcbiAgICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGxvZyB2aW9sYXRpb246XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBsb2cgdmlvbGF0aW9uXCIgfTtcbiAgICB9XG59XG5cbi8qKlxuICogVmFsaWRhdGUgY29udGVzdCBzZXNzaW9uIC0gY2hlY2tzIGlmIHNlc3Npb24gaXMgdmFsaWQgZm9yIHN1Ym1pc3Npb25zXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB2YWxpZGF0ZUNvbnRlc3RTZXNzaW9uKGNvbnRlc3RJZDogc3RyaW5nLCBzZXNzaW9uSWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgdmFsaWQ6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcGFydGljaXBhdGlvbiA9IGF3YWl0IHByaXNtYS5jb250ZXN0UGFydGljaXBhdGlvbi5maW5kVW5pcXVlKHtcbiAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgdXNlcklkX2NvbnRlc3RJZDoge1xuICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IHNlc3Npb24udXNlci5pZCxcbiAgICAgICAgICAgICAgICAgICAgY29udGVzdElkOiBjb250ZXN0SWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgIGNvbnRlc3Q6IHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0OiB7IHN0YXJ0VGltZTogdHJ1ZSwgZW5kVGltZTogdHJ1ZSB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoIXBhcnRpY2lwYXRpb24pIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHZhbGlkOiBmYWxzZSwgcmVhc29uOiBcIk5vIHBhcnRpY2lwYXRpb24gZm91bmRcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ2hlY2sgaWYgYmxvY2tlZFxuICAgICAgICBpZiAocGFydGljaXBhdGlvbi5pc0Jsb2NrZWQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHZhbGlkOiBmYWxzZSwgcmVhc29uOiBcIkJsb2NrZWQgZHVlIHRvIHZpb2xhdGlvbnNcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ2hlY2sgaWYgZmluaXNoZWRcbiAgICAgICAgaWYgKHBhcnRpY2lwYXRpb24uaXNGaW5pc2hlZCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgdmFsaWQ6IGZhbHNlLCByZWFzb246IFwiQ29udGVzdCBhbHJlYWR5IGZpbmlzaGVkXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENoZWNrIHNlc3Npb24gSUQgKG11bHRpLXRhYiBkZXRlY3Rpb24pXG4gICAgICAgIGlmIChwYXJ0aWNpcGF0aW9uLnNlc3Npb25JZCAhPT0gc2Vzc2lvbklkKSB7XG4gICAgICAgICAgICAvLyBMb2cgbXVsdGktdGFiIHZpb2xhdGlvblxuICAgICAgICAgICAgYXdhaXQgbG9nQ29udGVzdFZpb2xhdGlvbihjb250ZXN0SWQsIFwiTVVMVElfVEFCXCIsIFwiTXVsdGlwbGUgdGFicyBkZXRlY3RlZFwiKTtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHZhbGlkOiBmYWxzZSwgcmVhc29uOiBcIlNlc3Npb24gbWlzbWF0Y2ggLSBwb3NzaWJsZSBtdWx0aXBsZSB0YWJzXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENoZWNrIHRpbWUgYm91bmRzXG4gICAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgICAgIGlmIChub3cgPiBwYXJ0aWNpcGF0aW9uLmNvbnRlc3QuZW5kVGltZSkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgdmFsaWQ6IGZhbHNlLCByZWFzb246IFwiQ29udGVzdCBoYXMgZW5kZWRcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgICB2YWxpZDogdHJ1ZSxcbiAgICAgICAgICAgIHRvdGFsVmlvbGF0aW9uczogcGFydGljaXBhdGlvbi50b3RhbFZpb2xhdGlvbnMsXG4gICAgICAgICAgICBpc0ZsYWdnZWQ6IHBhcnRpY2lwYXRpb24uaXNGbGFnZ2VkXG4gICAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byB2YWxpZGF0ZSBzZXNzaW9uOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCB2YWxpZDogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byB2YWxpZGF0ZSBzZXNzaW9uXCIgfTtcbiAgICB9XG59XG5cbi8qKlxuICogQ2hlY2sgaWYgdXNlciBpcyBlbGlnaWJsZSB0byBzdWJtaXQgLSBwcmUtc3VibWlzc2lvbiB2YWxpZGF0aW9uXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjaGVja1N1Ym1pc3Npb25FbGlnaWJpbGl0eShjb250ZXN0SWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBlbGlnaWJsZTogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBwYXJ0aWNpcGF0aW9uID0gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgY29udGVzdDoge1xuICAgICAgICAgICAgICAgICAgICBzZWxlY3Q6IHsgc3RhcnRUaW1lOiB0cnVlLCBlbmRUaW1lOiB0cnVlIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICghcGFydGljaXBhdGlvbikge1xuICAgICAgICAgICAgcmV0dXJuIHsgZWxpZ2libGU6IGZhbHNlLCByZWFzb246IFwiTm8gcGFydGljaXBhdGlvbiBmb3VuZFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDaGVjayB2YXJpb3VzIGNvbmRpdGlvbnNcbiAgICAgICAgaWYgKHBhcnRpY2lwYXRpb24uaXNCbG9ja2VkKSB7XG4gICAgICAgICAgICByZXR1cm4geyBlbGlnaWJsZTogZmFsc2UsIHJlYXNvbjogXCJCbG9ja2VkIGR1ZSB0byBleGNlc3NpdmUgdmlvbGF0aW9uc1wiIH07XG4gICAgICAgIH1cblxuICAgICAgICBpZiAocGFydGljaXBhdGlvbi5pc0ZpbmlzaGVkKSB7XG4gICAgICAgICAgICByZXR1cm4geyBlbGlnaWJsZTogZmFsc2UsIHJlYXNvbjogXCJZb3UgaGF2ZSBhbHJlYWR5IGZpbmlzaGVkIHRoaXMgY29udGVzdFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICAgICAgICBpZiAobm93IDwgcGFydGljaXBhdGlvbi5jb250ZXN0LnN0YXJ0VGltZSkge1xuICAgICAgICAgICAgcmV0dXJuIHsgZWxpZ2libGU6IGZhbHNlLCByZWFzb246IFwiQ29udGVzdCBoYXMgbm90IHN0YXJ0ZWRcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG5vdyA+IHBhcnRpY2lwYXRpb24uY29udGVzdC5lbmRUaW1lKSB7XG4gICAgICAgICAgICByZXR1cm4geyBlbGlnaWJsZTogZmFsc2UsIHJlYXNvbjogXCJDb250ZXN0IGhhcyBlbmRlZFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZWxpZ2libGU6IHRydWUsXG4gICAgICAgICAgICB3YXJuaW5nczogcGFydGljaXBhdGlvbi5pc0ZsYWdnZWQgPyBbXCJZb3VyIHNlc3Npb24gaGFzIGJlZW4gZmxhZ2dlZCBmb3IgcmV2aWV3XCJdIDogW11cbiAgICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGNoZWNrIGVsaWdpYmlsaXR5OlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IGVsaWdpYmxlOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGNoZWNrIGVsaWdpYmlsaXR5XCIgfTtcbiAgICB9XG59XG5cbi8qKlxuICogR2V0IHBhcnRpY2lwYXRpb24gc3RhdHVzIC0gZm9yIFVJIHN0YXRlXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRQYXJ0aWNpcGF0aW9uU3RhdHVzKGNvbnRlc3RJZDogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICBpZiAoIXNlc3Npb24/LnVzZXIpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcGFydGljaXBhdGlvbiA9IGF3YWl0IHByaXNtYS5jb250ZXN0UGFydGljaXBhdGlvbi5maW5kVW5pcXVlKHtcbiAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgdXNlcklkX2NvbnRlc3RJZDoge1xuICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IHNlc3Npb24udXNlci5pZCxcbiAgICAgICAgICAgICAgICAgICAgY29udGVzdElkOiBjb250ZXN0SWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgYWNjZXB0ZWRSdWxlczogdHJ1ZSxcbiAgICAgICAgICAgICAgICBpc0ZpbmlzaGVkOiB0cnVlLFxuICAgICAgICAgICAgICAgIGlzRmxhZ2dlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBpc0Jsb2NrZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgdG90YWxWaW9sYXRpb25zOiB0cnVlLFxuICAgICAgICAgICAgICAgIHNlc3Npb25JZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICB0ZW1wQmxvY2tlZFVudGlsOiB0cnVlLFxuICAgICAgICAgICAgICAgIHBlcm1hbmVudGx5QmxvY2tlZDogdHJ1ZVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBDaGVjayBpZiB0ZW1wIGJsb2NrIGhhcyBleHBpcmVkXG4gICAgICAgIGlmIChwYXJ0aWNpcGF0aW9uPy50ZW1wQmxvY2tlZFVudGlsICYmIG5ldyBEYXRlKCkgPiBwYXJ0aWNpcGF0aW9uLnRlbXBCbG9ja2VkVW50aWwpIHtcbiAgICAgICAgICAgIC8vIFRlbXAgYmxvY2sgZXhwaXJlZCAtIHVuYmxvY2tcbiAgICAgICAgICAgIGF3YWl0IHByaXNtYS5jb250ZXN0UGFydGljaXBhdGlvbi51cGRhdGUoe1xuICAgICAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZF9jb250ZXN0SWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGVzdElkOiBjb250ZXN0SWRcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBpc0Jsb2NrZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wQmxvY2tlZFVudGlsOiBudWxsXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgICAgICBwYXJ0aWNpcGF0aW9uOiB7XG4gICAgICAgICAgICAgICAgICAgIC4uLnBhcnRpY2lwYXRpb24sXG4gICAgICAgICAgICAgICAgICAgIGlzQmxvY2tlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBCbG9ja2VkVW50aWw6IG51bGxcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgICBwYXJ0aWNpcGF0aW9uOiBwYXJ0aWNpcGF0aW9uIHx8IG51bGxcbiAgICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGdldCBwYXJ0aWNpcGF0aW9uIHN0YXR1c1wiIH07XG4gICAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gQ09OVEVTVCBNQU5BR0VSIC0gUEFSVElDSVBBTlQgTUFOQUdFTUVOVFxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLyoqXG4gKiBHZXQgYWxsIHBhcnRpY2lwYW50cyBmb3IgYSBjb250ZXN0IHdpdGggdmlvbGF0aW9uIGRldGFpbHMgKGZvciBtYW5hZ2VycylcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldENvbnRlc3RQYXJ0aWNpcGFudHMoY29udGVzdElkOiBzdHJpbmcpIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIGlmICghc2Vzc2lvbj8udXNlcikgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG5cbiAgICBjb25zdCBjdXJyZW50VXNlciA9IHNlc3Npb24udXNlciBhcyBhbnk7XG5cbiAgICAvLyBDaGVjayBpZiB1c2VyIGlzIGNvbnRlc3QgbWFuYWdlci9jcmVhdG9yXG4gICAgY29uc3QgY29udGVzdCA9IGF3YWl0IHByaXNtYS5jb250ZXN0LmZpbmRVbmlxdWUoe1xuICAgICAgICB3aGVyZTogeyBpZDogY29udGVzdElkIH0sXG4gICAgICAgIHNlbGVjdDogeyBjcmVhdG9ySWQ6IHRydWUgfVxuICAgIH0pO1xuXG4gICAgaWYgKCFjb250ZXN0KSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiQ29udGVzdCBub3QgZm91bmRcIiB9O1xuXG4gICAgY29uc3QgaXNBdXRob3JpemVkID1cbiAgICAgICAgY3VycmVudFVzZXIucm9sZSA9PT0gXCJBRE1JTlwiIHx8XG4gICAgICAgIGN1cnJlbnRVc2VyLnJvbGUgPT09IFwiQ09OVEVTVF9NQU5BR0VSXCIgfHxcbiAgICAgICAgY3VycmVudFVzZXIucm9sZSA9PT0gXCJURUFDSEVSXCIgfHxcbiAgICAgICAgY29udGVzdC5jcmVhdG9ySWQgPT09IGN1cnJlbnRVc2VyLmlkO1xuXG4gICAgaWYgKCFpc0F1dGhvcml6ZWQpIHtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcGFydGljaXBhbnRzID0gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLmZpbmRNYW55KHtcbiAgICAgICAgICAgIHdoZXJlOiB7IGNvbnRlc3RJZCB9LFxuICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBlbWFpbDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGltYWdlOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHZpb2xhdGlvbnM6IHtcbiAgICAgICAgICAgICAgICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6IFwiZGVzY1wiIH0sXG4gICAgICAgICAgICAgICAgICAgIHRha2U6IDEwXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9yZGVyQnk6IFtcbiAgICAgICAgICAgICAgICB7IHBlcm1hbmVudGx5QmxvY2tlZDogXCJkZXNjXCIgfSxcbiAgICAgICAgICAgICAgICB7IGlzQmxvY2tlZDogXCJkZXNjXCIgfSxcbiAgICAgICAgICAgICAgICB7IHRvdGFsVmlvbGF0aW9uczogXCJkZXNjXCIgfVxuICAgICAgICAgICAgXVxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBwYXJ0aWNpcGFudHMgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGdldCBwYXJ0aWNpcGFudHM6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBnZXQgcGFydGljaXBhbnRzXCIgfTtcbiAgICB9XG59XG5cbi8qKlxuICogVW5ibG9jayBhIHBhcnRpY2lwYW50IChtYW5hZ2VyIG9ubHkpXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1bmJsb2NrUGFydGljaXBhbnQoY29udGVzdElkOiBzdHJpbmcsIHVzZXJJZDogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICBpZiAoIXNlc3Npb24/LnVzZXIpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuXG4gICAgY29uc3QgY3VycmVudFVzZXIgPSBzZXNzaW9uLnVzZXIgYXMgYW55O1xuXG4gICAgLy8gQ2hlY2sgYXV0aG9yaXphdGlvblxuICAgIGNvbnN0IGNvbnRlc3QgPSBhd2FpdCBwcmlzbWEuY29udGVzdC5maW5kVW5pcXVlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6IGNvbnRlc3RJZCB9LFxuICAgICAgICBzZWxlY3Q6IHsgY3JlYXRvcklkOiB0cnVlIH1cbiAgICB9KTtcblxuICAgIGlmICghY29udGVzdCkgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkNvbnRlc3Qgbm90IGZvdW5kXCIgfTtcblxuICAgIGNvbnN0IGlzQXV0aG9yaXplZCA9XG4gICAgICAgIGN1cnJlbnRVc2VyLnJvbGUgPT09IFwiQURNSU5cIiB8fFxuICAgICAgICBjdXJyZW50VXNlci5yb2xlID09PSBcIkNPTlRFU1RfTUFOQUdFUlwiIHx8XG4gICAgICAgIGN1cnJlbnRVc2VyLnJvbGUgPT09IFwiVEVBQ0hFUlwiIHx8XG4gICAgICAgIGNvbnRlc3QuY3JlYXRvcklkID09PSBjdXJyZW50VXNlci5pZDtcblxuICAgIGlmICghaXNBdXRob3JpemVkKSB7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHByaXNtYS5jb250ZXN0UGFydGljaXBhdGlvbi51cGRhdGUoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgY29udGVzdElkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICBpc0Jsb2NrZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHRlbXBCbG9ja2VkVW50aWw6IG51bGwsXG4gICAgICAgICAgICAgICAgcGVybWFuZW50bHlCbG9ja2VkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICB0b3RhbFZpb2xhdGlvbnM6IDAsXG4gICAgICAgICAgICAgICAgdGFiU3dpdGNoQ291bnQ6IDAsXG4gICAgICAgICAgICAgICAgZnVsbHNjcmVlbkV4aXRDb3VudDogMCxcbiAgICAgICAgICAgICAgICBjb3B5UGFzdGVDb3VudDogMCxcbiAgICAgICAgICAgICAgICBkZXZUb29sc0NvdW50OiAwLFxuICAgICAgICAgICAgICAgIGtleWJvYXJkQ291bnQ6IDAsXG4gICAgICAgICAgICAgICAgbmF2aWdhdGlvbkNvdW50OiAwLFxuICAgICAgICAgICAgICAgIGlzRmxhZ2dlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgdW5ibG9ja2VkQnk6IGN1cnJlbnRVc2VyLmlkLFxuICAgICAgICAgICAgICAgIHVuYmxvY2tlZEF0OiBuZXcgRGF0ZSgpXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldmFsaWRhdGVQYXRoKGAvZGFzaGJvYXJkL2NvbnRlc3RzLyR7Y29udGVzdElkfS9wYXJ0aWNpcGFudHNgKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gdW5ibG9jayBwYXJ0aWNpcGFudDpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIHVuYmxvY2sgcGFydGljaXBhbnRcIiB9O1xuICAgIH1cbn1cblxuLyoqXG4gKiBHZXQgZGV0YWlsZWQgdmlvbGF0aW9ucyBmb3IgYSBwYXJ0aWNpcGFudFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0UGFydGljaXBhbnRWaW9sYXRpb25zKGNvbnRlc3RJZDogc3RyaW5nLCB1c2VySWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcblxuICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gc2Vzc2lvbi51c2VyIGFzIGFueTtcblxuICAgIC8vIENoZWNrIGF1dGhvcml6YXRpb25cbiAgICBjb25zdCBjb250ZXN0ID0gYXdhaXQgcHJpc21hLmNvbnRlc3QuZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiBjb250ZXN0SWQgfSxcbiAgICAgICAgc2VsZWN0OiB7IGNyZWF0b3JJZDogdHJ1ZSB9XG4gICAgfSk7XG5cbiAgICBpZiAoIWNvbnRlc3QpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJDb250ZXN0IG5vdCBmb3VuZFwiIH07XG5cbiAgICBjb25zdCBpc0F1dGhvcml6ZWQgPVxuICAgICAgICBjdXJyZW50VXNlci5yb2xlID09PSBcIkFETUlOXCIgfHxcbiAgICAgICAgY3VycmVudFVzZXIucm9sZSA9PT0gXCJDT05URVNUX01BTkFHRVJcIiB8fFxuICAgICAgICBjdXJyZW50VXNlci5yb2xlID09PSBcIlRFQUNIRVJcIiB8fFxuICAgICAgICBjb250ZXN0LmNyZWF0b3JJZCA9PT0gY3VycmVudFVzZXIuaWQ7XG5cbiAgICBpZiAoIWlzQXV0aG9yaXplZCkge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBwYXJ0aWNpcGF0aW9uID0gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgY29udGVzdElkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdDogeyBpZDogdHJ1ZSwgbmFtZTogdHJ1ZSwgZW1haWw6IHRydWUgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgdmlvbGF0aW9uczoge1xuICAgICAgICAgICAgICAgICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogXCJkZXNjXCIgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgcGFydGljaXBhdGlvbiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZ2V0IHZpb2xhdGlvbnNcIiB9O1xuICAgIH1cbn1cblxuLyoqXG4gKiBDYWxjdWxhdGUgY29udGVzdCBsZWFkZXJib2FyZFxuICogLSBGZXRjaGVzIGFsbCBwYXJ0aWNpcGF0aW9uc1xuICogLSBGZXRjaGVzIGFsbCByZWxldmFudCBzdWJtaXNzaW9uc1xuICogLSBDYWxjdWxhdGVzIHNjb3Jlc1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q29udGVzdExlYWRlcmJvYXJkKGNvbnRlc3RJZDogc3RyaW5nKSB7XG4gICAgXCJ1c2UgY2FjaGVcIlxuICAgIGNhY2hlVGFnKGBsZWFkZXJib2FyZC0ke2NvbnRlc3RJZH1gKVxuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBjYWNoZUxpZmUoXCJsZWFkZXJib2FyZFwiKVxuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcGFydGljaXBhdGlvbnMgPSBhd2FpdCBwcmlzbWEuY29udGVzdFBhcnRpY2lwYXRpb24uZmluZE1hbnkoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICBjb250ZXN0SWQsXG4gICAgICAgICAgICAgICAgLy8gc3RhcnRlZEF0OiB7IG5vdDogbnVsbCB9IC8vIE9ubHkgc3RhcnRlZCBwYXJ0aWNpcGFudHMgKEZpeCBpZiBmaWVsZCBleGlzdHMsIG90aGVyd2lzZSByZWx5IG9uIGNyZWF0ZWQpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBpbWFnZTogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBjb250ZXN0ID0gYXdhaXQgcHJpc21hLmNvbnRlc3QuZmluZFVuaXF1ZSh7XG4gICAgICAgICAgICB3aGVyZTogeyBpZDogY29udGVzdElkIH0sXG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgcHJvYmxlbXM6IHtcbiAgICAgICAgICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJvYmxlbToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpZmZpY3VsdHk6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNsdWc6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3JlOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBvcmRlckJ5OiB7IG9yZGVyOiBcImFzY1wiIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICghY29udGVzdCkgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkNvbnRlc3Qgbm90IGZvdW5kXCIgfTtcblxuICAgICAgICBjb25zdCBsZWFkZXJib2FyZCA9IGF3YWl0IFByb21pc2UuYWxsKHBhcnRpY2lwYXRpb25zLm1hcChhc3luYyAocCkgPT4ge1xuICAgICAgICAgICAgLy8gR2V0IHZhbGlkIHN1Ym1pc3Npb25zIGZvciB0aGlzIHVzZXIgaW4gdGhpcyBjb250ZXN0XG4gICAgICAgICAgICBjb25zdCBzdWJtaXNzaW9ucyA9IGF3YWl0IHByaXNtYS5zdWJtaXNzaW9uLmZpbmRNYW55KHtcbiAgICAgICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IHAudXNlcklkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZCxcbiAgICAgICAgICAgICAgICAgICAgY3JlYXRlZEF0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBndGU6IGNvbnRlc3Quc3RhcnRUaW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgbHRlOiBjb250ZXN0LmVuZFRpbWVcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHByb2JsZW1JZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgY3JlYXRlZEF0OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBsYW5ndWFnZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSB0b3RhbCBzY29yZVxuICAgICAgICAgICAgLy8gTG9naWM6IEJlc3Qgc3VibWlzc2lvbiBwZXIgcHJvYmxlbSBjb3VudHNcbiAgICAgICAgICAgIGNvbnN0IHByb2JsZW1TY29yZXMgPSBuZXcgTWFwPHN0cmluZywgbnVtYmVyPigpO1xuICAgICAgICAgICAgY29uc3QgcHJvYmxlbVNvbHZlVGltZXMgPSBuZXcgTWFwPHN0cmluZywgRGF0ZT4oKTtcbiAgICAgICAgICAgIGNvbnN0IHByb2JsZW1TdWJtaXNzaW9uQ291bnRzID0gbmV3IE1hcDxzdHJpbmcsIG51bWJlcj4oKTtcbiAgICAgICAgICAgIGNvbnN0IHByb2JsZW1CZXN0U3VibWlzc2lvbnMgPSBuZXcgTWFwPHN0cmluZywgYW55PigpO1xuXG4gICAgICAgICAgICBzdWJtaXNzaW9ucy5mb3JFYWNoKHN1YiA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgY3VycmVudENvdW50ID0gcHJvYmxlbVN1Ym1pc3Npb25Db3VudHMuZ2V0KHN1Yi5wcm9ibGVtSWQpIHx8IDA7XG4gICAgICAgICAgICAgICAgcHJvYmxlbVN1Ym1pc3Npb25Db3VudHMuc2V0KHN1Yi5wcm9ibGVtSWQsIGN1cnJlbnRDb3VudCArIDEpO1xuXG4gICAgICAgICAgICAgICAgaWYgKHN1Yi5zdGF0dXMgPT09IFwiQUNDRVBURURcIikge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50QmVzdCA9IHByb2JsZW1TY29yZXMuZ2V0KHN1Yi5wcm9ibGVtSWQpIHx8IDA7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb2JsZW1EZWYgPSBjb250ZXN0LnByb2JsZW1zLmZpbmQoY3AgPT4gY3AucHJvYmxlbUlkID09PSBzdWIucHJvYmxlbUlkKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWF4U2NvcmUgPSBwcm9ibGVtRGVmPy5wcm9ibGVtLnNjb3JlIHx8IDA7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKG1heFNjb3JlID4gY3VycmVudEJlc3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICBwcm9ibGVtU2NvcmVzLnNldChzdWIucHJvYmxlbUlkLCBtYXhTY29yZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudEJlc3RUaW1lID0gcHJvYmxlbVNvbHZlVGltZXMuZ2V0KHN1Yi5wcm9ibGVtSWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghY3VycmVudEJlc3RUaW1lIHx8IHN1Yi5jcmVhdGVkQXQgPCBjdXJyZW50QmVzdFRpbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvYmxlbVNvbHZlVGltZXMuc2V0KHN1Yi5wcm9ibGVtSWQsIHN1Yi5jcmVhdGVkQXQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9ibGVtQmVzdFN1Ym1pc3Npb25zLnNldChzdWIucHJvYmxlbUlkLCBzdWIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBsZXQgdG90YWxTY29yZSA9IDA7XG4gICAgICAgICAgICBsZXQgdG90YWxUaW1lTXMgPSAwO1xuXG4gICAgICAgICAgICBwcm9ibGVtU2NvcmVzLmZvckVhY2goKHNjb3JlLCBwcm9ibGVtSWQpID0+IHtcbiAgICAgICAgICAgICAgICB0b3RhbFNjb3JlICs9IHNjb3JlO1xuICAgICAgICAgICAgICAgIGNvbnN0IHNvbHZlbnRUaW1lID0gcHJvYmxlbVNvbHZlVGltZXMuZ2V0KHByb2JsZW1JZCk7XG4gICAgICAgICAgICAgICAgaWYgKHNvbHZlbnRUaW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIHRvdGFsVGltZU1zICs9IChzb2x2ZW50VGltZS5nZXRUaW1lKCkgLSBjb250ZXN0LnN0YXJ0VGltZS5nZXRUaW1lKCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBNYXAgc3RhdHMgZm9yIGVhY2ggcHJvYmxlbSBpbiB0aGUgY29udGVzdFxuICAgICAgICAgICAgY29uc3QgcHJvYmxlbVN0YXRzID0gY29udGVzdC5wcm9ibGVtcy5tYXAoY3AgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGJlc3RTdWIgPSBwcm9ibGVtQmVzdFN1Ym1pc3Npb25zLmdldChjcC5wcm9ibGVtSWQpO1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIHByb2JsZW1JZDogY3AucHJvYmxlbUlkLFxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogY3AucHJvYmxlbS50aXRsZSxcbiAgICAgICAgICAgICAgICAgICAgc2x1ZzogY3AucHJvYmxlbS5zbHVnLFxuICAgICAgICAgICAgICAgICAgICBzY29yZTogcHJvYmxlbVNjb3Jlcy5nZXQoY3AucHJvYmxlbUlkKSB8fCAwLFxuICAgICAgICAgICAgICAgICAgICBtYXhTY29yZTogY3AucHJvYmxlbS5zY29yZSxcbiAgICAgICAgICAgICAgICAgICAgc3VibWlzc2lvbnM6IHByb2JsZW1TdWJtaXNzaW9uQ291bnRzLmdldChjcC5wcm9ibGVtSWQpIHx8IDAsXG4gICAgICAgICAgICAgICAgICAgIHNvbHZlZDogcHJvYmxlbVNjb3Jlcy5oYXMoY3AucHJvYmxlbUlkKSxcbiAgICAgICAgICAgICAgICAgICAgc29sdmVkQXQ6IHByb2JsZW1Tb2x2ZVRpbWVzLmdldChjcC5wcm9ibGVtSWQpLFxuICAgICAgICAgICAgICAgICAgICBsYW5ndWFnZTogYmVzdFN1Yj8ubGFuZ3VhZ2U/Lm5hbWUgfHwgbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgbGFuZ3VhZ2VJZDogYmVzdFN1Yj8ubGFuZ3VhZ2U/LmlkIHx8IG51bGxcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgLi4ucC51c2VyLFxuICAgICAgICAgICAgICAgIHNjb3JlOiB0b3RhbFNjb3JlLFxuICAgICAgICAgICAgICAgIHRpbWVUYWtlbjogdG90YWxUaW1lTXMsXG4gICAgICAgICAgICAgICAgcHJvYmxlbXNTb2x2ZWQ6IHByb2JsZW1TY29yZXMuc2l6ZSxcbiAgICAgICAgICAgICAgICBwcm9ibGVtU3RhdHNcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pKTtcblxuICAgICAgICAvLyBTb3J0OiBIaWdoIHNjb3JlIGZpcnN0LCB0aGVuIGxvdyB0aW1lIHRha2VuXG4gICAgICAgIGxlYWRlcmJvYXJkLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgICAgICAgIGlmIChiLnNjb3JlICE9PSBhLnNjb3JlKSByZXR1cm4gYi5zY29yZSAtIGEuc2NvcmU7XG4gICAgICAgICAgICByZXR1cm4gYS50aW1lVGFrZW4gLSBiLnRpbWVUYWtlbjtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgICBzdHVkZW50czogbGVhZGVyYm9hcmQsXG4gICAgICAgICAgICBpc0ZpbmFsaXplZDogY29udGVzdC5pc0ZpbmFsaXplZCxcbiAgICAgICAgICAgIHByb2JsZW1zOiBjb250ZXN0LnByb2JsZW1zLm1hcChjcCA9PiAoe1xuICAgICAgICAgICAgICAgIGlkOiBjcC5wcm9ibGVtSWQsXG4gICAgICAgICAgICAgICAgdGl0bGU6IGNwLnByb2JsZW0udGl0bGUsXG4gICAgICAgICAgICAgICAgc2x1ZzogY3AucHJvYmxlbS5zbHVnLFxuICAgICAgICAgICAgICAgIG1heFNjb3JlOiBjcC5wcm9ibGVtLnNjb3JlXG4gICAgICAgICAgICB9KSlcbiAgICAgICAgfTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJMZWFkZXJib2FyZCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGdlbmVyYXRlIGxlYWRlcmJvYXJkXCIgfTtcbiAgICB9XG59XG5cbi8qKlxuICogR2V0IGN1cnJlbnQgdXNlcidzIHJhbmtpbmcgaW4gYSBjb250ZXN0XG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRDb250ZXN0UmFua2luZyhjb250ZXN0SWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcblxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGdldENvbnRlc3RMZWFkZXJib2FyZChjb250ZXN0SWQpO1xuXG4gICAgICAgIGlmICghcmVzdWx0LnN1Y2Nlc3MgfHwgIXJlc3VsdC5zdHVkZW50cykge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBnZXQgcmFua2luZ1wiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCByYW5rID0gcmVzdWx0LnN0dWRlbnRzLmZpbmRJbmRleCgoczogYW55KSA9PiBzLmlkID09PSBzZXNzaW9uLnVzZXIuaWQpICsgMTtcblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCByYW5rOiByYW5rID4gMCA/IHJhbmsgOiBudWxsIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZ2V0IHJhbmtpbmdcIiB9O1xuICAgIH1cbn1cbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiK1JBaXFCc0IifQ==
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/actions/data:93d28e [app-client] (ecmascript) <text/javascript>", ((__turbopack_context__) => {
"use strict";

/* __next_internal_action_entry_do_not_use__ [{"604a0bcc1451e81e233f48280ac746b33b2aa18f12":"verifyContestPassword"},"actions/contest.ts",""] */ __turbopack_context__.s([
    "verifyContestPassword",
    ()=>verifyContestPassword
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-client] (ecmascript)");
"use turbopack no side effects";
;
var verifyContestPassword = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["createServerReference"])("604a0bcc1451e81e233f48280ac746b33b2aa18f12", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["findSourceMapURL"], "verifyContestPassword"); //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vY29udGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzZXJ2ZXJcIjtcblxuaW1wb3J0IHsgcHJpc21hIH0gZnJvbSBcIkAvbGliL3ByaXNtYVwiO1xuaW1wb3J0IHsgYXV0aCB9IGZyb20gXCJAL2xpYi9hdXRoXCI7XG5pbXBvcnQgeyBoZWFkZXJzIH0gZnJvbSBcIm5leHQvaGVhZGVyc1wiO1xuaW1wb3J0IHsgeiB9IGZyb20gXCJ6b2RcIjtcbmltcG9ydCB7IHJldmFsaWRhdGVQYXRoLCByZXZhbGlkYXRlVGFnIH0gZnJvbSBcIm5leHQvY2FjaGVcIjtcbmltcG9ydCB7IHVuc3RhYmxlX2NhY2hlIGFzIGNhY2hlLCB1bnN0YWJsZV9ub1N0b3JlIGFzIG5vU3RvcmUgfSBmcm9tIFwibmV4dC9jYWNoZVwiO1xuaW1wb3J0IHsgY2FjaGVUYWcsIGNhY2hlTGlmZSB9IGZyb20gXCJuZXh0L2NhY2hlXCI7XG5pbXBvcnQgeyBhZnRlciB9IGZyb20gXCJuZXh0L3NlcnZlclwiOyAvLyBGb3IgYmFja2dyb3VuZCB0YXNrc1xuXG5jb25zdCBjb250ZXN0U2NoZW1hID0gei5vYmplY3Qoe1xuICAgIHRpdGxlOiB6LnN0cmluZygpLm1pbigzLCBcIlRpdGxlIG11c3QgYmUgYXQgbGVhc3QgMyBjaGFyYWN0ZXJzXCIpLFxuICAgIGRlc2NyaXB0aW9uOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgc3RhcnRUaW1lOiB6LmNvZXJjZS5kYXRlKCksXG4gICAgZW5kVGltZTogei5jb2VyY2UuZGF0ZSgpLFxuICAgIHZpc2liaWxpdHk6IHouZW51bShbXCJQVUJMSUNcIiwgXCJJTlNUSVRVVElPTlwiLCBcIkNMQVNTUk9PTVwiXSksXG4gICAgY2xhc3Nyb29tSWQ6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgICBpbnN0aXR1dGlvbklkOiB6LnN0cmluZygpLm9wdGlvbmFsKCkubnVsbGFibGUoKSxcbiAgICBwcm9ibGVtczogei5hcnJheSh6LnN0cmluZygpKS5taW4oMSwgXCJTZWxlY3QgYXQgbGVhc3Qgb25lIHByb2JsZW1cIiksXG4gICAgY29udGVzdFBhc3N3b3JkOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgcmFuZG9taXplUXVlc3Rpb25zOiB6LmJvb2xlYW4oKS5kZWZhdWx0KGZhbHNlKSxcbn0pO1xuXG5jb25zdCBjb250ZXN0V2l0aFByb2JsZW1zU2NoZW1hID0gei5vYmplY3Qoe1xuICAgIHRpdGxlOiB6LnN0cmluZygpLm1pbigzLCBcIlRpdGxlIG11c3QgYmUgYXQgbGVhc3QgMyBjaGFyYWN0ZXJzXCIpLFxuICAgIHNsdWc6IHouc3RyaW5nKCkubWluKDMsIFwiU2x1ZyBtdXN0IGJlIGF0IGxlYXN0IDMgY2hhcmFjdGVyc1wiKSxcbiAgICBkZXNjcmlwdGlvbjogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAgIHN0YXJ0VGltZTogei5kYXRlKCksXG4gICAgZW5kVGltZTogei5kYXRlKCksXG4gICAgdmlzaWJpbGl0eTogei5lbnVtKFtcIlBVQkxJQ1wiLCBcIklOU1RJVFVUSU9OXCIsIFwiQ0xBU1NST09NXCJdKSxcbiAgICBoaWRkZW46IHouYm9vbGVhbigpLmRlZmF1bHQoZmFsc2UpLFxuICAgIGNsYXNzcm9vbUlkOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgaW5zdGl0dXRpb25JZDogei5zdHJpbmcoKS5vcHRpb25hbCgpLm51bGxhYmxlKCksXG4gICAgYmFja2dyb3VuZEltYWdlOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgcHJpemVzOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgcnVsZXM6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgICBwcm9ibGVtczogei5hcnJheSh6LmFueSgpKSwgLy8gRnVsbCBwcm9ibGVtIGRhdGEgb2JqZWN0c1xuICAgIGNvbnRlc3RQYXNzd29yZDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAgIHJhbmRvbWl6ZVF1ZXN0aW9uczogei5ib29sZWFuKCkuZGVmYXVsdChmYWxzZSksXG59KTtcblxuLyoqXG4gKiBGZXRjaGVzIGNvbnRlc3RzIHZpc2libGUgdG8gdGhlIGN1cnJlbnQgdXNlci5cbiAqL1xuLyoqXG4gKiBDYWNoZWQgZmV0Y2ggZm9yIHB1YmxpYyBjb250ZXN0c1xuICovXG5hc3luYyBmdW5jdGlvbiBnZXRQdWJsaWNDb250ZXN0cygpIHtcbiAgICBcInVzZSBjYWNoZVwiXG4gICAgY2FjaGVUYWcoXCJjb250ZXN0cy1wdWJsaWNcIik7XG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIGNhY2hlTGlmZShcImNvbnRlc3RzXCIpO1xuXG4gICAgcmV0dXJuIHByaXNtYS5jb250ZXN0LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgIHZpc2liaWxpdHk6IFwiUFVCTElDXCIsXG4gICAgICAgICAgICBoaWRkZW46IGZhbHNlLFxuICAgICAgICB9LFxuICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICBfY291bnQ6IHsgc2VsZWN0OiB7IHByb2JsZW1zOiB0cnVlIH0gfVxuICAgICAgICB9LFxuICAgICAgICBvcmRlckJ5OiB7IHN0YXJ0VGltZTogXCJkZXNjXCIgfSxcbiAgICB9KTtcbn1cblxuLyoqXG4gKiBGZXRjaGVzIGNvbnRlc3RzIHZpc2libGUgdG8gdGhlIGN1cnJlbnQgdXNlci5cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFZpc2libGVDb250ZXN0cygpIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIHRyeSB7XG4gICAgICAgIGlmICghc2Vzc2lvbj8udXNlcikge1xuICAgICAgICAgICAgY29uc3QgY29udGVzdHMgPSBhd2FpdCBnZXRQdWJsaWNDb250ZXN0cygpO1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgY29udGVzdHMgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gc2Vzc2lvbi51c2VyIGFzIGFueTtcblxuICAgICAgICBpZiAoY3VycmVudFVzZXIucm9sZSA9PT0gXCJBRE1JTlwiKSB7XG4gICAgICAgICAgICBjb25zdCBjb250ZXN0cyA9IGF3YWl0IHByaXNtYS5jb250ZXN0LmZpbmRNYW55KHtcbiAgICAgICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgICAgIF9jb3VudDogeyBzZWxlY3Q6IHsgcHJvYmxlbXM6IHRydWUgfSB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBvcmRlckJ5OiB7IHN0YXJ0VGltZTogXCJkZXNjXCIgfSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgY29udGVzdHMgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGNvbnRlc3RzID0gYXdhaXQgcHJpc21hLmNvbnRlc3QuZmluZE1hbnkoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICBPUjogW1xuICAgICAgICAgICAgICAgICAgICB7IHZpc2liaWxpdHk6IFwiUFVCTElDXCIgfSxcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgQU5EOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeyB2aXNpYmlsaXR5OiBcIklOU1RJVFVUSU9OXCIgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IGluc3RpdHV0aW9uSWQ6IGN1cnJlbnRVc2VyLmluc3RpdHV0aW9uSWQgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIEFORDogW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgdmlzaWJpbGl0eTogXCJDTEFTU1JPT01cIiB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgT1I6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgY2xhc3Nyb29tOiB7IHN0dWRlbnRzOiB7IHNvbWU6IHsgaWQ6IGN1cnJlbnRVc2VyLmlkIH0gfSB9IH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IGNyZWF0b3JJZDogY3VycmVudFVzZXIuaWQgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgeyBjcmVhdG9ySWQ6IGN1cnJlbnRVc2VyLmlkIH0sXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgX2NvdW50OiB7IHNlbGVjdDogeyBwcm9ibGVtczogdHJ1ZSB9IH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvcmRlckJ5OiB7IHN0YXJ0VGltZTogXCJkZXNjXCIgfSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgY29udGVzdHMgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGZldGNoIGNvbnRlc3RzOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZmV0Y2ggY29udGVzdHNcIiB9O1xuICAgIH1cbn1cblxuXG4vKipcbiAqIEZldGNoZXMgYSBzaW5nbGUgY29udGVzdCdzIGRldGFpbHMgd2l0aCBhdXRob3JpemF0aW9uLlxuICovXG4vKipcbiAqIEZldGNoZXMgYSBzaW5nbGUgY29udGVzdCdzIGRldGFpbHMgd2l0aCBhdXRob3JpemF0aW9uLlxuICovXG4vKipcbiAqIENhY2hlZCBjb250ZXN0IGRldGFpbCBmZXRjaGVyXG4gKiBSZXR1cm5zIGNvbnRlc3QgZGF0YSB3aXRob3V0IHVzZXItc3BlY2lmaWMgY29udGV4dFxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRDYWNoZWRDb250ZXN0KGNvbnRlc3RJZDogc3RyaW5nKSB7XG4gICAgXCJ1c2UgY2FjaGVcIlxuICAgIGNhY2hlVGFnKGBjb250ZXN0LSR7Y29udGVzdElkfWApO1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBjYWNoZUxpZmUoXCJjb250ZXN0LWRldGFpbFwiKTtcblxuICAgIHJldHVybiBwcmlzbWEuY29udGVzdC5maW5kVW5pcXVlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6IGNvbnRlc3RJZCB9LFxuICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICBfY291bnQ6IHtcbiAgICAgICAgICAgICAgICBzZWxlY3Q6IHsgcHJvYmxlbXM6IHRydWUgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwcm9ibGVtczoge1xuICAgICAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICAgICAgcHJvYmxlbToge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlmZmljdWx0eTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbHVnOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9yZGVyQnk6IHsgb3JkZXI6IFwiYXNjXCIgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgfSk7XG59XG5cbi8qKlxuICogRmV0Y2hlcyBhIHNpbmdsZSBjb250ZXN0J3MgZGV0YWlscyB3aXRoIGF1dGhvcml6YXRpb24uXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRDb250ZXN0RGV0YWlsKGNvbnRlc3RJZDogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjb250ZXN0ID0gYXdhaXQgZ2V0Q2FjaGVkQ29udGVzdChjb250ZXN0SWQpO1xuXG4gICAgICAgIGlmICghY29udGVzdCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkNvbnRlc3Qgbm90IGZvdW5kXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gc2Vzc2lvbj8udXNlciBhcyBhbnk7XG4gICAgICAgIGNvbnN0IHBhcnRpY2lwYXRpb24gPSBjdXJyZW50VXNlciA/IGF3YWl0IHByaXNtYS5jb250ZXN0UGFydGljaXBhdGlvbi5maW5kVW5pcXVlKHtcbiAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgdXNlcklkX2NvbnRlc3RJZDoge1xuICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IGN1cnJlbnRVc2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkgOiBudWxsO1xuXG4gICAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgICAgIGNvbnN0IGhhc1N0YXJ0ZWQgPSBub3cgPj0gY29udGVzdC5zdGFydFRpbWU7XG4gICAgICAgIGNvbnN0IGlzQ3JlYXRvciA9IGN1cnJlbnRVc2VyPy5pZCA9PT0gY29udGVzdC5jcmVhdG9ySWQ7XG4gICAgICAgIGNvbnN0IGlzQWRtaW4gPSBjdXJyZW50VXNlcj8ucm9sZSA9PT0gXCJBRE1JTlwiO1xuXG4gICAgICAgIC8vIFZpc2liaWxpdHkgQ2hlY2tcbiAgICAgICAgbGV0IGlzQXV0aG9yaXplZCA9IGZhbHNlO1xuICAgICAgICBpZiAoY29udGVzdC52aXNpYmlsaXR5ID09PSBcIlBVQkxJQ1wiKSB7XG4gICAgICAgICAgICBpc0F1dGhvcml6ZWQgPSB0cnVlO1xuICAgICAgICB9IGVsc2UgaWYgKGlzQWRtaW4pIHtcbiAgICAgICAgICAgIGlzQXV0aG9yaXplZCA9IHRydWU7XG4gICAgICAgIH0gZWxzZSBpZiAoY3VycmVudFVzZXIpIHtcbiAgICAgICAgICAgIGlmIChpc0NyZWF0b3IpIHtcbiAgICAgICAgICAgICAgICBpc0F1dGhvcml6ZWQgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChjb250ZXN0LnZpc2liaWxpdHkgPT09IFwiSU5TVElUVVRJT05cIikge1xuICAgICAgICAgICAgICAgIC8vIFVzZSA9PSBmb3IgbnVsbC91bmRlZmluZWQgbG9vc2UgZXF1YWxpdHkgY2hlY2tcbiAgICAgICAgICAgICAgICBpc0F1dGhvcml6ZWQgPSBjdXJyZW50VXNlci5pbnN0aXR1dGlvbklkID09IGNvbnRlc3QuaW5zdGl0dXRpb25JZDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoY29udGVzdC52aXNpYmlsaXR5ID09PSBcIkNMQVNTUk9PTVwiKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZW5yb2xsbWVudCA9IGF3YWl0IHByaXNtYS5jbGFzc3Jvb20uZmluZEZpcnN0KHtcbiAgICAgICAgICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBjb250ZXN0LmNsYXNzcm9vbUlkIGFzIHN0cmluZyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0dWRlbnRzOiB7IHNvbWU6IHsgaWQ6IGN1cnJlbnRVc2VyLmlkIH0gfSxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpc0F1dGhvcml6ZWQgPSAhIWVucm9sbG1lbnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIWlzQXV0aG9yaXplZCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZCBhY2Nlc3MgdG8gdGhpcyBjb250ZXN0LlwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBjYW5TZWVQcm9ibGVtcyA9IChoYXNTdGFydGVkIHx8IGlzQWRtaW4gfHwgaXNDcmVhdG9yKSAmJiAocGFydGljaXBhdGlvbj8uYWNjZXB0ZWRSdWxlcyB8fCBpc0NyZWF0b3IgfHwgaXNBZG1pbik7XG5cbiAgICAgICAgLy8gRml4OiBJZiB0aGUgY29udGVzdCBpcyBvdmVyLCBhbGxvd2VkIHJvbGVzIHNob3VsZCBjaGVjayBwYXJ0aWNpcGF0aW9uIHByb3Blcmx5LFxuICAgICAgICAvLyBidXQgdHlwaWNhbGx5IGFsbG93cyB2aWV3aW5nIGlmIHB1YmxpYy9hdXRob3JpemVkLlxuICAgICAgICAvLyBCdXQgZm9yIFwiTGl2ZVwiIGNvbnRlc3RzLCB0aGUgY3VycmVudCBsb2dpYyBpcyBjb3JyZWN0LlxuXG4gICAgICAgIGNvbnN0IHJlcXVpcmVzUGFzc3dvcmQgPSAhIWNvbnRlc3QuY29udGVzdFBhc3N3b3JkO1xuXG4gICAgICAgIC8vIFNodWZmbGUgcHJvYmxlbXMgaWYgcmFuZG9taXplUXVlc3Rpb25zIGlzIGVuYWJsZWRcbiAgICAgICAgLy8gVXNlIGEgc2ltcGxlIHNlZWRlZCBzaHVmZmxlIGJhc2VkIG9uIHVzZXJJZCArIGNvbnRlc3RJZCBmb3IgY29uc2lzdGVuY3lcbiAgICAgICAgbGV0IHZpc2libGVQcm9ibGVtcyA9IGNhblNlZVByb2JsZW1zID8gY29udGVzdC5wcm9ibGVtcyA6IFtdO1xuXG4gICAgICAgIGlmIChjb250ZXN0LnJhbmRvbWl6ZVF1ZXN0aW9ucyAmJiBjdXJyZW50VXNlciAmJiB2aXNpYmxlUHJvYmxlbXMubGVuZ3RoID4gMCAmJiAhaXNBZG1pbiAmJiAhaXNDcmVhdG9yKSB7XG4gICAgICAgICAgICAvLyBTaW1wbGUgc3RyaW5nIGhhc2ggZnVuY3Rpb24gZm9yIHNlZWRpbmdcbiAgICAgICAgICAgIGNvbnN0IHNlZWRTdHIgPSBgJHtjdXJyZW50VXNlci5pZH0tJHtjb250ZXN0SWR9YDtcbiAgICAgICAgICAgIGxldCBzZWVkID0gMDtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2VlZFN0ci5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHNlZWQgPSAoKHNlZWQgPDwgNSkgLSBzZWVkKSArIHNlZWRTdHIuY2hhckNvZGVBdChpKTtcbiAgICAgICAgICAgICAgICBzZWVkIHw9IDA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIERldGVybWluaXN0aWMgc2h1ZmZsZVxuICAgICAgICAgICAgdmlzaWJsZVByb2JsZW1zID0gWy4uLnZpc2libGVQcm9ibGVtc10uc29ydCgoYSwgYikgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHggPSBNYXRoLnNpbihzZWVkKyspICogMTAwMDA7XG4gICAgICAgICAgICAgICAgcmV0dXJuICh4IC0gTWF0aC5mbG9vcih4KSkgLSAwLjU7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEZldGNoIHVzZXIncyBzb2x2ZWQgcHJvYmxlbXMgZm9yIHRoaXMgY29udGVzdFxuICAgICAgICBjb25zdCBzb2x2ZWRQcm9ibGVtSWRzID0gbmV3IFNldDxzdHJpbmc+KCk7XG4gICAgICAgIGlmIChjdXJyZW50VXNlcikge1xuICAgICAgICAgICAgY29uc3Qgc29sdmVkU3VibWlzc2lvbnMgPSBhd2FpdCBwcmlzbWEuc3VibWlzc2lvbi5maW5kTWFueSh7XG4gICAgICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkOiBjdXJyZW50VXNlci5pZCxcbiAgICAgICAgICAgICAgICAgICAgY29udGVzdElkOiBjb250ZXN0SWQsXG4gICAgICAgICAgICAgICAgICAgIHN0YXR1czogXCJBQ0NFUFRFRFwiLFxuICAgICAgICAgICAgICAgICAgICBwcm9ibGVtSWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGluOiB2aXNpYmxlUHJvYmxlbXMubWFwKHAgPT4gcC5wcm9ibGVtLmlkKVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBzZWxlY3Q6IHsgcHJvYmxlbUlkOiB0cnVlIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgc29sdmVkU3VibWlzc2lvbnMuZm9yRWFjaChzID0+IHNvbHZlZFByb2JsZW1JZHMuYWRkKHMucHJvYmxlbUlkKSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRlc3Q6IHtcbiAgICAgICAgICAgICAgICAuLi5jb250ZXN0LFxuICAgICAgICAgICAgICAgIHByb2JsZW1zOiB2aXNpYmxlUHJvYmxlbXMubWFwKHZwID0+ICh7XG4gICAgICAgICAgICAgICAgICAgIC4uLnZwLFxuICAgICAgICAgICAgICAgICAgICBpc1NvbHZlZDogc29sdmVkUHJvYmxlbUlkcy5oYXModnAucHJvYmxlbS5pZClcbiAgICAgICAgICAgICAgICB9KSksXG4gICAgICAgICAgICAgICAgaGFzU3RhcnRlZCxcbiAgICAgICAgICAgICAgICBoYXNFbmRlZDogbm93ID4gY29udGVzdC5lbmRUaW1lLFxuICAgICAgICAgICAgICAgIGNhbk1hbmFnZTogaXNBZG1pbiB8fCBpc0NyZWF0b3IsXG4gICAgICAgICAgICAgICAgaGFzQWNjZXB0ZWRSdWxlczogcGFydGljaXBhdGlvbj8uYWNjZXB0ZWRSdWxlcyB8fCBmYWxzZSxcbiAgICAgICAgICAgICAgICBpc0ZpbmlzaGVkOiBwYXJ0aWNpcGF0aW9uPy5pc0ZpbmlzaGVkIHx8IGZhbHNlLFxuICAgICAgICAgICAgICAgIHJlcXVpcmVzUGFzc3dvcmQsXG4gICAgICAgICAgICAgICAgY29udGVzdFBhc3N3b3JkOiBudWxsLCAvLyBOZXZlciByZXR1cm4gcGxhaW4gcGFzc3dvcmRcbiAgICAgICAgICAgICAgICBzZXNzaW9uSWQ6IHBhcnRpY2lwYXRpb24/LnNlc3Npb25JZCAvLyBSZXR1cm4gc2Vzc2lvbklkIGZvciBwcm90ZWN0aW9uXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBmZXRjaCBjb250ZXN0IGRldGFpbDpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGZldGNoIGNvbnRlc3RcIiB9O1xuICAgIH1cbn1cblxuLy8gLi4uIGV4aXN0aW5nIGNvZGUgLi4uXG5cbi8vIC4uLiBleGlzdGluZyBjb2RlIC4uLlxuXG4vLyAuLi4gZXhpc3RpbmcgY29kZSAuLi5cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUNvbnRlc3QoZGF0YTogei5pbmZlcjx0eXBlb2YgY29udGVzdFNjaGVtYT4pIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIGlmICghc2Vzc2lvbj8udXNlcikge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcbiAgICB9XG5cbiAgICBjb25zdCBjdXJyZW50VXNlciA9IHNlc3Npb24udXNlciBhcyBhbnk7XG5cbiAgICBpZiAoIVtcIkFETUlOXCIsIFwiSU5TVElUVVRJT05fTUFOQUdFUlwiLCBcIkNPTlRFU1RfTUFOQUdFUlwiLCBcIlRFQUNIRVJcIl0uaW5jbHVkZXMoY3VycmVudFVzZXIucm9sZSkpIHtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgdmFsaWRhdGVkRGF0YSA9IGNvbnRlc3RTY2hlbWEucGFyc2UoZGF0YSk7XG5cbiAgICAgICAgLy8gR2VuZXJhdGUgYSBtb3JlIHJvYnVzdCB1bmlxdWUgc2x1Z1xuICAgICAgICBjb25zdCBiYXNlU2x1ZyA9IHZhbGlkYXRlZERhdGEudGl0bGUudG9Mb3dlckNhc2UoKS5yZXBsYWNlKC9bXmEtejAtOV0rL2csIFwiLVwiKS5yZXBsYWNlKC8oXi18LSQpL2csIFwiXCIpO1xuICAgICAgICBjb25zdCB1bmlxdWVTbHVnID0gYCR7YmFzZVNsdWd9LSR7RGF0ZS5ub3coKX1gO1xuXG4gICAgICAgIGNvbnN0IGNvbnRlc3QgPSBhd2FpdCBwcmlzbWEuY29udGVzdC5jcmVhdGUoe1xuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgIHRpdGxlOiB2YWxpZGF0ZWREYXRhLnRpdGxlLFxuICAgICAgICAgICAgICAgIHNsdWc6IHVuaXF1ZVNsdWcsXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHZhbGlkYXRlZERhdGEuZGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgc3RhcnRUaW1lOiB2YWxpZGF0ZWREYXRhLnN0YXJ0VGltZSxcbiAgICAgICAgICAgICAgICBlbmRUaW1lOiB2YWxpZGF0ZWREYXRhLmVuZFRpbWUsXG4gICAgICAgICAgICAgICAgdmlzaWJpbGl0eTogdmFsaWRhdGVkRGF0YS52aXNpYmlsaXR5IGFzIGFueSxcbiAgICAgICAgICAgICAgICBpbnN0aXR1dGlvbklkOiB2YWxpZGF0ZWREYXRhLnZpc2liaWxpdHkgIT09IFwiUFVCTElDXCIgPyAodmFsaWRhdGVkRGF0YS5pbnN0aXR1dGlvbklkIHx8IG51bGwpIDogbnVsbCxcbiAgICAgICAgICAgICAgICBjbGFzc3Jvb21JZDogdmFsaWRhdGVkRGF0YS52aXNpYmlsaXR5ID09PSBcIkNMQVNTUk9PTVwiID8gKHZhbGlkYXRlZERhdGEuY2xhc3Nyb29tSWQgfHwgbnVsbCkgOiBudWxsLFxuICAgICAgICAgICAgICAgIGNyZWF0b3JJZDogY3VycmVudFVzZXIuaWQsXG4gICAgICAgICAgICAgICAgY29udGVzdFBhc3N3b3JkOiB2YWxpZGF0ZWREYXRhLmNvbnRlc3RQYXNzd29yZCB8fCBudWxsLFxuICAgICAgICAgICAgICAgIHJhbmRvbWl6ZVF1ZXN0aW9uczogdmFsaWRhdGVkRGF0YS5yYW5kb21pemVRdWVzdGlvbnMgfHwgZmFsc2UsXG4gICAgICAgICAgICAgICAgcHJvYmxlbXM6IHtcbiAgICAgICAgICAgICAgICAgICAgY3JlYXRlOiB2YWxpZGF0ZWREYXRhLnByb2JsZW1zLm1hcCgocHJvYmxlbUlkLCBpbmRleCkgPT4gKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2JsZW1JZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG9yZGVyOiBpbmRleCxcbiAgICAgICAgICAgICAgICAgICAgfSkpLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcblxuICAgICAgICByZXZhbGlkYXRlUGF0aChcIi9kYXNoYm9hcmQvY29udGVzdHNcIik7XG4gICAgICAgIHJldmFsaWRhdGVQYXRoKFwiL2NvbnRlc3RcIik7XG4gICAgICAgIHJldmFsaWRhdGVUYWcoXCJjb250ZXN0c1wiLCBcIm1heFwiKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgY29udGVzdElkOiBjb250ZXN0LmlkIH07XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBjb250ZXN0OlwiLCBlcnJvcik7XG4gICAgICAgIC8vIFJldHVybiBjbGVhcmVyIGVycm9yIG1lc3NhZ2VzXG4gICAgICAgIGxldCBlcnJvck1lc3NhZ2UgPSBcIkZhaWxlZCB0byBjcmVhdGUgY29udGVzdFwiO1xuICAgICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiB6LlpvZEVycm9yKSB7XG4gICAgICAgICAgICAgZXJyb3JNZXNzYWdlID0gKGVycm9yIGFzIGFueSkuZXJyb3JzLm1hcCgoZTogYW55KSA9PiBlLm1lc3NhZ2UpLmpvaW4oXCIsIFwiKTtcbiAgICAgICAgfSBlbHNlIGlmIChlcnJvciBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgICAgICAgICAgZXJyb3JNZXNzYWdlID0gZXJyb3IubWVzc2FnZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVycm9yTWVzc2FnZSB9O1xuICAgIH1cbiAgICB9XG5cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUNvbnRlc3RXaXRoUHJvYmxlbXMoZGF0YTogei5pbmZlcjx0eXBlb2YgY29udGVzdFdpdGhQcm9ibGVtc1NjaGVtYT4pIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIGlmICghc2Vzc2lvbj8udXNlcikge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcbiAgICB9XG5cbiAgICBjb25zdCBjdXJyZW50VXNlciA9IHNlc3Npb24udXNlciBhcyBhbnk7XG5cbiAgICBpZiAoIVtcIkFETUlOXCIsIFwiSU5TVElUVVRJT05fTUFOQUdFUlwiLCBcIkNPTlRFU1RfTUFOQUdFUlwiLCBcIlRFQUNIRVJcIl0uaW5jbHVkZXMoY3VycmVudFVzZXIucm9sZSkpIHtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgdmFsaWRhdGVkRGF0YSA9IGNvbnRlc3RXaXRoUHJvYmxlbXNTY2hlbWEucGFyc2UoZGF0YSk7XG5cbiAgICAgICAgY29uc3QgY29udGVzdCA9IGF3YWl0IHByaXNtYS4kdHJhbnNhY3Rpb24oYXN5bmMgKHR4KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjb250ZXN0ID0gYXdhaXQgdHguY29udGVzdC5jcmVhdGUoe1xuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHZhbGlkYXRlZERhdGEudGl0bGUsXG4gICAgICAgICAgICAgICAgICAgIHNsdWc6IHZhbGlkYXRlZERhdGEuc2x1ZyxcbiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHZhbGlkYXRlZERhdGEuZGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0VGltZTogdmFsaWRhdGVkRGF0YS5zdGFydFRpbWUsXG4gICAgICAgICAgICAgICAgICAgIGVuZFRpbWU6IHZhbGlkYXRlZERhdGEuZW5kVGltZSxcbiAgICAgICAgICAgICAgICAgICAgdmlzaWJpbGl0eTogdmFsaWRhdGVkRGF0YS52aXNpYmlsaXR5IGFzIGFueSxcbiAgICAgICAgICAgICAgICAgICAgaGlkZGVuOiB2YWxpZGF0ZWREYXRhLmhpZGRlbixcbiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZEltYWdlOiB2YWxpZGF0ZWREYXRhLmJhY2tncm91bmRJbWFnZSxcbiAgICAgICAgICAgICAgICAgICAgcHJpemVzOiB2YWxpZGF0ZWREYXRhLnByaXplcyxcbiAgICAgICAgICAgICAgICAgICAgcnVsZXM6IHZhbGlkYXRlZERhdGEucnVsZXMsXG4gICAgICAgICAgICAgICAgICAgIGluc3RpdHV0aW9uSWQ6IHZhbGlkYXRlZERhdGEudmlzaWJpbGl0eSAhPT0gXCJQVUJMSUNcIiA/ICh2YWxpZGF0ZWREYXRhLmluc3RpdHV0aW9uSWQgfHwgbnVsbCkgOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICBjbGFzc3Jvb21JZDogdmFsaWRhdGVkRGF0YS52aXNpYmlsaXR5ID09PSBcIkNMQVNTUk9PTVwiID8gKHZhbGlkYXRlZERhdGEuY2xhc3Nyb29tSWQgfHwgbnVsbCkgOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICBjcmVhdG9ySWQ6IGN1cnJlbnRVc2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0UGFzc3dvcmQ6IHZhbGlkYXRlZERhdGEuY29udGVzdFBhc3N3b3JkIHx8IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIHJhbmRvbWl6ZVF1ZXN0aW9uczogdmFsaWRhdGVkRGF0YS5yYW5kb21pemVRdWVzdGlvbnMgfHwgZmFsc2UsXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmFsaWRhdGVkRGF0YS5wcm9ibGVtcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGNvbnN0IHAgPSB2YWxpZGF0ZWREYXRhLnByb2JsZW1zW2ldO1xuICAgICAgICAgICAgICAgIC8vIEdlbmVyYXRlIHVuaXF1ZSBzbHVnIGJ5IGFwcGVuZGluZyBjb250ZXN0IHNsdWcgYW5kIGluZGV4XG4gICAgICAgICAgICAgICAgY29uc3QgdW5pcXVlU2x1ZyA9IGAke3ZhbGlkYXRlZERhdGEuc2x1Z30tJHtwLnNsdWcgfHwgcC50aXRsZS50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoL1xccysvZywgJy0nKX0tJHtEYXRlLm5vdygpfS0ke2l9YDtcbiAgICAgICAgICAgICAgICBjb25zdCBwcm9ibGVtID0gYXdhaXQgdHgucHJvYmxlbS5jcmVhdGUoe1xuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogcC50aXRsZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBwLmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGlmZmljdWx0eTogcC5kaWZmaWN1bHR5LFxuICAgICAgICAgICAgICAgICAgICAgICAgc2x1ZzogdW5pcXVlU2x1ZyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3JlOiBwLnNjb3JlIHx8IDEwLFxuICAgICAgICAgICAgICAgICAgICAgICAgZG9tYWluOiBwLmRvbWFpbixcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiQ09OVEVTVFwiLCAvLyBDb250ZXN0IHByb2JsZW1zIGFyZSBtYXJrZWQgc2VwYXJhdGVseVxuICAgICAgICAgICAgICAgICAgICAgICAgaGlkZGVuOiB0cnVlLCAvLyBDb250ZXN0IHByb2JsZW1zIGFyZSBoaWRkZW4gZnJvbSBtYWluIGJhbmtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlc3RDYXNlczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZTogcC50ZXN0Q2FzZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgdGFnczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbm5lY3Q6IHAudGFncz8ubWFwKCh0OiBzdHJpbmcpID0+ICh7IG5hbWU6IHQgfSkpIHx8IFtdLFxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBhd2FpdCB0eC5jb250ZXN0UHJvYmxlbS5jcmVhdGUoe1xuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3QuaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9ibGVtSWQ6IHByb2JsZW0uaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBvcmRlcjogaSxcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gY29udGVzdDtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL2NvbnRlc3RzXCIpO1xuICAgICAgICByZXZhbGlkYXRlUGF0aChcIi9jb250ZXN0c1wiKTtcbiAgICAgICAgcmV2YWxpZGF0ZVBhdGgoXCIvY29udGVzdFwiKTtcbiAgICAgICAgcmV2YWxpZGF0ZVRhZyhcImNvbnRlc3RzXCIsIFwibWF4XCIpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBjb250ZXN0SWQ6IGNvbnRlc3QuaWQgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBjb250ZXN0IHdpdGggcHJvYmxlbXM6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBjcmVhdGUgY29udGVzdFwiIH07XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0SW5zdGl0dXRpb25hbENsYXNzcm9vbXMoaW5zdGl0dXRpb25JZDogc3RyaW5nKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgY2xhc3Nyb29tcyA9IGF3YWl0IHByaXNtYS5jbGFzc3Jvb20uZmluZE1hbnkoe1xuICAgICAgICAgICAgd2hlcmU6IHsgaW5zdGl0dXRpb25JZCB9LFxuICAgICAgICAgICAgc2VsZWN0OiB7IGlkOiB0cnVlLCBuYW1lOiB0cnVlLCBzZWN0aW9uOiB0cnVlIH0sXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBjbGFzc3Jvb21zIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBmZXRjaCBjbGFzc3Jvb21zOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZmV0Y2ggY2xhc3Nyb29tc1wiIH07XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0U2VsZWN0YWJsZVByb2JsZW1zKHNlYXJjaDogc3RyaW5nKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcHJvYmxlbXMgPSBhd2FpdCBwcmlzbWEucHJvYmxlbS5maW5kTWFueSh7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgIE9SOiBbXG4gICAgICAgICAgICAgICAgICAgIHsgdGl0bGU6IHsgY29udGFpbnM6IHNlYXJjaCwgbW9kZTogXCJpbnNlbnNpdGl2ZVwiIH0gfSxcbiAgICAgICAgICAgICAgICAgICAgeyBzbHVnOiB7IGNvbnRhaW5zOiBzZWFyY2gsIG1vZGU6IFwiaW5zZW5zaXRpdmVcIiB9IH0sXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBoaWRkZW46IGZhbHNlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNlbGVjdDogeyBpZDogdHJ1ZSwgdGl0bGU6IHRydWUsIGRpZmZpY3VsdHk6IHRydWUsIHNsdWc6IHRydWUgfSxcbiAgICAgICAgICAgIHRha2U6IDEwLFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgcHJvYmxlbXMgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGZldGNoIHByb2JsZW1zOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZmV0Y2ggcHJvYmxlbXNcIiB9O1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGFjY2VwdENvbnRlc3RSdWxlcyhjb250ZXN0SWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcblxuICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHByaXNtYS5jb250ZXN0UGFydGljaXBhdGlvbi51cHNlcnQoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1cGRhdGU6IHsgYWNjZXB0ZWRSdWxlczogdHJ1ZSB9LFxuICAgICAgICAgICAgY3JlYXRlOiB7XG4gICAgICAgICAgICAgICAgdXNlcklkOiBzZXNzaW9uLnVzZXIuaWQsXG4gICAgICAgICAgICAgICAgY29udGVzdElkOiBjb250ZXN0SWQsXG4gICAgICAgICAgICAgICAgYWNjZXB0ZWRSdWxlczogdHJ1ZVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV2YWxpZGF0ZVBhdGgoYC9jb250ZXN0LyR7Y29udGVzdElkfWApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBhY2NlcHQgcnVsZXNcIiB9O1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGZpbmlzaENvbnRlc3RBY3Rpb24oY29udGVzdElkOiBzdHJpbmcpIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIGlmICghc2Vzc2lvbj8udXNlcikgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG5cbiAgICB0cnkge1xuICAgICAgICBhd2FpdCBwcmlzbWEuY29udGVzdFBhcnRpY2lwYXRpb24udXBzZXJ0KHtcbiAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgdXNlcklkX2NvbnRlc3RJZDoge1xuICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IHNlc3Npb24udXNlci5pZCxcbiAgICAgICAgICAgICAgICAgICAgY29udGVzdElkOiBjb250ZXN0SWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdXBkYXRlOiB7XG4gICAgICAgICAgICAgICAgaXNGaW5pc2hlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBmaW5pc2hlZEF0OiBuZXcgRGF0ZSgpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY3JlYXRlOiB7XG4gICAgICAgICAgICAgICAgdXNlcklkOiBzZXNzaW9uLnVzZXIuaWQsXG4gICAgICAgICAgICAgICAgY29udGVzdElkOiBjb250ZXN0SWQsXG4gICAgICAgICAgICAgICAgYWNjZXB0ZWRSdWxlczogdHJ1ZSxcbiAgICAgICAgICAgICAgICBpc0ZpbmlzaGVkOiB0cnVlLFxuICAgICAgICAgICAgICAgIGZpbmlzaGVkQXQ6IG5ldyBEYXRlKClcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldmFsaWRhdGVQYXRoKGAvY29udGVzdC8ke2NvbnRlc3RJZH1gKTtcbiAgICAgICAgcmV2YWxpZGF0ZVBhdGgoYC9wcm9ibGVtc2ApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBmaW5pc2ggY29udGVzdFwiIH07XG4gICAgfVxufVxuXG4vKipcbiAqIEZpbmFsaXplIENvbnRlc3QgJiBBd2FyZCBCYWRnZXNcbiAqIC0gQ2FsY3VsYXRlcyBsZWFkZXJib2FyZFxuICogLSBBd2FyZHMgR29sZCwgU2lsdmVyLCBCcm9uemUgdG8gVG9wIDNcbiAqIC0gTWFya3MgY29udGVzdCBhcyBmaW5hbGl6ZWRcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGZpbmFsaXplQ29udGVzdChjb250ZXN0SWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcblxuICAgIC8vIE9ubHkgYWRtaW5zIG9yIGNvbnRlc3QgbWFuYWdlcnMgY2FuIGZpbmFsaXplXG4gICAgY29uc3QgY3VycmVudFVzZXIgPSBzZXNzaW9uLnVzZXIgYXMgYW55O1xuICAgIGlmICghW1wiQURNSU5cIiwgXCJDT05URVNUX01BTkFHRVJcIiwgXCJJTlNUSVRVVElPTl9NQU5BR0VSXCIsIFwiVEVBQ0hFUlwiXS5pbmNsdWRlcyhjdXJyZW50VXNlci5yb2xlKSkge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjb250ZXN0ID0gYXdhaXQgcHJpc21hLmNvbnRlc3QuZmluZFVuaXF1ZSh7XG4gICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IGNvbnRlc3RJZCB9LFxuICAgICAgICAgICAgIHNlbGVjdDogeyBpc0ZpbmFsaXplZDogdHJ1ZSwgdGl0bGU6IHRydWUgfVxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoIWNvbnRlc3QpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJDb250ZXN0IG5vdCBmb3VuZFwiIH07XG4gICAgICAgIGlmIChjb250ZXN0LmlzRmluYWxpemVkKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiQ29udGVzdCBpcyBhbHJlYWR5IGZpbmFsaXplZFwiIH07XG5cbiAgICAgICAgLy8gUmV1c2UgbGVhZGVyYm9hcmQgbG9naWMgdG8gZ2V0IHJhbmtpbmdzXG4gICAgICAgIGNvbnN0IGxlYWRlcmJvYXJkID0gYXdhaXQgZ2V0Q29udGVzdExlYWRlcmJvYXJkKGNvbnRlc3RJZCk7XG4gICAgICAgIGlmICghbGVhZGVyYm9hcmQuc3VjY2VzcyB8fCAhbGVhZGVyYm9hcmQuc3R1ZGVudHMpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZmV0Y2ggbGVhZGVyYm9hcmRcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgc3R1ZGVudHMgPSBsZWFkZXJib2FyZC5zdHVkZW50cyBhcyBhbnlbXTtcblxuICAgICAgICAvLyBBdCBsZWFzdCAxIHN0dWRlbnQgbmVlZGVkXG4gICAgICAgIGlmIChzdHVkZW50cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICBhd2FpdCBwcmlzbWEuY29udGVzdC51cGRhdGUoe1xuICAgICAgICAgICAgICAgICB3aGVyZTogeyBpZDogY29udGVzdElkIH0sXG4gICAgICAgICAgICAgICAgIGRhdGE6IHsgaXNGaW5hbGl6ZWQ6IHRydWUgfVxuICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIG1lc3NhZ2U6IFwiQ29udGVzdCBmaW5hbGl6ZWQgKG5vIHBhcnRpY2lwYW50cylcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVG9wIDMgSURzXG4gICAgICAgIGNvbnN0IGdvbGRVc2VySWQgPSBzdHVkZW50c1swXT8uaWQ7XG4gICAgICAgIGNvbnN0IHNpbHZlclVzZXJJZCA9IHN0dWRlbnRzWzFdPy5pZDtcbiAgICAgICAgY29uc3QgYnJvbnplVXNlcklkID0gc3R1ZGVudHNbMl0/LmlkO1xuXG4gICAgICAgIGF3YWl0IHByaXNtYS4kdHJhbnNhY3Rpb24oYXN5bmMgKHR4KSA9PiB7XG4gICAgICAgICAgICAvLyBBd2FyZCBHb2xkXG4gICAgICAgICAgICBpZiAoZ29sZFVzZXJJZCkge1xuICAgICAgICAgICAgICAgIGF3YWl0IHR4LnVzZXIudXBkYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IGdvbGRVc2VySWQgfSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogeyBnb2xkQmFkZ2VzOiB7IGluY3JlbWVudDogMSB9IH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIEF3YXJkIFNpbHZlclxuICAgICAgICAgICAgaWYgKHNpbHZlclVzZXJJZCkge1xuICAgICAgICAgICAgICAgIGF3YWl0IHR4LnVzZXIudXBkYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IHNpbHZlclVzZXJJZCB9LFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7IHNpbHZlckJhZGdlczogeyBpbmNyZW1lbnQ6IDEgfSB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBBd2FyZCBCcm9uemVcbiAgICAgICAgICAgIGlmIChicm9uemVVc2VySWQpIHtcbiAgICAgICAgICAgICAgICBhd2FpdCB0eC51c2VyLnVwZGF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIHdoZXJlOiB7IGlkOiBicm9uemVVc2VySWQgfSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogeyBicm9uemVCYWRnZXM6IHsgaW5jcmVtZW50OiAxIH0gfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBNYXJrIEZpbmFsaXplZFxuICAgICAgICAgICAgYXdhaXQgdHguY29udGVzdC51cGRhdGUoe1xuICAgICAgICAgICAgICAgIHdoZXJlOiB7IGlkOiBjb250ZXN0SWQgfSxcbiAgICAgICAgICAgICAgICBkYXRhOiB7IGlzRmluYWxpemVkOiB0cnVlIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICByZXZhbGlkYXRlUGF0aChgL2Rhc2hib2FyZGApO1xuICAgICAgICByZXZhbGlkYXRlUGF0aChgL3Byb2ZpbGUvJHtnb2xkVXNlcklkfWApO1xuICAgICAgICBpZihzaWx2ZXJVc2VySWQpIHJldmFsaWRhdGVQYXRoKGAvcHJvZmlsZS8ke3NpbHZlclVzZXJJZH1gKTtcbiAgICAgICAgaWYoYnJvbnplVXNlcklkKSByZXZhbGlkYXRlUGF0aChgL3Byb2ZpbGUvJHticm9uemVVc2VySWR9YCk7XG4gICAgICAgIHJldmFsaWRhdGVQYXRoKGAvY29udGVzdC8ke2NvbnRlc3RJZH1gKTtcbiAgICAgICAgcmV2YWxpZGF0ZVRhZyhgY29udGVzdC0ke2NvbnRlc3RJZH1gLCBcIm1heFwiKTtcbiAgICAgICAgcmV2YWxpZGF0ZVRhZyhgbGVhZGVyYm9hcmQtJHtjb250ZXN0SWR9YCwgXCJtYXhcIik7XG5cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gZmluYWxpemUgY29udGVzdDpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGZpbmFsaXplIGNvbnRlc3RcIiB9O1xuICAgIH1cbn1cblxuLyoqXG4gKiBWZXJpZnkgY29udGVzdCBwYXNzd29yZCB3aXRob3V0IHN0YXJ0aW5nIHNlc3Npb24uXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB2ZXJpZnlDb250ZXN0UGFzc3dvcmQoY29udGVzdElkOiBzdHJpbmcsIHBhc3N3b3JkPzogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICBpZiAoIXNlc3Npb24/LnVzZXIpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgY29udGVzdCA9IGF3YWl0IHByaXNtYS5jb250ZXN0LmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IGNvbnRlc3RJZCB9LFxuICAgICAgICAgICAgc2VsZWN0OiB7IGNvbnRlc3RQYXNzd29yZDogdHJ1ZSB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICghY29udGVzdCkgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkNvbnRlc3Qgbm90IGZvdW5kXCIgfTtcblxuICAgICAgICBpZiAoY29udGVzdC5jb250ZXN0UGFzc3dvcmQgJiYgY29udGVzdC5jb250ZXN0UGFzc3dvcmQgIT09IHBhc3N3b3JkKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiSW52YWxpZCBjb250ZXN0IHBhc3N3b3JkXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIHZlcmlmeSBjb250ZXN0IHBhc3N3b3JkOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gdmVyaWZ5IHBhc3N3b3JkXCIgfTtcbiAgICB9XG59XG5cblxuLyoqXG4gKiBTdGFydCBhIGNvbnRlc3Qgc2Vzc2lvbiAtIHZhbGlkYXRlcyB0aW1lIGJvdW5kcyBhbmQgY3JlYXRlcyBzZXNzaW9uIElEXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzdGFydENvbnRlc3RTZXNzaW9uKGNvbnRlc3RJZDogc3RyaW5nLCBwYXNzd29yZD86IHN0cmluZykge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcblxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRlc3QgPSBhd2FpdCBwcmlzbWEuY29udGVzdC5maW5kVW5pcXVlKHtcbiAgICAgICAgICAgIHdoZXJlOiB7IGlkOiBjb250ZXN0SWQgfSxcbiAgICAgICAgICAgIHNlbGVjdDogeyBzdGFydFRpbWU6IHRydWUsIGVuZFRpbWU6IHRydWUsIGNvbnRlc3RQYXNzd29yZDogdHJ1ZSB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICghY29udGVzdCkgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkNvbnRlc3Qgbm90IGZvdW5kXCIgfTtcblxuICAgICAgICBpZiAoY29udGVzdC5jb250ZXN0UGFzc3dvcmQgJiYgY29udGVzdC5jb250ZXN0UGFzc3dvcmQgIT09IHBhc3N3b3JkKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiSW52YWxpZCBjb250ZXN0IHBhc3N3b3JkXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG5cbiAgICAgICAgLy8gVGltZSBib3VuZHMgY2hlY2tcbiAgICAgICAgaWYgKG5vdyA8IGNvbnRlc3Quc3RhcnRUaW1lKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiQ29udGVzdCBoYXMgbm90IHN0YXJ0ZWQgeWV0XCIgfTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobm93ID4gY29udGVzdC5lbmRUaW1lKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiQ29udGVzdCBoYXMgYWxyZWFkeSBlbmRlZFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBHZW5lcmF0ZSB1bmlxdWUgc2Vzc2lvbiBJRFxuICAgICAgICBjb25zdCBzZXNzaW9uSWQgPSBgJHtzZXNzaW9uLnVzZXIuaWR9LSR7Y29udGVzdElkfS0ke0RhdGUubm93KCl9YDtcblxuICAgICAgICAvLyBDaGVjayBmb3IgZXhpc3RpbmcgYWN0aXZlIHNlc3Npb24gKG11bHRpLXRhYiBkZXRlY3Rpb24pXG4gICAgICAgIGNvbnN0IGV4aXN0aW5nUGFydGljaXBhdGlvbiA9IGF3YWl0IHByaXNtYS5jb250ZXN0UGFydGljaXBhdGlvbi5maW5kVW5pcXVlKHtcbiAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgdXNlcklkX2NvbnRlc3RJZDoge1xuICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IHNlc3Npb24udXNlci5pZCxcbiAgICAgICAgICAgICAgICAgICAgY29udGVzdElkOiBjb250ZXN0SWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChleGlzdGluZ1BhcnRpY2lwYXRpb24/LmlzQmxvY2tlZCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIllvdSBoYXZlIGJlZW4gYmxvY2tlZCBmcm9tIHRoaXMgY29udGVzdCBkdWUgdG8gdmlvbGF0aW9uc1wiIH07XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZXhpc3RpbmdQYXJ0aWNpcGF0aW9uPy5pc0ZpbmlzaGVkKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiWW91IGhhdmUgYWxyZWFkeSBmaW5pc2hlZCB0aGlzIGNvbnRlc3RcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVXBkYXRlIG9yIGNyZWF0ZSBwYXJ0aWNpcGF0aW9uIHdpdGggbmV3IHNlc3Npb25cbiAgICAgICAgY29uc3QgcGFydGljaXBhdGlvbiA9IGF3YWl0IHByaXNtYS5jb250ZXN0UGFydGljaXBhdGlvbi51cHNlcnQoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1cGRhdGU6IHtcbiAgICAgICAgICAgICAgICBzZXNzaW9uSWQsXG4gICAgICAgICAgICAgICAgc2Vzc2lvblN0YXJ0ZWRBdDogbm93LFxuICAgICAgICAgICAgICAgIGFjY2VwdGVkUnVsZXM6IHRydWVcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjcmVhdGU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWQ6IHNlc3Npb24udXNlci5pZCxcbiAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZCxcbiAgICAgICAgICAgICAgICBzZXNzaW9uSWQsXG4gICAgICAgICAgICAgICAgc2Vzc2lvblN0YXJ0ZWRBdDogbm93LFxuICAgICAgICAgICAgICAgIGFjY2VwdGVkUnVsZXM6IHRydWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgICBzZXNzaW9uSWQsXG4gICAgICAgICAgICBwYXJ0aWNpcGF0aW9uSWQ6IHBhcnRpY2lwYXRpb24uaWQsXG4gICAgICAgICAgICB0b3RhbFZpb2xhdGlvbnM6IHBhcnRpY2lwYXRpb24udG90YWxWaW9sYXRpb25zLFxuICAgICAgICAgICAgaXNGbGFnZ2VkOiBwYXJ0aWNpcGF0aW9uLmlzRmxhZ2dlZFxuICAgICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gc3RhcnQgY29udGVzdCBzZXNzaW9uOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gc3RhcnQgY29udGVzdCBzZXNzaW9uXCIgfTtcbiAgICB9XG59XG5cbi8qKlxuICogTG9nIGEgY29udGVzdCB2aW9sYXRpb24gLSByZWNvcmRzIHRvIGRhdGFiYXNlIGFuZCB1cGRhdGVzIGNvdW50ZXJzXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBsb2dDb250ZXN0VmlvbGF0aW9uKFxuICAgIGNvbnRlc3RJZDogc3RyaW5nLFxuICAgIHR5cGU6IFwiVEFCX1NXSVRDSFwiIHwgXCJGVUxMU0NSRUVOX0VYSVRcIiB8IFwiQ09QWV9QQVNURVwiIHwgXCJERVZUT09MU19PUEVOXCIgfCBcIktFWUJPQVJEX1NIT1JUQ1VUXCIgfCBcIk5BVklHQVRJT05fQVRURU1QVFwiIHwgXCJNVUxUSV9UQUJcIiB8IFwiU1VTUElDSU9VU19JTlBVVFwiLFxuICAgIG1lc3NhZ2U/OiBzdHJpbmcsXG4gICAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+XG4pIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIGlmICghc2Vzc2lvbj8udXNlcikgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBwYXJ0aWNpcGF0aW9uID0gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKCFwYXJ0aWNpcGF0aW9uKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiTm8gYWN0aXZlIHBhcnRpY2lwYXRpb24gZm91bmRcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gRGV0ZXJtaW5lIHdoaWNoIGNvdW50ZXIgdG8gaW5jcmVtZW50XG4gICAgICAgIGNvbnN0IGNvdW50ZXJGaWVsZCA9IHtcbiAgICAgICAgICAgIFRBQl9TV0lUQ0g6IFwidGFiU3dpdGNoQ291bnRcIixcbiAgICAgICAgICAgIEZVTExTQ1JFRU5fRVhJVDogXCJmdWxsc2NyZWVuRXhpdENvdW50XCIsXG4gICAgICAgICAgICBDT1BZX1BBU1RFOiBcImNvcHlQYXN0ZUNvdW50XCIsXG4gICAgICAgICAgICBERVZUT09MU19PUEVOOiBcImRldlRvb2xzQ291bnRcIixcbiAgICAgICAgICAgIEtFWUJPQVJEX1NIT1JUQ1VUOiBcImtleWJvYXJkQ291bnRcIixcbiAgICAgICAgICAgIE5BVklHQVRJT05fQVRURU1QVDogXCJuYXZpZ2F0aW9uQ291bnRcIixcbiAgICAgICAgICAgIE1VTFRJX1RBQjogXCJ0YWJTd2l0Y2hDb3VudFwiLFxuICAgICAgICAgICAgU1VTUElDSU9VU19JTlBVVDogXCJjb3B5UGFzdGVDb3VudFwiXG4gICAgICAgIH1bdHlwZV0gYXMgc3RyaW5nO1xuXG4gICAgICAgIC8vIFVzZSB0cmFuc2FjdGlvbiB0byBlbnN1cmUgYXRvbWljIHVwZGF0ZVxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBwcmlzbWEuJHRyYW5zYWN0aW9uKGFzeW5jICh0eCkgPT4ge1xuICAgICAgICAgICAgLy8gQ2hlY2sgbGFzdCB2aW9sYXRpb24gdGltZSB0byBwcmV2ZW50IHJhcGlkLWZpcmUgZHVwbGljYXRlcyAoU2VydmVyLXNpZGUgZGVib3VuY2UpXG4gICAgICAgICAgICBjb25zdCBsYXN0VmlvbGF0aW9uID0gYXdhaXQgdHguY29udGVzdFZpb2xhdGlvbi5maW5kRmlyc3Qoe1xuICAgICAgICAgICAgICAgIHdoZXJlOiB7IHBhcnRpY2lwYXRpb25JZDogcGFydGljaXBhdGlvbi5pZCB9LFxuICAgICAgICAgICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnZGVzYycgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmIChsYXN0VmlvbGF0aW9uKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdGltZURpZmYgPSBEYXRlLm5vdygpIC0gbGFzdFZpb2xhdGlvbi5jcmVhdGVkQXQuZ2V0VGltZSgpO1xuICAgICAgICAgICAgICAgIC8vIElmIGxlc3MgdGhhbiAyIHNlY29uZHMgc2luY2UgbGFzdCB2aW9sYXRpb24sIGlnbm9yZSB0aGlzIG9uZVxuICAgICAgICAgICAgICAgIGlmICh0aW1lRGlmZiA8IDIwMDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLnBhcnRpY2lwYXRpb24sIC8vIFJldHVybiBleGlzdGluZyBzdGF0ZVxuICAgICAgICAgICAgICAgICAgICAgICAgaXNGbGFnZ2VkOiBwYXJ0aWNpcGF0aW9uLmlzRmxhZ2dlZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzQmxvY2tlZDogcGFydGljaXBhdGlvbi5pc0Jsb2NrZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICB0b3RhbFZpb2xhdGlvbnM6IHBhcnRpY2lwYXRpb24udG90YWxWaW9sYXRpb25zLFxuICAgICAgICAgICAgICAgICAgICAgICAgcGVybWFuZW50bHlCbG9ja2VkOiBwYXJ0aWNpcGF0aW9uLnBlcm1hbmVudGx5QmxvY2tlZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBCbG9ja2VkVW50aWw6IHBhcnRpY2lwYXRpb24udGVtcEJsb2NrZWRVbnRpbFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQ3JlYXRlIHZpb2xhdGlvbiByZWNvcmRcbiAgICAgICAgICAgIGF3YWl0IHR4LmNvbnRlc3RWaW9sYXRpb24uY3JlYXRlKHtcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIHBhcnRpY2lwYXRpb25JZDogcGFydGljaXBhdGlvbi5pZCxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogdHlwZSBhcyBhbnksXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UsXG4gICAgICAgICAgICAgICAgICAgIG1ldGFkYXRhOiBtZXRhZGF0YSA/PyB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIG5ldyB0b3RhbCBhbmQgZGV0ZXJtaW5lIGJsb2NraW5nIHRpZXJcbiAgICAgICAgICAgIGNvbnN0IG5ld1RvdGFsVmlvbGF0aW9ucyA9IHBhcnRpY2lwYXRpb24udG90YWxWaW9sYXRpb25zICsgMTtcbiAgICAgICAgICAgIGNvbnN0IHNob3VsZEZsYWcgPSBuZXdUb3RhbFZpb2xhdGlvbnMgPj0gMztcblxuICAgICAgICAgICAgLy8gVGllcmVkIGJsb2NraW5nIGxvZ2ljXG4gICAgICAgICAgICBsZXQgdGVtcEJsb2NrZWRVbnRpbDogRGF0ZSB8IG51bGwgPSBudWxsO1xuICAgICAgICAgICAgbGV0IHBlcm1hbmVudGx5QmxvY2tlZCA9IGZhbHNlO1xuICAgICAgICAgICAgbGV0IGlzQmxvY2tlZCA9IGZhbHNlO1xuXG4gICAgICAgICAgICBpZiAobmV3VG90YWxWaW9sYXRpb25zID49IDYpIHtcbiAgICAgICAgICAgICAgICAvLyA2KyB2aW9sYXRpb25zID0gcGVybWFuZW50IGJsb2NrXG4gICAgICAgICAgICAgICAgcGVybWFuZW50bHlCbG9ja2VkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBpc0Jsb2NrZWQgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChuZXdUb3RhbFZpb2xhdGlvbnMgPj0gNCkge1xuICAgICAgICAgICAgICAgIC8vIDQtNSB2aW9sYXRpb25zID0gNSBtaW51dGUgdGVtcCBibG9ja1xuICAgICAgICAgICAgICAgIHRlbXBCbG9ja2VkVW50aWwgPSBuZXcgRGF0ZShEYXRlLm5vdygpICsgNSAqIDYwICogMTAwMCk7IC8vIDUgbWludXRlc1xuICAgICAgICAgICAgICAgIGlzQmxvY2tlZCA9IHRydWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZWQgPSBhd2FpdCB0eC5jb250ZXN0UGFydGljaXBhdGlvbi51cGRhdGUoe1xuICAgICAgICAgICAgICAgIHdoZXJlOiB7IGlkOiBwYXJ0aWNpcGF0aW9uLmlkIH0sXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBbY291bnRlckZpZWxkXTogeyBpbmNyZW1lbnQ6IDEgfSxcbiAgICAgICAgICAgICAgICAgICAgdG90YWxWaW9sYXRpb25zOiB7IGluY3JlbWVudDogMSB9LFxuICAgICAgICAgICAgICAgICAgICBpc0ZsYWdnZWQ6IHNob3VsZEZsYWcgfHwgcGFydGljaXBhdGlvbi5pc0ZsYWdnZWQsXG4gICAgICAgICAgICAgICAgICAgIGlzQmxvY2tlZCxcbiAgICAgICAgICAgICAgICAgICAgdGVtcEJsb2NrZWRVbnRpbCxcbiAgICAgICAgICAgICAgICAgICAgcGVybWFuZW50bHlCbG9ja2VkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiB1cGRhdGVkO1xuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgIHRvdGFsVmlvbGF0aW9uczogcmVzdWx0LnRvdGFsVmlvbGF0aW9ucyxcbiAgICAgICAgICAgIGlzRmxhZ2dlZDogcmVzdWx0LmlzRmxhZ2dlZCxcbiAgICAgICAgICAgIGlzQmxvY2tlZDogcmVzdWx0LmlzQmxvY2tlZCxcbiAgICAgICAgICAgIHRlbXBCbG9ja2VkVW50aWw6IHJlc3VsdC50ZW1wQmxvY2tlZFVudGlsPy50b0lTT1N0cmluZygpIHx8IG51bGwsXG4gICAgICAgICAgICBwZXJtYW5lbnRseUJsb2NrZWQ6IHJlc3VsdC5wZXJtYW5lbnRseUJsb2NrZWRcbiAgICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGxvZyB2aW9sYXRpb246XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBsb2cgdmlvbGF0aW9uXCIgfTtcbiAgICB9XG59XG5cbi8qKlxuICogVmFsaWRhdGUgY29udGVzdCBzZXNzaW9uIC0gY2hlY2tzIGlmIHNlc3Npb24gaXMgdmFsaWQgZm9yIHN1Ym1pc3Npb25zXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB2YWxpZGF0ZUNvbnRlc3RTZXNzaW9uKGNvbnRlc3RJZDogc3RyaW5nLCBzZXNzaW9uSWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgdmFsaWQ6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcGFydGljaXBhdGlvbiA9IGF3YWl0IHByaXNtYS5jb250ZXN0UGFydGljaXBhdGlvbi5maW5kVW5pcXVlKHtcbiAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgdXNlcklkX2NvbnRlc3RJZDoge1xuICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IHNlc3Npb24udXNlci5pZCxcbiAgICAgICAgICAgICAgICAgICAgY29udGVzdElkOiBjb250ZXN0SWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgIGNvbnRlc3Q6IHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0OiB7IHN0YXJ0VGltZTogdHJ1ZSwgZW5kVGltZTogdHJ1ZSB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoIXBhcnRpY2lwYXRpb24pIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHZhbGlkOiBmYWxzZSwgcmVhc29uOiBcIk5vIHBhcnRpY2lwYXRpb24gZm91bmRcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ2hlY2sgaWYgYmxvY2tlZFxuICAgICAgICBpZiAocGFydGljaXBhdGlvbi5pc0Jsb2NrZWQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHZhbGlkOiBmYWxzZSwgcmVhc29uOiBcIkJsb2NrZWQgZHVlIHRvIHZpb2xhdGlvbnNcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ2hlY2sgaWYgZmluaXNoZWRcbiAgICAgICAgaWYgKHBhcnRpY2lwYXRpb24uaXNGaW5pc2hlZCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgdmFsaWQ6IGZhbHNlLCByZWFzb246IFwiQ29udGVzdCBhbHJlYWR5IGZpbmlzaGVkXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENoZWNrIHNlc3Npb24gSUQgKG11bHRpLXRhYiBkZXRlY3Rpb24pXG4gICAgICAgIGlmIChwYXJ0aWNpcGF0aW9uLnNlc3Npb25JZCAhPT0gc2Vzc2lvbklkKSB7XG4gICAgICAgICAgICAvLyBMb2cgbXVsdGktdGFiIHZpb2xhdGlvblxuICAgICAgICAgICAgYXdhaXQgbG9nQ29udGVzdFZpb2xhdGlvbihjb250ZXN0SWQsIFwiTVVMVElfVEFCXCIsIFwiTXVsdGlwbGUgdGFicyBkZXRlY3RlZFwiKTtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHZhbGlkOiBmYWxzZSwgcmVhc29uOiBcIlNlc3Npb24gbWlzbWF0Y2ggLSBwb3NzaWJsZSBtdWx0aXBsZSB0YWJzXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENoZWNrIHRpbWUgYm91bmRzXG4gICAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgICAgIGlmIChub3cgPiBwYXJ0aWNpcGF0aW9uLmNvbnRlc3QuZW5kVGltZSkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgdmFsaWQ6IGZhbHNlLCByZWFzb246IFwiQ29udGVzdCBoYXMgZW5kZWRcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgICB2YWxpZDogdHJ1ZSxcbiAgICAgICAgICAgIHRvdGFsVmlvbGF0aW9uczogcGFydGljaXBhdGlvbi50b3RhbFZpb2xhdGlvbnMsXG4gICAgICAgICAgICBpc0ZsYWdnZWQ6IHBhcnRpY2lwYXRpb24uaXNGbGFnZ2VkXG4gICAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byB2YWxpZGF0ZSBzZXNzaW9uOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCB2YWxpZDogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byB2YWxpZGF0ZSBzZXNzaW9uXCIgfTtcbiAgICB9XG59XG5cbi8qKlxuICogQ2hlY2sgaWYgdXNlciBpcyBlbGlnaWJsZSB0byBzdWJtaXQgLSBwcmUtc3VibWlzc2lvbiB2YWxpZGF0aW9uXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjaGVja1N1Ym1pc3Npb25FbGlnaWJpbGl0eShjb250ZXN0SWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBlbGlnaWJsZTogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBwYXJ0aWNpcGF0aW9uID0gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgY29udGVzdDoge1xuICAgICAgICAgICAgICAgICAgICBzZWxlY3Q6IHsgc3RhcnRUaW1lOiB0cnVlLCBlbmRUaW1lOiB0cnVlIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICghcGFydGljaXBhdGlvbikge1xuICAgICAgICAgICAgcmV0dXJuIHsgZWxpZ2libGU6IGZhbHNlLCByZWFzb246IFwiTm8gcGFydGljaXBhdGlvbiBmb3VuZFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDaGVjayB2YXJpb3VzIGNvbmRpdGlvbnNcbiAgICAgICAgaWYgKHBhcnRpY2lwYXRpb24uaXNCbG9ja2VkKSB7XG4gICAgICAgICAgICByZXR1cm4geyBlbGlnaWJsZTogZmFsc2UsIHJlYXNvbjogXCJCbG9ja2VkIGR1ZSB0byBleGNlc3NpdmUgdmlvbGF0aW9uc1wiIH07XG4gICAgICAgIH1cblxuICAgICAgICBpZiAocGFydGljaXBhdGlvbi5pc0ZpbmlzaGVkKSB7XG4gICAgICAgICAgICByZXR1cm4geyBlbGlnaWJsZTogZmFsc2UsIHJlYXNvbjogXCJZb3UgaGF2ZSBhbHJlYWR5IGZpbmlzaGVkIHRoaXMgY29udGVzdFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICAgICAgICBpZiAobm93IDwgcGFydGljaXBhdGlvbi5jb250ZXN0LnN0YXJ0VGltZSkge1xuICAgICAgICAgICAgcmV0dXJuIHsgZWxpZ2libGU6IGZhbHNlLCByZWFzb246IFwiQ29udGVzdCBoYXMgbm90IHN0YXJ0ZWRcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG5vdyA+IHBhcnRpY2lwYXRpb24uY29udGVzdC5lbmRUaW1lKSB7XG4gICAgICAgICAgICByZXR1cm4geyBlbGlnaWJsZTogZmFsc2UsIHJlYXNvbjogXCJDb250ZXN0IGhhcyBlbmRlZFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZWxpZ2libGU6IHRydWUsXG4gICAgICAgICAgICB3YXJuaW5nczogcGFydGljaXBhdGlvbi5pc0ZsYWdnZWQgPyBbXCJZb3VyIHNlc3Npb24gaGFzIGJlZW4gZmxhZ2dlZCBmb3IgcmV2aWV3XCJdIDogW11cbiAgICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGNoZWNrIGVsaWdpYmlsaXR5OlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IGVsaWdpYmxlOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGNoZWNrIGVsaWdpYmlsaXR5XCIgfTtcbiAgICB9XG59XG5cbi8qKlxuICogR2V0IHBhcnRpY2lwYXRpb24gc3RhdHVzIC0gZm9yIFVJIHN0YXRlXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRQYXJ0aWNpcGF0aW9uU3RhdHVzKGNvbnRlc3RJZDogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICBpZiAoIXNlc3Npb24/LnVzZXIpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcGFydGljaXBhdGlvbiA9IGF3YWl0IHByaXNtYS5jb250ZXN0UGFydGljaXBhdGlvbi5maW5kVW5pcXVlKHtcbiAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgdXNlcklkX2NvbnRlc3RJZDoge1xuICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IHNlc3Npb24udXNlci5pZCxcbiAgICAgICAgICAgICAgICAgICAgY29udGVzdElkOiBjb250ZXN0SWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgYWNjZXB0ZWRSdWxlczogdHJ1ZSxcbiAgICAgICAgICAgICAgICBpc0ZpbmlzaGVkOiB0cnVlLFxuICAgICAgICAgICAgICAgIGlzRmxhZ2dlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBpc0Jsb2NrZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgdG90YWxWaW9sYXRpb25zOiB0cnVlLFxuICAgICAgICAgICAgICAgIHNlc3Npb25JZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICB0ZW1wQmxvY2tlZFVudGlsOiB0cnVlLFxuICAgICAgICAgICAgICAgIHBlcm1hbmVudGx5QmxvY2tlZDogdHJ1ZVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBDaGVjayBpZiB0ZW1wIGJsb2NrIGhhcyBleHBpcmVkXG4gICAgICAgIGlmIChwYXJ0aWNpcGF0aW9uPy50ZW1wQmxvY2tlZFVudGlsICYmIG5ldyBEYXRlKCkgPiBwYXJ0aWNpcGF0aW9uLnRlbXBCbG9ja2VkVW50aWwpIHtcbiAgICAgICAgICAgIC8vIFRlbXAgYmxvY2sgZXhwaXJlZCAtIHVuYmxvY2tcbiAgICAgICAgICAgIGF3YWl0IHByaXNtYS5jb250ZXN0UGFydGljaXBhdGlvbi51cGRhdGUoe1xuICAgICAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZF9jb250ZXN0SWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGVzdElkOiBjb250ZXN0SWRcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBpc0Jsb2NrZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wQmxvY2tlZFVudGlsOiBudWxsXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgICAgICBwYXJ0aWNpcGF0aW9uOiB7XG4gICAgICAgICAgICAgICAgICAgIC4uLnBhcnRpY2lwYXRpb24sXG4gICAgICAgICAgICAgICAgICAgIGlzQmxvY2tlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBCbG9ja2VkVW50aWw6IG51bGxcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgICBwYXJ0aWNpcGF0aW9uOiBwYXJ0aWNpcGF0aW9uIHx8IG51bGxcbiAgICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGdldCBwYXJ0aWNpcGF0aW9uIHN0YXR1c1wiIH07XG4gICAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gQ09OVEVTVCBNQU5BR0VSIC0gUEFSVElDSVBBTlQgTUFOQUdFTUVOVFxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLyoqXG4gKiBHZXQgYWxsIHBhcnRpY2lwYW50cyBmb3IgYSBjb250ZXN0IHdpdGggdmlvbGF0aW9uIGRldGFpbHMgKGZvciBtYW5hZ2VycylcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldENvbnRlc3RQYXJ0aWNpcGFudHMoY29udGVzdElkOiBzdHJpbmcpIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIGlmICghc2Vzc2lvbj8udXNlcikgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG5cbiAgICBjb25zdCBjdXJyZW50VXNlciA9IHNlc3Npb24udXNlciBhcyBhbnk7XG5cbiAgICAvLyBDaGVjayBpZiB1c2VyIGlzIGNvbnRlc3QgbWFuYWdlci9jcmVhdG9yXG4gICAgY29uc3QgY29udGVzdCA9IGF3YWl0IHByaXNtYS5jb250ZXN0LmZpbmRVbmlxdWUoe1xuICAgICAgICB3aGVyZTogeyBpZDogY29udGVzdElkIH0sXG4gICAgICAgIHNlbGVjdDogeyBjcmVhdG9ySWQ6IHRydWUgfVxuICAgIH0pO1xuXG4gICAgaWYgKCFjb250ZXN0KSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiQ29udGVzdCBub3QgZm91bmRcIiB9O1xuXG4gICAgY29uc3QgaXNBdXRob3JpemVkID1cbiAgICAgICAgY3VycmVudFVzZXIucm9sZSA9PT0gXCJBRE1JTlwiIHx8XG4gICAgICAgIGN1cnJlbnRVc2VyLnJvbGUgPT09IFwiQ09OVEVTVF9NQU5BR0VSXCIgfHxcbiAgICAgICAgY3VycmVudFVzZXIucm9sZSA9PT0gXCJURUFDSEVSXCIgfHxcbiAgICAgICAgY29udGVzdC5jcmVhdG9ySWQgPT09IGN1cnJlbnRVc2VyLmlkO1xuXG4gICAgaWYgKCFpc0F1dGhvcml6ZWQpIHtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcGFydGljaXBhbnRzID0gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLmZpbmRNYW55KHtcbiAgICAgICAgICAgIHdoZXJlOiB7IGNvbnRlc3RJZCB9LFxuICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBlbWFpbDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGltYWdlOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHZpb2xhdGlvbnM6IHtcbiAgICAgICAgICAgICAgICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6IFwiZGVzY1wiIH0sXG4gICAgICAgICAgICAgICAgICAgIHRha2U6IDEwXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9yZGVyQnk6IFtcbiAgICAgICAgICAgICAgICB7IHBlcm1hbmVudGx5QmxvY2tlZDogXCJkZXNjXCIgfSxcbiAgICAgICAgICAgICAgICB7IGlzQmxvY2tlZDogXCJkZXNjXCIgfSxcbiAgICAgICAgICAgICAgICB7IHRvdGFsVmlvbGF0aW9uczogXCJkZXNjXCIgfVxuICAgICAgICAgICAgXVxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBwYXJ0aWNpcGFudHMgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGdldCBwYXJ0aWNpcGFudHM6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBnZXQgcGFydGljaXBhbnRzXCIgfTtcbiAgICB9XG59XG5cbi8qKlxuICogVW5ibG9jayBhIHBhcnRpY2lwYW50IChtYW5hZ2VyIG9ubHkpXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1bmJsb2NrUGFydGljaXBhbnQoY29udGVzdElkOiBzdHJpbmcsIHVzZXJJZDogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICBpZiAoIXNlc3Npb24/LnVzZXIpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuXG4gICAgY29uc3QgY3VycmVudFVzZXIgPSBzZXNzaW9uLnVzZXIgYXMgYW55O1xuXG4gICAgLy8gQ2hlY2sgYXV0aG9yaXphdGlvblxuICAgIGNvbnN0IGNvbnRlc3QgPSBhd2FpdCBwcmlzbWEuY29udGVzdC5maW5kVW5pcXVlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6IGNvbnRlc3RJZCB9LFxuICAgICAgICBzZWxlY3Q6IHsgY3JlYXRvcklkOiB0cnVlIH1cbiAgICB9KTtcblxuICAgIGlmICghY29udGVzdCkgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkNvbnRlc3Qgbm90IGZvdW5kXCIgfTtcblxuICAgIGNvbnN0IGlzQXV0aG9yaXplZCA9XG4gICAgICAgIGN1cnJlbnRVc2VyLnJvbGUgPT09IFwiQURNSU5cIiB8fFxuICAgICAgICBjdXJyZW50VXNlci5yb2xlID09PSBcIkNPTlRFU1RfTUFOQUdFUlwiIHx8XG4gICAgICAgIGN1cnJlbnRVc2VyLnJvbGUgPT09IFwiVEVBQ0hFUlwiIHx8XG4gICAgICAgIGNvbnRlc3QuY3JlYXRvcklkID09PSBjdXJyZW50VXNlci5pZDtcblxuICAgIGlmICghaXNBdXRob3JpemVkKSB7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHByaXNtYS5jb250ZXN0UGFydGljaXBhdGlvbi51cGRhdGUoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgY29udGVzdElkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICBpc0Jsb2NrZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHRlbXBCbG9ja2VkVW50aWw6IG51bGwsXG4gICAgICAgICAgICAgICAgcGVybWFuZW50bHlCbG9ja2VkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICB0b3RhbFZpb2xhdGlvbnM6IDAsXG4gICAgICAgICAgICAgICAgdGFiU3dpdGNoQ291bnQ6IDAsXG4gICAgICAgICAgICAgICAgZnVsbHNjcmVlbkV4aXRDb3VudDogMCxcbiAgICAgICAgICAgICAgICBjb3B5UGFzdGVDb3VudDogMCxcbiAgICAgICAgICAgICAgICBkZXZUb29sc0NvdW50OiAwLFxuICAgICAgICAgICAgICAgIGtleWJvYXJkQ291bnQ6IDAsXG4gICAgICAgICAgICAgICAgbmF2aWdhdGlvbkNvdW50OiAwLFxuICAgICAgICAgICAgICAgIGlzRmxhZ2dlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgdW5ibG9ja2VkQnk6IGN1cnJlbnRVc2VyLmlkLFxuICAgICAgICAgICAgICAgIHVuYmxvY2tlZEF0OiBuZXcgRGF0ZSgpXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldmFsaWRhdGVQYXRoKGAvZGFzaGJvYXJkL2NvbnRlc3RzLyR7Y29udGVzdElkfS9wYXJ0aWNpcGFudHNgKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gdW5ibG9jayBwYXJ0aWNpcGFudDpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIHVuYmxvY2sgcGFydGljaXBhbnRcIiB9O1xuICAgIH1cbn1cblxuLyoqXG4gKiBHZXQgZGV0YWlsZWQgdmlvbGF0aW9ucyBmb3IgYSBwYXJ0aWNpcGFudFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0UGFydGljaXBhbnRWaW9sYXRpb25zKGNvbnRlc3RJZDogc3RyaW5nLCB1c2VySWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcblxuICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gc2Vzc2lvbi51c2VyIGFzIGFueTtcblxuICAgIC8vIENoZWNrIGF1dGhvcml6YXRpb25cbiAgICBjb25zdCBjb250ZXN0ID0gYXdhaXQgcHJpc21hLmNvbnRlc3QuZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiBjb250ZXN0SWQgfSxcbiAgICAgICAgc2VsZWN0OiB7IGNyZWF0b3JJZDogdHJ1ZSB9XG4gICAgfSk7XG5cbiAgICBpZiAoIWNvbnRlc3QpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJDb250ZXN0IG5vdCBmb3VuZFwiIH07XG5cbiAgICBjb25zdCBpc0F1dGhvcml6ZWQgPVxuICAgICAgICBjdXJyZW50VXNlci5yb2xlID09PSBcIkFETUlOXCIgfHxcbiAgICAgICAgY3VycmVudFVzZXIucm9sZSA9PT0gXCJDT05URVNUX01BTkFHRVJcIiB8fFxuICAgICAgICBjdXJyZW50VXNlci5yb2xlID09PSBcIlRFQUNIRVJcIiB8fFxuICAgICAgICBjb250ZXN0LmNyZWF0b3JJZCA9PT0gY3VycmVudFVzZXIuaWQ7XG5cbiAgICBpZiAoIWlzQXV0aG9yaXplZCkge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBwYXJ0aWNpcGF0aW9uID0gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgY29udGVzdElkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdDogeyBpZDogdHJ1ZSwgbmFtZTogdHJ1ZSwgZW1haWw6IHRydWUgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgdmlvbGF0aW9uczoge1xuICAgICAgICAgICAgICAgICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogXCJkZXNjXCIgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgcGFydGljaXBhdGlvbiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZ2V0IHZpb2xhdGlvbnNcIiB9O1xuICAgIH1cbn1cblxuLyoqXG4gKiBDYWxjdWxhdGUgY29udGVzdCBsZWFkZXJib2FyZFxuICogLSBGZXRjaGVzIGFsbCBwYXJ0aWNpcGF0aW9uc1xuICogLSBGZXRjaGVzIGFsbCByZWxldmFudCBzdWJtaXNzaW9uc1xuICogLSBDYWxjdWxhdGVzIHNjb3Jlc1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q29udGVzdExlYWRlcmJvYXJkKGNvbnRlc3RJZDogc3RyaW5nKSB7XG4gICAgXCJ1c2UgY2FjaGVcIlxuICAgIGNhY2hlVGFnKGBsZWFkZXJib2FyZC0ke2NvbnRlc3RJZH1gKVxuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBjYWNoZUxpZmUoXCJsZWFkZXJib2FyZFwiKVxuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcGFydGljaXBhdGlvbnMgPSBhd2FpdCBwcmlzbWEuY29udGVzdFBhcnRpY2lwYXRpb24uZmluZE1hbnkoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICBjb250ZXN0SWQsXG4gICAgICAgICAgICAgICAgLy8gc3RhcnRlZEF0OiB7IG5vdDogbnVsbCB9IC8vIE9ubHkgc3RhcnRlZCBwYXJ0aWNpcGFudHMgKEZpeCBpZiBmaWVsZCBleGlzdHMsIG90aGVyd2lzZSByZWx5IG9uIGNyZWF0ZWQpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBpbWFnZTogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBjb250ZXN0ID0gYXdhaXQgcHJpc21hLmNvbnRlc3QuZmluZFVuaXF1ZSh7XG4gICAgICAgICAgICB3aGVyZTogeyBpZDogY29udGVzdElkIH0sXG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgcHJvYmxlbXM6IHtcbiAgICAgICAgICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJvYmxlbToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpZmZpY3VsdHk6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNsdWc6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3JlOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBvcmRlckJ5OiB7IG9yZGVyOiBcImFzY1wiIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICghY29udGVzdCkgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkNvbnRlc3Qgbm90IGZvdW5kXCIgfTtcblxuICAgICAgICBjb25zdCBsZWFkZXJib2FyZCA9IGF3YWl0IFByb21pc2UuYWxsKHBhcnRpY2lwYXRpb25zLm1hcChhc3luYyAocCkgPT4ge1xuICAgICAgICAgICAgLy8gR2V0IHZhbGlkIHN1Ym1pc3Npb25zIGZvciB0aGlzIHVzZXIgaW4gdGhpcyBjb250ZXN0XG4gICAgICAgICAgICBjb25zdCBzdWJtaXNzaW9ucyA9IGF3YWl0IHByaXNtYS5zdWJtaXNzaW9uLmZpbmRNYW55KHtcbiAgICAgICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IHAudXNlcklkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZCxcbiAgICAgICAgICAgICAgICAgICAgY3JlYXRlZEF0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBndGU6IGNvbnRlc3Quc3RhcnRUaW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgbHRlOiBjb250ZXN0LmVuZFRpbWVcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHByb2JsZW1JZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgY3JlYXRlZEF0OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBsYW5ndWFnZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSB0b3RhbCBzY29yZVxuICAgICAgICAgICAgLy8gTG9naWM6IEJlc3Qgc3VibWlzc2lvbiBwZXIgcHJvYmxlbSBjb3VudHNcbiAgICAgICAgICAgIGNvbnN0IHByb2JsZW1TY29yZXMgPSBuZXcgTWFwPHN0cmluZywgbnVtYmVyPigpO1xuICAgICAgICAgICAgY29uc3QgcHJvYmxlbVNvbHZlVGltZXMgPSBuZXcgTWFwPHN0cmluZywgRGF0ZT4oKTtcbiAgICAgICAgICAgIGNvbnN0IHByb2JsZW1TdWJtaXNzaW9uQ291bnRzID0gbmV3IE1hcDxzdHJpbmcsIG51bWJlcj4oKTtcbiAgICAgICAgICAgIGNvbnN0IHByb2JsZW1CZXN0U3VibWlzc2lvbnMgPSBuZXcgTWFwPHN0cmluZywgYW55PigpO1xuXG4gICAgICAgICAgICBzdWJtaXNzaW9ucy5mb3JFYWNoKHN1YiA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgY3VycmVudENvdW50ID0gcHJvYmxlbVN1Ym1pc3Npb25Db3VudHMuZ2V0KHN1Yi5wcm9ibGVtSWQpIHx8IDA7XG4gICAgICAgICAgICAgICAgcHJvYmxlbVN1Ym1pc3Npb25Db3VudHMuc2V0KHN1Yi5wcm9ibGVtSWQsIGN1cnJlbnRDb3VudCArIDEpO1xuXG4gICAgICAgICAgICAgICAgaWYgKHN1Yi5zdGF0dXMgPT09IFwiQUNDRVBURURcIikge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50QmVzdCA9IHByb2JsZW1TY29yZXMuZ2V0KHN1Yi5wcm9ibGVtSWQpIHx8IDA7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb2JsZW1EZWYgPSBjb250ZXN0LnByb2JsZW1zLmZpbmQoY3AgPT4gY3AucHJvYmxlbUlkID09PSBzdWIucHJvYmxlbUlkKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWF4U2NvcmUgPSBwcm9ibGVtRGVmPy5wcm9ibGVtLnNjb3JlIHx8IDA7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKG1heFNjb3JlID4gY3VycmVudEJlc3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICBwcm9ibGVtU2NvcmVzLnNldChzdWIucHJvYmxlbUlkLCBtYXhTY29yZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudEJlc3RUaW1lID0gcHJvYmxlbVNvbHZlVGltZXMuZ2V0KHN1Yi5wcm9ibGVtSWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghY3VycmVudEJlc3RUaW1lIHx8IHN1Yi5jcmVhdGVkQXQgPCBjdXJyZW50QmVzdFRpbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvYmxlbVNvbHZlVGltZXMuc2V0KHN1Yi5wcm9ibGVtSWQsIHN1Yi5jcmVhdGVkQXQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9ibGVtQmVzdFN1Ym1pc3Npb25zLnNldChzdWIucHJvYmxlbUlkLCBzdWIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBsZXQgdG90YWxTY29yZSA9IDA7XG4gICAgICAgICAgICBsZXQgdG90YWxUaW1lTXMgPSAwO1xuXG4gICAgICAgICAgICBwcm9ibGVtU2NvcmVzLmZvckVhY2goKHNjb3JlLCBwcm9ibGVtSWQpID0+IHtcbiAgICAgICAgICAgICAgICB0b3RhbFNjb3JlICs9IHNjb3JlO1xuICAgICAgICAgICAgICAgIGNvbnN0IHNvbHZlbnRUaW1lID0gcHJvYmxlbVNvbHZlVGltZXMuZ2V0KHByb2JsZW1JZCk7XG4gICAgICAgICAgICAgICAgaWYgKHNvbHZlbnRUaW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIHRvdGFsVGltZU1zICs9IChzb2x2ZW50VGltZS5nZXRUaW1lKCkgLSBjb250ZXN0LnN0YXJ0VGltZS5nZXRUaW1lKCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBNYXAgc3RhdHMgZm9yIGVhY2ggcHJvYmxlbSBpbiB0aGUgY29udGVzdFxuICAgICAgICAgICAgY29uc3QgcHJvYmxlbVN0YXRzID0gY29udGVzdC5wcm9ibGVtcy5tYXAoY3AgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGJlc3RTdWIgPSBwcm9ibGVtQmVzdFN1Ym1pc3Npb25zLmdldChjcC5wcm9ibGVtSWQpO1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIHByb2JsZW1JZDogY3AucHJvYmxlbUlkLFxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogY3AucHJvYmxlbS50aXRsZSxcbiAgICAgICAgICAgICAgICAgICAgc2x1ZzogY3AucHJvYmxlbS5zbHVnLFxuICAgICAgICAgICAgICAgICAgICBzY29yZTogcHJvYmxlbVNjb3Jlcy5nZXQoY3AucHJvYmxlbUlkKSB8fCAwLFxuICAgICAgICAgICAgICAgICAgICBtYXhTY29yZTogY3AucHJvYmxlbS5zY29yZSxcbiAgICAgICAgICAgICAgICAgICAgc3VibWlzc2lvbnM6IHByb2JsZW1TdWJtaXNzaW9uQ291bnRzLmdldChjcC5wcm9ibGVtSWQpIHx8IDAsXG4gICAgICAgICAgICAgICAgICAgIHNvbHZlZDogcHJvYmxlbVNjb3Jlcy5oYXMoY3AucHJvYmxlbUlkKSxcbiAgICAgICAgICAgICAgICAgICAgc29sdmVkQXQ6IHByb2JsZW1Tb2x2ZVRpbWVzLmdldChjcC5wcm9ibGVtSWQpLFxuICAgICAgICAgICAgICAgICAgICBsYW5ndWFnZTogYmVzdFN1Yj8ubGFuZ3VhZ2U/Lm5hbWUgfHwgbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgbGFuZ3VhZ2VJZDogYmVzdFN1Yj8ubGFuZ3VhZ2U/LmlkIHx8IG51bGxcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgLi4ucC51c2VyLFxuICAgICAgICAgICAgICAgIHNjb3JlOiB0b3RhbFNjb3JlLFxuICAgICAgICAgICAgICAgIHRpbWVUYWtlbjogdG90YWxUaW1lTXMsXG4gICAgICAgICAgICAgICAgcHJvYmxlbXNTb2x2ZWQ6IHByb2JsZW1TY29yZXMuc2l6ZSxcbiAgICAgICAgICAgICAgICBwcm9ibGVtU3RhdHNcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pKTtcblxuICAgICAgICAvLyBTb3J0OiBIaWdoIHNjb3JlIGZpcnN0LCB0aGVuIGxvdyB0aW1lIHRha2VuXG4gICAgICAgIGxlYWRlcmJvYXJkLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgICAgICAgIGlmIChiLnNjb3JlICE9PSBhLnNjb3JlKSByZXR1cm4gYi5zY29yZSAtIGEuc2NvcmU7XG4gICAgICAgICAgICByZXR1cm4gYS50aW1lVGFrZW4gLSBiLnRpbWVUYWtlbjtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgICBzdHVkZW50czogbGVhZGVyYm9hcmQsXG4gICAgICAgICAgICBpc0ZpbmFsaXplZDogY29udGVzdC5pc0ZpbmFsaXplZCxcbiAgICAgICAgICAgIHByb2JsZW1zOiBjb250ZXN0LnByb2JsZW1zLm1hcChjcCA9PiAoe1xuICAgICAgICAgICAgICAgIGlkOiBjcC5wcm9ibGVtSWQsXG4gICAgICAgICAgICAgICAgdGl0bGU6IGNwLnByb2JsZW0udGl0bGUsXG4gICAgICAgICAgICAgICAgc2x1ZzogY3AucHJvYmxlbS5zbHVnLFxuICAgICAgICAgICAgICAgIG1heFNjb3JlOiBjcC5wcm9ibGVtLnNjb3JlXG4gICAgICAgICAgICB9KSlcbiAgICAgICAgfTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJMZWFkZXJib2FyZCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGdlbmVyYXRlIGxlYWRlcmJvYXJkXCIgfTtcbiAgICB9XG59XG5cbi8qKlxuICogR2V0IGN1cnJlbnQgdXNlcidzIHJhbmtpbmcgaW4gYSBjb250ZXN0XG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRDb250ZXN0UmFua2luZyhjb250ZXN0SWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcblxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGdldENvbnRlc3RMZWFkZXJib2FyZChjb250ZXN0SWQpO1xuXG4gICAgICAgIGlmICghcmVzdWx0LnN1Y2Nlc3MgfHwgIXJlc3VsdC5zdHVkZW50cykge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBnZXQgcmFua2luZ1wiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCByYW5rID0gcmVzdWx0LnN0dWRlbnRzLmZpbmRJbmRleCgoczogYW55KSA9PiBzLmlkID09PSBzZXNzaW9uLnVzZXIuaWQpICsgMTtcblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCByYW5rOiByYW5rID4gMCA/IHJhbmsgOiBudWxsIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZ2V0IHJhbmtpbmdcIiB9O1xuICAgIH1cbn1cbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiaVNBbW9Cc0IifQ==
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/components/contest/ContestEntryModal.tsx [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "default",
    ()=>ContestEntryModal
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/jsx-dev-runtime.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/index.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$shield$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Shield$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/shield.js [app-client] (ecmascript) <export default as Shield>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$monitor$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Monitor$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/monitor.js [app-client] (ecmascript) <export default as Monitor>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$eye$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Eye$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/eye.js [app-client] (ecmascript) <export default as Eye>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$keyboard$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Keyboard$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/keyboard.js [app-client] (ecmascript) <export default as Keyboard>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$arrow$2d$right$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__ArrowRight$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/arrow-right.js [app-client] (ecmascript) <export default as ArrowRight>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$check$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Check$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/check.js [app-client] (ecmascript) <export default as Check>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$lock$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Lock$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/lock.js [app-client] (ecmascript) <export default as Lock>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$x$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__X$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/x.js [app-client] (ecmascript) <export default as X>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$chevron$2d$left$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__ChevronLeft$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/chevron-left.js [app-client] (ecmascript) <export default as ChevronLeft>");
var __TURBOPACK__imported__module__$5b$project$5d2f$actions$2f$data$3a$1d6c22__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__ = __turbopack_context__.i("[project]/actions/data:1d6c22 [app-client] (ecmascript) <text/javascript>");
var __TURBOPACK__imported__module__$5b$project$5d2f$actions$2f$data$3a$93d28e__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__ = __turbopack_context__.i("[project]/actions/data:93d28e [app-client] (ecmascript) <text/javascript>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/sonner/dist/index.mjs [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$utils$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/utils.ts [app-client] (ecmascript)");
;
var _s = __turbopack_context__.k.signature();
"use client";
;
;
;
;
;
const RULES = [
    {
        icon: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$monitor$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Monitor$3e$__["Monitor"],
        title: "Fullscreen Enforced",
        description: "The contest runs in fullscreen. Exiting may be flagged."
    },
    {
        icon: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$eye$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Eye$3e$__["Eye"],
        title: "Focus Tracking",
        description: "Tab switching and window blurring are monitored."
    },
    {
        icon: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$keyboard$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Keyboard$3e$__["Keyboard"],
        title: "Input Restricted",
        description: "Copy-paste and developer tools are disabled."
    },
    {
        icon: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$shield$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Shield$3e$__["Shield"],
        title: "Proctored Environment",
        description: "suspicious activity is logged for review."
    }
];
function ContestEntryModal({ contestId, contestTitle, requiresPassword, isOpen, onClose, onStart }) {
    _s();
    const [isLoading, setIsLoading] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(false);
    const [step, setStep] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])("RULES");
    const [password, setPassword] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])("");
    const [agreed, setAgreed] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(false);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "ContestEntryModal.useEffect": ()=>{
            if (isOpen) {
                if (requiresPassword) {
                    setStep("PASSWORD");
                } else {
                    setStep("RULES");
                }
                setAgreed(false);
                setPassword("");
                setIsLoading(false);
            }
        }
    }["ContestEntryModal.useEffect"], [
        isOpen,
        requiresPassword
    ]);
    const handleVerifyPassword = async ()=>{
        if (!password) {
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error("Enter the contest password");
            return;
        }
        setIsLoading(true);
        try {
            const result = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$actions$2f$data$3a$93d28e__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__["verifyContestPassword"])(contestId, password);
            if (result.success) {
                setStep("RULES");
                __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].success("Access granted");
            } else {
                __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error(result.error || "Incorrect password");
            }
        } catch  {
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error("Verification failed");
        } finally{
            setIsLoading(false);
        }
    };
    const handleStartContest = async ()=>{
        if (!agreed) return;
        setIsLoading(true);
        try {
            const result = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$actions$2f$data$3a$1d6c22__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__["startContestSession"])(contestId, password);
            if (!result.success) {
                __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error(result.error || "Could not start session");
                setIsLoading(false);
                return;
            }
            try {
                await document.documentElement.requestFullscreen();
            } catch (e) {
                console.warn("Fullscreen failed", e);
            }
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].success("Good luck!");
            onStart(result.sessionId);
        } catch  {
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error("Failed to initialize contest");
            setIsLoading(false);
        }
    };
    if (!isOpen) return null;
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        className: "fixed inset-0 z-[9999] flex items-center justify-center p-4",
        children: [
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "absolute inset-0 bg-white/80 dark:bg-black/80 backdrop-blur-md transition-opacity",
                onClick: onClose
            }, void 0, false, {
                fileName: "[project]/components/contest/ContestEntryModal.tsx",
                lineNumber: 130,
                columnNumber: 7
            }, this),
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "relative bg-white dark:bg-[#0a0a0a] w-full max-w-md rounded-3xl shadow-2xl border border-gray-100 dark:border-[#262626] overflow-hidden animate-in fade-in zoom-in-95 duration-200",
                children: [
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "px-8 pt-8 flex items-center justify-between",
                        children: [
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                className: "flex gap-2",
                                children: [
                                    1,
                                    2,
                                    3
                                ].map((i)=>{
                                    // Calculate current step index
                                    let currentStepIdx = 0;
                                    if (requiresPassword) {
                                        if (step === "PASSWORD") currentStepIdx = 1;
                                        if (step === "RULES") currentStepIdx = 2;
                                        if (step === "CONFIRM") currentStepIdx = 3;
                                    } else {
                                        if (step === "RULES") currentStepIdx = 1; // Actually step 1 visually
                                        if (step === "CONFIRM") currentStepIdx = 2;
                                    }
                                    // Normalizing because map index is simple
                                    // If requiresPassword: Steps are Pass(1), Rules(2), Confirm(3)
                                    // If not: Rules(1), Confirm(2) -> effectively 2 steps visually
                                    const totalSteps = requiresPassword ? 3 : 2;
                                    if (i > totalSteps) return null;
                                    let isActive = false;
                                    if (requiresPassword) {
                                        if (i === 1 && step === "PASSWORD") isActive = true;
                                        if (i === 2 && step === "RULES") isActive = true;
                                        if (i === 3 && step === "CONFIRM") isActive = true;
                                    } else {
                                        if (i === 1 && step === "RULES") isActive = true;
                                        if (i === 2 && step === "CONFIRM") isActive = true;
                                    }
                                    const isCompleted = requiresPassword ? i === 1 && step !== "PASSWORD" || i === 2 && step === "CONFIRM" : i === 1 && step === "CONFIRM";
                                    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$utils$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["cn"])("h-1 rounded-full transition-all duration-300", isActive ? "w-8 bg-orange-600" : isCompleted ? "w-2 bg-orange-200 dark:bg-orange-900" : "w-2 bg-gray-100 dark:bg-[#262626]")
                                    }, i, false, {
                                        fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                        lineNumber: 174,
                                        columnNumber: 17
                                    }, this);
                                })
                            }, void 0, false, {
                                fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                lineNumber: 140,
                                columnNumber: 11
                            }, this),
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                onClick: onClose,
                                className: "p-2 -mr-2 text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors",
                                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$x$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__X$3e$__["X"], {
                                    className: "w-5 h-5"
                                }, void 0, false, {
                                    fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                    lineNumber: 185,
                                    columnNumber: 13
                                }, this)
                            }, void 0, false, {
                                fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                lineNumber: 184,
                                columnNumber: 11
                            }, this)
                        ]
                    }, void 0, true, {
                        fileName: "[project]/components/contest/ContestEntryModal.tsx",
                        lineNumber: 139,
                        columnNumber: 9
                    }, this),
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "p-8 min-h-[400px] flex flex-col",
                        children: [
                            step === "PASSWORD" && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                className: "flex-1 flex flex-col animate-in slide-in-from-right-8 duration-300",
                                children: [
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "mb-8",
                                        children: [
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                className: "w-12 h-12 bg-gray-50 dark:bg-[#1a1a1a] rounded-2xl flex items-center justify-center mb-6",
                                                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$lock$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Lock$3e$__["Lock"], {
                                                    className: "w-6 h-6 text-gray-900 dark:text-white"
                                                }, void 0, false, {
                                                    fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                    lineNumber: 195,
                                                    columnNumber: 21
                                                }, this)
                                            }, void 0, false, {
                                                fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                lineNumber: 194,
                                                columnNumber: 17
                                            }, this),
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("h2", {
                                                className: "text-2xl font-bold text-gray-900 dark:text-white mb-2",
                                                children: "Private Contest"
                                            }, void 0, false, {
                                                fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                lineNumber: 197,
                                                columnNumber: 17
                                            }, this),
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                                className: "text-gray-500 dark:text-gray-400",
                                                children: "Enter the access code to join."
                                            }, void 0, false, {
                                                fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                lineNumber: 198,
                                                columnNumber: 17
                                            }, this)
                                        ]
                                    }, void 0, true, {
                                        fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                        lineNumber: 193,
                                        columnNumber: 15
                                    }, this),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "space-y-4",
                                        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("input", {
                                            type: "password",
                                            value: password,
                                            onChange: (e)=>setPassword(e.target.value),
                                            onKeyDown: (e)=>e.key === "Enter" && handleVerifyPassword(),
                                            placeholder: "Password",
                                            autoFocus: true,
                                            className: "w-full bg-gray-50 dark:bg-[#141414] border-gray-200 dark:border-[#262626] rounded-xl px-4 py-4 text-center text-2xl font-bold tracking-widest focus:ring-2 focus:ring-orange-500/20 focus:border-orange-500 outline-none transition-all placeholder:text-gray-300 dark:text-white dark:placeholder:text-gray-700"
                                        }, void 0, false, {
                                            fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                            lineNumber: 202,
                                            columnNumber: 17
                                        }, this)
                                    }, void 0, false, {
                                        fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                        lineNumber: 201,
                                        columnNumber: 15
                                    }, this),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "mt-auto pt-8",
                                        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                            onClick: handleVerifyPassword,
                                            disabled: !password || isLoading,
                                            className: "w-full bg-gray-900 dark:bg-white text-white dark:text-black py-4 rounded-xl font-bold text-sm tracking-wide hover:opacity-90 transition-opacity disabled:opacity-50 flex items-center justify-center gap-2",
                                            children: [
                                                isLoading ? "Verifying..." : "Continue",
                                                !isLoading && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$arrow$2d$right$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__ArrowRight$3e$__["ArrowRight"], {
                                                    className: "w-4 h-4"
                                                }, void 0, false, {
                                                    fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                    lineNumber: 220,
                                                    columnNumber: 36
                                                }, this)
                                            ]
                                        }, void 0, true, {
                                            fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                            lineNumber: 214,
                                            columnNumber: 17
                                        }, this)
                                    }, void 0, false, {
                                        fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                        lineNumber: 213,
                                        columnNumber: 15
                                    }, this)
                                ]
                            }, void 0, true, {
                                fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                lineNumber: 192,
                                columnNumber: 13
                            }, this),
                            step === "RULES" && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                className: "flex-1 flex flex-col animate-in slide-in-from-right-8 duration-300",
                                children: [
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "mb-8",
                                        children: [
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("h2", {
                                                className: "text-2xl font-bold text-gray-900 dark:text-white mb-2",
                                                children: "Contest Rules"
                                            }, void 0, false, {
                                                fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                lineNumber: 230,
                                                columnNumber: 18
                                            }, this),
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                                className: "text-gray-500 dark:text-gray-400",
                                                children: "Strict proctoring is active."
                                            }, void 0, false, {
                                                fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                lineNumber: 231,
                                                columnNumber: 18
                                            }, this)
                                        ]
                                    }, void 0, true, {
                                        fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                        lineNumber: 229,
                                        columnNumber: 16
                                    }, this),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "space-y-6",
                                        children: RULES.map((rule, idx)=>{
                                            const Icon = rule.icon;
                                            return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                className: "flex gap-4",
                                                children: [
                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                        className: "w-10 h-10 shrink-0 rounded-full bg-gray-50 dark:bg-[#1a1a1a] flex items-center justify-center",
                                                        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(Icon, {
                                                            className: "w-5 h-5 text-gray-900 dark:text-white"
                                                        }, void 0, false, {
                                                            fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                            lineNumber: 240,
                                                            columnNumber: 34
                                                        }, this)
                                                    }, void 0, false, {
                                                        fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                        lineNumber: 239,
                                                        columnNumber: 30
                                                    }, this),
                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                        children: [
                                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("h3", {
                                                                className: "font-semibold text-gray-900 dark:text-white text-sm",
                                                                children: rule.title
                                                            }, void 0, false, {
                                                                fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                                lineNumber: 243,
                                                                columnNumber: 34
                                                            }, this),
                                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                                                className: "text-xs text-gray-500 dark:text-gray-400 leading-relaxed mt-0.5",
                                                                children: rule.description
                                                            }, void 0, false, {
                                                                fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                                lineNumber: 244,
                                                                columnNumber: 34
                                                            }, this)
                                                        ]
                                                    }, void 0, true, {
                                                        fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                        lineNumber: 242,
                                                        columnNumber: 30
                                                    }, this)
                                                ]
                                            }, idx, true, {
                                                fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                lineNumber: 238,
                                                columnNumber: 26
                                            }, this);
                                        })
                                    }, void 0, false, {
                                        fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                        lineNumber: 234,
                                        columnNumber: 16
                                    }, this),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "mt-auto pt-8",
                                        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                            onClick: ()=>setStep("CONFIRM"),
                                            className: "w-full bg-gray-900 dark:bg-white text-white dark:text-black py-4 rounded-xl font-bold text-sm tracking-wide hover:opacity-90 transition-opacity flex items-center justify-center gap-2",
                                            children: [
                                                "I Understand",
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$arrow$2d$right$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__ArrowRight$3e$__["ArrowRight"], {
                                                    className: "w-4 h-4"
                                                }, void 0, false, {
                                                    fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                    lineNumber: 257,
                                                    columnNumber: 21
                                                }, this)
                                            ]
                                        }, void 0, true, {
                                            fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                            lineNumber: 252,
                                            columnNumber: 17
                                        }, this)
                                    }, void 0, false, {
                                        fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                        lineNumber: 251,
                                        columnNumber: 16
                                    }, this)
                                ]
                            }, void 0, true, {
                                fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                lineNumber: 228,
                                columnNumber: 13
                            }, this),
                            step === "CONFIRM" && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                className: "flex-1 flex flex-col animate-in slide-in-from-right-8 duration-300",
                                children: [
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                        onClick: ()=>setStep("RULES"),
                                        className: "mb-6 flex items-center gap-2 text-sm text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors w-fit",
                                        children: [
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$chevron$2d$left$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__ChevronLeft$3e$__["ChevronLeft"], {
                                                className: "w-4 h-4"
                                            }, void 0, false, {
                                                fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                lineNumber: 270,
                                                columnNumber: 21
                                            }, this),
                                            "Back"
                                        ]
                                    }, void 0, true, {
                                        fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                        lineNumber: 266,
                                        columnNumber: 17
                                    }, this),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "text-center mb-8",
                                        children: [
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                className: "w-16 h-16 bg-orange-100 dark:bg-orange-500/20 mx-auto rounded-full flex items-center justify-center mb-6 animate-pulse",
                                                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$shield$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Shield$3e$__["Shield"], {
                                                    className: "w-8 h-8 text-orange-600 dark:text-orange-500"
                                                }, void 0, false, {
                                                    fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                    lineNumber: 276,
                                                    columnNumber: 25
                                                }, this)
                                            }, void 0, false, {
                                                fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                lineNumber: 275,
                                                columnNumber: 20
                                            }, this),
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("h2", {
                                                className: "text-2xl font-bold text-gray-900 dark:text-white mb-2",
                                                children: "Ready to Start?"
                                            }, void 0, false, {
                                                fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                lineNumber: 278,
                                                columnNumber: 20
                                            }, this),
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                                className: "text-gray-500 dark:text-gray-400 text-sm max-w-[260px] mx-auto",
                                                children: "Once you begin, your screen will be monitored. Violations may lead to disqualification."
                                            }, void 0, false, {
                                                fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                lineNumber: 279,
                                                columnNumber: 20
                                            }, this)
                                        ]
                                    }, void 0, true, {
                                        fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                        lineNumber: 274,
                                        columnNumber: 17
                                    }, this),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "bg-gray-50 dark:bg-[#141414] border border-gray-100 dark:border-[#262626] rounded-xl p-4 mb-6",
                                        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("label", {
                                            className: "flex items-start gap-3 cursor-pointer",
                                            children: [
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                    className: "relative flex items-center mt-0.5",
                                                    children: [
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("input", {
                                                            type: "checkbox",
                                                            checked: agreed,
                                                            onChange: (e)=>setAgreed(e.target.checked),
                                                            className: "peer h-5 w-5 appearance-none rounded-md border-2 border-gray-300 dark:border-gray-600 checked:border-orange-500 checked:bg-orange-500 transition-all"
                                                        }, void 0, false, {
                                                            fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                            lineNumber: 287,
                                                            columnNumber: 29
                                                        }, this),
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$check$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Check$3e$__["Check"], {
                                                            className: "pointer-events-none absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-3.5 h-3.5 text-white opacity-0 peer-checked:opacity-100"
                                                        }, void 0, false, {
                                                            fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                            lineNumber: 293,
                                                            columnNumber: 29
                                                        }, this)
                                                    ]
                                                }, void 0, true, {
                                                    fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                    lineNumber: 286,
                                                    columnNumber: 25
                                                }, this),
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                    className: "text-xs text-gray-600 dark:text-gray-400 select-none leading-relaxed",
                                                    children: "I verify that I am the registered participant and I agree to follow all contest rules honestly."
                                                }, void 0, false, {
                                                    fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                    lineNumber: 295,
                                                    columnNumber: 25
                                                }, this)
                                            ]
                                        }, void 0, true, {
                                            fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                            lineNumber: 285,
                                            columnNumber: 21
                                        }, this)
                                    }, void 0, false, {
                                        fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                        lineNumber: 284,
                                        columnNumber: 17
                                    }, this),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "mt-auto",
                                        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                            onClick: handleStartContest,
                                            disabled: !agreed || isLoading,
                                            className: "w-full bg-linear-to-r from-orange-600 to-orange-500 text-white py-4 rounded-xl font-bold text-sm tracking-wide hover:shadow-lg hover:shadow-orange-500/20 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",
                                            children: isLoading ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                className: "w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"
                                            }, void 0, false, {
                                                fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                lineNumber: 308,
                                                columnNumber: 30
                                            }, this) : /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Fragment"], {
                                                children: [
                                                    "Enter Contest",
                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$arrow$2d$right$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__ArrowRight$3e$__["ArrowRight"], {
                                                        className: "w-4 h-4"
                                                    }, void 0, false, {
                                                        fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                        lineNumber: 312,
                                                        columnNumber: 33
                                                    }, this)
                                                ]
                                            }, void 0, true)
                                        }, void 0, false, {
                                            fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                            lineNumber: 302,
                                            columnNumber: 21
                                        }, this)
                                    }, void 0, false, {
                                        fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                        lineNumber: 301,
                                        columnNumber: 17
                                    }, this)
                                ]
                            }, void 0, true, {
                                fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                lineNumber: 265,
                                columnNumber: 13
                            }, this)
                        ]
                    }, void 0, true, {
                        fileName: "[project]/components/contest/ContestEntryModal.tsx",
                        lineNumber: 189,
                        columnNumber: 9
                    }, this)
                ]
            }, void 0, true, {
                fileName: "[project]/components/contest/ContestEntryModal.tsx",
                lineNumber: 136,
                columnNumber: 7
            }, this)
        ]
    }, void 0, true, {
        fileName: "[project]/components/contest/ContestEntryModal.tsx",
        lineNumber: 128,
        columnNumber: 5
    }, this);
}
_s(ContestEntryModal, "Masmm+V/UK2s4YdJiPIx5CH+JlY=");
_c = ContestEntryModal;
var _c;
__turbopack_context__.k.register(_c, "ContestEntryModal");
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/actions/data:705715 [app-client] (ecmascript) <text/javascript>", ((__turbopack_context__) => {
"use strict";

/* __next_internal_action_entry_do_not_use__ [{"78bac990ae89cd8ae87b5bbd328ef9aee3e1937b8f":"logContestViolation"},"actions/contest.ts",""] */ __turbopack_context__.s([
    "logContestViolation",
    ()=>logContestViolation
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-client] (ecmascript)");
"use turbopack no side effects";
;
var logContestViolation = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["createServerReference"])("78bac990ae89cd8ae87b5bbd328ef9aee3e1937b8f", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["findSourceMapURL"], "logContestViolation"); //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vY29udGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzZXJ2ZXJcIjtcblxuaW1wb3J0IHsgcHJpc21hIH0gZnJvbSBcIkAvbGliL3ByaXNtYVwiO1xuaW1wb3J0IHsgYXV0aCB9IGZyb20gXCJAL2xpYi9hdXRoXCI7XG5pbXBvcnQgeyBoZWFkZXJzIH0gZnJvbSBcIm5leHQvaGVhZGVyc1wiO1xuaW1wb3J0IHsgeiB9IGZyb20gXCJ6b2RcIjtcbmltcG9ydCB7IHJldmFsaWRhdGVQYXRoLCByZXZhbGlkYXRlVGFnIH0gZnJvbSBcIm5leHQvY2FjaGVcIjtcbmltcG9ydCB7IHVuc3RhYmxlX2NhY2hlIGFzIGNhY2hlLCB1bnN0YWJsZV9ub1N0b3JlIGFzIG5vU3RvcmUgfSBmcm9tIFwibmV4dC9jYWNoZVwiO1xuaW1wb3J0IHsgY2FjaGVUYWcsIGNhY2hlTGlmZSB9IGZyb20gXCJuZXh0L2NhY2hlXCI7XG5pbXBvcnQgeyBhZnRlciB9IGZyb20gXCJuZXh0L3NlcnZlclwiOyAvLyBGb3IgYmFja2dyb3VuZCB0YXNrc1xuXG5jb25zdCBjb250ZXN0U2NoZW1hID0gei5vYmplY3Qoe1xuICAgIHRpdGxlOiB6LnN0cmluZygpLm1pbigzLCBcIlRpdGxlIG11c3QgYmUgYXQgbGVhc3QgMyBjaGFyYWN0ZXJzXCIpLFxuICAgIGRlc2NyaXB0aW9uOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgc3RhcnRUaW1lOiB6LmNvZXJjZS5kYXRlKCksXG4gICAgZW5kVGltZTogei5jb2VyY2UuZGF0ZSgpLFxuICAgIHZpc2liaWxpdHk6IHouZW51bShbXCJQVUJMSUNcIiwgXCJJTlNUSVRVVElPTlwiLCBcIkNMQVNTUk9PTVwiXSksXG4gICAgY2xhc3Nyb29tSWQ6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgICBpbnN0aXR1dGlvbklkOiB6LnN0cmluZygpLm9wdGlvbmFsKCkubnVsbGFibGUoKSxcbiAgICBwcm9ibGVtczogei5hcnJheSh6LnN0cmluZygpKS5taW4oMSwgXCJTZWxlY3QgYXQgbGVhc3Qgb25lIHByb2JsZW1cIiksXG4gICAgY29udGVzdFBhc3N3b3JkOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgcmFuZG9taXplUXVlc3Rpb25zOiB6LmJvb2xlYW4oKS5kZWZhdWx0KGZhbHNlKSxcbn0pO1xuXG5jb25zdCBjb250ZXN0V2l0aFByb2JsZW1zU2NoZW1hID0gei5vYmplY3Qoe1xuICAgIHRpdGxlOiB6LnN0cmluZygpLm1pbigzLCBcIlRpdGxlIG11c3QgYmUgYXQgbGVhc3QgMyBjaGFyYWN0ZXJzXCIpLFxuICAgIHNsdWc6IHouc3RyaW5nKCkubWluKDMsIFwiU2x1ZyBtdXN0IGJlIGF0IGxlYXN0IDMgY2hhcmFjdGVyc1wiKSxcbiAgICBkZXNjcmlwdGlvbjogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAgIHN0YXJ0VGltZTogei5kYXRlKCksXG4gICAgZW5kVGltZTogei5kYXRlKCksXG4gICAgdmlzaWJpbGl0eTogei5lbnVtKFtcIlBVQkxJQ1wiLCBcIklOU1RJVFVUSU9OXCIsIFwiQ0xBU1NST09NXCJdKSxcbiAgICBoaWRkZW46IHouYm9vbGVhbigpLmRlZmF1bHQoZmFsc2UpLFxuICAgIGNsYXNzcm9vbUlkOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgaW5zdGl0dXRpb25JZDogei5zdHJpbmcoKS5vcHRpb25hbCgpLm51bGxhYmxlKCksXG4gICAgYmFja2dyb3VuZEltYWdlOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgcHJpemVzOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgcnVsZXM6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgICBwcm9ibGVtczogei5hcnJheSh6LmFueSgpKSwgLy8gRnVsbCBwcm9ibGVtIGRhdGEgb2JqZWN0c1xuICAgIGNvbnRlc3RQYXNzd29yZDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAgIHJhbmRvbWl6ZVF1ZXN0aW9uczogei5ib29sZWFuKCkuZGVmYXVsdChmYWxzZSksXG59KTtcblxuLyoqXG4gKiBGZXRjaGVzIGNvbnRlc3RzIHZpc2libGUgdG8gdGhlIGN1cnJlbnQgdXNlci5cbiAqL1xuLyoqXG4gKiBDYWNoZWQgZmV0Y2ggZm9yIHB1YmxpYyBjb250ZXN0c1xuICovXG5hc3luYyBmdW5jdGlvbiBnZXRQdWJsaWNDb250ZXN0cygpIHtcbiAgICBcInVzZSBjYWNoZVwiXG4gICAgY2FjaGVUYWcoXCJjb250ZXN0cy1wdWJsaWNcIik7XG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIGNhY2hlTGlmZShcImNvbnRlc3RzXCIpO1xuXG4gICAgcmV0dXJuIHByaXNtYS5jb250ZXN0LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgIHZpc2liaWxpdHk6IFwiUFVCTElDXCIsXG4gICAgICAgICAgICBoaWRkZW46IGZhbHNlLFxuICAgICAgICB9LFxuICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICBfY291bnQ6IHsgc2VsZWN0OiB7IHByb2JsZW1zOiB0cnVlIH0gfVxuICAgICAgICB9LFxuICAgICAgICBvcmRlckJ5OiB7IHN0YXJ0VGltZTogXCJkZXNjXCIgfSxcbiAgICB9KTtcbn1cblxuLyoqXG4gKiBGZXRjaGVzIGNvbnRlc3RzIHZpc2libGUgdG8gdGhlIGN1cnJlbnQgdXNlci5cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFZpc2libGVDb250ZXN0cygpIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIHRyeSB7XG4gICAgICAgIGlmICghc2Vzc2lvbj8udXNlcikge1xuICAgICAgICAgICAgY29uc3QgY29udGVzdHMgPSBhd2FpdCBnZXRQdWJsaWNDb250ZXN0cygpO1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgY29udGVzdHMgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gc2Vzc2lvbi51c2VyIGFzIGFueTtcblxuICAgICAgICBpZiAoY3VycmVudFVzZXIucm9sZSA9PT0gXCJBRE1JTlwiKSB7XG4gICAgICAgICAgICBjb25zdCBjb250ZXN0cyA9IGF3YWl0IHByaXNtYS5jb250ZXN0LmZpbmRNYW55KHtcbiAgICAgICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgICAgIF9jb3VudDogeyBzZWxlY3Q6IHsgcHJvYmxlbXM6IHRydWUgfSB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBvcmRlckJ5OiB7IHN0YXJ0VGltZTogXCJkZXNjXCIgfSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgY29udGVzdHMgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGNvbnRlc3RzID0gYXdhaXQgcHJpc21hLmNvbnRlc3QuZmluZE1hbnkoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICBPUjogW1xuICAgICAgICAgICAgICAgICAgICB7IHZpc2liaWxpdHk6IFwiUFVCTElDXCIgfSxcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgQU5EOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeyB2aXNpYmlsaXR5OiBcIklOU1RJVFVUSU9OXCIgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IGluc3RpdHV0aW9uSWQ6IGN1cnJlbnRVc2VyLmluc3RpdHV0aW9uSWQgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIEFORDogW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgdmlzaWJpbGl0eTogXCJDTEFTU1JPT01cIiB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgT1I6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgY2xhc3Nyb29tOiB7IHN0dWRlbnRzOiB7IHNvbWU6IHsgaWQ6IGN1cnJlbnRVc2VyLmlkIH0gfSB9IH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IGNyZWF0b3JJZDogY3VycmVudFVzZXIuaWQgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgeyBjcmVhdG9ySWQ6IGN1cnJlbnRVc2VyLmlkIH0sXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgX2NvdW50OiB7IHNlbGVjdDogeyBwcm9ibGVtczogdHJ1ZSB9IH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvcmRlckJ5OiB7IHN0YXJ0VGltZTogXCJkZXNjXCIgfSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgY29udGVzdHMgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGZldGNoIGNvbnRlc3RzOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZmV0Y2ggY29udGVzdHNcIiB9O1xuICAgIH1cbn1cblxuXG4vKipcbiAqIEZldGNoZXMgYSBzaW5nbGUgY29udGVzdCdzIGRldGFpbHMgd2l0aCBhdXRob3JpemF0aW9uLlxuICovXG4vKipcbiAqIEZldGNoZXMgYSBzaW5nbGUgY29udGVzdCdzIGRldGFpbHMgd2l0aCBhdXRob3JpemF0aW9uLlxuICovXG4vKipcbiAqIENhY2hlZCBjb250ZXN0IGRldGFpbCBmZXRjaGVyXG4gKiBSZXR1cm5zIGNvbnRlc3QgZGF0YSB3aXRob3V0IHVzZXItc3BlY2lmaWMgY29udGV4dFxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRDYWNoZWRDb250ZXN0KGNvbnRlc3RJZDogc3RyaW5nKSB7XG4gICAgXCJ1c2UgY2FjaGVcIlxuICAgIGNhY2hlVGFnKGBjb250ZXN0LSR7Y29udGVzdElkfWApO1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBjYWNoZUxpZmUoXCJjb250ZXN0LWRldGFpbFwiKTtcblxuICAgIHJldHVybiBwcmlzbWEuY29udGVzdC5maW5kVW5pcXVlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6IGNvbnRlc3RJZCB9LFxuICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICBfY291bnQ6IHtcbiAgICAgICAgICAgICAgICBzZWxlY3Q6IHsgcHJvYmxlbXM6IHRydWUgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwcm9ibGVtczoge1xuICAgICAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICAgICAgcHJvYmxlbToge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlmZmljdWx0eTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbHVnOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9yZGVyQnk6IHsgb3JkZXI6IFwiYXNjXCIgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgfSk7XG59XG5cbi8qKlxuICogRmV0Y2hlcyBhIHNpbmdsZSBjb250ZXN0J3MgZGV0YWlscyB3aXRoIGF1dGhvcml6YXRpb24uXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRDb250ZXN0RGV0YWlsKGNvbnRlc3RJZDogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjb250ZXN0ID0gYXdhaXQgZ2V0Q2FjaGVkQ29udGVzdChjb250ZXN0SWQpO1xuXG4gICAgICAgIGlmICghY29udGVzdCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkNvbnRlc3Qgbm90IGZvdW5kXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gc2Vzc2lvbj8udXNlciBhcyBhbnk7XG4gICAgICAgIGNvbnN0IHBhcnRpY2lwYXRpb24gPSBjdXJyZW50VXNlciA/IGF3YWl0IHByaXNtYS5jb250ZXN0UGFydGljaXBhdGlvbi5maW5kVW5pcXVlKHtcbiAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgdXNlcklkX2NvbnRlc3RJZDoge1xuICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IGN1cnJlbnRVc2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkgOiBudWxsO1xuXG4gICAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgICAgIGNvbnN0IGhhc1N0YXJ0ZWQgPSBub3cgPj0gY29udGVzdC5zdGFydFRpbWU7XG4gICAgICAgIGNvbnN0IGlzQ3JlYXRvciA9IGN1cnJlbnRVc2VyPy5pZCA9PT0gY29udGVzdC5jcmVhdG9ySWQ7XG4gICAgICAgIGNvbnN0IGlzQWRtaW4gPSBjdXJyZW50VXNlcj8ucm9sZSA9PT0gXCJBRE1JTlwiO1xuXG4gICAgICAgIC8vIFZpc2liaWxpdHkgQ2hlY2tcbiAgICAgICAgbGV0IGlzQXV0aG9yaXplZCA9IGZhbHNlO1xuICAgICAgICBpZiAoY29udGVzdC52aXNpYmlsaXR5ID09PSBcIlBVQkxJQ1wiKSB7XG4gICAgICAgICAgICBpc0F1dGhvcml6ZWQgPSB0cnVlO1xuICAgICAgICB9IGVsc2UgaWYgKGlzQWRtaW4pIHtcbiAgICAgICAgICAgIGlzQXV0aG9yaXplZCA9IHRydWU7XG4gICAgICAgIH0gZWxzZSBpZiAoY3VycmVudFVzZXIpIHtcbiAgICAgICAgICAgIGlmIChpc0NyZWF0b3IpIHtcbiAgICAgICAgICAgICAgICBpc0F1dGhvcml6ZWQgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChjb250ZXN0LnZpc2liaWxpdHkgPT09IFwiSU5TVElUVVRJT05cIikge1xuICAgICAgICAgICAgICAgIC8vIFVzZSA9PSBmb3IgbnVsbC91bmRlZmluZWQgbG9vc2UgZXF1YWxpdHkgY2hlY2tcbiAgICAgICAgICAgICAgICBpc0F1dGhvcml6ZWQgPSBjdXJyZW50VXNlci5pbnN0aXR1dGlvbklkID09IGNvbnRlc3QuaW5zdGl0dXRpb25JZDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoY29udGVzdC52aXNpYmlsaXR5ID09PSBcIkNMQVNTUk9PTVwiKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZW5yb2xsbWVudCA9IGF3YWl0IHByaXNtYS5jbGFzc3Jvb20uZmluZEZpcnN0KHtcbiAgICAgICAgICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBjb250ZXN0LmNsYXNzcm9vbUlkIGFzIHN0cmluZyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0dWRlbnRzOiB7IHNvbWU6IHsgaWQ6IGN1cnJlbnRVc2VyLmlkIH0gfSxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpc0F1dGhvcml6ZWQgPSAhIWVucm9sbG1lbnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIWlzQXV0aG9yaXplZCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZCBhY2Nlc3MgdG8gdGhpcyBjb250ZXN0LlwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBjYW5TZWVQcm9ibGVtcyA9IChoYXNTdGFydGVkIHx8IGlzQWRtaW4gfHwgaXNDcmVhdG9yKSAmJiAocGFydGljaXBhdGlvbj8uYWNjZXB0ZWRSdWxlcyB8fCBpc0NyZWF0b3IgfHwgaXNBZG1pbik7XG5cbiAgICAgICAgLy8gRml4OiBJZiB0aGUgY29udGVzdCBpcyBvdmVyLCBhbGxvd2VkIHJvbGVzIHNob3VsZCBjaGVjayBwYXJ0aWNpcGF0aW9uIHByb3Blcmx5LFxuICAgICAgICAvLyBidXQgdHlwaWNhbGx5IGFsbG93cyB2aWV3aW5nIGlmIHB1YmxpYy9hdXRob3JpemVkLlxuICAgICAgICAvLyBCdXQgZm9yIFwiTGl2ZVwiIGNvbnRlc3RzLCB0aGUgY3VycmVudCBsb2dpYyBpcyBjb3JyZWN0LlxuXG4gICAgICAgIGNvbnN0IHJlcXVpcmVzUGFzc3dvcmQgPSAhIWNvbnRlc3QuY29udGVzdFBhc3N3b3JkO1xuXG4gICAgICAgIC8vIFNodWZmbGUgcHJvYmxlbXMgaWYgcmFuZG9taXplUXVlc3Rpb25zIGlzIGVuYWJsZWRcbiAgICAgICAgLy8gVXNlIGEgc2ltcGxlIHNlZWRlZCBzaHVmZmxlIGJhc2VkIG9uIHVzZXJJZCArIGNvbnRlc3RJZCBmb3IgY29uc2lzdGVuY3lcbiAgICAgICAgbGV0IHZpc2libGVQcm9ibGVtcyA9IGNhblNlZVByb2JsZW1zID8gY29udGVzdC5wcm9ibGVtcyA6IFtdO1xuXG4gICAgICAgIGlmIChjb250ZXN0LnJhbmRvbWl6ZVF1ZXN0aW9ucyAmJiBjdXJyZW50VXNlciAmJiB2aXNpYmxlUHJvYmxlbXMubGVuZ3RoID4gMCAmJiAhaXNBZG1pbiAmJiAhaXNDcmVhdG9yKSB7XG4gICAgICAgICAgICAvLyBTaW1wbGUgc3RyaW5nIGhhc2ggZnVuY3Rpb24gZm9yIHNlZWRpbmdcbiAgICAgICAgICAgIGNvbnN0IHNlZWRTdHIgPSBgJHtjdXJyZW50VXNlci5pZH0tJHtjb250ZXN0SWR9YDtcbiAgICAgICAgICAgIGxldCBzZWVkID0gMDtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2VlZFN0ci5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHNlZWQgPSAoKHNlZWQgPDwgNSkgLSBzZWVkKSArIHNlZWRTdHIuY2hhckNvZGVBdChpKTtcbiAgICAgICAgICAgICAgICBzZWVkIHw9IDA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIERldGVybWluaXN0aWMgc2h1ZmZsZVxuICAgICAgICAgICAgdmlzaWJsZVByb2JsZW1zID0gWy4uLnZpc2libGVQcm9ibGVtc10uc29ydCgoYSwgYikgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHggPSBNYXRoLnNpbihzZWVkKyspICogMTAwMDA7XG4gICAgICAgICAgICAgICAgcmV0dXJuICh4IC0gTWF0aC5mbG9vcih4KSkgLSAwLjU7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEZldGNoIHVzZXIncyBzb2x2ZWQgcHJvYmxlbXMgZm9yIHRoaXMgY29udGVzdFxuICAgICAgICBjb25zdCBzb2x2ZWRQcm9ibGVtSWRzID0gbmV3IFNldDxzdHJpbmc+KCk7XG4gICAgICAgIGlmIChjdXJyZW50VXNlcikge1xuICAgICAgICAgICAgY29uc3Qgc29sdmVkU3VibWlzc2lvbnMgPSBhd2FpdCBwcmlzbWEuc3VibWlzc2lvbi5maW5kTWFueSh7XG4gICAgICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkOiBjdXJyZW50VXNlci5pZCxcbiAgICAgICAgICAgICAgICAgICAgY29udGVzdElkOiBjb250ZXN0SWQsXG4gICAgICAgICAgICAgICAgICAgIHN0YXR1czogXCJBQ0NFUFRFRFwiLFxuICAgICAgICAgICAgICAgICAgICBwcm9ibGVtSWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGluOiB2aXNpYmxlUHJvYmxlbXMubWFwKHAgPT4gcC5wcm9ibGVtLmlkKVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBzZWxlY3Q6IHsgcHJvYmxlbUlkOiB0cnVlIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgc29sdmVkU3VibWlzc2lvbnMuZm9yRWFjaChzID0+IHNvbHZlZFByb2JsZW1JZHMuYWRkKHMucHJvYmxlbUlkKSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRlc3Q6IHtcbiAgICAgICAgICAgICAgICAuLi5jb250ZXN0LFxuICAgICAgICAgICAgICAgIHByb2JsZW1zOiB2aXNpYmxlUHJvYmxlbXMubWFwKHZwID0+ICh7XG4gICAgICAgICAgICAgICAgICAgIC4uLnZwLFxuICAgICAgICAgICAgICAgICAgICBpc1NvbHZlZDogc29sdmVkUHJvYmxlbUlkcy5oYXModnAucHJvYmxlbS5pZClcbiAgICAgICAgICAgICAgICB9KSksXG4gICAgICAgICAgICAgICAgaGFzU3RhcnRlZCxcbiAgICAgICAgICAgICAgICBoYXNFbmRlZDogbm93ID4gY29udGVzdC5lbmRUaW1lLFxuICAgICAgICAgICAgICAgIGNhbk1hbmFnZTogaXNBZG1pbiB8fCBpc0NyZWF0b3IsXG4gICAgICAgICAgICAgICAgaGFzQWNjZXB0ZWRSdWxlczogcGFydGljaXBhdGlvbj8uYWNjZXB0ZWRSdWxlcyB8fCBmYWxzZSxcbiAgICAgICAgICAgICAgICBpc0ZpbmlzaGVkOiBwYXJ0aWNpcGF0aW9uPy5pc0ZpbmlzaGVkIHx8IGZhbHNlLFxuICAgICAgICAgICAgICAgIHJlcXVpcmVzUGFzc3dvcmQsXG4gICAgICAgICAgICAgICAgY29udGVzdFBhc3N3b3JkOiBudWxsLCAvLyBOZXZlciByZXR1cm4gcGxhaW4gcGFzc3dvcmRcbiAgICAgICAgICAgICAgICBzZXNzaW9uSWQ6IHBhcnRpY2lwYXRpb24/LnNlc3Npb25JZCAvLyBSZXR1cm4gc2Vzc2lvbklkIGZvciBwcm90ZWN0aW9uXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBmZXRjaCBjb250ZXN0IGRldGFpbDpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGZldGNoIGNvbnRlc3RcIiB9O1xuICAgIH1cbn1cblxuLy8gLi4uIGV4aXN0aW5nIGNvZGUgLi4uXG5cbi8vIC4uLiBleGlzdGluZyBjb2RlIC4uLlxuXG4vLyAuLi4gZXhpc3RpbmcgY29kZSAuLi5cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUNvbnRlc3QoZGF0YTogei5pbmZlcjx0eXBlb2YgY29udGVzdFNjaGVtYT4pIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIGlmICghc2Vzc2lvbj8udXNlcikge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcbiAgICB9XG5cbiAgICBjb25zdCBjdXJyZW50VXNlciA9IHNlc3Npb24udXNlciBhcyBhbnk7XG5cbiAgICBpZiAoIVtcIkFETUlOXCIsIFwiSU5TVElUVVRJT05fTUFOQUdFUlwiLCBcIkNPTlRFU1RfTUFOQUdFUlwiLCBcIlRFQUNIRVJcIl0uaW5jbHVkZXMoY3VycmVudFVzZXIucm9sZSkpIHtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgdmFsaWRhdGVkRGF0YSA9IGNvbnRlc3RTY2hlbWEucGFyc2UoZGF0YSk7XG5cbiAgICAgICAgLy8gR2VuZXJhdGUgYSBtb3JlIHJvYnVzdCB1bmlxdWUgc2x1Z1xuICAgICAgICBjb25zdCBiYXNlU2x1ZyA9IHZhbGlkYXRlZERhdGEudGl0bGUudG9Mb3dlckNhc2UoKS5yZXBsYWNlKC9bXmEtejAtOV0rL2csIFwiLVwiKS5yZXBsYWNlKC8oXi18LSQpL2csIFwiXCIpO1xuICAgICAgICBjb25zdCB1bmlxdWVTbHVnID0gYCR7YmFzZVNsdWd9LSR7RGF0ZS5ub3coKX1gO1xuXG4gICAgICAgIGNvbnN0IGNvbnRlc3QgPSBhd2FpdCBwcmlzbWEuY29udGVzdC5jcmVhdGUoe1xuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgIHRpdGxlOiB2YWxpZGF0ZWREYXRhLnRpdGxlLFxuICAgICAgICAgICAgICAgIHNsdWc6IHVuaXF1ZVNsdWcsXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHZhbGlkYXRlZERhdGEuZGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgc3RhcnRUaW1lOiB2YWxpZGF0ZWREYXRhLnN0YXJ0VGltZSxcbiAgICAgICAgICAgICAgICBlbmRUaW1lOiB2YWxpZGF0ZWREYXRhLmVuZFRpbWUsXG4gICAgICAgICAgICAgICAgdmlzaWJpbGl0eTogdmFsaWRhdGVkRGF0YS52aXNpYmlsaXR5IGFzIGFueSxcbiAgICAgICAgICAgICAgICBpbnN0aXR1dGlvbklkOiB2YWxpZGF0ZWREYXRhLnZpc2liaWxpdHkgIT09IFwiUFVCTElDXCIgPyAodmFsaWRhdGVkRGF0YS5pbnN0aXR1dGlvbklkIHx8IG51bGwpIDogbnVsbCxcbiAgICAgICAgICAgICAgICBjbGFzc3Jvb21JZDogdmFsaWRhdGVkRGF0YS52aXNpYmlsaXR5ID09PSBcIkNMQVNTUk9PTVwiID8gKHZhbGlkYXRlZERhdGEuY2xhc3Nyb29tSWQgfHwgbnVsbCkgOiBudWxsLFxuICAgICAgICAgICAgICAgIGNyZWF0b3JJZDogY3VycmVudFVzZXIuaWQsXG4gICAgICAgICAgICAgICAgY29udGVzdFBhc3N3b3JkOiB2YWxpZGF0ZWREYXRhLmNvbnRlc3RQYXNzd29yZCB8fCBudWxsLFxuICAgICAgICAgICAgICAgIHJhbmRvbWl6ZVF1ZXN0aW9uczogdmFsaWRhdGVkRGF0YS5yYW5kb21pemVRdWVzdGlvbnMgfHwgZmFsc2UsXG4gICAgICAgICAgICAgICAgcHJvYmxlbXM6IHtcbiAgICAgICAgICAgICAgICAgICAgY3JlYXRlOiB2YWxpZGF0ZWREYXRhLnByb2JsZW1zLm1hcCgocHJvYmxlbUlkLCBpbmRleCkgPT4gKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2JsZW1JZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG9yZGVyOiBpbmRleCxcbiAgICAgICAgICAgICAgICAgICAgfSkpLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcblxuICAgICAgICByZXZhbGlkYXRlUGF0aChcIi9kYXNoYm9hcmQvY29udGVzdHNcIik7XG4gICAgICAgIHJldmFsaWRhdGVQYXRoKFwiL2NvbnRlc3RcIik7XG4gICAgICAgIHJldmFsaWRhdGVUYWcoXCJjb250ZXN0c1wiLCBcIm1heFwiKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgY29udGVzdElkOiBjb250ZXN0LmlkIH07XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBjb250ZXN0OlwiLCBlcnJvcik7XG4gICAgICAgIC8vIFJldHVybiBjbGVhcmVyIGVycm9yIG1lc3NhZ2VzXG4gICAgICAgIGxldCBlcnJvck1lc3NhZ2UgPSBcIkZhaWxlZCB0byBjcmVhdGUgY29udGVzdFwiO1xuICAgICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiB6LlpvZEVycm9yKSB7XG4gICAgICAgICAgICAgZXJyb3JNZXNzYWdlID0gKGVycm9yIGFzIGFueSkuZXJyb3JzLm1hcCgoZTogYW55KSA9PiBlLm1lc3NhZ2UpLmpvaW4oXCIsIFwiKTtcbiAgICAgICAgfSBlbHNlIGlmIChlcnJvciBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgICAgICAgICAgZXJyb3JNZXNzYWdlID0gZXJyb3IubWVzc2FnZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVycm9yTWVzc2FnZSB9O1xuICAgIH1cbiAgICB9XG5cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUNvbnRlc3RXaXRoUHJvYmxlbXMoZGF0YTogei5pbmZlcjx0eXBlb2YgY29udGVzdFdpdGhQcm9ibGVtc1NjaGVtYT4pIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIGlmICghc2Vzc2lvbj8udXNlcikge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcbiAgICB9XG5cbiAgICBjb25zdCBjdXJyZW50VXNlciA9IHNlc3Npb24udXNlciBhcyBhbnk7XG5cbiAgICBpZiAoIVtcIkFETUlOXCIsIFwiSU5TVElUVVRJT05fTUFOQUdFUlwiLCBcIkNPTlRFU1RfTUFOQUdFUlwiLCBcIlRFQUNIRVJcIl0uaW5jbHVkZXMoY3VycmVudFVzZXIucm9sZSkpIHtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgdmFsaWRhdGVkRGF0YSA9IGNvbnRlc3RXaXRoUHJvYmxlbXNTY2hlbWEucGFyc2UoZGF0YSk7XG5cbiAgICAgICAgY29uc3QgY29udGVzdCA9IGF3YWl0IHByaXNtYS4kdHJhbnNhY3Rpb24oYXN5bmMgKHR4KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjb250ZXN0ID0gYXdhaXQgdHguY29udGVzdC5jcmVhdGUoe1xuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHZhbGlkYXRlZERhdGEudGl0bGUsXG4gICAgICAgICAgICAgICAgICAgIHNsdWc6IHZhbGlkYXRlZERhdGEuc2x1ZyxcbiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHZhbGlkYXRlZERhdGEuZGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0VGltZTogdmFsaWRhdGVkRGF0YS5zdGFydFRpbWUsXG4gICAgICAgICAgICAgICAgICAgIGVuZFRpbWU6IHZhbGlkYXRlZERhdGEuZW5kVGltZSxcbiAgICAgICAgICAgICAgICAgICAgdmlzaWJpbGl0eTogdmFsaWRhdGVkRGF0YS52aXNpYmlsaXR5IGFzIGFueSxcbiAgICAgICAgICAgICAgICAgICAgaGlkZGVuOiB2YWxpZGF0ZWREYXRhLmhpZGRlbixcbiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZEltYWdlOiB2YWxpZGF0ZWREYXRhLmJhY2tncm91bmRJbWFnZSxcbiAgICAgICAgICAgICAgICAgICAgcHJpemVzOiB2YWxpZGF0ZWREYXRhLnByaXplcyxcbiAgICAgICAgICAgICAgICAgICAgcnVsZXM6IHZhbGlkYXRlZERhdGEucnVsZXMsXG4gICAgICAgICAgICAgICAgICAgIGluc3RpdHV0aW9uSWQ6IHZhbGlkYXRlZERhdGEudmlzaWJpbGl0eSAhPT0gXCJQVUJMSUNcIiA/ICh2YWxpZGF0ZWREYXRhLmluc3RpdHV0aW9uSWQgfHwgbnVsbCkgOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICBjbGFzc3Jvb21JZDogdmFsaWRhdGVkRGF0YS52aXNpYmlsaXR5ID09PSBcIkNMQVNTUk9PTVwiID8gKHZhbGlkYXRlZERhdGEuY2xhc3Nyb29tSWQgfHwgbnVsbCkgOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICBjcmVhdG9ySWQ6IGN1cnJlbnRVc2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0UGFzc3dvcmQ6IHZhbGlkYXRlZERhdGEuY29udGVzdFBhc3N3b3JkIHx8IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIHJhbmRvbWl6ZVF1ZXN0aW9uczogdmFsaWRhdGVkRGF0YS5yYW5kb21pemVRdWVzdGlvbnMgfHwgZmFsc2UsXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmFsaWRhdGVkRGF0YS5wcm9ibGVtcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGNvbnN0IHAgPSB2YWxpZGF0ZWREYXRhLnByb2JsZW1zW2ldO1xuICAgICAgICAgICAgICAgIC8vIEdlbmVyYXRlIHVuaXF1ZSBzbHVnIGJ5IGFwcGVuZGluZyBjb250ZXN0IHNsdWcgYW5kIGluZGV4XG4gICAgICAgICAgICAgICAgY29uc3QgdW5pcXVlU2x1ZyA9IGAke3ZhbGlkYXRlZERhdGEuc2x1Z30tJHtwLnNsdWcgfHwgcC50aXRsZS50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoL1xccysvZywgJy0nKX0tJHtEYXRlLm5vdygpfS0ke2l9YDtcbiAgICAgICAgICAgICAgICBjb25zdCBwcm9ibGVtID0gYXdhaXQgdHgucHJvYmxlbS5jcmVhdGUoe1xuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogcC50aXRsZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBwLmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGlmZmljdWx0eTogcC5kaWZmaWN1bHR5LFxuICAgICAgICAgICAgICAgICAgICAgICAgc2x1ZzogdW5pcXVlU2x1ZyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3JlOiBwLnNjb3JlIHx8IDEwLFxuICAgICAgICAgICAgICAgICAgICAgICAgZG9tYWluOiBwLmRvbWFpbixcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiQ09OVEVTVFwiLCAvLyBDb250ZXN0IHByb2JsZW1zIGFyZSBtYXJrZWQgc2VwYXJhdGVseVxuICAgICAgICAgICAgICAgICAgICAgICAgaGlkZGVuOiB0cnVlLCAvLyBDb250ZXN0IHByb2JsZW1zIGFyZSBoaWRkZW4gZnJvbSBtYWluIGJhbmtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlc3RDYXNlczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZTogcC50ZXN0Q2FzZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgdGFnczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbm5lY3Q6IHAudGFncz8ubWFwKCh0OiBzdHJpbmcpID0+ICh7IG5hbWU6IHQgfSkpIHx8IFtdLFxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBhd2FpdCB0eC5jb250ZXN0UHJvYmxlbS5jcmVhdGUoe1xuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3QuaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9ibGVtSWQ6IHByb2JsZW0uaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBvcmRlcjogaSxcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gY29udGVzdDtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL2NvbnRlc3RzXCIpO1xuICAgICAgICByZXZhbGlkYXRlUGF0aChcIi9jb250ZXN0c1wiKTtcbiAgICAgICAgcmV2YWxpZGF0ZVBhdGgoXCIvY29udGVzdFwiKTtcbiAgICAgICAgcmV2YWxpZGF0ZVRhZyhcImNvbnRlc3RzXCIsIFwibWF4XCIpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBjb250ZXN0SWQ6IGNvbnRlc3QuaWQgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBjb250ZXN0IHdpdGggcHJvYmxlbXM6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBjcmVhdGUgY29udGVzdFwiIH07XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0SW5zdGl0dXRpb25hbENsYXNzcm9vbXMoaW5zdGl0dXRpb25JZDogc3RyaW5nKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgY2xhc3Nyb29tcyA9IGF3YWl0IHByaXNtYS5jbGFzc3Jvb20uZmluZE1hbnkoe1xuICAgICAgICAgICAgd2hlcmU6IHsgaW5zdGl0dXRpb25JZCB9LFxuICAgICAgICAgICAgc2VsZWN0OiB7IGlkOiB0cnVlLCBuYW1lOiB0cnVlLCBzZWN0aW9uOiB0cnVlIH0sXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBjbGFzc3Jvb21zIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBmZXRjaCBjbGFzc3Jvb21zOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZmV0Y2ggY2xhc3Nyb29tc1wiIH07XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0U2VsZWN0YWJsZVByb2JsZW1zKHNlYXJjaDogc3RyaW5nKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcHJvYmxlbXMgPSBhd2FpdCBwcmlzbWEucHJvYmxlbS5maW5kTWFueSh7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgIE9SOiBbXG4gICAgICAgICAgICAgICAgICAgIHsgdGl0bGU6IHsgY29udGFpbnM6IHNlYXJjaCwgbW9kZTogXCJpbnNlbnNpdGl2ZVwiIH0gfSxcbiAgICAgICAgICAgICAgICAgICAgeyBzbHVnOiB7IGNvbnRhaW5zOiBzZWFyY2gsIG1vZGU6IFwiaW5zZW5zaXRpdmVcIiB9IH0sXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBoaWRkZW46IGZhbHNlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNlbGVjdDogeyBpZDogdHJ1ZSwgdGl0bGU6IHRydWUsIGRpZmZpY3VsdHk6IHRydWUsIHNsdWc6IHRydWUgfSxcbiAgICAgICAgICAgIHRha2U6IDEwLFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgcHJvYmxlbXMgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGZldGNoIHByb2JsZW1zOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZmV0Y2ggcHJvYmxlbXNcIiB9O1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGFjY2VwdENvbnRlc3RSdWxlcyhjb250ZXN0SWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcblxuICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHByaXNtYS5jb250ZXN0UGFydGljaXBhdGlvbi51cHNlcnQoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1cGRhdGU6IHsgYWNjZXB0ZWRSdWxlczogdHJ1ZSB9LFxuICAgICAgICAgICAgY3JlYXRlOiB7XG4gICAgICAgICAgICAgICAgdXNlcklkOiBzZXNzaW9uLnVzZXIuaWQsXG4gICAgICAgICAgICAgICAgY29udGVzdElkOiBjb250ZXN0SWQsXG4gICAgICAgICAgICAgICAgYWNjZXB0ZWRSdWxlczogdHJ1ZVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV2YWxpZGF0ZVBhdGgoYC9jb250ZXN0LyR7Y29udGVzdElkfWApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBhY2NlcHQgcnVsZXNcIiB9O1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGZpbmlzaENvbnRlc3RBY3Rpb24oY29udGVzdElkOiBzdHJpbmcpIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIGlmICghc2Vzc2lvbj8udXNlcikgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG5cbiAgICB0cnkge1xuICAgICAgICBhd2FpdCBwcmlzbWEuY29udGVzdFBhcnRpY2lwYXRpb24udXBzZXJ0KHtcbiAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgdXNlcklkX2NvbnRlc3RJZDoge1xuICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IHNlc3Npb24udXNlci5pZCxcbiAgICAgICAgICAgICAgICAgICAgY29udGVzdElkOiBjb250ZXN0SWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdXBkYXRlOiB7XG4gICAgICAgICAgICAgICAgaXNGaW5pc2hlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBmaW5pc2hlZEF0OiBuZXcgRGF0ZSgpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY3JlYXRlOiB7XG4gICAgICAgICAgICAgICAgdXNlcklkOiBzZXNzaW9uLnVzZXIuaWQsXG4gICAgICAgICAgICAgICAgY29udGVzdElkOiBjb250ZXN0SWQsXG4gICAgICAgICAgICAgICAgYWNjZXB0ZWRSdWxlczogdHJ1ZSxcbiAgICAgICAgICAgICAgICBpc0ZpbmlzaGVkOiB0cnVlLFxuICAgICAgICAgICAgICAgIGZpbmlzaGVkQXQ6IG5ldyBEYXRlKClcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldmFsaWRhdGVQYXRoKGAvY29udGVzdC8ke2NvbnRlc3RJZH1gKTtcbiAgICAgICAgcmV2YWxpZGF0ZVBhdGgoYC9wcm9ibGVtc2ApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBmaW5pc2ggY29udGVzdFwiIH07XG4gICAgfVxufVxuXG4vKipcbiAqIEZpbmFsaXplIENvbnRlc3QgJiBBd2FyZCBCYWRnZXNcbiAqIC0gQ2FsY3VsYXRlcyBsZWFkZXJib2FyZFxuICogLSBBd2FyZHMgR29sZCwgU2lsdmVyLCBCcm9uemUgdG8gVG9wIDNcbiAqIC0gTWFya3MgY29udGVzdCBhcyBmaW5hbGl6ZWRcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGZpbmFsaXplQ29udGVzdChjb250ZXN0SWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcblxuICAgIC8vIE9ubHkgYWRtaW5zIG9yIGNvbnRlc3QgbWFuYWdlcnMgY2FuIGZpbmFsaXplXG4gICAgY29uc3QgY3VycmVudFVzZXIgPSBzZXNzaW9uLnVzZXIgYXMgYW55O1xuICAgIGlmICghW1wiQURNSU5cIiwgXCJDT05URVNUX01BTkFHRVJcIiwgXCJJTlNUSVRVVElPTl9NQU5BR0VSXCIsIFwiVEVBQ0hFUlwiXS5pbmNsdWRlcyhjdXJyZW50VXNlci5yb2xlKSkge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjb250ZXN0ID0gYXdhaXQgcHJpc21hLmNvbnRlc3QuZmluZFVuaXF1ZSh7XG4gICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IGNvbnRlc3RJZCB9LFxuICAgICAgICAgICAgIHNlbGVjdDogeyBpc0ZpbmFsaXplZDogdHJ1ZSwgdGl0bGU6IHRydWUgfVxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoIWNvbnRlc3QpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJDb250ZXN0IG5vdCBmb3VuZFwiIH07XG4gICAgICAgIGlmIChjb250ZXN0LmlzRmluYWxpemVkKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiQ29udGVzdCBpcyBhbHJlYWR5IGZpbmFsaXplZFwiIH07XG5cbiAgICAgICAgLy8gUmV1c2UgbGVhZGVyYm9hcmQgbG9naWMgdG8gZ2V0IHJhbmtpbmdzXG4gICAgICAgIGNvbnN0IGxlYWRlcmJvYXJkID0gYXdhaXQgZ2V0Q29udGVzdExlYWRlcmJvYXJkKGNvbnRlc3RJZCk7XG4gICAgICAgIGlmICghbGVhZGVyYm9hcmQuc3VjY2VzcyB8fCAhbGVhZGVyYm9hcmQuc3R1ZGVudHMpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZmV0Y2ggbGVhZGVyYm9hcmRcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgc3R1ZGVudHMgPSBsZWFkZXJib2FyZC5zdHVkZW50cyBhcyBhbnlbXTtcblxuICAgICAgICAvLyBBdCBsZWFzdCAxIHN0dWRlbnQgbmVlZGVkXG4gICAgICAgIGlmIChzdHVkZW50cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICBhd2FpdCBwcmlzbWEuY29udGVzdC51cGRhdGUoe1xuICAgICAgICAgICAgICAgICB3aGVyZTogeyBpZDogY29udGVzdElkIH0sXG4gICAgICAgICAgICAgICAgIGRhdGE6IHsgaXNGaW5hbGl6ZWQ6IHRydWUgfVxuICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIG1lc3NhZ2U6IFwiQ29udGVzdCBmaW5hbGl6ZWQgKG5vIHBhcnRpY2lwYW50cylcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVG9wIDMgSURzXG4gICAgICAgIGNvbnN0IGdvbGRVc2VySWQgPSBzdHVkZW50c1swXT8uaWQ7XG4gICAgICAgIGNvbnN0IHNpbHZlclVzZXJJZCA9IHN0dWRlbnRzWzFdPy5pZDtcbiAgICAgICAgY29uc3QgYnJvbnplVXNlcklkID0gc3R1ZGVudHNbMl0/LmlkO1xuXG4gICAgICAgIGF3YWl0IHByaXNtYS4kdHJhbnNhY3Rpb24oYXN5bmMgKHR4KSA9PiB7XG4gICAgICAgICAgICAvLyBBd2FyZCBHb2xkXG4gICAgICAgICAgICBpZiAoZ29sZFVzZXJJZCkge1xuICAgICAgICAgICAgICAgIGF3YWl0IHR4LnVzZXIudXBkYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IGdvbGRVc2VySWQgfSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogeyBnb2xkQmFkZ2VzOiB7IGluY3JlbWVudDogMSB9IH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIEF3YXJkIFNpbHZlclxuICAgICAgICAgICAgaWYgKHNpbHZlclVzZXJJZCkge1xuICAgICAgICAgICAgICAgIGF3YWl0IHR4LnVzZXIudXBkYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IHNpbHZlclVzZXJJZCB9LFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7IHNpbHZlckJhZGdlczogeyBpbmNyZW1lbnQ6IDEgfSB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBBd2FyZCBCcm9uemVcbiAgICAgICAgICAgIGlmIChicm9uemVVc2VySWQpIHtcbiAgICAgICAgICAgICAgICBhd2FpdCB0eC51c2VyLnVwZGF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIHdoZXJlOiB7IGlkOiBicm9uemVVc2VySWQgfSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogeyBicm9uemVCYWRnZXM6IHsgaW5jcmVtZW50OiAxIH0gfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBNYXJrIEZpbmFsaXplZFxuICAgICAgICAgICAgYXdhaXQgdHguY29udGVzdC51cGRhdGUoe1xuICAgICAgICAgICAgICAgIHdoZXJlOiB7IGlkOiBjb250ZXN0SWQgfSxcbiAgICAgICAgICAgICAgICBkYXRhOiB7IGlzRmluYWxpemVkOiB0cnVlIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICByZXZhbGlkYXRlUGF0aChgL2Rhc2hib2FyZGApO1xuICAgICAgICByZXZhbGlkYXRlUGF0aChgL3Byb2ZpbGUvJHtnb2xkVXNlcklkfWApO1xuICAgICAgICBpZihzaWx2ZXJVc2VySWQpIHJldmFsaWRhdGVQYXRoKGAvcHJvZmlsZS8ke3NpbHZlclVzZXJJZH1gKTtcbiAgICAgICAgaWYoYnJvbnplVXNlcklkKSByZXZhbGlkYXRlUGF0aChgL3Byb2ZpbGUvJHticm9uemVVc2VySWR9YCk7XG4gICAgICAgIHJldmFsaWRhdGVQYXRoKGAvY29udGVzdC8ke2NvbnRlc3RJZH1gKTtcbiAgICAgICAgcmV2YWxpZGF0ZVRhZyhgY29udGVzdC0ke2NvbnRlc3RJZH1gLCBcIm1heFwiKTtcbiAgICAgICAgcmV2YWxpZGF0ZVRhZyhgbGVhZGVyYm9hcmQtJHtjb250ZXN0SWR9YCwgXCJtYXhcIik7XG5cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gZmluYWxpemUgY29udGVzdDpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGZpbmFsaXplIGNvbnRlc3RcIiB9O1xuICAgIH1cbn1cblxuLyoqXG4gKiBWZXJpZnkgY29udGVzdCBwYXNzd29yZCB3aXRob3V0IHN0YXJ0aW5nIHNlc3Npb24uXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB2ZXJpZnlDb250ZXN0UGFzc3dvcmQoY29udGVzdElkOiBzdHJpbmcsIHBhc3N3b3JkPzogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICBpZiAoIXNlc3Npb24/LnVzZXIpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgY29udGVzdCA9IGF3YWl0IHByaXNtYS5jb250ZXN0LmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IGNvbnRlc3RJZCB9LFxuICAgICAgICAgICAgc2VsZWN0OiB7IGNvbnRlc3RQYXNzd29yZDogdHJ1ZSB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICghY29udGVzdCkgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkNvbnRlc3Qgbm90IGZvdW5kXCIgfTtcblxuICAgICAgICBpZiAoY29udGVzdC5jb250ZXN0UGFzc3dvcmQgJiYgY29udGVzdC5jb250ZXN0UGFzc3dvcmQgIT09IHBhc3N3b3JkKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiSW52YWxpZCBjb250ZXN0IHBhc3N3b3JkXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIHZlcmlmeSBjb250ZXN0IHBhc3N3b3JkOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gdmVyaWZ5IHBhc3N3b3JkXCIgfTtcbiAgICB9XG59XG5cblxuLyoqXG4gKiBTdGFydCBhIGNvbnRlc3Qgc2Vzc2lvbiAtIHZhbGlkYXRlcyB0aW1lIGJvdW5kcyBhbmQgY3JlYXRlcyBzZXNzaW9uIElEXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzdGFydENvbnRlc3RTZXNzaW9uKGNvbnRlc3RJZDogc3RyaW5nLCBwYXNzd29yZD86IHN0cmluZykge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcblxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRlc3QgPSBhd2FpdCBwcmlzbWEuY29udGVzdC5maW5kVW5pcXVlKHtcbiAgICAgICAgICAgIHdoZXJlOiB7IGlkOiBjb250ZXN0SWQgfSxcbiAgICAgICAgICAgIHNlbGVjdDogeyBzdGFydFRpbWU6IHRydWUsIGVuZFRpbWU6IHRydWUsIGNvbnRlc3RQYXNzd29yZDogdHJ1ZSB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICghY29udGVzdCkgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkNvbnRlc3Qgbm90IGZvdW5kXCIgfTtcblxuICAgICAgICBpZiAoY29udGVzdC5jb250ZXN0UGFzc3dvcmQgJiYgY29udGVzdC5jb250ZXN0UGFzc3dvcmQgIT09IHBhc3N3b3JkKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiSW52YWxpZCBjb250ZXN0IHBhc3N3b3JkXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG5cbiAgICAgICAgLy8gVGltZSBib3VuZHMgY2hlY2tcbiAgICAgICAgaWYgKG5vdyA8IGNvbnRlc3Quc3RhcnRUaW1lKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiQ29udGVzdCBoYXMgbm90IHN0YXJ0ZWQgeWV0XCIgfTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobm93ID4gY29udGVzdC5lbmRUaW1lKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiQ29udGVzdCBoYXMgYWxyZWFkeSBlbmRlZFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBHZW5lcmF0ZSB1bmlxdWUgc2Vzc2lvbiBJRFxuICAgICAgICBjb25zdCBzZXNzaW9uSWQgPSBgJHtzZXNzaW9uLnVzZXIuaWR9LSR7Y29udGVzdElkfS0ke0RhdGUubm93KCl9YDtcblxuICAgICAgICAvLyBDaGVjayBmb3IgZXhpc3RpbmcgYWN0aXZlIHNlc3Npb24gKG11bHRpLXRhYiBkZXRlY3Rpb24pXG4gICAgICAgIGNvbnN0IGV4aXN0aW5nUGFydGljaXBhdGlvbiA9IGF3YWl0IHByaXNtYS5jb250ZXN0UGFydGljaXBhdGlvbi5maW5kVW5pcXVlKHtcbiAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgdXNlcklkX2NvbnRlc3RJZDoge1xuICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IHNlc3Npb24udXNlci5pZCxcbiAgICAgICAgICAgICAgICAgICAgY29udGVzdElkOiBjb250ZXN0SWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChleGlzdGluZ1BhcnRpY2lwYXRpb24/LmlzQmxvY2tlZCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIllvdSBoYXZlIGJlZW4gYmxvY2tlZCBmcm9tIHRoaXMgY29udGVzdCBkdWUgdG8gdmlvbGF0aW9uc1wiIH07XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZXhpc3RpbmdQYXJ0aWNpcGF0aW9uPy5pc0ZpbmlzaGVkKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiWW91IGhhdmUgYWxyZWFkeSBmaW5pc2hlZCB0aGlzIGNvbnRlc3RcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVXBkYXRlIG9yIGNyZWF0ZSBwYXJ0aWNpcGF0aW9uIHdpdGggbmV3IHNlc3Npb25cbiAgICAgICAgY29uc3QgcGFydGljaXBhdGlvbiA9IGF3YWl0IHByaXNtYS5jb250ZXN0UGFydGljaXBhdGlvbi51cHNlcnQoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1cGRhdGU6IHtcbiAgICAgICAgICAgICAgICBzZXNzaW9uSWQsXG4gICAgICAgICAgICAgICAgc2Vzc2lvblN0YXJ0ZWRBdDogbm93LFxuICAgICAgICAgICAgICAgIGFjY2VwdGVkUnVsZXM6IHRydWVcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjcmVhdGU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWQ6IHNlc3Npb24udXNlci5pZCxcbiAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZCxcbiAgICAgICAgICAgICAgICBzZXNzaW9uSWQsXG4gICAgICAgICAgICAgICAgc2Vzc2lvblN0YXJ0ZWRBdDogbm93LFxuICAgICAgICAgICAgICAgIGFjY2VwdGVkUnVsZXM6IHRydWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgICBzZXNzaW9uSWQsXG4gICAgICAgICAgICBwYXJ0aWNpcGF0aW9uSWQ6IHBhcnRpY2lwYXRpb24uaWQsXG4gICAgICAgICAgICB0b3RhbFZpb2xhdGlvbnM6IHBhcnRpY2lwYXRpb24udG90YWxWaW9sYXRpb25zLFxuICAgICAgICAgICAgaXNGbGFnZ2VkOiBwYXJ0aWNpcGF0aW9uLmlzRmxhZ2dlZFxuICAgICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gc3RhcnQgY29udGVzdCBzZXNzaW9uOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gc3RhcnQgY29udGVzdCBzZXNzaW9uXCIgfTtcbiAgICB9XG59XG5cbi8qKlxuICogTG9nIGEgY29udGVzdCB2aW9sYXRpb24gLSByZWNvcmRzIHRvIGRhdGFiYXNlIGFuZCB1cGRhdGVzIGNvdW50ZXJzXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBsb2dDb250ZXN0VmlvbGF0aW9uKFxuICAgIGNvbnRlc3RJZDogc3RyaW5nLFxuICAgIHR5cGU6IFwiVEFCX1NXSVRDSFwiIHwgXCJGVUxMU0NSRUVOX0VYSVRcIiB8IFwiQ09QWV9QQVNURVwiIHwgXCJERVZUT09MU19PUEVOXCIgfCBcIktFWUJPQVJEX1NIT1JUQ1VUXCIgfCBcIk5BVklHQVRJT05fQVRURU1QVFwiIHwgXCJNVUxUSV9UQUJcIiB8IFwiU1VTUElDSU9VU19JTlBVVFwiLFxuICAgIG1lc3NhZ2U/OiBzdHJpbmcsXG4gICAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+XG4pIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIGlmICghc2Vzc2lvbj8udXNlcikgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBwYXJ0aWNpcGF0aW9uID0gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKCFwYXJ0aWNpcGF0aW9uKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiTm8gYWN0aXZlIHBhcnRpY2lwYXRpb24gZm91bmRcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gRGV0ZXJtaW5lIHdoaWNoIGNvdW50ZXIgdG8gaW5jcmVtZW50XG4gICAgICAgIGNvbnN0IGNvdW50ZXJGaWVsZCA9IHtcbiAgICAgICAgICAgIFRBQl9TV0lUQ0g6IFwidGFiU3dpdGNoQ291bnRcIixcbiAgICAgICAgICAgIEZVTExTQ1JFRU5fRVhJVDogXCJmdWxsc2NyZWVuRXhpdENvdW50XCIsXG4gICAgICAgICAgICBDT1BZX1BBU1RFOiBcImNvcHlQYXN0ZUNvdW50XCIsXG4gICAgICAgICAgICBERVZUT09MU19PUEVOOiBcImRldlRvb2xzQ291bnRcIixcbiAgICAgICAgICAgIEtFWUJPQVJEX1NIT1JUQ1VUOiBcImtleWJvYXJkQ291bnRcIixcbiAgICAgICAgICAgIE5BVklHQVRJT05fQVRURU1QVDogXCJuYXZpZ2F0aW9uQ291bnRcIixcbiAgICAgICAgICAgIE1VTFRJX1RBQjogXCJ0YWJTd2l0Y2hDb3VudFwiLFxuICAgICAgICAgICAgU1VTUElDSU9VU19JTlBVVDogXCJjb3B5UGFzdGVDb3VudFwiXG4gICAgICAgIH1bdHlwZV0gYXMgc3RyaW5nO1xuXG4gICAgICAgIC8vIFVzZSB0cmFuc2FjdGlvbiB0byBlbnN1cmUgYXRvbWljIHVwZGF0ZVxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBwcmlzbWEuJHRyYW5zYWN0aW9uKGFzeW5jICh0eCkgPT4ge1xuICAgICAgICAgICAgLy8gQ2hlY2sgbGFzdCB2aW9sYXRpb24gdGltZSB0byBwcmV2ZW50IHJhcGlkLWZpcmUgZHVwbGljYXRlcyAoU2VydmVyLXNpZGUgZGVib3VuY2UpXG4gICAgICAgICAgICBjb25zdCBsYXN0VmlvbGF0aW9uID0gYXdhaXQgdHguY29udGVzdFZpb2xhdGlvbi5maW5kRmlyc3Qoe1xuICAgICAgICAgICAgICAgIHdoZXJlOiB7IHBhcnRpY2lwYXRpb25JZDogcGFydGljaXBhdGlvbi5pZCB9LFxuICAgICAgICAgICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnZGVzYycgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmIChsYXN0VmlvbGF0aW9uKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdGltZURpZmYgPSBEYXRlLm5vdygpIC0gbGFzdFZpb2xhdGlvbi5jcmVhdGVkQXQuZ2V0VGltZSgpO1xuICAgICAgICAgICAgICAgIC8vIElmIGxlc3MgdGhhbiAyIHNlY29uZHMgc2luY2UgbGFzdCB2aW9sYXRpb24sIGlnbm9yZSB0aGlzIG9uZVxuICAgICAgICAgICAgICAgIGlmICh0aW1lRGlmZiA8IDIwMDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLnBhcnRpY2lwYXRpb24sIC8vIFJldHVybiBleGlzdGluZyBzdGF0ZVxuICAgICAgICAgICAgICAgICAgICAgICAgaXNGbGFnZ2VkOiBwYXJ0aWNpcGF0aW9uLmlzRmxhZ2dlZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzQmxvY2tlZDogcGFydGljaXBhdGlvbi5pc0Jsb2NrZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICB0b3RhbFZpb2xhdGlvbnM6IHBhcnRpY2lwYXRpb24udG90YWxWaW9sYXRpb25zLFxuICAgICAgICAgICAgICAgICAgICAgICAgcGVybWFuZW50bHlCbG9ja2VkOiBwYXJ0aWNpcGF0aW9uLnBlcm1hbmVudGx5QmxvY2tlZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBCbG9ja2VkVW50aWw6IHBhcnRpY2lwYXRpb24udGVtcEJsb2NrZWRVbnRpbFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQ3JlYXRlIHZpb2xhdGlvbiByZWNvcmRcbiAgICAgICAgICAgIGF3YWl0IHR4LmNvbnRlc3RWaW9sYXRpb24uY3JlYXRlKHtcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIHBhcnRpY2lwYXRpb25JZDogcGFydGljaXBhdGlvbi5pZCxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogdHlwZSBhcyBhbnksXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UsXG4gICAgICAgICAgICAgICAgICAgIG1ldGFkYXRhOiBtZXRhZGF0YSA/PyB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIG5ldyB0b3RhbCBhbmQgZGV0ZXJtaW5lIGJsb2NraW5nIHRpZXJcbiAgICAgICAgICAgIGNvbnN0IG5ld1RvdGFsVmlvbGF0aW9ucyA9IHBhcnRpY2lwYXRpb24udG90YWxWaW9sYXRpb25zICsgMTtcbiAgICAgICAgICAgIGNvbnN0IHNob3VsZEZsYWcgPSBuZXdUb3RhbFZpb2xhdGlvbnMgPj0gMztcblxuICAgICAgICAgICAgLy8gVGllcmVkIGJsb2NraW5nIGxvZ2ljXG4gICAgICAgICAgICBsZXQgdGVtcEJsb2NrZWRVbnRpbDogRGF0ZSB8IG51bGwgPSBudWxsO1xuICAgICAgICAgICAgbGV0IHBlcm1hbmVudGx5QmxvY2tlZCA9IGZhbHNlO1xuICAgICAgICAgICAgbGV0IGlzQmxvY2tlZCA9IGZhbHNlO1xuXG4gICAgICAgICAgICBpZiAobmV3VG90YWxWaW9sYXRpb25zID49IDYpIHtcbiAgICAgICAgICAgICAgICAvLyA2KyB2aW9sYXRpb25zID0gcGVybWFuZW50IGJsb2NrXG4gICAgICAgICAgICAgICAgcGVybWFuZW50bHlCbG9ja2VkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBpc0Jsb2NrZWQgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChuZXdUb3RhbFZpb2xhdGlvbnMgPj0gNCkge1xuICAgICAgICAgICAgICAgIC8vIDQtNSB2aW9sYXRpb25zID0gNSBtaW51dGUgdGVtcCBibG9ja1xuICAgICAgICAgICAgICAgIHRlbXBCbG9ja2VkVW50aWwgPSBuZXcgRGF0ZShEYXRlLm5vdygpICsgNSAqIDYwICogMTAwMCk7IC8vIDUgbWludXRlc1xuICAgICAgICAgICAgICAgIGlzQmxvY2tlZCA9IHRydWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZWQgPSBhd2FpdCB0eC5jb250ZXN0UGFydGljaXBhdGlvbi51cGRhdGUoe1xuICAgICAgICAgICAgICAgIHdoZXJlOiB7IGlkOiBwYXJ0aWNpcGF0aW9uLmlkIH0sXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBbY291bnRlckZpZWxkXTogeyBpbmNyZW1lbnQ6IDEgfSxcbiAgICAgICAgICAgICAgICAgICAgdG90YWxWaW9sYXRpb25zOiB7IGluY3JlbWVudDogMSB9LFxuICAgICAgICAgICAgICAgICAgICBpc0ZsYWdnZWQ6IHNob3VsZEZsYWcgfHwgcGFydGljaXBhdGlvbi5pc0ZsYWdnZWQsXG4gICAgICAgICAgICAgICAgICAgIGlzQmxvY2tlZCxcbiAgICAgICAgICAgICAgICAgICAgdGVtcEJsb2NrZWRVbnRpbCxcbiAgICAgICAgICAgICAgICAgICAgcGVybWFuZW50bHlCbG9ja2VkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiB1cGRhdGVkO1xuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgIHRvdGFsVmlvbGF0aW9uczogcmVzdWx0LnRvdGFsVmlvbGF0aW9ucyxcbiAgICAgICAgICAgIGlzRmxhZ2dlZDogcmVzdWx0LmlzRmxhZ2dlZCxcbiAgICAgICAgICAgIGlzQmxvY2tlZDogcmVzdWx0LmlzQmxvY2tlZCxcbiAgICAgICAgICAgIHRlbXBCbG9ja2VkVW50aWw6IHJlc3VsdC50ZW1wQmxvY2tlZFVudGlsPy50b0lTT1N0cmluZygpIHx8IG51bGwsXG4gICAgICAgICAgICBwZXJtYW5lbnRseUJsb2NrZWQ6IHJlc3VsdC5wZXJtYW5lbnRseUJsb2NrZWRcbiAgICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGxvZyB2aW9sYXRpb246XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBsb2cgdmlvbGF0aW9uXCIgfTtcbiAgICB9XG59XG5cbi8qKlxuICogVmFsaWRhdGUgY29udGVzdCBzZXNzaW9uIC0gY2hlY2tzIGlmIHNlc3Npb24gaXMgdmFsaWQgZm9yIHN1Ym1pc3Npb25zXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB2YWxpZGF0ZUNvbnRlc3RTZXNzaW9uKGNvbnRlc3RJZDogc3RyaW5nLCBzZXNzaW9uSWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgdmFsaWQ6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcGFydGljaXBhdGlvbiA9IGF3YWl0IHByaXNtYS5jb250ZXN0UGFydGljaXBhdGlvbi5maW5kVW5pcXVlKHtcbiAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgdXNlcklkX2NvbnRlc3RJZDoge1xuICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IHNlc3Npb24udXNlci5pZCxcbiAgICAgICAgICAgICAgICAgICAgY29udGVzdElkOiBjb250ZXN0SWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgIGNvbnRlc3Q6IHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0OiB7IHN0YXJ0VGltZTogdHJ1ZSwgZW5kVGltZTogdHJ1ZSB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoIXBhcnRpY2lwYXRpb24pIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHZhbGlkOiBmYWxzZSwgcmVhc29uOiBcIk5vIHBhcnRpY2lwYXRpb24gZm91bmRcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ2hlY2sgaWYgYmxvY2tlZFxuICAgICAgICBpZiAocGFydGljaXBhdGlvbi5pc0Jsb2NrZWQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHZhbGlkOiBmYWxzZSwgcmVhc29uOiBcIkJsb2NrZWQgZHVlIHRvIHZpb2xhdGlvbnNcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ2hlY2sgaWYgZmluaXNoZWRcbiAgICAgICAgaWYgKHBhcnRpY2lwYXRpb24uaXNGaW5pc2hlZCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgdmFsaWQ6IGZhbHNlLCByZWFzb246IFwiQ29udGVzdCBhbHJlYWR5IGZpbmlzaGVkXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENoZWNrIHNlc3Npb24gSUQgKG11bHRpLXRhYiBkZXRlY3Rpb24pXG4gICAgICAgIGlmIChwYXJ0aWNpcGF0aW9uLnNlc3Npb25JZCAhPT0gc2Vzc2lvbklkKSB7XG4gICAgICAgICAgICAvLyBMb2cgbXVsdGktdGFiIHZpb2xhdGlvblxuICAgICAgICAgICAgYXdhaXQgbG9nQ29udGVzdFZpb2xhdGlvbihjb250ZXN0SWQsIFwiTVVMVElfVEFCXCIsIFwiTXVsdGlwbGUgdGFicyBkZXRlY3RlZFwiKTtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHZhbGlkOiBmYWxzZSwgcmVhc29uOiBcIlNlc3Npb24gbWlzbWF0Y2ggLSBwb3NzaWJsZSBtdWx0aXBsZSB0YWJzXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENoZWNrIHRpbWUgYm91bmRzXG4gICAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgICAgIGlmIChub3cgPiBwYXJ0aWNpcGF0aW9uLmNvbnRlc3QuZW5kVGltZSkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgdmFsaWQ6IGZhbHNlLCByZWFzb246IFwiQ29udGVzdCBoYXMgZW5kZWRcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgICB2YWxpZDogdHJ1ZSxcbiAgICAgICAgICAgIHRvdGFsVmlvbGF0aW9uczogcGFydGljaXBhdGlvbi50b3RhbFZpb2xhdGlvbnMsXG4gICAgICAgICAgICBpc0ZsYWdnZWQ6IHBhcnRpY2lwYXRpb24uaXNGbGFnZ2VkXG4gICAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byB2YWxpZGF0ZSBzZXNzaW9uOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCB2YWxpZDogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byB2YWxpZGF0ZSBzZXNzaW9uXCIgfTtcbiAgICB9XG59XG5cbi8qKlxuICogQ2hlY2sgaWYgdXNlciBpcyBlbGlnaWJsZSB0byBzdWJtaXQgLSBwcmUtc3VibWlzc2lvbiB2YWxpZGF0aW9uXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjaGVja1N1Ym1pc3Npb25FbGlnaWJpbGl0eShjb250ZXN0SWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBlbGlnaWJsZTogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBwYXJ0aWNpcGF0aW9uID0gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgY29udGVzdDoge1xuICAgICAgICAgICAgICAgICAgICBzZWxlY3Q6IHsgc3RhcnRUaW1lOiB0cnVlLCBlbmRUaW1lOiB0cnVlIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICghcGFydGljaXBhdGlvbikge1xuICAgICAgICAgICAgcmV0dXJuIHsgZWxpZ2libGU6IGZhbHNlLCByZWFzb246IFwiTm8gcGFydGljaXBhdGlvbiBmb3VuZFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDaGVjayB2YXJpb3VzIGNvbmRpdGlvbnNcbiAgICAgICAgaWYgKHBhcnRpY2lwYXRpb24uaXNCbG9ja2VkKSB7XG4gICAgICAgICAgICByZXR1cm4geyBlbGlnaWJsZTogZmFsc2UsIHJlYXNvbjogXCJCbG9ja2VkIGR1ZSB0byBleGNlc3NpdmUgdmlvbGF0aW9uc1wiIH07XG4gICAgICAgIH1cblxuICAgICAgICBpZiAocGFydGljaXBhdGlvbi5pc0ZpbmlzaGVkKSB7XG4gICAgICAgICAgICByZXR1cm4geyBlbGlnaWJsZTogZmFsc2UsIHJlYXNvbjogXCJZb3UgaGF2ZSBhbHJlYWR5IGZpbmlzaGVkIHRoaXMgY29udGVzdFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICAgICAgICBpZiAobm93IDwgcGFydGljaXBhdGlvbi5jb250ZXN0LnN0YXJ0VGltZSkge1xuICAgICAgICAgICAgcmV0dXJuIHsgZWxpZ2libGU6IGZhbHNlLCByZWFzb246IFwiQ29udGVzdCBoYXMgbm90IHN0YXJ0ZWRcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG5vdyA+IHBhcnRpY2lwYXRpb24uY29udGVzdC5lbmRUaW1lKSB7XG4gICAgICAgICAgICByZXR1cm4geyBlbGlnaWJsZTogZmFsc2UsIHJlYXNvbjogXCJDb250ZXN0IGhhcyBlbmRlZFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZWxpZ2libGU6IHRydWUsXG4gICAgICAgICAgICB3YXJuaW5nczogcGFydGljaXBhdGlvbi5pc0ZsYWdnZWQgPyBbXCJZb3VyIHNlc3Npb24gaGFzIGJlZW4gZmxhZ2dlZCBmb3IgcmV2aWV3XCJdIDogW11cbiAgICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGNoZWNrIGVsaWdpYmlsaXR5OlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IGVsaWdpYmxlOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGNoZWNrIGVsaWdpYmlsaXR5XCIgfTtcbiAgICB9XG59XG5cbi8qKlxuICogR2V0IHBhcnRpY2lwYXRpb24gc3RhdHVzIC0gZm9yIFVJIHN0YXRlXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRQYXJ0aWNpcGF0aW9uU3RhdHVzKGNvbnRlc3RJZDogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICBpZiAoIXNlc3Npb24/LnVzZXIpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcGFydGljaXBhdGlvbiA9IGF3YWl0IHByaXNtYS5jb250ZXN0UGFydGljaXBhdGlvbi5maW5kVW5pcXVlKHtcbiAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgdXNlcklkX2NvbnRlc3RJZDoge1xuICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IHNlc3Npb24udXNlci5pZCxcbiAgICAgICAgICAgICAgICAgICAgY29udGVzdElkOiBjb250ZXN0SWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgYWNjZXB0ZWRSdWxlczogdHJ1ZSxcbiAgICAgICAgICAgICAgICBpc0ZpbmlzaGVkOiB0cnVlLFxuICAgICAgICAgICAgICAgIGlzRmxhZ2dlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBpc0Jsb2NrZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgdG90YWxWaW9sYXRpb25zOiB0cnVlLFxuICAgICAgICAgICAgICAgIHNlc3Npb25JZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICB0ZW1wQmxvY2tlZFVudGlsOiB0cnVlLFxuICAgICAgICAgICAgICAgIHBlcm1hbmVudGx5QmxvY2tlZDogdHJ1ZVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBDaGVjayBpZiB0ZW1wIGJsb2NrIGhhcyBleHBpcmVkXG4gICAgICAgIGlmIChwYXJ0aWNpcGF0aW9uPy50ZW1wQmxvY2tlZFVudGlsICYmIG5ldyBEYXRlKCkgPiBwYXJ0aWNpcGF0aW9uLnRlbXBCbG9ja2VkVW50aWwpIHtcbiAgICAgICAgICAgIC8vIFRlbXAgYmxvY2sgZXhwaXJlZCAtIHVuYmxvY2tcbiAgICAgICAgICAgIGF3YWl0IHByaXNtYS5jb250ZXN0UGFydGljaXBhdGlvbi51cGRhdGUoe1xuICAgICAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZF9jb250ZXN0SWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGVzdElkOiBjb250ZXN0SWRcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBpc0Jsb2NrZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wQmxvY2tlZFVudGlsOiBudWxsXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgICAgICBwYXJ0aWNpcGF0aW9uOiB7XG4gICAgICAgICAgICAgICAgICAgIC4uLnBhcnRpY2lwYXRpb24sXG4gICAgICAgICAgICAgICAgICAgIGlzQmxvY2tlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBCbG9ja2VkVW50aWw6IG51bGxcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgICBwYXJ0aWNpcGF0aW9uOiBwYXJ0aWNpcGF0aW9uIHx8IG51bGxcbiAgICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGdldCBwYXJ0aWNpcGF0aW9uIHN0YXR1c1wiIH07XG4gICAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gQ09OVEVTVCBNQU5BR0VSIC0gUEFSVElDSVBBTlQgTUFOQUdFTUVOVFxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLyoqXG4gKiBHZXQgYWxsIHBhcnRpY2lwYW50cyBmb3IgYSBjb250ZXN0IHdpdGggdmlvbGF0aW9uIGRldGFpbHMgKGZvciBtYW5hZ2VycylcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldENvbnRlc3RQYXJ0aWNpcGFudHMoY29udGVzdElkOiBzdHJpbmcpIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIGlmICghc2Vzc2lvbj8udXNlcikgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG5cbiAgICBjb25zdCBjdXJyZW50VXNlciA9IHNlc3Npb24udXNlciBhcyBhbnk7XG5cbiAgICAvLyBDaGVjayBpZiB1c2VyIGlzIGNvbnRlc3QgbWFuYWdlci9jcmVhdG9yXG4gICAgY29uc3QgY29udGVzdCA9IGF3YWl0IHByaXNtYS5jb250ZXN0LmZpbmRVbmlxdWUoe1xuICAgICAgICB3aGVyZTogeyBpZDogY29udGVzdElkIH0sXG4gICAgICAgIHNlbGVjdDogeyBjcmVhdG9ySWQ6IHRydWUgfVxuICAgIH0pO1xuXG4gICAgaWYgKCFjb250ZXN0KSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiQ29udGVzdCBub3QgZm91bmRcIiB9O1xuXG4gICAgY29uc3QgaXNBdXRob3JpemVkID1cbiAgICAgICAgY3VycmVudFVzZXIucm9sZSA9PT0gXCJBRE1JTlwiIHx8XG4gICAgICAgIGN1cnJlbnRVc2VyLnJvbGUgPT09IFwiQ09OVEVTVF9NQU5BR0VSXCIgfHxcbiAgICAgICAgY3VycmVudFVzZXIucm9sZSA9PT0gXCJURUFDSEVSXCIgfHxcbiAgICAgICAgY29udGVzdC5jcmVhdG9ySWQgPT09IGN1cnJlbnRVc2VyLmlkO1xuXG4gICAgaWYgKCFpc0F1dGhvcml6ZWQpIHtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcGFydGljaXBhbnRzID0gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLmZpbmRNYW55KHtcbiAgICAgICAgICAgIHdoZXJlOiB7IGNvbnRlc3RJZCB9LFxuICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBlbWFpbDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGltYWdlOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHZpb2xhdGlvbnM6IHtcbiAgICAgICAgICAgICAgICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6IFwiZGVzY1wiIH0sXG4gICAgICAgICAgICAgICAgICAgIHRha2U6IDEwXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9yZGVyQnk6IFtcbiAgICAgICAgICAgICAgICB7IHBlcm1hbmVudGx5QmxvY2tlZDogXCJkZXNjXCIgfSxcbiAgICAgICAgICAgICAgICB7IGlzQmxvY2tlZDogXCJkZXNjXCIgfSxcbiAgICAgICAgICAgICAgICB7IHRvdGFsVmlvbGF0aW9uczogXCJkZXNjXCIgfVxuICAgICAgICAgICAgXVxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBwYXJ0aWNpcGFudHMgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGdldCBwYXJ0aWNpcGFudHM6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBnZXQgcGFydGljaXBhbnRzXCIgfTtcbiAgICB9XG59XG5cbi8qKlxuICogVW5ibG9jayBhIHBhcnRpY2lwYW50IChtYW5hZ2VyIG9ubHkpXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1bmJsb2NrUGFydGljaXBhbnQoY29udGVzdElkOiBzdHJpbmcsIHVzZXJJZDogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICBpZiAoIXNlc3Npb24/LnVzZXIpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuXG4gICAgY29uc3QgY3VycmVudFVzZXIgPSBzZXNzaW9uLnVzZXIgYXMgYW55O1xuXG4gICAgLy8gQ2hlY2sgYXV0aG9yaXphdGlvblxuICAgIGNvbnN0IGNvbnRlc3QgPSBhd2FpdCBwcmlzbWEuY29udGVzdC5maW5kVW5pcXVlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6IGNvbnRlc3RJZCB9LFxuICAgICAgICBzZWxlY3Q6IHsgY3JlYXRvcklkOiB0cnVlIH1cbiAgICB9KTtcblxuICAgIGlmICghY29udGVzdCkgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkNvbnRlc3Qgbm90IGZvdW5kXCIgfTtcblxuICAgIGNvbnN0IGlzQXV0aG9yaXplZCA9XG4gICAgICAgIGN1cnJlbnRVc2VyLnJvbGUgPT09IFwiQURNSU5cIiB8fFxuICAgICAgICBjdXJyZW50VXNlci5yb2xlID09PSBcIkNPTlRFU1RfTUFOQUdFUlwiIHx8XG4gICAgICAgIGN1cnJlbnRVc2VyLnJvbGUgPT09IFwiVEVBQ0hFUlwiIHx8XG4gICAgICAgIGNvbnRlc3QuY3JlYXRvcklkID09PSBjdXJyZW50VXNlci5pZDtcblxuICAgIGlmICghaXNBdXRob3JpemVkKSB7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHByaXNtYS5jb250ZXN0UGFydGljaXBhdGlvbi51cGRhdGUoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgY29udGVzdElkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICBpc0Jsb2NrZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHRlbXBCbG9ja2VkVW50aWw6IG51bGwsXG4gICAgICAgICAgICAgICAgcGVybWFuZW50bHlCbG9ja2VkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICB0b3RhbFZpb2xhdGlvbnM6IDAsXG4gICAgICAgICAgICAgICAgdGFiU3dpdGNoQ291bnQ6IDAsXG4gICAgICAgICAgICAgICAgZnVsbHNjcmVlbkV4aXRDb3VudDogMCxcbiAgICAgICAgICAgICAgICBjb3B5UGFzdGVDb3VudDogMCxcbiAgICAgICAgICAgICAgICBkZXZUb29sc0NvdW50OiAwLFxuICAgICAgICAgICAgICAgIGtleWJvYXJkQ291bnQ6IDAsXG4gICAgICAgICAgICAgICAgbmF2aWdhdGlvbkNvdW50OiAwLFxuICAgICAgICAgICAgICAgIGlzRmxhZ2dlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgdW5ibG9ja2VkQnk6IGN1cnJlbnRVc2VyLmlkLFxuICAgICAgICAgICAgICAgIHVuYmxvY2tlZEF0OiBuZXcgRGF0ZSgpXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldmFsaWRhdGVQYXRoKGAvZGFzaGJvYXJkL2NvbnRlc3RzLyR7Y29udGVzdElkfS9wYXJ0aWNpcGFudHNgKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gdW5ibG9jayBwYXJ0aWNpcGFudDpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIHVuYmxvY2sgcGFydGljaXBhbnRcIiB9O1xuICAgIH1cbn1cblxuLyoqXG4gKiBHZXQgZGV0YWlsZWQgdmlvbGF0aW9ucyBmb3IgYSBwYXJ0aWNpcGFudFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0UGFydGljaXBhbnRWaW9sYXRpb25zKGNvbnRlc3RJZDogc3RyaW5nLCB1c2VySWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcblxuICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gc2Vzc2lvbi51c2VyIGFzIGFueTtcblxuICAgIC8vIENoZWNrIGF1dGhvcml6YXRpb25cbiAgICBjb25zdCBjb250ZXN0ID0gYXdhaXQgcHJpc21hLmNvbnRlc3QuZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiBjb250ZXN0SWQgfSxcbiAgICAgICAgc2VsZWN0OiB7IGNyZWF0b3JJZDogdHJ1ZSB9XG4gICAgfSk7XG5cbiAgICBpZiAoIWNvbnRlc3QpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJDb250ZXN0IG5vdCBmb3VuZFwiIH07XG5cbiAgICBjb25zdCBpc0F1dGhvcml6ZWQgPVxuICAgICAgICBjdXJyZW50VXNlci5yb2xlID09PSBcIkFETUlOXCIgfHxcbiAgICAgICAgY3VycmVudFVzZXIucm9sZSA9PT0gXCJDT05URVNUX01BTkFHRVJcIiB8fFxuICAgICAgICBjdXJyZW50VXNlci5yb2xlID09PSBcIlRFQUNIRVJcIiB8fFxuICAgICAgICBjb250ZXN0LmNyZWF0b3JJZCA9PT0gY3VycmVudFVzZXIuaWQ7XG5cbiAgICBpZiAoIWlzQXV0aG9yaXplZCkge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBwYXJ0aWNpcGF0aW9uID0gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgY29udGVzdElkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdDogeyBpZDogdHJ1ZSwgbmFtZTogdHJ1ZSwgZW1haWw6IHRydWUgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgdmlvbGF0aW9uczoge1xuICAgICAgICAgICAgICAgICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogXCJkZXNjXCIgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgcGFydGljaXBhdGlvbiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZ2V0IHZpb2xhdGlvbnNcIiB9O1xuICAgIH1cbn1cblxuLyoqXG4gKiBDYWxjdWxhdGUgY29udGVzdCBsZWFkZXJib2FyZFxuICogLSBGZXRjaGVzIGFsbCBwYXJ0aWNpcGF0aW9uc1xuICogLSBGZXRjaGVzIGFsbCByZWxldmFudCBzdWJtaXNzaW9uc1xuICogLSBDYWxjdWxhdGVzIHNjb3Jlc1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q29udGVzdExlYWRlcmJvYXJkKGNvbnRlc3RJZDogc3RyaW5nKSB7XG4gICAgXCJ1c2UgY2FjaGVcIlxuICAgIGNhY2hlVGFnKGBsZWFkZXJib2FyZC0ke2NvbnRlc3RJZH1gKVxuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBjYWNoZUxpZmUoXCJsZWFkZXJib2FyZFwiKVxuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcGFydGljaXBhdGlvbnMgPSBhd2FpdCBwcmlzbWEuY29udGVzdFBhcnRpY2lwYXRpb24uZmluZE1hbnkoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICBjb250ZXN0SWQsXG4gICAgICAgICAgICAgICAgLy8gc3RhcnRlZEF0OiB7IG5vdDogbnVsbCB9IC8vIE9ubHkgc3RhcnRlZCBwYXJ0aWNpcGFudHMgKEZpeCBpZiBmaWVsZCBleGlzdHMsIG90aGVyd2lzZSByZWx5IG9uIGNyZWF0ZWQpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBpbWFnZTogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBjb250ZXN0ID0gYXdhaXQgcHJpc21hLmNvbnRlc3QuZmluZFVuaXF1ZSh7XG4gICAgICAgICAgICB3aGVyZTogeyBpZDogY29udGVzdElkIH0sXG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgcHJvYmxlbXM6IHtcbiAgICAgICAgICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJvYmxlbToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpZmZpY3VsdHk6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNsdWc6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3JlOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBvcmRlckJ5OiB7IG9yZGVyOiBcImFzY1wiIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICghY29udGVzdCkgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkNvbnRlc3Qgbm90IGZvdW5kXCIgfTtcblxuICAgICAgICBjb25zdCBsZWFkZXJib2FyZCA9IGF3YWl0IFByb21pc2UuYWxsKHBhcnRpY2lwYXRpb25zLm1hcChhc3luYyAocCkgPT4ge1xuICAgICAgICAgICAgLy8gR2V0IHZhbGlkIHN1Ym1pc3Npb25zIGZvciB0aGlzIHVzZXIgaW4gdGhpcyBjb250ZXN0XG4gICAgICAgICAgICBjb25zdCBzdWJtaXNzaW9ucyA9IGF3YWl0IHByaXNtYS5zdWJtaXNzaW9uLmZpbmRNYW55KHtcbiAgICAgICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IHAudXNlcklkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZCxcbiAgICAgICAgICAgICAgICAgICAgY3JlYXRlZEF0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBndGU6IGNvbnRlc3Quc3RhcnRUaW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgbHRlOiBjb250ZXN0LmVuZFRpbWVcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHByb2JsZW1JZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgY3JlYXRlZEF0OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBsYW5ndWFnZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSB0b3RhbCBzY29yZVxuICAgICAgICAgICAgLy8gTG9naWM6IEJlc3Qgc3VibWlzc2lvbiBwZXIgcHJvYmxlbSBjb3VudHNcbiAgICAgICAgICAgIGNvbnN0IHByb2JsZW1TY29yZXMgPSBuZXcgTWFwPHN0cmluZywgbnVtYmVyPigpO1xuICAgICAgICAgICAgY29uc3QgcHJvYmxlbVNvbHZlVGltZXMgPSBuZXcgTWFwPHN0cmluZywgRGF0ZT4oKTtcbiAgICAgICAgICAgIGNvbnN0IHByb2JsZW1TdWJtaXNzaW9uQ291bnRzID0gbmV3IE1hcDxzdHJpbmcsIG51bWJlcj4oKTtcbiAgICAgICAgICAgIGNvbnN0IHByb2JsZW1CZXN0U3VibWlzc2lvbnMgPSBuZXcgTWFwPHN0cmluZywgYW55PigpO1xuXG4gICAgICAgICAgICBzdWJtaXNzaW9ucy5mb3JFYWNoKHN1YiA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgY3VycmVudENvdW50ID0gcHJvYmxlbVN1Ym1pc3Npb25Db3VudHMuZ2V0KHN1Yi5wcm9ibGVtSWQpIHx8IDA7XG4gICAgICAgICAgICAgICAgcHJvYmxlbVN1Ym1pc3Npb25Db3VudHMuc2V0KHN1Yi5wcm9ibGVtSWQsIGN1cnJlbnRDb3VudCArIDEpO1xuXG4gICAgICAgICAgICAgICAgaWYgKHN1Yi5zdGF0dXMgPT09IFwiQUNDRVBURURcIikge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50QmVzdCA9IHByb2JsZW1TY29yZXMuZ2V0KHN1Yi5wcm9ibGVtSWQpIHx8IDA7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb2JsZW1EZWYgPSBjb250ZXN0LnByb2JsZW1zLmZpbmQoY3AgPT4gY3AucHJvYmxlbUlkID09PSBzdWIucHJvYmxlbUlkKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWF4U2NvcmUgPSBwcm9ibGVtRGVmPy5wcm9ibGVtLnNjb3JlIHx8IDA7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKG1heFNjb3JlID4gY3VycmVudEJlc3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICBwcm9ibGVtU2NvcmVzLnNldChzdWIucHJvYmxlbUlkLCBtYXhTY29yZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudEJlc3RUaW1lID0gcHJvYmxlbVNvbHZlVGltZXMuZ2V0KHN1Yi5wcm9ibGVtSWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghY3VycmVudEJlc3RUaW1lIHx8IHN1Yi5jcmVhdGVkQXQgPCBjdXJyZW50QmVzdFRpbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvYmxlbVNvbHZlVGltZXMuc2V0KHN1Yi5wcm9ibGVtSWQsIHN1Yi5jcmVhdGVkQXQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9ibGVtQmVzdFN1Ym1pc3Npb25zLnNldChzdWIucHJvYmxlbUlkLCBzdWIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBsZXQgdG90YWxTY29yZSA9IDA7XG4gICAgICAgICAgICBsZXQgdG90YWxUaW1lTXMgPSAwO1xuXG4gICAgICAgICAgICBwcm9ibGVtU2NvcmVzLmZvckVhY2goKHNjb3JlLCBwcm9ibGVtSWQpID0+IHtcbiAgICAgICAgICAgICAgICB0b3RhbFNjb3JlICs9IHNjb3JlO1xuICAgICAgICAgICAgICAgIGNvbnN0IHNvbHZlbnRUaW1lID0gcHJvYmxlbVNvbHZlVGltZXMuZ2V0KHByb2JsZW1JZCk7XG4gICAgICAgICAgICAgICAgaWYgKHNvbHZlbnRUaW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIHRvdGFsVGltZU1zICs9IChzb2x2ZW50VGltZS5nZXRUaW1lKCkgLSBjb250ZXN0LnN0YXJ0VGltZS5nZXRUaW1lKCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBNYXAgc3RhdHMgZm9yIGVhY2ggcHJvYmxlbSBpbiB0aGUgY29udGVzdFxuICAgICAgICAgICAgY29uc3QgcHJvYmxlbVN0YXRzID0gY29udGVzdC5wcm9ibGVtcy5tYXAoY3AgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGJlc3RTdWIgPSBwcm9ibGVtQmVzdFN1Ym1pc3Npb25zLmdldChjcC5wcm9ibGVtSWQpO1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIHByb2JsZW1JZDogY3AucHJvYmxlbUlkLFxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogY3AucHJvYmxlbS50aXRsZSxcbiAgICAgICAgICAgICAgICAgICAgc2x1ZzogY3AucHJvYmxlbS5zbHVnLFxuICAgICAgICAgICAgICAgICAgICBzY29yZTogcHJvYmxlbVNjb3Jlcy5nZXQoY3AucHJvYmxlbUlkKSB8fCAwLFxuICAgICAgICAgICAgICAgICAgICBtYXhTY29yZTogY3AucHJvYmxlbS5zY29yZSxcbiAgICAgICAgICAgICAgICAgICAgc3VibWlzc2lvbnM6IHByb2JsZW1TdWJtaXNzaW9uQ291bnRzLmdldChjcC5wcm9ibGVtSWQpIHx8IDAsXG4gICAgICAgICAgICAgICAgICAgIHNvbHZlZDogcHJvYmxlbVNjb3Jlcy5oYXMoY3AucHJvYmxlbUlkKSxcbiAgICAgICAgICAgICAgICAgICAgc29sdmVkQXQ6IHByb2JsZW1Tb2x2ZVRpbWVzLmdldChjcC5wcm9ibGVtSWQpLFxuICAgICAgICAgICAgICAgICAgICBsYW5ndWFnZTogYmVzdFN1Yj8ubGFuZ3VhZ2U/Lm5hbWUgfHwgbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgbGFuZ3VhZ2VJZDogYmVzdFN1Yj8ubGFuZ3VhZ2U/LmlkIHx8IG51bGxcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgLi4ucC51c2VyLFxuICAgICAgICAgICAgICAgIHNjb3JlOiB0b3RhbFNjb3JlLFxuICAgICAgICAgICAgICAgIHRpbWVUYWtlbjogdG90YWxUaW1lTXMsXG4gICAgICAgICAgICAgICAgcHJvYmxlbXNTb2x2ZWQ6IHByb2JsZW1TY29yZXMuc2l6ZSxcbiAgICAgICAgICAgICAgICBwcm9ibGVtU3RhdHNcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pKTtcblxuICAgICAgICAvLyBTb3J0OiBIaWdoIHNjb3JlIGZpcnN0LCB0aGVuIGxvdyB0aW1lIHRha2VuXG4gICAgICAgIGxlYWRlcmJvYXJkLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgICAgICAgIGlmIChiLnNjb3JlICE9PSBhLnNjb3JlKSByZXR1cm4gYi5zY29yZSAtIGEuc2NvcmU7XG4gICAgICAgICAgICByZXR1cm4gYS50aW1lVGFrZW4gLSBiLnRpbWVUYWtlbjtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgICBzdHVkZW50czogbGVhZGVyYm9hcmQsXG4gICAgICAgICAgICBpc0ZpbmFsaXplZDogY29udGVzdC5pc0ZpbmFsaXplZCxcbiAgICAgICAgICAgIHByb2JsZW1zOiBjb250ZXN0LnByb2JsZW1zLm1hcChjcCA9PiAoe1xuICAgICAgICAgICAgICAgIGlkOiBjcC5wcm9ibGVtSWQsXG4gICAgICAgICAgICAgICAgdGl0bGU6IGNwLnByb2JsZW0udGl0bGUsXG4gICAgICAgICAgICAgICAgc2x1ZzogY3AucHJvYmxlbS5zbHVnLFxuICAgICAgICAgICAgICAgIG1heFNjb3JlOiBjcC5wcm9ibGVtLnNjb3JlXG4gICAgICAgICAgICB9KSlcbiAgICAgICAgfTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJMZWFkZXJib2FyZCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGdlbmVyYXRlIGxlYWRlcmJvYXJkXCIgfTtcbiAgICB9XG59XG5cbi8qKlxuICogR2V0IGN1cnJlbnQgdXNlcidzIHJhbmtpbmcgaW4gYSBjb250ZXN0XG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRDb250ZXN0UmFua2luZyhjb250ZXN0SWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcblxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGdldENvbnRlc3RMZWFkZXJib2FyZChjb250ZXN0SWQpO1xuXG4gICAgICAgIGlmICghcmVzdWx0LnN1Y2Nlc3MgfHwgIXJlc3VsdC5zdHVkZW50cykge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBnZXQgcmFua2luZ1wiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCByYW5rID0gcmVzdWx0LnN0dWRlbnRzLmZpbmRJbmRleCgoczogYW55KSA9PiBzLmlkID09PSBzZXNzaW9uLnVzZXIuaWQpICsgMTtcblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCByYW5rOiByYW5rID4gMCA/IHJhbmsgOiBudWxsIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZ2V0IHJhbmtpbmdcIiB9O1xuICAgIH1cbn1cbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiK1JBeXZCc0IifQ==
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/actions/data:316d9e [app-client] (ecmascript) <text/javascript>", ((__turbopack_context__) => {
"use strict";

/* __next_internal_action_entry_do_not_use__ [{"4041a53321b8a41efa0515551dc3e636f81f59f7d7":"getParticipationStatus"},"actions/contest.ts",""] */ __turbopack_context__.s([
    "getParticipationStatus",
    ()=>getParticipationStatus
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-client] (ecmascript)");
"use turbopack no side effects";
;
var getParticipationStatus = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["createServerReference"])("4041a53321b8a41efa0515551dc3e636f81f59f7d7", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["findSourceMapURL"], "getParticipationStatus"); //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vY29udGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzZXJ2ZXJcIjtcblxuaW1wb3J0IHsgcHJpc21hIH0gZnJvbSBcIkAvbGliL3ByaXNtYVwiO1xuaW1wb3J0IHsgYXV0aCB9IGZyb20gXCJAL2xpYi9hdXRoXCI7XG5pbXBvcnQgeyBoZWFkZXJzIH0gZnJvbSBcIm5leHQvaGVhZGVyc1wiO1xuaW1wb3J0IHsgeiB9IGZyb20gXCJ6b2RcIjtcbmltcG9ydCB7IHJldmFsaWRhdGVQYXRoLCByZXZhbGlkYXRlVGFnIH0gZnJvbSBcIm5leHQvY2FjaGVcIjtcbmltcG9ydCB7IHVuc3RhYmxlX2NhY2hlIGFzIGNhY2hlLCB1bnN0YWJsZV9ub1N0b3JlIGFzIG5vU3RvcmUgfSBmcm9tIFwibmV4dC9jYWNoZVwiO1xuaW1wb3J0IHsgY2FjaGVUYWcsIGNhY2hlTGlmZSB9IGZyb20gXCJuZXh0L2NhY2hlXCI7XG5pbXBvcnQgeyBhZnRlciB9IGZyb20gXCJuZXh0L3NlcnZlclwiOyAvLyBGb3IgYmFja2dyb3VuZCB0YXNrc1xuXG5jb25zdCBjb250ZXN0U2NoZW1hID0gei5vYmplY3Qoe1xuICAgIHRpdGxlOiB6LnN0cmluZygpLm1pbigzLCBcIlRpdGxlIG11c3QgYmUgYXQgbGVhc3QgMyBjaGFyYWN0ZXJzXCIpLFxuICAgIGRlc2NyaXB0aW9uOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgc3RhcnRUaW1lOiB6LmNvZXJjZS5kYXRlKCksXG4gICAgZW5kVGltZTogei5jb2VyY2UuZGF0ZSgpLFxuICAgIHZpc2liaWxpdHk6IHouZW51bShbXCJQVUJMSUNcIiwgXCJJTlNUSVRVVElPTlwiLCBcIkNMQVNTUk9PTVwiXSksXG4gICAgY2xhc3Nyb29tSWQ6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgICBpbnN0aXR1dGlvbklkOiB6LnN0cmluZygpLm9wdGlvbmFsKCkubnVsbGFibGUoKSxcbiAgICBwcm9ibGVtczogei5hcnJheSh6LnN0cmluZygpKS5taW4oMSwgXCJTZWxlY3QgYXQgbGVhc3Qgb25lIHByb2JsZW1cIiksXG4gICAgY29udGVzdFBhc3N3b3JkOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgcmFuZG9taXplUXVlc3Rpb25zOiB6LmJvb2xlYW4oKS5kZWZhdWx0KGZhbHNlKSxcbn0pO1xuXG5jb25zdCBjb250ZXN0V2l0aFByb2JsZW1zU2NoZW1hID0gei5vYmplY3Qoe1xuICAgIHRpdGxlOiB6LnN0cmluZygpLm1pbigzLCBcIlRpdGxlIG11c3QgYmUgYXQgbGVhc3QgMyBjaGFyYWN0ZXJzXCIpLFxuICAgIHNsdWc6IHouc3RyaW5nKCkubWluKDMsIFwiU2x1ZyBtdXN0IGJlIGF0IGxlYXN0IDMgY2hhcmFjdGVyc1wiKSxcbiAgICBkZXNjcmlwdGlvbjogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAgIHN0YXJ0VGltZTogei5kYXRlKCksXG4gICAgZW5kVGltZTogei5kYXRlKCksXG4gICAgdmlzaWJpbGl0eTogei5lbnVtKFtcIlBVQkxJQ1wiLCBcIklOU1RJVFVUSU9OXCIsIFwiQ0xBU1NST09NXCJdKSxcbiAgICBoaWRkZW46IHouYm9vbGVhbigpLmRlZmF1bHQoZmFsc2UpLFxuICAgIGNsYXNzcm9vbUlkOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgaW5zdGl0dXRpb25JZDogei5zdHJpbmcoKS5vcHRpb25hbCgpLm51bGxhYmxlKCksXG4gICAgYmFja2dyb3VuZEltYWdlOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgcHJpemVzOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgcnVsZXM6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgICBwcm9ibGVtczogei5hcnJheSh6LmFueSgpKSwgLy8gRnVsbCBwcm9ibGVtIGRhdGEgb2JqZWN0c1xuICAgIGNvbnRlc3RQYXNzd29yZDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAgIHJhbmRvbWl6ZVF1ZXN0aW9uczogei5ib29sZWFuKCkuZGVmYXVsdChmYWxzZSksXG59KTtcblxuLyoqXG4gKiBGZXRjaGVzIGNvbnRlc3RzIHZpc2libGUgdG8gdGhlIGN1cnJlbnQgdXNlci5cbiAqL1xuLyoqXG4gKiBDYWNoZWQgZmV0Y2ggZm9yIHB1YmxpYyBjb250ZXN0c1xuICovXG5hc3luYyBmdW5jdGlvbiBnZXRQdWJsaWNDb250ZXN0cygpIHtcbiAgICBcInVzZSBjYWNoZVwiXG4gICAgY2FjaGVUYWcoXCJjb250ZXN0cy1wdWJsaWNcIik7XG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIGNhY2hlTGlmZShcImNvbnRlc3RzXCIpO1xuXG4gICAgcmV0dXJuIHByaXNtYS5jb250ZXN0LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgIHZpc2liaWxpdHk6IFwiUFVCTElDXCIsXG4gICAgICAgICAgICBoaWRkZW46IGZhbHNlLFxuICAgICAgICB9LFxuICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICBfY291bnQ6IHsgc2VsZWN0OiB7IHByb2JsZW1zOiB0cnVlIH0gfVxuICAgICAgICB9LFxuICAgICAgICBvcmRlckJ5OiB7IHN0YXJ0VGltZTogXCJkZXNjXCIgfSxcbiAgICB9KTtcbn1cblxuLyoqXG4gKiBGZXRjaGVzIGNvbnRlc3RzIHZpc2libGUgdG8gdGhlIGN1cnJlbnQgdXNlci5cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFZpc2libGVDb250ZXN0cygpIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIHRyeSB7XG4gICAgICAgIGlmICghc2Vzc2lvbj8udXNlcikge1xuICAgICAgICAgICAgY29uc3QgY29udGVzdHMgPSBhd2FpdCBnZXRQdWJsaWNDb250ZXN0cygpO1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgY29udGVzdHMgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gc2Vzc2lvbi51c2VyIGFzIGFueTtcblxuICAgICAgICBpZiAoY3VycmVudFVzZXIucm9sZSA9PT0gXCJBRE1JTlwiKSB7XG4gICAgICAgICAgICBjb25zdCBjb250ZXN0cyA9IGF3YWl0IHByaXNtYS5jb250ZXN0LmZpbmRNYW55KHtcbiAgICAgICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgICAgIF9jb3VudDogeyBzZWxlY3Q6IHsgcHJvYmxlbXM6IHRydWUgfSB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBvcmRlckJ5OiB7IHN0YXJ0VGltZTogXCJkZXNjXCIgfSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgY29udGVzdHMgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGNvbnRlc3RzID0gYXdhaXQgcHJpc21hLmNvbnRlc3QuZmluZE1hbnkoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICBPUjogW1xuICAgICAgICAgICAgICAgICAgICB7IHZpc2liaWxpdHk6IFwiUFVCTElDXCIgfSxcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgQU5EOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeyB2aXNpYmlsaXR5OiBcIklOU1RJVFVUSU9OXCIgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IGluc3RpdHV0aW9uSWQ6IGN1cnJlbnRVc2VyLmluc3RpdHV0aW9uSWQgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIEFORDogW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgdmlzaWJpbGl0eTogXCJDTEFTU1JPT01cIiB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgT1I6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgY2xhc3Nyb29tOiB7IHN0dWRlbnRzOiB7IHNvbWU6IHsgaWQ6IGN1cnJlbnRVc2VyLmlkIH0gfSB9IH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IGNyZWF0b3JJZDogY3VycmVudFVzZXIuaWQgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgeyBjcmVhdG9ySWQ6IGN1cnJlbnRVc2VyLmlkIH0sXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgX2NvdW50OiB7IHNlbGVjdDogeyBwcm9ibGVtczogdHJ1ZSB9IH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvcmRlckJ5OiB7IHN0YXJ0VGltZTogXCJkZXNjXCIgfSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgY29udGVzdHMgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGZldGNoIGNvbnRlc3RzOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZmV0Y2ggY29udGVzdHNcIiB9O1xuICAgIH1cbn1cblxuXG4vKipcbiAqIEZldGNoZXMgYSBzaW5nbGUgY29udGVzdCdzIGRldGFpbHMgd2l0aCBhdXRob3JpemF0aW9uLlxuICovXG4vKipcbiAqIEZldGNoZXMgYSBzaW5nbGUgY29udGVzdCdzIGRldGFpbHMgd2l0aCBhdXRob3JpemF0aW9uLlxuICovXG4vKipcbiAqIENhY2hlZCBjb250ZXN0IGRldGFpbCBmZXRjaGVyXG4gKiBSZXR1cm5zIGNvbnRlc3QgZGF0YSB3aXRob3V0IHVzZXItc3BlY2lmaWMgY29udGV4dFxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRDYWNoZWRDb250ZXN0KGNvbnRlc3RJZDogc3RyaW5nKSB7XG4gICAgXCJ1c2UgY2FjaGVcIlxuICAgIGNhY2hlVGFnKGBjb250ZXN0LSR7Y29udGVzdElkfWApO1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBjYWNoZUxpZmUoXCJjb250ZXN0LWRldGFpbFwiKTtcblxuICAgIHJldHVybiBwcmlzbWEuY29udGVzdC5maW5kVW5pcXVlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6IGNvbnRlc3RJZCB9LFxuICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICBfY291bnQ6IHtcbiAgICAgICAgICAgICAgICBzZWxlY3Q6IHsgcHJvYmxlbXM6IHRydWUgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwcm9ibGVtczoge1xuICAgICAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICAgICAgcHJvYmxlbToge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlmZmljdWx0eTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbHVnOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9yZGVyQnk6IHsgb3JkZXI6IFwiYXNjXCIgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgfSk7XG59XG5cbi8qKlxuICogRmV0Y2hlcyBhIHNpbmdsZSBjb250ZXN0J3MgZGV0YWlscyB3aXRoIGF1dGhvcml6YXRpb24uXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRDb250ZXN0RGV0YWlsKGNvbnRlc3RJZDogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjb250ZXN0ID0gYXdhaXQgZ2V0Q2FjaGVkQ29udGVzdChjb250ZXN0SWQpO1xuXG4gICAgICAgIGlmICghY29udGVzdCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkNvbnRlc3Qgbm90IGZvdW5kXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gc2Vzc2lvbj8udXNlciBhcyBhbnk7XG4gICAgICAgIGNvbnN0IHBhcnRpY2lwYXRpb24gPSBjdXJyZW50VXNlciA/IGF3YWl0IHByaXNtYS5jb250ZXN0UGFydGljaXBhdGlvbi5maW5kVW5pcXVlKHtcbiAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgdXNlcklkX2NvbnRlc3RJZDoge1xuICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IGN1cnJlbnRVc2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkgOiBudWxsO1xuXG4gICAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgICAgIGNvbnN0IGhhc1N0YXJ0ZWQgPSBub3cgPj0gY29udGVzdC5zdGFydFRpbWU7XG4gICAgICAgIGNvbnN0IGlzQ3JlYXRvciA9IGN1cnJlbnRVc2VyPy5pZCA9PT0gY29udGVzdC5jcmVhdG9ySWQ7XG4gICAgICAgIGNvbnN0IGlzQWRtaW4gPSBjdXJyZW50VXNlcj8ucm9sZSA9PT0gXCJBRE1JTlwiO1xuXG4gICAgICAgIC8vIFZpc2liaWxpdHkgQ2hlY2tcbiAgICAgICAgbGV0IGlzQXV0aG9yaXplZCA9IGZhbHNlO1xuICAgICAgICBpZiAoY29udGVzdC52aXNpYmlsaXR5ID09PSBcIlBVQkxJQ1wiKSB7XG4gICAgICAgICAgICBpc0F1dGhvcml6ZWQgPSB0cnVlO1xuICAgICAgICB9IGVsc2UgaWYgKGlzQWRtaW4pIHtcbiAgICAgICAgICAgIGlzQXV0aG9yaXplZCA9IHRydWU7XG4gICAgICAgIH0gZWxzZSBpZiAoY3VycmVudFVzZXIpIHtcbiAgICAgICAgICAgIGlmIChpc0NyZWF0b3IpIHtcbiAgICAgICAgICAgICAgICBpc0F1dGhvcml6ZWQgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChjb250ZXN0LnZpc2liaWxpdHkgPT09IFwiSU5TVElUVVRJT05cIikge1xuICAgICAgICAgICAgICAgIC8vIFVzZSA9PSBmb3IgbnVsbC91bmRlZmluZWQgbG9vc2UgZXF1YWxpdHkgY2hlY2tcbiAgICAgICAgICAgICAgICBpc0F1dGhvcml6ZWQgPSBjdXJyZW50VXNlci5pbnN0aXR1dGlvbklkID09IGNvbnRlc3QuaW5zdGl0dXRpb25JZDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoY29udGVzdC52aXNpYmlsaXR5ID09PSBcIkNMQVNTUk9PTVwiKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZW5yb2xsbWVudCA9IGF3YWl0IHByaXNtYS5jbGFzc3Jvb20uZmluZEZpcnN0KHtcbiAgICAgICAgICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBjb250ZXN0LmNsYXNzcm9vbUlkIGFzIHN0cmluZyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0dWRlbnRzOiB7IHNvbWU6IHsgaWQ6IGN1cnJlbnRVc2VyLmlkIH0gfSxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpc0F1dGhvcml6ZWQgPSAhIWVucm9sbG1lbnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIWlzQXV0aG9yaXplZCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZCBhY2Nlc3MgdG8gdGhpcyBjb250ZXN0LlwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBjYW5TZWVQcm9ibGVtcyA9IChoYXNTdGFydGVkIHx8IGlzQWRtaW4gfHwgaXNDcmVhdG9yKSAmJiAocGFydGljaXBhdGlvbj8uYWNjZXB0ZWRSdWxlcyB8fCBpc0NyZWF0b3IgfHwgaXNBZG1pbik7XG5cbiAgICAgICAgLy8gRml4OiBJZiB0aGUgY29udGVzdCBpcyBvdmVyLCBhbGxvd2VkIHJvbGVzIHNob3VsZCBjaGVjayBwYXJ0aWNpcGF0aW9uIHByb3Blcmx5LFxuICAgICAgICAvLyBidXQgdHlwaWNhbGx5IGFsbG93cyB2aWV3aW5nIGlmIHB1YmxpYy9hdXRob3JpemVkLlxuICAgICAgICAvLyBCdXQgZm9yIFwiTGl2ZVwiIGNvbnRlc3RzLCB0aGUgY3VycmVudCBsb2dpYyBpcyBjb3JyZWN0LlxuXG4gICAgICAgIGNvbnN0IHJlcXVpcmVzUGFzc3dvcmQgPSAhIWNvbnRlc3QuY29udGVzdFBhc3N3b3JkO1xuXG4gICAgICAgIC8vIFNodWZmbGUgcHJvYmxlbXMgaWYgcmFuZG9taXplUXVlc3Rpb25zIGlzIGVuYWJsZWRcbiAgICAgICAgLy8gVXNlIGEgc2ltcGxlIHNlZWRlZCBzaHVmZmxlIGJhc2VkIG9uIHVzZXJJZCArIGNvbnRlc3RJZCBmb3IgY29uc2lzdGVuY3lcbiAgICAgICAgbGV0IHZpc2libGVQcm9ibGVtcyA9IGNhblNlZVByb2JsZW1zID8gY29udGVzdC5wcm9ibGVtcyA6IFtdO1xuXG4gICAgICAgIGlmIChjb250ZXN0LnJhbmRvbWl6ZVF1ZXN0aW9ucyAmJiBjdXJyZW50VXNlciAmJiB2aXNpYmxlUHJvYmxlbXMubGVuZ3RoID4gMCAmJiAhaXNBZG1pbiAmJiAhaXNDcmVhdG9yKSB7XG4gICAgICAgICAgICAvLyBTaW1wbGUgc3RyaW5nIGhhc2ggZnVuY3Rpb24gZm9yIHNlZWRpbmdcbiAgICAgICAgICAgIGNvbnN0IHNlZWRTdHIgPSBgJHtjdXJyZW50VXNlci5pZH0tJHtjb250ZXN0SWR9YDtcbiAgICAgICAgICAgIGxldCBzZWVkID0gMDtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2VlZFN0ci5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHNlZWQgPSAoKHNlZWQgPDwgNSkgLSBzZWVkKSArIHNlZWRTdHIuY2hhckNvZGVBdChpKTtcbiAgICAgICAgICAgICAgICBzZWVkIHw9IDA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIERldGVybWluaXN0aWMgc2h1ZmZsZVxuICAgICAgICAgICAgdmlzaWJsZVByb2JsZW1zID0gWy4uLnZpc2libGVQcm9ibGVtc10uc29ydCgoYSwgYikgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHggPSBNYXRoLnNpbihzZWVkKyspICogMTAwMDA7XG4gICAgICAgICAgICAgICAgcmV0dXJuICh4IC0gTWF0aC5mbG9vcih4KSkgLSAwLjU7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEZldGNoIHVzZXIncyBzb2x2ZWQgcHJvYmxlbXMgZm9yIHRoaXMgY29udGVzdFxuICAgICAgICBjb25zdCBzb2x2ZWRQcm9ibGVtSWRzID0gbmV3IFNldDxzdHJpbmc+KCk7XG4gICAgICAgIGlmIChjdXJyZW50VXNlcikge1xuICAgICAgICAgICAgY29uc3Qgc29sdmVkU3VibWlzc2lvbnMgPSBhd2FpdCBwcmlzbWEuc3VibWlzc2lvbi5maW5kTWFueSh7XG4gICAgICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkOiBjdXJyZW50VXNlci5pZCxcbiAgICAgICAgICAgICAgICAgICAgY29udGVzdElkOiBjb250ZXN0SWQsXG4gICAgICAgICAgICAgICAgICAgIHN0YXR1czogXCJBQ0NFUFRFRFwiLFxuICAgICAgICAgICAgICAgICAgICBwcm9ibGVtSWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGluOiB2aXNpYmxlUHJvYmxlbXMubWFwKHAgPT4gcC5wcm9ibGVtLmlkKVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBzZWxlY3Q6IHsgcHJvYmxlbUlkOiB0cnVlIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgc29sdmVkU3VibWlzc2lvbnMuZm9yRWFjaChzID0+IHNvbHZlZFByb2JsZW1JZHMuYWRkKHMucHJvYmxlbUlkKSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRlc3Q6IHtcbiAgICAgICAgICAgICAgICAuLi5jb250ZXN0LFxuICAgICAgICAgICAgICAgIHByb2JsZW1zOiB2aXNpYmxlUHJvYmxlbXMubWFwKHZwID0+ICh7XG4gICAgICAgICAgICAgICAgICAgIC4uLnZwLFxuICAgICAgICAgICAgICAgICAgICBpc1NvbHZlZDogc29sdmVkUHJvYmxlbUlkcy5oYXModnAucHJvYmxlbS5pZClcbiAgICAgICAgICAgICAgICB9KSksXG4gICAgICAgICAgICAgICAgaGFzU3RhcnRlZCxcbiAgICAgICAgICAgICAgICBoYXNFbmRlZDogbm93ID4gY29udGVzdC5lbmRUaW1lLFxuICAgICAgICAgICAgICAgIGNhbk1hbmFnZTogaXNBZG1pbiB8fCBpc0NyZWF0b3IsXG4gICAgICAgICAgICAgICAgaGFzQWNjZXB0ZWRSdWxlczogcGFydGljaXBhdGlvbj8uYWNjZXB0ZWRSdWxlcyB8fCBmYWxzZSxcbiAgICAgICAgICAgICAgICBpc0ZpbmlzaGVkOiBwYXJ0aWNpcGF0aW9uPy5pc0ZpbmlzaGVkIHx8IGZhbHNlLFxuICAgICAgICAgICAgICAgIHJlcXVpcmVzUGFzc3dvcmQsXG4gICAgICAgICAgICAgICAgY29udGVzdFBhc3N3b3JkOiBudWxsLCAvLyBOZXZlciByZXR1cm4gcGxhaW4gcGFzc3dvcmRcbiAgICAgICAgICAgICAgICBzZXNzaW9uSWQ6IHBhcnRpY2lwYXRpb24/LnNlc3Npb25JZCAvLyBSZXR1cm4gc2Vzc2lvbklkIGZvciBwcm90ZWN0aW9uXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBmZXRjaCBjb250ZXN0IGRldGFpbDpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGZldGNoIGNvbnRlc3RcIiB9O1xuICAgIH1cbn1cblxuLy8gLi4uIGV4aXN0aW5nIGNvZGUgLi4uXG5cbi8vIC4uLiBleGlzdGluZyBjb2RlIC4uLlxuXG4vLyAuLi4gZXhpc3RpbmcgY29kZSAuLi5cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUNvbnRlc3QoZGF0YTogei5pbmZlcjx0eXBlb2YgY29udGVzdFNjaGVtYT4pIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIGlmICghc2Vzc2lvbj8udXNlcikge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcbiAgICB9XG5cbiAgICBjb25zdCBjdXJyZW50VXNlciA9IHNlc3Npb24udXNlciBhcyBhbnk7XG5cbiAgICBpZiAoIVtcIkFETUlOXCIsIFwiSU5TVElUVVRJT05fTUFOQUdFUlwiLCBcIkNPTlRFU1RfTUFOQUdFUlwiLCBcIlRFQUNIRVJcIl0uaW5jbHVkZXMoY3VycmVudFVzZXIucm9sZSkpIHtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgdmFsaWRhdGVkRGF0YSA9IGNvbnRlc3RTY2hlbWEucGFyc2UoZGF0YSk7XG5cbiAgICAgICAgLy8gR2VuZXJhdGUgYSBtb3JlIHJvYnVzdCB1bmlxdWUgc2x1Z1xuICAgICAgICBjb25zdCBiYXNlU2x1ZyA9IHZhbGlkYXRlZERhdGEudGl0bGUudG9Mb3dlckNhc2UoKS5yZXBsYWNlKC9bXmEtejAtOV0rL2csIFwiLVwiKS5yZXBsYWNlKC8oXi18LSQpL2csIFwiXCIpO1xuICAgICAgICBjb25zdCB1bmlxdWVTbHVnID0gYCR7YmFzZVNsdWd9LSR7RGF0ZS5ub3coKX1gO1xuXG4gICAgICAgIGNvbnN0IGNvbnRlc3QgPSBhd2FpdCBwcmlzbWEuY29udGVzdC5jcmVhdGUoe1xuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgIHRpdGxlOiB2YWxpZGF0ZWREYXRhLnRpdGxlLFxuICAgICAgICAgICAgICAgIHNsdWc6IHVuaXF1ZVNsdWcsXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHZhbGlkYXRlZERhdGEuZGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgc3RhcnRUaW1lOiB2YWxpZGF0ZWREYXRhLnN0YXJ0VGltZSxcbiAgICAgICAgICAgICAgICBlbmRUaW1lOiB2YWxpZGF0ZWREYXRhLmVuZFRpbWUsXG4gICAgICAgICAgICAgICAgdmlzaWJpbGl0eTogdmFsaWRhdGVkRGF0YS52aXNpYmlsaXR5IGFzIGFueSxcbiAgICAgICAgICAgICAgICBpbnN0aXR1dGlvbklkOiB2YWxpZGF0ZWREYXRhLnZpc2liaWxpdHkgIT09IFwiUFVCTElDXCIgPyAodmFsaWRhdGVkRGF0YS5pbnN0aXR1dGlvbklkIHx8IG51bGwpIDogbnVsbCxcbiAgICAgICAgICAgICAgICBjbGFzc3Jvb21JZDogdmFsaWRhdGVkRGF0YS52aXNpYmlsaXR5ID09PSBcIkNMQVNTUk9PTVwiID8gKHZhbGlkYXRlZERhdGEuY2xhc3Nyb29tSWQgfHwgbnVsbCkgOiBudWxsLFxuICAgICAgICAgICAgICAgIGNyZWF0b3JJZDogY3VycmVudFVzZXIuaWQsXG4gICAgICAgICAgICAgICAgY29udGVzdFBhc3N3b3JkOiB2YWxpZGF0ZWREYXRhLmNvbnRlc3RQYXNzd29yZCB8fCBudWxsLFxuICAgICAgICAgICAgICAgIHJhbmRvbWl6ZVF1ZXN0aW9uczogdmFsaWRhdGVkRGF0YS5yYW5kb21pemVRdWVzdGlvbnMgfHwgZmFsc2UsXG4gICAgICAgICAgICAgICAgcHJvYmxlbXM6IHtcbiAgICAgICAgICAgICAgICAgICAgY3JlYXRlOiB2YWxpZGF0ZWREYXRhLnByb2JsZW1zLm1hcCgocHJvYmxlbUlkLCBpbmRleCkgPT4gKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2JsZW1JZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG9yZGVyOiBpbmRleCxcbiAgICAgICAgICAgICAgICAgICAgfSkpLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcblxuICAgICAgICByZXZhbGlkYXRlUGF0aChcIi9kYXNoYm9hcmQvY29udGVzdHNcIik7XG4gICAgICAgIHJldmFsaWRhdGVQYXRoKFwiL2NvbnRlc3RcIik7XG4gICAgICAgIHJldmFsaWRhdGVUYWcoXCJjb250ZXN0c1wiLCBcIm1heFwiKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgY29udGVzdElkOiBjb250ZXN0LmlkIH07XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBjb250ZXN0OlwiLCBlcnJvcik7XG4gICAgICAgIC8vIFJldHVybiBjbGVhcmVyIGVycm9yIG1lc3NhZ2VzXG4gICAgICAgIGxldCBlcnJvck1lc3NhZ2UgPSBcIkZhaWxlZCB0byBjcmVhdGUgY29udGVzdFwiO1xuICAgICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiB6LlpvZEVycm9yKSB7XG4gICAgICAgICAgICAgZXJyb3JNZXNzYWdlID0gKGVycm9yIGFzIGFueSkuZXJyb3JzLm1hcCgoZTogYW55KSA9PiBlLm1lc3NhZ2UpLmpvaW4oXCIsIFwiKTtcbiAgICAgICAgfSBlbHNlIGlmIChlcnJvciBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgICAgICAgICAgZXJyb3JNZXNzYWdlID0gZXJyb3IubWVzc2FnZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVycm9yTWVzc2FnZSB9O1xuICAgIH1cbiAgICB9XG5cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUNvbnRlc3RXaXRoUHJvYmxlbXMoZGF0YTogei5pbmZlcjx0eXBlb2YgY29udGVzdFdpdGhQcm9ibGVtc1NjaGVtYT4pIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIGlmICghc2Vzc2lvbj8udXNlcikge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcbiAgICB9XG5cbiAgICBjb25zdCBjdXJyZW50VXNlciA9IHNlc3Npb24udXNlciBhcyBhbnk7XG5cbiAgICBpZiAoIVtcIkFETUlOXCIsIFwiSU5TVElUVVRJT05fTUFOQUdFUlwiLCBcIkNPTlRFU1RfTUFOQUdFUlwiLCBcIlRFQUNIRVJcIl0uaW5jbHVkZXMoY3VycmVudFVzZXIucm9sZSkpIHtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgdmFsaWRhdGVkRGF0YSA9IGNvbnRlc3RXaXRoUHJvYmxlbXNTY2hlbWEucGFyc2UoZGF0YSk7XG5cbiAgICAgICAgY29uc3QgY29udGVzdCA9IGF3YWl0IHByaXNtYS4kdHJhbnNhY3Rpb24oYXN5bmMgKHR4KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjb250ZXN0ID0gYXdhaXQgdHguY29udGVzdC5jcmVhdGUoe1xuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHZhbGlkYXRlZERhdGEudGl0bGUsXG4gICAgICAgICAgICAgICAgICAgIHNsdWc6IHZhbGlkYXRlZERhdGEuc2x1ZyxcbiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHZhbGlkYXRlZERhdGEuZGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0VGltZTogdmFsaWRhdGVkRGF0YS5zdGFydFRpbWUsXG4gICAgICAgICAgICAgICAgICAgIGVuZFRpbWU6IHZhbGlkYXRlZERhdGEuZW5kVGltZSxcbiAgICAgICAgICAgICAgICAgICAgdmlzaWJpbGl0eTogdmFsaWRhdGVkRGF0YS52aXNpYmlsaXR5IGFzIGFueSxcbiAgICAgICAgICAgICAgICAgICAgaGlkZGVuOiB2YWxpZGF0ZWREYXRhLmhpZGRlbixcbiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZEltYWdlOiB2YWxpZGF0ZWREYXRhLmJhY2tncm91bmRJbWFnZSxcbiAgICAgICAgICAgICAgICAgICAgcHJpemVzOiB2YWxpZGF0ZWREYXRhLnByaXplcyxcbiAgICAgICAgICAgICAgICAgICAgcnVsZXM6IHZhbGlkYXRlZERhdGEucnVsZXMsXG4gICAgICAgICAgICAgICAgICAgIGluc3RpdHV0aW9uSWQ6IHZhbGlkYXRlZERhdGEudmlzaWJpbGl0eSAhPT0gXCJQVUJMSUNcIiA/ICh2YWxpZGF0ZWREYXRhLmluc3RpdHV0aW9uSWQgfHwgbnVsbCkgOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICBjbGFzc3Jvb21JZDogdmFsaWRhdGVkRGF0YS52aXNpYmlsaXR5ID09PSBcIkNMQVNTUk9PTVwiID8gKHZhbGlkYXRlZERhdGEuY2xhc3Nyb29tSWQgfHwgbnVsbCkgOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICBjcmVhdG9ySWQ6IGN1cnJlbnRVc2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0UGFzc3dvcmQ6IHZhbGlkYXRlZERhdGEuY29udGVzdFBhc3N3b3JkIHx8IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIHJhbmRvbWl6ZVF1ZXN0aW9uczogdmFsaWRhdGVkRGF0YS5yYW5kb21pemVRdWVzdGlvbnMgfHwgZmFsc2UsXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmFsaWRhdGVkRGF0YS5wcm9ibGVtcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGNvbnN0IHAgPSB2YWxpZGF0ZWREYXRhLnByb2JsZW1zW2ldO1xuICAgICAgICAgICAgICAgIC8vIEdlbmVyYXRlIHVuaXF1ZSBzbHVnIGJ5IGFwcGVuZGluZyBjb250ZXN0IHNsdWcgYW5kIGluZGV4XG4gICAgICAgICAgICAgICAgY29uc3QgdW5pcXVlU2x1ZyA9IGAke3ZhbGlkYXRlZERhdGEuc2x1Z30tJHtwLnNsdWcgfHwgcC50aXRsZS50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoL1xccysvZywgJy0nKX0tJHtEYXRlLm5vdygpfS0ke2l9YDtcbiAgICAgICAgICAgICAgICBjb25zdCBwcm9ibGVtID0gYXdhaXQgdHgucHJvYmxlbS5jcmVhdGUoe1xuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogcC50aXRsZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBwLmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGlmZmljdWx0eTogcC5kaWZmaWN1bHR5LFxuICAgICAgICAgICAgICAgICAgICAgICAgc2x1ZzogdW5pcXVlU2x1ZyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3JlOiBwLnNjb3JlIHx8IDEwLFxuICAgICAgICAgICAgICAgICAgICAgICAgZG9tYWluOiBwLmRvbWFpbixcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiQ09OVEVTVFwiLCAvLyBDb250ZXN0IHByb2JsZW1zIGFyZSBtYXJrZWQgc2VwYXJhdGVseVxuICAgICAgICAgICAgICAgICAgICAgICAgaGlkZGVuOiB0cnVlLCAvLyBDb250ZXN0IHByb2JsZW1zIGFyZSBoaWRkZW4gZnJvbSBtYWluIGJhbmtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlc3RDYXNlczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZTogcC50ZXN0Q2FzZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgdGFnczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbm5lY3Q6IHAudGFncz8ubWFwKCh0OiBzdHJpbmcpID0+ICh7IG5hbWU6IHQgfSkpIHx8IFtdLFxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBhd2FpdCB0eC5jb250ZXN0UHJvYmxlbS5jcmVhdGUoe1xuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3QuaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9ibGVtSWQ6IHByb2JsZW0uaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBvcmRlcjogaSxcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gY29udGVzdDtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL2NvbnRlc3RzXCIpO1xuICAgICAgICByZXZhbGlkYXRlUGF0aChcIi9jb250ZXN0c1wiKTtcbiAgICAgICAgcmV2YWxpZGF0ZVBhdGgoXCIvY29udGVzdFwiKTtcbiAgICAgICAgcmV2YWxpZGF0ZVRhZyhcImNvbnRlc3RzXCIsIFwibWF4XCIpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBjb250ZXN0SWQ6IGNvbnRlc3QuaWQgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBjb250ZXN0IHdpdGggcHJvYmxlbXM6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBjcmVhdGUgY29udGVzdFwiIH07XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0SW5zdGl0dXRpb25hbENsYXNzcm9vbXMoaW5zdGl0dXRpb25JZDogc3RyaW5nKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgY2xhc3Nyb29tcyA9IGF3YWl0IHByaXNtYS5jbGFzc3Jvb20uZmluZE1hbnkoe1xuICAgICAgICAgICAgd2hlcmU6IHsgaW5zdGl0dXRpb25JZCB9LFxuICAgICAgICAgICAgc2VsZWN0OiB7IGlkOiB0cnVlLCBuYW1lOiB0cnVlLCBzZWN0aW9uOiB0cnVlIH0sXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBjbGFzc3Jvb21zIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBmZXRjaCBjbGFzc3Jvb21zOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZmV0Y2ggY2xhc3Nyb29tc1wiIH07XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0U2VsZWN0YWJsZVByb2JsZW1zKHNlYXJjaDogc3RyaW5nKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcHJvYmxlbXMgPSBhd2FpdCBwcmlzbWEucHJvYmxlbS5maW5kTWFueSh7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgIE9SOiBbXG4gICAgICAgICAgICAgICAgICAgIHsgdGl0bGU6IHsgY29udGFpbnM6IHNlYXJjaCwgbW9kZTogXCJpbnNlbnNpdGl2ZVwiIH0gfSxcbiAgICAgICAgICAgICAgICAgICAgeyBzbHVnOiB7IGNvbnRhaW5zOiBzZWFyY2gsIG1vZGU6IFwiaW5zZW5zaXRpdmVcIiB9IH0sXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBoaWRkZW46IGZhbHNlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNlbGVjdDogeyBpZDogdHJ1ZSwgdGl0bGU6IHRydWUsIGRpZmZpY3VsdHk6IHRydWUsIHNsdWc6IHRydWUgfSxcbiAgICAgICAgICAgIHRha2U6IDEwLFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgcHJvYmxlbXMgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGZldGNoIHByb2JsZW1zOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZmV0Y2ggcHJvYmxlbXNcIiB9O1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGFjY2VwdENvbnRlc3RSdWxlcyhjb250ZXN0SWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcblxuICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHByaXNtYS5jb250ZXN0UGFydGljaXBhdGlvbi51cHNlcnQoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1cGRhdGU6IHsgYWNjZXB0ZWRSdWxlczogdHJ1ZSB9LFxuICAgICAgICAgICAgY3JlYXRlOiB7XG4gICAgICAgICAgICAgICAgdXNlcklkOiBzZXNzaW9uLnVzZXIuaWQsXG4gICAgICAgICAgICAgICAgY29udGVzdElkOiBjb250ZXN0SWQsXG4gICAgICAgICAgICAgICAgYWNjZXB0ZWRSdWxlczogdHJ1ZVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV2YWxpZGF0ZVBhdGgoYC9jb250ZXN0LyR7Y29udGVzdElkfWApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBhY2NlcHQgcnVsZXNcIiB9O1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGZpbmlzaENvbnRlc3RBY3Rpb24oY29udGVzdElkOiBzdHJpbmcpIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIGlmICghc2Vzc2lvbj8udXNlcikgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG5cbiAgICB0cnkge1xuICAgICAgICBhd2FpdCBwcmlzbWEuY29udGVzdFBhcnRpY2lwYXRpb24udXBzZXJ0KHtcbiAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgdXNlcklkX2NvbnRlc3RJZDoge1xuICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IHNlc3Npb24udXNlci5pZCxcbiAgICAgICAgICAgICAgICAgICAgY29udGVzdElkOiBjb250ZXN0SWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdXBkYXRlOiB7XG4gICAgICAgICAgICAgICAgaXNGaW5pc2hlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBmaW5pc2hlZEF0OiBuZXcgRGF0ZSgpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY3JlYXRlOiB7XG4gICAgICAgICAgICAgICAgdXNlcklkOiBzZXNzaW9uLnVzZXIuaWQsXG4gICAgICAgICAgICAgICAgY29udGVzdElkOiBjb250ZXN0SWQsXG4gICAgICAgICAgICAgICAgYWNjZXB0ZWRSdWxlczogdHJ1ZSxcbiAgICAgICAgICAgICAgICBpc0ZpbmlzaGVkOiB0cnVlLFxuICAgICAgICAgICAgICAgIGZpbmlzaGVkQXQ6IG5ldyBEYXRlKClcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldmFsaWRhdGVQYXRoKGAvY29udGVzdC8ke2NvbnRlc3RJZH1gKTtcbiAgICAgICAgcmV2YWxpZGF0ZVBhdGgoYC9wcm9ibGVtc2ApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBmaW5pc2ggY29udGVzdFwiIH07XG4gICAgfVxufVxuXG4vKipcbiAqIEZpbmFsaXplIENvbnRlc3QgJiBBd2FyZCBCYWRnZXNcbiAqIC0gQ2FsY3VsYXRlcyBsZWFkZXJib2FyZFxuICogLSBBd2FyZHMgR29sZCwgU2lsdmVyLCBCcm9uemUgdG8gVG9wIDNcbiAqIC0gTWFya3MgY29udGVzdCBhcyBmaW5hbGl6ZWRcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGZpbmFsaXplQ29udGVzdChjb250ZXN0SWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcblxuICAgIC8vIE9ubHkgYWRtaW5zIG9yIGNvbnRlc3QgbWFuYWdlcnMgY2FuIGZpbmFsaXplXG4gICAgY29uc3QgY3VycmVudFVzZXIgPSBzZXNzaW9uLnVzZXIgYXMgYW55O1xuICAgIGlmICghW1wiQURNSU5cIiwgXCJDT05URVNUX01BTkFHRVJcIiwgXCJJTlNUSVRVVElPTl9NQU5BR0VSXCIsIFwiVEVBQ0hFUlwiXS5pbmNsdWRlcyhjdXJyZW50VXNlci5yb2xlKSkge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjb250ZXN0ID0gYXdhaXQgcHJpc21hLmNvbnRlc3QuZmluZFVuaXF1ZSh7XG4gICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IGNvbnRlc3RJZCB9LFxuICAgICAgICAgICAgIHNlbGVjdDogeyBpc0ZpbmFsaXplZDogdHJ1ZSwgdGl0bGU6IHRydWUgfVxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoIWNvbnRlc3QpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJDb250ZXN0IG5vdCBmb3VuZFwiIH07XG4gICAgICAgIGlmIChjb250ZXN0LmlzRmluYWxpemVkKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiQ29udGVzdCBpcyBhbHJlYWR5IGZpbmFsaXplZFwiIH07XG5cbiAgICAgICAgLy8gUmV1c2UgbGVhZGVyYm9hcmQgbG9naWMgdG8gZ2V0IHJhbmtpbmdzXG4gICAgICAgIGNvbnN0IGxlYWRlcmJvYXJkID0gYXdhaXQgZ2V0Q29udGVzdExlYWRlcmJvYXJkKGNvbnRlc3RJZCk7XG4gICAgICAgIGlmICghbGVhZGVyYm9hcmQuc3VjY2VzcyB8fCAhbGVhZGVyYm9hcmQuc3R1ZGVudHMpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZmV0Y2ggbGVhZGVyYm9hcmRcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgc3R1ZGVudHMgPSBsZWFkZXJib2FyZC5zdHVkZW50cyBhcyBhbnlbXTtcblxuICAgICAgICAvLyBBdCBsZWFzdCAxIHN0dWRlbnQgbmVlZGVkXG4gICAgICAgIGlmIChzdHVkZW50cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICBhd2FpdCBwcmlzbWEuY29udGVzdC51cGRhdGUoe1xuICAgICAgICAgICAgICAgICB3aGVyZTogeyBpZDogY29udGVzdElkIH0sXG4gICAgICAgICAgICAgICAgIGRhdGE6IHsgaXNGaW5hbGl6ZWQ6IHRydWUgfVxuICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIG1lc3NhZ2U6IFwiQ29udGVzdCBmaW5hbGl6ZWQgKG5vIHBhcnRpY2lwYW50cylcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVG9wIDMgSURzXG4gICAgICAgIGNvbnN0IGdvbGRVc2VySWQgPSBzdHVkZW50c1swXT8uaWQ7XG4gICAgICAgIGNvbnN0IHNpbHZlclVzZXJJZCA9IHN0dWRlbnRzWzFdPy5pZDtcbiAgICAgICAgY29uc3QgYnJvbnplVXNlcklkID0gc3R1ZGVudHNbMl0/LmlkO1xuXG4gICAgICAgIGF3YWl0IHByaXNtYS4kdHJhbnNhY3Rpb24oYXN5bmMgKHR4KSA9PiB7XG4gICAgICAgICAgICAvLyBBd2FyZCBHb2xkXG4gICAgICAgICAgICBpZiAoZ29sZFVzZXJJZCkge1xuICAgICAgICAgICAgICAgIGF3YWl0IHR4LnVzZXIudXBkYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IGdvbGRVc2VySWQgfSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogeyBnb2xkQmFkZ2VzOiB7IGluY3JlbWVudDogMSB9IH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIEF3YXJkIFNpbHZlclxuICAgICAgICAgICAgaWYgKHNpbHZlclVzZXJJZCkge1xuICAgICAgICAgICAgICAgIGF3YWl0IHR4LnVzZXIudXBkYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IHNpbHZlclVzZXJJZCB9LFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7IHNpbHZlckJhZGdlczogeyBpbmNyZW1lbnQ6IDEgfSB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBBd2FyZCBCcm9uemVcbiAgICAgICAgICAgIGlmIChicm9uemVVc2VySWQpIHtcbiAgICAgICAgICAgICAgICBhd2FpdCB0eC51c2VyLnVwZGF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIHdoZXJlOiB7IGlkOiBicm9uemVVc2VySWQgfSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogeyBicm9uemVCYWRnZXM6IHsgaW5jcmVtZW50OiAxIH0gfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBNYXJrIEZpbmFsaXplZFxuICAgICAgICAgICAgYXdhaXQgdHguY29udGVzdC51cGRhdGUoe1xuICAgICAgICAgICAgICAgIHdoZXJlOiB7IGlkOiBjb250ZXN0SWQgfSxcbiAgICAgICAgICAgICAgICBkYXRhOiB7IGlzRmluYWxpemVkOiB0cnVlIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICByZXZhbGlkYXRlUGF0aChgL2Rhc2hib2FyZGApO1xuICAgICAgICByZXZhbGlkYXRlUGF0aChgL3Byb2ZpbGUvJHtnb2xkVXNlcklkfWApO1xuICAgICAgICBpZihzaWx2ZXJVc2VySWQpIHJldmFsaWRhdGVQYXRoKGAvcHJvZmlsZS8ke3NpbHZlclVzZXJJZH1gKTtcbiAgICAgICAgaWYoYnJvbnplVXNlcklkKSByZXZhbGlkYXRlUGF0aChgL3Byb2ZpbGUvJHticm9uemVVc2VySWR9YCk7XG4gICAgICAgIHJldmFsaWRhdGVQYXRoKGAvY29udGVzdC8ke2NvbnRlc3RJZH1gKTtcbiAgICAgICAgcmV2YWxpZGF0ZVRhZyhgY29udGVzdC0ke2NvbnRlc3RJZH1gLCBcIm1heFwiKTtcbiAgICAgICAgcmV2YWxpZGF0ZVRhZyhgbGVhZGVyYm9hcmQtJHtjb250ZXN0SWR9YCwgXCJtYXhcIik7XG5cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gZmluYWxpemUgY29udGVzdDpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGZpbmFsaXplIGNvbnRlc3RcIiB9O1xuICAgIH1cbn1cblxuLyoqXG4gKiBWZXJpZnkgY29udGVzdCBwYXNzd29yZCB3aXRob3V0IHN0YXJ0aW5nIHNlc3Npb24uXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB2ZXJpZnlDb250ZXN0UGFzc3dvcmQoY29udGVzdElkOiBzdHJpbmcsIHBhc3N3b3JkPzogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICBpZiAoIXNlc3Npb24/LnVzZXIpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgY29udGVzdCA9IGF3YWl0IHByaXNtYS5jb250ZXN0LmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IGNvbnRlc3RJZCB9LFxuICAgICAgICAgICAgc2VsZWN0OiB7IGNvbnRlc3RQYXNzd29yZDogdHJ1ZSB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICghY29udGVzdCkgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkNvbnRlc3Qgbm90IGZvdW5kXCIgfTtcblxuICAgICAgICBpZiAoY29udGVzdC5jb250ZXN0UGFzc3dvcmQgJiYgY29udGVzdC5jb250ZXN0UGFzc3dvcmQgIT09IHBhc3N3b3JkKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiSW52YWxpZCBjb250ZXN0IHBhc3N3b3JkXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIHZlcmlmeSBjb250ZXN0IHBhc3N3b3JkOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gdmVyaWZ5IHBhc3N3b3JkXCIgfTtcbiAgICB9XG59XG5cblxuLyoqXG4gKiBTdGFydCBhIGNvbnRlc3Qgc2Vzc2lvbiAtIHZhbGlkYXRlcyB0aW1lIGJvdW5kcyBhbmQgY3JlYXRlcyBzZXNzaW9uIElEXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzdGFydENvbnRlc3RTZXNzaW9uKGNvbnRlc3RJZDogc3RyaW5nLCBwYXNzd29yZD86IHN0cmluZykge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcblxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRlc3QgPSBhd2FpdCBwcmlzbWEuY29udGVzdC5maW5kVW5pcXVlKHtcbiAgICAgICAgICAgIHdoZXJlOiB7IGlkOiBjb250ZXN0SWQgfSxcbiAgICAgICAgICAgIHNlbGVjdDogeyBzdGFydFRpbWU6IHRydWUsIGVuZFRpbWU6IHRydWUsIGNvbnRlc3RQYXNzd29yZDogdHJ1ZSB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICghY29udGVzdCkgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkNvbnRlc3Qgbm90IGZvdW5kXCIgfTtcblxuICAgICAgICBpZiAoY29udGVzdC5jb250ZXN0UGFzc3dvcmQgJiYgY29udGVzdC5jb250ZXN0UGFzc3dvcmQgIT09IHBhc3N3b3JkKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiSW52YWxpZCBjb250ZXN0IHBhc3N3b3JkXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG5cbiAgICAgICAgLy8gVGltZSBib3VuZHMgY2hlY2tcbiAgICAgICAgaWYgKG5vdyA8IGNvbnRlc3Quc3RhcnRUaW1lKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiQ29udGVzdCBoYXMgbm90IHN0YXJ0ZWQgeWV0XCIgfTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobm93ID4gY29udGVzdC5lbmRUaW1lKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiQ29udGVzdCBoYXMgYWxyZWFkeSBlbmRlZFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBHZW5lcmF0ZSB1bmlxdWUgc2Vzc2lvbiBJRFxuICAgICAgICBjb25zdCBzZXNzaW9uSWQgPSBgJHtzZXNzaW9uLnVzZXIuaWR9LSR7Y29udGVzdElkfS0ke0RhdGUubm93KCl9YDtcblxuICAgICAgICAvLyBDaGVjayBmb3IgZXhpc3RpbmcgYWN0aXZlIHNlc3Npb24gKG11bHRpLXRhYiBkZXRlY3Rpb24pXG4gICAgICAgIGNvbnN0IGV4aXN0aW5nUGFydGljaXBhdGlvbiA9IGF3YWl0IHByaXNtYS5jb250ZXN0UGFydGljaXBhdGlvbi5maW5kVW5pcXVlKHtcbiAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgdXNlcklkX2NvbnRlc3RJZDoge1xuICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IHNlc3Npb24udXNlci5pZCxcbiAgICAgICAgICAgICAgICAgICAgY29udGVzdElkOiBjb250ZXN0SWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChleGlzdGluZ1BhcnRpY2lwYXRpb24/LmlzQmxvY2tlZCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIllvdSBoYXZlIGJlZW4gYmxvY2tlZCBmcm9tIHRoaXMgY29udGVzdCBkdWUgdG8gdmlvbGF0aW9uc1wiIH07XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZXhpc3RpbmdQYXJ0aWNpcGF0aW9uPy5pc0ZpbmlzaGVkKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiWW91IGhhdmUgYWxyZWFkeSBmaW5pc2hlZCB0aGlzIGNvbnRlc3RcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVXBkYXRlIG9yIGNyZWF0ZSBwYXJ0aWNpcGF0aW9uIHdpdGggbmV3IHNlc3Npb25cbiAgICAgICAgY29uc3QgcGFydGljaXBhdGlvbiA9IGF3YWl0IHByaXNtYS5jb250ZXN0UGFydGljaXBhdGlvbi51cHNlcnQoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1cGRhdGU6IHtcbiAgICAgICAgICAgICAgICBzZXNzaW9uSWQsXG4gICAgICAgICAgICAgICAgc2Vzc2lvblN0YXJ0ZWRBdDogbm93LFxuICAgICAgICAgICAgICAgIGFjY2VwdGVkUnVsZXM6IHRydWVcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjcmVhdGU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWQ6IHNlc3Npb24udXNlci5pZCxcbiAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZCxcbiAgICAgICAgICAgICAgICBzZXNzaW9uSWQsXG4gICAgICAgICAgICAgICAgc2Vzc2lvblN0YXJ0ZWRBdDogbm93LFxuICAgICAgICAgICAgICAgIGFjY2VwdGVkUnVsZXM6IHRydWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgICBzZXNzaW9uSWQsXG4gICAgICAgICAgICBwYXJ0aWNpcGF0aW9uSWQ6IHBhcnRpY2lwYXRpb24uaWQsXG4gICAgICAgICAgICB0b3RhbFZpb2xhdGlvbnM6IHBhcnRpY2lwYXRpb24udG90YWxWaW9sYXRpb25zLFxuICAgICAgICAgICAgaXNGbGFnZ2VkOiBwYXJ0aWNpcGF0aW9uLmlzRmxhZ2dlZFxuICAgICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gc3RhcnQgY29udGVzdCBzZXNzaW9uOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gc3RhcnQgY29udGVzdCBzZXNzaW9uXCIgfTtcbiAgICB9XG59XG5cbi8qKlxuICogTG9nIGEgY29udGVzdCB2aW9sYXRpb24gLSByZWNvcmRzIHRvIGRhdGFiYXNlIGFuZCB1cGRhdGVzIGNvdW50ZXJzXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBsb2dDb250ZXN0VmlvbGF0aW9uKFxuICAgIGNvbnRlc3RJZDogc3RyaW5nLFxuICAgIHR5cGU6IFwiVEFCX1NXSVRDSFwiIHwgXCJGVUxMU0NSRUVOX0VYSVRcIiB8IFwiQ09QWV9QQVNURVwiIHwgXCJERVZUT09MU19PUEVOXCIgfCBcIktFWUJPQVJEX1NIT1JUQ1VUXCIgfCBcIk5BVklHQVRJT05fQVRURU1QVFwiIHwgXCJNVUxUSV9UQUJcIiB8IFwiU1VTUElDSU9VU19JTlBVVFwiLFxuICAgIG1lc3NhZ2U/OiBzdHJpbmcsXG4gICAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+XG4pIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIGlmICghc2Vzc2lvbj8udXNlcikgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBwYXJ0aWNpcGF0aW9uID0gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKCFwYXJ0aWNpcGF0aW9uKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiTm8gYWN0aXZlIHBhcnRpY2lwYXRpb24gZm91bmRcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gRGV0ZXJtaW5lIHdoaWNoIGNvdW50ZXIgdG8gaW5jcmVtZW50XG4gICAgICAgIGNvbnN0IGNvdW50ZXJGaWVsZCA9IHtcbiAgICAgICAgICAgIFRBQl9TV0lUQ0g6IFwidGFiU3dpdGNoQ291bnRcIixcbiAgICAgICAgICAgIEZVTExTQ1JFRU5fRVhJVDogXCJmdWxsc2NyZWVuRXhpdENvdW50XCIsXG4gICAgICAgICAgICBDT1BZX1BBU1RFOiBcImNvcHlQYXN0ZUNvdW50XCIsXG4gICAgICAgICAgICBERVZUT09MU19PUEVOOiBcImRldlRvb2xzQ291bnRcIixcbiAgICAgICAgICAgIEtFWUJPQVJEX1NIT1JUQ1VUOiBcImtleWJvYXJkQ291bnRcIixcbiAgICAgICAgICAgIE5BVklHQVRJT05fQVRURU1QVDogXCJuYXZpZ2F0aW9uQ291bnRcIixcbiAgICAgICAgICAgIE1VTFRJX1RBQjogXCJ0YWJTd2l0Y2hDb3VudFwiLFxuICAgICAgICAgICAgU1VTUElDSU9VU19JTlBVVDogXCJjb3B5UGFzdGVDb3VudFwiXG4gICAgICAgIH1bdHlwZV0gYXMgc3RyaW5nO1xuXG4gICAgICAgIC8vIFVzZSB0cmFuc2FjdGlvbiB0byBlbnN1cmUgYXRvbWljIHVwZGF0ZVxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBwcmlzbWEuJHRyYW5zYWN0aW9uKGFzeW5jICh0eCkgPT4ge1xuICAgICAgICAgICAgLy8gQ2hlY2sgbGFzdCB2aW9sYXRpb24gdGltZSB0byBwcmV2ZW50IHJhcGlkLWZpcmUgZHVwbGljYXRlcyAoU2VydmVyLXNpZGUgZGVib3VuY2UpXG4gICAgICAgICAgICBjb25zdCBsYXN0VmlvbGF0aW9uID0gYXdhaXQgdHguY29udGVzdFZpb2xhdGlvbi5maW5kRmlyc3Qoe1xuICAgICAgICAgICAgICAgIHdoZXJlOiB7IHBhcnRpY2lwYXRpb25JZDogcGFydGljaXBhdGlvbi5pZCB9LFxuICAgICAgICAgICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnZGVzYycgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmIChsYXN0VmlvbGF0aW9uKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdGltZURpZmYgPSBEYXRlLm5vdygpIC0gbGFzdFZpb2xhdGlvbi5jcmVhdGVkQXQuZ2V0VGltZSgpO1xuICAgICAgICAgICAgICAgIC8vIElmIGxlc3MgdGhhbiAyIHNlY29uZHMgc2luY2UgbGFzdCB2aW9sYXRpb24sIGlnbm9yZSB0aGlzIG9uZVxuICAgICAgICAgICAgICAgIGlmICh0aW1lRGlmZiA8IDIwMDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLnBhcnRpY2lwYXRpb24sIC8vIFJldHVybiBleGlzdGluZyBzdGF0ZVxuICAgICAgICAgICAgICAgICAgICAgICAgaXNGbGFnZ2VkOiBwYXJ0aWNpcGF0aW9uLmlzRmxhZ2dlZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzQmxvY2tlZDogcGFydGljaXBhdGlvbi5pc0Jsb2NrZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICB0b3RhbFZpb2xhdGlvbnM6IHBhcnRpY2lwYXRpb24udG90YWxWaW9sYXRpb25zLFxuICAgICAgICAgICAgICAgICAgICAgICAgcGVybWFuZW50bHlCbG9ja2VkOiBwYXJ0aWNpcGF0aW9uLnBlcm1hbmVudGx5QmxvY2tlZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBCbG9ja2VkVW50aWw6IHBhcnRpY2lwYXRpb24udGVtcEJsb2NrZWRVbnRpbFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQ3JlYXRlIHZpb2xhdGlvbiByZWNvcmRcbiAgICAgICAgICAgIGF3YWl0IHR4LmNvbnRlc3RWaW9sYXRpb24uY3JlYXRlKHtcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIHBhcnRpY2lwYXRpb25JZDogcGFydGljaXBhdGlvbi5pZCxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogdHlwZSBhcyBhbnksXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UsXG4gICAgICAgICAgICAgICAgICAgIG1ldGFkYXRhOiBtZXRhZGF0YSA/PyB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIG5ldyB0b3RhbCBhbmQgZGV0ZXJtaW5lIGJsb2NraW5nIHRpZXJcbiAgICAgICAgICAgIGNvbnN0IG5ld1RvdGFsVmlvbGF0aW9ucyA9IHBhcnRpY2lwYXRpb24udG90YWxWaW9sYXRpb25zICsgMTtcbiAgICAgICAgICAgIGNvbnN0IHNob3VsZEZsYWcgPSBuZXdUb3RhbFZpb2xhdGlvbnMgPj0gMztcblxuICAgICAgICAgICAgLy8gVGllcmVkIGJsb2NraW5nIGxvZ2ljXG4gICAgICAgICAgICBsZXQgdGVtcEJsb2NrZWRVbnRpbDogRGF0ZSB8IG51bGwgPSBudWxsO1xuICAgICAgICAgICAgbGV0IHBlcm1hbmVudGx5QmxvY2tlZCA9IGZhbHNlO1xuICAgICAgICAgICAgbGV0IGlzQmxvY2tlZCA9IGZhbHNlO1xuXG4gICAgICAgICAgICBpZiAobmV3VG90YWxWaW9sYXRpb25zID49IDYpIHtcbiAgICAgICAgICAgICAgICAvLyA2KyB2aW9sYXRpb25zID0gcGVybWFuZW50IGJsb2NrXG4gICAgICAgICAgICAgICAgcGVybWFuZW50bHlCbG9ja2VkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBpc0Jsb2NrZWQgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChuZXdUb3RhbFZpb2xhdGlvbnMgPj0gNCkge1xuICAgICAgICAgICAgICAgIC8vIDQtNSB2aW9sYXRpb25zID0gNSBtaW51dGUgdGVtcCBibG9ja1xuICAgICAgICAgICAgICAgIHRlbXBCbG9ja2VkVW50aWwgPSBuZXcgRGF0ZShEYXRlLm5vdygpICsgNSAqIDYwICogMTAwMCk7IC8vIDUgbWludXRlc1xuICAgICAgICAgICAgICAgIGlzQmxvY2tlZCA9IHRydWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZWQgPSBhd2FpdCB0eC5jb250ZXN0UGFydGljaXBhdGlvbi51cGRhdGUoe1xuICAgICAgICAgICAgICAgIHdoZXJlOiB7IGlkOiBwYXJ0aWNpcGF0aW9uLmlkIH0sXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBbY291bnRlckZpZWxkXTogeyBpbmNyZW1lbnQ6IDEgfSxcbiAgICAgICAgICAgICAgICAgICAgdG90YWxWaW9sYXRpb25zOiB7IGluY3JlbWVudDogMSB9LFxuICAgICAgICAgICAgICAgICAgICBpc0ZsYWdnZWQ6IHNob3VsZEZsYWcgfHwgcGFydGljaXBhdGlvbi5pc0ZsYWdnZWQsXG4gICAgICAgICAgICAgICAgICAgIGlzQmxvY2tlZCxcbiAgICAgICAgICAgICAgICAgICAgdGVtcEJsb2NrZWRVbnRpbCxcbiAgICAgICAgICAgICAgICAgICAgcGVybWFuZW50bHlCbG9ja2VkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiB1cGRhdGVkO1xuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgIHRvdGFsVmlvbGF0aW9uczogcmVzdWx0LnRvdGFsVmlvbGF0aW9ucyxcbiAgICAgICAgICAgIGlzRmxhZ2dlZDogcmVzdWx0LmlzRmxhZ2dlZCxcbiAgICAgICAgICAgIGlzQmxvY2tlZDogcmVzdWx0LmlzQmxvY2tlZCxcbiAgICAgICAgICAgIHRlbXBCbG9ja2VkVW50aWw6IHJlc3VsdC50ZW1wQmxvY2tlZFVudGlsPy50b0lTT1N0cmluZygpIHx8IG51bGwsXG4gICAgICAgICAgICBwZXJtYW5lbnRseUJsb2NrZWQ6IHJlc3VsdC5wZXJtYW5lbnRseUJsb2NrZWRcbiAgICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGxvZyB2aW9sYXRpb246XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBsb2cgdmlvbGF0aW9uXCIgfTtcbiAgICB9XG59XG5cbi8qKlxuICogVmFsaWRhdGUgY29udGVzdCBzZXNzaW9uIC0gY2hlY2tzIGlmIHNlc3Npb24gaXMgdmFsaWQgZm9yIHN1Ym1pc3Npb25zXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB2YWxpZGF0ZUNvbnRlc3RTZXNzaW9uKGNvbnRlc3RJZDogc3RyaW5nLCBzZXNzaW9uSWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgdmFsaWQ6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcGFydGljaXBhdGlvbiA9IGF3YWl0IHByaXNtYS5jb250ZXN0UGFydGljaXBhdGlvbi5maW5kVW5pcXVlKHtcbiAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgdXNlcklkX2NvbnRlc3RJZDoge1xuICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IHNlc3Npb24udXNlci5pZCxcbiAgICAgICAgICAgICAgICAgICAgY29udGVzdElkOiBjb250ZXN0SWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgIGNvbnRlc3Q6IHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0OiB7IHN0YXJ0VGltZTogdHJ1ZSwgZW5kVGltZTogdHJ1ZSB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoIXBhcnRpY2lwYXRpb24pIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHZhbGlkOiBmYWxzZSwgcmVhc29uOiBcIk5vIHBhcnRpY2lwYXRpb24gZm91bmRcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ2hlY2sgaWYgYmxvY2tlZFxuICAgICAgICBpZiAocGFydGljaXBhdGlvbi5pc0Jsb2NrZWQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHZhbGlkOiBmYWxzZSwgcmVhc29uOiBcIkJsb2NrZWQgZHVlIHRvIHZpb2xhdGlvbnNcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ2hlY2sgaWYgZmluaXNoZWRcbiAgICAgICAgaWYgKHBhcnRpY2lwYXRpb24uaXNGaW5pc2hlZCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgdmFsaWQ6IGZhbHNlLCByZWFzb246IFwiQ29udGVzdCBhbHJlYWR5IGZpbmlzaGVkXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENoZWNrIHNlc3Npb24gSUQgKG11bHRpLXRhYiBkZXRlY3Rpb24pXG4gICAgICAgIGlmIChwYXJ0aWNpcGF0aW9uLnNlc3Npb25JZCAhPT0gc2Vzc2lvbklkKSB7XG4gICAgICAgICAgICAvLyBMb2cgbXVsdGktdGFiIHZpb2xhdGlvblxuICAgICAgICAgICAgYXdhaXQgbG9nQ29udGVzdFZpb2xhdGlvbihjb250ZXN0SWQsIFwiTVVMVElfVEFCXCIsIFwiTXVsdGlwbGUgdGFicyBkZXRlY3RlZFwiKTtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHZhbGlkOiBmYWxzZSwgcmVhc29uOiBcIlNlc3Npb24gbWlzbWF0Y2ggLSBwb3NzaWJsZSBtdWx0aXBsZSB0YWJzXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENoZWNrIHRpbWUgYm91bmRzXG4gICAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgICAgIGlmIChub3cgPiBwYXJ0aWNpcGF0aW9uLmNvbnRlc3QuZW5kVGltZSkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgdmFsaWQ6IGZhbHNlLCByZWFzb246IFwiQ29udGVzdCBoYXMgZW5kZWRcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgICB2YWxpZDogdHJ1ZSxcbiAgICAgICAgICAgIHRvdGFsVmlvbGF0aW9uczogcGFydGljaXBhdGlvbi50b3RhbFZpb2xhdGlvbnMsXG4gICAgICAgICAgICBpc0ZsYWdnZWQ6IHBhcnRpY2lwYXRpb24uaXNGbGFnZ2VkXG4gICAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byB2YWxpZGF0ZSBzZXNzaW9uOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCB2YWxpZDogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byB2YWxpZGF0ZSBzZXNzaW9uXCIgfTtcbiAgICB9XG59XG5cbi8qKlxuICogQ2hlY2sgaWYgdXNlciBpcyBlbGlnaWJsZSB0byBzdWJtaXQgLSBwcmUtc3VibWlzc2lvbiB2YWxpZGF0aW9uXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjaGVja1N1Ym1pc3Npb25FbGlnaWJpbGl0eShjb250ZXN0SWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBlbGlnaWJsZTogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBwYXJ0aWNpcGF0aW9uID0gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgY29udGVzdDoge1xuICAgICAgICAgICAgICAgICAgICBzZWxlY3Q6IHsgc3RhcnRUaW1lOiB0cnVlLCBlbmRUaW1lOiB0cnVlIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICghcGFydGljaXBhdGlvbikge1xuICAgICAgICAgICAgcmV0dXJuIHsgZWxpZ2libGU6IGZhbHNlLCByZWFzb246IFwiTm8gcGFydGljaXBhdGlvbiBmb3VuZFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDaGVjayB2YXJpb3VzIGNvbmRpdGlvbnNcbiAgICAgICAgaWYgKHBhcnRpY2lwYXRpb24uaXNCbG9ja2VkKSB7XG4gICAgICAgICAgICByZXR1cm4geyBlbGlnaWJsZTogZmFsc2UsIHJlYXNvbjogXCJCbG9ja2VkIGR1ZSB0byBleGNlc3NpdmUgdmlvbGF0aW9uc1wiIH07XG4gICAgICAgIH1cblxuICAgICAgICBpZiAocGFydGljaXBhdGlvbi5pc0ZpbmlzaGVkKSB7XG4gICAgICAgICAgICByZXR1cm4geyBlbGlnaWJsZTogZmFsc2UsIHJlYXNvbjogXCJZb3UgaGF2ZSBhbHJlYWR5IGZpbmlzaGVkIHRoaXMgY29udGVzdFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICAgICAgICBpZiAobm93IDwgcGFydGljaXBhdGlvbi5jb250ZXN0LnN0YXJ0VGltZSkge1xuICAgICAgICAgICAgcmV0dXJuIHsgZWxpZ2libGU6IGZhbHNlLCByZWFzb246IFwiQ29udGVzdCBoYXMgbm90IHN0YXJ0ZWRcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG5vdyA+IHBhcnRpY2lwYXRpb24uY29udGVzdC5lbmRUaW1lKSB7XG4gICAgICAgICAgICByZXR1cm4geyBlbGlnaWJsZTogZmFsc2UsIHJlYXNvbjogXCJDb250ZXN0IGhhcyBlbmRlZFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZWxpZ2libGU6IHRydWUsXG4gICAgICAgICAgICB3YXJuaW5nczogcGFydGljaXBhdGlvbi5pc0ZsYWdnZWQgPyBbXCJZb3VyIHNlc3Npb24gaGFzIGJlZW4gZmxhZ2dlZCBmb3IgcmV2aWV3XCJdIDogW11cbiAgICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGNoZWNrIGVsaWdpYmlsaXR5OlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IGVsaWdpYmxlOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGNoZWNrIGVsaWdpYmlsaXR5XCIgfTtcbiAgICB9XG59XG5cbi8qKlxuICogR2V0IHBhcnRpY2lwYXRpb24gc3RhdHVzIC0gZm9yIFVJIHN0YXRlXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRQYXJ0aWNpcGF0aW9uU3RhdHVzKGNvbnRlc3RJZDogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICBpZiAoIXNlc3Npb24/LnVzZXIpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcGFydGljaXBhdGlvbiA9IGF3YWl0IHByaXNtYS5jb250ZXN0UGFydGljaXBhdGlvbi5maW5kVW5pcXVlKHtcbiAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgdXNlcklkX2NvbnRlc3RJZDoge1xuICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IHNlc3Npb24udXNlci5pZCxcbiAgICAgICAgICAgICAgICAgICAgY29udGVzdElkOiBjb250ZXN0SWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgYWNjZXB0ZWRSdWxlczogdHJ1ZSxcbiAgICAgICAgICAgICAgICBpc0ZpbmlzaGVkOiB0cnVlLFxuICAgICAgICAgICAgICAgIGlzRmxhZ2dlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBpc0Jsb2NrZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgdG90YWxWaW9sYXRpb25zOiB0cnVlLFxuICAgICAgICAgICAgICAgIHNlc3Npb25JZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICB0ZW1wQmxvY2tlZFVudGlsOiB0cnVlLFxuICAgICAgICAgICAgICAgIHBlcm1hbmVudGx5QmxvY2tlZDogdHJ1ZVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBDaGVjayBpZiB0ZW1wIGJsb2NrIGhhcyBleHBpcmVkXG4gICAgICAgIGlmIChwYXJ0aWNpcGF0aW9uPy50ZW1wQmxvY2tlZFVudGlsICYmIG5ldyBEYXRlKCkgPiBwYXJ0aWNpcGF0aW9uLnRlbXBCbG9ja2VkVW50aWwpIHtcbiAgICAgICAgICAgIC8vIFRlbXAgYmxvY2sgZXhwaXJlZCAtIHVuYmxvY2tcbiAgICAgICAgICAgIGF3YWl0IHByaXNtYS5jb250ZXN0UGFydGljaXBhdGlvbi51cGRhdGUoe1xuICAgICAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZF9jb250ZXN0SWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGVzdElkOiBjb250ZXN0SWRcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBpc0Jsb2NrZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wQmxvY2tlZFVudGlsOiBudWxsXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgICAgICBwYXJ0aWNpcGF0aW9uOiB7XG4gICAgICAgICAgICAgICAgICAgIC4uLnBhcnRpY2lwYXRpb24sXG4gICAgICAgICAgICAgICAgICAgIGlzQmxvY2tlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBCbG9ja2VkVW50aWw6IG51bGxcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgICBwYXJ0aWNpcGF0aW9uOiBwYXJ0aWNpcGF0aW9uIHx8IG51bGxcbiAgICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGdldCBwYXJ0aWNpcGF0aW9uIHN0YXR1c1wiIH07XG4gICAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gQ09OVEVTVCBNQU5BR0VSIC0gUEFSVElDSVBBTlQgTUFOQUdFTUVOVFxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLyoqXG4gKiBHZXQgYWxsIHBhcnRpY2lwYW50cyBmb3IgYSBjb250ZXN0IHdpdGggdmlvbGF0aW9uIGRldGFpbHMgKGZvciBtYW5hZ2VycylcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldENvbnRlc3RQYXJ0aWNpcGFudHMoY29udGVzdElkOiBzdHJpbmcpIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIGlmICghc2Vzc2lvbj8udXNlcikgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG5cbiAgICBjb25zdCBjdXJyZW50VXNlciA9IHNlc3Npb24udXNlciBhcyBhbnk7XG5cbiAgICAvLyBDaGVjayBpZiB1c2VyIGlzIGNvbnRlc3QgbWFuYWdlci9jcmVhdG9yXG4gICAgY29uc3QgY29udGVzdCA9IGF3YWl0IHByaXNtYS5jb250ZXN0LmZpbmRVbmlxdWUoe1xuICAgICAgICB3aGVyZTogeyBpZDogY29udGVzdElkIH0sXG4gICAgICAgIHNlbGVjdDogeyBjcmVhdG9ySWQ6IHRydWUgfVxuICAgIH0pO1xuXG4gICAgaWYgKCFjb250ZXN0KSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiQ29udGVzdCBub3QgZm91bmRcIiB9O1xuXG4gICAgY29uc3QgaXNBdXRob3JpemVkID1cbiAgICAgICAgY3VycmVudFVzZXIucm9sZSA9PT0gXCJBRE1JTlwiIHx8XG4gICAgICAgIGN1cnJlbnRVc2VyLnJvbGUgPT09IFwiQ09OVEVTVF9NQU5BR0VSXCIgfHxcbiAgICAgICAgY3VycmVudFVzZXIucm9sZSA9PT0gXCJURUFDSEVSXCIgfHxcbiAgICAgICAgY29udGVzdC5jcmVhdG9ySWQgPT09IGN1cnJlbnRVc2VyLmlkO1xuXG4gICAgaWYgKCFpc0F1dGhvcml6ZWQpIHtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcGFydGljaXBhbnRzID0gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLmZpbmRNYW55KHtcbiAgICAgICAgICAgIHdoZXJlOiB7IGNvbnRlc3RJZCB9LFxuICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBlbWFpbDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGltYWdlOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHZpb2xhdGlvbnM6IHtcbiAgICAgICAgICAgICAgICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6IFwiZGVzY1wiIH0sXG4gICAgICAgICAgICAgICAgICAgIHRha2U6IDEwXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9yZGVyQnk6IFtcbiAgICAgICAgICAgICAgICB7IHBlcm1hbmVudGx5QmxvY2tlZDogXCJkZXNjXCIgfSxcbiAgICAgICAgICAgICAgICB7IGlzQmxvY2tlZDogXCJkZXNjXCIgfSxcbiAgICAgICAgICAgICAgICB7IHRvdGFsVmlvbGF0aW9uczogXCJkZXNjXCIgfVxuICAgICAgICAgICAgXVxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBwYXJ0aWNpcGFudHMgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGdldCBwYXJ0aWNpcGFudHM6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBnZXQgcGFydGljaXBhbnRzXCIgfTtcbiAgICB9XG59XG5cbi8qKlxuICogVW5ibG9jayBhIHBhcnRpY2lwYW50IChtYW5hZ2VyIG9ubHkpXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1bmJsb2NrUGFydGljaXBhbnQoY29udGVzdElkOiBzdHJpbmcsIHVzZXJJZDogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICBpZiAoIXNlc3Npb24/LnVzZXIpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuXG4gICAgY29uc3QgY3VycmVudFVzZXIgPSBzZXNzaW9uLnVzZXIgYXMgYW55O1xuXG4gICAgLy8gQ2hlY2sgYXV0aG9yaXphdGlvblxuICAgIGNvbnN0IGNvbnRlc3QgPSBhd2FpdCBwcmlzbWEuY29udGVzdC5maW5kVW5pcXVlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6IGNvbnRlc3RJZCB9LFxuICAgICAgICBzZWxlY3Q6IHsgY3JlYXRvcklkOiB0cnVlIH1cbiAgICB9KTtcblxuICAgIGlmICghY29udGVzdCkgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkNvbnRlc3Qgbm90IGZvdW5kXCIgfTtcblxuICAgIGNvbnN0IGlzQXV0aG9yaXplZCA9XG4gICAgICAgIGN1cnJlbnRVc2VyLnJvbGUgPT09IFwiQURNSU5cIiB8fFxuICAgICAgICBjdXJyZW50VXNlci5yb2xlID09PSBcIkNPTlRFU1RfTUFOQUdFUlwiIHx8XG4gICAgICAgIGN1cnJlbnRVc2VyLnJvbGUgPT09IFwiVEVBQ0hFUlwiIHx8XG4gICAgICAgIGNvbnRlc3QuY3JlYXRvcklkID09PSBjdXJyZW50VXNlci5pZDtcblxuICAgIGlmICghaXNBdXRob3JpemVkKSB7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHByaXNtYS5jb250ZXN0UGFydGljaXBhdGlvbi51cGRhdGUoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgY29udGVzdElkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICBpc0Jsb2NrZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHRlbXBCbG9ja2VkVW50aWw6IG51bGwsXG4gICAgICAgICAgICAgICAgcGVybWFuZW50bHlCbG9ja2VkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICB0b3RhbFZpb2xhdGlvbnM6IDAsXG4gICAgICAgICAgICAgICAgdGFiU3dpdGNoQ291bnQ6IDAsXG4gICAgICAgICAgICAgICAgZnVsbHNjcmVlbkV4aXRDb3VudDogMCxcbiAgICAgICAgICAgICAgICBjb3B5UGFzdGVDb3VudDogMCxcbiAgICAgICAgICAgICAgICBkZXZUb29sc0NvdW50OiAwLFxuICAgICAgICAgICAgICAgIGtleWJvYXJkQ291bnQ6IDAsXG4gICAgICAgICAgICAgICAgbmF2aWdhdGlvbkNvdW50OiAwLFxuICAgICAgICAgICAgICAgIGlzRmxhZ2dlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgdW5ibG9ja2VkQnk6IGN1cnJlbnRVc2VyLmlkLFxuICAgICAgICAgICAgICAgIHVuYmxvY2tlZEF0OiBuZXcgRGF0ZSgpXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldmFsaWRhdGVQYXRoKGAvZGFzaGJvYXJkL2NvbnRlc3RzLyR7Y29udGVzdElkfS9wYXJ0aWNpcGFudHNgKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gdW5ibG9jayBwYXJ0aWNpcGFudDpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIHVuYmxvY2sgcGFydGljaXBhbnRcIiB9O1xuICAgIH1cbn1cblxuLyoqXG4gKiBHZXQgZGV0YWlsZWQgdmlvbGF0aW9ucyBmb3IgYSBwYXJ0aWNpcGFudFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0UGFydGljaXBhbnRWaW9sYXRpb25zKGNvbnRlc3RJZDogc3RyaW5nLCB1c2VySWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcblxuICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gc2Vzc2lvbi51c2VyIGFzIGFueTtcblxuICAgIC8vIENoZWNrIGF1dGhvcml6YXRpb25cbiAgICBjb25zdCBjb250ZXN0ID0gYXdhaXQgcHJpc21hLmNvbnRlc3QuZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiBjb250ZXN0SWQgfSxcbiAgICAgICAgc2VsZWN0OiB7IGNyZWF0b3JJZDogdHJ1ZSB9XG4gICAgfSk7XG5cbiAgICBpZiAoIWNvbnRlc3QpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJDb250ZXN0IG5vdCBmb3VuZFwiIH07XG5cbiAgICBjb25zdCBpc0F1dGhvcml6ZWQgPVxuICAgICAgICBjdXJyZW50VXNlci5yb2xlID09PSBcIkFETUlOXCIgfHxcbiAgICAgICAgY3VycmVudFVzZXIucm9sZSA9PT0gXCJDT05URVNUX01BTkFHRVJcIiB8fFxuICAgICAgICBjdXJyZW50VXNlci5yb2xlID09PSBcIlRFQUNIRVJcIiB8fFxuICAgICAgICBjb250ZXN0LmNyZWF0b3JJZCA9PT0gY3VycmVudFVzZXIuaWQ7XG5cbiAgICBpZiAoIWlzQXV0aG9yaXplZCkge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBwYXJ0aWNpcGF0aW9uID0gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgY29udGVzdElkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdDogeyBpZDogdHJ1ZSwgbmFtZTogdHJ1ZSwgZW1haWw6IHRydWUgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgdmlvbGF0aW9uczoge1xuICAgICAgICAgICAgICAgICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogXCJkZXNjXCIgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgcGFydGljaXBhdGlvbiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZ2V0IHZpb2xhdGlvbnNcIiB9O1xuICAgIH1cbn1cblxuLyoqXG4gKiBDYWxjdWxhdGUgY29udGVzdCBsZWFkZXJib2FyZFxuICogLSBGZXRjaGVzIGFsbCBwYXJ0aWNpcGF0aW9uc1xuICogLSBGZXRjaGVzIGFsbCByZWxldmFudCBzdWJtaXNzaW9uc1xuICogLSBDYWxjdWxhdGVzIHNjb3Jlc1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q29udGVzdExlYWRlcmJvYXJkKGNvbnRlc3RJZDogc3RyaW5nKSB7XG4gICAgXCJ1c2UgY2FjaGVcIlxuICAgIGNhY2hlVGFnKGBsZWFkZXJib2FyZC0ke2NvbnRlc3RJZH1gKVxuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBjYWNoZUxpZmUoXCJsZWFkZXJib2FyZFwiKVxuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcGFydGljaXBhdGlvbnMgPSBhd2FpdCBwcmlzbWEuY29udGVzdFBhcnRpY2lwYXRpb24uZmluZE1hbnkoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICBjb250ZXN0SWQsXG4gICAgICAgICAgICAgICAgLy8gc3RhcnRlZEF0OiB7IG5vdDogbnVsbCB9IC8vIE9ubHkgc3RhcnRlZCBwYXJ0aWNpcGFudHMgKEZpeCBpZiBmaWVsZCBleGlzdHMsIG90aGVyd2lzZSByZWx5IG9uIGNyZWF0ZWQpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBpbWFnZTogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBjb250ZXN0ID0gYXdhaXQgcHJpc21hLmNvbnRlc3QuZmluZFVuaXF1ZSh7XG4gICAgICAgICAgICB3aGVyZTogeyBpZDogY29udGVzdElkIH0sXG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgcHJvYmxlbXM6IHtcbiAgICAgICAgICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJvYmxlbToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpZmZpY3VsdHk6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNsdWc6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3JlOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBvcmRlckJ5OiB7IG9yZGVyOiBcImFzY1wiIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICghY29udGVzdCkgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkNvbnRlc3Qgbm90IGZvdW5kXCIgfTtcblxuICAgICAgICBjb25zdCBsZWFkZXJib2FyZCA9IGF3YWl0IFByb21pc2UuYWxsKHBhcnRpY2lwYXRpb25zLm1hcChhc3luYyAocCkgPT4ge1xuICAgICAgICAgICAgLy8gR2V0IHZhbGlkIHN1Ym1pc3Npb25zIGZvciB0aGlzIHVzZXIgaW4gdGhpcyBjb250ZXN0XG4gICAgICAgICAgICBjb25zdCBzdWJtaXNzaW9ucyA9IGF3YWl0IHByaXNtYS5zdWJtaXNzaW9uLmZpbmRNYW55KHtcbiAgICAgICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IHAudXNlcklkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZCxcbiAgICAgICAgICAgICAgICAgICAgY3JlYXRlZEF0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBndGU6IGNvbnRlc3Quc3RhcnRUaW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgbHRlOiBjb250ZXN0LmVuZFRpbWVcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHByb2JsZW1JZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgY3JlYXRlZEF0OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBsYW5ndWFnZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSB0b3RhbCBzY29yZVxuICAgICAgICAgICAgLy8gTG9naWM6IEJlc3Qgc3VibWlzc2lvbiBwZXIgcHJvYmxlbSBjb3VudHNcbiAgICAgICAgICAgIGNvbnN0IHByb2JsZW1TY29yZXMgPSBuZXcgTWFwPHN0cmluZywgbnVtYmVyPigpO1xuICAgICAgICAgICAgY29uc3QgcHJvYmxlbVNvbHZlVGltZXMgPSBuZXcgTWFwPHN0cmluZywgRGF0ZT4oKTtcbiAgICAgICAgICAgIGNvbnN0IHByb2JsZW1TdWJtaXNzaW9uQ291bnRzID0gbmV3IE1hcDxzdHJpbmcsIG51bWJlcj4oKTtcbiAgICAgICAgICAgIGNvbnN0IHByb2JsZW1CZXN0U3VibWlzc2lvbnMgPSBuZXcgTWFwPHN0cmluZywgYW55PigpO1xuXG4gICAgICAgICAgICBzdWJtaXNzaW9ucy5mb3JFYWNoKHN1YiA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgY3VycmVudENvdW50ID0gcHJvYmxlbVN1Ym1pc3Npb25Db3VudHMuZ2V0KHN1Yi5wcm9ibGVtSWQpIHx8IDA7XG4gICAgICAgICAgICAgICAgcHJvYmxlbVN1Ym1pc3Npb25Db3VudHMuc2V0KHN1Yi5wcm9ibGVtSWQsIGN1cnJlbnRDb3VudCArIDEpO1xuXG4gICAgICAgICAgICAgICAgaWYgKHN1Yi5zdGF0dXMgPT09IFwiQUNDRVBURURcIikge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50QmVzdCA9IHByb2JsZW1TY29yZXMuZ2V0KHN1Yi5wcm9ibGVtSWQpIHx8IDA7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb2JsZW1EZWYgPSBjb250ZXN0LnByb2JsZW1zLmZpbmQoY3AgPT4gY3AucHJvYmxlbUlkID09PSBzdWIucHJvYmxlbUlkKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWF4U2NvcmUgPSBwcm9ibGVtRGVmPy5wcm9ibGVtLnNjb3JlIHx8IDA7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKG1heFNjb3JlID4gY3VycmVudEJlc3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICBwcm9ibGVtU2NvcmVzLnNldChzdWIucHJvYmxlbUlkLCBtYXhTY29yZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudEJlc3RUaW1lID0gcHJvYmxlbVNvbHZlVGltZXMuZ2V0KHN1Yi5wcm9ibGVtSWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghY3VycmVudEJlc3RUaW1lIHx8IHN1Yi5jcmVhdGVkQXQgPCBjdXJyZW50QmVzdFRpbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvYmxlbVNvbHZlVGltZXMuc2V0KHN1Yi5wcm9ibGVtSWQsIHN1Yi5jcmVhdGVkQXQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9ibGVtQmVzdFN1Ym1pc3Npb25zLnNldChzdWIucHJvYmxlbUlkLCBzdWIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBsZXQgdG90YWxTY29yZSA9IDA7XG4gICAgICAgICAgICBsZXQgdG90YWxUaW1lTXMgPSAwO1xuXG4gICAgICAgICAgICBwcm9ibGVtU2NvcmVzLmZvckVhY2goKHNjb3JlLCBwcm9ibGVtSWQpID0+IHtcbiAgICAgICAgICAgICAgICB0b3RhbFNjb3JlICs9IHNjb3JlO1xuICAgICAgICAgICAgICAgIGNvbnN0IHNvbHZlbnRUaW1lID0gcHJvYmxlbVNvbHZlVGltZXMuZ2V0KHByb2JsZW1JZCk7XG4gICAgICAgICAgICAgICAgaWYgKHNvbHZlbnRUaW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIHRvdGFsVGltZU1zICs9IChzb2x2ZW50VGltZS5nZXRUaW1lKCkgLSBjb250ZXN0LnN0YXJ0VGltZS5nZXRUaW1lKCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBNYXAgc3RhdHMgZm9yIGVhY2ggcHJvYmxlbSBpbiB0aGUgY29udGVzdFxuICAgICAgICAgICAgY29uc3QgcHJvYmxlbVN0YXRzID0gY29udGVzdC5wcm9ibGVtcy5tYXAoY3AgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGJlc3RTdWIgPSBwcm9ibGVtQmVzdFN1Ym1pc3Npb25zLmdldChjcC5wcm9ibGVtSWQpO1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIHByb2JsZW1JZDogY3AucHJvYmxlbUlkLFxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogY3AucHJvYmxlbS50aXRsZSxcbiAgICAgICAgICAgICAgICAgICAgc2x1ZzogY3AucHJvYmxlbS5zbHVnLFxuICAgICAgICAgICAgICAgICAgICBzY29yZTogcHJvYmxlbVNjb3Jlcy5nZXQoY3AucHJvYmxlbUlkKSB8fCAwLFxuICAgICAgICAgICAgICAgICAgICBtYXhTY29yZTogY3AucHJvYmxlbS5zY29yZSxcbiAgICAgICAgICAgICAgICAgICAgc3VibWlzc2lvbnM6IHByb2JsZW1TdWJtaXNzaW9uQ291bnRzLmdldChjcC5wcm9ibGVtSWQpIHx8IDAsXG4gICAgICAgICAgICAgICAgICAgIHNvbHZlZDogcHJvYmxlbVNjb3Jlcy5oYXMoY3AucHJvYmxlbUlkKSxcbiAgICAgICAgICAgICAgICAgICAgc29sdmVkQXQ6IHByb2JsZW1Tb2x2ZVRpbWVzLmdldChjcC5wcm9ibGVtSWQpLFxuICAgICAgICAgICAgICAgICAgICBsYW5ndWFnZTogYmVzdFN1Yj8ubGFuZ3VhZ2U/Lm5hbWUgfHwgbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgbGFuZ3VhZ2VJZDogYmVzdFN1Yj8ubGFuZ3VhZ2U/LmlkIHx8IG51bGxcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgLi4ucC51c2VyLFxuICAgICAgICAgICAgICAgIHNjb3JlOiB0b3RhbFNjb3JlLFxuICAgICAgICAgICAgICAgIHRpbWVUYWtlbjogdG90YWxUaW1lTXMsXG4gICAgICAgICAgICAgICAgcHJvYmxlbXNTb2x2ZWQ6IHByb2JsZW1TY29yZXMuc2l6ZSxcbiAgICAgICAgICAgICAgICBwcm9ibGVtU3RhdHNcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pKTtcblxuICAgICAgICAvLyBTb3J0OiBIaWdoIHNjb3JlIGZpcnN0LCB0aGVuIGxvdyB0aW1lIHRha2VuXG4gICAgICAgIGxlYWRlcmJvYXJkLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgICAgICAgIGlmIChiLnNjb3JlICE9PSBhLnNjb3JlKSByZXR1cm4gYi5zY29yZSAtIGEuc2NvcmU7XG4gICAgICAgICAgICByZXR1cm4gYS50aW1lVGFrZW4gLSBiLnRpbWVUYWtlbjtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgICBzdHVkZW50czogbGVhZGVyYm9hcmQsXG4gICAgICAgICAgICBpc0ZpbmFsaXplZDogY29udGVzdC5pc0ZpbmFsaXplZCxcbiAgICAgICAgICAgIHByb2JsZW1zOiBjb250ZXN0LnByb2JsZW1zLm1hcChjcCA9PiAoe1xuICAgICAgICAgICAgICAgIGlkOiBjcC5wcm9ibGVtSWQsXG4gICAgICAgICAgICAgICAgdGl0bGU6IGNwLnByb2JsZW0udGl0bGUsXG4gICAgICAgICAgICAgICAgc2x1ZzogY3AucHJvYmxlbS5zbHVnLFxuICAgICAgICAgICAgICAgIG1heFNjb3JlOiBjcC5wcm9ibGVtLnNjb3JlXG4gICAgICAgICAgICB9KSlcbiAgICAgICAgfTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJMZWFkZXJib2FyZCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGdlbmVyYXRlIGxlYWRlcmJvYXJkXCIgfTtcbiAgICB9XG59XG5cbi8qKlxuICogR2V0IGN1cnJlbnQgdXNlcidzIHJhbmtpbmcgaW4gYSBjb250ZXN0XG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRDb250ZXN0UmFua2luZyhjb250ZXN0SWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcblxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGdldENvbnRlc3RMZWFkZXJib2FyZChjb250ZXN0SWQpO1xuXG4gICAgICAgIGlmICghcmVzdWx0LnN1Y2Nlc3MgfHwgIXJlc3VsdC5zdHVkZW50cykge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBnZXQgcmFua2luZ1wiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCByYW5rID0gcmVzdWx0LnN0dWRlbnRzLmZpbmRJbmRleCgoczogYW55KSA9PiBzLmlkID09PSBzZXNzaW9uLnVzZXIuaWQpICsgMTtcblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCByYW5rOiByYW5rID4gMCA/IHJhbmsgOiBudWxsIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZ2V0IHJhbmtpbmdcIiB9O1xuICAgIH1cbn1cbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoia1NBNCtCc0IifQ==
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/components/contest/ContestProtection.tsx [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "default",
    ()=>ContestProtection
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/jsx-dev-runtime.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/index.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$triangle$2d$alert$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__AlertTriangle$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/triangle-alert.js [app-client] (ecmascript) <export default as AlertTriangle>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$shield$2d$x$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__ShieldX$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/shield-x.js [app-client] (ecmascript) <export default as ShieldX>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$monitor$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Monitor$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/monitor.js [app-client] (ecmascript) <export default as Monitor>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$lock$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Lock$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/lock.js [app-client] (ecmascript) <export default as Lock>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$ban$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Ban$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/ban.js [app-client] (ecmascript) <export default as Ban>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$clock$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Clock$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/clock.js [app-client] (ecmascript) <export default as Clock>");
var __TURBOPACK__imported__module__$5b$project$5d2f$actions$2f$data$3a$705715__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__ = __turbopack_context__.i("[project]/actions/data:705715 [app-client] (ecmascript) <text/javascript>");
var __TURBOPACK__imported__module__$5b$project$5d2f$actions$2f$data$3a$316d9e__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__ = __turbopack_context__.i("[project]/actions/data:316d9e [app-client] (ecmascript) <text/javascript>");
;
var _s = __turbopack_context__.k.signature();
"use client";
;
;
;
const MAX_WARNINGS = 6;
const FLAG_THRESHOLD = 3;
// Blocked keyboard shortcuts
const BLOCKED_SHORTCUTS = [
    {
        key: "c",
        ctrl: true,
        shift: false
    },
    {
        key: "v",
        ctrl: true,
        shift: false
    },
    {
        key: "x",
        ctrl: true,
        shift: false
    },
    {
        key: "u",
        ctrl: true,
        shift: false
    },
    {
        key: "s",
        ctrl: true,
        shift: false
    },
    {
        key: "p",
        ctrl: true,
        shift: false
    },
    {
        key: "i",
        ctrl: true,
        shift: true
    },
    {
        key: "j",
        ctrl: true,
        shift: true
    },
    {
        key: "c",
        ctrl: true,
        shift: true
    },
    {
        key: "F12",
        ctrl: false,
        shift: false
    }
];
function ContestProtection({ contestId, sessionId, onAutoSubmit, onBlocked, paused = false }) {
    _s();
    const [violations, setViolations] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])({
        total: 0,
        isFlagged: false,
        isBlocked: false,
        tempBlockedUntil: null,
        permanentlyBlocked: false
    });
    const [showWarningPopup, setShowWarningPopup] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(false);
    const [needsFullscreen, setNeedsFullscreen] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(false);
    const [currentViolationType, setCurrentViolationType] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])("");
    const [isEditorLocked, setIsEditorLocked] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(false);
    const [tempBlockTimeLeft, setTempBlockTimeLeft] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(0);
    const isMounted = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(false);
    const broadcastChannel = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(null);
    const lastViolationTime = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(0);
    const isProcessingViolation = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(false);
    const isRefreshing = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(false);
    const isNavigating = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(false); // Track internal navigation to problem pages
    // Ref to track fullscreen needs for event listeners (avoids stale closures)
    const needsFullscreenRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(false);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "ContestProtection.useEffect": ()=>{
            needsFullscreenRef.current = needsFullscreen;
        }
    }["ContestProtection.useEffect"], [
        needsFullscreen
    ]);
    // Global debounce - only ONE violation allowed every 2 seconds
    const canLogViolation = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "ContestProtection.useCallback[canLogViolation]": ()=>{
            const now = Date.now();
            if (paused) return false;
            // If already processing or locked - DO NOT log more violations
            if (isProcessingViolation.current) return false;
            if (isEditorLocked) return false;
            // NOTE: We allow logging even if showWarningPopup is true (e.g. for tab switching while popup is open)
            // Violations are logged even during temp block to allow escalation to permanent block
            // 2 second global cooldown to prevent double-logging same event
            if (now - lastViolationTime.current < 2000) return false;
            return true;
        }
    }["ContestProtection.useCallback[canLogViolation]"], [
        isEditorLocked,
        paused
    ]);
    // Log violation to server and update state
    const handleViolation = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "ContestProtection.useCallback[handleViolation]": async (type, message)=>{
            // Skip if navigating internally (prevents false positives when clicking problems)
            if (!isMounted.current || isRefreshing.current || isNavigating.current) return;
            // Always show popup for user awareness
            setCurrentViolationType(message);
            setShowWarningPopup(true);
            // Keyboard shortcuts and copy/paste ONLY show warning, don't count as violations
            const warningOnlyTypes = [
                "KEYBOARD_SHORTCUT",
                "COPY_PASTE"
            ];
            if (warningOnlyTypes.includes(type)) {
                // Just show warning, don't log to server or increment counter
                return;
            }
            // But only log to server if cooldown passed
            if (!canLogViolation()) {
                return;
            }
            // Lock and update timestamp immediately
            isProcessingViolation.current = true;
            lastViolationTime.current = Date.now();
            try {
                const result = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$actions$2f$data$3a$705715__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__["logContestViolation"])(contestId, type, message);
                if (result.success) {
                    const newState = {
                        total: result.totalViolations || 0,
                        isFlagged: result.isFlagged || false,
                        isBlocked: result.isBlocked || false,
                        tempBlockedUntil: result.tempBlockedUntil || null,
                        permanentlyBlocked: result.permanentlyBlocked || false
                    };
                    setViolations(newState);
                    // Handle tiered escalation
                    if (result.permanentlyBlocked) {
                        setIsEditorLocked(true);
                        onBlocked?.();
                    } else if (result.tempBlockedUntil) {
                        setIsEditorLocked(true);
                        // Calculate time left
                        const timeLeft = new Date(result.tempBlockedUntil).getTime() - Date.now();
                        setTempBlockTimeLeft(Math.max(0, Math.floor(timeLeft / 1000)));
                    }
                }
            } catch (error) {
                console.error("Failed to log violation:", error);
            } finally{
                isProcessingViolation.current = false;
            }
        }
    }["ContestProtection.useCallback[handleViolation]"], [
        contestId,
        canLogViolation,
        onAutoSubmit,
        onBlocked
    ]);
    // Check for existing block status on mount (persists across refresh)
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "ContestProtection.useEffect": ()=>{
            if (!contestId) return;
            const checkBlockStatus = {
                "ContestProtection.useEffect.checkBlockStatus": async ()=>{
                    const result = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$actions$2f$data$3a$316d9e__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__["getParticipationStatus"])(contestId);
                    if (result.success && result.participation) {
                        const p = result.participation;
                        // ALWAYS sync the violation counts and flags
                        const newViolationState = {
                            total: p.totalViolations || 0,
                            isFlagged: p.isFlagged || false,
                            isBlocked: false,
                            tempBlockedUntil: null,
                            permanentlyBlocked: false
                        };
                        if (p.permanentlyBlocked) {
                            newViolationState.isBlocked = true;
                            newViolationState.permanentlyBlocked = true;
                            setIsEditorLocked(true);
                            onBlocked?.();
                        } else if (p.tempBlockedUntil) {
                            const blockEnd = new Date(p.tempBlockedUntil);
                            if (blockEnd > new Date()) {
                                newViolationState.isBlocked = true;
                                newViolationState.tempBlockedUntil = p.tempBlockedUntil;
                                setIsEditorLocked(true);
                                const timeLeft = blockEnd.getTime() - Date.now();
                                setTempBlockTimeLeft(Math.max(0, Math.floor(timeLeft / 1000)));
                            }
                        } else if (p.isBlocked) {
                            newViolationState.isBlocked = true;
                            setIsEditorLocked(true);
                        }
                        setViolations(newViolationState);
                    }
                }
            }["ContestProtection.useEffect.checkBlockStatus"];
            checkBlockStatus();
        }
    }["ContestProtection.useEffect"], [
        contestId,
        onBlocked
    ]);
    // Countdown timer for temp block
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "ContestProtection.useEffect": ()=>{
            if (tempBlockTimeLeft <= 0) return;
            const interval = setInterval({
                "ContestProtection.useEffect.interval": ()=>{
                    setTempBlockTimeLeft({
                        "ContestProtection.useEffect.interval": (prev)=>{
                            if (prev <= 1) {
                                // Timer expired - unblock
                                setIsEditorLocked(false);
                                setViolations({
                                    "ContestProtection.useEffect.interval": (v)=>({
                                            ...v,
                                            isBlocked: false,
                                            tempBlockedUntil: null
                                        })
                                }["ContestProtection.useEffect.interval"]);
                                return 0;
                            }
                            return prev - 1;
                        }
                    }["ContestProtection.useEffect.interval"]);
                }
            }["ContestProtection.useEffect.interval"], 1000);
            return ({
                "ContestProtection.useEffect": ()=>clearInterval(interval)
            })["ContestProtection.useEffect"];
        }
    }["ContestProtection.useEffect"], [
        tempBlockTimeLeft > 0
    ]); // Keep boolean dependency but ensure it works on reset
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "ContestProtection.useEffect": ()=>{
            if (!contestId || !sessionId) return;
            // Setup delay to prevent false positives
            const mountTimeout = setTimeout({
                "ContestProtection.useEffect.mountTimeout": ()=>{
                    isMounted.current = true;
                    // After refresh, check if we need to re-enter fullscreen
                    if (!document.fullscreenElement && !isRefreshing.current) {
                        setNeedsFullscreen(true);
                        needsFullscreenRef.current = true; // Immediate sync for event listeners
                    }
                }
            }["ContestProtection.useEffect.mountTimeout"], 3000);
            // =============================================
            // 1. MULTI-TAB DETECTION via BroadcastChannel
            // =============================================
            try {
                broadcastChannel.current = new BroadcastChannel(`contest-${contestId}`);
                // Announce presence
                broadcastChannel.current.postMessage({
                    type: "ping",
                    sessionId
                });
                // Listen for other tabs
                broadcastChannel.current.onmessage = ({
                    "ContestProtection.useEffect": (event)=>{
                        if (event.data.type === "ping" && event.data.sessionId !== sessionId) {
                            handleViolation("MULTI_TAB", "Contest opened in multiple tabs");
                            // Respond so the other tab knows
                            broadcastChannel.current?.postMessage({
                                type: "conflict",
                                sessionId
                            });
                        }
                        if (event.data.type === "conflict" && event.data.sessionId !== sessionId) {
                            handleViolation("MULTI_TAB", "Contest opened in multiple tabs");
                        }
                    }
                })["ContestProtection.useEffect"];
            } catch (e) {
                console.warn("BroadcastChannel not supported");
            }
            // =============================================
            // 2. FULLSCREEN ENFORCEMENT
            // =============================================
            const enterFullscreen = {
                "ContestProtection.useEffect.enterFullscreen": ()=>{
                    if (!document.fullscreenElement) {
                        document.documentElement.requestFullscreen().catch({
                            "ContestProtection.useEffect.enterFullscreen": ()=>{}
                        }["ContestProtection.useEffect.enterFullscreen"]);
                    }
                }
            }["ContestProtection.useEffect.enterFullscreen"];
            const handleFullscreenChange = {
                "ContestProtection.useEffect.handleFullscreenChange": ()=>{
                    if (!isMounted.current) return;
                    if (!document.fullscreenElement) {
                        handleViolation("FULLSCREEN_EXIT", "You exited fullscreen mode");
                    }
                }
            }["ContestProtection.useEffect.handleFullscreenChange"];
            document.addEventListener("fullscreenchange", handleFullscreenChange);
            // =============================================
            // 3. COPY/PASTE/CUT PREVENTION
            // =============================================
            const preventClipboard = {
                "ContestProtection.useEffect.preventClipboard": (e)=>{
                    if (!isMounted.current) return;
                    e.preventDefault();
                    handleViolation("COPY_PASTE", `${e.type.charAt(0).toUpperCase() + e.type.slice(1)} is not allowed`);
                    return false;
                }
            }["ContestProtection.useEffect.preventClipboard"];
            document.addEventListener("copy", preventClipboard);
            document.addEventListener("cut", preventClipboard);
            document.addEventListener("paste", preventClipboard);
            // =============================================
            // 4. KEYBOARD SHORTCUT BLOCKING
            // =============================================
            const handleKeyDown = {
                "ContestProtection.useEffect.handleKeyDown": (e)=>{
                    if (!isMounted.current) return;
                    // Check against blocked shortcuts
                    const isBlocked = BLOCKED_SHORTCUTS.some({
                        "ContestProtection.useEffect.handleKeyDown.isBlocked": (shortcut)=>{
                            const keyMatch = e.key.toLowerCase() === shortcut.key.toLowerCase();
                            const ctrlMatch = e.ctrlKey === shortcut.ctrl || e.metaKey === shortcut.ctrl;
                            const shiftMatch = e.shiftKey === shortcut.shift;
                            return keyMatch && ctrlMatch && shiftMatch;
                        }
                    }["ContestProtection.useEffect.handleKeyDown.isBlocked"]);
                    if (isBlocked) {
                        e.preventDefault();
                        e.stopPropagation();
                        handleViolation("KEYBOARD_SHORTCUT", `Blocked shortcut: ${e.ctrlKey ? "Ctrl+" : ""}${e.shiftKey ? "Shift+" : ""}${e.key}`);
                        return false;
                    }
                    // Detect Refresh to suppress false positives
                    const isRefresh = e.key === "F5" || e.key.toLowerCase() === "r" && (e.ctrlKey || e.metaKey);
                    if (isRefresh) {
                        isRefreshing.current = true;
                    }
                }
            }["ContestProtection.useEffect.handleKeyDown"];
            document.addEventListener("keydown", handleKeyDown, true);
            // =============================================
            // 5. TAB SWITCH / FOCUS DETECTION
            // =============================================
            const handleVisibilityChange = {
                "ContestProtection.useEffect.handleVisibilityChange": ()=>{
                    if (!isMounted.current) return;
                    if (document.hidden) {
                        handleViolation("TAB_SWITCH", "You switched away from the contest tab");
                    }
                }
            }["ContestProtection.useEffect.handleVisibilityChange"];
            const handleWindowBlur = {
                "ContestProtection.useEffect.handleWindowBlur": ()=>{
                    if (!isMounted.current) return;
                    handleViolation("TAB_SWITCH", "Window lost focus");
                }
            }["ContestProtection.useEffect.handleWindowBlur"];
            document.addEventListener("visibilitychange", handleVisibilityChange);
            window.addEventListener("blur", handleWindowBlur);
            // =============================================
            // 5b. INTERACTION-BASED COMPLIANCE (Optimized)
            // =============================================
            // =============================================
            // 5b. INTERACTION-BASED COMPLIANCE (Optimization: Throttled)
            // =============================================
            let lastCheck = 0;
            const checkCompliance = {
                "ContestProtection.useEffect.checkCompliance": ()=>{
                    const now = Date.now();
                    // Throttle: Max once per 2 seconds during active interaction
                    if (now - lastCheck < 2000) return;
                    lastCheck = now;
                    if (!isMounted.current) return;
                    // Skip if already processing/blocked OR if waiting for fullscreen (using Ref for live value) OR PAUSED
                    if (paused || isProcessingViolation.current || isEditorLocked || showWarningPopup || needsFullscreenRef.current) return;
                    // 1. Check Fullscreen
                    if (!document.fullscreenElement && !isRefreshing.current) {
                        handleViolation("FULLSCREEN_EXIT", "You must stay in fullscreen mode");
                        return;
                    }
                }
            }["ContestProtection.useEffect.checkCompliance"];
            // Event-driven checks are sufficient without polling overhead
            document.addEventListener("mousedown", checkCompliance);
            document.addEventListener("keydown", checkCompliance);
            document.addEventListener("touchstart", checkCompliance);
            // No polling heartbeat needed - visibilitychange and fullscreenchange handle the critical events instantly
            // =============================================
            // 6. DEVTOOLS DETECTION (Event-Driven)
            // =============================================
            let resizeTimeout;
            const checkDevTools = {
                "ContestProtection.useEffect.checkDevTools": ()=>{
                    if (!isMounted.current) return;
                    const threshold = 160;
                    const widthDiff = window.outerWidth - window.innerWidth;
                    const heightDiff = window.outerHeight - window.innerHeight;
                    if (widthDiff > threshold || heightDiff > threshold) {
                        handleViolation("DEVTOOLS_OPEN", "Developer tools detected");
                    }
                }
            }["ContestProtection.useEffect.checkDevTools"];
            const handleResize = {
                "ContestProtection.useEffect.handleResize": ()=>{
                    clearTimeout(resizeTimeout);
                    resizeTimeout = setTimeout(checkDevTools, 500); // Debounce resize check
                }
            }["ContestProtection.useEffect.handleResize"];
            window.addEventListener("resize", handleResize);
            // =============================================
            // 7. CONTEXT MENU DISABLE
            // =============================================
            const preventContextMenu = {
                "ContestProtection.useEffect.preventContextMenu": (e)=>{
                    e.preventDefault();
                    return false;
                }
            }["ContestProtection.useEffect.preventContextMenu"];
            document.addEventListener("contextmenu", preventContextMenu);
            // =============================================
            // 8. INTERNAL NAVIGATION TRACKING
            // =============================================
            // Track clicks on links to prevent false positives when navigating to problems
            const handleLinkClick = {
                "ContestProtection.useEffect.handleLinkClick": (e)=>{
                    const target = e.target;
                    const link = target.closest("a");
                    if (link) {
                        const href = link.getAttribute("href");
                        // If it's an internal link (same origin or relative path)
                        if (href && (href.startsWith("/") || href.startsWith(window.location.origin))) {
                            isNavigating.current = true;
                            // Reset after a short delay in case navigation is cancelled
                            setTimeout({
                                "ContestProtection.useEffect.handleLinkClick": ()=>{
                                    isNavigating.current = false;
                                }
                            }["ContestProtection.useEffect.handleLinkClick"], 2000);
                        }
                    }
                }
            }["ContestProtection.useEffect.handleLinkClick"];
            document.addEventListener("click", handleLinkClick, true);
            // =============================================
            // 8. BEFOREUNLOAD WARNING
            // =============================================
            const handleBeforeUnload = {
                "ContestProtection.useEffect.handleBeforeUnload": (e)=>{
                    isRefreshing.current = true; // Mark as refreshing/navigating
                // DISABLE LEAVE CONFIRMATION
                // e.preventDefault();
                // e.returnValue = "You are in contest mode. Are you sure you want to leave?";
                // return e.returnValue;
                }
            }["ContestProtection.useEffect.handleBeforeUnload"];
            window.addEventListener("beforeunload", handleBeforeUnload);
            // =============================================
            // 9. DRAG/DROP PREVENTION
            // =============================================
            const preventDragDrop = {
                "ContestProtection.useEffect.preventDragDrop": (e)=>{
                    e.preventDefault();
                    return false;
                }
            }["ContestProtection.useEffect.preventDragDrop"];
            document.addEventListener("dragover", preventDragDrop);
            document.addEventListener("drop", preventDragDrop);
            // Cleanup
            return ({
                "ContestProtection.useEffect": ()=>{
                    clearTimeout(mountTimeout);
                    clearTimeout(resizeTimeout);
                    broadcastChannel.current?.close();
                    document.removeEventListener("fullscreenchange", handleFullscreenChange);
                    document.removeEventListener("copy", preventClipboard);
                    document.removeEventListener("cut", preventClipboard);
                    document.removeEventListener("paste", preventClipboard);
                    document.removeEventListener("keydown", handleKeyDown, true);
                    document.removeEventListener("visibilitychange", handleVisibilityChange);
                    window.removeEventListener("blur", handleWindowBlur);
                    window.removeEventListener("resize", handleResize);
                    document.removeEventListener("mousedown", checkCompliance);
                    document.removeEventListener("keydown", checkCompliance);
                    document.removeEventListener("touchstart", checkCompliance);
                    document.removeEventListener("contextmenu", preventContextMenu);
                    document.removeEventListener("click", handleLinkClick, true);
                    window.removeEventListener("beforeunload", handleBeforeUnload);
                    document.removeEventListener("dragover", preventDragDrop);
                    document.removeEventListener("drop", preventDragDrop);
                }
            })["ContestProtection.useEffect"];
        }
    }["ContestProtection.useEffect"], [
        contestId,
        sessionId,
        handleViolation
    ]);
    const handleDismissWarning = ()=>{
        // Only allow dismissing if we successfully enter fullscreen
        const enterFullscreen = async ()=>{
            try {
                if (!document.fullscreenElement) {
                    await document.documentElement.requestFullscreen();
                }
                // Only if successful, close popup
                setShowWarningPopup(false);
            } catch (err) {
            // If user denies fullscreen or it fails, keep popup open
            // Maybe show a toast or shake animation in future
            }
        };
        enterFullscreen();
    };
    const handleReEnterFullscreen = ()=>{
        document.documentElement.requestFullscreen().then(()=>setNeedsFullscreen(false)).catch(()=>{
        // If fails, keeps the popup open
        });
    };
    const remainingWarnings = MAX_WARNINGS - violations.total;
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Fragment"], {
        children: [
            (isEditorLocked || showWarningPopup) && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "fixed inset-0 z-9999 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-in fade-in duration-200",
                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                    className: "bg-white dark:bg-[#141414] rounded-2xl shadow-2xl max-w-lg w-full overflow-hidden border border-orange-100 dark:border-orange-500/20 transform transition-all scale-100",
                    children: [
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: `h-2 w-full ${violations.permanentlyBlocked ? "bg-red-500" : "bg-orange-500"}`
                        }, void 0, false, {
                            fileName: "[project]/components/contest/ContestProtection.tsx",
                            lineNumber: 548,
                            columnNumber: 13
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "p-6 md:p-8",
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "flex flex-col md:flex-row gap-6 items-start md:items-center",
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: `w-16 h-16 rounded-2xl flex items-center justify-center shrink-0 shadow-sm ${violations.permanentlyBlocked ? "bg-red-50 dark:bg-red-500/10 text-red-500" : "bg-orange-50 dark:bg-orange-500/10 text-orange-500"}`,
                                            children: violations.permanentlyBlocked ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$ban$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Ban$3e$__["Ban"], {
                                                className: "w-8 h-8"
                                            }, void 0, false, {
                                                fileName: "[project]/components/contest/ContestProtection.tsx",
                                                lineNumber: 565,
                                                columnNumber: 21
                                            }, this) : tempBlockTimeLeft > 0 ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$clock$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Clock$3e$__["Clock"], {
                                                className: "w-8 h-8 animate-pulse"
                                            }, void 0, false, {
                                                fileName: "[project]/components/contest/ContestProtection.tsx",
                                                lineNumber: 567,
                                                columnNumber: 21
                                            }, this) : isEditorLocked ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$lock$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Lock$3e$__["Lock"], {
                                                className: "w-8 h-8"
                                            }, void 0, false, {
                                                fileName: "[project]/components/contest/ContestProtection.tsx",
                                                lineNumber: 569,
                                                columnNumber: 21
                                            }, this) : /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$triangle$2d$alert$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__AlertTriangle$3e$__["AlertTriangle"], {
                                                className: "w-8 h-8"
                                            }, void 0, false, {
                                                fileName: "[project]/components/contest/ContestProtection.tsx",
                                                lineNumber: 571,
                                                columnNumber: 21
                                            }, this)
                                        }, void 0, false, {
                                            fileName: "[project]/components/contest/ContestProtection.tsx",
                                            lineNumber: 557,
                                            columnNumber: 17
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "flex-1 space-y-1",
                                            children: [
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("h2", {
                                                    className: "text-xl font-bold text-gray-900 dark:text-white leading-tight",
                                                    children: violations.permanentlyBlocked ? "Contest Session Terminated" : tempBlockTimeLeft > 0 ? "Temporary Suspension" : "Violation Detected"
                                                }, void 0, false, {
                                                    fileName: "[project]/components/contest/ContestProtection.tsx",
                                                    lineNumber: 576,
                                                    columnNumber: 19
                                                }, this),
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                                    className: "text-gray-500 dark:text-gray-400 font-medium text-sm",
                                                    children: violations.permanentlyBlocked ? "Multiple violations detected. Your session has been permanently blocked." : tempBlockTimeLeft > 0 ? "Please wait for the timer to expire before continuing." : currentViolationType || "This action is prohibited during the contest."
                                                }, void 0, false, {
                                                    fileName: "[project]/components/contest/ContestProtection.tsx",
                                                    lineNumber: 583,
                                                    columnNumber: 19
                                                }, this)
                                            ]
                                        }, void 0, true, {
                                            fileName: "[project]/components/contest/ContestProtection.tsx",
                                            lineNumber: 575,
                                            columnNumber: 17
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/components/contest/ContestProtection.tsx",
                                    lineNumber: 555,
                                    columnNumber: 15
                                }, this),
                                tempBlockTimeLeft > 0 && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "mt-8 p-6 bg-orange-50 dark:bg-orange-500/10 rounded-xl border border-orange-100 dark:border-orange-500/20 flex flex-col items-center justify-center",
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                            className: "text-xs font-bold text-orange-400 uppercase tracking-widest mb-2",
                                            children: "Access Resumes In"
                                        }, void 0, false, {
                                            fileName: "[project]/components/contest/ContestProtection.tsx",
                                            lineNumber: 597,
                                            columnNumber: 19
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "text-5xl font-black text-orange-500 font-mono tracking-tighter tabular-nums",
                                            children: [
                                                Math.floor(tempBlockTimeLeft / 60),
                                                ":",
                                                String(tempBlockTimeLeft % 60).padStart(2, "0")
                                            ]
                                        }, void 0, true, {
                                            fileName: "[project]/components/contest/ContestProtection.tsx",
                                            lineNumber: 600,
                                            columnNumber: 19
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/components/contest/ContestProtection.tsx",
                                    lineNumber: 596,
                                    columnNumber: 17
                                }, this),
                                !violations.permanentlyBlocked && tempBlockTimeLeft <= 0 && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "mt-8 space-y-3",
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "flex justify-between items-end",
                                            children: [
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                    className: "text-xs font-semibold text-gray-400 uppercase tracking-wider",
                                                    children: "Warning Level"
                                                }, void 0, false, {
                                                    fileName: "[project]/components/contest/ContestProtection.tsx",
                                                    lineNumber: 611,
                                                    columnNumber: 21
                                                }, this),
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                    className: "text-sm font-bold text-gray-900 dark:text-white",
                                                    children: [
                                                        violations.total,
                                                        " ",
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                            className: "text-gray-400 font-normal",
                                                            children: [
                                                                "/ ",
                                                                MAX_WARNINGS
                                                            ]
                                                        }, void 0, true, {
                                                            fileName: "[project]/components/contest/ContestProtection.tsx",
                                                            lineNumber: 616,
                                                            columnNumber: 23
                                                        }, this)
                                                    ]
                                                }, void 0, true, {
                                                    fileName: "[project]/components/contest/ContestProtection.tsx",
                                                    lineNumber: 614,
                                                    columnNumber: 21
                                                }, this)
                                            ]
                                        }, void 0, true, {
                                            fileName: "[project]/components/contest/ContestProtection.tsx",
                                            lineNumber: 610,
                                            columnNumber: 19
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "h-3 bg-gray-100 dark:bg-[#1a1a1a] rounded-full overflow-hidden",
                                            children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                className: `h-full transition-all duration-500 ease-out ${violations.total >= 4 ? "bg-red-500" : "bg-orange-500"}`,
                                                style: {
                                                    width: `${Math.min(violations.total / MAX_WARNINGS * 100, 100)}%`
                                                }
                                            }, void 0, false, {
                                                fileName: "[project]/components/contest/ContestProtection.tsx",
                                                lineNumber: 622,
                                                columnNumber: 21
                                            }, this)
                                        }, void 0, false, {
                                            fileName: "[project]/components/contest/ContestProtection.tsx",
                                            lineNumber: 621,
                                            columnNumber: 19
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "flex items-center justify-between text-xs",
                                            children: [
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                    className: "text-gray-400",
                                                    children: "Low Risk"
                                                }, void 0, false, {
                                                    fileName: "[project]/components/contest/ContestProtection.tsx",
                                                    lineNumber: 635,
                                                    columnNumber: 21
                                                }, this),
                                                violations.total >= 4 ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                    className: "text-red-500 font-medium",
                                                    children: "Critical Risk"
                                                }, void 0, false, {
                                                    fileName: "[project]/components/contest/ContestProtection.tsx",
                                                    lineNumber: 637,
                                                    columnNumber: 23
                                                }, this) : /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                    className: "text-orange-500 font-medium",
                                                    children: "Caution"
                                                }, void 0, false, {
                                                    fileName: "[project]/components/contest/ContestProtection.tsx",
                                                    lineNumber: 641,
                                                    columnNumber: 23
                                                }, this)
                                            ]
                                        }, void 0, true, {
                                            fileName: "[project]/components/contest/ContestProtection.tsx",
                                            lineNumber: 634,
                                            columnNumber: 19
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/components/contest/ContestProtection.tsx",
                                    lineNumber: 609,
                                    columnNumber: 17
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "mt-8",
                                    children: !violations.permanentlyBlocked && tempBlockTimeLeft <= 0 ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                        onClick: handleDismissWarning,
                                        className: "w-full py-4 bg-gray-900 dark:bg-white text-white dark:text-black rounded-xl font-bold hover:bg-gray-800 dark:hover:bg-gray-200 transition-all transform active:scale-[0.98] shadow-lg shadow-gray-200 dark:shadow-none",
                                        children: "Acknowledge & Continue"
                                    }, void 0, false, {
                                        fileName: "[project]/components/contest/ContestProtection.tsx",
                                        lineNumber: 652,
                                        columnNumber: 19
                                    }, this) : tempBlockTimeLeft > 0 ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                        disabled: true,
                                        className: "w-full py-4 bg-gray-100 dark:bg-[#1a1a1a] text-gray-400 dark:text-gray-600 rounded-xl font-bold cursor-not-allowed",
                                        children: "Suspended"
                                    }, void 0, false, {
                                        fileName: "[project]/components/contest/ContestProtection.tsx",
                                        lineNumber: 659,
                                        columnNumber: 19
                                    }, this) : /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                        className: "w-full py-4 bg-red-50 dark:bg-red-500/10 text-red-600 dark:text-red-500 rounded-xl font-bold border border-red-100 dark:border-red-500/20 cursor-not-allowed",
                                        children: "Contact Administrator"
                                    }, void 0, false, {
                                        fileName: "[project]/components/contest/ContestProtection.tsx",
                                        lineNumber: 666,
                                        columnNumber: 19
                                    }, this)
                                }, void 0, false, {
                                    fileName: "[project]/components/contest/ContestProtection.tsx",
                                    lineNumber: 650,
                                    columnNumber: 15
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/components/contest/ContestProtection.tsx",
                            lineNumber: 554,
                            columnNumber: 13
                        }, this)
                    ]
                }, void 0, true, {
                    fileName: "[project]/components/contest/ContestProtection.tsx",
                    lineNumber: 546,
                    columnNumber: 11
                }, this)
            }, void 0, false, {
                fileName: "[project]/components/contest/ContestProtection.tsx",
                lineNumber: 545,
                columnNumber: 9
            }, this),
            needsFullscreen && !isEditorLocked && !showWarningPopup && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "fixed inset-0 z-10000 flex items-center justify-center bg-black/60 backdrop-blur-md",
                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                    className: "bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 overflow-hidden border-2 border-orange-500 animate-in fade-in zoom-in duration-300",
                    children: [
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "bg-orange-600 px-6 py-4 flex items-center gap-3",
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$monitor$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Monitor$3e$__["Monitor"], {
                                    className: "w-6 h-6 text-white"
                                }, void 0, false, {
                                    fileName: "[project]/components/contest/ContestProtection.tsx",
                                    lineNumber: 681,
                                    columnNumber: 15
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("h2", {
                                    className: "text-lg font-bold text-white uppercase tracking-wider",
                                    children: "Fullscreen Required"
                                }, void 0, false, {
                                    fileName: "[project]/components/contest/ContestProtection.tsx",
                                    lineNumber: 682,
                                    columnNumber: 15
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/components/contest/ContestProtection.tsx",
                            lineNumber: 680,
                            columnNumber: 13
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "p-6 text-center",
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "w-20 h-20 bg-orange-50 dark:bg-orange-500/10 rounded-full flex items-center justify-center mx-auto mb-6",
                                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$shield$2d$x$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__ShieldX$3e$__["ShieldX"], {
                                        className: "w-10 h-10 text-orange-500"
                                    }, void 0, false, {
                                        fileName: "[project]/components/contest/ContestProtection.tsx",
                                        lineNumber: 689,
                                        columnNumber: 17
                                    }, this)
                                }, void 0, false, {
                                    fileName: "[project]/components/contest/ContestProtection.tsx",
                                    lineNumber: 688,
                                    columnNumber: 15
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("h3", {
                                    className: "text-xl font-bold text-gray-900 mb-2",
                                    children: "Re-activate Proctoring"
                                }, void 0, false, {
                                    fileName: "[project]/components/contest/ContestProtection.tsx",
                                    lineNumber: 691,
                                    columnNumber: 15
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                    className: "text-gray-600 mb-8 text-sm",
                                    children: "To continue your contest session, you must re-enter fullscreen mode. This is required for proctoring accuracy."
                                }, void 0, false, {
                                    fileName: "[project]/components/contest/ContestProtection.tsx",
                                    lineNumber: 694,
                                    columnNumber: 15
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                    onClick: handleReEnterFullscreen,
                                    className: "w-full py-4 bg-orange-600 text-white rounded-xl font-black uppercase tracking-widest hover:bg-orange-700 transition-all shadow-lg shadow-orange-200 flex items-center justify-center gap-3 group",
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$monitor$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Monitor$3e$__["Monitor"], {
                                            className: "w-5 h-5 group-hover:scale-110 transition-transform"
                                        }, void 0, false, {
                                            fileName: "[project]/components/contest/ContestProtection.tsx",
                                            lineNumber: 703,
                                            columnNumber: 17
                                        }, this),
                                        "Go Full Screen"
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/components/contest/ContestProtection.tsx",
                                    lineNumber: 699,
                                    columnNumber: 15
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                    className: "text-[10px] text-gray-400 mt-4 font-medium uppercase tracking-tighter",
                                    children: "Do not attempt to stay in windowed mode"
                                }, void 0, false, {
                                    fileName: "[project]/components/contest/ContestProtection.tsx",
                                    lineNumber: 707,
                                    columnNumber: 15
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/components/contest/ContestProtection.tsx",
                            lineNumber: 687,
                            columnNumber: 13
                        }, this)
                    ]
                }, void 0, true, {
                    fileName: "[project]/components/contest/ContestProtection.tsx",
                    lineNumber: 679,
                    columnNumber: 11
                }, this)
            }, void 0, false, {
                fileName: "[project]/components/contest/ContestProtection.tsx",
                lineNumber: 678,
                columnNumber: 9
            }, this),
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "fixed top-4 right-4 z-100 flex items-center gap-2 px-3 py-2 bg-white dark:bg-[#141414] border border-gray-200 dark:border-[#262626] rounded-lg shadow-sm",
                children: [
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "w-2 h-2 bg-green-500 rounded-full animate-pulse"
                    }, void 0, false, {
                        fileName: "[project]/components/contest/ContestProtection.tsx",
                        lineNumber: 717,
                        columnNumber: 9
                    }, this),
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                        className: "text-sm text-gray-700 dark:text-gray-300 font-medium",
                        children: "Proctored"
                    }, void 0, false, {
                        fileName: "[project]/components/contest/ContestProtection.tsx",
                        lineNumber: 718,
                        columnNumber: 9
                    }, this),
                    violations.total > 0 && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                        className: "px-2 py-0.5 bg-orange-100 dark:bg-orange-500/10 text-orange-700 dark:text-orange-400 rounded text-xs font-semibold",
                        children: violations.total
                    }, void 0, false, {
                        fileName: "[project]/components/contest/ContestProtection.tsx",
                        lineNumber: 722,
                        columnNumber: 11
                    }, this)
                ]
            }, void 0, true, {
                fileName: "[project]/components/contest/ContestProtection.tsx",
                lineNumber: 716,
                columnNumber: 7
            }, this)
        ]
    }, void 0, true);
}
_s(ContestProtection, "TVtM+rsBi4sVC+dvWeq5XYlXRGE=");
_c = ContestProtection;
var _c;
__turbopack_context__.k.register(_c, "ContestProtection");
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/components/contest/ContestNavigationGuard.tsx [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "default",
    ()=>ContestNavigationGuard
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/index.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$navigation$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/navigation.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$actions$2f$data$3a$705715__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__ = __turbopack_context__.i("[project]/actions/data:705715 [app-client] (ecmascript) <text/javascript>");
var _s = __turbopack_context__.k.signature();
"use client";
;
;
;
function ContestNavigationGuard({ contestId, allowedPaths }) {
    _s();
    const router = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$navigation$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRouter"])();
    const pathname = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$navigation$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["usePathname"])();
    const initialPath = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(pathname);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "ContestNavigationGuard.useEffect": ()=>{
            if (!contestId) return;
            // =============================================
            // 1. BLOCK BROWSER BACK/FORWARD
            // =============================================
            // Push current state to prevent back navigation
            const pushState = {
                "ContestNavigationGuard.useEffect.pushState": ()=>{
                    window.history.pushState(null, "", window.location.href);
                }
            }["ContestNavigationGuard.useEffect.pushState"];
            pushState();
            const handlePopState = {
                "ContestNavigationGuard.useEffect.handlePopState": (e)=>{
                    e.preventDefault();
                    pushState();
                    // Log navigation attempt
                    (0, __TURBOPACK__imported__module__$5b$project$5d2f$actions$2f$data$3a$705715__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__["logContestViolation"])(contestId, "NAVIGATION_ATTEMPT", "Attempted to use browser back/forward");
                }
            }["ContestNavigationGuard.useEffect.handlePopState"];
            window.addEventListener("popstate", handlePopState);
            // =============================================
            // 2. INTERCEPT LINK CLICKS
            // =============================================
            const handleLinkClick = {
                "ContestNavigationGuard.useEffect.handleLinkClick": (e)=>{
                    const target = e.target;
                    const anchor = target.closest("a");
                    if (anchor) {
                        const href = anchor.getAttribute("href");
                        // Check if navigation is to an allowed path
                        // Ignore hash links, empty links, or javascript:void, or disabled links
                        if (href && href !== "#" && href.trim() !== "" && !href.startsWith("javascript:") && !allowedPaths.some({
                            "ContestNavigationGuard.useEffect.handleLinkClick": (path)=>href.startsWith(path)
                        }["ContestNavigationGuard.useEffect.handleLinkClick"])) {
                            e.preventDefault();
                            e.stopPropagation();
                            (0, __TURBOPACK__imported__module__$5b$project$5d2f$actions$2f$data$3a$705715__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__["logContestViolation"])(contestId, "NAVIGATION_ATTEMPT", `Attempted to navigate to: ${href}`);
                            return false;
                        }
                    }
                }
            }["ContestNavigationGuard.useEffect.handleLinkClick"];
            document.addEventListener("click", handleLinkClick, true);
            // =============================================
            // 3. MONITOR PATH CHANGES
            // =============================================
            // If path changes unexpectedly, redirect back
            if (pathname !== initialPath.current) {
                const isAllowed = allowedPaths.some({
                    "ContestNavigationGuard.useEffect.isAllowed": (path)=>pathname?.startsWith(path)
                }["ContestNavigationGuard.useEffect.isAllowed"]);
                if (!isAllowed) {
                    (0, __TURBOPACK__imported__module__$5b$project$5d2f$actions$2f$data$3a$705715__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__["logContestViolation"])(contestId, "NAVIGATION_ATTEMPT", `Unexpected navigation to: ${pathname}`);
                    // Redirect back to contest
                    router.replace(initialPath.current || "/");
                }
            }
            return ({
                "ContestNavigationGuard.useEffect": ()=>{
                    window.removeEventListener("popstate", handlePopState);
                    document.removeEventListener("click", handleLinkClick, true);
                }
            })["ContestNavigationGuard.useEffect"];
        }
    }["ContestNavigationGuard.useEffect"], [
        contestId,
        pathname,
        allowedPaths,
        router
    ]);
    // This component doesn't render anything
    return null;
}
_s(ContestNavigationGuard, "iPG3cX6oJ0ELxv2WzWdEVpIspDc=", false, function() {
    return [
        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$navigation$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRouter"],
        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$navigation$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["usePathname"]
    ];
});
_c = ContestNavigationGuard;
var _c;
__turbopack_context__.k.register(_c, "ContestNavigationGuard");
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/actions/data:2e5ad8 [app-client] (ecmascript) <text/javascript>", ((__turbopack_context__) => {
"use strict";

/* __next_internal_action_entry_do_not_use__ [{"40cb9402bcb3cefb68c56b22e13de3a9f637bd31ab":"finishContestAction"},"actions/contest.ts",""] */ __turbopack_context__.s([
    "finishContestAction",
    ()=>finishContestAction
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-client] (ecmascript)");
"use turbopack no side effects";
;
var finishContestAction = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["createServerReference"])("40cb9402bcb3cefb68c56b22e13de3a9f637bd31ab", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["findSourceMapURL"], "finishContestAction"); //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vY29udGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzZXJ2ZXJcIjtcblxuaW1wb3J0IHsgcHJpc21hIH0gZnJvbSBcIkAvbGliL3ByaXNtYVwiO1xuaW1wb3J0IHsgYXV0aCB9IGZyb20gXCJAL2xpYi9hdXRoXCI7XG5pbXBvcnQgeyBoZWFkZXJzIH0gZnJvbSBcIm5leHQvaGVhZGVyc1wiO1xuaW1wb3J0IHsgeiB9IGZyb20gXCJ6b2RcIjtcbmltcG9ydCB7IHJldmFsaWRhdGVQYXRoLCByZXZhbGlkYXRlVGFnIH0gZnJvbSBcIm5leHQvY2FjaGVcIjtcbmltcG9ydCB7IHVuc3RhYmxlX2NhY2hlIGFzIGNhY2hlLCB1bnN0YWJsZV9ub1N0b3JlIGFzIG5vU3RvcmUgfSBmcm9tIFwibmV4dC9jYWNoZVwiO1xuaW1wb3J0IHsgY2FjaGVUYWcsIGNhY2hlTGlmZSB9IGZyb20gXCJuZXh0L2NhY2hlXCI7XG5pbXBvcnQgeyBhZnRlciB9IGZyb20gXCJuZXh0L3NlcnZlclwiOyAvLyBGb3IgYmFja2dyb3VuZCB0YXNrc1xuXG5jb25zdCBjb250ZXN0U2NoZW1hID0gei5vYmplY3Qoe1xuICAgIHRpdGxlOiB6LnN0cmluZygpLm1pbigzLCBcIlRpdGxlIG11c3QgYmUgYXQgbGVhc3QgMyBjaGFyYWN0ZXJzXCIpLFxuICAgIGRlc2NyaXB0aW9uOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgc3RhcnRUaW1lOiB6LmNvZXJjZS5kYXRlKCksXG4gICAgZW5kVGltZTogei5jb2VyY2UuZGF0ZSgpLFxuICAgIHZpc2liaWxpdHk6IHouZW51bShbXCJQVUJMSUNcIiwgXCJJTlNUSVRVVElPTlwiLCBcIkNMQVNTUk9PTVwiXSksXG4gICAgY2xhc3Nyb29tSWQ6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgICBpbnN0aXR1dGlvbklkOiB6LnN0cmluZygpLm9wdGlvbmFsKCkubnVsbGFibGUoKSxcbiAgICBwcm9ibGVtczogei5hcnJheSh6LnN0cmluZygpKS5taW4oMSwgXCJTZWxlY3QgYXQgbGVhc3Qgb25lIHByb2JsZW1cIiksXG4gICAgY29udGVzdFBhc3N3b3JkOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgcmFuZG9taXplUXVlc3Rpb25zOiB6LmJvb2xlYW4oKS5kZWZhdWx0KGZhbHNlKSxcbn0pO1xuXG5jb25zdCBjb250ZXN0V2l0aFByb2JsZW1zU2NoZW1hID0gei5vYmplY3Qoe1xuICAgIHRpdGxlOiB6LnN0cmluZygpLm1pbigzLCBcIlRpdGxlIG11c3QgYmUgYXQgbGVhc3QgMyBjaGFyYWN0ZXJzXCIpLFxuICAgIHNsdWc6IHouc3RyaW5nKCkubWluKDMsIFwiU2x1ZyBtdXN0IGJlIGF0IGxlYXN0IDMgY2hhcmFjdGVyc1wiKSxcbiAgICBkZXNjcmlwdGlvbjogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAgIHN0YXJ0VGltZTogei5kYXRlKCksXG4gICAgZW5kVGltZTogei5kYXRlKCksXG4gICAgdmlzaWJpbGl0eTogei5lbnVtKFtcIlBVQkxJQ1wiLCBcIklOU1RJVFVUSU9OXCIsIFwiQ0xBU1NST09NXCJdKSxcbiAgICBoaWRkZW46IHouYm9vbGVhbigpLmRlZmF1bHQoZmFsc2UpLFxuICAgIGNsYXNzcm9vbUlkOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgaW5zdGl0dXRpb25JZDogei5zdHJpbmcoKS5vcHRpb25hbCgpLm51bGxhYmxlKCksXG4gICAgYmFja2dyb3VuZEltYWdlOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgcHJpemVzOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgcnVsZXM6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgICBwcm9ibGVtczogei5hcnJheSh6LmFueSgpKSwgLy8gRnVsbCBwcm9ibGVtIGRhdGEgb2JqZWN0c1xuICAgIGNvbnRlc3RQYXNzd29yZDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAgIHJhbmRvbWl6ZVF1ZXN0aW9uczogei5ib29sZWFuKCkuZGVmYXVsdChmYWxzZSksXG59KTtcblxuLyoqXG4gKiBGZXRjaGVzIGNvbnRlc3RzIHZpc2libGUgdG8gdGhlIGN1cnJlbnQgdXNlci5cbiAqL1xuLyoqXG4gKiBDYWNoZWQgZmV0Y2ggZm9yIHB1YmxpYyBjb250ZXN0c1xuICovXG5hc3luYyBmdW5jdGlvbiBnZXRQdWJsaWNDb250ZXN0cygpIHtcbiAgICBcInVzZSBjYWNoZVwiXG4gICAgY2FjaGVUYWcoXCJjb250ZXN0cy1wdWJsaWNcIik7XG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIGNhY2hlTGlmZShcImNvbnRlc3RzXCIpO1xuXG4gICAgcmV0dXJuIHByaXNtYS5jb250ZXN0LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgIHZpc2liaWxpdHk6IFwiUFVCTElDXCIsXG4gICAgICAgICAgICBoaWRkZW46IGZhbHNlLFxuICAgICAgICB9LFxuICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICBfY291bnQ6IHsgc2VsZWN0OiB7IHByb2JsZW1zOiB0cnVlIH0gfVxuICAgICAgICB9LFxuICAgICAgICBvcmRlckJ5OiB7IHN0YXJ0VGltZTogXCJkZXNjXCIgfSxcbiAgICB9KTtcbn1cblxuLyoqXG4gKiBGZXRjaGVzIGNvbnRlc3RzIHZpc2libGUgdG8gdGhlIGN1cnJlbnQgdXNlci5cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFZpc2libGVDb250ZXN0cygpIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIHRyeSB7XG4gICAgICAgIGlmICghc2Vzc2lvbj8udXNlcikge1xuICAgICAgICAgICAgY29uc3QgY29udGVzdHMgPSBhd2FpdCBnZXRQdWJsaWNDb250ZXN0cygpO1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgY29udGVzdHMgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gc2Vzc2lvbi51c2VyIGFzIGFueTtcblxuICAgICAgICBpZiAoY3VycmVudFVzZXIucm9sZSA9PT0gXCJBRE1JTlwiKSB7XG4gICAgICAgICAgICBjb25zdCBjb250ZXN0cyA9IGF3YWl0IHByaXNtYS5jb250ZXN0LmZpbmRNYW55KHtcbiAgICAgICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgICAgIF9jb3VudDogeyBzZWxlY3Q6IHsgcHJvYmxlbXM6IHRydWUgfSB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBvcmRlckJ5OiB7IHN0YXJ0VGltZTogXCJkZXNjXCIgfSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgY29udGVzdHMgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGNvbnRlc3RzID0gYXdhaXQgcHJpc21hLmNvbnRlc3QuZmluZE1hbnkoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICBPUjogW1xuICAgICAgICAgICAgICAgICAgICB7IHZpc2liaWxpdHk6IFwiUFVCTElDXCIgfSxcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgQU5EOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeyB2aXNpYmlsaXR5OiBcIklOU1RJVFVUSU9OXCIgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IGluc3RpdHV0aW9uSWQ6IGN1cnJlbnRVc2VyLmluc3RpdHV0aW9uSWQgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIEFORDogW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgdmlzaWJpbGl0eTogXCJDTEFTU1JPT01cIiB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgT1I6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgY2xhc3Nyb29tOiB7IHN0dWRlbnRzOiB7IHNvbWU6IHsgaWQ6IGN1cnJlbnRVc2VyLmlkIH0gfSB9IH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IGNyZWF0b3JJZDogY3VycmVudFVzZXIuaWQgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgeyBjcmVhdG9ySWQ6IGN1cnJlbnRVc2VyLmlkIH0sXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgX2NvdW50OiB7IHNlbGVjdDogeyBwcm9ibGVtczogdHJ1ZSB9IH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvcmRlckJ5OiB7IHN0YXJ0VGltZTogXCJkZXNjXCIgfSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgY29udGVzdHMgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGZldGNoIGNvbnRlc3RzOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZmV0Y2ggY29udGVzdHNcIiB9O1xuICAgIH1cbn1cblxuXG4vKipcbiAqIEZldGNoZXMgYSBzaW5nbGUgY29udGVzdCdzIGRldGFpbHMgd2l0aCBhdXRob3JpemF0aW9uLlxuICovXG4vKipcbiAqIEZldGNoZXMgYSBzaW5nbGUgY29udGVzdCdzIGRldGFpbHMgd2l0aCBhdXRob3JpemF0aW9uLlxuICovXG4vKipcbiAqIENhY2hlZCBjb250ZXN0IGRldGFpbCBmZXRjaGVyXG4gKiBSZXR1cm5zIGNvbnRlc3QgZGF0YSB3aXRob3V0IHVzZXItc3BlY2lmaWMgY29udGV4dFxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRDYWNoZWRDb250ZXN0KGNvbnRlc3RJZDogc3RyaW5nKSB7XG4gICAgXCJ1c2UgY2FjaGVcIlxuICAgIGNhY2hlVGFnKGBjb250ZXN0LSR7Y29udGVzdElkfWApO1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBjYWNoZUxpZmUoXCJjb250ZXN0LWRldGFpbFwiKTtcblxuICAgIHJldHVybiBwcmlzbWEuY29udGVzdC5maW5kVW5pcXVlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6IGNvbnRlc3RJZCB9LFxuICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICBfY291bnQ6IHtcbiAgICAgICAgICAgICAgICBzZWxlY3Q6IHsgcHJvYmxlbXM6IHRydWUgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwcm9ibGVtczoge1xuICAgICAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICAgICAgcHJvYmxlbToge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlmZmljdWx0eTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbHVnOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9yZGVyQnk6IHsgb3JkZXI6IFwiYXNjXCIgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgfSk7XG59XG5cbi8qKlxuICogRmV0Y2hlcyBhIHNpbmdsZSBjb250ZXN0J3MgZGV0YWlscyB3aXRoIGF1dGhvcml6YXRpb24uXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRDb250ZXN0RGV0YWlsKGNvbnRlc3RJZDogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjb250ZXN0ID0gYXdhaXQgZ2V0Q2FjaGVkQ29udGVzdChjb250ZXN0SWQpO1xuXG4gICAgICAgIGlmICghY29udGVzdCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkNvbnRlc3Qgbm90IGZvdW5kXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gc2Vzc2lvbj8udXNlciBhcyBhbnk7XG4gICAgICAgIGNvbnN0IHBhcnRpY2lwYXRpb24gPSBjdXJyZW50VXNlciA/IGF3YWl0IHByaXNtYS5jb250ZXN0UGFydGljaXBhdGlvbi5maW5kVW5pcXVlKHtcbiAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgdXNlcklkX2NvbnRlc3RJZDoge1xuICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IGN1cnJlbnRVc2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkgOiBudWxsO1xuXG4gICAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgICAgIGNvbnN0IGhhc1N0YXJ0ZWQgPSBub3cgPj0gY29udGVzdC5zdGFydFRpbWU7XG4gICAgICAgIGNvbnN0IGlzQ3JlYXRvciA9IGN1cnJlbnRVc2VyPy5pZCA9PT0gY29udGVzdC5jcmVhdG9ySWQ7XG4gICAgICAgIGNvbnN0IGlzQWRtaW4gPSBjdXJyZW50VXNlcj8ucm9sZSA9PT0gXCJBRE1JTlwiO1xuXG4gICAgICAgIC8vIFZpc2liaWxpdHkgQ2hlY2tcbiAgICAgICAgbGV0IGlzQXV0aG9yaXplZCA9IGZhbHNlO1xuICAgICAgICBpZiAoY29udGVzdC52aXNpYmlsaXR5ID09PSBcIlBVQkxJQ1wiKSB7XG4gICAgICAgICAgICBpc0F1dGhvcml6ZWQgPSB0cnVlO1xuICAgICAgICB9IGVsc2UgaWYgKGlzQWRtaW4pIHtcbiAgICAgICAgICAgIGlzQXV0aG9yaXplZCA9IHRydWU7XG4gICAgICAgIH0gZWxzZSBpZiAoY3VycmVudFVzZXIpIHtcbiAgICAgICAgICAgIGlmIChpc0NyZWF0b3IpIHtcbiAgICAgICAgICAgICAgICBpc0F1dGhvcml6ZWQgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChjb250ZXN0LnZpc2liaWxpdHkgPT09IFwiSU5TVElUVVRJT05cIikge1xuICAgICAgICAgICAgICAgIC8vIFVzZSA9PSBmb3IgbnVsbC91bmRlZmluZWQgbG9vc2UgZXF1YWxpdHkgY2hlY2tcbiAgICAgICAgICAgICAgICBpc0F1dGhvcml6ZWQgPSBjdXJyZW50VXNlci5pbnN0aXR1dGlvbklkID09IGNvbnRlc3QuaW5zdGl0dXRpb25JZDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoY29udGVzdC52aXNpYmlsaXR5ID09PSBcIkNMQVNTUk9PTVwiKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZW5yb2xsbWVudCA9IGF3YWl0IHByaXNtYS5jbGFzc3Jvb20uZmluZEZpcnN0KHtcbiAgICAgICAgICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBjb250ZXN0LmNsYXNzcm9vbUlkIGFzIHN0cmluZyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0dWRlbnRzOiB7IHNvbWU6IHsgaWQ6IGN1cnJlbnRVc2VyLmlkIH0gfSxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpc0F1dGhvcml6ZWQgPSAhIWVucm9sbG1lbnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIWlzQXV0aG9yaXplZCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZCBhY2Nlc3MgdG8gdGhpcyBjb250ZXN0LlwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBjYW5TZWVQcm9ibGVtcyA9IChoYXNTdGFydGVkIHx8IGlzQWRtaW4gfHwgaXNDcmVhdG9yKSAmJiAocGFydGljaXBhdGlvbj8uYWNjZXB0ZWRSdWxlcyB8fCBpc0NyZWF0b3IgfHwgaXNBZG1pbik7XG5cbiAgICAgICAgLy8gRml4OiBJZiB0aGUgY29udGVzdCBpcyBvdmVyLCBhbGxvd2VkIHJvbGVzIHNob3VsZCBjaGVjayBwYXJ0aWNpcGF0aW9uIHByb3Blcmx5LFxuICAgICAgICAvLyBidXQgdHlwaWNhbGx5IGFsbG93cyB2aWV3aW5nIGlmIHB1YmxpYy9hdXRob3JpemVkLlxuICAgICAgICAvLyBCdXQgZm9yIFwiTGl2ZVwiIGNvbnRlc3RzLCB0aGUgY3VycmVudCBsb2dpYyBpcyBjb3JyZWN0LlxuXG4gICAgICAgIGNvbnN0IHJlcXVpcmVzUGFzc3dvcmQgPSAhIWNvbnRlc3QuY29udGVzdFBhc3N3b3JkO1xuXG4gICAgICAgIC8vIFNodWZmbGUgcHJvYmxlbXMgaWYgcmFuZG9taXplUXVlc3Rpb25zIGlzIGVuYWJsZWRcbiAgICAgICAgLy8gVXNlIGEgc2ltcGxlIHNlZWRlZCBzaHVmZmxlIGJhc2VkIG9uIHVzZXJJZCArIGNvbnRlc3RJZCBmb3IgY29uc2lzdGVuY3lcbiAgICAgICAgbGV0IHZpc2libGVQcm9ibGVtcyA9IGNhblNlZVByb2JsZW1zID8gY29udGVzdC5wcm9ibGVtcyA6IFtdO1xuXG4gICAgICAgIGlmIChjb250ZXN0LnJhbmRvbWl6ZVF1ZXN0aW9ucyAmJiBjdXJyZW50VXNlciAmJiB2aXNpYmxlUHJvYmxlbXMubGVuZ3RoID4gMCAmJiAhaXNBZG1pbiAmJiAhaXNDcmVhdG9yKSB7XG4gICAgICAgICAgICAvLyBTaW1wbGUgc3RyaW5nIGhhc2ggZnVuY3Rpb24gZm9yIHNlZWRpbmdcbiAgICAgICAgICAgIGNvbnN0IHNlZWRTdHIgPSBgJHtjdXJyZW50VXNlci5pZH0tJHtjb250ZXN0SWR9YDtcbiAgICAgICAgICAgIGxldCBzZWVkID0gMDtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2VlZFN0ci5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHNlZWQgPSAoKHNlZWQgPDwgNSkgLSBzZWVkKSArIHNlZWRTdHIuY2hhckNvZGVBdChpKTtcbiAgICAgICAgICAgICAgICBzZWVkIHw9IDA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIERldGVybWluaXN0aWMgc2h1ZmZsZVxuICAgICAgICAgICAgdmlzaWJsZVByb2JsZW1zID0gWy4uLnZpc2libGVQcm9ibGVtc10uc29ydCgoYSwgYikgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHggPSBNYXRoLnNpbihzZWVkKyspICogMTAwMDA7XG4gICAgICAgICAgICAgICAgcmV0dXJuICh4IC0gTWF0aC5mbG9vcih4KSkgLSAwLjU7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEZldGNoIHVzZXIncyBzb2x2ZWQgcHJvYmxlbXMgZm9yIHRoaXMgY29udGVzdFxuICAgICAgICBjb25zdCBzb2x2ZWRQcm9ibGVtSWRzID0gbmV3IFNldDxzdHJpbmc+KCk7XG4gICAgICAgIGlmIChjdXJyZW50VXNlcikge1xuICAgICAgICAgICAgY29uc3Qgc29sdmVkU3VibWlzc2lvbnMgPSBhd2FpdCBwcmlzbWEuc3VibWlzc2lvbi5maW5kTWFueSh7XG4gICAgICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkOiBjdXJyZW50VXNlci5pZCxcbiAgICAgICAgICAgICAgICAgICAgY29udGVzdElkOiBjb250ZXN0SWQsXG4gICAgICAgICAgICAgICAgICAgIHN0YXR1czogXCJBQ0NFUFRFRFwiLFxuICAgICAgICAgICAgICAgICAgICBwcm9ibGVtSWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGluOiB2aXNpYmxlUHJvYmxlbXMubWFwKHAgPT4gcC5wcm9ibGVtLmlkKVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBzZWxlY3Q6IHsgcHJvYmxlbUlkOiB0cnVlIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgc29sdmVkU3VibWlzc2lvbnMuZm9yRWFjaChzID0+IHNvbHZlZFByb2JsZW1JZHMuYWRkKHMucHJvYmxlbUlkKSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRlc3Q6IHtcbiAgICAgICAgICAgICAgICAuLi5jb250ZXN0LFxuICAgICAgICAgICAgICAgIHByb2JsZW1zOiB2aXNpYmxlUHJvYmxlbXMubWFwKHZwID0+ICh7XG4gICAgICAgICAgICAgICAgICAgIC4uLnZwLFxuICAgICAgICAgICAgICAgICAgICBpc1NvbHZlZDogc29sdmVkUHJvYmxlbUlkcy5oYXModnAucHJvYmxlbS5pZClcbiAgICAgICAgICAgICAgICB9KSksXG4gICAgICAgICAgICAgICAgaGFzU3RhcnRlZCxcbiAgICAgICAgICAgICAgICBoYXNFbmRlZDogbm93ID4gY29udGVzdC5lbmRUaW1lLFxuICAgICAgICAgICAgICAgIGNhbk1hbmFnZTogaXNBZG1pbiB8fCBpc0NyZWF0b3IsXG4gICAgICAgICAgICAgICAgaGFzQWNjZXB0ZWRSdWxlczogcGFydGljaXBhdGlvbj8uYWNjZXB0ZWRSdWxlcyB8fCBmYWxzZSxcbiAgICAgICAgICAgICAgICBpc0ZpbmlzaGVkOiBwYXJ0aWNpcGF0aW9uPy5pc0ZpbmlzaGVkIHx8IGZhbHNlLFxuICAgICAgICAgICAgICAgIHJlcXVpcmVzUGFzc3dvcmQsXG4gICAgICAgICAgICAgICAgY29udGVzdFBhc3N3b3JkOiBudWxsLCAvLyBOZXZlciByZXR1cm4gcGxhaW4gcGFzc3dvcmRcbiAgICAgICAgICAgICAgICBzZXNzaW9uSWQ6IHBhcnRpY2lwYXRpb24/LnNlc3Npb25JZCAvLyBSZXR1cm4gc2Vzc2lvbklkIGZvciBwcm90ZWN0aW9uXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBmZXRjaCBjb250ZXN0IGRldGFpbDpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGZldGNoIGNvbnRlc3RcIiB9O1xuICAgIH1cbn1cblxuLy8gLi4uIGV4aXN0aW5nIGNvZGUgLi4uXG5cbi8vIC4uLiBleGlzdGluZyBjb2RlIC4uLlxuXG4vLyAuLi4gZXhpc3RpbmcgY29kZSAuLi5cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUNvbnRlc3QoZGF0YTogei5pbmZlcjx0eXBlb2YgY29udGVzdFNjaGVtYT4pIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIGlmICghc2Vzc2lvbj8udXNlcikge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcbiAgICB9XG5cbiAgICBjb25zdCBjdXJyZW50VXNlciA9IHNlc3Npb24udXNlciBhcyBhbnk7XG5cbiAgICBpZiAoIVtcIkFETUlOXCIsIFwiSU5TVElUVVRJT05fTUFOQUdFUlwiLCBcIkNPTlRFU1RfTUFOQUdFUlwiLCBcIlRFQUNIRVJcIl0uaW5jbHVkZXMoY3VycmVudFVzZXIucm9sZSkpIHtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgdmFsaWRhdGVkRGF0YSA9IGNvbnRlc3RTY2hlbWEucGFyc2UoZGF0YSk7XG5cbiAgICAgICAgLy8gR2VuZXJhdGUgYSBtb3JlIHJvYnVzdCB1bmlxdWUgc2x1Z1xuICAgICAgICBjb25zdCBiYXNlU2x1ZyA9IHZhbGlkYXRlZERhdGEudGl0bGUudG9Mb3dlckNhc2UoKS5yZXBsYWNlKC9bXmEtejAtOV0rL2csIFwiLVwiKS5yZXBsYWNlKC8oXi18LSQpL2csIFwiXCIpO1xuICAgICAgICBjb25zdCB1bmlxdWVTbHVnID0gYCR7YmFzZVNsdWd9LSR7RGF0ZS5ub3coKX1gO1xuXG4gICAgICAgIGNvbnN0IGNvbnRlc3QgPSBhd2FpdCBwcmlzbWEuY29udGVzdC5jcmVhdGUoe1xuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgIHRpdGxlOiB2YWxpZGF0ZWREYXRhLnRpdGxlLFxuICAgICAgICAgICAgICAgIHNsdWc6IHVuaXF1ZVNsdWcsXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHZhbGlkYXRlZERhdGEuZGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgc3RhcnRUaW1lOiB2YWxpZGF0ZWREYXRhLnN0YXJ0VGltZSxcbiAgICAgICAgICAgICAgICBlbmRUaW1lOiB2YWxpZGF0ZWREYXRhLmVuZFRpbWUsXG4gICAgICAgICAgICAgICAgdmlzaWJpbGl0eTogdmFsaWRhdGVkRGF0YS52aXNpYmlsaXR5IGFzIGFueSxcbiAgICAgICAgICAgICAgICBpbnN0aXR1dGlvbklkOiB2YWxpZGF0ZWREYXRhLnZpc2liaWxpdHkgIT09IFwiUFVCTElDXCIgPyAodmFsaWRhdGVkRGF0YS5pbnN0aXR1dGlvbklkIHx8IG51bGwpIDogbnVsbCxcbiAgICAgICAgICAgICAgICBjbGFzc3Jvb21JZDogdmFsaWRhdGVkRGF0YS52aXNpYmlsaXR5ID09PSBcIkNMQVNTUk9PTVwiID8gKHZhbGlkYXRlZERhdGEuY2xhc3Nyb29tSWQgfHwgbnVsbCkgOiBudWxsLFxuICAgICAgICAgICAgICAgIGNyZWF0b3JJZDogY3VycmVudFVzZXIuaWQsXG4gICAgICAgICAgICAgICAgY29udGVzdFBhc3N3b3JkOiB2YWxpZGF0ZWREYXRhLmNvbnRlc3RQYXNzd29yZCB8fCBudWxsLFxuICAgICAgICAgICAgICAgIHJhbmRvbWl6ZVF1ZXN0aW9uczogdmFsaWRhdGVkRGF0YS5yYW5kb21pemVRdWVzdGlvbnMgfHwgZmFsc2UsXG4gICAgICAgICAgICAgICAgcHJvYmxlbXM6IHtcbiAgICAgICAgICAgICAgICAgICAgY3JlYXRlOiB2YWxpZGF0ZWREYXRhLnByb2JsZW1zLm1hcCgocHJvYmxlbUlkLCBpbmRleCkgPT4gKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2JsZW1JZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG9yZGVyOiBpbmRleCxcbiAgICAgICAgICAgICAgICAgICAgfSkpLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcblxuICAgICAgICByZXZhbGlkYXRlUGF0aChcIi9kYXNoYm9hcmQvY29udGVzdHNcIik7XG4gICAgICAgIHJldmFsaWRhdGVQYXRoKFwiL2NvbnRlc3RcIik7XG4gICAgICAgIHJldmFsaWRhdGVUYWcoXCJjb250ZXN0c1wiLCBcIm1heFwiKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgY29udGVzdElkOiBjb250ZXN0LmlkIH07XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBjb250ZXN0OlwiLCBlcnJvcik7XG4gICAgICAgIC8vIFJldHVybiBjbGVhcmVyIGVycm9yIG1lc3NhZ2VzXG4gICAgICAgIGxldCBlcnJvck1lc3NhZ2UgPSBcIkZhaWxlZCB0byBjcmVhdGUgY29udGVzdFwiO1xuICAgICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiB6LlpvZEVycm9yKSB7XG4gICAgICAgICAgICAgZXJyb3JNZXNzYWdlID0gKGVycm9yIGFzIGFueSkuZXJyb3JzLm1hcCgoZTogYW55KSA9PiBlLm1lc3NhZ2UpLmpvaW4oXCIsIFwiKTtcbiAgICAgICAgfSBlbHNlIGlmIChlcnJvciBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgICAgICAgICAgZXJyb3JNZXNzYWdlID0gZXJyb3IubWVzc2FnZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVycm9yTWVzc2FnZSB9O1xuICAgIH1cbiAgICB9XG5cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUNvbnRlc3RXaXRoUHJvYmxlbXMoZGF0YTogei5pbmZlcjx0eXBlb2YgY29udGVzdFdpdGhQcm9ibGVtc1NjaGVtYT4pIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIGlmICghc2Vzc2lvbj8udXNlcikge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcbiAgICB9XG5cbiAgICBjb25zdCBjdXJyZW50VXNlciA9IHNlc3Npb24udXNlciBhcyBhbnk7XG5cbiAgICBpZiAoIVtcIkFETUlOXCIsIFwiSU5TVElUVVRJT05fTUFOQUdFUlwiLCBcIkNPTlRFU1RfTUFOQUdFUlwiLCBcIlRFQUNIRVJcIl0uaW5jbHVkZXMoY3VycmVudFVzZXIucm9sZSkpIHtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgdmFsaWRhdGVkRGF0YSA9IGNvbnRlc3RXaXRoUHJvYmxlbXNTY2hlbWEucGFyc2UoZGF0YSk7XG5cbiAgICAgICAgY29uc3QgY29udGVzdCA9IGF3YWl0IHByaXNtYS4kdHJhbnNhY3Rpb24oYXN5bmMgKHR4KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjb250ZXN0ID0gYXdhaXQgdHguY29udGVzdC5jcmVhdGUoe1xuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHZhbGlkYXRlZERhdGEudGl0bGUsXG4gICAgICAgICAgICAgICAgICAgIHNsdWc6IHZhbGlkYXRlZERhdGEuc2x1ZyxcbiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHZhbGlkYXRlZERhdGEuZGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0VGltZTogdmFsaWRhdGVkRGF0YS5zdGFydFRpbWUsXG4gICAgICAgICAgICAgICAgICAgIGVuZFRpbWU6IHZhbGlkYXRlZERhdGEuZW5kVGltZSxcbiAgICAgICAgICAgICAgICAgICAgdmlzaWJpbGl0eTogdmFsaWRhdGVkRGF0YS52aXNpYmlsaXR5IGFzIGFueSxcbiAgICAgICAgICAgICAgICAgICAgaGlkZGVuOiB2YWxpZGF0ZWREYXRhLmhpZGRlbixcbiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZEltYWdlOiB2YWxpZGF0ZWREYXRhLmJhY2tncm91bmRJbWFnZSxcbiAgICAgICAgICAgICAgICAgICAgcHJpemVzOiB2YWxpZGF0ZWREYXRhLnByaXplcyxcbiAgICAgICAgICAgICAgICAgICAgcnVsZXM6IHZhbGlkYXRlZERhdGEucnVsZXMsXG4gICAgICAgICAgICAgICAgICAgIGluc3RpdHV0aW9uSWQ6IHZhbGlkYXRlZERhdGEudmlzaWJpbGl0eSAhPT0gXCJQVUJMSUNcIiA/ICh2YWxpZGF0ZWREYXRhLmluc3RpdHV0aW9uSWQgfHwgbnVsbCkgOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICBjbGFzc3Jvb21JZDogdmFsaWRhdGVkRGF0YS52aXNpYmlsaXR5ID09PSBcIkNMQVNTUk9PTVwiID8gKHZhbGlkYXRlZERhdGEuY2xhc3Nyb29tSWQgfHwgbnVsbCkgOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICBjcmVhdG9ySWQ6IGN1cnJlbnRVc2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0UGFzc3dvcmQ6IHZhbGlkYXRlZERhdGEuY29udGVzdFBhc3N3b3JkIHx8IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIHJhbmRvbWl6ZVF1ZXN0aW9uczogdmFsaWRhdGVkRGF0YS5yYW5kb21pemVRdWVzdGlvbnMgfHwgZmFsc2UsXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmFsaWRhdGVkRGF0YS5wcm9ibGVtcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGNvbnN0IHAgPSB2YWxpZGF0ZWREYXRhLnByb2JsZW1zW2ldO1xuICAgICAgICAgICAgICAgIC8vIEdlbmVyYXRlIHVuaXF1ZSBzbHVnIGJ5IGFwcGVuZGluZyBjb250ZXN0IHNsdWcgYW5kIGluZGV4XG4gICAgICAgICAgICAgICAgY29uc3QgdW5pcXVlU2x1ZyA9IGAke3ZhbGlkYXRlZERhdGEuc2x1Z30tJHtwLnNsdWcgfHwgcC50aXRsZS50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoL1xccysvZywgJy0nKX0tJHtEYXRlLm5vdygpfS0ke2l9YDtcbiAgICAgICAgICAgICAgICBjb25zdCBwcm9ibGVtID0gYXdhaXQgdHgucHJvYmxlbS5jcmVhdGUoe1xuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogcC50aXRsZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBwLmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGlmZmljdWx0eTogcC5kaWZmaWN1bHR5LFxuICAgICAgICAgICAgICAgICAgICAgICAgc2x1ZzogdW5pcXVlU2x1ZyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3JlOiBwLnNjb3JlIHx8IDEwLFxuICAgICAgICAgICAgICAgICAgICAgICAgZG9tYWluOiBwLmRvbWFpbixcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiQ09OVEVTVFwiLCAvLyBDb250ZXN0IHByb2JsZW1zIGFyZSBtYXJrZWQgc2VwYXJhdGVseVxuICAgICAgICAgICAgICAgICAgICAgICAgaGlkZGVuOiB0cnVlLCAvLyBDb250ZXN0IHByb2JsZW1zIGFyZSBoaWRkZW4gZnJvbSBtYWluIGJhbmtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlc3RDYXNlczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZTogcC50ZXN0Q2FzZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgdGFnczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbm5lY3Q6IHAudGFncz8ubWFwKCh0OiBzdHJpbmcpID0+ICh7IG5hbWU6IHQgfSkpIHx8IFtdLFxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBhd2FpdCB0eC5jb250ZXN0UHJvYmxlbS5jcmVhdGUoe1xuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3QuaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9ibGVtSWQ6IHByb2JsZW0uaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBvcmRlcjogaSxcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gY29udGVzdDtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV2YWxpZGF0ZVBhdGgoXCIvZGFzaGJvYXJkL2NvbnRlc3RzXCIpO1xuICAgICAgICByZXZhbGlkYXRlUGF0aChcIi9jb250ZXN0c1wiKTtcbiAgICAgICAgcmV2YWxpZGF0ZVBhdGgoXCIvY29udGVzdFwiKTtcbiAgICAgICAgcmV2YWxpZGF0ZVRhZyhcImNvbnRlc3RzXCIsIFwibWF4XCIpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBjb250ZXN0SWQ6IGNvbnRlc3QuaWQgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBjb250ZXN0IHdpdGggcHJvYmxlbXM6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBjcmVhdGUgY29udGVzdFwiIH07XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0SW5zdGl0dXRpb25hbENsYXNzcm9vbXMoaW5zdGl0dXRpb25JZDogc3RyaW5nKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgY2xhc3Nyb29tcyA9IGF3YWl0IHByaXNtYS5jbGFzc3Jvb20uZmluZE1hbnkoe1xuICAgICAgICAgICAgd2hlcmU6IHsgaW5zdGl0dXRpb25JZCB9LFxuICAgICAgICAgICAgc2VsZWN0OiB7IGlkOiB0cnVlLCBuYW1lOiB0cnVlLCBzZWN0aW9uOiB0cnVlIH0sXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBjbGFzc3Jvb21zIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBmZXRjaCBjbGFzc3Jvb21zOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZmV0Y2ggY2xhc3Nyb29tc1wiIH07XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0U2VsZWN0YWJsZVByb2JsZW1zKHNlYXJjaDogc3RyaW5nKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcHJvYmxlbXMgPSBhd2FpdCBwcmlzbWEucHJvYmxlbS5maW5kTWFueSh7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgIE9SOiBbXG4gICAgICAgICAgICAgICAgICAgIHsgdGl0bGU6IHsgY29udGFpbnM6IHNlYXJjaCwgbW9kZTogXCJpbnNlbnNpdGl2ZVwiIH0gfSxcbiAgICAgICAgICAgICAgICAgICAgeyBzbHVnOiB7IGNvbnRhaW5zOiBzZWFyY2gsIG1vZGU6IFwiaW5zZW5zaXRpdmVcIiB9IH0sXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBoaWRkZW46IGZhbHNlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNlbGVjdDogeyBpZDogdHJ1ZSwgdGl0bGU6IHRydWUsIGRpZmZpY3VsdHk6IHRydWUsIHNsdWc6IHRydWUgfSxcbiAgICAgICAgICAgIHRha2U6IDEwLFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgcHJvYmxlbXMgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGZldGNoIHByb2JsZW1zOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZmV0Y2ggcHJvYmxlbXNcIiB9O1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGFjY2VwdENvbnRlc3RSdWxlcyhjb250ZXN0SWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcblxuICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHByaXNtYS5jb250ZXN0UGFydGljaXBhdGlvbi51cHNlcnQoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1cGRhdGU6IHsgYWNjZXB0ZWRSdWxlczogdHJ1ZSB9LFxuICAgICAgICAgICAgY3JlYXRlOiB7XG4gICAgICAgICAgICAgICAgdXNlcklkOiBzZXNzaW9uLnVzZXIuaWQsXG4gICAgICAgICAgICAgICAgY29udGVzdElkOiBjb250ZXN0SWQsXG4gICAgICAgICAgICAgICAgYWNjZXB0ZWRSdWxlczogdHJ1ZVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV2YWxpZGF0ZVBhdGgoYC9jb250ZXN0LyR7Y29udGVzdElkfWApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBhY2NlcHQgcnVsZXNcIiB9O1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGZpbmlzaENvbnRlc3RBY3Rpb24oY29udGVzdElkOiBzdHJpbmcpIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIGlmICghc2Vzc2lvbj8udXNlcikgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG5cbiAgICB0cnkge1xuICAgICAgICBhd2FpdCBwcmlzbWEuY29udGVzdFBhcnRpY2lwYXRpb24udXBzZXJ0KHtcbiAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgdXNlcklkX2NvbnRlc3RJZDoge1xuICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IHNlc3Npb24udXNlci5pZCxcbiAgICAgICAgICAgICAgICAgICAgY29udGVzdElkOiBjb250ZXN0SWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdXBkYXRlOiB7XG4gICAgICAgICAgICAgICAgaXNGaW5pc2hlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBmaW5pc2hlZEF0OiBuZXcgRGF0ZSgpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY3JlYXRlOiB7XG4gICAgICAgICAgICAgICAgdXNlcklkOiBzZXNzaW9uLnVzZXIuaWQsXG4gICAgICAgICAgICAgICAgY29udGVzdElkOiBjb250ZXN0SWQsXG4gICAgICAgICAgICAgICAgYWNjZXB0ZWRSdWxlczogdHJ1ZSxcbiAgICAgICAgICAgICAgICBpc0ZpbmlzaGVkOiB0cnVlLFxuICAgICAgICAgICAgICAgIGZpbmlzaGVkQXQ6IG5ldyBEYXRlKClcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldmFsaWRhdGVQYXRoKGAvY29udGVzdC8ke2NvbnRlc3RJZH1gKTtcbiAgICAgICAgcmV2YWxpZGF0ZVBhdGgoYC9wcm9ibGVtc2ApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBmaW5pc2ggY29udGVzdFwiIH07XG4gICAgfVxufVxuXG4vKipcbiAqIEZpbmFsaXplIENvbnRlc3QgJiBBd2FyZCBCYWRnZXNcbiAqIC0gQ2FsY3VsYXRlcyBsZWFkZXJib2FyZFxuICogLSBBd2FyZHMgR29sZCwgU2lsdmVyLCBCcm9uemUgdG8gVG9wIDNcbiAqIC0gTWFya3MgY29udGVzdCBhcyBmaW5hbGl6ZWRcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGZpbmFsaXplQ29udGVzdChjb250ZXN0SWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcblxuICAgIC8vIE9ubHkgYWRtaW5zIG9yIGNvbnRlc3QgbWFuYWdlcnMgY2FuIGZpbmFsaXplXG4gICAgY29uc3QgY3VycmVudFVzZXIgPSBzZXNzaW9uLnVzZXIgYXMgYW55O1xuICAgIGlmICghW1wiQURNSU5cIiwgXCJDT05URVNUX01BTkFHRVJcIiwgXCJJTlNUSVRVVElPTl9NQU5BR0VSXCIsIFwiVEVBQ0hFUlwiXS5pbmNsdWRlcyhjdXJyZW50VXNlci5yb2xlKSkge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjb250ZXN0ID0gYXdhaXQgcHJpc21hLmNvbnRlc3QuZmluZFVuaXF1ZSh7XG4gICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IGNvbnRlc3RJZCB9LFxuICAgICAgICAgICAgIHNlbGVjdDogeyBpc0ZpbmFsaXplZDogdHJ1ZSwgdGl0bGU6IHRydWUgfVxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoIWNvbnRlc3QpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJDb250ZXN0IG5vdCBmb3VuZFwiIH07XG4gICAgICAgIGlmIChjb250ZXN0LmlzRmluYWxpemVkKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiQ29udGVzdCBpcyBhbHJlYWR5IGZpbmFsaXplZFwiIH07XG5cbiAgICAgICAgLy8gUmV1c2UgbGVhZGVyYm9hcmQgbG9naWMgdG8gZ2V0IHJhbmtpbmdzXG4gICAgICAgIGNvbnN0IGxlYWRlcmJvYXJkID0gYXdhaXQgZ2V0Q29udGVzdExlYWRlcmJvYXJkKGNvbnRlc3RJZCk7XG4gICAgICAgIGlmICghbGVhZGVyYm9hcmQuc3VjY2VzcyB8fCAhbGVhZGVyYm9hcmQuc3R1ZGVudHMpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZmV0Y2ggbGVhZGVyYm9hcmRcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgc3R1ZGVudHMgPSBsZWFkZXJib2FyZC5zdHVkZW50cyBhcyBhbnlbXTtcblxuICAgICAgICAvLyBBdCBsZWFzdCAxIHN0dWRlbnQgbmVlZGVkXG4gICAgICAgIGlmIChzdHVkZW50cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICBhd2FpdCBwcmlzbWEuY29udGVzdC51cGRhdGUoe1xuICAgICAgICAgICAgICAgICB3aGVyZTogeyBpZDogY29udGVzdElkIH0sXG4gICAgICAgICAgICAgICAgIGRhdGE6IHsgaXNGaW5hbGl6ZWQ6IHRydWUgfVxuICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIG1lc3NhZ2U6IFwiQ29udGVzdCBmaW5hbGl6ZWQgKG5vIHBhcnRpY2lwYW50cylcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVG9wIDMgSURzXG4gICAgICAgIGNvbnN0IGdvbGRVc2VySWQgPSBzdHVkZW50c1swXT8uaWQ7XG4gICAgICAgIGNvbnN0IHNpbHZlclVzZXJJZCA9IHN0dWRlbnRzWzFdPy5pZDtcbiAgICAgICAgY29uc3QgYnJvbnplVXNlcklkID0gc3R1ZGVudHNbMl0/LmlkO1xuXG4gICAgICAgIGF3YWl0IHByaXNtYS4kdHJhbnNhY3Rpb24oYXN5bmMgKHR4KSA9PiB7XG4gICAgICAgICAgICAvLyBBd2FyZCBHb2xkXG4gICAgICAgICAgICBpZiAoZ29sZFVzZXJJZCkge1xuICAgICAgICAgICAgICAgIGF3YWl0IHR4LnVzZXIudXBkYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IGdvbGRVc2VySWQgfSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogeyBnb2xkQmFkZ2VzOiB7IGluY3JlbWVudDogMSB9IH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIEF3YXJkIFNpbHZlclxuICAgICAgICAgICAgaWYgKHNpbHZlclVzZXJJZCkge1xuICAgICAgICAgICAgICAgIGF3YWl0IHR4LnVzZXIudXBkYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IHNpbHZlclVzZXJJZCB9LFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7IHNpbHZlckJhZGdlczogeyBpbmNyZW1lbnQ6IDEgfSB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBBd2FyZCBCcm9uemVcbiAgICAgICAgICAgIGlmIChicm9uemVVc2VySWQpIHtcbiAgICAgICAgICAgICAgICBhd2FpdCB0eC51c2VyLnVwZGF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIHdoZXJlOiB7IGlkOiBicm9uemVVc2VySWQgfSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogeyBicm9uemVCYWRnZXM6IHsgaW5jcmVtZW50OiAxIH0gfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBNYXJrIEZpbmFsaXplZFxuICAgICAgICAgICAgYXdhaXQgdHguY29udGVzdC51cGRhdGUoe1xuICAgICAgICAgICAgICAgIHdoZXJlOiB7IGlkOiBjb250ZXN0SWQgfSxcbiAgICAgICAgICAgICAgICBkYXRhOiB7IGlzRmluYWxpemVkOiB0cnVlIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICByZXZhbGlkYXRlUGF0aChgL2Rhc2hib2FyZGApO1xuICAgICAgICByZXZhbGlkYXRlUGF0aChgL3Byb2ZpbGUvJHtnb2xkVXNlcklkfWApO1xuICAgICAgICBpZihzaWx2ZXJVc2VySWQpIHJldmFsaWRhdGVQYXRoKGAvcHJvZmlsZS8ke3NpbHZlclVzZXJJZH1gKTtcbiAgICAgICAgaWYoYnJvbnplVXNlcklkKSByZXZhbGlkYXRlUGF0aChgL3Byb2ZpbGUvJHticm9uemVVc2VySWR9YCk7XG4gICAgICAgIHJldmFsaWRhdGVQYXRoKGAvY29udGVzdC8ke2NvbnRlc3RJZH1gKTtcbiAgICAgICAgcmV2YWxpZGF0ZVRhZyhgY29udGVzdC0ke2NvbnRlc3RJZH1gLCBcIm1heFwiKTtcbiAgICAgICAgcmV2YWxpZGF0ZVRhZyhgbGVhZGVyYm9hcmQtJHtjb250ZXN0SWR9YCwgXCJtYXhcIik7XG5cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gZmluYWxpemUgY29udGVzdDpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGZpbmFsaXplIGNvbnRlc3RcIiB9O1xuICAgIH1cbn1cblxuLyoqXG4gKiBWZXJpZnkgY29udGVzdCBwYXNzd29yZCB3aXRob3V0IHN0YXJ0aW5nIHNlc3Npb24uXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB2ZXJpZnlDb250ZXN0UGFzc3dvcmQoY29udGVzdElkOiBzdHJpbmcsIHBhc3N3b3JkPzogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICBpZiAoIXNlc3Npb24/LnVzZXIpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgY29udGVzdCA9IGF3YWl0IHByaXNtYS5jb250ZXN0LmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IGNvbnRlc3RJZCB9LFxuICAgICAgICAgICAgc2VsZWN0OiB7IGNvbnRlc3RQYXNzd29yZDogdHJ1ZSB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICghY29udGVzdCkgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkNvbnRlc3Qgbm90IGZvdW5kXCIgfTtcblxuICAgICAgICBpZiAoY29udGVzdC5jb250ZXN0UGFzc3dvcmQgJiYgY29udGVzdC5jb250ZXN0UGFzc3dvcmQgIT09IHBhc3N3b3JkKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiSW52YWxpZCBjb250ZXN0IHBhc3N3b3JkXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIHZlcmlmeSBjb250ZXN0IHBhc3N3b3JkOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gdmVyaWZ5IHBhc3N3b3JkXCIgfTtcbiAgICB9XG59XG5cblxuLyoqXG4gKiBTdGFydCBhIGNvbnRlc3Qgc2Vzc2lvbiAtIHZhbGlkYXRlcyB0aW1lIGJvdW5kcyBhbmQgY3JlYXRlcyBzZXNzaW9uIElEXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzdGFydENvbnRlc3RTZXNzaW9uKGNvbnRlc3RJZDogc3RyaW5nLCBwYXNzd29yZD86IHN0cmluZykge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcblxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRlc3QgPSBhd2FpdCBwcmlzbWEuY29udGVzdC5maW5kVW5pcXVlKHtcbiAgICAgICAgICAgIHdoZXJlOiB7IGlkOiBjb250ZXN0SWQgfSxcbiAgICAgICAgICAgIHNlbGVjdDogeyBzdGFydFRpbWU6IHRydWUsIGVuZFRpbWU6IHRydWUsIGNvbnRlc3RQYXNzd29yZDogdHJ1ZSB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICghY29udGVzdCkgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkNvbnRlc3Qgbm90IGZvdW5kXCIgfTtcblxuICAgICAgICBpZiAoY29udGVzdC5jb250ZXN0UGFzc3dvcmQgJiYgY29udGVzdC5jb250ZXN0UGFzc3dvcmQgIT09IHBhc3N3b3JkKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiSW52YWxpZCBjb250ZXN0IHBhc3N3b3JkXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG5cbiAgICAgICAgLy8gVGltZSBib3VuZHMgY2hlY2tcbiAgICAgICAgaWYgKG5vdyA8IGNvbnRlc3Quc3RhcnRUaW1lKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiQ29udGVzdCBoYXMgbm90IHN0YXJ0ZWQgeWV0XCIgfTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobm93ID4gY29udGVzdC5lbmRUaW1lKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiQ29udGVzdCBoYXMgYWxyZWFkeSBlbmRlZFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBHZW5lcmF0ZSB1bmlxdWUgc2Vzc2lvbiBJRFxuICAgICAgICBjb25zdCBzZXNzaW9uSWQgPSBgJHtzZXNzaW9uLnVzZXIuaWR9LSR7Y29udGVzdElkfS0ke0RhdGUubm93KCl9YDtcblxuICAgICAgICAvLyBDaGVjayBmb3IgZXhpc3RpbmcgYWN0aXZlIHNlc3Npb24gKG11bHRpLXRhYiBkZXRlY3Rpb24pXG4gICAgICAgIGNvbnN0IGV4aXN0aW5nUGFydGljaXBhdGlvbiA9IGF3YWl0IHByaXNtYS5jb250ZXN0UGFydGljaXBhdGlvbi5maW5kVW5pcXVlKHtcbiAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgdXNlcklkX2NvbnRlc3RJZDoge1xuICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IHNlc3Npb24udXNlci5pZCxcbiAgICAgICAgICAgICAgICAgICAgY29udGVzdElkOiBjb250ZXN0SWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChleGlzdGluZ1BhcnRpY2lwYXRpb24/LmlzQmxvY2tlZCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIllvdSBoYXZlIGJlZW4gYmxvY2tlZCBmcm9tIHRoaXMgY29udGVzdCBkdWUgdG8gdmlvbGF0aW9uc1wiIH07XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZXhpc3RpbmdQYXJ0aWNpcGF0aW9uPy5pc0ZpbmlzaGVkKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiWW91IGhhdmUgYWxyZWFkeSBmaW5pc2hlZCB0aGlzIGNvbnRlc3RcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVXBkYXRlIG9yIGNyZWF0ZSBwYXJ0aWNpcGF0aW9uIHdpdGggbmV3IHNlc3Npb25cbiAgICAgICAgY29uc3QgcGFydGljaXBhdGlvbiA9IGF3YWl0IHByaXNtYS5jb250ZXN0UGFydGljaXBhdGlvbi51cHNlcnQoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1cGRhdGU6IHtcbiAgICAgICAgICAgICAgICBzZXNzaW9uSWQsXG4gICAgICAgICAgICAgICAgc2Vzc2lvblN0YXJ0ZWRBdDogbm93LFxuICAgICAgICAgICAgICAgIGFjY2VwdGVkUnVsZXM6IHRydWVcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjcmVhdGU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWQ6IHNlc3Npb24udXNlci5pZCxcbiAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZCxcbiAgICAgICAgICAgICAgICBzZXNzaW9uSWQsXG4gICAgICAgICAgICAgICAgc2Vzc2lvblN0YXJ0ZWRBdDogbm93LFxuICAgICAgICAgICAgICAgIGFjY2VwdGVkUnVsZXM6IHRydWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgICBzZXNzaW9uSWQsXG4gICAgICAgICAgICBwYXJ0aWNpcGF0aW9uSWQ6IHBhcnRpY2lwYXRpb24uaWQsXG4gICAgICAgICAgICB0b3RhbFZpb2xhdGlvbnM6IHBhcnRpY2lwYXRpb24udG90YWxWaW9sYXRpb25zLFxuICAgICAgICAgICAgaXNGbGFnZ2VkOiBwYXJ0aWNpcGF0aW9uLmlzRmxhZ2dlZFxuICAgICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gc3RhcnQgY29udGVzdCBzZXNzaW9uOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gc3RhcnQgY29udGVzdCBzZXNzaW9uXCIgfTtcbiAgICB9XG59XG5cbi8qKlxuICogTG9nIGEgY29udGVzdCB2aW9sYXRpb24gLSByZWNvcmRzIHRvIGRhdGFiYXNlIGFuZCB1cGRhdGVzIGNvdW50ZXJzXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBsb2dDb250ZXN0VmlvbGF0aW9uKFxuICAgIGNvbnRlc3RJZDogc3RyaW5nLFxuICAgIHR5cGU6IFwiVEFCX1NXSVRDSFwiIHwgXCJGVUxMU0NSRUVOX0VYSVRcIiB8IFwiQ09QWV9QQVNURVwiIHwgXCJERVZUT09MU19PUEVOXCIgfCBcIktFWUJPQVJEX1NIT1JUQ1VUXCIgfCBcIk5BVklHQVRJT05fQVRURU1QVFwiIHwgXCJNVUxUSV9UQUJcIiB8IFwiU1VTUElDSU9VU19JTlBVVFwiLFxuICAgIG1lc3NhZ2U/OiBzdHJpbmcsXG4gICAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+XG4pIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIGlmICghc2Vzc2lvbj8udXNlcikgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBwYXJ0aWNpcGF0aW9uID0gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKCFwYXJ0aWNpcGF0aW9uKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiTm8gYWN0aXZlIHBhcnRpY2lwYXRpb24gZm91bmRcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gRGV0ZXJtaW5lIHdoaWNoIGNvdW50ZXIgdG8gaW5jcmVtZW50XG4gICAgICAgIGNvbnN0IGNvdW50ZXJGaWVsZCA9IHtcbiAgICAgICAgICAgIFRBQl9TV0lUQ0g6IFwidGFiU3dpdGNoQ291bnRcIixcbiAgICAgICAgICAgIEZVTExTQ1JFRU5fRVhJVDogXCJmdWxsc2NyZWVuRXhpdENvdW50XCIsXG4gICAgICAgICAgICBDT1BZX1BBU1RFOiBcImNvcHlQYXN0ZUNvdW50XCIsXG4gICAgICAgICAgICBERVZUT09MU19PUEVOOiBcImRldlRvb2xzQ291bnRcIixcbiAgICAgICAgICAgIEtFWUJPQVJEX1NIT1JUQ1VUOiBcImtleWJvYXJkQ291bnRcIixcbiAgICAgICAgICAgIE5BVklHQVRJT05fQVRURU1QVDogXCJuYXZpZ2F0aW9uQ291bnRcIixcbiAgICAgICAgICAgIE1VTFRJX1RBQjogXCJ0YWJTd2l0Y2hDb3VudFwiLFxuICAgICAgICAgICAgU1VTUElDSU9VU19JTlBVVDogXCJjb3B5UGFzdGVDb3VudFwiXG4gICAgICAgIH1bdHlwZV0gYXMgc3RyaW5nO1xuXG4gICAgICAgIC8vIFVzZSB0cmFuc2FjdGlvbiB0byBlbnN1cmUgYXRvbWljIHVwZGF0ZVxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBwcmlzbWEuJHRyYW5zYWN0aW9uKGFzeW5jICh0eCkgPT4ge1xuICAgICAgICAgICAgLy8gQ2hlY2sgbGFzdCB2aW9sYXRpb24gdGltZSB0byBwcmV2ZW50IHJhcGlkLWZpcmUgZHVwbGljYXRlcyAoU2VydmVyLXNpZGUgZGVib3VuY2UpXG4gICAgICAgICAgICBjb25zdCBsYXN0VmlvbGF0aW9uID0gYXdhaXQgdHguY29udGVzdFZpb2xhdGlvbi5maW5kRmlyc3Qoe1xuICAgICAgICAgICAgICAgIHdoZXJlOiB7IHBhcnRpY2lwYXRpb25JZDogcGFydGljaXBhdGlvbi5pZCB9LFxuICAgICAgICAgICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnZGVzYycgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmIChsYXN0VmlvbGF0aW9uKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdGltZURpZmYgPSBEYXRlLm5vdygpIC0gbGFzdFZpb2xhdGlvbi5jcmVhdGVkQXQuZ2V0VGltZSgpO1xuICAgICAgICAgICAgICAgIC8vIElmIGxlc3MgdGhhbiAyIHNlY29uZHMgc2luY2UgbGFzdCB2aW9sYXRpb24sIGlnbm9yZSB0aGlzIG9uZVxuICAgICAgICAgICAgICAgIGlmICh0aW1lRGlmZiA8IDIwMDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLnBhcnRpY2lwYXRpb24sIC8vIFJldHVybiBleGlzdGluZyBzdGF0ZVxuICAgICAgICAgICAgICAgICAgICAgICAgaXNGbGFnZ2VkOiBwYXJ0aWNpcGF0aW9uLmlzRmxhZ2dlZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzQmxvY2tlZDogcGFydGljaXBhdGlvbi5pc0Jsb2NrZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICB0b3RhbFZpb2xhdGlvbnM6IHBhcnRpY2lwYXRpb24udG90YWxWaW9sYXRpb25zLFxuICAgICAgICAgICAgICAgICAgICAgICAgcGVybWFuZW50bHlCbG9ja2VkOiBwYXJ0aWNpcGF0aW9uLnBlcm1hbmVudGx5QmxvY2tlZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBCbG9ja2VkVW50aWw6IHBhcnRpY2lwYXRpb24udGVtcEJsb2NrZWRVbnRpbFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQ3JlYXRlIHZpb2xhdGlvbiByZWNvcmRcbiAgICAgICAgICAgIGF3YWl0IHR4LmNvbnRlc3RWaW9sYXRpb24uY3JlYXRlKHtcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIHBhcnRpY2lwYXRpb25JZDogcGFydGljaXBhdGlvbi5pZCxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogdHlwZSBhcyBhbnksXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UsXG4gICAgICAgICAgICAgICAgICAgIG1ldGFkYXRhOiBtZXRhZGF0YSA/PyB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIG5ldyB0b3RhbCBhbmQgZGV0ZXJtaW5lIGJsb2NraW5nIHRpZXJcbiAgICAgICAgICAgIGNvbnN0IG5ld1RvdGFsVmlvbGF0aW9ucyA9IHBhcnRpY2lwYXRpb24udG90YWxWaW9sYXRpb25zICsgMTtcbiAgICAgICAgICAgIGNvbnN0IHNob3VsZEZsYWcgPSBuZXdUb3RhbFZpb2xhdGlvbnMgPj0gMztcblxuICAgICAgICAgICAgLy8gVGllcmVkIGJsb2NraW5nIGxvZ2ljXG4gICAgICAgICAgICBsZXQgdGVtcEJsb2NrZWRVbnRpbDogRGF0ZSB8IG51bGwgPSBudWxsO1xuICAgICAgICAgICAgbGV0IHBlcm1hbmVudGx5QmxvY2tlZCA9IGZhbHNlO1xuICAgICAgICAgICAgbGV0IGlzQmxvY2tlZCA9IGZhbHNlO1xuXG4gICAgICAgICAgICBpZiAobmV3VG90YWxWaW9sYXRpb25zID49IDYpIHtcbiAgICAgICAgICAgICAgICAvLyA2KyB2aW9sYXRpb25zID0gcGVybWFuZW50IGJsb2NrXG4gICAgICAgICAgICAgICAgcGVybWFuZW50bHlCbG9ja2VkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBpc0Jsb2NrZWQgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChuZXdUb3RhbFZpb2xhdGlvbnMgPj0gNCkge1xuICAgICAgICAgICAgICAgIC8vIDQtNSB2aW9sYXRpb25zID0gNSBtaW51dGUgdGVtcCBibG9ja1xuICAgICAgICAgICAgICAgIHRlbXBCbG9ja2VkVW50aWwgPSBuZXcgRGF0ZShEYXRlLm5vdygpICsgNSAqIDYwICogMTAwMCk7IC8vIDUgbWludXRlc1xuICAgICAgICAgICAgICAgIGlzQmxvY2tlZCA9IHRydWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZWQgPSBhd2FpdCB0eC5jb250ZXN0UGFydGljaXBhdGlvbi51cGRhdGUoe1xuICAgICAgICAgICAgICAgIHdoZXJlOiB7IGlkOiBwYXJ0aWNpcGF0aW9uLmlkIH0sXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBbY291bnRlckZpZWxkXTogeyBpbmNyZW1lbnQ6IDEgfSxcbiAgICAgICAgICAgICAgICAgICAgdG90YWxWaW9sYXRpb25zOiB7IGluY3JlbWVudDogMSB9LFxuICAgICAgICAgICAgICAgICAgICBpc0ZsYWdnZWQ6IHNob3VsZEZsYWcgfHwgcGFydGljaXBhdGlvbi5pc0ZsYWdnZWQsXG4gICAgICAgICAgICAgICAgICAgIGlzQmxvY2tlZCxcbiAgICAgICAgICAgICAgICAgICAgdGVtcEJsb2NrZWRVbnRpbCxcbiAgICAgICAgICAgICAgICAgICAgcGVybWFuZW50bHlCbG9ja2VkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiB1cGRhdGVkO1xuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgIHRvdGFsVmlvbGF0aW9uczogcmVzdWx0LnRvdGFsVmlvbGF0aW9ucyxcbiAgICAgICAgICAgIGlzRmxhZ2dlZDogcmVzdWx0LmlzRmxhZ2dlZCxcbiAgICAgICAgICAgIGlzQmxvY2tlZDogcmVzdWx0LmlzQmxvY2tlZCxcbiAgICAgICAgICAgIHRlbXBCbG9ja2VkVW50aWw6IHJlc3VsdC50ZW1wQmxvY2tlZFVudGlsPy50b0lTT1N0cmluZygpIHx8IG51bGwsXG4gICAgICAgICAgICBwZXJtYW5lbnRseUJsb2NrZWQ6IHJlc3VsdC5wZXJtYW5lbnRseUJsb2NrZWRcbiAgICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGxvZyB2aW9sYXRpb246XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBsb2cgdmlvbGF0aW9uXCIgfTtcbiAgICB9XG59XG5cbi8qKlxuICogVmFsaWRhdGUgY29udGVzdCBzZXNzaW9uIC0gY2hlY2tzIGlmIHNlc3Npb24gaXMgdmFsaWQgZm9yIHN1Ym1pc3Npb25zXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB2YWxpZGF0ZUNvbnRlc3RTZXNzaW9uKGNvbnRlc3RJZDogc3RyaW5nLCBzZXNzaW9uSWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgdmFsaWQ6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcGFydGljaXBhdGlvbiA9IGF3YWl0IHByaXNtYS5jb250ZXN0UGFydGljaXBhdGlvbi5maW5kVW5pcXVlKHtcbiAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgdXNlcklkX2NvbnRlc3RJZDoge1xuICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IHNlc3Npb24udXNlci5pZCxcbiAgICAgICAgICAgICAgICAgICAgY29udGVzdElkOiBjb250ZXN0SWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgIGNvbnRlc3Q6IHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0OiB7IHN0YXJ0VGltZTogdHJ1ZSwgZW5kVGltZTogdHJ1ZSB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoIXBhcnRpY2lwYXRpb24pIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHZhbGlkOiBmYWxzZSwgcmVhc29uOiBcIk5vIHBhcnRpY2lwYXRpb24gZm91bmRcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ2hlY2sgaWYgYmxvY2tlZFxuICAgICAgICBpZiAocGFydGljaXBhdGlvbi5pc0Jsb2NrZWQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHZhbGlkOiBmYWxzZSwgcmVhc29uOiBcIkJsb2NrZWQgZHVlIHRvIHZpb2xhdGlvbnNcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ2hlY2sgaWYgZmluaXNoZWRcbiAgICAgICAgaWYgKHBhcnRpY2lwYXRpb24uaXNGaW5pc2hlZCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgdmFsaWQ6IGZhbHNlLCByZWFzb246IFwiQ29udGVzdCBhbHJlYWR5IGZpbmlzaGVkXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENoZWNrIHNlc3Npb24gSUQgKG11bHRpLXRhYiBkZXRlY3Rpb24pXG4gICAgICAgIGlmIChwYXJ0aWNpcGF0aW9uLnNlc3Npb25JZCAhPT0gc2Vzc2lvbklkKSB7XG4gICAgICAgICAgICAvLyBMb2cgbXVsdGktdGFiIHZpb2xhdGlvblxuICAgICAgICAgICAgYXdhaXQgbG9nQ29udGVzdFZpb2xhdGlvbihjb250ZXN0SWQsIFwiTVVMVElfVEFCXCIsIFwiTXVsdGlwbGUgdGFicyBkZXRlY3RlZFwiKTtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHZhbGlkOiBmYWxzZSwgcmVhc29uOiBcIlNlc3Npb24gbWlzbWF0Y2ggLSBwb3NzaWJsZSBtdWx0aXBsZSB0YWJzXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENoZWNrIHRpbWUgYm91bmRzXG4gICAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgICAgIGlmIChub3cgPiBwYXJ0aWNpcGF0aW9uLmNvbnRlc3QuZW5kVGltZSkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgdmFsaWQ6IGZhbHNlLCByZWFzb246IFwiQ29udGVzdCBoYXMgZW5kZWRcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgICB2YWxpZDogdHJ1ZSxcbiAgICAgICAgICAgIHRvdGFsVmlvbGF0aW9uczogcGFydGljaXBhdGlvbi50b3RhbFZpb2xhdGlvbnMsXG4gICAgICAgICAgICBpc0ZsYWdnZWQ6IHBhcnRpY2lwYXRpb24uaXNGbGFnZ2VkXG4gICAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byB2YWxpZGF0ZSBzZXNzaW9uOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCB2YWxpZDogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byB2YWxpZGF0ZSBzZXNzaW9uXCIgfTtcbiAgICB9XG59XG5cbi8qKlxuICogQ2hlY2sgaWYgdXNlciBpcyBlbGlnaWJsZSB0byBzdWJtaXQgLSBwcmUtc3VibWlzc2lvbiB2YWxpZGF0aW9uXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjaGVja1N1Ym1pc3Npb25FbGlnaWJpbGl0eShjb250ZXN0SWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBlbGlnaWJsZTogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBwYXJ0aWNpcGF0aW9uID0gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgY29udGVzdDoge1xuICAgICAgICAgICAgICAgICAgICBzZWxlY3Q6IHsgc3RhcnRUaW1lOiB0cnVlLCBlbmRUaW1lOiB0cnVlIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICghcGFydGljaXBhdGlvbikge1xuICAgICAgICAgICAgcmV0dXJuIHsgZWxpZ2libGU6IGZhbHNlLCByZWFzb246IFwiTm8gcGFydGljaXBhdGlvbiBmb3VuZFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDaGVjayB2YXJpb3VzIGNvbmRpdGlvbnNcbiAgICAgICAgaWYgKHBhcnRpY2lwYXRpb24uaXNCbG9ja2VkKSB7XG4gICAgICAgICAgICByZXR1cm4geyBlbGlnaWJsZTogZmFsc2UsIHJlYXNvbjogXCJCbG9ja2VkIGR1ZSB0byBleGNlc3NpdmUgdmlvbGF0aW9uc1wiIH07XG4gICAgICAgIH1cblxuICAgICAgICBpZiAocGFydGljaXBhdGlvbi5pc0ZpbmlzaGVkKSB7XG4gICAgICAgICAgICByZXR1cm4geyBlbGlnaWJsZTogZmFsc2UsIHJlYXNvbjogXCJZb3UgaGF2ZSBhbHJlYWR5IGZpbmlzaGVkIHRoaXMgY29udGVzdFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICAgICAgICBpZiAobm93IDwgcGFydGljaXBhdGlvbi5jb250ZXN0LnN0YXJ0VGltZSkge1xuICAgICAgICAgICAgcmV0dXJuIHsgZWxpZ2libGU6IGZhbHNlLCByZWFzb246IFwiQ29udGVzdCBoYXMgbm90IHN0YXJ0ZWRcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG5vdyA+IHBhcnRpY2lwYXRpb24uY29udGVzdC5lbmRUaW1lKSB7XG4gICAgICAgICAgICByZXR1cm4geyBlbGlnaWJsZTogZmFsc2UsIHJlYXNvbjogXCJDb250ZXN0IGhhcyBlbmRlZFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZWxpZ2libGU6IHRydWUsXG4gICAgICAgICAgICB3YXJuaW5nczogcGFydGljaXBhdGlvbi5pc0ZsYWdnZWQgPyBbXCJZb3VyIHNlc3Npb24gaGFzIGJlZW4gZmxhZ2dlZCBmb3IgcmV2aWV3XCJdIDogW11cbiAgICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGNoZWNrIGVsaWdpYmlsaXR5OlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IGVsaWdpYmxlOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGNoZWNrIGVsaWdpYmlsaXR5XCIgfTtcbiAgICB9XG59XG5cbi8qKlxuICogR2V0IHBhcnRpY2lwYXRpb24gc3RhdHVzIC0gZm9yIFVJIHN0YXRlXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRQYXJ0aWNpcGF0aW9uU3RhdHVzKGNvbnRlc3RJZDogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICBpZiAoIXNlc3Npb24/LnVzZXIpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcGFydGljaXBhdGlvbiA9IGF3YWl0IHByaXNtYS5jb250ZXN0UGFydGljaXBhdGlvbi5maW5kVW5pcXVlKHtcbiAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgdXNlcklkX2NvbnRlc3RJZDoge1xuICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IHNlc3Npb24udXNlci5pZCxcbiAgICAgICAgICAgICAgICAgICAgY29udGVzdElkOiBjb250ZXN0SWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgYWNjZXB0ZWRSdWxlczogdHJ1ZSxcbiAgICAgICAgICAgICAgICBpc0ZpbmlzaGVkOiB0cnVlLFxuICAgICAgICAgICAgICAgIGlzRmxhZ2dlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBpc0Jsb2NrZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgdG90YWxWaW9sYXRpb25zOiB0cnVlLFxuICAgICAgICAgICAgICAgIHNlc3Npb25JZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICB0ZW1wQmxvY2tlZFVudGlsOiB0cnVlLFxuICAgICAgICAgICAgICAgIHBlcm1hbmVudGx5QmxvY2tlZDogdHJ1ZVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBDaGVjayBpZiB0ZW1wIGJsb2NrIGhhcyBleHBpcmVkXG4gICAgICAgIGlmIChwYXJ0aWNpcGF0aW9uPy50ZW1wQmxvY2tlZFVudGlsICYmIG5ldyBEYXRlKCkgPiBwYXJ0aWNpcGF0aW9uLnRlbXBCbG9ja2VkVW50aWwpIHtcbiAgICAgICAgICAgIC8vIFRlbXAgYmxvY2sgZXhwaXJlZCAtIHVuYmxvY2tcbiAgICAgICAgICAgIGF3YWl0IHByaXNtYS5jb250ZXN0UGFydGljaXBhdGlvbi51cGRhdGUoe1xuICAgICAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZF9jb250ZXN0SWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGVzdElkOiBjb250ZXN0SWRcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBpc0Jsb2NrZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wQmxvY2tlZFVudGlsOiBudWxsXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgICAgICBwYXJ0aWNpcGF0aW9uOiB7XG4gICAgICAgICAgICAgICAgICAgIC4uLnBhcnRpY2lwYXRpb24sXG4gICAgICAgICAgICAgICAgICAgIGlzQmxvY2tlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBCbG9ja2VkVW50aWw6IG51bGxcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgICBwYXJ0aWNpcGF0aW9uOiBwYXJ0aWNpcGF0aW9uIHx8IG51bGxcbiAgICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGdldCBwYXJ0aWNpcGF0aW9uIHN0YXR1c1wiIH07XG4gICAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gQ09OVEVTVCBNQU5BR0VSIC0gUEFSVElDSVBBTlQgTUFOQUdFTUVOVFxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLyoqXG4gKiBHZXQgYWxsIHBhcnRpY2lwYW50cyBmb3IgYSBjb250ZXN0IHdpdGggdmlvbGF0aW9uIGRldGFpbHMgKGZvciBtYW5hZ2VycylcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldENvbnRlc3RQYXJ0aWNpcGFudHMoY29udGVzdElkOiBzdHJpbmcpIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIGlmICghc2Vzc2lvbj8udXNlcikgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG5cbiAgICBjb25zdCBjdXJyZW50VXNlciA9IHNlc3Npb24udXNlciBhcyBhbnk7XG5cbiAgICAvLyBDaGVjayBpZiB1c2VyIGlzIGNvbnRlc3QgbWFuYWdlci9jcmVhdG9yXG4gICAgY29uc3QgY29udGVzdCA9IGF3YWl0IHByaXNtYS5jb250ZXN0LmZpbmRVbmlxdWUoe1xuICAgICAgICB3aGVyZTogeyBpZDogY29udGVzdElkIH0sXG4gICAgICAgIHNlbGVjdDogeyBjcmVhdG9ySWQ6IHRydWUgfVxuICAgIH0pO1xuXG4gICAgaWYgKCFjb250ZXN0KSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiQ29udGVzdCBub3QgZm91bmRcIiB9O1xuXG4gICAgY29uc3QgaXNBdXRob3JpemVkID1cbiAgICAgICAgY3VycmVudFVzZXIucm9sZSA9PT0gXCJBRE1JTlwiIHx8XG4gICAgICAgIGN1cnJlbnRVc2VyLnJvbGUgPT09IFwiQ09OVEVTVF9NQU5BR0VSXCIgfHxcbiAgICAgICAgY3VycmVudFVzZXIucm9sZSA9PT0gXCJURUFDSEVSXCIgfHxcbiAgICAgICAgY29udGVzdC5jcmVhdG9ySWQgPT09IGN1cnJlbnRVc2VyLmlkO1xuXG4gICAgaWYgKCFpc0F1dGhvcml6ZWQpIHtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcGFydGljaXBhbnRzID0gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLmZpbmRNYW55KHtcbiAgICAgICAgICAgIHdoZXJlOiB7IGNvbnRlc3RJZCB9LFxuICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBlbWFpbDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGltYWdlOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHZpb2xhdGlvbnM6IHtcbiAgICAgICAgICAgICAgICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6IFwiZGVzY1wiIH0sXG4gICAgICAgICAgICAgICAgICAgIHRha2U6IDEwXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9yZGVyQnk6IFtcbiAgICAgICAgICAgICAgICB7IHBlcm1hbmVudGx5QmxvY2tlZDogXCJkZXNjXCIgfSxcbiAgICAgICAgICAgICAgICB7IGlzQmxvY2tlZDogXCJkZXNjXCIgfSxcbiAgICAgICAgICAgICAgICB7IHRvdGFsVmlvbGF0aW9uczogXCJkZXNjXCIgfVxuICAgICAgICAgICAgXVxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBwYXJ0aWNpcGFudHMgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGdldCBwYXJ0aWNpcGFudHM6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBnZXQgcGFydGljaXBhbnRzXCIgfTtcbiAgICB9XG59XG5cbi8qKlxuICogVW5ibG9jayBhIHBhcnRpY2lwYW50IChtYW5hZ2VyIG9ubHkpXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1bmJsb2NrUGFydGljaXBhbnQoY29udGVzdElkOiBzdHJpbmcsIHVzZXJJZDogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICBpZiAoIXNlc3Npb24/LnVzZXIpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuXG4gICAgY29uc3QgY3VycmVudFVzZXIgPSBzZXNzaW9uLnVzZXIgYXMgYW55O1xuXG4gICAgLy8gQ2hlY2sgYXV0aG9yaXphdGlvblxuICAgIGNvbnN0IGNvbnRlc3QgPSBhd2FpdCBwcmlzbWEuY29udGVzdC5maW5kVW5pcXVlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6IGNvbnRlc3RJZCB9LFxuICAgICAgICBzZWxlY3Q6IHsgY3JlYXRvcklkOiB0cnVlIH1cbiAgICB9KTtcblxuICAgIGlmICghY29udGVzdCkgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkNvbnRlc3Qgbm90IGZvdW5kXCIgfTtcblxuICAgIGNvbnN0IGlzQXV0aG9yaXplZCA9XG4gICAgICAgIGN1cnJlbnRVc2VyLnJvbGUgPT09IFwiQURNSU5cIiB8fFxuICAgICAgICBjdXJyZW50VXNlci5yb2xlID09PSBcIkNPTlRFU1RfTUFOQUdFUlwiIHx8XG4gICAgICAgIGN1cnJlbnRVc2VyLnJvbGUgPT09IFwiVEVBQ0hFUlwiIHx8XG4gICAgICAgIGNvbnRlc3QuY3JlYXRvcklkID09PSBjdXJyZW50VXNlci5pZDtcblxuICAgIGlmICghaXNBdXRob3JpemVkKSB7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHByaXNtYS5jb250ZXN0UGFydGljaXBhdGlvbi51cGRhdGUoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgY29udGVzdElkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICBpc0Jsb2NrZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHRlbXBCbG9ja2VkVW50aWw6IG51bGwsXG4gICAgICAgICAgICAgICAgcGVybWFuZW50bHlCbG9ja2VkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICB0b3RhbFZpb2xhdGlvbnM6IDAsXG4gICAgICAgICAgICAgICAgdGFiU3dpdGNoQ291bnQ6IDAsXG4gICAgICAgICAgICAgICAgZnVsbHNjcmVlbkV4aXRDb3VudDogMCxcbiAgICAgICAgICAgICAgICBjb3B5UGFzdGVDb3VudDogMCxcbiAgICAgICAgICAgICAgICBkZXZUb29sc0NvdW50OiAwLFxuICAgICAgICAgICAgICAgIGtleWJvYXJkQ291bnQ6IDAsXG4gICAgICAgICAgICAgICAgbmF2aWdhdGlvbkNvdW50OiAwLFxuICAgICAgICAgICAgICAgIGlzRmxhZ2dlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgdW5ibG9ja2VkQnk6IGN1cnJlbnRVc2VyLmlkLFxuICAgICAgICAgICAgICAgIHVuYmxvY2tlZEF0OiBuZXcgRGF0ZSgpXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldmFsaWRhdGVQYXRoKGAvZGFzaGJvYXJkL2NvbnRlc3RzLyR7Y29udGVzdElkfS9wYXJ0aWNpcGFudHNgKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gdW5ibG9jayBwYXJ0aWNpcGFudDpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIHVuYmxvY2sgcGFydGljaXBhbnRcIiB9O1xuICAgIH1cbn1cblxuLyoqXG4gKiBHZXQgZGV0YWlsZWQgdmlvbGF0aW9ucyBmb3IgYSBwYXJ0aWNpcGFudFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0UGFydGljaXBhbnRWaW9sYXRpb25zKGNvbnRlc3RJZDogc3RyaW5nLCB1c2VySWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcblxuICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gc2Vzc2lvbi51c2VyIGFzIGFueTtcblxuICAgIC8vIENoZWNrIGF1dGhvcml6YXRpb25cbiAgICBjb25zdCBjb250ZXN0ID0gYXdhaXQgcHJpc21hLmNvbnRlc3QuZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiBjb250ZXN0SWQgfSxcbiAgICAgICAgc2VsZWN0OiB7IGNyZWF0b3JJZDogdHJ1ZSB9XG4gICAgfSk7XG5cbiAgICBpZiAoIWNvbnRlc3QpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJDb250ZXN0IG5vdCBmb3VuZFwiIH07XG5cbiAgICBjb25zdCBpc0F1dGhvcml6ZWQgPVxuICAgICAgICBjdXJyZW50VXNlci5yb2xlID09PSBcIkFETUlOXCIgfHxcbiAgICAgICAgY3VycmVudFVzZXIucm9sZSA9PT0gXCJDT05URVNUX01BTkFHRVJcIiB8fFxuICAgICAgICBjdXJyZW50VXNlci5yb2xlID09PSBcIlRFQUNIRVJcIiB8fFxuICAgICAgICBjb250ZXN0LmNyZWF0b3JJZCA9PT0gY3VycmVudFVzZXIuaWQ7XG5cbiAgICBpZiAoIWlzQXV0aG9yaXplZCkge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBwYXJ0aWNpcGF0aW9uID0gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgY29udGVzdElkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdDogeyBpZDogdHJ1ZSwgbmFtZTogdHJ1ZSwgZW1haWw6IHRydWUgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgdmlvbGF0aW9uczoge1xuICAgICAgICAgICAgICAgICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogXCJkZXNjXCIgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgcGFydGljaXBhdGlvbiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZ2V0IHZpb2xhdGlvbnNcIiB9O1xuICAgIH1cbn1cblxuLyoqXG4gKiBDYWxjdWxhdGUgY29udGVzdCBsZWFkZXJib2FyZFxuICogLSBGZXRjaGVzIGFsbCBwYXJ0aWNpcGF0aW9uc1xuICogLSBGZXRjaGVzIGFsbCByZWxldmFudCBzdWJtaXNzaW9uc1xuICogLSBDYWxjdWxhdGVzIHNjb3Jlc1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q29udGVzdExlYWRlcmJvYXJkKGNvbnRlc3RJZDogc3RyaW5nKSB7XG4gICAgXCJ1c2UgY2FjaGVcIlxuICAgIGNhY2hlVGFnKGBsZWFkZXJib2FyZC0ke2NvbnRlc3RJZH1gKVxuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBjYWNoZUxpZmUoXCJsZWFkZXJib2FyZFwiKVxuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcGFydGljaXBhdGlvbnMgPSBhd2FpdCBwcmlzbWEuY29udGVzdFBhcnRpY2lwYXRpb24uZmluZE1hbnkoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICBjb250ZXN0SWQsXG4gICAgICAgICAgICAgICAgLy8gc3RhcnRlZEF0OiB7IG5vdDogbnVsbCB9IC8vIE9ubHkgc3RhcnRlZCBwYXJ0aWNpcGFudHMgKEZpeCBpZiBmaWVsZCBleGlzdHMsIG90aGVyd2lzZSByZWx5IG9uIGNyZWF0ZWQpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBpbWFnZTogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBjb250ZXN0ID0gYXdhaXQgcHJpc21hLmNvbnRlc3QuZmluZFVuaXF1ZSh7XG4gICAgICAgICAgICB3aGVyZTogeyBpZDogY29udGVzdElkIH0sXG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgcHJvYmxlbXM6IHtcbiAgICAgICAgICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJvYmxlbToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpZmZpY3VsdHk6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNsdWc6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3JlOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBvcmRlckJ5OiB7IG9yZGVyOiBcImFzY1wiIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICghY29udGVzdCkgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkNvbnRlc3Qgbm90IGZvdW5kXCIgfTtcblxuICAgICAgICBjb25zdCBsZWFkZXJib2FyZCA9IGF3YWl0IFByb21pc2UuYWxsKHBhcnRpY2lwYXRpb25zLm1hcChhc3luYyAocCkgPT4ge1xuICAgICAgICAgICAgLy8gR2V0IHZhbGlkIHN1Ym1pc3Npb25zIGZvciB0aGlzIHVzZXIgaW4gdGhpcyBjb250ZXN0XG4gICAgICAgICAgICBjb25zdCBzdWJtaXNzaW9ucyA9IGF3YWl0IHByaXNtYS5zdWJtaXNzaW9uLmZpbmRNYW55KHtcbiAgICAgICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IHAudXNlcklkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZCxcbiAgICAgICAgICAgICAgICAgICAgY3JlYXRlZEF0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBndGU6IGNvbnRlc3Quc3RhcnRUaW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgbHRlOiBjb250ZXN0LmVuZFRpbWVcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHByb2JsZW1JZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgY3JlYXRlZEF0OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBsYW5ndWFnZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSB0b3RhbCBzY29yZVxuICAgICAgICAgICAgLy8gTG9naWM6IEJlc3Qgc3VibWlzc2lvbiBwZXIgcHJvYmxlbSBjb3VudHNcbiAgICAgICAgICAgIGNvbnN0IHByb2JsZW1TY29yZXMgPSBuZXcgTWFwPHN0cmluZywgbnVtYmVyPigpO1xuICAgICAgICAgICAgY29uc3QgcHJvYmxlbVNvbHZlVGltZXMgPSBuZXcgTWFwPHN0cmluZywgRGF0ZT4oKTtcbiAgICAgICAgICAgIGNvbnN0IHByb2JsZW1TdWJtaXNzaW9uQ291bnRzID0gbmV3IE1hcDxzdHJpbmcsIG51bWJlcj4oKTtcbiAgICAgICAgICAgIGNvbnN0IHByb2JsZW1CZXN0U3VibWlzc2lvbnMgPSBuZXcgTWFwPHN0cmluZywgYW55PigpO1xuXG4gICAgICAgICAgICBzdWJtaXNzaW9ucy5mb3JFYWNoKHN1YiA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgY3VycmVudENvdW50ID0gcHJvYmxlbVN1Ym1pc3Npb25Db3VudHMuZ2V0KHN1Yi5wcm9ibGVtSWQpIHx8IDA7XG4gICAgICAgICAgICAgICAgcHJvYmxlbVN1Ym1pc3Npb25Db3VudHMuc2V0KHN1Yi5wcm9ibGVtSWQsIGN1cnJlbnRDb3VudCArIDEpO1xuXG4gICAgICAgICAgICAgICAgaWYgKHN1Yi5zdGF0dXMgPT09IFwiQUNDRVBURURcIikge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50QmVzdCA9IHByb2JsZW1TY29yZXMuZ2V0KHN1Yi5wcm9ibGVtSWQpIHx8IDA7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb2JsZW1EZWYgPSBjb250ZXN0LnByb2JsZW1zLmZpbmQoY3AgPT4gY3AucHJvYmxlbUlkID09PSBzdWIucHJvYmxlbUlkKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWF4U2NvcmUgPSBwcm9ibGVtRGVmPy5wcm9ibGVtLnNjb3JlIHx8IDA7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKG1heFNjb3JlID4gY3VycmVudEJlc3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICBwcm9ibGVtU2NvcmVzLnNldChzdWIucHJvYmxlbUlkLCBtYXhTY29yZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudEJlc3RUaW1lID0gcHJvYmxlbVNvbHZlVGltZXMuZ2V0KHN1Yi5wcm9ibGVtSWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghY3VycmVudEJlc3RUaW1lIHx8IHN1Yi5jcmVhdGVkQXQgPCBjdXJyZW50QmVzdFRpbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvYmxlbVNvbHZlVGltZXMuc2V0KHN1Yi5wcm9ibGVtSWQsIHN1Yi5jcmVhdGVkQXQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9ibGVtQmVzdFN1Ym1pc3Npb25zLnNldChzdWIucHJvYmxlbUlkLCBzdWIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBsZXQgdG90YWxTY29yZSA9IDA7XG4gICAgICAgICAgICBsZXQgdG90YWxUaW1lTXMgPSAwO1xuXG4gICAgICAgICAgICBwcm9ibGVtU2NvcmVzLmZvckVhY2goKHNjb3JlLCBwcm9ibGVtSWQpID0+IHtcbiAgICAgICAgICAgICAgICB0b3RhbFNjb3JlICs9IHNjb3JlO1xuICAgICAgICAgICAgICAgIGNvbnN0IHNvbHZlbnRUaW1lID0gcHJvYmxlbVNvbHZlVGltZXMuZ2V0KHByb2JsZW1JZCk7XG4gICAgICAgICAgICAgICAgaWYgKHNvbHZlbnRUaW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIHRvdGFsVGltZU1zICs9IChzb2x2ZW50VGltZS5nZXRUaW1lKCkgLSBjb250ZXN0LnN0YXJ0VGltZS5nZXRUaW1lKCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBNYXAgc3RhdHMgZm9yIGVhY2ggcHJvYmxlbSBpbiB0aGUgY29udGVzdFxuICAgICAgICAgICAgY29uc3QgcHJvYmxlbVN0YXRzID0gY29udGVzdC5wcm9ibGVtcy5tYXAoY3AgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGJlc3RTdWIgPSBwcm9ibGVtQmVzdFN1Ym1pc3Npb25zLmdldChjcC5wcm9ibGVtSWQpO1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIHByb2JsZW1JZDogY3AucHJvYmxlbUlkLFxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogY3AucHJvYmxlbS50aXRsZSxcbiAgICAgICAgICAgICAgICAgICAgc2x1ZzogY3AucHJvYmxlbS5zbHVnLFxuICAgICAgICAgICAgICAgICAgICBzY29yZTogcHJvYmxlbVNjb3Jlcy5nZXQoY3AucHJvYmxlbUlkKSB8fCAwLFxuICAgICAgICAgICAgICAgICAgICBtYXhTY29yZTogY3AucHJvYmxlbS5zY29yZSxcbiAgICAgICAgICAgICAgICAgICAgc3VibWlzc2lvbnM6IHByb2JsZW1TdWJtaXNzaW9uQ291bnRzLmdldChjcC5wcm9ibGVtSWQpIHx8IDAsXG4gICAgICAgICAgICAgICAgICAgIHNvbHZlZDogcHJvYmxlbVNjb3Jlcy5oYXMoY3AucHJvYmxlbUlkKSxcbiAgICAgICAgICAgICAgICAgICAgc29sdmVkQXQ6IHByb2JsZW1Tb2x2ZVRpbWVzLmdldChjcC5wcm9ibGVtSWQpLFxuICAgICAgICAgICAgICAgICAgICBsYW5ndWFnZTogYmVzdFN1Yj8ubGFuZ3VhZ2U/Lm5hbWUgfHwgbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgbGFuZ3VhZ2VJZDogYmVzdFN1Yj8ubGFuZ3VhZ2U/LmlkIHx8IG51bGxcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgLi4ucC51c2VyLFxuICAgICAgICAgICAgICAgIHNjb3JlOiB0b3RhbFNjb3JlLFxuICAgICAgICAgICAgICAgIHRpbWVUYWtlbjogdG90YWxUaW1lTXMsXG4gICAgICAgICAgICAgICAgcHJvYmxlbXNTb2x2ZWQ6IHByb2JsZW1TY29yZXMuc2l6ZSxcbiAgICAgICAgICAgICAgICBwcm9ibGVtU3RhdHNcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pKTtcblxuICAgICAgICAvLyBTb3J0OiBIaWdoIHNjb3JlIGZpcnN0LCB0aGVuIGxvdyB0aW1lIHRha2VuXG4gICAgICAgIGxlYWRlcmJvYXJkLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgICAgICAgIGlmIChiLnNjb3JlICE9PSBhLnNjb3JlKSByZXR1cm4gYi5zY29yZSAtIGEuc2NvcmU7XG4gICAgICAgICAgICByZXR1cm4gYS50aW1lVGFrZW4gLSBiLnRpbWVUYWtlbjtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgICBzdHVkZW50czogbGVhZGVyYm9hcmQsXG4gICAgICAgICAgICBpc0ZpbmFsaXplZDogY29udGVzdC5pc0ZpbmFsaXplZCxcbiAgICAgICAgICAgIHByb2JsZW1zOiBjb250ZXN0LnByb2JsZW1zLm1hcChjcCA9PiAoe1xuICAgICAgICAgICAgICAgIGlkOiBjcC5wcm9ibGVtSWQsXG4gICAgICAgICAgICAgICAgdGl0bGU6IGNwLnByb2JsZW0udGl0bGUsXG4gICAgICAgICAgICAgICAgc2x1ZzogY3AucHJvYmxlbS5zbHVnLFxuICAgICAgICAgICAgICAgIG1heFNjb3JlOiBjcC5wcm9ibGVtLnNjb3JlXG4gICAgICAgICAgICB9KSlcbiAgICAgICAgfTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJMZWFkZXJib2FyZCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGdlbmVyYXRlIGxlYWRlcmJvYXJkXCIgfTtcbiAgICB9XG59XG5cbi8qKlxuICogR2V0IGN1cnJlbnQgdXNlcidzIHJhbmtpbmcgaW4gYSBjb250ZXN0XG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRDb250ZXN0UmFua2luZyhjb250ZXN0SWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcblxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGdldENvbnRlc3RMZWFkZXJib2FyZChjb250ZXN0SWQpO1xuXG4gICAgICAgIGlmICghcmVzdWx0LnN1Y2Nlc3MgfHwgIXJlc3VsdC5zdHVkZW50cykge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBnZXQgcmFua2luZ1wiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCByYW5rID0gcmVzdWx0LnN0dWRlbnRzLmZpbmRJbmRleCgoczogYW55KSA9PiBzLmlkID09PSBzZXNzaW9uLnVzZXIuaWQpICsgMTtcblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCByYW5rOiByYW5rID4gMCA/IHJhbmsgOiBudWxsIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZ2V0IHJhbmtpbmdcIiB9O1xuICAgIH1cbn1cbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiK1JBOGZzQiJ9
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/components/contest/ContestDetails.tsx [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "default",
    ()=>ContestDetails
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/jsx-dev-runtime.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/index.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$chevron$2d$right$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__ChevronRight$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/chevron-right.js [app-client] (ecmascript) <export default as ChevronRight>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$lock$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Lock$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/lock.js [app-client] (ecmascript) <export default as Lock>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$chevron$2d$left$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__ChevronLeft$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/chevron-left.js [app-client] (ecmascript) <export default as ChevronLeft>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$circle$2d$check$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__CheckCircle2$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/circle-check.js [app-client] (ecmascript) <export default as CheckCircle2>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$shield$2d$alert$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__ShieldAlert$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/shield-alert.js [app-client] (ecmascript) <export default as ShieldAlert>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/sonner/dist/index.mjs [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$client$2f$app$2d$dir$2f$link$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/client/app-dir/link.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$navigation$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/navigation.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$components$2f$contest$2f$ContestEntryModal$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/components/contest/ContestEntryModal.tsx [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$components$2f$contest$2f$ContestProtection$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/components/contest/ContestProtection.tsx [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$components$2f$contest$2f$ContestNavigationGuard$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/components/contest/ContestNavigationGuard.tsx [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$actions$2f$data$3a$2e5ad8__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__ = __turbopack_context__.i("[project]/actions/data:2e5ad8 [app-client] (ecmascript) <text/javascript>");
;
var _s = __turbopack_context__.k.signature();
"use client";
;
;
;
;
;
;
;
;
;
const PROBLEMS_PER_PAGE = 20;
function ContestDetails({ contest, user }) {
    _s();
    const router = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$navigation$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRouter"])();
    const [timeLeft, setTimeLeft] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])("");
    const [currentPage, setCurrentPage] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(1);
    const [showRulesPopup, setShowRulesPopup] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(false);
    const [hasAcceptedRules, setHasAcceptedRules] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(contest.hasAcceptedRules || false);
    const [isSubmittingContest, setIsSubmittingContest] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(false);
    const isFinished = contest.isFinished || false;
    // Protection State
    const [sessionId, setSessionId] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(contest.sessionId || null);
    // DEBUG: Log protection conditions
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "ContestDetails.useEffect": ()=>{
            console.log('[ContestProtection Debug]', {
                hasAcceptedRules,
                sessionId,
                isFinished,
                willRenderProtection: hasAcceptedRules && sessionId && !isFinished
            });
        }
    }["ContestDetails.useEffect"], [
        hasAcceptedRules,
        sessionId,
        isFinished,
        contest.canManage
    ]);
    const now = new Date();
    const startTime = new Date(contest.startTime);
    const endTime = new Date(contest.endTime);
    const hasStarted = now >= startTime;
    const hasEnded = now > endTime;
    const [showEndModal, setShowEndModal] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(false);
    const [endConfirmText, setEndConfirmText] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])("");
    const handleContestFinish = ()=>{
        setShowEndModal(true);
    };
    const confirmEndContest = async ()=>{
        if (endConfirmText.toLowerCase() !== "end") {
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error("Please type 'end' to confirm");
            return;
        }
        setIsSubmittingContest(true);
        try {
            const res = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$actions$2f$data$3a$2e5ad8__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__["finishContestAction"])(contest.id);
            if (res.success) {
                __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].success("Contest submitted successfully!");
                router.push("/");
            } else {
                __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error("Failed to submit contest");
                setIsSubmittingContest(false);
            }
        } catch (error) {
            console.error(error);
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error("Something went wrong");
            setIsSubmittingContest(false);
        }
        setShowEndModal(false);
    };
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "ContestDetails.useEffect": ()=>{
            if (isFinished) return;
            const accepted = localStorage.getItem(`contest-rules-${contest.id}`);
            // If we have local storage record AND the server says we accepted rules (or we rely on server only)
            // But let's trust server state 'hasAcceptedRules' primarily if available
            if (hasAcceptedRules) {
                if (hasStarted && !hasEnded) {
                // Already started logic
                }
            } else if (hasStarted && !hasEnded) {
                setShowRulesPopup(true);
            }
        }
    }["ContestDetails.useEffect"], [
        contest.id,
        hasStarted,
        hasEnded,
        hasAcceptedRules,
        isFinished
    ]);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "ContestDetails.useEffect": ()=>{
            const timer = setInterval({
                "ContestDetails.useEffect.timer": ()=>{
                    const now = new Date();
                    const target = hasStarted ? endTime : startTime;
                    const diff = target.getTime() - now.getTime();
                    if (diff <= 0) {
                        setTimeLeft(hasStarted ? "Contest Ended" : "Starting Now");
                        clearInterval(timer);
                        return;
                    }
                    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                    const hours = Math.floor(diff % (1000 * 60 * 60 * 24) / (1000 * 60 * 60));
                    const minutes = Math.floor(diff % (1000 * 60 * 60) / (1000 * 60));
                    const seconds = Math.floor(diff % (1000 * 60) / 1000);
                    setTimeLeft(`${days > 0 ? `${days}d ` : ""}${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`);
                }
            }["ContestDetails.useEffect.timer"], 1000);
            return ({
                "ContestDetails.useEffect": ()=>clearInterval(timer)
            })["ContestDetails.useEffect"];
        }
    }["ContestDetails.useEffect"], [
        hasStarted,
        startTime,
        endTime
    ]);
    const handleContestStart = (newSessionId)=>{
        localStorage.setItem(`contest-rules-${contest.id}`, "true");
        setHasAcceptedRules(true);
        setShowRulesPopup(false);
        setSessionId(newSessionId);
        // Reload page to refresh questions (if shuffled) or unlock content
        window.location.reload();
    };
    const totalPages = Math.ceil(contest.problems.length / PROBLEMS_PER_PAGE);
    const startIndex = (currentPage - 1) * PROBLEMS_PER_PAGE;
    const endIndex = startIndex + PROBLEMS_PER_PAGE;
    const currentProblems = contest.problems.slice(startIndex, endIndex);
    const getStatusBadge = ()=>{
        if (isFinished) {
            return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                className: "px-2.5 py-0.5 rounded-full text-xs font-medium bg-emerald-100 dark:bg-emerald-500/20 text-emerald-700 dark:text-emerald-400",
                children: "Completed"
            }, void 0, false, {
                fileName: "[project]/components/contest/ContestDetails.tsx",
                lineNumber: 134,
                columnNumber: 20
            }, this);
        }
        if (hasEnded) {
            return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                className: "px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 dark:bg-gray-500/20 text-gray-700 dark:text-gray-400",
                children: "Ended"
            }, void 0, false, {
                fileName: "[project]/components/contest/ContestDetails.tsx",
                lineNumber: 137,
                columnNumber: 20
            }, this);
        }
        if (hasStarted) {
            return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                className: "px-2.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 dark:bg-orange-500/20 text-orange-700 dark:text-orange-400",
                children: "Live"
            }, void 0, false, {
                fileName: "[project]/components/contest/ContestDetails.tsx",
                lineNumber: 140,
                columnNumber: 20
            }, this);
        }
        return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
            className: "px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 dark:bg-blue-500/20 text-blue-700 dark:text-blue-400",
            children: "Upcoming"
        }, void 0, false, {
            fileName: "[project]/components/contest/ContestDetails.tsx",
            lineNumber: 142,
            columnNumber: 16
        }, this);
    };
    const getDifficultyColor = (difficulty)=>{
        switch(difficulty){
            case "EASY":
                return "bg-emerald-100 dark:bg-emerald-500/20 text-emerald-700 dark:text-emerald-400";
            case "MEDIUM":
                return "bg-orange-100 dark:bg-orange-500/20 text-orange-700 dark:text-orange-400";
            case "HARD":
                return "bg-red-100 dark:bg-red-500/20 text-red-700 dark:text-red-400";
            default:
                return "bg-gray-100 dark:bg-gray-500/20 text-gray-700 dark:text-gray-400";
        }
    };
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Fragment"], {
        children: [
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$components$2f$contest$2f$ContestEntryModal$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["default"], {
                contestId: contest.id,
                contestTitle: contest.title,
                requiresPassword: contest.requiresPassword,
                isOpen: showRulesPopup,
                onClose: ()=>setShowRulesPopup(false),
                onStart: handleContestStart
            }, void 0, false, {
                fileName: "[project]/components/contest/ContestDetails.tsx",
                lineNumber: 156,
                columnNumber: 13
            }, this),
            hasAcceptedRules && sessionId && !isFinished && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Fragment"], {
                children: [
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$components$2f$contest$2f$ContestProtection$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["default"], {
                        contestId: contest.id,
                        sessionId: sessionId,
                        paused: isSubmittingContest || showEndModal
                    }, void 0, false, {
                        fileName: "[project]/components/contest/ContestDetails.tsx",
                        lineNumber: 168,
                        columnNumber: 21
                    }, this),
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$components$2f$contest$2f$ContestNavigationGuard$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["default"], {
                        contestId: contest.id,
                        allowedPaths: [
                            `/problems/`,
                            `/contest/${contest.id}`
                        ]
                    }, void 0, false, {
                        fileName: "[project]/components/contest/ContestDetails.tsx",
                        lineNumber: 173,
                        columnNumber: 21
                    }, this)
                ]
            }, void 0, true),
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "min-h-screen bg-white dark:bg-[#0a0a0a] py-8",
                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                    className: "w-full max-w-7xl mx-auto px-4 md:px-6",
                    children: [
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "mb-8",
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "flex items-center gap-2 mb-3",
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                            className: "px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 dark:bg-[#262626] text-gray-700 dark:text-gray-300",
                                            children: contest.visibility
                                        }, void 0, false, {
                                            fileName: "[project]/components/contest/ContestDetails.tsx",
                                            lineNumber: 188,
                                            columnNumber: 29
                                        }, this),
                                        getStatusBadge()
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                    lineNumber: 187,
                                    columnNumber: 25
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("h1", {
                                    className: "text-3xl font-bold text-gray-900 dark:text-gray-100 mb-2",
                                    children: contest.title
                                }, void 0, false, {
                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                    lineNumber: 194,
                                    columnNumber: 25
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                    className: "text-gray-600 dark:text-gray-400",
                                    children: contest.description || "Test your skills in this competitive programming arena."
                                }, void 0, false, {
                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                    lineNumber: 198,
                                    columnNumber: 25
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/components/contest/ContestDetails.tsx",
                            lineNumber: 186,
                            columnNumber: 21
                        }, this),
                        isFinished && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "mb-8 p-6 bg-emerald-50 dark:bg-emerald-500/10 border border-emerald-100 dark:border-emerald-500/20 rounded-2xl flex items-center gap-4",
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "w-12 h-12 bg-emerald-100 dark:bg-emerald-500/20 rounded-xl flex items-center justify-center shrink-0",
                                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$circle$2d$check$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__CheckCircle2$3e$__["CheckCircle2"], {
                                        className: "w-6 h-6 text-emerald-600 dark:text-emerald-400"
                                    }, void 0, false, {
                                        fileName: "[project]/components/contest/ContestDetails.tsx",
                                        lineNumber: 206,
                                        columnNumber: 33
                                    }, this)
                                }, void 0, false, {
                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                    lineNumber: 205,
                                    columnNumber: 29
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("h3", {
                                            className: "text-lg font-bold text-emerald-900 dark:text-emerald-400",
                                            children: "Contest Session Completed"
                                        }, void 0, false, {
                                            fileName: "[project]/components/contest/ContestDetails.tsx",
                                            lineNumber: 209,
                                            columnNumber: 33
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                            className: "text-emerald-700 dark:text-emerald-500 text-sm",
                                            children: "You have successfully ended your session. Your submissions have been recorded and you can view the final standings once the contest ends."
                                        }, void 0, false, {
                                            fileName: "[project]/components/contest/ContestDetails.tsx",
                                            lineNumber: 210,
                                            columnNumber: 33
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                    lineNumber: 208,
                                    columnNumber: 29
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/components/contest/ContestDetails.tsx",
                            lineNumber: 204,
                            columnNumber: 25
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "flex flex-wrap items-center gap-6 mb-6 pb-6 border-b border-gray-200 dark:border-[#262626] text-sm",
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                            className: "text-gray-500 dark:text-gray-400",
                                            children: "Start:"
                                        }, void 0, false, {
                                            fileName: "[project]/components/contest/ContestDetails.tsx",
                                            lineNumber: 220,
                                            columnNumber: 29
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                            className: "ml-2 text-gray-900 dark:text-gray-100 font-medium",
                                            children: startTime.toLocaleString()
                                        }, void 0, false, {
                                            fileName: "[project]/components/contest/ContestDetails.tsx",
                                            lineNumber: 221,
                                            columnNumber: 29
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                    lineNumber: 219,
                                    columnNumber: 25
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                            className: "text-gray-500 dark:text-gray-400",
                                            children: "End:"
                                        }, void 0, false, {
                                            fileName: "[project]/components/contest/ContestDetails.tsx",
                                            lineNumber: 224,
                                            columnNumber: 29
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                            className: "ml-2 text-gray-900 dark:text-gray-100 font-medium",
                                            children: endTime.toLocaleString()
                                        }, void 0, false, {
                                            fileName: "[project]/components/contest/ContestDetails.tsx",
                                            lineNumber: 225,
                                            columnNumber: 29
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                    lineNumber: 223,
                                    columnNumber: 25
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                            className: "text-gray-500 dark:text-gray-400",
                                            children: "Problems:"
                                        }, void 0, false, {
                                            fileName: "[project]/components/contest/ContestDetails.tsx",
                                            lineNumber: 228,
                                            columnNumber: 29
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                            className: "ml-2 text-gray-900 dark:text-gray-100 font-medium",
                                            children: contest._count.problems
                                        }, void 0, false, {
                                            fileName: "[project]/components/contest/ContestDetails.tsx",
                                            lineNumber: 229,
                                            columnNumber: 29
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                    lineNumber: 227,
                                    columnNumber: 25
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                            className: "text-gray-500 dark:text-gray-400",
                                            children: "Time:"
                                        }, void 0, false, {
                                            fileName: "[project]/components/contest/ContestDetails.tsx",
                                            lineNumber: 232,
                                            columnNumber: 29
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                            className: "ml-2 text-gray-900 dark:text-gray-100 font-medium font-mono",
                                            children: timeLeft
                                        }, void 0, false, {
                                            fileName: "[project]/components/contest/ContestDetails.tsx",
                                            lineNumber: 233,
                                            columnNumber: 29
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                    lineNumber: 231,
                                    columnNumber: 25
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "ml-auto flex gap-2",
                                    children: [
                                        hasAcceptedRules && hasStarted && !hasEnded && !isFinished && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                            onClick: handleContestFinish,
                                            className: "px-4 py-2 bg-red-600 text-white rounded text-sm font-medium hover:bg-red-700 transition-colors flex items-center gap-2 shadow-lg shadow-red-500/20",
                                            children: [
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$circle$2d$check$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__CheckCircle2$3e$__["CheckCircle2"], {
                                                    className: "w-4 h-4"
                                                }, void 0, false, {
                                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                                    lineNumber: 244,
                                                    columnNumber: 37
                                                }, this),
                                                "End Contest"
                                            ]
                                        }, void 0, true, {
                                            fileName: "[project]/components/contest/ContestDetails.tsx",
                                            lineNumber: 240,
                                            columnNumber: 33
                                        }, this),
                                        hasEnded && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$client$2f$app$2d$dir$2f$link$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["default"], {
                                            href: `/contest/${contest.id}/standings`,
                                            className: "px-4 py-2 bg-orange-600 text-white rounded text-sm font-medium hover:bg-orange-700 transition-colors shadow-lg shadow-orange-500/20",
                                            children: "Leaderboard"
                                        }, void 0, false, {
                                            fileName: "[project]/components/contest/ContestDetails.tsx",
                                            lineNumber: 250,
                                            columnNumber: 33
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                    lineNumber: 237,
                                    columnNumber: 25
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/components/contest/ContestDetails.tsx",
                            lineNumber: 218,
                            columnNumber: 21
                        }, this),
                        !hasStarted && !contest.canManage ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "text-center py-20 border border-gray-200 dark:border-[#262626] rounded-lg bg-white dark:bg-[#141414]",
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$lock$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Lock$3e$__["Lock"], {
                                    className: "w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-4"
                                }, void 0, false, {
                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                    lineNumber: 262,
                                    columnNumber: 29
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("h3", {
                                    className: "text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2",
                                    children: "Problems Locked"
                                }, void 0, false, {
                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                    lineNumber: 263,
                                    columnNumber: 29
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                    className: "text-gray-500 dark:text-gray-400",
                                    children: "Problems will be revealed when the contest starts."
                                }, void 0, false, {
                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                    lineNumber: 264,
                                    columnNumber: 29
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/components/contest/ContestDetails.tsx",
                            lineNumber: 261,
                            columnNumber: 25
                        }, this) : /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Fragment"], {
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "grid grid-cols-12 gap-4 px-6 py-4 border-b border-gray-100 dark:border-[#262626] text-[11px] font-bold text-gray-400 uppercase tracking-widest",
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "col-span-1",
                                            children: "#"
                                        }, void 0, false, {
                                            fileName: "[project]/components/contest/ContestDetails.tsx",
                                            lineNumber: 272,
                                            columnNumber: 33
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "col-span-6 md:col-span-7",
                                            children: "Title"
                                        }, void 0, false, {
                                            fileName: "[project]/components/contest/ContestDetails.tsx",
                                            lineNumber: 273,
                                            columnNumber: 33
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "col-span-3 md:col-span-2",
                                            children: "Difficulty"
                                        }, void 0, false, {
                                            fileName: "[project]/components/contest/ContestDetails.tsx",
                                            lineNumber: 274,
                                            columnNumber: 33
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "col-span-2 md:col-span-2",
                                            children: "Status"
                                        }, void 0, false, {
                                            fileName: "[project]/components/contest/ContestDetails.tsx",
                                            lineNumber: 275,
                                            columnNumber: 33
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                    lineNumber: 271,
                                    columnNumber: 29
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "mt-2",
                                    children: currentProblems.map((cp, index)=>{
                                        const globalIndex = startIndex + index;
                                        const canAccess = (hasAcceptedRules || contest.canManage || !hasStarted || hasEnded) && (!isFinished || contest.canManage);
                                        const isSolved = cp.isSolved; // Access the property we added
                                        // If problem is solved, block access (even for managers during testing/consistency)
                                        const isBlockedByCompletion = isSolved;
                                        return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$client$2f$app$2d$dir$2f$link$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["default"], {
                                            href: canAccess && (hasStarted || contest.canManage) && !isBlockedByCompletion ? `/problems/${cp.problem.slug}?contestId=${contest.id}` : "#",
                                            onClick: (e)=>{
                                                if (isFinished && !contest.canManage) {
                                                    e.preventDefault();
                                                    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error("Contest session ended", {
                                                        description: "You have already completed this contest."
                                                    });
                                                    return;
                                                }
                                                // Prevent re-attempting solved problems
                                                if (isBlockedByCompletion) {
                                                    e.preventDefault();
                                                    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].success("Problem Solved!", {
                                                        description: "You have already completed this challenge. Great job!"
                                                    });
                                                    return;
                                                }
                                                if (!canAccess && hasStarted && !hasEnded) {
                                                    e.preventDefault();
                                                    setShowRulesPopup(true);
                                                }
                                            },
                                            className: `grid grid-cols-12 gap-4 px-6 py-4 rounded-xl items-center transition-all duration-200 ${canAccess && (hasStarted || contest.canManage) && !isBlockedByCompletion ? "hover:bg-gray-50/50 dark:hover:bg-[#1a1a1a] cursor-pointer" : isSolved ? "opacity-75 bg-emerald-50/30 dark:bg-emerald-500/5 cursor-not-allowed" : "opacity-50 cursor-not-allowed"}`,
                                            children: [
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                    className: "col-span-1 text-sm text-gray-500 dark:text-gray-400 font-medium",
                                                    children: globalIndex + 1
                                                }, void 0, false, {
                                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                                    lineNumber: 319,
                                                    columnNumber: 45
                                                }, this),
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                    className: "col-span-6 md:col-span-7 font-medium text-gray-900 dark:text-gray-100 flex items-center gap-2",
                                                    children: [
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                            className: `truncate ${canAccess && !isBlockedByCompletion ? "hover:text-orange-600 transition-colors" : ""}`,
                                                            children: cp.problem.title
                                                        }, void 0, false, {
                                                            fileName: "[project]/components/contest/ContestDetails.tsx",
                                                            lineNumber: 323,
                                                            columnNumber: 49
                                                        }, this),
                                                        isSolved && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                            className: "px-2 py-0.5 rounded-full bg-emerald-100 dark:bg-emerald-500/20 text-emerald-700 dark:text-emerald-400 text-[10px] font-bold uppercase tracking-wider flex items-center gap-1",
                                                            children: [
                                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$circle$2d$check$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__CheckCircle2$3e$__["CheckCircle2"], {
                                                                    className: "w-3 h-3"
                                                                }, void 0, false, {
                                                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                                                    lineNumber: 328,
                                                                    columnNumber: 57
                                                                }, this),
                                                                "Solved"
                                                            ]
                                                        }, void 0, true, {
                                                            fileName: "[project]/components/contest/ContestDetails.tsx",
                                                            lineNumber: 327,
                                                            columnNumber: 54
                                                        }, this)
                                                    ]
                                                }, void 0, true, {
                                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                                    lineNumber: 322,
                                                    columnNumber: 45
                                                }, this),
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                    className: "col-span-3 md:col-span-2",
                                                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                        className: `px-2.5 py-0.5 rounded-full text-xs font-medium ${getDifficultyColor(cp.problem.difficulty)}`,
                                                        children: cp.problem.difficulty === "MEDIUM" ? "Med." : cp.problem.difficulty.charAt(0) + cp.problem.difficulty.slice(1).toLowerCase()
                                                    }, void 0, false, {
                                                        fileName: "[project]/components/contest/ContestDetails.tsx",
                                                        lineNumber: 334,
                                                        columnNumber: 49
                                                    }, this)
                                                }, void 0, false, {
                                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                                    lineNumber: 333,
                                                    columnNumber: 45
                                                }, this),
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                    className: "col-span-2 md:col-span-2 text-sm text-gray-500 dark:text-gray-400",
                                                    children: isSolved ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$circle$2d$check$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__CheckCircle2$3e$__["CheckCircle2"], {
                                                        className: "w-5 h-5 text-emerald-500"
                                                    }, void 0, false, {
                                                        fileName: "[project]/components/contest/ContestDetails.tsx",
                                                        lineNumber: 340,
                                                        columnNumber: 54
                                                    }, this) : canAccess && (hasStarted || contest.canManage) ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$chevron$2d$right$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__ChevronRight$3e$__["ChevronRight"], {
                                                        className: "w-5 h-5 text-gray-400"
                                                    }, void 0, false, {
                                                        fileName: "[project]/components/contest/ContestDetails.tsx",
                                                        lineNumber: 342,
                                                        columnNumber: 53
                                                    }, this) : /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$lock$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Lock$3e$__["Lock"], {
                                                        className: "w-4 h-4 text-gray-400"
                                                    }, void 0, false, {
                                                        fileName: "[project]/components/contest/ContestDetails.tsx",
                                                        lineNumber: 344,
                                                        columnNumber: 53
                                                    }, this)
                                                }, void 0, false, {
                                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                                    lineNumber: 338,
                                                    columnNumber: 45
                                                }, this)
                                            ]
                                        }, cp.problem.id, true, {
                                            fileName: "[project]/components/contest/ContestDetails.tsx",
                                            lineNumber: 289,
                                            columnNumber: 41
                                        }, this);
                                    })
                                }, void 0, false, {
                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                    lineNumber: 279,
                                    columnNumber: 29
                                }, this),
                                totalPages > 1 && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "flex items-center justify-center gap-2 mt-12 mb-8",
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                            onClick: ()=>setCurrentPage((p)=>Math.max(1, p - 1)),
                                            disabled: currentPage === 1,
                                            className: `p-2 border border-gray-200 dark:border-[#262626] rounded transition-colors ${currentPage === 1 ? "text-gray-300 dark:text-gray-600 cursor-not-allowed" : "text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-[#1a1a1a]"}`,
                                            children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$chevron$2d$left$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__ChevronLeft$3e$__["ChevronLeft"], {
                                                className: "w-4 h-4"
                                            }, void 0, false, {
                                                fileName: "[project]/components/contest/ContestDetails.tsx",
                                                lineNumber: 363,
                                                columnNumber: 41
                                            }, this)
                                        }, void 0, false, {
                                            fileName: "[project]/components/contest/ContestDetails.tsx",
                                            lineNumber: 355,
                                            columnNumber: 37
                                        }, this),
                                        Array.from({
                                            length: totalPages
                                        }, (_, i)=>i + 1).map((page)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                                onClick: ()=>setCurrentPage(page),
                                                className: `w-9 h-9 rounded text-sm font-medium transition-colors ${currentPage === page ? "bg-orange-600 text-white" : "border border-gray-200 dark:border-[#262626] text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-[#1a1a1a]"}`,
                                                children: page
                                            }, page, false, {
                                                fileName: "[project]/components/contest/ContestDetails.tsx",
                                                lineNumber: 367,
                                                columnNumber: 41
                                            }, this)),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                            onClick: ()=>setCurrentPage((p)=>Math.min(totalPages, p + 1)),
                                            disabled: currentPage === totalPages,
                                            className: `p-2 border border-gray-200 dark:border-[#262626] rounded transition-colors ${currentPage === totalPages ? "text-gray-300 dark:text-gray-600 cursor-not-allowed" : "text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-[#1a1a1a]"}`,
                                            children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$chevron$2d$right$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__ChevronRight$3e$__["ChevronRight"], {
                                                className: "w-4 h-4"
                                            }, void 0, false, {
                                                fileName: "[project]/components/contest/ContestDetails.tsx",
                                                lineNumber: 387,
                                                columnNumber: 41
                                            }, this)
                                        }, void 0, false, {
                                            fileName: "[project]/components/contest/ContestDetails.tsx",
                                            lineNumber: 379,
                                            columnNumber: 37
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                    lineNumber: 354,
                                    columnNumber: 33
                                }, this)
                            ]
                        }, void 0, true)
                    ]
                }, void 0, true, {
                    fileName: "[project]/components/contest/ContestDetails.tsx",
                    lineNumber: 184,
                    columnNumber: 17
                }, this)
            }, void 0, false, {
                fileName: "[project]/components/contest/ContestDetails.tsx",
                lineNumber: 183,
                columnNumber: 13
            }, this),
            showEndModal && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",
                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                    className: "bg-white dark:bg-[#141414] rounded-xl shadow-2xl w-full max-w-md p-6 border border-gray-100 dark:border-[#262626] transform scale-100 transition-all",
                    children: [
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "flex items-center gap-3 mb-4 text-red-600 dark:text-red-400",
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$shield$2d$alert$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__ShieldAlert$3e$__["ShieldAlert"], {
                                    className: "w-8 h-8"
                                }, void 0, false, {
                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                    lineNumber: 401,
                                    columnNumber: 29
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("h3", {
                                    className: "text-xl font-bold text-gray-900 dark:text-gray-100",
                                    children: "End Contest Session?"
                                }, void 0, false, {
                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                    lineNumber: 402,
                                    columnNumber: 29
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/components/contest/ContestDetails.tsx",
                            lineNumber: 400,
                            columnNumber: 25
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                            className: "text-gray-600 dark:text-gray-400 mb-6",
                            children: [
                                "Are you sure you want to end your session? You will ",
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("strong", {
                                    children: "NOT"
                                }, void 0, false, {
                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                    lineNumber: 406,
                                    columnNumber: 81
                                }, this),
                                " be able to re-enter or solve more problems after this.",
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("br", {}, void 0, false, {
                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                    lineNumber: 407,
                                    columnNumber: 29
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("br", {}, void 0, false, {
                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                    lineNumber: 407,
                                    columnNumber: 35
                                }, this),
                                "Type ",
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                    className: "font-mono font-bold text-red-600 dark:text-red-400",
                                    children: "end"
                                }, void 0, false, {
                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                    lineNumber: 408,
                                    columnNumber: 34
                                }, this),
                                " below to confirm."
                            ]
                        }, void 0, true, {
                            fileName: "[project]/components/contest/ContestDetails.tsx",
                            lineNumber: 405,
                            columnNumber: 25
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("input", {
                            type: "text",
                            placeholder: "Type 'end' to confirm",
                            value: endConfirmText,
                            onChange: (e)=>setEndConfirmText(e.target.value),
                            className: "w-full px-4 py-3 border border-gray-200 dark:border-[#262626] rounded-lg mb-6 bg-gray-50 dark:bg-[#1a1a1a] focus:bg-white dark:focus:bg-[#0a0a0a] focus:ring-2 focus:ring-red-500/20 focus:border-red-500 outline-none transition-all font-mono text-center uppercase tracking-widest placeholder:normal-case placeholder:tracking-normal text-gray-900 dark:text-gray-100",
                            autoFocus: true
                        }, void 0, false, {
                            fileName: "[project]/components/contest/ContestDetails.tsx",
                            lineNumber: 411,
                            columnNumber: 25
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "flex gap-3",
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                    onClick: ()=>{
                                        setShowEndModal(false);
                                        setEndConfirmText("");
                                    },
                                    className: "flex-1 px-4 py-3 border border-gray-200 dark:border-[#262626] rounded-lg font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-[#1a1a1a] transition-colors",
                                    children: "Cancel"
                                }, void 0, false, {
                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                    lineNumber: 421,
                                    columnNumber: 29
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                    onClick: confirmEndContest,
                                    disabled: endConfirmText.toLowerCase() !== "end" || isSubmittingContest,
                                    className: "flex-1 px-4 py-3 bg-red-600 text-white rounded-lg font-bold hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-red-500/20",
                                    children: isSubmittingContest ? "Ending..." : "End Contest"
                                }, void 0, false, {
                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                    lineNumber: 427,
                                    columnNumber: 29
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/components/contest/ContestDetails.tsx",
                            lineNumber: 420,
                            columnNumber: 25
                        }, this)
                    ]
                }, void 0, true, {
                    fileName: "[project]/components/contest/ContestDetails.tsx",
                    lineNumber: 399,
                    columnNumber: 21
                }, this)
            }, void 0, false, {
                fileName: "[project]/components/contest/ContestDetails.tsx",
                lineNumber: 398,
                columnNumber: 17
            }, this)
        ]
    }, void 0, true);
}
_s(ContestDetails, "7HtDmzoFP9z4423ug4pc9C1CfHw=", false, function() {
    return [
        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$navigation$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRouter"]
    ];
});
_c = ContestDetails;
var _c;
__turbopack_context__.k.register(_c, "ContestDetails");
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/components/BackButton.tsx [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "default",
    ()=>BackButton
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/jsx-dev-runtime.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$navigation$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/navigation.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$arrow$2d$left$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__ArrowLeft$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/arrow-left.js [app-client] (ecmascript) <export default as ArrowLeft>");
;
var _s = __turbopack_context__.k.signature();
"use client";
;
;
function BackButton({ href, label = "Back", children, className = "" }) {
    _s();
    const router = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$navigation$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRouter"])();
    const handleClick = ()=>{
        if (href) {
            router.push(href);
        } else {
            router.back();
        }
    };
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
        onClick: handleClick,
        className: `inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-colors rounded-lg hover:bg-gray-100 dark:hover:bg-[#1a1a1a] ${className}`,
        children: [
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$arrow$2d$left$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__ArrowLeft$3e$__["ArrowLeft"], {
                className: "w-4 h-4"
            }, void 0, false, {
                fileName: "[project]/components/BackButton.tsx",
                lineNumber: 34,
                columnNumber: 7
            }, this),
            children || label
        ]
    }, void 0, true, {
        fileName: "[project]/components/BackButton.tsx",
        lineNumber: 30,
        columnNumber: 5
    }, this);
}
_s(BackButton, "fN7XvhJ+p5oE6+Xlo0NJmXpxjC8=", false, function() {
    return [
        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$navigation$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRouter"]
    ];
});
_c = BackButton;
var _c;
__turbopack_context__.k.register(_c, "BackButton");
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
]);

//# sourceMappingURL=_361fb9d2._.js.map