(globalThis.TURBOPACK || (globalThis.TURBOPACK = [])).push([typeof document === "object" ? document.currentScript : undefined,
"[project]/actions/data:608faf [app-client] (ecmascript) <text/javascript>", ((__turbopack_context__) => {
"use strict";

/* __next_internal_action_entry_do_not_use__ [{"60ab32f1cc26748b4afce6a433ca3e6dc394836698":"startContestSession"},"actions/contest.ts",""] */ __turbopack_context__.s([
    "startContestSession",
    ()=>startContestSession
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-client] (ecmascript)");
"use turbopack no side effects";
;
var startContestSession = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["createServerReference"])("60ab32f1cc26748b4afce6a433ca3e6dc394836698", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["findSourceMapURL"], "startContestSession"); //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vY29udGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzZXJ2ZXJcIjtcblxuaW1wb3J0IHsgcHJpc21hIH0gZnJvbSBcIkAvbGliL3ByaXNtYVwiO1xuaW1wb3J0IHsgYXV0aCB9IGZyb20gXCJAL2xpYi9hdXRoXCI7XG5pbXBvcnQgeyBoZWFkZXJzIH0gZnJvbSBcIm5leHQvaGVhZGVyc1wiO1xuaW1wb3J0IHsgeiB9IGZyb20gXCJ6b2RcIjtcbmltcG9ydCB7IHJldmFsaWRhdGVQYXRoLCByZXZhbGlkYXRlVGFnIH0gZnJvbSBcIm5leHQvY2FjaGVcIjtcbmltcG9ydCB7IGNhY2hlVGFnLCBjYWNoZUxpZmUgfSBmcm9tIFwibmV4dC9jYWNoZVwiO1xuXG5jb25zdCBjb250ZXN0U2NoZW1hID0gei5vYmplY3Qoe1xuICAgIHRpdGxlOiB6LnN0cmluZygpLm1pbigzLCBcIlRpdGxlIG11c3QgYmUgYXQgbGVhc3QgMyBjaGFyYWN0ZXJzXCIpLFxuICAgIGRlc2NyaXB0aW9uOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgc3RhcnRUaW1lOiB6LmNvZXJjZS5kYXRlKCksXG4gICAgZW5kVGltZTogei5jb2VyY2UuZGF0ZSgpLFxuICAgIHZpc2liaWxpdHk6IHouZW51bShbXCJQVUJMSUNcIiwgXCJJTlNUSVRVVElPTlwiLCBcIkNMQVNTUk9PTVwiXSksXG4gICAgY2xhc3Nyb29tSWQ6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgICBpbnN0aXR1dGlvbklkOiB6LnN0cmluZygpLm9wdGlvbmFsKCkubnVsbGFibGUoKSxcbiAgICBwcm9ibGVtczogei5hcnJheSh6LnN0cmluZygpKS5taW4oMSwgXCJTZWxlY3QgYXQgbGVhc3Qgb25lIHByb2JsZW1cIiksXG4gICAgY29udGVzdFBhc3N3b3JkOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgcmFuZG9taXplUXVlc3Rpb25zOiB6LmJvb2xlYW4oKS5kZWZhdWx0KGZhbHNlKSxcbn0pO1xuXG5jb25zdCBjb250ZXN0V2l0aFByb2JsZW1zU2NoZW1hID0gei5vYmplY3Qoe1xuICAgIHRpdGxlOiB6LnN0cmluZygpLm1pbigzLCBcIlRpdGxlIG11c3QgYmUgYXQgbGVhc3QgMyBjaGFyYWN0ZXJzXCIpLFxuICAgIHNsdWc6IHouc3RyaW5nKCkubWluKDMsIFwiU2x1ZyBtdXN0IGJlIGF0IGxlYXN0IDMgY2hhcmFjdGVyc1wiKSxcbiAgICBkZXNjcmlwdGlvbjogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAgIHN0YXJ0VGltZTogei5kYXRlKCksXG4gICAgZW5kVGltZTogei5kYXRlKCksXG4gICAgdmlzaWJpbGl0eTogei5lbnVtKFtcIlBVQkxJQ1wiLCBcIklOU1RJVFVUSU9OXCIsIFwiQ0xBU1NST09NXCJdKSxcbiAgICBoaWRkZW46IHouYm9vbGVhbigpLmRlZmF1bHQoZmFsc2UpLFxuICAgIGNsYXNzcm9vbUlkOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgaW5zdGl0dXRpb25JZDogei5zdHJpbmcoKS5vcHRpb25hbCgpLm51bGxhYmxlKCksXG4gICAgYmFja2dyb3VuZEltYWdlOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgcHJpemVzOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgcnVsZXM6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgICBwcm9ibGVtczogei5hcnJheSh6LmFueSgpKSwgLy8gRnVsbCBwcm9ibGVtIGRhdGEgb2JqZWN0c1xuICAgIGNvbnRlc3RQYXNzd29yZDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAgIHJhbmRvbWl6ZVF1ZXN0aW9uczogei5ib29sZWFuKCkuZGVmYXVsdChmYWxzZSksXG59KTtcblxuLyoqXG4gKiBGZXRjaGVzIGNvbnRlc3RzIHZpc2libGUgdG8gdGhlIGN1cnJlbnQgdXNlci5cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFZpc2libGVDb250ZXN0cygpIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIHRyeSB7XG4gICAgICAgIGlmICghc2Vzc2lvbj8udXNlcikge1xuICAgICAgICAgICAgY29uc3QgY29udGVzdHMgPSBhd2FpdCBwcmlzbWEuY29udGVzdC5maW5kTWFueSh7XG4gICAgICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICAgICAgdmlzaWJpbGl0eTogXCJQVUJMSUNcIixcbiAgICAgICAgICAgICAgICAgICAgaGlkZGVuOiBmYWxzZSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICAgICAgX2NvdW50OiB7IHNlbGVjdDogeyBwcm9ibGVtczogdHJ1ZSB9IH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9yZGVyQnk6IHsgc3RhcnRUaW1lOiBcImRlc2NcIiB9LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBjb250ZXN0cyB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgY3VycmVudFVzZXIgPSBzZXNzaW9uLnVzZXIgYXMgYW55O1xuXG4gICAgICAgIGlmIChjdXJyZW50VXNlci5yb2xlID09PSBcIkFETUlOXCIpIHtcbiAgICAgICAgICAgIGNvbnN0IGNvbnRlc3RzID0gYXdhaXQgcHJpc21hLmNvbnRlc3QuZmluZE1hbnkoe1xuICAgICAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICAgICAgX2NvdW50OiB7IHNlbGVjdDogeyBwcm9ibGVtczogdHJ1ZSB9IH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9yZGVyQnk6IHsgc3RhcnRUaW1lOiBcImRlc2NcIiB9LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBjb250ZXN0cyB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgY29udGVzdHMgPSBhd2FpdCBwcmlzbWEuY29udGVzdC5maW5kTWFueSh7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgIE9SOiBbXG4gICAgICAgICAgICAgICAgICAgIHsgdmlzaWJpbGl0eTogXCJQVUJMSUNcIiB9LFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBBTkQ6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IHZpc2liaWxpdHk6IFwiSU5TVElUVVRJT05cIiB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgaW5zdGl0dXRpb25JZDogY3VycmVudFVzZXIuaW5zdGl0dXRpb25JZCB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgQU5EOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeyB2aXNpYmlsaXR5OiBcIkNMQVNTUk9PTVwiIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBPUjogW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBjbGFzc3Jvb206IHsgc3R1ZGVudHM6IHsgc29tZTogeyBpZDogY3VycmVudFVzZXIuaWQgfSB9IH0gfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgY3JlYXRvcklkOiBjdXJyZW50VXNlci5pZCB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB7IGNyZWF0b3JJZDogY3VycmVudFVzZXIuaWQgfSxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICBfY291bnQ6IHsgc2VsZWN0OiB7IHByb2JsZW1zOiB0cnVlIH0gfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9yZGVyQnk6IHsgc3RhcnRUaW1lOiBcImRlc2NcIiB9LFxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBjb250ZXN0cyB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gZmV0Y2ggY29udGVzdHM6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBmZXRjaCBjb250ZXN0c1wiIH07XG4gICAgfVxufVxuXG5cbi8qKlxuICogRmV0Y2hlcyBhIHNpbmdsZSBjb250ZXN0J3MgZGV0YWlscyB3aXRoIGF1dGhvcml6YXRpb24uXG4gKi9cbi8qKlxuICogRmV0Y2hlcyBhIHNpbmdsZSBjb250ZXN0J3MgZGV0YWlscyB3aXRoIGF1dGhvcml6YXRpb24uXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRDb250ZXN0RGV0YWlsKGNvbnRlc3RJZDogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjb250ZXN0ID0gYXdhaXQgcHJpc21hLmNvbnRlc3QuZmluZFVuaXF1ZSh7XG4gICAgICAgICAgICB3aGVyZTogeyBpZDogY29udGVzdElkIH0sXG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgX2NvdW50OiB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdDogeyBwcm9ibGVtczogdHJ1ZSB9LFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgcHJvYmxlbXM6IHtcbiAgICAgICAgICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJvYmxlbToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpZmZpY3VsdHk6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNsdWc6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIG9yZGVyQnk6IHsgb3JkZXI6IFwiYXNjXCIgfSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKCFjb250ZXN0KSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiQ29udGVzdCBub3QgZm91bmRcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgY3VycmVudFVzZXIgPSBzZXNzaW9uPy51c2VyIGFzIGFueTtcbiAgICAgICAgY29uc3QgcGFydGljaXBhdGlvbiA9IGN1cnJlbnRVc2VyID8gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZDogY3VycmVudFVzZXIuaWQsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlc3RJZDogY29udGVzdElkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KSA6IG51bGw7XG5cbiAgICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgICAgICAgY29uc3QgaGFzU3RhcnRlZCA9IG5vdyA+PSBjb250ZXN0LnN0YXJ0VGltZTtcbiAgICAgICAgY29uc3QgaXNDcmVhdG9yID0gY3VycmVudFVzZXI/LmlkID09PSBjb250ZXN0LmNyZWF0b3JJZDtcbiAgICAgICAgY29uc3QgaXNBZG1pbiA9IGN1cnJlbnRVc2VyPy5yb2xlID09PSBcIkFETUlOXCI7XG5cbiAgICAgICAgLy8gVmlzaWJpbGl0eSBDaGVja1xuICAgICAgICBsZXQgaXNBdXRob3JpemVkID0gZmFsc2U7XG4gICAgICAgIGlmIChjb250ZXN0LnZpc2liaWxpdHkgPT09IFwiUFVCTElDXCIpIHtcbiAgICAgICAgICAgIGlzQXV0aG9yaXplZCA9IHRydWU7XG4gICAgICAgIH0gZWxzZSBpZiAoaXNBZG1pbikge1xuICAgICAgICAgICAgaXNBdXRob3JpemVkID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIGlmIChjdXJyZW50VXNlcikge1xuICAgICAgICAgICAgaWYgKGlzQ3JlYXRvcikge1xuICAgICAgICAgICAgICAgIGlzQXV0aG9yaXplZCA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGNvbnRlc3QudmlzaWJpbGl0eSA9PT0gXCJJTlNUSVRVVElPTlwiKSB7XG4gICAgICAgICAgICAgICAgLy8gVXNlID09IGZvciBudWxsL3VuZGVmaW5lZCBsb29zZSBlcXVhbGl0eSBjaGVja1xuICAgICAgICAgICAgICAgIGlzQXV0aG9yaXplZCA9IGN1cnJlbnRVc2VyLmluc3RpdHV0aW9uSWQgPT0gY29udGVzdC5pbnN0aXR1dGlvbklkO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChjb250ZXN0LnZpc2liaWxpdHkgPT09IFwiQ0xBU1NST09NXCIpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlbnJvbGxtZW50ID0gYXdhaXQgcHJpc21hLmNsYXNzcm9vbS5maW5kRmlyc3Qoe1xuICAgICAgICAgICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGNvbnRlc3QuY2xhc3Nyb29tSWQgYXMgc3RyaW5nLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3R1ZGVudHM6IHsgc29tZTogeyBpZDogY3VycmVudFVzZXIuaWQgfSB9LFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGlzQXV0aG9yaXplZCA9ICEhZW5yb2xsbWVudDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghaXNBdXRob3JpemVkKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkIGFjY2VzcyB0byB0aGlzIGNvbnRlc3QuXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGNhblNlZVByb2JsZW1zID0gKGhhc1N0YXJ0ZWQgfHwgaXNBZG1pbiB8fCBpc0NyZWF0b3IpICYmIChwYXJ0aWNpcGF0aW9uPy5hY2NlcHRlZFJ1bGVzIHx8IGlzQ3JlYXRvciB8fCBpc0FkbWluKTtcblxuICAgICAgICAvLyBGaXg6IElmIHRoZSBjb250ZXN0IGlzIG92ZXIsIGFsbG93ZWQgcm9sZXMgc2hvdWxkIGNoZWNrIHBhcnRpY2lwYXRpb24gcHJvcGVybHksXG4gICAgICAgIC8vIGJ1dCB0eXBpY2FsbHkgYWxsb3dzIHZpZXdpbmcgaWYgcHVibGljL2F1dGhvcml6ZWQuXG4gICAgICAgIC8vIEJ1dCBmb3IgXCJMaXZlXCIgY29udGVzdHMsIHRoZSBjdXJyZW50IGxvZ2ljIGlzIGNvcnJlY3QuXG5cbiAgICAgICAgY29uc3QgcmVxdWlyZXNQYXNzd29yZCA9ICEhY29udGVzdC5jb250ZXN0UGFzc3dvcmQ7XG5cbiAgICAgICAgLy8gU2h1ZmZsZSBwcm9ibGVtcyBpZiByYW5kb21pemVRdWVzdGlvbnMgaXMgZW5hYmxlZFxuICAgICAgICAvLyBVc2UgYSBzaW1wbGUgc2VlZGVkIHNodWZmbGUgYmFzZWQgb24gdXNlcklkICsgY29udGVzdElkIGZvciBjb25zaXN0ZW5jeVxuICAgICAgICBsZXQgdmlzaWJsZVByb2JsZW1zID0gY2FuU2VlUHJvYmxlbXMgPyBjb250ZXN0LnByb2JsZW1zIDogW107XG5cbiAgICAgICAgaWYgKGNvbnRlc3QucmFuZG9taXplUXVlc3Rpb25zICYmIGN1cnJlbnRVc2VyICYmIHZpc2libGVQcm9ibGVtcy5sZW5ndGggPiAwICYmICFpc0FkbWluICYmICFpc0NyZWF0b3IpIHtcbiAgICAgICAgICAgIC8vIFNpbXBsZSBzdHJpbmcgaGFzaCBmdW5jdGlvbiBmb3Igc2VlZGluZ1xuICAgICAgICAgICAgY29uc3Qgc2VlZFN0ciA9IGAke2N1cnJlbnRVc2VyLmlkfS0ke2NvbnRlc3RJZH1gO1xuICAgICAgICAgICAgbGV0IHNlZWQgPSAwO1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzZWVkU3RyLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgc2VlZCA9ICgoc2VlZCA8PCA1KSAtIHNlZWQpICsgc2VlZFN0ci5jaGFyQ29kZUF0KGkpO1xuICAgICAgICAgICAgICAgIHNlZWQgfD0gMDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gRGV0ZXJtaW5pc3RpYyBzaHVmZmxlXG4gICAgICAgICAgICB2aXNpYmxlUHJvYmxlbXMgPSBbLi4udmlzaWJsZVByb2JsZW1zXS5zb3J0KChhLCBiKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgeCA9IE1hdGguc2luKHNlZWQrKykgKiAxMDAwMDtcbiAgICAgICAgICAgICAgICByZXR1cm4gKHggLSBNYXRoLmZsb29yKHgpKSAtIDAuNTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gRmV0Y2ggdXNlcidzIHNvbHZlZCBwcm9ibGVtcyBmb3IgdGhpcyBjb250ZXN0XG4gICAgICAgIGNvbnN0IHNvbHZlZFByb2JsZW1JZHMgPSBuZXcgU2V0PHN0cmluZz4oKTtcbiAgICAgICAgaWYgKGN1cnJlbnRVc2VyKSB7XG4gICAgICAgICAgICBjb25zdCBzb2x2ZWRTdWJtaXNzaW9ucyA9IGF3YWl0IHByaXNtYS5zdWJtaXNzaW9uLmZpbmRNYW55KHtcbiAgICAgICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IGN1cnJlbnRVc2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZCxcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiBcIkFDQ0VQVEVEXCIsXG4gICAgICAgICAgICAgICAgICAgIHByb2JsZW1JZDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgaW46IHZpc2libGVQcm9ibGVtcy5tYXAocCA9PiBwLnByb2JsZW0uaWQpXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHNlbGVjdDogeyBwcm9ibGVtSWQ6IHRydWUgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBzb2x2ZWRTdWJtaXNzaW9ucy5mb3JFYWNoKHMgPT4gc29sdmVkUHJvYmxlbUlkcy5hZGQocy5wcm9ibGVtSWQpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgY29udGVzdDoge1xuICAgICAgICAgICAgICAgIC4uLmNvbnRlc3QsXG4gICAgICAgICAgICAgICAgcHJvYmxlbXM6IHZpc2libGVQcm9ibGVtcy5tYXAodnAgPT4gKHtcbiAgICAgICAgICAgICAgICAgICAgLi4udnAsXG4gICAgICAgICAgICAgICAgICAgIGlzU29sdmVkOiBzb2x2ZWRQcm9ibGVtSWRzLmhhcyh2cC5wcm9ibGVtLmlkKVxuICAgICAgICAgICAgICAgIH0pKSxcbiAgICAgICAgICAgICAgICBoYXNTdGFydGVkLFxuICAgICAgICAgICAgICAgIGhhc0VuZGVkOiBub3cgPiBjb250ZXN0LmVuZFRpbWUsXG4gICAgICAgICAgICAgICAgY2FuTWFuYWdlOiBpc0FkbWluIHx8IGlzQ3JlYXRvcixcbiAgICAgICAgICAgICAgICBoYXNBY2NlcHRlZFJ1bGVzOiBwYXJ0aWNpcGF0aW9uPy5hY2NlcHRlZFJ1bGVzIHx8IGZhbHNlLFxuICAgICAgICAgICAgICAgIGlzRmluaXNoZWQ6IHBhcnRpY2lwYXRpb24/LmlzRmluaXNoZWQgfHwgZmFsc2UsXG4gICAgICAgICAgICAgICAgcmVxdWlyZXNQYXNzd29yZCxcbiAgICAgICAgICAgICAgICBjb250ZXN0UGFzc3dvcmQ6IG51bGwsIC8vIE5ldmVyIHJldHVybiBwbGFpbiBwYXNzd29yZFxuICAgICAgICAgICAgICAgIHNlc3Npb25JZDogcGFydGljaXBhdGlvbj8uc2Vzc2lvbklkIC8vIFJldHVybiBzZXNzaW9uSWQgZm9yIHByb3RlY3Rpb25cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGZldGNoIGNvbnRlc3QgZGV0YWlsOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZmV0Y2ggY29udGVzdFwiIH07XG4gICAgfVxufVxuXG4vLyAuLi4gZXhpc3RpbmcgY29kZSAuLi5cblxuLy8gLi4uIGV4aXN0aW5nIGNvZGUgLi4uXG5cbi8vIC4uLiBleGlzdGluZyBjb2RlIC4uLlxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlQ29udGVzdChkYXRhOiB6LmluZmVyPHR5cGVvZiBjb250ZXN0U2NoZW1hPikge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSB7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuICAgIH1cblxuICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gc2Vzc2lvbi51c2VyIGFzIGFueTtcblxuICAgIGlmICghW1wiQURNSU5cIiwgXCJJTlNUSVRVVElPTl9NQU5BR0VSXCIsIFwiQ09OVEVTVF9NQU5BR0VSXCIsIFwiVEVBQ0hFUlwiXS5pbmNsdWRlcyhjdXJyZW50VXNlci5yb2xlKSkge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCB2YWxpZGF0ZWREYXRhID0gY29udGVzdFNjaGVtYS5wYXJzZShkYXRhKTtcblxuICAgICAgICAvLyBHZW5lcmF0ZSBhIG1vcmUgcm9idXN0IHVuaXF1ZSBzbHVnXG4gICAgICAgIGNvbnN0IGJhc2VTbHVnID0gdmFsaWRhdGVkRGF0YS50aXRsZS50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoL1teYS16MC05XSsvZywgXCItXCIpLnJlcGxhY2UoLyheLXwtJCkvZywgXCJcIik7XG4gICAgICAgIGNvbnN0IHVuaXF1ZVNsdWcgPSBgJHtiYXNlU2x1Z30tJHtEYXRlLm5vdygpfWA7XG5cbiAgICAgICAgY29uc3QgY29udGVzdCA9IGF3YWl0IHByaXNtYS5jb250ZXN0LmNyZWF0ZSh7XG4gICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgdGl0bGU6IHZhbGlkYXRlZERhdGEudGl0bGUsXG4gICAgICAgICAgICAgICAgc2x1ZzogdW5pcXVlU2x1ZyxcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogdmFsaWRhdGVkRGF0YS5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICBzdGFydFRpbWU6IHZhbGlkYXRlZERhdGEuc3RhcnRUaW1lLFxuICAgICAgICAgICAgICAgIGVuZFRpbWU6IHZhbGlkYXRlZERhdGEuZW5kVGltZSxcbiAgICAgICAgICAgICAgICB2aXNpYmlsaXR5OiB2YWxpZGF0ZWREYXRhLnZpc2liaWxpdHkgYXMgYW55LFxuICAgICAgICAgICAgICAgIGluc3RpdHV0aW9uSWQ6IHZhbGlkYXRlZERhdGEudmlzaWJpbGl0eSAhPT0gXCJQVUJMSUNcIiA/ICh2YWxpZGF0ZWREYXRhLmluc3RpdHV0aW9uSWQgfHwgbnVsbCkgOiBudWxsLFxuICAgICAgICAgICAgICAgIGNsYXNzcm9vbUlkOiB2YWxpZGF0ZWREYXRhLnZpc2liaWxpdHkgPT09IFwiQ0xBU1NST09NXCIgPyAodmFsaWRhdGVkRGF0YS5jbGFzc3Jvb21JZCB8fCBudWxsKSA6IG51bGwsXG4gICAgICAgICAgICAgICAgY3JlYXRvcklkOiBjdXJyZW50VXNlci5pZCxcbiAgICAgICAgICAgICAgICBjb250ZXN0UGFzc3dvcmQ6IHZhbGlkYXRlZERhdGEuY29udGVzdFBhc3N3b3JkIHx8IG51bGwsXG4gICAgICAgICAgICAgICAgcmFuZG9taXplUXVlc3Rpb25zOiB2YWxpZGF0ZWREYXRhLnJhbmRvbWl6ZVF1ZXN0aW9ucyB8fCBmYWxzZSxcbiAgICAgICAgICAgICAgICBwcm9ibGVtczoge1xuICAgICAgICAgICAgICAgICAgICBjcmVhdGU6IHZhbGlkYXRlZERhdGEucHJvYmxlbXMubWFwKChwcm9ibGVtSWQsIGluZGV4KSA9PiAoe1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJvYmxlbUlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgb3JkZXI6IGluZGV4LFxuICAgICAgICAgICAgICAgICAgICB9KSksXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC9jb250ZXN0c1wiKTtcbiAgICAgICAgcmV2YWxpZGF0ZVBhdGgoXCIvY29udGVzdFwiKTtcbiAgICAgICAgcmV2YWxpZGF0ZVRhZyhcImNvbnRlc3RzXCIsIFwibWF4XCIpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBjb250ZXN0SWQ6IGNvbnRlc3QuaWQgfTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gY3JlYXRlIGNvbnRlc3Q6XCIsIGVycm9yKTtcbiAgICAgICAgLy8gUmV0dXJuIGNsZWFyZXIgZXJyb3IgbWVzc2FnZXNcbiAgICAgICAgbGV0IGVycm9yTWVzc2FnZSA9IFwiRmFpbGVkIHRvIGNyZWF0ZSBjb250ZXN0XCI7XG4gICAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIHouWm9kRXJyb3IpIHtcbiAgICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSAoZXJyb3IgYXMgYW55KS5lcnJvcnMubWFwKChlOiBhbnkpID0+IGUubWVzc2FnZSkuam9pbihcIiwgXCIpO1xuICAgICAgICB9IGVsc2UgaWYgKGVycm9yIGluc3RhbmNlb2YgRXJyb3IpIHtcbiAgICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSBlcnJvci5tZXNzYWdlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3JNZXNzYWdlIH07XG4gICAgfVxuICAgIH1cblxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlQ29udGVzdFdpdGhQcm9ibGVtcyhkYXRhOiB6LmluZmVyPHR5cGVvZiBjb250ZXN0V2l0aFByb2JsZW1zU2NoZW1hPikge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSB7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuICAgIH1cblxuICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gc2Vzc2lvbi51c2VyIGFzIGFueTtcblxuICAgIGlmICghW1wiQURNSU5cIiwgXCJJTlNUSVRVVElPTl9NQU5BR0VSXCIsIFwiQ09OVEVTVF9NQU5BR0VSXCIsIFwiVEVBQ0hFUlwiXS5pbmNsdWRlcyhjdXJyZW50VXNlci5yb2xlKSkge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCB2YWxpZGF0ZWREYXRhID0gY29udGVzdFdpdGhQcm9ibGVtc1NjaGVtYS5wYXJzZShkYXRhKTtcblxuICAgICAgICBjb25zdCBjb250ZXN0ID0gYXdhaXQgcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNvbnRlc3QgPSBhd2FpdCB0eC5jb250ZXN0LmNyZWF0ZSh7XG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICB0aXRsZTogdmFsaWRhdGVkRGF0YS50aXRsZSxcbiAgICAgICAgICAgICAgICAgICAgc2x1ZzogdmFsaWRhdGVkRGF0YS5zbHVnLFxuICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogdmFsaWRhdGVkRGF0YS5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICAgICAgc3RhcnRUaW1lOiB2YWxpZGF0ZWREYXRhLnN0YXJ0VGltZSxcbiAgICAgICAgICAgICAgICAgICAgZW5kVGltZTogdmFsaWRhdGVkRGF0YS5lbmRUaW1lLFxuICAgICAgICAgICAgICAgICAgICB2aXNpYmlsaXR5OiB2YWxpZGF0ZWREYXRhLnZpc2liaWxpdHkgYXMgYW55LFxuICAgICAgICAgICAgICAgICAgICBoaWRkZW46IHZhbGlkYXRlZERhdGEuaGlkZGVuLFxuICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kSW1hZ2U6IHZhbGlkYXRlZERhdGEuYmFja2dyb3VuZEltYWdlLFxuICAgICAgICAgICAgICAgICAgICBwcml6ZXM6IHZhbGlkYXRlZERhdGEucHJpemVzLFxuICAgICAgICAgICAgICAgICAgICBydWxlczogdmFsaWRhdGVkRGF0YS5ydWxlcyxcbiAgICAgICAgICAgICAgICAgICAgaW5zdGl0dXRpb25JZDogdmFsaWRhdGVkRGF0YS52aXNpYmlsaXR5ICE9PSBcIlBVQkxJQ1wiID8gKHZhbGlkYXRlZERhdGEuaW5zdGl0dXRpb25JZCB8fCBudWxsKSA6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIGNsYXNzcm9vbUlkOiB2YWxpZGF0ZWREYXRhLnZpc2liaWxpdHkgPT09IFwiQ0xBU1NST09NXCIgPyAodmFsaWRhdGVkRGF0YS5jbGFzc3Jvb21JZCB8fCBudWxsKSA6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIGNyZWF0b3JJZDogY3VycmVudFVzZXIuaWQsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlc3RQYXNzd29yZDogdmFsaWRhdGVkRGF0YS5jb250ZXN0UGFzc3dvcmQgfHwgbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgcmFuZG9taXplUXVlc3Rpb25zOiB2YWxpZGF0ZWREYXRhLnJhbmRvbWl6ZVF1ZXN0aW9ucyB8fCBmYWxzZSxcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB2YWxpZGF0ZWREYXRhLnByb2JsZW1zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcCA9IHZhbGlkYXRlZERhdGEucHJvYmxlbXNbaV07XG4gICAgICAgICAgICAgICAgLy8gR2VuZXJhdGUgdW5pcXVlIHNsdWcgYnkgYXBwZW5kaW5nIGNvbnRlc3Qgc2x1ZyBhbmQgaW5kZXhcbiAgICAgICAgICAgICAgICBjb25zdCB1bmlxdWVTbHVnID0gYCR7dmFsaWRhdGVkRGF0YS5zbHVnfS0ke3Auc2x1ZyB8fCBwLnRpdGxlLnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvXFxzKy9nLCAnLScpfS0ke0RhdGUubm93KCl9LSR7aX1gO1xuICAgICAgICAgICAgICAgIGNvbnN0IHByb2JsZW0gPSBhd2FpdCB0eC5wcm9ibGVtLmNyZWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBwLnRpdGxlLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHAuZGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICBkaWZmaWN1bHR5OiBwLmRpZmZpY3VsdHksXG4gICAgICAgICAgICAgICAgICAgICAgICBzbHVnOiB1bmlxdWVTbHVnLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcmU6IHAuc2NvcmUgfHwgMTAsXG4gICAgICAgICAgICAgICAgICAgICAgICBkb21haW46IHAuZG9tYWluLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJDT05URVNUXCIsIC8vIENvbnRlc3QgcHJvYmxlbXMgYXJlIG1hcmtlZCBzZXBhcmF0ZWx5XG4gICAgICAgICAgICAgICAgICAgICAgICBoaWRkZW46IHRydWUsIC8vIENvbnRlc3QgcHJvYmxlbXMgYXJlIGhpZGRlbiBmcm9tIG1haW4gYmFua1xuICAgICAgICAgICAgICAgICAgICAgICAgdGVzdENhc2VzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlOiBwLnRlc3RDYXNlcyxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICB0YWdzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29ubmVjdDogcC50YWdzPy5tYXAoKHQ6IHN0cmluZykgPT4gKHsgbmFtZTogdCB9KSkgfHwgW10sXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGF3YWl0IHR4LmNvbnRlc3RQcm9ibGVtLmNyZWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlc3RJZDogY29udGVzdC5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2JsZW1JZDogcHJvYmxlbS5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG9yZGVyOiBpLFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBjb250ZXN0O1xuICAgICAgICB9KTtcblxuICAgICAgICByZXZhbGlkYXRlUGF0aChcIi9kYXNoYm9hcmQvY29udGVzdHNcIik7XG4gICAgICAgIHJldmFsaWRhdGVQYXRoKFwiL2NvbnRlc3RzXCIpO1xuICAgICAgICByZXZhbGlkYXRlUGF0aChcIi9jb250ZXN0XCIpO1xuICAgICAgICByZXZhbGlkYXRlVGFnKFwiY29udGVzdHNcIiwgXCJtYXhcIik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGNvbnRlc3RJZDogY29udGVzdC5pZCB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gY3JlYXRlIGNvbnRlc3Qgd2l0aCBwcm9ibGVtczpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGNyZWF0ZSBjb250ZXN0XCIgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRJbnN0aXR1dGlvbmFsQ2xhc3Nyb29tcyhpbnN0aXR1dGlvbklkOiBzdHJpbmcpIHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjbGFzc3Jvb21zID0gYXdhaXQgcHJpc21hLmNsYXNzcm9vbS5maW5kTWFueSh7XG4gICAgICAgICAgICB3aGVyZTogeyBpbnN0aXR1dGlvbklkIH0sXG4gICAgICAgICAgICBzZWxlY3Q6IHsgaWQ6IHRydWUsIG5hbWU6IHRydWUsIHNlY3Rpb246IHRydWUgfSxcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGNsYXNzcm9vbXMgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGZldGNoIGNsYXNzcm9vbXM6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBmZXRjaCBjbGFzc3Jvb21zXCIgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRTZWxlY3RhYmxlUHJvYmxlbXMoc2VhcmNoOiBzdHJpbmcpIHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBwcm9ibGVtcyA9IGF3YWl0IHByaXNtYS5wcm9ibGVtLmZpbmRNYW55KHtcbiAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgT1I6IFtcbiAgICAgICAgICAgICAgICAgICAgeyB0aXRsZTogeyBjb250YWluczogc2VhcmNoLCBtb2RlOiBcImluc2Vuc2l0aXZlXCIgfSB9LFxuICAgICAgICAgICAgICAgICAgICB7IHNsdWc6IHsgY29udGFpbnM6IHNlYXJjaCwgbW9kZTogXCJpbnNlbnNpdGl2ZVwiIH0gfSxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIGhpZGRlbjogZmFsc2UsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2VsZWN0OiB7IGlkOiB0cnVlLCB0aXRsZTogdHJ1ZSwgZGlmZmljdWx0eTogdHJ1ZSwgc2x1ZzogdHJ1ZSB9LFxuICAgICAgICAgICAgdGFrZTogMTAsXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBwcm9ibGVtcyB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gZmV0Y2ggcHJvYmxlbXM6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBmZXRjaCBwcm9ibGVtc1wiIH07XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYWNjZXB0Q29udGVzdFJ1bGVzKGNvbnRlc3RJZDogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICBpZiAoIXNlc3Npb24/LnVzZXIpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuXG4gICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLnVwc2VydCh7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgIHVzZXJJZF9jb250ZXN0SWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkOiBzZXNzaW9uLnVzZXIuaWQsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlc3RJZDogY29udGVzdElkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHVwZGF0ZTogeyBhY2NlcHRlZFJ1bGVzOiB0cnVlIH0sXG4gICAgICAgICAgICBjcmVhdGU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWQ6IHNlc3Npb24udXNlci5pZCxcbiAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZCxcbiAgICAgICAgICAgICAgICBhY2NlcHRlZFJ1bGVzOiB0cnVlXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXZhbGlkYXRlUGF0aChgL2NvbnRlc3QvJHtjb250ZXN0SWR9YCk7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGFjY2VwdCBydWxlc1wiIH07XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZmluaXNoQ29udGVzdEFjdGlvbihjb250ZXN0SWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcblxuICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHByaXNtYS5jb250ZXN0UGFydGljaXBhdGlvbi51cHNlcnQoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1cGRhdGU6IHtcbiAgICAgICAgICAgICAgICBpc0ZpbmlzaGVkOiB0cnVlLFxuICAgICAgICAgICAgICAgIGZpbmlzaGVkQXQ6IG5ldyBEYXRlKClcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjcmVhdGU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWQ6IHNlc3Npb24udXNlci5pZCxcbiAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZCxcbiAgICAgICAgICAgICAgICBhY2NlcHRlZFJ1bGVzOiB0cnVlLFxuICAgICAgICAgICAgICAgIGlzRmluaXNoZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgZmluaXNoZWRBdDogbmV3IERhdGUoKVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV2YWxpZGF0ZVBhdGgoYC9jb250ZXN0LyR7Y29udGVzdElkfWApO1xuICAgICAgICByZXZhbGlkYXRlUGF0aChgL3Byb2JsZW1zYCk7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGZpbmlzaCBjb250ZXN0XCIgfTtcbiAgICB9XG59XG5cbi8qKlxuICogRmluYWxpemUgQ29udGVzdCAmIEF3YXJkIEJhZGdlc1xuICogLSBDYWxjdWxhdGVzIGxlYWRlcmJvYXJkXG4gKiAtIEF3YXJkcyBHb2xkLCBTaWx2ZXIsIEJyb256ZSB0byBUb3AgM1xuICogLSBNYXJrcyBjb250ZXN0IGFzIGZpbmFsaXplZFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZmluYWxpemVDb250ZXN0KGNvbnRlc3RJZDogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICBpZiAoIXNlc3Npb24/LnVzZXIpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuXG4gICAgLy8gT25seSBhZG1pbnMgb3IgY29udGVzdCBtYW5hZ2VycyBjYW4gZmluYWxpemVcbiAgICBjb25zdCBjdXJyZW50VXNlciA9IHNlc3Npb24udXNlciBhcyBhbnk7XG4gICAgaWYgKCFbXCJBRE1JTlwiLCBcIkNPTlRFU1RfTUFOQUdFUlwiLCBcIklOU1RJVFVUSU9OX01BTkFHRVJcIiwgXCJURUFDSEVSXCJdLmluY2x1ZGVzKGN1cnJlbnRVc2VyLnJvbGUpKSB7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRlc3QgPSBhd2FpdCBwcmlzbWEuY29udGVzdC5maW5kVW5pcXVlKHtcbiAgICAgICAgICAgICB3aGVyZTogeyBpZDogY29udGVzdElkIH0sXG4gICAgICAgICAgICAgc2VsZWN0OiB7IGlzRmluYWxpemVkOiB0cnVlLCB0aXRsZTogdHJ1ZSB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICghY29udGVzdCkgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkNvbnRlc3Qgbm90IGZvdW5kXCIgfTtcbiAgICAgICAgaWYgKGNvbnRlc3QuaXNGaW5hbGl6ZWQpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJDb250ZXN0IGlzIGFscmVhZHkgZmluYWxpemVkXCIgfTtcblxuICAgICAgICAvLyBSZXVzZSBsZWFkZXJib2FyZCBsb2dpYyB0byBnZXQgcmFua2luZ3NcbiAgICAgICAgY29uc3QgbGVhZGVyYm9hcmQgPSBhd2FpdCBnZXRDb250ZXN0TGVhZGVyYm9hcmQoY29udGVzdElkKTtcbiAgICAgICAgaWYgKCFsZWFkZXJib2FyZC5zdWNjZXNzIHx8ICFsZWFkZXJib2FyZC5zdHVkZW50cykge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBmZXRjaCBsZWFkZXJib2FyZFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBzdHVkZW50cyA9IGxlYWRlcmJvYXJkLnN0dWRlbnRzIGFzIGFueVtdO1xuXG4gICAgICAgIC8vIEF0IGxlYXN0IDEgc3R1ZGVudCBuZWVkZWRcbiAgICAgICAgaWYgKHN0dWRlbnRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgIGF3YWl0IHByaXNtYS5jb250ZXN0LnVwZGF0ZSh7XG4gICAgICAgICAgICAgICAgIHdoZXJlOiB7IGlkOiBjb250ZXN0SWQgfSxcbiAgICAgICAgICAgICAgICAgZGF0YTogeyBpc0ZpbmFsaXplZDogdHJ1ZSB9XG4gICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgbWVzc2FnZTogXCJDb250ZXN0IGZpbmFsaXplZCAobm8gcGFydGljaXBhbnRzKVwiIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBUb3AgMyBJRHNcbiAgICAgICAgY29uc3QgZ29sZFVzZXJJZCA9IHN0dWRlbnRzWzBdPy5pZDtcbiAgICAgICAgY29uc3Qgc2lsdmVyVXNlcklkID0gc3R1ZGVudHNbMV0/LmlkO1xuICAgICAgICBjb25zdCBicm9uemVVc2VySWQgPSBzdHVkZW50c1syXT8uaWQ7XG5cbiAgICAgICAgYXdhaXQgcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgICAgIC8vIEF3YXJkIEdvbGRcbiAgICAgICAgICAgIGlmIChnb2xkVXNlcklkKSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdHgudXNlci51cGRhdGUoe1xuICAgICAgICAgICAgICAgICAgICB3aGVyZTogeyBpZDogZ29sZFVzZXJJZCB9LFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7IGdvbGRCYWRnZXM6IHsgaW5jcmVtZW50OiAxIH0gfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gQXdhcmQgU2lsdmVyXG4gICAgICAgICAgICBpZiAoc2lsdmVyVXNlcklkKSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdHgudXNlci51cGRhdGUoe1xuICAgICAgICAgICAgICAgICAgICB3aGVyZTogeyBpZDogc2lsdmVyVXNlcklkIH0sXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IHsgc2lsdmVyQmFkZ2VzOiB7IGluY3JlbWVudDogMSB9IH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIEF3YXJkIEJyb256ZVxuICAgICAgICAgICAgaWYgKGJyb256ZVVzZXJJZCkge1xuICAgICAgICAgICAgICAgIGF3YWl0IHR4LnVzZXIudXBkYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IGJyb256ZVVzZXJJZCB9LFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7IGJyb256ZUJhZGdlczogeyBpbmNyZW1lbnQ6IDEgfSB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIE1hcmsgRmluYWxpemVkXG4gICAgICAgICAgICBhd2FpdCB0eC5jb250ZXN0LnVwZGF0ZSh7XG4gICAgICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IGNvbnRlc3RJZCB9LFxuICAgICAgICAgICAgICAgIGRhdGE6IHsgaXNGaW5hbGl6ZWQ6IHRydWUgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldmFsaWRhdGVQYXRoKGAvZGFzaGJvYXJkYCk7XG4gICAgICAgIHJldmFsaWRhdGVQYXRoKGAvcHJvZmlsZS8ke2dvbGRVc2VySWR9YCk7XG4gICAgICAgIGlmKHNpbHZlclVzZXJJZCkgcmV2YWxpZGF0ZVBhdGgoYC9wcm9maWxlLyR7c2lsdmVyVXNlcklkfWApO1xuICAgICAgICBpZihicm9uemVVc2VySWQpIHJldmFsaWRhdGVQYXRoKGAvcHJvZmlsZS8ke2Jyb256ZVVzZXJJZH1gKTtcbiAgICAgICAgcmV2YWxpZGF0ZVBhdGgoYC9jb250ZXN0LyR7Y29udGVzdElkfWApO1xuICAgICAgICByZXZhbGlkYXRlVGFnKGBjb250ZXN0LSR7Y29udGVzdElkfWAsIFwibWF4XCIpO1xuICAgICAgICByZXZhbGlkYXRlVGFnKGBsZWFkZXJib2FyZC0ke2NvbnRlc3RJZH1gLCBcIm1heFwiKTtcblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBmaW5hbGl6ZSBjb250ZXN0OlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZmluYWxpemUgY29udGVzdFwiIH07XG4gICAgfVxufVxuXG4vKipcbiAqIFZlcmlmeSBjb250ZXN0IHBhc3N3b3JkIHdpdGhvdXQgc3RhcnRpbmcgc2Vzc2lvbi5cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHZlcmlmeUNvbnRlc3RQYXNzd29yZChjb250ZXN0SWQ6IHN0cmluZywgcGFzc3dvcmQ/OiBzdHJpbmcpIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIGlmICghc2Vzc2lvbj8udXNlcikgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjb250ZXN0ID0gYXdhaXQgcHJpc21hLmNvbnRlc3QuZmluZFVuaXF1ZSh7XG4gICAgICAgICAgICB3aGVyZTogeyBpZDogY29udGVzdElkIH0sXG4gICAgICAgICAgICBzZWxlY3Q6IHsgY29udGVzdFBhc3N3b3JkOiB0cnVlIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKCFjb250ZXN0KSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiQ29udGVzdCBub3QgZm91bmRcIiB9O1xuXG4gICAgICAgIGlmIChjb250ZXN0LmNvbnRlc3RQYXNzd29yZCAmJiBjb250ZXN0LmNvbnRlc3RQYXNzd29yZCAhPT0gcGFzc3dvcmQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJJbnZhbGlkIGNvbnRlc3QgcGFzc3dvcmRcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gdmVyaWZ5IGNvbnRlc3QgcGFzc3dvcmQ6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byB2ZXJpZnkgcGFzc3dvcmRcIiB9O1xuICAgIH1cbn1cblxuXG4vKipcbiAqIFN0YXJ0IGEgY29udGVzdCBzZXNzaW9uIC0gdmFsaWRhdGVzIHRpbWUgYm91bmRzIGFuZCBjcmVhdGVzIHNlc3Npb24gSURcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHN0YXJ0Q29udGVzdFNlc3Npb24oY29udGVzdElkOiBzdHJpbmcsIHBhc3N3b3JkPzogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICBpZiAoIXNlc3Npb24/LnVzZXIpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgY29udGVzdCA9IGF3YWl0IHByaXNtYS5jb250ZXN0LmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IGNvbnRlc3RJZCB9LFxuICAgICAgICAgICAgc2VsZWN0OiB7IHN0YXJ0VGltZTogdHJ1ZSwgZW5kVGltZTogdHJ1ZSwgY29udGVzdFBhc3N3b3JkOiB0cnVlIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKCFjb250ZXN0KSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiQ29udGVzdCBub3QgZm91bmRcIiB9O1xuXG4gICAgICAgIGlmIChjb250ZXN0LmNvbnRlc3RQYXNzd29yZCAmJiBjb250ZXN0LmNvbnRlc3RQYXNzd29yZCAhPT0gcGFzc3dvcmQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJJbnZhbGlkIGNvbnRlc3QgcGFzc3dvcmRcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcblxuICAgICAgICAvLyBUaW1lIGJvdW5kcyBjaGVja1xuICAgICAgICBpZiAobm93IDwgY29udGVzdC5zdGFydFRpbWUpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJDb250ZXN0IGhhcyBub3Qgc3RhcnRlZCB5ZXRcIiB9O1xuICAgICAgICB9XG4gICAgICAgIGlmIChub3cgPiBjb250ZXN0LmVuZFRpbWUpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJDb250ZXN0IGhhcyBhbHJlYWR5IGVuZGVkXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEdlbmVyYXRlIHVuaXF1ZSBzZXNzaW9uIElEXG4gICAgICAgIGNvbnN0IHNlc3Npb25JZCA9IGAke3Nlc3Npb24udXNlci5pZH0tJHtjb250ZXN0SWR9LSR7RGF0ZS5ub3coKX1gO1xuXG4gICAgICAgIC8vIENoZWNrIGZvciBleGlzdGluZyBhY3RpdmUgc2Vzc2lvbiAobXVsdGktdGFiIGRldGVjdGlvbilcbiAgICAgICAgY29uc3QgZXhpc3RpbmdQYXJ0aWNpcGF0aW9uID0gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKGV4aXN0aW5nUGFydGljaXBhdGlvbj8uaXNCbG9ja2VkKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiWW91IGhhdmUgYmVlbiBibG9ja2VkIGZyb20gdGhpcyBjb250ZXN0IGR1ZSB0byB2aW9sYXRpb25zXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChleGlzdGluZ1BhcnRpY2lwYXRpb24/LmlzRmluaXNoZWQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJZb3UgaGF2ZSBhbHJlYWR5IGZpbmlzaGVkIHRoaXMgY29udGVzdFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBVcGRhdGUgb3IgY3JlYXRlIHBhcnRpY2lwYXRpb24gd2l0aCBuZXcgc2Vzc2lvblxuICAgICAgICBjb25zdCBwYXJ0aWNpcGF0aW9uID0gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLnVwc2VydCh7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgIHVzZXJJZF9jb250ZXN0SWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkOiBzZXNzaW9uLnVzZXIuaWQsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlc3RJZDogY29udGVzdElkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHVwZGF0ZToge1xuICAgICAgICAgICAgICAgIHNlc3Npb25JZCxcbiAgICAgICAgICAgICAgICBzZXNzaW9uU3RhcnRlZEF0OiBub3csXG4gICAgICAgICAgICAgICAgYWNjZXB0ZWRSdWxlczogdHJ1ZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNyZWF0ZToge1xuICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgIGNvbnRlc3RJZDogY29udGVzdElkLFxuICAgICAgICAgICAgICAgIHNlc3Npb25JZCxcbiAgICAgICAgICAgICAgICBzZXNzaW9uU3RhcnRlZEF0OiBub3csXG4gICAgICAgICAgICAgICAgYWNjZXB0ZWRSdWxlczogdHJ1ZVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgIHNlc3Npb25JZCxcbiAgICAgICAgICAgIHBhcnRpY2lwYXRpb25JZDogcGFydGljaXBhdGlvbi5pZCxcbiAgICAgICAgICAgIHRvdGFsVmlvbGF0aW9uczogcGFydGljaXBhdGlvbi50b3RhbFZpb2xhdGlvbnMsXG4gICAgICAgICAgICBpc0ZsYWdnZWQ6IHBhcnRpY2lwYXRpb24uaXNGbGFnZ2VkXG4gICAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBzdGFydCBjb250ZXN0IHNlc3Npb246XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBzdGFydCBjb250ZXN0IHNlc3Npb25cIiB9O1xuICAgIH1cbn1cblxuLyoqXG4gKiBMb2cgYSBjb250ZXN0IHZpb2xhdGlvbiAtIHJlY29yZHMgdG8gZGF0YWJhc2UgYW5kIHVwZGF0ZXMgY291bnRlcnNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxvZ0NvbnRlc3RWaW9sYXRpb24oXG4gICAgY29udGVzdElkOiBzdHJpbmcsXG4gICAgdHlwZTogXCJUQUJfU1dJVENIXCIgfCBcIkZVTExTQ1JFRU5fRVhJVFwiIHwgXCJDT1BZX1BBU1RFXCIgfCBcIkRFVlRPT0xTX09QRU5cIiB8IFwiS0VZQk9BUkRfU0hPUlRDVVRcIiB8IFwiTkFWSUdBVElPTl9BVFRFTVBUXCIgfCBcIk1VTFRJX1RBQlwiIHwgXCJTVVNQSUNJT1VTX0lOUFVUXCIsXG4gICAgbWVzc2FnZT86IHN0cmluZyxcbiAgICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT5cbikge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcblxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHBhcnRpY2lwYXRpb24gPSBhd2FpdCBwcmlzbWEuY29udGVzdFBhcnRpY2lwYXRpb24uZmluZFVuaXF1ZSh7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgIHVzZXJJZF9jb250ZXN0SWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkOiBzZXNzaW9uLnVzZXIuaWQsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlc3RJZDogY29udGVzdElkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoIXBhcnRpY2lwYXRpb24pIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJObyBhY3RpdmUgcGFydGljaXBhdGlvbiBmb3VuZFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBEZXRlcm1pbmUgd2hpY2ggY291bnRlciB0byBpbmNyZW1lbnRcbiAgICAgICAgY29uc3QgY291bnRlckZpZWxkID0ge1xuICAgICAgICAgICAgVEFCX1NXSVRDSDogXCJ0YWJTd2l0Y2hDb3VudFwiLFxuICAgICAgICAgICAgRlVMTFNDUkVFTl9FWElUOiBcImZ1bGxzY3JlZW5FeGl0Q291bnRcIixcbiAgICAgICAgICAgIENPUFlfUEFTVEU6IFwiY29weVBhc3RlQ291bnRcIixcbiAgICAgICAgICAgIERFVlRPT0xTX09QRU46IFwiZGV2VG9vbHNDb3VudFwiLFxuICAgICAgICAgICAgS0VZQk9BUkRfU0hPUlRDVVQ6IFwia2V5Ym9hcmRDb3VudFwiLFxuICAgICAgICAgICAgTkFWSUdBVElPTl9BVFRFTVBUOiBcIm5hdmlnYXRpb25Db3VudFwiLFxuICAgICAgICAgICAgTVVMVElfVEFCOiBcInRhYlN3aXRjaENvdW50XCIsXG4gICAgICAgICAgICBTVVNQSUNJT1VTX0lOUFVUOiBcImNvcHlQYXN0ZUNvdW50XCJcbiAgICAgICAgfVt0eXBlXSBhcyBzdHJpbmc7XG5cbiAgICAgICAgLy8gVXNlIHRyYW5zYWN0aW9uIHRvIGVuc3VyZSBhdG9taWMgdXBkYXRlXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHByaXNtYS4kdHJhbnNhY3Rpb24oYXN5bmMgKHR4KSA9PiB7XG4gICAgICAgICAgICAvLyBDaGVjayBsYXN0IHZpb2xhdGlvbiB0aW1lIHRvIHByZXZlbnQgcmFwaWQtZmlyZSBkdXBsaWNhdGVzIChTZXJ2ZXItc2lkZSBkZWJvdW5jZSlcbiAgICAgICAgICAgIGNvbnN0IGxhc3RWaW9sYXRpb24gPSBhd2FpdCB0eC5jb250ZXN0VmlvbGF0aW9uLmZpbmRGaXJzdCh7XG4gICAgICAgICAgICAgICAgd2hlcmU6IHsgcGFydGljaXBhdGlvbklkOiBwYXJ0aWNpcGF0aW9uLmlkIH0sXG4gICAgICAgICAgICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6ICdkZXNjJyB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKGxhc3RWaW9sYXRpb24pIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0aW1lRGlmZiA9IERhdGUubm93KCkgLSBsYXN0VmlvbGF0aW9uLmNyZWF0ZWRBdC5nZXRUaW1lKCk7XG4gICAgICAgICAgICAgICAgLy8gSWYgbGVzcyB0aGFuIDIgc2Vjb25kcyBzaW5jZSBsYXN0IHZpb2xhdGlvbiwgaWdub3JlIHRoaXMgb25lXG4gICAgICAgICAgICAgICAgaWYgKHRpbWVEaWZmIDwgMjAwMCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgLi4ucGFydGljaXBhdGlvbiwgLy8gUmV0dXJuIGV4aXN0aW5nIHN0YXRlXG4gICAgICAgICAgICAgICAgICAgICAgICBpc0ZsYWdnZWQ6IHBhcnRpY2lwYXRpb24uaXNGbGFnZ2VkLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNCbG9ja2VkOiBwYXJ0aWNpcGF0aW9uLmlzQmxvY2tlZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsVmlvbGF0aW9uczogcGFydGljaXBhdGlvbi50b3RhbFZpb2xhdGlvbnMsXG4gICAgICAgICAgICAgICAgICAgICAgICBwZXJtYW5lbnRseUJsb2NrZWQ6IHBhcnRpY2lwYXRpb24ucGVybWFuZW50bHlCbG9ja2VkLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcEJsb2NrZWRVbnRpbDogcGFydGljaXBhdGlvbi50ZW1wQmxvY2tlZFVudGlsXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBDcmVhdGUgdmlvbGF0aW9uIHJlY29yZFxuICAgICAgICAgICAgYXdhaXQgdHguY29udGVzdFZpb2xhdGlvbi5jcmVhdGUoe1xuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgcGFydGljaXBhdGlvbklkOiBwYXJ0aWNpcGF0aW9uLmlkLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiB0eXBlIGFzIGFueSxcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZSxcbiAgICAgICAgICAgICAgICAgICAgbWV0YWRhdGE6IG1ldGFkYXRhID8/IHVuZGVmaW5lZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBDYWxjdWxhdGUgbmV3IHRvdGFsIGFuZCBkZXRlcm1pbmUgYmxvY2tpbmcgdGllclxuICAgICAgICAgICAgY29uc3QgbmV3VG90YWxWaW9sYXRpb25zID0gcGFydGljaXBhdGlvbi50b3RhbFZpb2xhdGlvbnMgKyAxO1xuICAgICAgICAgICAgY29uc3Qgc2hvdWxkRmxhZyA9IG5ld1RvdGFsVmlvbGF0aW9ucyA+PSAzO1xuXG4gICAgICAgICAgICAvLyBUaWVyZWQgYmxvY2tpbmcgbG9naWNcbiAgICAgICAgICAgIGxldCB0ZW1wQmxvY2tlZFVudGlsOiBEYXRlIHwgbnVsbCA9IG51bGw7XG4gICAgICAgICAgICBsZXQgcGVybWFuZW50bHlCbG9ja2VkID0gZmFsc2U7XG4gICAgICAgICAgICBsZXQgaXNCbG9ja2VkID0gZmFsc2U7XG5cbiAgICAgICAgICAgIGlmIChuZXdUb3RhbFZpb2xhdGlvbnMgPj0gNikge1xuICAgICAgICAgICAgICAgIC8vIDYrIHZpb2xhdGlvbnMgPSBwZXJtYW5lbnQgYmxvY2tcbiAgICAgICAgICAgICAgICBwZXJtYW5lbnRseUJsb2NrZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGlzQmxvY2tlZCA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKG5ld1RvdGFsVmlvbGF0aW9ucyA+PSA0KSB7XG4gICAgICAgICAgICAgICAgLy8gNC01IHZpb2xhdGlvbnMgPSA1IG1pbnV0ZSB0ZW1wIGJsb2NrXG4gICAgICAgICAgICAgICAgdGVtcEJsb2NrZWRVbnRpbCA9IG5ldyBEYXRlKERhdGUubm93KCkgKyA1ICogNjAgKiAxMDAwKTsgLy8gNSBtaW51dGVzXG4gICAgICAgICAgICAgICAgaXNCbG9ja2VkID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgdXBkYXRlZCA9IGF3YWl0IHR4LmNvbnRlc3RQYXJ0aWNpcGF0aW9uLnVwZGF0ZSh7XG4gICAgICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IHBhcnRpY2lwYXRpb24uaWQgfSxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIFtjb3VudGVyRmllbGRdOiB7IGluY3JlbWVudDogMSB9LFxuICAgICAgICAgICAgICAgICAgICB0b3RhbFZpb2xhdGlvbnM6IHsgaW5jcmVtZW50OiAxIH0sXG4gICAgICAgICAgICAgICAgICAgIGlzRmxhZ2dlZDogc2hvdWxkRmxhZyB8fCBwYXJ0aWNpcGF0aW9uLmlzRmxhZ2dlZCxcbiAgICAgICAgICAgICAgICAgICAgaXNCbG9ja2VkLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wQmxvY2tlZFVudGlsLFxuICAgICAgICAgICAgICAgICAgICBwZXJtYW5lbnRseUJsb2NrZWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHVwZGF0ZWQ7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgdG90YWxWaW9sYXRpb25zOiByZXN1bHQudG90YWxWaW9sYXRpb25zLFxuICAgICAgICAgICAgaXNGbGFnZ2VkOiByZXN1bHQuaXNGbGFnZ2VkLFxuICAgICAgICAgICAgaXNCbG9ja2VkOiByZXN1bHQuaXNCbG9ja2VkLFxuICAgICAgICAgICAgdGVtcEJsb2NrZWRVbnRpbDogcmVzdWx0LnRlbXBCbG9ja2VkVW50aWw/LnRvSVNPU3RyaW5nKCkgfHwgbnVsbCxcbiAgICAgICAgICAgIHBlcm1hbmVudGx5QmxvY2tlZDogcmVzdWx0LnBlcm1hbmVudGx5QmxvY2tlZFxuICAgICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gbG9nIHZpb2xhdGlvbjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGxvZyB2aW9sYXRpb25cIiB9O1xuICAgIH1cbn1cblxuLyoqXG4gKiBWYWxpZGF0ZSBjb250ZXN0IHNlc3Npb24gLSBjaGVja3MgaWYgc2Vzc2lvbiBpcyB2YWxpZCBmb3Igc3VibWlzc2lvbnNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHZhbGlkYXRlQ29udGVzdFNlc3Npb24oY29udGVzdElkOiBzdHJpbmcsIHNlc3Npb25JZDogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICBpZiAoIXNlc3Npb24/LnVzZXIpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCB2YWxpZDogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBwYXJ0aWNpcGF0aW9uID0gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgY29udGVzdDoge1xuICAgICAgICAgICAgICAgICAgICBzZWxlY3Q6IHsgc3RhcnRUaW1lOiB0cnVlLCBlbmRUaW1lOiB0cnVlIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICghcGFydGljaXBhdGlvbikge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgdmFsaWQ6IGZhbHNlLCByZWFzb246IFwiTm8gcGFydGljaXBhdGlvbiBmb3VuZFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDaGVjayBpZiBibG9ja2VkXG4gICAgICAgIGlmIChwYXJ0aWNpcGF0aW9uLmlzQmxvY2tlZCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgdmFsaWQ6IGZhbHNlLCByZWFzb246IFwiQmxvY2tlZCBkdWUgdG8gdmlvbGF0aW9uc1wiIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDaGVjayBpZiBmaW5pc2hlZFxuICAgICAgICBpZiAocGFydGljaXBhdGlvbi5pc0ZpbmlzaGVkKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCB2YWxpZDogZmFsc2UsIHJlYXNvbjogXCJDb250ZXN0IGFscmVhZHkgZmluaXNoZWRcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ2hlY2sgc2Vzc2lvbiBJRCAobXVsdGktdGFiIGRldGVjdGlvbilcbiAgICAgICAgaWYgKHBhcnRpY2lwYXRpb24uc2Vzc2lvbklkICE9PSBzZXNzaW9uSWQpIHtcbiAgICAgICAgICAgIC8vIExvZyBtdWx0aS10YWIgdmlvbGF0aW9uXG4gICAgICAgICAgICBhd2FpdCBsb2dDb250ZXN0VmlvbGF0aW9uKGNvbnRlc3RJZCwgXCJNVUxUSV9UQUJcIiwgXCJNdWx0aXBsZSB0YWJzIGRldGVjdGVkXCIpO1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgdmFsaWQ6IGZhbHNlLCByZWFzb246IFwiU2Vzc2lvbiBtaXNtYXRjaCAtIHBvc3NpYmxlIG11bHRpcGxlIHRhYnNcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ2hlY2sgdGltZSBib3VuZHNcbiAgICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgICAgICAgaWYgKG5vdyA+IHBhcnRpY2lwYXRpb24uY29udGVzdC5lbmRUaW1lKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCB2YWxpZDogZmFsc2UsIHJlYXNvbjogXCJDb250ZXN0IGhhcyBlbmRlZFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgIHZhbGlkOiB0cnVlLFxuICAgICAgICAgICAgdG90YWxWaW9sYXRpb25zOiBwYXJ0aWNpcGF0aW9uLnRvdGFsVmlvbGF0aW9ucyxcbiAgICAgICAgICAgIGlzRmxhZ2dlZDogcGFydGljaXBhdGlvbi5pc0ZsYWdnZWRcbiAgICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIHZhbGlkYXRlIHNlc3Npb246XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIHZhbGlkOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIHZhbGlkYXRlIHNlc3Npb25cIiB9O1xuICAgIH1cbn1cblxuLyoqXG4gKiBDaGVjayBpZiB1c2VyIGlzIGVsaWdpYmxlIHRvIHN1Ym1pdCAtIHByZS1zdWJtaXNzaW9uIHZhbGlkYXRpb25cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNoZWNrU3VibWlzc2lvbkVsaWdpYmlsaXR5KGNvbnRlc3RJZDogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICBpZiAoIXNlc3Npb24/LnVzZXIpIHJldHVybiB7IGVsaWdpYmxlOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcblxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHBhcnRpY2lwYXRpb24gPSBhd2FpdCBwcmlzbWEuY29udGVzdFBhcnRpY2lwYXRpb24uZmluZFVuaXF1ZSh7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgIHVzZXJJZF9jb250ZXN0SWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkOiBzZXNzaW9uLnVzZXIuaWQsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlc3RJZDogY29udGVzdElkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICBjb250ZXN0OiB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdDogeyBzdGFydFRpbWU6IHRydWUsIGVuZFRpbWU6IHRydWUgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKCFwYXJ0aWNpcGF0aW9uKSB7XG4gICAgICAgICAgICByZXR1cm4geyBlbGlnaWJsZTogZmFsc2UsIHJlYXNvbjogXCJObyBwYXJ0aWNpcGF0aW9uIGZvdW5kXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENoZWNrIHZhcmlvdXMgY29uZGl0aW9uc1xuICAgICAgICBpZiAocGFydGljaXBhdGlvbi5pc0Jsb2NrZWQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IGVsaWdpYmxlOiBmYWxzZSwgcmVhc29uOiBcIkJsb2NrZWQgZHVlIHRvIGV4Y2Vzc2l2ZSB2aW9sYXRpb25zXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChwYXJ0aWNpcGF0aW9uLmlzRmluaXNoZWQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IGVsaWdpYmxlOiBmYWxzZSwgcmVhc29uOiBcIllvdSBoYXZlIGFscmVhZHkgZmluaXNoZWQgdGhpcyBjb250ZXN0XCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgICAgIGlmIChub3cgPCBwYXJ0aWNpcGF0aW9uLmNvbnRlc3Quc3RhcnRUaW1lKSB7XG4gICAgICAgICAgICByZXR1cm4geyBlbGlnaWJsZTogZmFsc2UsIHJlYXNvbjogXCJDb250ZXN0IGhhcyBub3Qgc3RhcnRlZFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobm93ID4gcGFydGljaXBhdGlvbi5jb250ZXN0LmVuZFRpbWUpIHtcbiAgICAgICAgICAgIHJldHVybiB7IGVsaWdpYmxlOiBmYWxzZSwgcmVhc29uOiBcIkNvbnRlc3QgaGFzIGVuZGVkXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBlbGlnaWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHdhcm5pbmdzOiBwYXJ0aWNpcGF0aW9uLmlzRmxhZ2dlZCA/IFtcIllvdXIgc2Vzc2lvbiBoYXMgYmVlbiBmbGFnZ2VkIGZvciByZXZpZXdcIl0gOiBbXVxuICAgICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gY2hlY2sgZWxpZ2liaWxpdHk6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgZWxpZ2libGU6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gY2hlY2sgZWxpZ2liaWxpdHlcIiB9O1xuICAgIH1cbn1cblxuLyoqXG4gKiBHZXQgcGFydGljaXBhdGlvbiBzdGF0dXMgLSBmb3IgVUkgc3RhdGVcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFBhcnRpY2lwYXRpb25TdGF0dXMoY29udGVzdElkOiBzdHJpbmcpIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIGlmICghc2Vzc2lvbj8udXNlcikgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBwYXJ0aWNpcGF0aW9uID0gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgICBhY2NlcHRlZFJ1bGVzOiB0cnVlLFxuICAgICAgICAgICAgICAgIGlzRmluaXNoZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgaXNGbGFnZ2VkOiB0cnVlLFxuICAgICAgICAgICAgICAgIGlzQmxvY2tlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICB0b3RhbFZpb2xhdGlvbnM6IHRydWUsXG4gICAgICAgICAgICAgICAgc2Vzc2lvbklkOiB0cnVlLFxuICAgICAgICAgICAgICAgIHRlbXBCbG9ja2VkVW50aWw6IHRydWUsXG4gICAgICAgICAgICAgICAgcGVybWFuZW50bHlCbG9ja2VkOiB0cnVlXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIENoZWNrIGlmIHRlbXAgYmxvY2sgaGFzIGV4cGlyZWRcbiAgICAgICAgaWYgKHBhcnRpY2lwYXRpb24/LnRlbXBCbG9ja2VkVW50aWwgJiYgbmV3IERhdGUoKSA+IHBhcnRpY2lwYXRpb24udGVtcEJsb2NrZWRVbnRpbCkge1xuICAgICAgICAgICAgLy8gVGVtcCBibG9jayBleHBpcmVkIC0gdW5ibG9ja1xuICAgICAgICAgICAgYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLnVwZGF0ZSh7XG4gICAgICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkX2NvbnRlc3RJZDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgdXNlcklkOiBzZXNzaW9uLnVzZXIuaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIGlzQmxvY2tlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBCbG9ja2VkVW50aWw6IG51bGxcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgICAgIHBhcnRpY2lwYXRpb246IHtcbiAgICAgICAgICAgICAgICAgICAgLi4ucGFydGljaXBhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgaXNCbG9ja2VkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgdGVtcEJsb2NrZWRVbnRpbDogbnVsbFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgIHBhcnRpY2lwYXRpb246IHBhcnRpY2lwYXRpb24gfHwgbnVsbFxuICAgICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZ2V0IHBhcnRpY2lwYXRpb24gc3RhdHVzXCIgfTtcbiAgICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBDT05URVNUIE1BTkFHRVIgLSBQQVJUSUNJUEFOVCBNQU5BR0VNRU5UXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqIEdldCBhbGwgcGFydGljaXBhbnRzIGZvciBhIGNvbnRlc3Qgd2l0aCB2aW9sYXRpb24gZGV0YWlscyAoZm9yIG1hbmFnZXJzKVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q29udGVzdFBhcnRpY2lwYW50cyhjb250ZXN0SWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcblxuICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gc2Vzc2lvbi51c2VyIGFzIGFueTtcblxuICAgIC8vIENoZWNrIGlmIHVzZXIgaXMgY29udGVzdCBtYW5hZ2VyL2NyZWF0b3JcbiAgICBjb25zdCBjb250ZXN0ID0gYXdhaXQgcHJpc21hLmNvbnRlc3QuZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiBjb250ZXN0SWQgfSxcbiAgICAgICAgc2VsZWN0OiB7IGNyZWF0b3JJZDogdHJ1ZSB9XG4gICAgfSk7XG5cbiAgICBpZiAoIWNvbnRlc3QpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJDb250ZXN0IG5vdCBmb3VuZFwiIH07XG5cbiAgICBjb25zdCBpc0F1dGhvcml6ZWQgPVxuICAgICAgICBjdXJyZW50VXNlci5yb2xlID09PSBcIkFETUlOXCIgfHxcbiAgICAgICAgY3VycmVudFVzZXIucm9sZSA9PT0gXCJDT05URVNUX01BTkFHRVJcIiB8fFxuICAgICAgICBjdXJyZW50VXNlci5yb2xlID09PSBcIlRFQUNIRVJcIiB8fFxuICAgICAgICBjb250ZXN0LmNyZWF0b3JJZCA9PT0gY3VycmVudFVzZXIuaWQ7XG5cbiAgICBpZiAoIWlzQXV0aG9yaXplZCkge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBwYXJ0aWNpcGFudHMgPSBhd2FpdCBwcmlzbWEuY29udGVzdFBhcnRpY2lwYXRpb24uZmluZE1hbnkoe1xuICAgICAgICAgICAgd2hlcmU6IHsgY29udGVzdElkIH0sXG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVtYWlsOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgaW1hZ2U6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgdmlvbGF0aW9uczoge1xuICAgICAgICAgICAgICAgICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogXCJkZXNjXCIgfSxcbiAgICAgICAgICAgICAgICAgICAgdGFrZTogMTBcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb3JkZXJCeTogW1xuICAgICAgICAgICAgICAgIHsgcGVybWFuZW50bHlCbG9ja2VkOiBcImRlc2NcIiB9LFxuICAgICAgICAgICAgICAgIHsgaXNCbG9ja2VkOiBcImRlc2NcIiB9LFxuICAgICAgICAgICAgICAgIHsgdG90YWxWaW9sYXRpb25zOiBcImRlc2NcIiB9XG4gICAgICAgICAgICBdXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHBhcnRpY2lwYW50cyB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gZ2V0IHBhcnRpY2lwYW50czpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGdldCBwYXJ0aWNpcGFudHNcIiB9O1xuICAgIH1cbn1cblxuLyoqXG4gKiBVbmJsb2NrIGEgcGFydGljaXBhbnQgKG1hbmFnZXIgb25seSlcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVuYmxvY2tQYXJ0aWNpcGFudChjb250ZXN0SWQ6IHN0cmluZywgdXNlcklkOiBzdHJpbmcpIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIGlmICghc2Vzc2lvbj8udXNlcikgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG5cbiAgICBjb25zdCBjdXJyZW50VXNlciA9IHNlc3Npb24udXNlciBhcyBhbnk7XG5cbiAgICAvLyBDaGVjayBhdXRob3JpemF0aW9uXG4gICAgY29uc3QgY29udGVzdCA9IGF3YWl0IHByaXNtYS5jb250ZXN0LmZpbmRVbmlxdWUoe1xuICAgICAgICB3aGVyZTogeyBpZDogY29udGVzdElkIH0sXG4gICAgICAgIHNlbGVjdDogeyBjcmVhdG9ySWQ6IHRydWUgfVxuICAgIH0pO1xuXG4gICAgaWYgKCFjb250ZXN0KSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiQ29udGVzdCBub3QgZm91bmRcIiB9O1xuXG4gICAgY29uc3QgaXNBdXRob3JpemVkID1cbiAgICAgICAgY3VycmVudFVzZXIucm9sZSA9PT0gXCJBRE1JTlwiIHx8XG4gICAgICAgIGN1cnJlbnRVc2VyLnJvbGUgPT09IFwiQ09OVEVTVF9NQU5BR0VSXCIgfHxcbiAgICAgICAgY3VycmVudFVzZXIucm9sZSA9PT0gXCJURUFDSEVSXCIgfHxcbiAgICAgICAgY29udGVzdC5jcmVhdG9ySWQgPT09IGN1cnJlbnRVc2VyLmlkO1xuXG4gICAgaWYgKCFpc0F1dGhvcml6ZWQpIHtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLnVwZGF0ZSh7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgIHVzZXJJZF9jb250ZXN0SWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgIGlzQmxvY2tlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgdGVtcEJsb2NrZWRVbnRpbDogbnVsbCxcbiAgICAgICAgICAgICAgICBwZXJtYW5lbnRseUJsb2NrZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHRvdGFsVmlvbGF0aW9uczogMCxcbiAgICAgICAgICAgICAgICB0YWJTd2l0Y2hDb3VudDogMCxcbiAgICAgICAgICAgICAgICBmdWxsc2NyZWVuRXhpdENvdW50OiAwLFxuICAgICAgICAgICAgICAgIGNvcHlQYXN0ZUNvdW50OiAwLFxuICAgICAgICAgICAgICAgIGRldlRvb2xzQ291bnQ6IDAsXG4gICAgICAgICAgICAgICAga2V5Ym9hcmRDb3VudDogMCxcbiAgICAgICAgICAgICAgICBuYXZpZ2F0aW9uQ291bnQ6IDAsXG4gICAgICAgICAgICAgICAgaXNGbGFnZ2VkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICB1bmJsb2NrZWRCeTogY3VycmVudFVzZXIuaWQsXG4gICAgICAgICAgICAgICAgdW5ibG9ja2VkQXQ6IG5ldyBEYXRlKClcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV2YWxpZGF0ZVBhdGgoYC9kYXNoYm9hcmQvY29udGVzdHMvJHtjb250ZXN0SWR9L3BhcnRpY2lwYW50c2ApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byB1bmJsb2NrIHBhcnRpY2lwYW50OlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gdW5ibG9jayBwYXJ0aWNpcGFudFwiIH07XG4gICAgfVxufVxuXG4vKipcbiAqIEdldCBkZXRhaWxlZCB2aW9sYXRpb25zIGZvciBhIHBhcnRpY2lwYW50XG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRQYXJ0aWNpcGFudFZpb2xhdGlvbnMoY29udGVzdElkOiBzdHJpbmcsIHVzZXJJZDogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICBpZiAoIXNlc3Npb24/LnVzZXIpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuXG4gICAgY29uc3QgY3VycmVudFVzZXIgPSBzZXNzaW9uLnVzZXIgYXMgYW55O1xuXG4gICAgLy8gQ2hlY2sgYXV0aG9yaXphdGlvblxuICAgIGNvbnN0IGNvbnRlc3QgPSBhd2FpdCBwcmlzbWEuY29udGVzdC5maW5kVW5pcXVlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6IGNvbnRlc3RJZCB9LFxuICAgICAgICBzZWxlY3Q6IHsgY3JlYXRvcklkOiB0cnVlIH1cbiAgICB9KTtcblxuICAgIGlmICghY29udGVzdCkgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkNvbnRlc3Qgbm90IGZvdW5kXCIgfTtcblxuICAgIGNvbnN0IGlzQXV0aG9yaXplZCA9XG4gICAgICAgIGN1cnJlbnRVc2VyLnJvbGUgPT09IFwiQURNSU5cIiB8fFxuICAgICAgICBjdXJyZW50VXNlci5yb2xlID09PSBcIkNPTlRFU1RfTUFOQUdFUlwiIHx8XG4gICAgICAgIGN1cnJlbnRVc2VyLnJvbGUgPT09IFwiVEVBQ0hFUlwiIHx8XG4gICAgICAgIGNvbnRlc3QuY3JlYXRvcklkID09PSBjdXJyZW50VXNlci5pZDtcblxuICAgIGlmICghaXNBdXRob3JpemVkKSB7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHBhcnRpY2lwYXRpb24gPSBhd2FpdCBwcmlzbWEuY29udGVzdFBhcnRpY2lwYXRpb24uZmluZFVuaXF1ZSh7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgIHVzZXJJZF9jb250ZXN0SWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0OiB7IGlkOiB0cnVlLCBuYW1lOiB0cnVlLCBlbWFpbDogdHJ1ZSB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB2aW9sYXRpb25zOiB7XG4gICAgICAgICAgICAgICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiBcImRlc2NcIiB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBwYXJ0aWNpcGF0aW9uIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBnZXQgdmlvbGF0aW9uc1wiIH07XG4gICAgfVxufVxuXG4vKipcbiAqIENhbGN1bGF0ZSBjb250ZXN0IGxlYWRlcmJvYXJkXG4gKiAtIEZldGNoZXMgYWxsIHBhcnRpY2lwYXRpb25zXG4gKiAtIEZldGNoZXMgYWxsIHJlbGV2YW50IHN1Ym1pc3Npb25zXG4gKiAtIENhbGN1bGF0ZXMgc2NvcmVzXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRDb250ZXN0TGVhZGVyYm9hcmQoY29udGVzdElkOiBzdHJpbmcpIHtcbiAgICBcInVzZSBjYWNoZVwiXG4gICAgY2FjaGVUYWcoYGxlYWRlcmJvYXJkLSR7Y29udGVzdElkfWApXG4gICAgY2FjaGVMaWZlKFwibGVhZGVyYm9hcmRcIilcblxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHBhcnRpY2lwYXRpb25zID0gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLmZpbmRNYW55KHtcbiAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgY29udGVzdElkLFxuICAgICAgICAgICAgICAgIC8vIHN0YXJ0ZWRBdDogeyBub3Q6IG51bGwgfSAvLyBPbmx5IHN0YXJ0ZWQgcGFydGljaXBhbnRzIChGaXggaWYgZmllbGQgZXhpc3RzLCBvdGhlcndpc2UgcmVseSBvbiBjcmVhdGVkKVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgaW1hZ2U6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgY29udGVzdCA9IGF3YWl0IHByaXNtYS5jb250ZXN0LmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IGNvbnRlc3RJZCB9LFxuICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgIHByb2JsZW1zOiB7XG4gICAgICAgICAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2JsZW06IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaWZmaWN1bHR5OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbHVnOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29yZTogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgb3JkZXJCeTogeyBvcmRlcjogXCJhc2NcIiB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoIWNvbnRlc3QpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJDb250ZXN0IG5vdCBmb3VuZFwiIH07XG5cbiAgICAgICAgY29uc3QgbGVhZGVyYm9hcmQgPSBhd2FpdCBQcm9taXNlLmFsbChwYXJ0aWNpcGF0aW9ucy5tYXAoYXN5bmMgKHApID0+IHtcbiAgICAgICAgICAgIC8vIEdldCB2YWxpZCBzdWJtaXNzaW9ucyBmb3IgdGhpcyB1c2VyIGluIHRoaXMgY29udGVzdFxuICAgICAgICAgICAgY29uc3Qgc3VibWlzc2lvbnMgPSBhd2FpdCBwcmlzbWEuc3VibWlzc2lvbi5maW5kTWFueSh7XG4gICAgICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkOiBwLnVzZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgY29udGVzdElkOiBjb250ZXN0SWQsXG4gICAgICAgICAgICAgICAgICAgIGNyZWF0ZWRBdDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgZ3RlOiBjb250ZXN0LnN0YXJ0VGltZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGx0ZTogY29udGVzdC5lbmRUaW1lXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBwcm9ibGVtSWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGNyZWF0ZWRBdDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgbGFuZ3VhZ2U6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBDYWxjdWxhdGUgdG90YWwgc2NvcmVcbiAgICAgICAgICAgIC8vIExvZ2ljOiBCZXN0IHN1Ym1pc3Npb24gcGVyIHByb2JsZW0gY291bnRzXG4gICAgICAgICAgICBjb25zdCBwcm9ibGVtU2NvcmVzID0gbmV3IE1hcDxzdHJpbmcsIG51bWJlcj4oKTtcbiAgICAgICAgICAgIGNvbnN0IHByb2JsZW1Tb2x2ZVRpbWVzID0gbmV3IE1hcDxzdHJpbmcsIERhdGU+KCk7XG4gICAgICAgICAgICBjb25zdCBwcm9ibGVtU3VibWlzc2lvbkNvdW50cyA9IG5ldyBNYXA8c3RyaW5nLCBudW1iZXI+KCk7XG4gICAgICAgICAgICBjb25zdCBwcm9ibGVtQmVzdFN1Ym1pc3Npb25zID0gbmV3IE1hcDxzdHJpbmcsIGFueT4oKTtcblxuICAgICAgICAgICAgc3VibWlzc2lvbnMuZm9yRWFjaChzdWIgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRDb3VudCA9IHByb2JsZW1TdWJtaXNzaW9uQ291bnRzLmdldChzdWIucHJvYmxlbUlkKSB8fCAwO1xuICAgICAgICAgICAgICAgIHByb2JsZW1TdWJtaXNzaW9uQ291bnRzLnNldChzdWIucHJvYmxlbUlkLCBjdXJyZW50Q291bnQgKyAxKTtcblxuICAgICAgICAgICAgICAgIGlmIChzdWIuc3RhdHVzID09PSBcIkFDQ0VQVEVEXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudEJlc3QgPSBwcm9ibGVtU2NvcmVzLmdldChzdWIucHJvYmxlbUlkKSB8fCAwO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBwcm9ibGVtRGVmID0gY29udGVzdC5wcm9ibGVtcy5maW5kKGNwID0+IGNwLnByb2JsZW1JZCA9PT0gc3ViLnByb2JsZW1JZCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG1heFNjb3JlID0gcHJvYmxlbURlZj8ucHJvYmxlbS5zY29yZSB8fCAwO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChtYXhTY29yZSA+IGN1cnJlbnRCZXN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgcHJvYmxlbVNjb3Jlcy5zZXQoc3ViLnByb2JsZW1JZCwgbWF4U2NvcmUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRCZXN0VGltZSA9IHByb2JsZW1Tb2x2ZVRpbWVzLmdldChzdWIucHJvYmxlbUlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWN1cnJlbnRCZXN0VGltZSB8fCBzdWIuY3JlYXRlZEF0IDwgY3VycmVudEJlc3RUaW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2JsZW1Tb2x2ZVRpbWVzLnNldChzdWIucHJvYmxlbUlkLCBzdWIuY3JlYXRlZEF0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvYmxlbUJlc3RTdWJtaXNzaW9ucy5zZXQoc3ViLnByb2JsZW1JZCwgc3ViKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgbGV0IHRvdGFsU2NvcmUgPSAwO1xuICAgICAgICAgICAgbGV0IHRvdGFsVGltZU1zID0gMDtcblxuICAgICAgICAgICAgcHJvYmxlbVNjb3Jlcy5mb3JFYWNoKChzY29yZSwgcHJvYmxlbUlkKSA9PiB7XG4gICAgICAgICAgICAgICAgdG90YWxTY29yZSArPSBzY29yZTtcbiAgICAgICAgICAgICAgICBjb25zdCBzb2x2ZW50VGltZSA9IHByb2JsZW1Tb2x2ZVRpbWVzLmdldChwcm9ibGVtSWQpO1xuICAgICAgICAgICAgICAgIGlmIChzb2x2ZW50VGltZSkge1xuICAgICAgICAgICAgICAgICAgICB0b3RhbFRpbWVNcyArPSAoc29sdmVudFRpbWUuZ2V0VGltZSgpIC0gY29udGVzdC5zdGFydFRpbWUuZ2V0VGltZSgpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gTWFwIHN0YXRzIGZvciBlYWNoIHByb2JsZW0gaW4gdGhlIGNvbnRlc3RcbiAgICAgICAgICAgIGNvbnN0IHByb2JsZW1TdGF0cyA9IGNvbnRlc3QucHJvYmxlbXMubWFwKGNwID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBiZXN0U3ViID0gcHJvYmxlbUJlc3RTdWJtaXNzaW9ucy5nZXQoY3AucHJvYmxlbUlkKTtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBwcm9ibGVtSWQ6IGNwLnByb2JsZW1JZCxcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IGNwLnByb2JsZW0udGl0bGUsXG4gICAgICAgICAgICAgICAgICAgIHNsdWc6IGNwLnByb2JsZW0uc2x1ZyxcbiAgICAgICAgICAgICAgICAgICAgc2NvcmU6IHByb2JsZW1TY29yZXMuZ2V0KGNwLnByb2JsZW1JZCkgfHwgMCxcbiAgICAgICAgICAgICAgICAgICAgbWF4U2NvcmU6IGNwLnByb2JsZW0uc2NvcmUsXG4gICAgICAgICAgICAgICAgICAgIHN1Ym1pc3Npb25zOiBwcm9ibGVtU3VibWlzc2lvbkNvdW50cy5nZXQoY3AucHJvYmxlbUlkKSB8fCAwLFxuICAgICAgICAgICAgICAgICAgICBzb2x2ZWQ6IHByb2JsZW1TY29yZXMuaGFzKGNwLnByb2JsZW1JZCksXG4gICAgICAgICAgICAgICAgICAgIHNvbHZlZEF0OiBwcm9ibGVtU29sdmVUaW1lcy5nZXQoY3AucHJvYmxlbUlkKSxcbiAgICAgICAgICAgICAgICAgICAgbGFuZ3VhZ2U6IGJlc3RTdWI/Lmxhbmd1YWdlPy5uYW1lIHx8IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIGxhbmd1YWdlSWQ6IGJlc3RTdWI/Lmxhbmd1YWdlPy5pZCB8fCBudWxsXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnAudXNlcixcbiAgICAgICAgICAgICAgICBzY29yZTogdG90YWxTY29yZSxcbiAgICAgICAgICAgICAgICB0aW1lVGFrZW46IHRvdGFsVGltZU1zLFxuICAgICAgICAgICAgICAgIHByb2JsZW1zU29sdmVkOiBwcm9ibGVtU2NvcmVzLnNpemUsXG4gICAgICAgICAgICAgICAgcHJvYmxlbVN0YXRzXG4gICAgICAgICAgICB9O1xuICAgICAgICB9KSk7XG5cbiAgICAgICAgLy8gU29ydDogSGlnaCBzY29yZSBmaXJzdCwgdGhlbiBsb3cgdGltZSB0YWtlblxuICAgICAgICBsZWFkZXJib2FyZC5zb3J0KChhLCBiKSA9PiB7XG4gICAgICAgICAgICBpZiAoYi5zY29yZSAhPT0gYS5zY29yZSkgcmV0dXJuIGIuc2NvcmUgLSBhLnNjb3JlO1xuICAgICAgICAgICAgcmV0dXJuIGEudGltZVRha2VuIC0gYi50aW1lVGFrZW47XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgc3R1ZGVudHM6IGxlYWRlcmJvYXJkLFxuICAgICAgICAgICAgaXNGaW5hbGl6ZWQ6IGNvbnRlc3QuaXNGaW5hbGl6ZWQsXG4gICAgICAgICAgICBwcm9ibGVtczogY29udGVzdC5wcm9ibGVtcy5tYXAoY3AgPT4gKHtcbiAgICAgICAgICAgICAgICBpZDogY3AucHJvYmxlbUlkLFxuICAgICAgICAgICAgICAgIHRpdGxlOiBjcC5wcm9ibGVtLnRpdGxlLFxuICAgICAgICAgICAgICAgIHNsdWc6IGNwLnByb2JsZW0uc2x1ZyxcbiAgICAgICAgICAgICAgICBtYXhTY29yZTogY3AucHJvYmxlbS5zY29yZVxuICAgICAgICAgICAgfSkpXG4gICAgICAgIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiTGVhZGVyYm9hcmQgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBnZW5lcmF0ZSBsZWFkZXJib2FyZFwiIH07XG4gICAgfVxufVxuXG4vKipcbiAqIEdldCBjdXJyZW50IHVzZXIncyByYW5raW5nIGluIGEgY29udGVzdFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q29udGVzdFJhbmtpbmcoY29udGVzdElkOiBzdHJpbmcpIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIGlmICghc2Vzc2lvbj8udXNlcikgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBnZXRDb250ZXN0TGVhZGVyYm9hcmQoY29udGVzdElkKTtcblxuICAgICAgICBpZiAoIXJlc3VsdC5zdWNjZXNzIHx8ICFyZXN1bHQuc3R1ZGVudHMpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZ2V0IHJhbmtpbmdcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgcmFuayA9IHJlc3VsdC5zdHVkZW50cy5maW5kSW5kZXgoKHM6IGFueSkgPT4gcy5pZCA9PT0gc2Vzc2lvbi51c2VyLmlkKSArIDE7XG5cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgcmFuazogcmFuayA+IDAgPyByYW5rIDogbnVsbCB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGdldCByYW5raW5nXCIgfTtcbiAgICB9XG59XG4iXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IitSQWdvQnNCIn0=
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/actions/data:afdd9d [app-client] (ecmascript) <text/javascript>", ((__turbopack_context__) => {
"use strict";

/* __next_internal_action_entry_do_not_use__ [{"604a0bcc1451e81e233f48280ac746b33b2aa18f12":"verifyContestPassword"},"actions/contest.ts",""] */ __turbopack_context__.s([
    "verifyContestPassword",
    ()=>verifyContestPassword
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-client] (ecmascript)");
"use turbopack no side effects";
;
var verifyContestPassword = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["createServerReference"])("604a0bcc1451e81e233f48280ac746b33b2aa18f12", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["findSourceMapURL"], "verifyContestPassword"); //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vY29udGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzZXJ2ZXJcIjtcblxuaW1wb3J0IHsgcHJpc21hIH0gZnJvbSBcIkAvbGliL3ByaXNtYVwiO1xuaW1wb3J0IHsgYXV0aCB9IGZyb20gXCJAL2xpYi9hdXRoXCI7XG5pbXBvcnQgeyBoZWFkZXJzIH0gZnJvbSBcIm5leHQvaGVhZGVyc1wiO1xuaW1wb3J0IHsgeiB9IGZyb20gXCJ6b2RcIjtcbmltcG9ydCB7IHJldmFsaWRhdGVQYXRoLCByZXZhbGlkYXRlVGFnIH0gZnJvbSBcIm5leHQvY2FjaGVcIjtcbmltcG9ydCB7IGNhY2hlVGFnLCBjYWNoZUxpZmUgfSBmcm9tIFwibmV4dC9jYWNoZVwiO1xuXG5jb25zdCBjb250ZXN0U2NoZW1hID0gei5vYmplY3Qoe1xuICAgIHRpdGxlOiB6LnN0cmluZygpLm1pbigzLCBcIlRpdGxlIG11c3QgYmUgYXQgbGVhc3QgMyBjaGFyYWN0ZXJzXCIpLFxuICAgIGRlc2NyaXB0aW9uOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgc3RhcnRUaW1lOiB6LmNvZXJjZS5kYXRlKCksXG4gICAgZW5kVGltZTogei5jb2VyY2UuZGF0ZSgpLFxuICAgIHZpc2liaWxpdHk6IHouZW51bShbXCJQVUJMSUNcIiwgXCJJTlNUSVRVVElPTlwiLCBcIkNMQVNTUk9PTVwiXSksXG4gICAgY2xhc3Nyb29tSWQ6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgICBpbnN0aXR1dGlvbklkOiB6LnN0cmluZygpLm9wdGlvbmFsKCkubnVsbGFibGUoKSxcbiAgICBwcm9ibGVtczogei5hcnJheSh6LnN0cmluZygpKS5taW4oMSwgXCJTZWxlY3QgYXQgbGVhc3Qgb25lIHByb2JsZW1cIiksXG4gICAgY29udGVzdFBhc3N3b3JkOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgcmFuZG9taXplUXVlc3Rpb25zOiB6LmJvb2xlYW4oKS5kZWZhdWx0KGZhbHNlKSxcbn0pO1xuXG5jb25zdCBjb250ZXN0V2l0aFByb2JsZW1zU2NoZW1hID0gei5vYmplY3Qoe1xuICAgIHRpdGxlOiB6LnN0cmluZygpLm1pbigzLCBcIlRpdGxlIG11c3QgYmUgYXQgbGVhc3QgMyBjaGFyYWN0ZXJzXCIpLFxuICAgIHNsdWc6IHouc3RyaW5nKCkubWluKDMsIFwiU2x1ZyBtdXN0IGJlIGF0IGxlYXN0IDMgY2hhcmFjdGVyc1wiKSxcbiAgICBkZXNjcmlwdGlvbjogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAgIHN0YXJ0VGltZTogei5kYXRlKCksXG4gICAgZW5kVGltZTogei5kYXRlKCksXG4gICAgdmlzaWJpbGl0eTogei5lbnVtKFtcIlBVQkxJQ1wiLCBcIklOU1RJVFVUSU9OXCIsIFwiQ0xBU1NST09NXCJdKSxcbiAgICBoaWRkZW46IHouYm9vbGVhbigpLmRlZmF1bHQoZmFsc2UpLFxuICAgIGNsYXNzcm9vbUlkOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgaW5zdGl0dXRpb25JZDogei5zdHJpbmcoKS5vcHRpb25hbCgpLm51bGxhYmxlKCksXG4gICAgYmFja2dyb3VuZEltYWdlOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgcHJpemVzOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgcnVsZXM6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgICBwcm9ibGVtczogei5hcnJheSh6LmFueSgpKSwgLy8gRnVsbCBwcm9ibGVtIGRhdGEgb2JqZWN0c1xuICAgIGNvbnRlc3RQYXNzd29yZDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAgIHJhbmRvbWl6ZVF1ZXN0aW9uczogei5ib29sZWFuKCkuZGVmYXVsdChmYWxzZSksXG59KTtcblxuLyoqXG4gKiBGZXRjaGVzIGNvbnRlc3RzIHZpc2libGUgdG8gdGhlIGN1cnJlbnQgdXNlci5cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFZpc2libGVDb250ZXN0cygpIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIHRyeSB7XG4gICAgICAgIGlmICghc2Vzc2lvbj8udXNlcikge1xuICAgICAgICAgICAgY29uc3QgY29udGVzdHMgPSBhd2FpdCBwcmlzbWEuY29udGVzdC5maW5kTWFueSh7XG4gICAgICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICAgICAgdmlzaWJpbGl0eTogXCJQVUJMSUNcIixcbiAgICAgICAgICAgICAgICAgICAgaGlkZGVuOiBmYWxzZSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICAgICAgX2NvdW50OiB7IHNlbGVjdDogeyBwcm9ibGVtczogdHJ1ZSB9IH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9yZGVyQnk6IHsgc3RhcnRUaW1lOiBcImRlc2NcIiB9LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBjb250ZXN0cyB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgY3VycmVudFVzZXIgPSBzZXNzaW9uLnVzZXIgYXMgYW55O1xuXG4gICAgICAgIGlmIChjdXJyZW50VXNlci5yb2xlID09PSBcIkFETUlOXCIpIHtcbiAgICAgICAgICAgIGNvbnN0IGNvbnRlc3RzID0gYXdhaXQgcHJpc21hLmNvbnRlc3QuZmluZE1hbnkoe1xuICAgICAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICAgICAgX2NvdW50OiB7IHNlbGVjdDogeyBwcm9ibGVtczogdHJ1ZSB9IH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9yZGVyQnk6IHsgc3RhcnRUaW1lOiBcImRlc2NcIiB9LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBjb250ZXN0cyB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgY29udGVzdHMgPSBhd2FpdCBwcmlzbWEuY29udGVzdC5maW5kTWFueSh7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgIE9SOiBbXG4gICAgICAgICAgICAgICAgICAgIHsgdmlzaWJpbGl0eTogXCJQVUJMSUNcIiB9LFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBBTkQ6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IHZpc2liaWxpdHk6IFwiSU5TVElUVVRJT05cIiB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgaW5zdGl0dXRpb25JZDogY3VycmVudFVzZXIuaW5zdGl0dXRpb25JZCB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgQU5EOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeyB2aXNpYmlsaXR5OiBcIkNMQVNTUk9PTVwiIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBPUjogW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBjbGFzc3Jvb206IHsgc3R1ZGVudHM6IHsgc29tZTogeyBpZDogY3VycmVudFVzZXIuaWQgfSB9IH0gfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgY3JlYXRvcklkOiBjdXJyZW50VXNlci5pZCB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB7IGNyZWF0b3JJZDogY3VycmVudFVzZXIuaWQgfSxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICBfY291bnQ6IHsgc2VsZWN0OiB7IHByb2JsZW1zOiB0cnVlIH0gfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9yZGVyQnk6IHsgc3RhcnRUaW1lOiBcImRlc2NcIiB9LFxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBjb250ZXN0cyB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gZmV0Y2ggY29udGVzdHM6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBmZXRjaCBjb250ZXN0c1wiIH07XG4gICAgfVxufVxuXG5cbi8qKlxuICogRmV0Y2hlcyBhIHNpbmdsZSBjb250ZXN0J3MgZGV0YWlscyB3aXRoIGF1dGhvcml6YXRpb24uXG4gKi9cbi8qKlxuICogRmV0Y2hlcyBhIHNpbmdsZSBjb250ZXN0J3MgZGV0YWlscyB3aXRoIGF1dGhvcml6YXRpb24uXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRDb250ZXN0RGV0YWlsKGNvbnRlc3RJZDogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjb250ZXN0ID0gYXdhaXQgcHJpc21hLmNvbnRlc3QuZmluZFVuaXF1ZSh7XG4gICAgICAgICAgICB3aGVyZTogeyBpZDogY29udGVzdElkIH0sXG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgX2NvdW50OiB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdDogeyBwcm9ibGVtczogdHJ1ZSB9LFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgcHJvYmxlbXM6IHtcbiAgICAgICAgICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJvYmxlbToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpZmZpY3VsdHk6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNsdWc6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIG9yZGVyQnk6IHsgb3JkZXI6IFwiYXNjXCIgfSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKCFjb250ZXN0KSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiQ29udGVzdCBub3QgZm91bmRcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgY3VycmVudFVzZXIgPSBzZXNzaW9uPy51c2VyIGFzIGFueTtcbiAgICAgICAgY29uc3QgcGFydGljaXBhdGlvbiA9IGN1cnJlbnRVc2VyID8gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZDogY3VycmVudFVzZXIuaWQsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlc3RJZDogY29udGVzdElkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KSA6IG51bGw7XG5cbiAgICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgICAgICAgY29uc3QgaGFzU3RhcnRlZCA9IG5vdyA+PSBjb250ZXN0LnN0YXJ0VGltZTtcbiAgICAgICAgY29uc3QgaXNDcmVhdG9yID0gY3VycmVudFVzZXI/LmlkID09PSBjb250ZXN0LmNyZWF0b3JJZDtcbiAgICAgICAgY29uc3QgaXNBZG1pbiA9IGN1cnJlbnRVc2VyPy5yb2xlID09PSBcIkFETUlOXCI7XG5cbiAgICAgICAgLy8gVmlzaWJpbGl0eSBDaGVja1xuICAgICAgICBsZXQgaXNBdXRob3JpemVkID0gZmFsc2U7XG4gICAgICAgIGlmIChjb250ZXN0LnZpc2liaWxpdHkgPT09IFwiUFVCTElDXCIpIHtcbiAgICAgICAgICAgIGlzQXV0aG9yaXplZCA9IHRydWU7XG4gICAgICAgIH0gZWxzZSBpZiAoaXNBZG1pbikge1xuICAgICAgICAgICAgaXNBdXRob3JpemVkID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIGlmIChjdXJyZW50VXNlcikge1xuICAgICAgICAgICAgaWYgKGlzQ3JlYXRvcikge1xuICAgICAgICAgICAgICAgIGlzQXV0aG9yaXplZCA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGNvbnRlc3QudmlzaWJpbGl0eSA9PT0gXCJJTlNUSVRVVElPTlwiKSB7XG4gICAgICAgICAgICAgICAgLy8gVXNlID09IGZvciBudWxsL3VuZGVmaW5lZCBsb29zZSBlcXVhbGl0eSBjaGVja1xuICAgICAgICAgICAgICAgIGlzQXV0aG9yaXplZCA9IGN1cnJlbnRVc2VyLmluc3RpdHV0aW9uSWQgPT0gY29udGVzdC5pbnN0aXR1dGlvbklkO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChjb250ZXN0LnZpc2liaWxpdHkgPT09IFwiQ0xBU1NST09NXCIpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlbnJvbGxtZW50ID0gYXdhaXQgcHJpc21hLmNsYXNzcm9vbS5maW5kRmlyc3Qoe1xuICAgICAgICAgICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGNvbnRlc3QuY2xhc3Nyb29tSWQgYXMgc3RyaW5nLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3R1ZGVudHM6IHsgc29tZTogeyBpZDogY3VycmVudFVzZXIuaWQgfSB9LFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGlzQXV0aG9yaXplZCA9ICEhZW5yb2xsbWVudDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghaXNBdXRob3JpemVkKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkIGFjY2VzcyB0byB0aGlzIGNvbnRlc3QuXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGNhblNlZVByb2JsZW1zID0gKGhhc1N0YXJ0ZWQgfHwgaXNBZG1pbiB8fCBpc0NyZWF0b3IpICYmIChwYXJ0aWNpcGF0aW9uPy5hY2NlcHRlZFJ1bGVzIHx8IGlzQ3JlYXRvciB8fCBpc0FkbWluKTtcblxuICAgICAgICAvLyBGaXg6IElmIHRoZSBjb250ZXN0IGlzIG92ZXIsIGFsbG93ZWQgcm9sZXMgc2hvdWxkIGNoZWNrIHBhcnRpY2lwYXRpb24gcHJvcGVybHksXG4gICAgICAgIC8vIGJ1dCB0eXBpY2FsbHkgYWxsb3dzIHZpZXdpbmcgaWYgcHVibGljL2F1dGhvcml6ZWQuXG4gICAgICAgIC8vIEJ1dCBmb3IgXCJMaXZlXCIgY29udGVzdHMsIHRoZSBjdXJyZW50IGxvZ2ljIGlzIGNvcnJlY3QuXG5cbiAgICAgICAgY29uc3QgcmVxdWlyZXNQYXNzd29yZCA9ICEhY29udGVzdC5jb250ZXN0UGFzc3dvcmQ7XG5cbiAgICAgICAgLy8gU2h1ZmZsZSBwcm9ibGVtcyBpZiByYW5kb21pemVRdWVzdGlvbnMgaXMgZW5hYmxlZFxuICAgICAgICAvLyBVc2UgYSBzaW1wbGUgc2VlZGVkIHNodWZmbGUgYmFzZWQgb24gdXNlcklkICsgY29udGVzdElkIGZvciBjb25zaXN0ZW5jeVxuICAgICAgICBsZXQgdmlzaWJsZVByb2JsZW1zID0gY2FuU2VlUHJvYmxlbXMgPyBjb250ZXN0LnByb2JsZW1zIDogW107XG5cbiAgICAgICAgaWYgKGNvbnRlc3QucmFuZG9taXplUXVlc3Rpb25zICYmIGN1cnJlbnRVc2VyICYmIHZpc2libGVQcm9ibGVtcy5sZW5ndGggPiAwICYmICFpc0FkbWluICYmICFpc0NyZWF0b3IpIHtcbiAgICAgICAgICAgIC8vIFNpbXBsZSBzdHJpbmcgaGFzaCBmdW5jdGlvbiBmb3Igc2VlZGluZ1xuICAgICAgICAgICAgY29uc3Qgc2VlZFN0ciA9IGAke2N1cnJlbnRVc2VyLmlkfS0ke2NvbnRlc3RJZH1gO1xuICAgICAgICAgICAgbGV0IHNlZWQgPSAwO1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzZWVkU3RyLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgc2VlZCA9ICgoc2VlZCA8PCA1KSAtIHNlZWQpICsgc2VlZFN0ci5jaGFyQ29kZUF0KGkpO1xuICAgICAgICAgICAgICAgIHNlZWQgfD0gMDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gRGV0ZXJtaW5pc3RpYyBzaHVmZmxlXG4gICAgICAgICAgICB2aXNpYmxlUHJvYmxlbXMgPSBbLi4udmlzaWJsZVByb2JsZW1zXS5zb3J0KChhLCBiKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgeCA9IE1hdGguc2luKHNlZWQrKykgKiAxMDAwMDtcbiAgICAgICAgICAgICAgICByZXR1cm4gKHggLSBNYXRoLmZsb29yKHgpKSAtIDAuNTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gRmV0Y2ggdXNlcidzIHNvbHZlZCBwcm9ibGVtcyBmb3IgdGhpcyBjb250ZXN0XG4gICAgICAgIGNvbnN0IHNvbHZlZFByb2JsZW1JZHMgPSBuZXcgU2V0PHN0cmluZz4oKTtcbiAgICAgICAgaWYgKGN1cnJlbnRVc2VyKSB7XG4gICAgICAgICAgICBjb25zdCBzb2x2ZWRTdWJtaXNzaW9ucyA9IGF3YWl0IHByaXNtYS5zdWJtaXNzaW9uLmZpbmRNYW55KHtcbiAgICAgICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IGN1cnJlbnRVc2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZCxcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiBcIkFDQ0VQVEVEXCIsXG4gICAgICAgICAgICAgICAgICAgIHByb2JsZW1JZDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgaW46IHZpc2libGVQcm9ibGVtcy5tYXAocCA9PiBwLnByb2JsZW0uaWQpXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHNlbGVjdDogeyBwcm9ibGVtSWQ6IHRydWUgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBzb2x2ZWRTdWJtaXNzaW9ucy5mb3JFYWNoKHMgPT4gc29sdmVkUHJvYmxlbUlkcy5hZGQocy5wcm9ibGVtSWQpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgY29udGVzdDoge1xuICAgICAgICAgICAgICAgIC4uLmNvbnRlc3QsXG4gICAgICAgICAgICAgICAgcHJvYmxlbXM6IHZpc2libGVQcm9ibGVtcy5tYXAodnAgPT4gKHtcbiAgICAgICAgICAgICAgICAgICAgLi4udnAsXG4gICAgICAgICAgICAgICAgICAgIGlzU29sdmVkOiBzb2x2ZWRQcm9ibGVtSWRzLmhhcyh2cC5wcm9ibGVtLmlkKVxuICAgICAgICAgICAgICAgIH0pKSxcbiAgICAgICAgICAgICAgICBoYXNTdGFydGVkLFxuICAgICAgICAgICAgICAgIGhhc0VuZGVkOiBub3cgPiBjb250ZXN0LmVuZFRpbWUsXG4gICAgICAgICAgICAgICAgY2FuTWFuYWdlOiBpc0FkbWluIHx8IGlzQ3JlYXRvcixcbiAgICAgICAgICAgICAgICBoYXNBY2NlcHRlZFJ1bGVzOiBwYXJ0aWNpcGF0aW9uPy5hY2NlcHRlZFJ1bGVzIHx8IGZhbHNlLFxuICAgICAgICAgICAgICAgIGlzRmluaXNoZWQ6IHBhcnRpY2lwYXRpb24/LmlzRmluaXNoZWQgfHwgZmFsc2UsXG4gICAgICAgICAgICAgICAgcmVxdWlyZXNQYXNzd29yZCxcbiAgICAgICAgICAgICAgICBjb250ZXN0UGFzc3dvcmQ6IG51bGwsIC8vIE5ldmVyIHJldHVybiBwbGFpbiBwYXNzd29yZFxuICAgICAgICAgICAgICAgIHNlc3Npb25JZDogcGFydGljaXBhdGlvbj8uc2Vzc2lvbklkIC8vIFJldHVybiBzZXNzaW9uSWQgZm9yIHByb3RlY3Rpb25cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGZldGNoIGNvbnRlc3QgZGV0YWlsOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZmV0Y2ggY29udGVzdFwiIH07XG4gICAgfVxufVxuXG4vLyAuLi4gZXhpc3RpbmcgY29kZSAuLi5cblxuLy8gLi4uIGV4aXN0aW5nIGNvZGUgLi4uXG5cbi8vIC4uLiBleGlzdGluZyBjb2RlIC4uLlxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlQ29udGVzdChkYXRhOiB6LmluZmVyPHR5cGVvZiBjb250ZXN0U2NoZW1hPikge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSB7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuICAgIH1cblxuICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gc2Vzc2lvbi51c2VyIGFzIGFueTtcblxuICAgIGlmICghW1wiQURNSU5cIiwgXCJJTlNUSVRVVElPTl9NQU5BR0VSXCIsIFwiQ09OVEVTVF9NQU5BR0VSXCIsIFwiVEVBQ0hFUlwiXS5pbmNsdWRlcyhjdXJyZW50VXNlci5yb2xlKSkge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCB2YWxpZGF0ZWREYXRhID0gY29udGVzdFNjaGVtYS5wYXJzZShkYXRhKTtcblxuICAgICAgICAvLyBHZW5lcmF0ZSBhIG1vcmUgcm9idXN0IHVuaXF1ZSBzbHVnXG4gICAgICAgIGNvbnN0IGJhc2VTbHVnID0gdmFsaWRhdGVkRGF0YS50aXRsZS50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoL1teYS16MC05XSsvZywgXCItXCIpLnJlcGxhY2UoLyheLXwtJCkvZywgXCJcIik7XG4gICAgICAgIGNvbnN0IHVuaXF1ZVNsdWcgPSBgJHtiYXNlU2x1Z30tJHtEYXRlLm5vdygpfWA7XG5cbiAgICAgICAgY29uc3QgY29udGVzdCA9IGF3YWl0IHByaXNtYS5jb250ZXN0LmNyZWF0ZSh7XG4gICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgdGl0bGU6IHZhbGlkYXRlZERhdGEudGl0bGUsXG4gICAgICAgICAgICAgICAgc2x1ZzogdW5pcXVlU2x1ZyxcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogdmFsaWRhdGVkRGF0YS5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICBzdGFydFRpbWU6IHZhbGlkYXRlZERhdGEuc3RhcnRUaW1lLFxuICAgICAgICAgICAgICAgIGVuZFRpbWU6IHZhbGlkYXRlZERhdGEuZW5kVGltZSxcbiAgICAgICAgICAgICAgICB2aXNpYmlsaXR5OiB2YWxpZGF0ZWREYXRhLnZpc2liaWxpdHkgYXMgYW55LFxuICAgICAgICAgICAgICAgIGluc3RpdHV0aW9uSWQ6IHZhbGlkYXRlZERhdGEudmlzaWJpbGl0eSAhPT0gXCJQVUJMSUNcIiA/ICh2YWxpZGF0ZWREYXRhLmluc3RpdHV0aW9uSWQgfHwgbnVsbCkgOiBudWxsLFxuICAgICAgICAgICAgICAgIGNsYXNzcm9vbUlkOiB2YWxpZGF0ZWREYXRhLnZpc2liaWxpdHkgPT09IFwiQ0xBU1NST09NXCIgPyAodmFsaWRhdGVkRGF0YS5jbGFzc3Jvb21JZCB8fCBudWxsKSA6IG51bGwsXG4gICAgICAgICAgICAgICAgY3JlYXRvcklkOiBjdXJyZW50VXNlci5pZCxcbiAgICAgICAgICAgICAgICBjb250ZXN0UGFzc3dvcmQ6IHZhbGlkYXRlZERhdGEuY29udGVzdFBhc3N3b3JkIHx8IG51bGwsXG4gICAgICAgICAgICAgICAgcmFuZG9taXplUXVlc3Rpb25zOiB2YWxpZGF0ZWREYXRhLnJhbmRvbWl6ZVF1ZXN0aW9ucyB8fCBmYWxzZSxcbiAgICAgICAgICAgICAgICBwcm9ibGVtczoge1xuICAgICAgICAgICAgICAgICAgICBjcmVhdGU6IHZhbGlkYXRlZERhdGEucHJvYmxlbXMubWFwKChwcm9ibGVtSWQsIGluZGV4KSA9PiAoe1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJvYmxlbUlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgb3JkZXI6IGluZGV4LFxuICAgICAgICAgICAgICAgICAgICB9KSksXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC9jb250ZXN0c1wiKTtcbiAgICAgICAgcmV2YWxpZGF0ZVBhdGgoXCIvY29udGVzdFwiKTtcbiAgICAgICAgcmV2YWxpZGF0ZVRhZyhcImNvbnRlc3RzXCIsIFwibWF4XCIpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBjb250ZXN0SWQ6IGNvbnRlc3QuaWQgfTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gY3JlYXRlIGNvbnRlc3Q6XCIsIGVycm9yKTtcbiAgICAgICAgLy8gUmV0dXJuIGNsZWFyZXIgZXJyb3IgbWVzc2FnZXNcbiAgICAgICAgbGV0IGVycm9yTWVzc2FnZSA9IFwiRmFpbGVkIHRvIGNyZWF0ZSBjb250ZXN0XCI7XG4gICAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIHouWm9kRXJyb3IpIHtcbiAgICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSAoZXJyb3IgYXMgYW55KS5lcnJvcnMubWFwKChlOiBhbnkpID0+IGUubWVzc2FnZSkuam9pbihcIiwgXCIpO1xuICAgICAgICB9IGVsc2UgaWYgKGVycm9yIGluc3RhbmNlb2YgRXJyb3IpIHtcbiAgICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSBlcnJvci5tZXNzYWdlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3JNZXNzYWdlIH07XG4gICAgfVxuICAgIH1cblxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlQ29udGVzdFdpdGhQcm9ibGVtcyhkYXRhOiB6LmluZmVyPHR5cGVvZiBjb250ZXN0V2l0aFByb2JsZW1zU2NoZW1hPikge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSB7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuICAgIH1cblxuICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gc2Vzc2lvbi51c2VyIGFzIGFueTtcblxuICAgIGlmICghW1wiQURNSU5cIiwgXCJJTlNUSVRVVElPTl9NQU5BR0VSXCIsIFwiQ09OVEVTVF9NQU5BR0VSXCIsIFwiVEVBQ0hFUlwiXS5pbmNsdWRlcyhjdXJyZW50VXNlci5yb2xlKSkge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCB2YWxpZGF0ZWREYXRhID0gY29udGVzdFdpdGhQcm9ibGVtc1NjaGVtYS5wYXJzZShkYXRhKTtcblxuICAgICAgICBjb25zdCBjb250ZXN0ID0gYXdhaXQgcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNvbnRlc3QgPSBhd2FpdCB0eC5jb250ZXN0LmNyZWF0ZSh7XG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICB0aXRsZTogdmFsaWRhdGVkRGF0YS50aXRsZSxcbiAgICAgICAgICAgICAgICAgICAgc2x1ZzogdmFsaWRhdGVkRGF0YS5zbHVnLFxuICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogdmFsaWRhdGVkRGF0YS5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICAgICAgc3RhcnRUaW1lOiB2YWxpZGF0ZWREYXRhLnN0YXJ0VGltZSxcbiAgICAgICAgICAgICAgICAgICAgZW5kVGltZTogdmFsaWRhdGVkRGF0YS5lbmRUaW1lLFxuICAgICAgICAgICAgICAgICAgICB2aXNpYmlsaXR5OiB2YWxpZGF0ZWREYXRhLnZpc2liaWxpdHkgYXMgYW55LFxuICAgICAgICAgICAgICAgICAgICBoaWRkZW46IHZhbGlkYXRlZERhdGEuaGlkZGVuLFxuICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kSW1hZ2U6IHZhbGlkYXRlZERhdGEuYmFja2dyb3VuZEltYWdlLFxuICAgICAgICAgICAgICAgICAgICBwcml6ZXM6IHZhbGlkYXRlZERhdGEucHJpemVzLFxuICAgICAgICAgICAgICAgICAgICBydWxlczogdmFsaWRhdGVkRGF0YS5ydWxlcyxcbiAgICAgICAgICAgICAgICAgICAgaW5zdGl0dXRpb25JZDogdmFsaWRhdGVkRGF0YS52aXNpYmlsaXR5ICE9PSBcIlBVQkxJQ1wiID8gKHZhbGlkYXRlZERhdGEuaW5zdGl0dXRpb25JZCB8fCBudWxsKSA6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIGNsYXNzcm9vbUlkOiB2YWxpZGF0ZWREYXRhLnZpc2liaWxpdHkgPT09IFwiQ0xBU1NST09NXCIgPyAodmFsaWRhdGVkRGF0YS5jbGFzc3Jvb21JZCB8fCBudWxsKSA6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIGNyZWF0b3JJZDogY3VycmVudFVzZXIuaWQsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlc3RQYXNzd29yZDogdmFsaWRhdGVkRGF0YS5jb250ZXN0UGFzc3dvcmQgfHwgbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgcmFuZG9taXplUXVlc3Rpb25zOiB2YWxpZGF0ZWREYXRhLnJhbmRvbWl6ZVF1ZXN0aW9ucyB8fCBmYWxzZSxcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB2YWxpZGF0ZWREYXRhLnByb2JsZW1zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcCA9IHZhbGlkYXRlZERhdGEucHJvYmxlbXNbaV07XG4gICAgICAgICAgICAgICAgLy8gR2VuZXJhdGUgdW5pcXVlIHNsdWcgYnkgYXBwZW5kaW5nIGNvbnRlc3Qgc2x1ZyBhbmQgaW5kZXhcbiAgICAgICAgICAgICAgICBjb25zdCB1bmlxdWVTbHVnID0gYCR7dmFsaWRhdGVkRGF0YS5zbHVnfS0ke3Auc2x1ZyB8fCBwLnRpdGxlLnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvXFxzKy9nLCAnLScpfS0ke0RhdGUubm93KCl9LSR7aX1gO1xuICAgICAgICAgICAgICAgIGNvbnN0IHByb2JsZW0gPSBhd2FpdCB0eC5wcm9ibGVtLmNyZWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBwLnRpdGxlLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHAuZGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICBkaWZmaWN1bHR5OiBwLmRpZmZpY3VsdHksXG4gICAgICAgICAgICAgICAgICAgICAgICBzbHVnOiB1bmlxdWVTbHVnLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcmU6IHAuc2NvcmUgfHwgMTAsXG4gICAgICAgICAgICAgICAgICAgICAgICBkb21haW46IHAuZG9tYWluLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJDT05URVNUXCIsIC8vIENvbnRlc3QgcHJvYmxlbXMgYXJlIG1hcmtlZCBzZXBhcmF0ZWx5XG4gICAgICAgICAgICAgICAgICAgICAgICBoaWRkZW46IHRydWUsIC8vIENvbnRlc3QgcHJvYmxlbXMgYXJlIGhpZGRlbiBmcm9tIG1haW4gYmFua1xuICAgICAgICAgICAgICAgICAgICAgICAgdGVzdENhc2VzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlOiBwLnRlc3RDYXNlcyxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICB0YWdzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29ubmVjdDogcC50YWdzPy5tYXAoKHQ6IHN0cmluZykgPT4gKHsgbmFtZTogdCB9KSkgfHwgW10sXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGF3YWl0IHR4LmNvbnRlc3RQcm9ibGVtLmNyZWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlc3RJZDogY29udGVzdC5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2JsZW1JZDogcHJvYmxlbS5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG9yZGVyOiBpLFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBjb250ZXN0O1xuICAgICAgICB9KTtcblxuICAgICAgICByZXZhbGlkYXRlUGF0aChcIi9kYXNoYm9hcmQvY29udGVzdHNcIik7XG4gICAgICAgIHJldmFsaWRhdGVQYXRoKFwiL2NvbnRlc3RzXCIpO1xuICAgICAgICByZXZhbGlkYXRlUGF0aChcIi9jb250ZXN0XCIpO1xuICAgICAgICByZXZhbGlkYXRlVGFnKFwiY29udGVzdHNcIiwgXCJtYXhcIik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGNvbnRlc3RJZDogY29udGVzdC5pZCB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gY3JlYXRlIGNvbnRlc3Qgd2l0aCBwcm9ibGVtczpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGNyZWF0ZSBjb250ZXN0XCIgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRJbnN0aXR1dGlvbmFsQ2xhc3Nyb29tcyhpbnN0aXR1dGlvbklkOiBzdHJpbmcpIHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjbGFzc3Jvb21zID0gYXdhaXQgcHJpc21hLmNsYXNzcm9vbS5maW5kTWFueSh7XG4gICAgICAgICAgICB3aGVyZTogeyBpbnN0aXR1dGlvbklkIH0sXG4gICAgICAgICAgICBzZWxlY3Q6IHsgaWQ6IHRydWUsIG5hbWU6IHRydWUsIHNlY3Rpb246IHRydWUgfSxcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGNsYXNzcm9vbXMgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGZldGNoIGNsYXNzcm9vbXM6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBmZXRjaCBjbGFzc3Jvb21zXCIgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRTZWxlY3RhYmxlUHJvYmxlbXMoc2VhcmNoOiBzdHJpbmcpIHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBwcm9ibGVtcyA9IGF3YWl0IHByaXNtYS5wcm9ibGVtLmZpbmRNYW55KHtcbiAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgT1I6IFtcbiAgICAgICAgICAgICAgICAgICAgeyB0aXRsZTogeyBjb250YWluczogc2VhcmNoLCBtb2RlOiBcImluc2Vuc2l0aXZlXCIgfSB9LFxuICAgICAgICAgICAgICAgICAgICB7IHNsdWc6IHsgY29udGFpbnM6IHNlYXJjaCwgbW9kZTogXCJpbnNlbnNpdGl2ZVwiIH0gfSxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIGhpZGRlbjogZmFsc2UsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2VsZWN0OiB7IGlkOiB0cnVlLCB0aXRsZTogdHJ1ZSwgZGlmZmljdWx0eTogdHJ1ZSwgc2x1ZzogdHJ1ZSB9LFxuICAgICAgICAgICAgdGFrZTogMTAsXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBwcm9ibGVtcyB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gZmV0Y2ggcHJvYmxlbXM6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBmZXRjaCBwcm9ibGVtc1wiIH07XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYWNjZXB0Q29udGVzdFJ1bGVzKGNvbnRlc3RJZDogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICBpZiAoIXNlc3Npb24/LnVzZXIpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuXG4gICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLnVwc2VydCh7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgIHVzZXJJZF9jb250ZXN0SWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkOiBzZXNzaW9uLnVzZXIuaWQsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlc3RJZDogY29udGVzdElkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHVwZGF0ZTogeyBhY2NlcHRlZFJ1bGVzOiB0cnVlIH0sXG4gICAgICAgICAgICBjcmVhdGU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWQ6IHNlc3Npb24udXNlci5pZCxcbiAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZCxcbiAgICAgICAgICAgICAgICBhY2NlcHRlZFJ1bGVzOiB0cnVlXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXZhbGlkYXRlUGF0aChgL2NvbnRlc3QvJHtjb250ZXN0SWR9YCk7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGFjY2VwdCBydWxlc1wiIH07XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZmluaXNoQ29udGVzdEFjdGlvbihjb250ZXN0SWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcblxuICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHByaXNtYS5jb250ZXN0UGFydGljaXBhdGlvbi51cHNlcnQoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1cGRhdGU6IHtcbiAgICAgICAgICAgICAgICBpc0ZpbmlzaGVkOiB0cnVlLFxuICAgICAgICAgICAgICAgIGZpbmlzaGVkQXQ6IG5ldyBEYXRlKClcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjcmVhdGU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWQ6IHNlc3Npb24udXNlci5pZCxcbiAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZCxcbiAgICAgICAgICAgICAgICBhY2NlcHRlZFJ1bGVzOiB0cnVlLFxuICAgICAgICAgICAgICAgIGlzRmluaXNoZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgZmluaXNoZWRBdDogbmV3IERhdGUoKVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV2YWxpZGF0ZVBhdGgoYC9jb250ZXN0LyR7Y29udGVzdElkfWApO1xuICAgICAgICByZXZhbGlkYXRlUGF0aChgL3Byb2JsZW1zYCk7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGZpbmlzaCBjb250ZXN0XCIgfTtcbiAgICB9XG59XG5cbi8qKlxuICogRmluYWxpemUgQ29udGVzdCAmIEF3YXJkIEJhZGdlc1xuICogLSBDYWxjdWxhdGVzIGxlYWRlcmJvYXJkXG4gKiAtIEF3YXJkcyBHb2xkLCBTaWx2ZXIsIEJyb256ZSB0byBUb3AgM1xuICogLSBNYXJrcyBjb250ZXN0IGFzIGZpbmFsaXplZFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZmluYWxpemVDb250ZXN0KGNvbnRlc3RJZDogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICBpZiAoIXNlc3Npb24/LnVzZXIpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuXG4gICAgLy8gT25seSBhZG1pbnMgb3IgY29udGVzdCBtYW5hZ2VycyBjYW4gZmluYWxpemVcbiAgICBjb25zdCBjdXJyZW50VXNlciA9IHNlc3Npb24udXNlciBhcyBhbnk7XG4gICAgaWYgKCFbXCJBRE1JTlwiLCBcIkNPTlRFU1RfTUFOQUdFUlwiLCBcIklOU1RJVFVUSU9OX01BTkFHRVJcIiwgXCJURUFDSEVSXCJdLmluY2x1ZGVzKGN1cnJlbnRVc2VyLnJvbGUpKSB7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRlc3QgPSBhd2FpdCBwcmlzbWEuY29udGVzdC5maW5kVW5pcXVlKHtcbiAgICAgICAgICAgICB3aGVyZTogeyBpZDogY29udGVzdElkIH0sXG4gICAgICAgICAgICAgc2VsZWN0OiB7IGlzRmluYWxpemVkOiB0cnVlLCB0aXRsZTogdHJ1ZSB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICghY29udGVzdCkgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkNvbnRlc3Qgbm90IGZvdW5kXCIgfTtcbiAgICAgICAgaWYgKGNvbnRlc3QuaXNGaW5hbGl6ZWQpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJDb250ZXN0IGlzIGFscmVhZHkgZmluYWxpemVkXCIgfTtcblxuICAgICAgICAvLyBSZXVzZSBsZWFkZXJib2FyZCBsb2dpYyB0byBnZXQgcmFua2luZ3NcbiAgICAgICAgY29uc3QgbGVhZGVyYm9hcmQgPSBhd2FpdCBnZXRDb250ZXN0TGVhZGVyYm9hcmQoY29udGVzdElkKTtcbiAgICAgICAgaWYgKCFsZWFkZXJib2FyZC5zdWNjZXNzIHx8ICFsZWFkZXJib2FyZC5zdHVkZW50cykge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBmZXRjaCBsZWFkZXJib2FyZFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBzdHVkZW50cyA9IGxlYWRlcmJvYXJkLnN0dWRlbnRzIGFzIGFueVtdO1xuXG4gICAgICAgIC8vIEF0IGxlYXN0IDEgc3R1ZGVudCBuZWVkZWRcbiAgICAgICAgaWYgKHN0dWRlbnRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgIGF3YWl0IHByaXNtYS5jb250ZXN0LnVwZGF0ZSh7XG4gICAgICAgICAgICAgICAgIHdoZXJlOiB7IGlkOiBjb250ZXN0SWQgfSxcbiAgICAgICAgICAgICAgICAgZGF0YTogeyBpc0ZpbmFsaXplZDogdHJ1ZSB9XG4gICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgbWVzc2FnZTogXCJDb250ZXN0IGZpbmFsaXplZCAobm8gcGFydGljaXBhbnRzKVwiIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBUb3AgMyBJRHNcbiAgICAgICAgY29uc3QgZ29sZFVzZXJJZCA9IHN0dWRlbnRzWzBdPy5pZDtcbiAgICAgICAgY29uc3Qgc2lsdmVyVXNlcklkID0gc3R1ZGVudHNbMV0/LmlkO1xuICAgICAgICBjb25zdCBicm9uemVVc2VySWQgPSBzdHVkZW50c1syXT8uaWQ7XG5cbiAgICAgICAgYXdhaXQgcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgICAgIC8vIEF3YXJkIEdvbGRcbiAgICAgICAgICAgIGlmIChnb2xkVXNlcklkKSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdHgudXNlci51cGRhdGUoe1xuICAgICAgICAgICAgICAgICAgICB3aGVyZTogeyBpZDogZ29sZFVzZXJJZCB9LFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7IGdvbGRCYWRnZXM6IHsgaW5jcmVtZW50OiAxIH0gfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gQXdhcmQgU2lsdmVyXG4gICAgICAgICAgICBpZiAoc2lsdmVyVXNlcklkKSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdHgudXNlci51cGRhdGUoe1xuICAgICAgICAgICAgICAgICAgICB3aGVyZTogeyBpZDogc2lsdmVyVXNlcklkIH0sXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IHsgc2lsdmVyQmFkZ2VzOiB7IGluY3JlbWVudDogMSB9IH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIEF3YXJkIEJyb256ZVxuICAgICAgICAgICAgaWYgKGJyb256ZVVzZXJJZCkge1xuICAgICAgICAgICAgICAgIGF3YWl0IHR4LnVzZXIudXBkYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IGJyb256ZVVzZXJJZCB9LFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7IGJyb256ZUJhZGdlczogeyBpbmNyZW1lbnQ6IDEgfSB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIE1hcmsgRmluYWxpemVkXG4gICAgICAgICAgICBhd2FpdCB0eC5jb250ZXN0LnVwZGF0ZSh7XG4gICAgICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IGNvbnRlc3RJZCB9LFxuICAgICAgICAgICAgICAgIGRhdGE6IHsgaXNGaW5hbGl6ZWQ6IHRydWUgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldmFsaWRhdGVQYXRoKGAvZGFzaGJvYXJkYCk7XG4gICAgICAgIHJldmFsaWRhdGVQYXRoKGAvcHJvZmlsZS8ke2dvbGRVc2VySWR9YCk7XG4gICAgICAgIGlmKHNpbHZlclVzZXJJZCkgcmV2YWxpZGF0ZVBhdGgoYC9wcm9maWxlLyR7c2lsdmVyVXNlcklkfWApO1xuICAgICAgICBpZihicm9uemVVc2VySWQpIHJldmFsaWRhdGVQYXRoKGAvcHJvZmlsZS8ke2Jyb256ZVVzZXJJZH1gKTtcbiAgICAgICAgcmV2YWxpZGF0ZVBhdGgoYC9jb250ZXN0LyR7Y29udGVzdElkfWApO1xuICAgICAgICByZXZhbGlkYXRlVGFnKGBjb250ZXN0LSR7Y29udGVzdElkfWAsIFwibWF4XCIpO1xuICAgICAgICByZXZhbGlkYXRlVGFnKGBsZWFkZXJib2FyZC0ke2NvbnRlc3RJZH1gLCBcIm1heFwiKTtcblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBmaW5hbGl6ZSBjb250ZXN0OlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZmluYWxpemUgY29udGVzdFwiIH07XG4gICAgfVxufVxuXG4vKipcbiAqIFZlcmlmeSBjb250ZXN0IHBhc3N3b3JkIHdpdGhvdXQgc3RhcnRpbmcgc2Vzc2lvbi5cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHZlcmlmeUNvbnRlc3RQYXNzd29yZChjb250ZXN0SWQ6IHN0cmluZywgcGFzc3dvcmQ/OiBzdHJpbmcpIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIGlmICghc2Vzc2lvbj8udXNlcikgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjb250ZXN0ID0gYXdhaXQgcHJpc21hLmNvbnRlc3QuZmluZFVuaXF1ZSh7XG4gICAgICAgICAgICB3aGVyZTogeyBpZDogY29udGVzdElkIH0sXG4gICAgICAgICAgICBzZWxlY3Q6IHsgY29udGVzdFBhc3N3b3JkOiB0cnVlIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKCFjb250ZXN0KSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiQ29udGVzdCBub3QgZm91bmRcIiB9O1xuXG4gICAgICAgIGlmIChjb250ZXN0LmNvbnRlc3RQYXNzd29yZCAmJiBjb250ZXN0LmNvbnRlc3RQYXNzd29yZCAhPT0gcGFzc3dvcmQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJJbnZhbGlkIGNvbnRlc3QgcGFzc3dvcmRcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gdmVyaWZ5IGNvbnRlc3QgcGFzc3dvcmQ6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byB2ZXJpZnkgcGFzc3dvcmRcIiB9O1xuICAgIH1cbn1cblxuXG4vKipcbiAqIFN0YXJ0IGEgY29udGVzdCBzZXNzaW9uIC0gdmFsaWRhdGVzIHRpbWUgYm91bmRzIGFuZCBjcmVhdGVzIHNlc3Npb24gSURcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHN0YXJ0Q29udGVzdFNlc3Npb24oY29udGVzdElkOiBzdHJpbmcsIHBhc3N3b3JkPzogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICBpZiAoIXNlc3Npb24/LnVzZXIpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgY29udGVzdCA9IGF3YWl0IHByaXNtYS5jb250ZXN0LmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IGNvbnRlc3RJZCB9LFxuICAgICAgICAgICAgc2VsZWN0OiB7IHN0YXJ0VGltZTogdHJ1ZSwgZW5kVGltZTogdHJ1ZSwgY29udGVzdFBhc3N3b3JkOiB0cnVlIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKCFjb250ZXN0KSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiQ29udGVzdCBub3QgZm91bmRcIiB9O1xuXG4gICAgICAgIGlmIChjb250ZXN0LmNvbnRlc3RQYXNzd29yZCAmJiBjb250ZXN0LmNvbnRlc3RQYXNzd29yZCAhPT0gcGFzc3dvcmQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJJbnZhbGlkIGNvbnRlc3QgcGFzc3dvcmRcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcblxuICAgICAgICAvLyBUaW1lIGJvdW5kcyBjaGVja1xuICAgICAgICBpZiAobm93IDwgY29udGVzdC5zdGFydFRpbWUpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJDb250ZXN0IGhhcyBub3Qgc3RhcnRlZCB5ZXRcIiB9O1xuICAgICAgICB9XG4gICAgICAgIGlmIChub3cgPiBjb250ZXN0LmVuZFRpbWUpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJDb250ZXN0IGhhcyBhbHJlYWR5IGVuZGVkXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEdlbmVyYXRlIHVuaXF1ZSBzZXNzaW9uIElEXG4gICAgICAgIGNvbnN0IHNlc3Npb25JZCA9IGAke3Nlc3Npb24udXNlci5pZH0tJHtjb250ZXN0SWR9LSR7RGF0ZS5ub3coKX1gO1xuXG4gICAgICAgIC8vIENoZWNrIGZvciBleGlzdGluZyBhY3RpdmUgc2Vzc2lvbiAobXVsdGktdGFiIGRldGVjdGlvbilcbiAgICAgICAgY29uc3QgZXhpc3RpbmdQYXJ0aWNpcGF0aW9uID0gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKGV4aXN0aW5nUGFydGljaXBhdGlvbj8uaXNCbG9ja2VkKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiWW91IGhhdmUgYmVlbiBibG9ja2VkIGZyb20gdGhpcyBjb250ZXN0IGR1ZSB0byB2aW9sYXRpb25zXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChleGlzdGluZ1BhcnRpY2lwYXRpb24/LmlzRmluaXNoZWQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJZb3UgaGF2ZSBhbHJlYWR5IGZpbmlzaGVkIHRoaXMgY29udGVzdFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBVcGRhdGUgb3IgY3JlYXRlIHBhcnRpY2lwYXRpb24gd2l0aCBuZXcgc2Vzc2lvblxuICAgICAgICBjb25zdCBwYXJ0aWNpcGF0aW9uID0gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLnVwc2VydCh7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgIHVzZXJJZF9jb250ZXN0SWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkOiBzZXNzaW9uLnVzZXIuaWQsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlc3RJZDogY29udGVzdElkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHVwZGF0ZToge1xuICAgICAgICAgICAgICAgIHNlc3Npb25JZCxcbiAgICAgICAgICAgICAgICBzZXNzaW9uU3RhcnRlZEF0OiBub3csXG4gICAgICAgICAgICAgICAgYWNjZXB0ZWRSdWxlczogdHJ1ZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNyZWF0ZToge1xuICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgIGNvbnRlc3RJZDogY29udGVzdElkLFxuICAgICAgICAgICAgICAgIHNlc3Npb25JZCxcbiAgICAgICAgICAgICAgICBzZXNzaW9uU3RhcnRlZEF0OiBub3csXG4gICAgICAgICAgICAgICAgYWNjZXB0ZWRSdWxlczogdHJ1ZVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgIHNlc3Npb25JZCxcbiAgICAgICAgICAgIHBhcnRpY2lwYXRpb25JZDogcGFydGljaXBhdGlvbi5pZCxcbiAgICAgICAgICAgIHRvdGFsVmlvbGF0aW9uczogcGFydGljaXBhdGlvbi50b3RhbFZpb2xhdGlvbnMsXG4gICAgICAgICAgICBpc0ZsYWdnZWQ6IHBhcnRpY2lwYXRpb24uaXNGbGFnZ2VkXG4gICAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBzdGFydCBjb250ZXN0IHNlc3Npb246XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBzdGFydCBjb250ZXN0IHNlc3Npb25cIiB9O1xuICAgIH1cbn1cblxuLyoqXG4gKiBMb2cgYSBjb250ZXN0IHZpb2xhdGlvbiAtIHJlY29yZHMgdG8gZGF0YWJhc2UgYW5kIHVwZGF0ZXMgY291bnRlcnNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxvZ0NvbnRlc3RWaW9sYXRpb24oXG4gICAgY29udGVzdElkOiBzdHJpbmcsXG4gICAgdHlwZTogXCJUQUJfU1dJVENIXCIgfCBcIkZVTExTQ1JFRU5fRVhJVFwiIHwgXCJDT1BZX1BBU1RFXCIgfCBcIkRFVlRPT0xTX09QRU5cIiB8IFwiS0VZQk9BUkRfU0hPUlRDVVRcIiB8IFwiTkFWSUdBVElPTl9BVFRFTVBUXCIgfCBcIk1VTFRJX1RBQlwiIHwgXCJTVVNQSUNJT1VTX0lOUFVUXCIsXG4gICAgbWVzc2FnZT86IHN0cmluZyxcbiAgICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT5cbikge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcblxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHBhcnRpY2lwYXRpb24gPSBhd2FpdCBwcmlzbWEuY29udGVzdFBhcnRpY2lwYXRpb24uZmluZFVuaXF1ZSh7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgIHVzZXJJZF9jb250ZXN0SWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkOiBzZXNzaW9uLnVzZXIuaWQsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlc3RJZDogY29udGVzdElkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoIXBhcnRpY2lwYXRpb24pIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJObyBhY3RpdmUgcGFydGljaXBhdGlvbiBmb3VuZFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBEZXRlcm1pbmUgd2hpY2ggY291bnRlciB0byBpbmNyZW1lbnRcbiAgICAgICAgY29uc3QgY291bnRlckZpZWxkID0ge1xuICAgICAgICAgICAgVEFCX1NXSVRDSDogXCJ0YWJTd2l0Y2hDb3VudFwiLFxuICAgICAgICAgICAgRlVMTFNDUkVFTl9FWElUOiBcImZ1bGxzY3JlZW5FeGl0Q291bnRcIixcbiAgICAgICAgICAgIENPUFlfUEFTVEU6IFwiY29weVBhc3RlQ291bnRcIixcbiAgICAgICAgICAgIERFVlRPT0xTX09QRU46IFwiZGV2VG9vbHNDb3VudFwiLFxuICAgICAgICAgICAgS0VZQk9BUkRfU0hPUlRDVVQ6IFwia2V5Ym9hcmRDb3VudFwiLFxuICAgICAgICAgICAgTkFWSUdBVElPTl9BVFRFTVBUOiBcIm5hdmlnYXRpb25Db3VudFwiLFxuICAgICAgICAgICAgTVVMVElfVEFCOiBcInRhYlN3aXRjaENvdW50XCIsXG4gICAgICAgICAgICBTVVNQSUNJT1VTX0lOUFVUOiBcImNvcHlQYXN0ZUNvdW50XCJcbiAgICAgICAgfVt0eXBlXSBhcyBzdHJpbmc7XG5cbiAgICAgICAgLy8gVXNlIHRyYW5zYWN0aW9uIHRvIGVuc3VyZSBhdG9taWMgdXBkYXRlXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHByaXNtYS4kdHJhbnNhY3Rpb24oYXN5bmMgKHR4KSA9PiB7XG4gICAgICAgICAgICAvLyBDaGVjayBsYXN0IHZpb2xhdGlvbiB0aW1lIHRvIHByZXZlbnQgcmFwaWQtZmlyZSBkdXBsaWNhdGVzIChTZXJ2ZXItc2lkZSBkZWJvdW5jZSlcbiAgICAgICAgICAgIGNvbnN0IGxhc3RWaW9sYXRpb24gPSBhd2FpdCB0eC5jb250ZXN0VmlvbGF0aW9uLmZpbmRGaXJzdCh7XG4gICAgICAgICAgICAgICAgd2hlcmU6IHsgcGFydGljaXBhdGlvbklkOiBwYXJ0aWNpcGF0aW9uLmlkIH0sXG4gICAgICAgICAgICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6ICdkZXNjJyB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKGxhc3RWaW9sYXRpb24pIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0aW1lRGlmZiA9IERhdGUubm93KCkgLSBsYXN0VmlvbGF0aW9uLmNyZWF0ZWRBdC5nZXRUaW1lKCk7XG4gICAgICAgICAgICAgICAgLy8gSWYgbGVzcyB0aGFuIDIgc2Vjb25kcyBzaW5jZSBsYXN0IHZpb2xhdGlvbiwgaWdub3JlIHRoaXMgb25lXG4gICAgICAgICAgICAgICAgaWYgKHRpbWVEaWZmIDwgMjAwMCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgLi4ucGFydGljaXBhdGlvbiwgLy8gUmV0dXJuIGV4aXN0aW5nIHN0YXRlXG4gICAgICAgICAgICAgICAgICAgICAgICBpc0ZsYWdnZWQ6IHBhcnRpY2lwYXRpb24uaXNGbGFnZ2VkLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNCbG9ja2VkOiBwYXJ0aWNpcGF0aW9uLmlzQmxvY2tlZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsVmlvbGF0aW9uczogcGFydGljaXBhdGlvbi50b3RhbFZpb2xhdGlvbnMsXG4gICAgICAgICAgICAgICAgICAgICAgICBwZXJtYW5lbnRseUJsb2NrZWQ6IHBhcnRpY2lwYXRpb24ucGVybWFuZW50bHlCbG9ja2VkLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcEJsb2NrZWRVbnRpbDogcGFydGljaXBhdGlvbi50ZW1wQmxvY2tlZFVudGlsXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBDcmVhdGUgdmlvbGF0aW9uIHJlY29yZFxuICAgICAgICAgICAgYXdhaXQgdHguY29udGVzdFZpb2xhdGlvbi5jcmVhdGUoe1xuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgcGFydGljaXBhdGlvbklkOiBwYXJ0aWNpcGF0aW9uLmlkLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiB0eXBlIGFzIGFueSxcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZSxcbiAgICAgICAgICAgICAgICAgICAgbWV0YWRhdGE6IG1ldGFkYXRhID8/IHVuZGVmaW5lZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBDYWxjdWxhdGUgbmV3IHRvdGFsIGFuZCBkZXRlcm1pbmUgYmxvY2tpbmcgdGllclxuICAgICAgICAgICAgY29uc3QgbmV3VG90YWxWaW9sYXRpb25zID0gcGFydGljaXBhdGlvbi50b3RhbFZpb2xhdGlvbnMgKyAxO1xuICAgICAgICAgICAgY29uc3Qgc2hvdWxkRmxhZyA9IG5ld1RvdGFsVmlvbGF0aW9ucyA+PSAzO1xuXG4gICAgICAgICAgICAvLyBUaWVyZWQgYmxvY2tpbmcgbG9naWNcbiAgICAgICAgICAgIGxldCB0ZW1wQmxvY2tlZFVudGlsOiBEYXRlIHwgbnVsbCA9IG51bGw7XG4gICAgICAgICAgICBsZXQgcGVybWFuZW50bHlCbG9ja2VkID0gZmFsc2U7XG4gICAgICAgICAgICBsZXQgaXNCbG9ja2VkID0gZmFsc2U7XG5cbiAgICAgICAgICAgIGlmIChuZXdUb3RhbFZpb2xhdGlvbnMgPj0gNikge1xuICAgICAgICAgICAgICAgIC8vIDYrIHZpb2xhdGlvbnMgPSBwZXJtYW5lbnQgYmxvY2tcbiAgICAgICAgICAgICAgICBwZXJtYW5lbnRseUJsb2NrZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGlzQmxvY2tlZCA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKG5ld1RvdGFsVmlvbGF0aW9ucyA+PSA0KSB7XG4gICAgICAgICAgICAgICAgLy8gNC01IHZpb2xhdGlvbnMgPSA1IG1pbnV0ZSB0ZW1wIGJsb2NrXG4gICAgICAgICAgICAgICAgdGVtcEJsb2NrZWRVbnRpbCA9IG5ldyBEYXRlKERhdGUubm93KCkgKyA1ICogNjAgKiAxMDAwKTsgLy8gNSBtaW51dGVzXG4gICAgICAgICAgICAgICAgaXNCbG9ja2VkID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgdXBkYXRlZCA9IGF3YWl0IHR4LmNvbnRlc3RQYXJ0aWNpcGF0aW9uLnVwZGF0ZSh7XG4gICAgICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IHBhcnRpY2lwYXRpb24uaWQgfSxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIFtjb3VudGVyRmllbGRdOiB7IGluY3JlbWVudDogMSB9LFxuICAgICAgICAgICAgICAgICAgICB0b3RhbFZpb2xhdGlvbnM6IHsgaW5jcmVtZW50OiAxIH0sXG4gICAgICAgICAgICAgICAgICAgIGlzRmxhZ2dlZDogc2hvdWxkRmxhZyB8fCBwYXJ0aWNpcGF0aW9uLmlzRmxhZ2dlZCxcbiAgICAgICAgICAgICAgICAgICAgaXNCbG9ja2VkLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wQmxvY2tlZFVudGlsLFxuICAgICAgICAgICAgICAgICAgICBwZXJtYW5lbnRseUJsb2NrZWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHVwZGF0ZWQ7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgdG90YWxWaW9sYXRpb25zOiByZXN1bHQudG90YWxWaW9sYXRpb25zLFxuICAgICAgICAgICAgaXNGbGFnZ2VkOiByZXN1bHQuaXNGbGFnZ2VkLFxuICAgICAgICAgICAgaXNCbG9ja2VkOiByZXN1bHQuaXNCbG9ja2VkLFxuICAgICAgICAgICAgdGVtcEJsb2NrZWRVbnRpbDogcmVzdWx0LnRlbXBCbG9ja2VkVW50aWw/LnRvSVNPU3RyaW5nKCkgfHwgbnVsbCxcbiAgICAgICAgICAgIHBlcm1hbmVudGx5QmxvY2tlZDogcmVzdWx0LnBlcm1hbmVudGx5QmxvY2tlZFxuICAgICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gbG9nIHZpb2xhdGlvbjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGxvZyB2aW9sYXRpb25cIiB9O1xuICAgIH1cbn1cblxuLyoqXG4gKiBWYWxpZGF0ZSBjb250ZXN0IHNlc3Npb24gLSBjaGVja3MgaWYgc2Vzc2lvbiBpcyB2YWxpZCBmb3Igc3VibWlzc2lvbnNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHZhbGlkYXRlQ29udGVzdFNlc3Npb24oY29udGVzdElkOiBzdHJpbmcsIHNlc3Npb25JZDogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICBpZiAoIXNlc3Npb24/LnVzZXIpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCB2YWxpZDogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBwYXJ0aWNpcGF0aW9uID0gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgY29udGVzdDoge1xuICAgICAgICAgICAgICAgICAgICBzZWxlY3Q6IHsgc3RhcnRUaW1lOiB0cnVlLCBlbmRUaW1lOiB0cnVlIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICghcGFydGljaXBhdGlvbikge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgdmFsaWQ6IGZhbHNlLCByZWFzb246IFwiTm8gcGFydGljaXBhdGlvbiBmb3VuZFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDaGVjayBpZiBibG9ja2VkXG4gICAgICAgIGlmIChwYXJ0aWNpcGF0aW9uLmlzQmxvY2tlZCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgdmFsaWQ6IGZhbHNlLCByZWFzb246IFwiQmxvY2tlZCBkdWUgdG8gdmlvbGF0aW9uc1wiIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDaGVjayBpZiBmaW5pc2hlZFxuICAgICAgICBpZiAocGFydGljaXBhdGlvbi5pc0ZpbmlzaGVkKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCB2YWxpZDogZmFsc2UsIHJlYXNvbjogXCJDb250ZXN0IGFscmVhZHkgZmluaXNoZWRcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ2hlY2sgc2Vzc2lvbiBJRCAobXVsdGktdGFiIGRldGVjdGlvbilcbiAgICAgICAgaWYgKHBhcnRpY2lwYXRpb24uc2Vzc2lvbklkICE9PSBzZXNzaW9uSWQpIHtcbiAgICAgICAgICAgIC8vIExvZyBtdWx0aS10YWIgdmlvbGF0aW9uXG4gICAgICAgICAgICBhd2FpdCBsb2dDb250ZXN0VmlvbGF0aW9uKGNvbnRlc3RJZCwgXCJNVUxUSV9UQUJcIiwgXCJNdWx0aXBsZSB0YWJzIGRldGVjdGVkXCIpO1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgdmFsaWQ6IGZhbHNlLCByZWFzb246IFwiU2Vzc2lvbiBtaXNtYXRjaCAtIHBvc3NpYmxlIG11bHRpcGxlIHRhYnNcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ2hlY2sgdGltZSBib3VuZHNcbiAgICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgICAgICAgaWYgKG5vdyA+IHBhcnRpY2lwYXRpb24uY29udGVzdC5lbmRUaW1lKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCB2YWxpZDogZmFsc2UsIHJlYXNvbjogXCJDb250ZXN0IGhhcyBlbmRlZFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgIHZhbGlkOiB0cnVlLFxuICAgICAgICAgICAgdG90YWxWaW9sYXRpb25zOiBwYXJ0aWNpcGF0aW9uLnRvdGFsVmlvbGF0aW9ucyxcbiAgICAgICAgICAgIGlzRmxhZ2dlZDogcGFydGljaXBhdGlvbi5pc0ZsYWdnZWRcbiAgICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIHZhbGlkYXRlIHNlc3Npb246XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIHZhbGlkOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIHZhbGlkYXRlIHNlc3Npb25cIiB9O1xuICAgIH1cbn1cblxuLyoqXG4gKiBDaGVjayBpZiB1c2VyIGlzIGVsaWdpYmxlIHRvIHN1Ym1pdCAtIHByZS1zdWJtaXNzaW9uIHZhbGlkYXRpb25cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNoZWNrU3VibWlzc2lvbkVsaWdpYmlsaXR5KGNvbnRlc3RJZDogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICBpZiAoIXNlc3Npb24/LnVzZXIpIHJldHVybiB7IGVsaWdpYmxlOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcblxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHBhcnRpY2lwYXRpb24gPSBhd2FpdCBwcmlzbWEuY29udGVzdFBhcnRpY2lwYXRpb24uZmluZFVuaXF1ZSh7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgIHVzZXJJZF9jb250ZXN0SWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkOiBzZXNzaW9uLnVzZXIuaWQsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlc3RJZDogY29udGVzdElkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICBjb250ZXN0OiB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdDogeyBzdGFydFRpbWU6IHRydWUsIGVuZFRpbWU6IHRydWUgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKCFwYXJ0aWNpcGF0aW9uKSB7XG4gICAgICAgICAgICByZXR1cm4geyBlbGlnaWJsZTogZmFsc2UsIHJlYXNvbjogXCJObyBwYXJ0aWNpcGF0aW9uIGZvdW5kXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENoZWNrIHZhcmlvdXMgY29uZGl0aW9uc1xuICAgICAgICBpZiAocGFydGljaXBhdGlvbi5pc0Jsb2NrZWQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IGVsaWdpYmxlOiBmYWxzZSwgcmVhc29uOiBcIkJsb2NrZWQgZHVlIHRvIGV4Y2Vzc2l2ZSB2aW9sYXRpb25zXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChwYXJ0aWNpcGF0aW9uLmlzRmluaXNoZWQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IGVsaWdpYmxlOiBmYWxzZSwgcmVhc29uOiBcIllvdSBoYXZlIGFscmVhZHkgZmluaXNoZWQgdGhpcyBjb250ZXN0XCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgICAgIGlmIChub3cgPCBwYXJ0aWNpcGF0aW9uLmNvbnRlc3Quc3RhcnRUaW1lKSB7XG4gICAgICAgICAgICByZXR1cm4geyBlbGlnaWJsZTogZmFsc2UsIHJlYXNvbjogXCJDb250ZXN0IGhhcyBub3Qgc3RhcnRlZFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobm93ID4gcGFydGljaXBhdGlvbi5jb250ZXN0LmVuZFRpbWUpIHtcbiAgICAgICAgICAgIHJldHVybiB7IGVsaWdpYmxlOiBmYWxzZSwgcmVhc29uOiBcIkNvbnRlc3QgaGFzIGVuZGVkXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBlbGlnaWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHdhcm5pbmdzOiBwYXJ0aWNpcGF0aW9uLmlzRmxhZ2dlZCA/IFtcIllvdXIgc2Vzc2lvbiBoYXMgYmVlbiBmbGFnZ2VkIGZvciByZXZpZXdcIl0gOiBbXVxuICAgICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gY2hlY2sgZWxpZ2liaWxpdHk6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgZWxpZ2libGU6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gY2hlY2sgZWxpZ2liaWxpdHlcIiB9O1xuICAgIH1cbn1cblxuLyoqXG4gKiBHZXQgcGFydGljaXBhdGlvbiBzdGF0dXMgLSBmb3IgVUkgc3RhdGVcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFBhcnRpY2lwYXRpb25TdGF0dXMoY29udGVzdElkOiBzdHJpbmcpIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIGlmICghc2Vzc2lvbj8udXNlcikgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBwYXJ0aWNpcGF0aW9uID0gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgICBhY2NlcHRlZFJ1bGVzOiB0cnVlLFxuICAgICAgICAgICAgICAgIGlzRmluaXNoZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgaXNGbGFnZ2VkOiB0cnVlLFxuICAgICAgICAgICAgICAgIGlzQmxvY2tlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICB0b3RhbFZpb2xhdGlvbnM6IHRydWUsXG4gICAgICAgICAgICAgICAgc2Vzc2lvbklkOiB0cnVlLFxuICAgICAgICAgICAgICAgIHRlbXBCbG9ja2VkVW50aWw6IHRydWUsXG4gICAgICAgICAgICAgICAgcGVybWFuZW50bHlCbG9ja2VkOiB0cnVlXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIENoZWNrIGlmIHRlbXAgYmxvY2sgaGFzIGV4cGlyZWRcbiAgICAgICAgaWYgKHBhcnRpY2lwYXRpb24/LnRlbXBCbG9ja2VkVW50aWwgJiYgbmV3IERhdGUoKSA+IHBhcnRpY2lwYXRpb24udGVtcEJsb2NrZWRVbnRpbCkge1xuICAgICAgICAgICAgLy8gVGVtcCBibG9jayBleHBpcmVkIC0gdW5ibG9ja1xuICAgICAgICAgICAgYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLnVwZGF0ZSh7XG4gICAgICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkX2NvbnRlc3RJZDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgdXNlcklkOiBzZXNzaW9uLnVzZXIuaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIGlzQmxvY2tlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBCbG9ja2VkVW50aWw6IG51bGxcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgICAgIHBhcnRpY2lwYXRpb246IHtcbiAgICAgICAgICAgICAgICAgICAgLi4ucGFydGljaXBhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgaXNCbG9ja2VkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgdGVtcEJsb2NrZWRVbnRpbDogbnVsbFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgIHBhcnRpY2lwYXRpb246IHBhcnRpY2lwYXRpb24gfHwgbnVsbFxuICAgICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZ2V0IHBhcnRpY2lwYXRpb24gc3RhdHVzXCIgfTtcbiAgICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBDT05URVNUIE1BTkFHRVIgLSBQQVJUSUNJUEFOVCBNQU5BR0VNRU5UXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqIEdldCBhbGwgcGFydGljaXBhbnRzIGZvciBhIGNvbnRlc3Qgd2l0aCB2aW9sYXRpb24gZGV0YWlscyAoZm9yIG1hbmFnZXJzKVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q29udGVzdFBhcnRpY2lwYW50cyhjb250ZXN0SWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcblxuICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gc2Vzc2lvbi51c2VyIGFzIGFueTtcblxuICAgIC8vIENoZWNrIGlmIHVzZXIgaXMgY29udGVzdCBtYW5hZ2VyL2NyZWF0b3JcbiAgICBjb25zdCBjb250ZXN0ID0gYXdhaXQgcHJpc21hLmNvbnRlc3QuZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiBjb250ZXN0SWQgfSxcbiAgICAgICAgc2VsZWN0OiB7IGNyZWF0b3JJZDogdHJ1ZSB9XG4gICAgfSk7XG5cbiAgICBpZiAoIWNvbnRlc3QpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJDb250ZXN0IG5vdCBmb3VuZFwiIH07XG5cbiAgICBjb25zdCBpc0F1dGhvcml6ZWQgPVxuICAgICAgICBjdXJyZW50VXNlci5yb2xlID09PSBcIkFETUlOXCIgfHxcbiAgICAgICAgY3VycmVudFVzZXIucm9sZSA9PT0gXCJDT05URVNUX01BTkFHRVJcIiB8fFxuICAgICAgICBjdXJyZW50VXNlci5yb2xlID09PSBcIlRFQUNIRVJcIiB8fFxuICAgICAgICBjb250ZXN0LmNyZWF0b3JJZCA9PT0gY3VycmVudFVzZXIuaWQ7XG5cbiAgICBpZiAoIWlzQXV0aG9yaXplZCkge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBwYXJ0aWNpcGFudHMgPSBhd2FpdCBwcmlzbWEuY29udGVzdFBhcnRpY2lwYXRpb24uZmluZE1hbnkoe1xuICAgICAgICAgICAgd2hlcmU6IHsgY29udGVzdElkIH0sXG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVtYWlsOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgaW1hZ2U6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgdmlvbGF0aW9uczoge1xuICAgICAgICAgICAgICAgICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogXCJkZXNjXCIgfSxcbiAgICAgICAgICAgICAgICAgICAgdGFrZTogMTBcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb3JkZXJCeTogW1xuICAgICAgICAgICAgICAgIHsgcGVybWFuZW50bHlCbG9ja2VkOiBcImRlc2NcIiB9LFxuICAgICAgICAgICAgICAgIHsgaXNCbG9ja2VkOiBcImRlc2NcIiB9LFxuICAgICAgICAgICAgICAgIHsgdG90YWxWaW9sYXRpb25zOiBcImRlc2NcIiB9XG4gICAgICAgICAgICBdXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHBhcnRpY2lwYW50cyB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gZ2V0IHBhcnRpY2lwYW50czpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGdldCBwYXJ0aWNpcGFudHNcIiB9O1xuICAgIH1cbn1cblxuLyoqXG4gKiBVbmJsb2NrIGEgcGFydGljaXBhbnQgKG1hbmFnZXIgb25seSlcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVuYmxvY2tQYXJ0aWNpcGFudChjb250ZXN0SWQ6IHN0cmluZywgdXNlcklkOiBzdHJpbmcpIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIGlmICghc2Vzc2lvbj8udXNlcikgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG5cbiAgICBjb25zdCBjdXJyZW50VXNlciA9IHNlc3Npb24udXNlciBhcyBhbnk7XG5cbiAgICAvLyBDaGVjayBhdXRob3JpemF0aW9uXG4gICAgY29uc3QgY29udGVzdCA9IGF3YWl0IHByaXNtYS5jb250ZXN0LmZpbmRVbmlxdWUoe1xuICAgICAgICB3aGVyZTogeyBpZDogY29udGVzdElkIH0sXG4gICAgICAgIHNlbGVjdDogeyBjcmVhdG9ySWQ6IHRydWUgfVxuICAgIH0pO1xuXG4gICAgaWYgKCFjb250ZXN0KSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiQ29udGVzdCBub3QgZm91bmRcIiB9O1xuXG4gICAgY29uc3QgaXNBdXRob3JpemVkID1cbiAgICAgICAgY3VycmVudFVzZXIucm9sZSA9PT0gXCJBRE1JTlwiIHx8XG4gICAgICAgIGN1cnJlbnRVc2VyLnJvbGUgPT09IFwiQ09OVEVTVF9NQU5BR0VSXCIgfHxcbiAgICAgICAgY3VycmVudFVzZXIucm9sZSA9PT0gXCJURUFDSEVSXCIgfHxcbiAgICAgICAgY29udGVzdC5jcmVhdG9ySWQgPT09IGN1cnJlbnRVc2VyLmlkO1xuXG4gICAgaWYgKCFpc0F1dGhvcml6ZWQpIHtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLnVwZGF0ZSh7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgIHVzZXJJZF9jb250ZXN0SWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgIGlzQmxvY2tlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgdGVtcEJsb2NrZWRVbnRpbDogbnVsbCxcbiAgICAgICAgICAgICAgICBwZXJtYW5lbnRseUJsb2NrZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHRvdGFsVmlvbGF0aW9uczogMCxcbiAgICAgICAgICAgICAgICB0YWJTd2l0Y2hDb3VudDogMCxcbiAgICAgICAgICAgICAgICBmdWxsc2NyZWVuRXhpdENvdW50OiAwLFxuICAgICAgICAgICAgICAgIGNvcHlQYXN0ZUNvdW50OiAwLFxuICAgICAgICAgICAgICAgIGRldlRvb2xzQ291bnQ6IDAsXG4gICAgICAgICAgICAgICAga2V5Ym9hcmRDb3VudDogMCxcbiAgICAgICAgICAgICAgICBuYXZpZ2F0aW9uQ291bnQ6IDAsXG4gICAgICAgICAgICAgICAgaXNGbGFnZ2VkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICB1bmJsb2NrZWRCeTogY3VycmVudFVzZXIuaWQsXG4gICAgICAgICAgICAgICAgdW5ibG9ja2VkQXQ6IG5ldyBEYXRlKClcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV2YWxpZGF0ZVBhdGgoYC9kYXNoYm9hcmQvY29udGVzdHMvJHtjb250ZXN0SWR9L3BhcnRpY2lwYW50c2ApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byB1bmJsb2NrIHBhcnRpY2lwYW50OlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gdW5ibG9jayBwYXJ0aWNpcGFudFwiIH07XG4gICAgfVxufVxuXG4vKipcbiAqIEdldCBkZXRhaWxlZCB2aW9sYXRpb25zIGZvciBhIHBhcnRpY2lwYW50XG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRQYXJ0aWNpcGFudFZpb2xhdGlvbnMoY29udGVzdElkOiBzdHJpbmcsIHVzZXJJZDogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICBpZiAoIXNlc3Npb24/LnVzZXIpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuXG4gICAgY29uc3QgY3VycmVudFVzZXIgPSBzZXNzaW9uLnVzZXIgYXMgYW55O1xuXG4gICAgLy8gQ2hlY2sgYXV0aG9yaXphdGlvblxuICAgIGNvbnN0IGNvbnRlc3QgPSBhd2FpdCBwcmlzbWEuY29udGVzdC5maW5kVW5pcXVlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6IGNvbnRlc3RJZCB9LFxuICAgICAgICBzZWxlY3Q6IHsgY3JlYXRvcklkOiB0cnVlIH1cbiAgICB9KTtcblxuICAgIGlmICghY29udGVzdCkgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkNvbnRlc3Qgbm90IGZvdW5kXCIgfTtcblxuICAgIGNvbnN0IGlzQXV0aG9yaXplZCA9XG4gICAgICAgIGN1cnJlbnRVc2VyLnJvbGUgPT09IFwiQURNSU5cIiB8fFxuICAgICAgICBjdXJyZW50VXNlci5yb2xlID09PSBcIkNPTlRFU1RfTUFOQUdFUlwiIHx8XG4gICAgICAgIGN1cnJlbnRVc2VyLnJvbGUgPT09IFwiVEVBQ0hFUlwiIHx8XG4gICAgICAgIGNvbnRlc3QuY3JlYXRvcklkID09PSBjdXJyZW50VXNlci5pZDtcblxuICAgIGlmICghaXNBdXRob3JpemVkKSB7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHBhcnRpY2lwYXRpb24gPSBhd2FpdCBwcmlzbWEuY29udGVzdFBhcnRpY2lwYXRpb24uZmluZFVuaXF1ZSh7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgIHVzZXJJZF9jb250ZXN0SWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0OiB7IGlkOiB0cnVlLCBuYW1lOiB0cnVlLCBlbWFpbDogdHJ1ZSB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB2aW9sYXRpb25zOiB7XG4gICAgICAgICAgICAgICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiBcImRlc2NcIiB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBwYXJ0aWNpcGF0aW9uIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBnZXQgdmlvbGF0aW9uc1wiIH07XG4gICAgfVxufVxuXG4vKipcbiAqIENhbGN1bGF0ZSBjb250ZXN0IGxlYWRlcmJvYXJkXG4gKiAtIEZldGNoZXMgYWxsIHBhcnRpY2lwYXRpb25zXG4gKiAtIEZldGNoZXMgYWxsIHJlbGV2YW50IHN1Ym1pc3Npb25zXG4gKiAtIENhbGN1bGF0ZXMgc2NvcmVzXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRDb250ZXN0TGVhZGVyYm9hcmQoY29udGVzdElkOiBzdHJpbmcpIHtcbiAgICBcInVzZSBjYWNoZVwiXG4gICAgY2FjaGVUYWcoYGxlYWRlcmJvYXJkLSR7Y29udGVzdElkfWApXG4gICAgY2FjaGVMaWZlKFwibGVhZGVyYm9hcmRcIilcblxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHBhcnRpY2lwYXRpb25zID0gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLmZpbmRNYW55KHtcbiAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgY29udGVzdElkLFxuICAgICAgICAgICAgICAgIC8vIHN0YXJ0ZWRBdDogeyBub3Q6IG51bGwgfSAvLyBPbmx5IHN0YXJ0ZWQgcGFydGljaXBhbnRzIChGaXggaWYgZmllbGQgZXhpc3RzLCBvdGhlcndpc2UgcmVseSBvbiBjcmVhdGVkKVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgaW1hZ2U6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgY29udGVzdCA9IGF3YWl0IHByaXNtYS5jb250ZXN0LmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IGNvbnRlc3RJZCB9LFxuICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgIHByb2JsZW1zOiB7XG4gICAgICAgICAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2JsZW06IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaWZmaWN1bHR5OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbHVnOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29yZTogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgb3JkZXJCeTogeyBvcmRlcjogXCJhc2NcIiB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoIWNvbnRlc3QpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJDb250ZXN0IG5vdCBmb3VuZFwiIH07XG5cbiAgICAgICAgY29uc3QgbGVhZGVyYm9hcmQgPSBhd2FpdCBQcm9taXNlLmFsbChwYXJ0aWNpcGF0aW9ucy5tYXAoYXN5bmMgKHApID0+IHtcbiAgICAgICAgICAgIC8vIEdldCB2YWxpZCBzdWJtaXNzaW9ucyBmb3IgdGhpcyB1c2VyIGluIHRoaXMgY29udGVzdFxuICAgICAgICAgICAgY29uc3Qgc3VibWlzc2lvbnMgPSBhd2FpdCBwcmlzbWEuc3VibWlzc2lvbi5maW5kTWFueSh7XG4gICAgICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkOiBwLnVzZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgY29udGVzdElkOiBjb250ZXN0SWQsXG4gICAgICAgICAgICAgICAgICAgIGNyZWF0ZWRBdDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgZ3RlOiBjb250ZXN0LnN0YXJ0VGltZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGx0ZTogY29udGVzdC5lbmRUaW1lXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBwcm9ibGVtSWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGNyZWF0ZWRBdDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgbGFuZ3VhZ2U6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBDYWxjdWxhdGUgdG90YWwgc2NvcmVcbiAgICAgICAgICAgIC8vIExvZ2ljOiBCZXN0IHN1Ym1pc3Npb24gcGVyIHByb2JsZW0gY291bnRzXG4gICAgICAgICAgICBjb25zdCBwcm9ibGVtU2NvcmVzID0gbmV3IE1hcDxzdHJpbmcsIG51bWJlcj4oKTtcbiAgICAgICAgICAgIGNvbnN0IHByb2JsZW1Tb2x2ZVRpbWVzID0gbmV3IE1hcDxzdHJpbmcsIERhdGU+KCk7XG4gICAgICAgICAgICBjb25zdCBwcm9ibGVtU3VibWlzc2lvbkNvdW50cyA9IG5ldyBNYXA8c3RyaW5nLCBudW1iZXI+KCk7XG4gICAgICAgICAgICBjb25zdCBwcm9ibGVtQmVzdFN1Ym1pc3Npb25zID0gbmV3IE1hcDxzdHJpbmcsIGFueT4oKTtcblxuICAgICAgICAgICAgc3VibWlzc2lvbnMuZm9yRWFjaChzdWIgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRDb3VudCA9IHByb2JsZW1TdWJtaXNzaW9uQ291bnRzLmdldChzdWIucHJvYmxlbUlkKSB8fCAwO1xuICAgICAgICAgICAgICAgIHByb2JsZW1TdWJtaXNzaW9uQ291bnRzLnNldChzdWIucHJvYmxlbUlkLCBjdXJyZW50Q291bnQgKyAxKTtcblxuICAgICAgICAgICAgICAgIGlmIChzdWIuc3RhdHVzID09PSBcIkFDQ0VQVEVEXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudEJlc3QgPSBwcm9ibGVtU2NvcmVzLmdldChzdWIucHJvYmxlbUlkKSB8fCAwO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBwcm9ibGVtRGVmID0gY29udGVzdC5wcm9ibGVtcy5maW5kKGNwID0+IGNwLnByb2JsZW1JZCA9PT0gc3ViLnByb2JsZW1JZCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG1heFNjb3JlID0gcHJvYmxlbURlZj8ucHJvYmxlbS5zY29yZSB8fCAwO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChtYXhTY29yZSA+IGN1cnJlbnRCZXN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgcHJvYmxlbVNjb3Jlcy5zZXQoc3ViLnByb2JsZW1JZCwgbWF4U2NvcmUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRCZXN0VGltZSA9IHByb2JsZW1Tb2x2ZVRpbWVzLmdldChzdWIucHJvYmxlbUlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWN1cnJlbnRCZXN0VGltZSB8fCBzdWIuY3JlYXRlZEF0IDwgY3VycmVudEJlc3RUaW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2JsZW1Tb2x2ZVRpbWVzLnNldChzdWIucHJvYmxlbUlkLCBzdWIuY3JlYXRlZEF0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvYmxlbUJlc3RTdWJtaXNzaW9ucy5zZXQoc3ViLnByb2JsZW1JZCwgc3ViKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgbGV0IHRvdGFsU2NvcmUgPSAwO1xuICAgICAgICAgICAgbGV0IHRvdGFsVGltZU1zID0gMDtcblxuICAgICAgICAgICAgcHJvYmxlbVNjb3Jlcy5mb3JFYWNoKChzY29yZSwgcHJvYmxlbUlkKSA9PiB7XG4gICAgICAgICAgICAgICAgdG90YWxTY29yZSArPSBzY29yZTtcbiAgICAgICAgICAgICAgICBjb25zdCBzb2x2ZW50VGltZSA9IHByb2JsZW1Tb2x2ZVRpbWVzLmdldChwcm9ibGVtSWQpO1xuICAgICAgICAgICAgICAgIGlmIChzb2x2ZW50VGltZSkge1xuICAgICAgICAgICAgICAgICAgICB0b3RhbFRpbWVNcyArPSAoc29sdmVudFRpbWUuZ2V0VGltZSgpIC0gY29udGVzdC5zdGFydFRpbWUuZ2V0VGltZSgpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gTWFwIHN0YXRzIGZvciBlYWNoIHByb2JsZW0gaW4gdGhlIGNvbnRlc3RcbiAgICAgICAgICAgIGNvbnN0IHByb2JsZW1TdGF0cyA9IGNvbnRlc3QucHJvYmxlbXMubWFwKGNwID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBiZXN0U3ViID0gcHJvYmxlbUJlc3RTdWJtaXNzaW9ucy5nZXQoY3AucHJvYmxlbUlkKTtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBwcm9ibGVtSWQ6IGNwLnByb2JsZW1JZCxcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IGNwLnByb2JsZW0udGl0bGUsXG4gICAgICAgICAgICAgICAgICAgIHNsdWc6IGNwLnByb2JsZW0uc2x1ZyxcbiAgICAgICAgICAgICAgICAgICAgc2NvcmU6IHByb2JsZW1TY29yZXMuZ2V0KGNwLnByb2JsZW1JZCkgfHwgMCxcbiAgICAgICAgICAgICAgICAgICAgbWF4U2NvcmU6IGNwLnByb2JsZW0uc2NvcmUsXG4gICAgICAgICAgICAgICAgICAgIHN1Ym1pc3Npb25zOiBwcm9ibGVtU3VibWlzc2lvbkNvdW50cy5nZXQoY3AucHJvYmxlbUlkKSB8fCAwLFxuICAgICAgICAgICAgICAgICAgICBzb2x2ZWQ6IHByb2JsZW1TY29yZXMuaGFzKGNwLnByb2JsZW1JZCksXG4gICAgICAgICAgICAgICAgICAgIHNvbHZlZEF0OiBwcm9ibGVtU29sdmVUaW1lcy5nZXQoY3AucHJvYmxlbUlkKSxcbiAgICAgICAgICAgICAgICAgICAgbGFuZ3VhZ2U6IGJlc3RTdWI/Lmxhbmd1YWdlPy5uYW1lIHx8IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIGxhbmd1YWdlSWQ6IGJlc3RTdWI/Lmxhbmd1YWdlPy5pZCB8fCBudWxsXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnAudXNlcixcbiAgICAgICAgICAgICAgICBzY29yZTogdG90YWxTY29yZSxcbiAgICAgICAgICAgICAgICB0aW1lVGFrZW46IHRvdGFsVGltZU1zLFxuICAgICAgICAgICAgICAgIHByb2JsZW1zU29sdmVkOiBwcm9ibGVtU2NvcmVzLnNpemUsXG4gICAgICAgICAgICAgICAgcHJvYmxlbVN0YXRzXG4gICAgICAgICAgICB9O1xuICAgICAgICB9KSk7XG5cbiAgICAgICAgLy8gU29ydDogSGlnaCBzY29yZSBmaXJzdCwgdGhlbiBsb3cgdGltZSB0YWtlblxuICAgICAgICBsZWFkZXJib2FyZC5zb3J0KChhLCBiKSA9PiB7XG4gICAgICAgICAgICBpZiAoYi5zY29yZSAhPT0gYS5zY29yZSkgcmV0dXJuIGIuc2NvcmUgLSBhLnNjb3JlO1xuICAgICAgICAgICAgcmV0dXJuIGEudGltZVRha2VuIC0gYi50aW1lVGFrZW47XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgc3R1ZGVudHM6IGxlYWRlcmJvYXJkLFxuICAgICAgICAgICAgaXNGaW5hbGl6ZWQ6IGNvbnRlc3QuaXNGaW5hbGl6ZWQsXG4gICAgICAgICAgICBwcm9ibGVtczogY29udGVzdC5wcm9ibGVtcy5tYXAoY3AgPT4gKHtcbiAgICAgICAgICAgICAgICBpZDogY3AucHJvYmxlbUlkLFxuICAgICAgICAgICAgICAgIHRpdGxlOiBjcC5wcm9ibGVtLnRpdGxlLFxuICAgICAgICAgICAgICAgIHNsdWc6IGNwLnByb2JsZW0uc2x1ZyxcbiAgICAgICAgICAgICAgICBtYXhTY29yZTogY3AucHJvYmxlbS5zY29yZVxuICAgICAgICAgICAgfSkpXG4gICAgICAgIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiTGVhZGVyYm9hcmQgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBnZW5lcmF0ZSBsZWFkZXJib2FyZFwiIH07XG4gICAgfVxufVxuXG4vKipcbiAqIEdldCBjdXJyZW50IHVzZXIncyByYW5raW5nIGluIGEgY29udGVzdFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q29udGVzdFJhbmtpbmcoY29udGVzdElkOiBzdHJpbmcpIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIGlmICghc2Vzc2lvbj8udXNlcikgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBnZXRDb250ZXN0TGVhZGVyYm9hcmQoY29udGVzdElkKTtcblxuICAgICAgICBpZiAoIXJlc3VsdC5zdWNjZXNzIHx8ICFyZXN1bHQuc3R1ZGVudHMpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZ2V0IHJhbmtpbmdcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgcmFuayA9IHJlc3VsdC5zdHVkZW50cy5maW5kSW5kZXgoKHM6IGFueSkgPT4gcy5pZCA9PT0gc2Vzc2lvbi51c2VyLmlkKSArIDE7XG5cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgcmFuazogcmFuayA+IDAgPyByYW5rIDogbnVsbCB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGdldCByYW5raW5nXCIgfTtcbiAgICB9XG59XG4iXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6ImlTQWttQnNCIn0=
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/components/contest/ContestEntryModal.tsx [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "default",
    ()=>ContestEntryModal
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/jsx-dev-runtime.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/index.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$shield$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Shield$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/shield.js [app-client] (ecmascript) <export default as Shield>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$monitor$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Monitor$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/monitor.js [app-client] (ecmascript) <export default as Monitor>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$eye$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Eye$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/eye.js [app-client] (ecmascript) <export default as Eye>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$keyboard$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Keyboard$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/keyboard.js [app-client] (ecmascript) <export default as Keyboard>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$arrow$2d$right$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__ArrowRight$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/arrow-right.js [app-client] (ecmascript) <export default as ArrowRight>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$check$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Check$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/check.js [app-client] (ecmascript) <export default as Check>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$lock$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Lock$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/lock.js [app-client] (ecmascript) <export default as Lock>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$x$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__X$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/x.js [app-client] (ecmascript) <export default as X>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$chevron$2d$left$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__ChevronLeft$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/chevron-left.js [app-client] (ecmascript) <export default as ChevronLeft>");
var __TURBOPACK__imported__module__$5b$project$5d2f$actions$2f$data$3a$608faf__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__ = __turbopack_context__.i("[project]/actions/data:608faf [app-client] (ecmascript) <text/javascript>");
var __TURBOPACK__imported__module__$5b$project$5d2f$actions$2f$data$3a$afdd9d__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__ = __turbopack_context__.i("[project]/actions/data:afdd9d [app-client] (ecmascript) <text/javascript>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/sonner/dist/index.mjs [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$utils$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/utils.ts [app-client] (ecmascript)");
;
var _s = __turbopack_context__.k.signature();
"use client";
;
;
;
;
;
const RULES = [
    {
        icon: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$monitor$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Monitor$3e$__["Monitor"],
        title: "Fullscreen Enforced",
        description: "The contest runs in fullscreen. Exiting may be flagged."
    },
    {
        icon: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$eye$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Eye$3e$__["Eye"],
        title: "Focus Tracking",
        description: "Tab switching and window blurring are monitored."
    },
    {
        icon: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$keyboard$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Keyboard$3e$__["Keyboard"],
        title: "Input Restricted",
        description: "Copy-paste and developer tools are disabled."
    },
    {
        icon: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$shield$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Shield$3e$__["Shield"],
        title: "Proctored Environment",
        description: "suspicious activity is logged for review."
    }
];
function ContestEntryModal({ contestId, contestTitle, requiresPassword, isOpen, onClose, onStart }) {
    _s();
    const [isLoading, setIsLoading] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(false);
    const [step, setStep] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])("RULES");
    const [password, setPassword] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])("");
    const [agreed, setAgreed] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(false);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "ContestEntryModal.useEffect": ()=>{
            if (isOpen) {
                if (requiresPassword) {
                    setStep("PASSWORD");
                } else {
                    setStep("RULES");
                }
                setAgreed(false);
                setPassword("");
                setIsLoading(false);
            }
        }
    }["ContestEntryModal.useEffect"], [
        isOpen,
        requiresPassword
    ]);
    const handleVerifyPassword = async ()=>{
        if (!password) {
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error("Enter the contest password");
            return;
        }
        setIsLoading(true);
        try {
            const result = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$actions$2f$data$3a$afdd9d__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__["verifyContestPassword"])(contestId, password);
            if (result.success) {
                setStep("RULES");
                __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].success("Access granted");
            } else {
                __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error(result.error || "Incorrect password");
            }
        } catch  {
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error("Verification failed");
        } finally{
            setIsLoading(false);
        }
    };
    const handleStartContest = async ()=>{
        if (!agreed) return;
        setIsLoading(true);
        try {
            const result = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$actions$2f$data$3a$608faf__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__["startContestSession"])(contestId, password);
            if (!result.success) {
                __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error(result.error || "Could not start session");
                setIsLoading(false);
                return;
            }
            try {
                await document.documentElement.requestFullscreen();
            } catch (e) {
                console.warn("Fullscreen failed", e);
            }
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].success("Good luck!");
            onStart(result.sessionId);
        } catch  {
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error("Failed to initialize contest");
            setIsLoading(false);
        }
    };
    if (!isOpen) return null;
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
        className: "fixed inset-0 z-[9999] flex items-center justify-center p-4",
        children: [
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "absolute inset-0 bg-white/80 dark:bg-black/80 backdrop-blur-md transition-opacity",
                onClick: onClose
            }, void 0, false, {
                fileName: "[project]/components/contest/ContestEntryModal.tsx",
                lineNumber: 130,
                columnNumber: 7
            }, this),
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "relative bg-white dark:bg-[#0a0a0a] w-full max-w-md rounded-3xl shadow-2xl border border-gray-100 dark:border-[#262626] overflow-hidden animate-in fade-in zoom-in-95 duration-200",
                children: [
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "px-8 pt-8 flex items-center justify-between",
                        children: [
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                className: "flex gap-2",
                                children: [
                                    1,
                                    2,
                                    3
                                ].map((i)=>{
                                    // Calculate current step index
                                    let currentStepIdx = 0;
                                    if (requiresPassword) {
                                        if (step === "PASSWORD") currentStepIdx = 1;
                                        if (step === "RULES") currentStepIdx = 2;
                                        if (step === "CONFIRM") currentStepIdx = 3;
                                    } else {
                                        if (step === "RULES") currentStepIdx = 1; // Actually step 1 visually
                                        if (step === "CONFIRM") currentStepIdx = 2;
                                    }
                                    // Normalizing because map index is simple
                                    // If requiresPassword: Steps are Pass(1), Rules(2), Confirm(3)
                                    // If not: Rules(1), Confirm(2) -> effectively 2 steps visually
                                    const totalSteps = requiresPassword ? 3 : 2;
                                    if (i > totalSteps) return null;
                                    let isActive = false;
                                    if (requiresPassword) {
                                        if (i === 1 && step === "PASSWORD") isActive = true;
                                        if (i === 2 && step === "RULES") isActive = true;
                                        if (i === 3 && step === "CONFIRM") isActive = true;
                                    } else {
                                        if (i === 1 && step === "RULES") isActive = true;
                                        if (i === 2 && step === "CONFIRM") isActive = true;
                                    }
                                    const isCompleted = requiresPassword ? i === 1 && step !== "PASSWORD" || i === 2 && step === "CONFIRM" : i === 1 && step === "CONFIRM";
                                    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$utils$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["cn"])("h-1 rounded-full transition-all duration-300", isActive ? "w-8 bg-orange-600" : isCompleted ? "w-2 bg-orange-200 dark:bg-orange-900" : "w-2 bg-gray-100 dark:bg-[#262626]")
                                    }, i, false, {
                                        fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                        lineNumber: 174,
                                        columnNumber: 17
                                    }, this);
                                })
                            }, void 0, false, {
                                fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                lineNumber: 140,
                                columnNumber: 11
                            }, this),
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                onClick: onClose,
                                className: "p-2 -mr-2 text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors",
                                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$x$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__X$3e$__["X"], {
                                    className: "w-5 h-5"
                                }, void 0, false, {
                                    fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                    lineNumber: 185,
                                    columnNumber: 13
                                }, this)
                            }, void 0, false, {
                                fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                lineNumber: 184,
                                columnNumber: 11
                            }, this)
                        ]
                    }, void 0, true, {
                        fileName: "[project]/components/contest/ContestEntryModal.tsx",
                        lineNumber: 139,
                        columnNumber: 9
                    }, this),
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "p-8 min-h-[400px] flex flex-col",
                        children: [
                            step === "PASSWORD" && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                className: "flex-1 flex flex-col animate-in slide-in-from-right-8 duration-300",
                                children: [
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "mb-8",
                                        children: [
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                className: "w-12 h-12 bg-gray-50 dark:bg-[#1a1a1a] rounded-2xl flex items-center justify-center mb-6",
                                                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$lock$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Lock$3e$__["Lock"], {
                                                    className: "w-6 h-6 text-gray-900 dark:text-white"
                                                }, void 0, false, {
                                                    fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                    lineNumber: 195,
                                                    columnNumber: 21
                                                }, this)
                                            }, void 0, false, {
                                                fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                lineNumber: 194,
                                                columnNumber: 17
                                            }, this),
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("h2", {
                                                className: "text-2xl font-bold text-gray-900 dark:text-white mb-2",
                                                children: "Private Contest"
                                            }, void 0, false, {
                                                fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                lineNumber: 197,
                                                columnNumber: 17
                                            }, this),
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                                className: "text-gray-500 dark:text-gray-400",
                                                children: "Enter the access code to join."
                                            }, void 0, false, {
                                                fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                lineNumber: 198,
                                                columnNumber: 17
                                            }, this)
                                        ]
                                    }, void 0, true, {
                                        fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                        lineNumber: 193,
                                        columnNumber: 15
                                    }, this),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "space-y-4",
                                        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("input", {
                                            type: "password",
                                            value: password,
                                            onChange: (e)=>setPassword(e.target.value),
                                            onKeyDown: (e)=>e.key === "Enter" && handleVerifyPassword(),
                                            placeholder: "Password",
                                            autoFocus: true,
                                            className: "w-full bg-gray-50 dark:bg-[#141414] border-gray-200 dark:border-[#262626] rounded-xl px-4 py-4 text-center text-2xl font-bold tracking-widest focus:ring-2 focus:ring-orange-500/20 focus:border-orange-500 outline-none transition-all placeholder:text-gray-300 dark:text-white dark:placeholder:text-gray-700"
                                        }, void 0, false, {
                                            fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                            lineNumber: 202,
                                            columnNumber: 17
                                        }, this)
                                    }, void 0, false, {
                                        fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                        lineNumber: 201,
                                        columnNumber: 15
                                    }, this),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "mt-auto pt-8",
                                        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                            onClick: handleVerifyPassword,
                                            disabled: !password || isLoading,
                                            className: "w-full bg-gray-900 dark:bg-white text-white dark:text-black py-4 rounded-xl font-bold text-sm tracking-wide hover:opacity-90 transition-opacity disabled:opacity-50 flex items-center justify-center gap-2",
                                            children: [
                                                isLoading ? "Verifying..." : "Continue",
                                                !isLoading && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$arrow$2d$right$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__ArrowRight$3e$__["ArrowRight"], {
                                                    className: "w-4 h-4"
                                                }, void 0, false, {
                                                    fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                    lineNumber: 220,
                                                    columnNumber: 36
                                                }, this)
                                            ]
                                        }, void 0, true, {
                                            fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                            lineNumber: 214,
                                            columnNumber: 17
                                        }, this)
                                    }, void 0, false, {
                                        fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                        lineNumber: 213,
                                        columnNumber: 15
                                    }, this)
                                ]
                            }, void 0, true, {
                                fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                lineNumber: 192,
                                columnNumber: 13
                            }, this),
                            step === "RULES" && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                className: "flex-1 flex flex-col animate-in slide-in-from-right-8 duration-300",
                                children: [
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "mb-8",
                                        children: [
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("h2", {
                                                className: "text-2xl font-bold text-gray-900 dark:text-white mb-2",
                                                children: "Contest Rules"
                                            }, void 0, false, {
                                                fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                lineNumber: 230,
                                                columnNumber: 18
                                            }, this),
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                                className: "text-gray-500 dark:text-gray-400",
                                                children: "Strict proctoring is active."
                                            }, void 0, false, {
                                                fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                lineNumber: 231,
                                                columnNumber: 18
                                            }, this)
                                        ]
                                    }, void 0, true, {
                                        fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                        lineNumber: 229,
                                        columnNumber: 16
                                    }, this),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "space-y-6",
                                        children: RULES.map((rule, idx)=>{
                                            const Icon = rule.icon;
                                            return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                className: "flex gap-4",
                                                children: [
                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                        className: "w-10 h-10 shrink-0 rounded-full bg-gray-50 dark:bg-[#1a1a1a] flex items-center justify-center",
                                                        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(Icon, {
                                                            className: "w-5 h-5 text-gray-900 dark:text-white"
                                                        }, void 0, false, {
                                                            fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                            lineNumber: 240,
                                                            columnNumber: 34
                                                        }, this)
                                                    }, void 0, false, {
                                                        fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                        lineNumber: 239,
                                                        columnNumber: 30
                                                    }, this),
                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                        children: [
                                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("h3", {
                                                                className: "font-semibold text-gray-900 dark:text-white text-sm",
                                                                children: rule.title
                                                            }, void 0, false, {
                                                                fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                                lineNumber: 243,
                                                                columnNumber: 34
                                                            }, this),
                                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                                                className: "text-xs text-gray-500 dark:text-gray-400 leading-relaxed mt-0.5",
                                                                children: rule.description
                                                            }, void 0, false, {
                                                                fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                                lineNumber: 244,
                                                                columnNumber: 34
                                                            }, this)
                                                        ]
                                                    }, void 0, true, {
                                                        fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                        lineNumber: 242,
                                                        columnNumber: 30
                                                    }, this)
                                                ]
                                            }, idx, true, {
                                                fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                lineNumber: 238,
                                                columnNumber: 26
                                            }, this);
                                        })
                                    }, void 0, false, {
                                        fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                        lineNumber: 234,
                                        columnNumber: 16
                                    }, this),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "mt-auto pt-8",
                                        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                            onClick: ()=>setStep("CONFIRM"),
                                            className: "w-full bg-gray-900 dark:bg-white text-white dark:text-black py-4 rounded-xl font-bold text-sm tracking-wide hover:opacity-90 transition-opacity flex items-center justify-center gap-2",
                                            children: [
                                                "I Understand",
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$arrow$2d$right$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__ArrowRight$3e$__["ArrowRight"], {
                                                    className: "w-4 h-4"
                                                }, void 0, false, {
                                                    fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                    lineNumber: 257,
                                                    columnNumber: 21
                                                }, this)
                                            ]
                                        }, void 0, true, {
                                            fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                            lineNumber: 252,
                                            columnNumber: 17
                                        }, this)
                                    }, void 0, false, {
                                        fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                        lineNumber: 251,
                                        columnNumber: 16
                                    }, this)
                                ]
                            }, void 0, true, {
                                fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                lineNumber: 228,
                                columnNumber: 13
                            }, this),
                            step === "CONFIRM" && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                className: "flex-1 flex flex-col animate-in slide-in-from-right-8 duration-300",
                                children: [
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                        onClick: ()=>setStep("RULES"),
                                        className: "mb-6 flex items-center gap-2 text-sm text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors w-fit",
                                        children: [
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$chevron$2d$left$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__ChevronLeft$3e$__["ChevronLeft"], {
                                                className: "w-4 h-4"
                                            }, void 0, false, {
                                                fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                lineNumber: 270,
                                                columnNumber: 21
                                            }, this),
                                            "Back"
                                        ]
                                    }, void 0, true, {
                                        fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                        lineNumber: 266,
                                        columnNumber: 17
                                    }, this),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "text-center mb-8",
                                        children: [
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                className: "w-16 h-16 bg-orange-100 dark:bg-orange-500/20 mx-auto rounded-full flex items-center justify-center mb-6 animate-pulse",
                                                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$shield$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Shield$3e$__["Shield"], {
                                                    className: "w-8 h-8 text-orange-600 dark:text-orange-500"
                                                }, void 0, false, {
                                                    fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                    lineNumber: 276,
                                                    columnNumber: 25
                                                }, this)
                                            }, void 0, false, {
                                                fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                lineNumber: 275,
                                                columnNumber: 20
                                            }, this),
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("h2", {
                                                className: "text-2xl font-bold text-gray-900 dark:text-white mb-2",
                                                children: "Ready to Start?"
                                            }, void 0, false, {
                                                fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                lineNumber: 278,
                                                columnNumber: 20
                                            }, this),
                                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                                className: "text-gray-500 dark:text-gray-400 text-sm max-w-[260px] mx-auto",
                                                children: "Once you begin, your screen will be monitored. Violations may lead to disqualification."
                                            }, void 0, false, {
                                                fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                lineNumber: 279,
                                                columnNumber: 20
                                            }, this)
                                        ]
                                    }, void 0, true, {
                                        fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                        lineNumber: 274,
                                        columnNumber: 17
                                    }, this),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "bg-gray-50 dark:bg-[#141414] border border-gray-100 dark:border-[#262626] rounded-xl p-4 mb-6",
                                        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("label", {
                                            className: "flex items-start gap-3 cursor-pointer",
                                            children: [
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                    className: "relative flex items-center mt-0.5",
                                                    children: [
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("input", {
                                                            type: "checkbox",
                                                            checked: agreed,
                                                            onChange: (e)=>setAgreed(e.target.checked),
                                                            className: "peer h-5 w-5 appearance-none rounded-md border-2 border-gray-300 dark:border-gray-600 checked:border-orange-500 checked:bg-orange-500 transition-all"
                                                        }, void 0, false, {
                                                            fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                            lineNumber: 287,
                                                            columnNumber: 29
                                                        }, this),
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$check$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Check$3e$__["Check"], {
                                                            className: "pointer-events-none absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-3.5 h-3.5 text-white opacity-0 peer-checked:opacity-100"
                                                        }, void 0, false, {
                                                            fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                            lineNumber: 293,
                                                            columnNumber: 29
                                                        }, this)
                                                    ]
                                                }, void 0, true, {
                                                    fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                    lineNumber: 286,
                                                    columnNumber: 25
                                                }, this),
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                    className: "text-xs text-gray-600 dark:text-gray-400 select-none leading-relaxed",
                                                    children: "I verify that I am the registered participant and I agree to follow all contest rules honestly."
                                                }, void 0, false, {
                                                    fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                    lineNumber: 295,
                                                    columnNumber: 25
                                                }, this)
                                            ]
                                        }, void 0, true, {
                                            fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                            lineNumber: 285,
                                            columnNumber: 21
                                        }, this)
                                    }, void 0, false, {
                                        fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                        lineNumber: 284,
                                        columnNumber: 17
                                    }, this),
                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                        className: "mt-auto",
                                        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                            onClick: handleStartContest,
                                            disabled: !agreed || isLoading,
                                            className: "w-full bg-linear-to-r from-orange-600 to-orange-500 text-white py-4 rounded-xl font-bold text-sm tracking-wide hover:shadow-lg hover:shadow-orange-500/20 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",
                                            children: isLoading ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                className: "w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"
                                            }, void 0, false, {
                                                fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                lineNumber: 308,
                                                columnNumber: 30
                                            }, this) : /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Fragment"], {
                                                children: [
                                                    "Enter Contest",
                                                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$arrow$2d$right$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__ArrowRight$3e$__["ArrowRight"], {
                                                        className: "w-4 h-4"
                                                    }, void 0, false, {
                                                        fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                                        lineNumber: 312,
                                                        columnNumber: 33
                                                    }, this)
                                                ]
                                            }, void 0, true)
                                        }, void 0, false, {
                                            fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                            lineNumber: 302,
                                            columnNumber: 21
                                        }, this)
                                    }, void 0, false, {
                                        fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                        lineNumber: 301,
                                        columnNumber: 17
                                    }, this)
                                ]
                            }, void 0, true, {
                                fileName: "[project]/components/contest/ContestEntryModal.tsx",
                                lineNumber: 265,
                                columnNumber: 13
                            }, this)
                        ]
                    }, void 0, true, {
                        fileName: "[project]/components/contest/ContestEntryModal.tsx",
                        lineNumber: 189,
                        columnNumber: 9
                    }, this)
                ]
            }, void 0, true, {
                fileName: "[project]/components/contest/ContestEntryModal.tsx",
                lineNumber: 136,
                columnNumber: 7
            }, this)
        ]
    }, void 0, true, {
        fileName: "[project]/components/contest/ContestEntryModal.tsx",
        lineNumber: 128,
        columnNumber: 5
    }, this);
}
_s(ContestEntryModal, "Masmm+V/UK2s4YdJiPIx5CH+JlY=");
_c = ContestEntryModal;
var _c;
__turbopack_context__.k.register(_c, "ContestEntryModal");
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/actions/data:93ad3e [app-client] (ecmascript) <text/javascript>", ((__turbopack_context__) => {
"use strict";

/* __next_internal_action_entry_do_not_use__ [{"78bac990ae89cd8ae87b5bbd328ef9aee3e1937b8f":"logContestViolation"},"actions/contest.ts",""] */ __turbopack_context__.s([
    "logContestViolation",
    ()=>logContestViolation
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-client] (ecmascript)");
"use turbopack no side effects";
;
var logContestViolation = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["createServerReference"])("78bac990ae89cd8ae87b5bbd328ef9aee3e1937b8f", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["findSourceMapURL"], "logContestViolation"); //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vY29udGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzZXJ2ZXJcIjtcblxuaW1wb3J0IHsgcHJpc21hIH0gZnJvbSBcIkAvbGliL3ByaXNtYVwiO1xuaW1wb3J0IHsgYXV0aCB9IGZyb20gXCJAL2xpYi9hdXRoXCI7XG5pbXBvcnQgeyBoZWFkZXJzIH0gZnJvbSBcIm5leHQvaGVhZGVyc1wiO1xuaW1wb3J0IHsgeiB9IGZyb20gXCJ6b2RcIjtcbmltcG9ydCB7IHJldmFsaWRhdGVQYXRoLCByZXZhbGlkYXRlVGFnIH0gZnJvbSBcIm5leHQvY2FjaGVcIjtcbmltcG9ydCB7IGNhY2hlVGFnLCBjYWNoZUxpZmUgfSBmcm9tIFwibmV4dC9jYWNoZVwiO1xuXG5jb25zdCBjb250ZXN0U2NoZW1hID0gei5vYmplY3Qoe1xuICAgIHRpdGxlOiB6LnN0cmluZygpLm1pbigzLCBcIlRpdGxlIG11c3QgYmUgYXQgbGVhc3QgMyBjaGFyYWN0ZXJzXCIpLFxuICAgIGRlc2NyaXB0aW9uOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgc3RhcnRUaW1lOiB6LmNvZXJjZS5kYXRlKCksXG4gICAgZW5kVGltZTogei5jb2VyY2UuZGF0ZSgpLFxuICAgIHZpc2liaWxpdHk6IHouZW51bShbXCJQVUJMSUNcIiwgXCJJTlNUSVRVVElPTlwiLCBcIkNMQVNTUk9PTVwiXSksXG4gICAgY2xhc3Nyb29tSWQ6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgICBpbnN0aXR1dGlvbklkOiB6LnN0cmluZygpLm9wdGlvbmFsKCkubnVsbGFibGUoKSxcbiAgICBwcm9ibGVtczogei5hcnJheSh6LnN0cmluZygpKS5taW4oMSwgXCJTZWxlY3QgYXQgbGVhc3Qgb25lIHByb2JsZW1cIiksXG4gICAgY29udGVzdFBhc3N3b3JkOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgcmFuZG9taXplUXVlc3Rpb25zOiB6LmJvb2xlYW4oKS5kZWZhdWx0KGZhbHNlKSxcbn0pO1xuXG5jb25zdCBjb250ZXN0V2l0aFByb2JsZW1zU2NoZW1hID0gei5vYmplY3Qoe1xuICAgIHRpdGxlOiB6LnN0cmluZygpLm1pbigzLCBcIlRpdGxlIG11c3QgYmUgYXQgbGVhc3QgMyBjaGFyYWN0ZXJzXCIpLFxuICAgIHNsdWc6IHouc3RyaW5nKCkubWluKDMsIFwiU2x1ZyBtdXN0IGJlIGF0IGxlYXN0IDMgY2hhcmFjdGVyc1wiKSxcbiAgICBkZXNjcmlwdGlvbjogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAgIHN0YXJ0VGltZTogei5kYXRlKCksXG4gICAgZW5kVGltZTogei5kYXRlKCksXG4gICAgdmlzaWJpbGl0eTogei5lbnVtKFtcIlBVQkxJQ1wiLCBcIklOU1RJVFVUSU9OXCIsIFwiQ0xBU1NST09NXCJdKSxcbiAgICBoaWRkZW46IHouYm9vbGVhbigpLmRlZmF1bHQoZmFsc2UpLFxuICAgIGNsYXNzcm9vbUlkOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgaW5zdGl0dXRpb25JZDogei5zdHJpbmcoKS5vcHRpb25hbCgpLm51bGxhYmxlKCksXG4gICAgYmFja2dyb3VuZEltYWdlOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgcHJpemVzOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgcnVsZXM6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgICBwcm9ibGVtczogei5hcnJheSh6LmFueSgpKSwgLy8gRnVsbCBwcm9ibGVtIGRhdGEgb2JqZWN0c1xuICAgIGNvbnRlc3RQYXNzd29yZDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAgIHJhbmRvbWl6ZVF1ZXN0aW9uczogei5ib29sZWFuKCkuZGVmYXVsdChmYWxzZSksXG59KTtcblxuLyoqXG4gKiBGZXRjaGVzIGNvbnRlc3RzIHZpc2libGUgdG8gdGhlIGN1cnJlbnQgdXNlci5cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFZpc2libGVDb250ZXN0cygpIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIHRyeSB7XG4gICAgICAgIGlmICghc2Vzc2lvbj8udXNlcikge1xuICAgICAgICAgICAgY29uc3QgY29udGVzdHMgPSBhd2FpdCBwcmlzbWEuY29udGVzdC5maW5kTWFueSh7XG4gICAgICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICAgICAgdmlzaWJpbGl0eTogXCJQVUJMSUNcIixcbiAgICAgICAgICAgICAgICAgICAgaGlkZGVuOiBmYWxzZSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICAgICAgX2NvdW50OiB7IHNlbGVjdDogeyBwcm9ibGVtczogdHJ1ZSB9IH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9yZGVyQnk6IHsgc3RhcnRUaW1lOiBcImRlc2NcIiB9LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBjb250ZXN0cyB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgY3VycmVudFVzZXIgPSBzZXNzaW9uLnVzZXIgYXMgYW55O1xuXG4gICAgICAgIGlmIChjdXJyZW50VXNlci5yb2xlID09PSBcIkFETUlOXCIpIHtcbiAgICAgICAgICAgIGNvbnN0IGNvbnRlc3RzID0gYXdhaXQgcHJpc21hLmNvbnRlc3QuZmluZE1hbnkoe1xuICAgICAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICAgICAgX2NvdW50OiB7IHNlbGVjdDogeyBwcm9ibGVtczogdHJ1ZSB9IH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9yZGVyQnk6IHsgc3RhcnRUaW1lOiBcImRlc2NcIiB9LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBjb250ZXN0cyB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgY29udGVzdHMgPSBhd2FpdCBwcmlzbWEuY29udGVzdC5maW5kTWFueSh7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgIE9SOiBbXG4gICAgICAgICAgICAgICAgICAgIHsgdmlzaWJpbGl0eTogXCJQVUJMSUNcIiB9LFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBBTkQ6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IHZpc2liaWxpdHk6IFwiSU5TVElUVVRJT05cIiB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgaW5zdGl0dXRpb25JZDogY3VycmVudFVzZXIuaW5zdGl0dXRpb25JZCB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgQU5EOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeyB2aXNpYmlsaXR5OiBcIkNMQVNTUk9PTVwiIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBPUjogW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBjbGFzc3Jvb206IHsgc3R1ZGVudHM6IHsgc29tZTogeyBpZDogY3VycmVudFVzZXIuaWQgfSB9IH0gfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgY3JlYXRvcklkOiBjdXJyZW50VXNlci5pZCB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB7IGNyZWF0b3JJZDogY3VycmVudFVzZXIuaWQgfSxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICBfY291bnQ6IHsgc2VsZWN0OiB7IHByb2JsZW1zOiB0cnVlIH0gfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9yZGVyQnk6IHsgc3RhcnRUaW1lOiBcImRlc2NcIiB9LFxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBjb250ZXN0cyB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gZmV0Y2ggY29udGVzdHM6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBmZXRjaCBjb250ZXN0c1wiIH07XG4gICAgfVxufVxuXG5cbi8qKlxuICogRmV0Y2hlcyBhIHNpbmdsZSBjb250ZXN0J3MgZGV0YWlscyB3aXRoIGF1dGhvcml6YXRpb24uXG4gKi9cbi8qKlxuICogRmV0Y2hlcyBhIHNpbmdsZSBjb250ZXN0J3MgZGV0YWlscyB3aXRoIGF1dGhvcml6YXRpb24uXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRDb250ZXN0RGV0YWlsKGNvbnRlc3RJZDogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjb250ZXN0ID0gYXdhaXQgcHJpc21hLmNvbnRlc3QuZmluZFVuaXF1ZSh7XG4gICAgICAgICAgICB3aGVyZTogeyBpZDogY29udGVzdElkIH0sXG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgX2NvdW50OiB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdDogeyBwcm9ibGVtczogdHJ1ZSB9LFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgcHJvYmxlbXM6IHtcbiAgICAgICAgICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJvYmxlbToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpZmZpY3VsdHk6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNsdWc6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIG9yZGVyQnk6IHsgb3JkZXI6IFwiYXNjXCIgfSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKCFjb250ZXN0KSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiQ29udGVzdCBub3QgZm91bmRcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgY3VycmVudFVzZXIgPSBzZXNzaW9uPy51c2VyIGFzIGFueTtcbiAgICAgICAgY29uc3QgcGFydGljaXBhdGlvbiA9IGN1cnJlbnRVc2VyID8gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZDogY3VycmVudFVzZXIuaWQsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlc3RJZDogY29udGVzdElkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KSA6IG51bGw7XG5cbiAgICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgICAgICAgY29uc3QgaGFzU3RhcnRlZCA9IG5vdyA+PSBjb250ZXN0LnN0YXJ0VGltZTtcbiAgICAgICAgY29uc3QgaXNDcmVhdG9yID0gY3VycmVudFVzZXI/LmlkID09PSBjb250ZXN0LmNyZWF0b3JJZDtcbiAgICAgICAgY29uc3QgaXNBZG1pbiA9IGN1cnJlbnRVc2VyPy5yb2xlID09PSBcIkFETUlOXCI7XG5cbiAgICAgICAgLy8gVmlzaWJpbGl0eSBDaGVja1xuICAgICAgICBsZXQgaXNBdXRob3JpemVkID0gZmFsc2U7XG4gICAgICAgIGlmIChjb250ZXN0LnZpc2liaWxpdHkgPT09IFwiUFVCTElDXCIpIHtcbiAgICAgICAgICAgIGlzQXV0aG9yaXplZCA9IHRydWU7XG4gICAgICAgIH0gZWxzZSBpZiAoaXNBZG1pbikge1xuICAgICAgICAgICAgaXNBdXRob3JpemVkID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIGlmIChjdXJyZW50VXNlcikge1xuICAgICAgICAgICAgaWYgKGlzQ3JlYXRvcikge1xuICAgICAgICAgICAgICAgIGlzQXV0aG9yaXplZCA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGNvbnRlc3QudmlzaWJpbGl0eSA9PT0gXCJJTlNUSVRVVElPTlwiKSB7XG4gICAgICAgICAgICAgICAgLy8gVXNlID09IGZvciBudWxsL3VuZGVmaW5lZCBsb29zZSBlcXVhbGl0eSBjaGVja1xuICAgICAgICAgICAgICAgIGlzQXV0aG9yaXplZCA9IGN1cnJlbnRVc2VyLmluc3RpdHV0aW9uSWQgPT0gY29udGVzdC5pbnN0aXR1dGlvbklkO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChjb250ZXN0LnZpc2liaWxpdHkgPT09IFwiQ0xBU1NST09NXCIpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlbnJvbGxtZW50ID0gYXdhaXQgcHJpc21hLmNsYXNzcm9vbS5maW5kRmlyc3Qoe1xuICAgICAgICAgICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGNvbnRlc3QuY2xhc3Nyb29tSWQgYXMgc3RyaW5nLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3R1ZGVudHM6IHsgc29tZTogeyBpZDogY3VycmVudFVzZXIuaWQgfSB9LFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGlzQXV0aG9yaXplZCA9ICEhZW5yb2xsbWVudDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghaXNBdXRob3JpemVkKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkIGFjY2VzcyB0byB0aGlzIGNvbnRlc3QuXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGNhblNlZVByb2JsZW1zID0gKGhhc1N0YXJ0ZWQgfHwgaXNBZG1pbiB8fCBpc0NyZWF0b3IpICYmIChwYXJ0aWNpcGF0aW9uPy5hY2NlcHRlZFJ1bGVzIHx8IGlzQ3JlYXRvciB8fCBpc0FkbWluKTtcblxuICAgICAgICAvLyBGaXg6IElmIHRoZSBjb250ZXN0IGlzIG92ZXIsIGFsbG93ZWQgcm9sZXMgc2hvdWxkIGNoZWNrIHBhcnRpY2lwYXRpb24gcHJvcGVybHksXG4gICAgICAgIC8vIGJ1dCB0eXBpY2FsbHkgYWxsb3dzIHZpZXdpbmcgaWYgcHVibGljL2F1dGhvcml6ZWQuXG4gICAgICAgIC8vIEJ1dCBmb3IgXCJMaXZlXCIgY29udGVzdHMsIHRoZSBjdXJyZW50IGxvZ2ljIGlzIGNvcnJlY3QuXG5cbiAgICAgICAgY29uc3QgcmVxdWlyZXNQYXNzd29yZCA9ICEhY29udGVzdC5jb250ZXN0UGFzc3dvcmQ7XG5cbiAgICAgICAgLy8gU2h1ZmZsZSBwcm9ibGVtcyBpZiByYW5kb21pemVRdWVzdGlvbnMgaXMgZW5hYmxlZFxuICAgICAgICAvLyBVc2UgYSBzaW1wbGUgc2VlZGVkIHNodWZmbGUgYmFzZWQgb24gdXNlcklkICsgY29udGVzdElkIGZvciBjb25zaXN0ZW5jeVxuICAgICAgICBsZXQgdmlzaWJsZVByb2JsZW1zID0gY2FuU2VlUHJvYmxlbXMgPyBjb250ZXN0LnByb2JsZW1zIDogW107XG5cbiAgICAgICAgaWYgKGNvbnRlc3QucmFuZG9taXplUXVlc3Rpb25zICYmIGN1cnJlbnRVc2VyICYmIHZpc2libGVQcm9ibGVtcy5sZW5ndGggPiAwICYmICFpc0FkbWluICYmICFpc0NyZWF0b3IpIHtcbiAgICAgICAgICAgIC8vIFNpbXBsZSBzdHJpbmcgaGFzaCBmdW5jdGlvbiBmb3Igc2VlZGluZ1xuICAgICAgICAgICAgY29uc3Qgc2VlZFN0ciA9IGAke2N1cnJlbnRVc2VyLmlkfS0ke2NvbnRlc3RJZH1gO1xuICAgICAgICAgICAgbGV0IHNlZWQgPSAwO1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzZWVkU3RyLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgc2VlZCA9ICgoc2VlZCA8PCA1KSAtIHNlZWQpICsgc2VlZFN0ci5jaGFyQ29kZUF0KGkpO1xuICAgICAgICAgICAgICAgIHNlZWQgfD0gMDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gRGV0ZXJtaW5pc3RpYyBzaHVmZmxlXG4gICAgICAgICAgICB2aXNpYmxlUHJvYmxlbXMgPSBbLi4udmlzaWJsZVByb2JsZW1zXS5zb3J0KChhLCBiKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgeCA9IE1hdGguc2luKHNlZWQrKykgKiAxMDAwMDtcbiAgICAgICAgICAgICAgICByZXR1cm4gKHggLSBNYXRoLmZsb29yKHgpKSAtIDAuNTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gRmV0Y2ggdXNlcidzIHNvbHZlZCBwcm9ibGVtcyBmb3IgdGhpcyBjb250ZXN0XG4gICAgICAgIGNvbnN0IHNvbHZlZFByb2JsZW1JZHMgPSBuZXcgU2V0PHN0cmluZz4oKTtcbiAgICAgICAgaWYgKGN1cnJlbnRVc2VyKSB7XG4gICAgICAgICAgICBjb25zdCBzb2x2ZWRTdWJtaXNzaW9ucyA9IGF3YWl0IHByaXNtYS5zdWJtaXNzaW9uLmZpbmRNYW55KHtcbiAgICAgICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IGN1cnJlbnRVc2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZCxcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiBcIkFDQ0VQVEVEXCIsXG4gICAgICAgICAgICAgICAgICAgIHByb2JsZW1JZDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgaW46IHZpc2libGVQcm9ibGVtcy5tYXAocCA9PiBwLnByb2JsZW0uaWQpXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHNlbGVjdDogeyBwcm9ibGVtSWQ6IHRydWUgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBzb2x2ZWRTdWJtaXNzaW9ucy5mb3JFYWNoKHMgPT4gc29sdmVkUHJvYmxlbUlkcy5hZGQocy5wcm9ibGVtSWQpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgY29udGVzdDoge1xuICAgICAgICAgICAgICAgIC4uLmNvbnRlc3QsXG4gICAgICAgICAgICAgICAgcHJvYmxlbXM6IHZpc2libGVQcm9ibGVtcy5tYXAodnAgPT4gKHtcbiAgICAgICAgICAgICAgICAgICAgLi4udnAsXG4gICAgICAgICAgICAgICAgICAgIGlzU29sdmVkOiBzb2x2ZWRQcm9ibGVtSWRzLmhhcyh2cC5wcm9ibGVtLmlkKVxuICAgICAgICAgICAgICAgIH0pKSxcbiAgICAgICAgICAgICAgICBoYXNTdGFydGVkLFxuICAgICAgICAgICAgICAgIGhhc0VuZGVkOiBub3cgPiBjb250ZXN0LmVuZFRpbWUsXG4gICAgICAgICAgICAgICAgY2FuTWFuYWdlOiBpc0FkbWluIHx8IGlzQ3JlYXRvcixcbiAgICAgICAgICAgICAgICBoYXNBY2NlcHRlZFJ1bGVzOiBwYXJ0aWNpcGF0aW9uPy5hY2NlcHRlZFJ1bGVzIHx8IGZhbHNlLFxuICAgICAgICAgICAgICAgIGlzRmluaXNoZWQ6IHBhcnRpY2lwYXRpb24/LmlzRmluaXNoZWQgfHwgZmFsc2UsXG4gICAgICAgICAgICAgICAgcmVxdWlyZXNQYXNzd29yZCxcbiAgICAgICAgICAgICAgICBjb250ZXN0UGFzc3dvcmQ6IG51bGwsIC8vIE5ldmVyIHJldHVybiBwbGFpbiBwYXNzd29yZFxuICAgICAgICAgICAgICAgIHNlc3Npb25JZDogcGFydGljaXBhdGlvbj8uc2Vzc2lvbklkIC8vIFJldHVybiBzZXNzaW9uSWQgZm9yIHByb3RlY3Rpb25cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGZldGNoIGNvbnRlc3QgZGV0YWlsOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZmV0Y2ggY29udGVzdFwiIH07XG4gICAgfVxufVxuXG4vLyAuLi4gZXhpc3RpbmcgY29kZSAuLi5cblxuLy8gLi4uIGV4aXN0aW5nIGNvZGUgLi4uXG5cbi8vIC4uLiBleGlzdGluZyBjb2RlIC4uLlxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlQ29udGVzdChkYXRhOiB6LmluZmVyPHR5cGVvZiBjb250ZXN0U2NoZW1hPikge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSB7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuICAgIH1cblxuICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gc2Vzc2lvbi51c2VyIGFzIGFueTtcblxuICAgIGlmICghW1wiQURNSU5cIiwgXCJJTlNUSVRVVElPTl9NQU5BR0VSXCIsIFwiQ09OVEVTVF9NQU5BR0VSXCIsIFwiVEVBQ0hFUlwiXS5pbmNsdWRlcyhjdXJyZW50VXNlci5yb2xlKSkge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCB2YWxpZGF0ZWREYXRhID0gY29udGVzdFNjaGVtYS5wYXJzZShkYXRhKTtcblxuICAgICAgICAvLyBHZW5lcmF0ZSBhIG1vcmUgcm9idXN0IHVuaXF1ZSBzbHVnXG4gICAgICAgIGNvbnN0IGJhc2VTbHVnID0gdmFsaWRhdGVkRGF0YS50aXRsZS50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoL1teYS16MC05XSsvZywgXCItXCIpLnJlcGxhY2UoLyheLXwtJCkvZywgXCJcIik7XG4gICAgICAgIGNvbnN0IHVuaXF1ZVNsdWcgPSBgJHtiYXNlU2x1Z30tJHtEYXRlLm5vdygpfWA7XG5cbiAgICAgICAgY29uc3QgY29udGVzdCA9IGF3YWl0IHByaXNtYS5jb250ZXN0LmNyZWF0ZSh7XG4gICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgdGl0bGU6IHZhbGlkYXRlZERhdGEudGl0bGUsXG4gICAgICAgICAgICAgICAgc2x1ZzogdW5pcXVlU2x1ZyxcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogdmFsaWRhdGVkRGF0YS5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICBzdGFydFRpbWU6IHZhbGlkYXRlZERhdGEuc3RhcnRUaW1lLFxuICAgICAgICAgICAgICAgIGVuZFRpbWU6IHZhbGlkYXRlZERhdGEuZW5kVGltZSxcbiAgICAgICAgICAgICAgICB2aXNpYmlsaXR5OiB2YWxpZGF0ZWREYXRhLnZpc2liaWxpdHkgYXMgYW55LFxuICAgICAgICAgICAgICAgIGluc3RpdHV0aW9uSWQ6IHZhbGlkYXRlZERhdGEudmlzaWJpbGl0eSAhPT0gXCJQVUJMSUNcIiA/ICh2YWxpZGF0ZWREYXRhLmluc3RpdHV0aW9uSWQgfHwgbnVsbCkgOiBudWxsLFxuICAgICAgICAgICAgICAgIGNsYXNzcm9vbUlkOiB2YWxpZGF0ZWREYXRhLnZpc2liaWxpdHkgPT09IFwiQ0xBU1NST09NXCIgPyAodmFsaWRhdGVkRGF0YS5jbGFzc3Jvb21JZCB8fCBudWxsKSA6IG51bGwsXG4gICAgICAgICAgICAgICAgY3JlYXRvcklkOiBjdXJyZW50VXNlci5pZCxcbiAgICAgICAgICAgICAgICBjb250ZXN0UGFzc3dvcmQ6IHZhbGlkYXRlZERhdGEuY29udGVzdFBhc3N3b3JkIHx8IG51bGwsXG4gICAgICAgICAgICAgICAgcmFuZG9taXplUXVlc3Rpb25zOiB2YWxpZGF0ZWREYXRhLnJhbmRvbWl6ZVF1ZXN0aW9ucyB8fCBmYWxzZSxcbiAgICAgICAgICAgICAgICBwcm9ibGVtczoge1xuICAgICAgICAgICAgICAgICAgICBjcmVhdGU6IHZhbGlkYXRlZERhdGEucHJvYmxlbXMubWFwKChwcm9ibGVtSWQsIGluZGV4KSA9PiAoe1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJvYmxlbUlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgb3JkZXI6IGluZGV4LFxuICAgICAgICAgICAgICAgICAgICB9KSksXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC9jb250ZXN0c1wiKTtcbiAgICAgICAgcmV2YWxpZGF0ZVBhdGgoXCIvY29udGVzdFwiKTtcbiAgICAgICAgcmV2YWxpZGF0ZVRhZyhcImNvbnRlc3RzXCIsIFwibWF4XCIpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBjb250ZXN0SWQ6IGNvbnRlc3QuaWQgfTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gY3JlYXRlIGNvbnRlc3Q6XCIsIGVycm9yKTtcbiAgICAgICAgLy8gUmV0dXJuIGNsZWFyZXIgZXJyb3IgbWVzc2FnZXNcbiAgICAgICAgbGV0IGVycm9yTWVzc2FnZSA9IFwiRmFpbGVkIHRvIGNyZWF0ZSBjb250ZXN0XCI7XG4gICAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIHouWm9kRXJyb3IpIHtcbiAgICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSAoZXJyb3IgYXMgYW55KS5lcnJvcnMubWFwKChlOiBhbnkpID0+IGUubWVzc2FnZSkuam9pbihcIiwgXCIpO1xuICAgICAgICB9IGVsc2UgaWYgKGVycm9yIGluc3RhbmNlb2YgRXJyb3IpIHtcbiAgICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSBlcnJvci5tZXNzYWdlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3JNZXNzYWdlIH07XG4gICAgfVxuICAgIH1cblxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlQ29udGVzdFdpdGhQcm9ibGVtcyhkYXRhOiB6LmluZmVyPHR5cGVvZiBjb250ZXN0V2l0aFByb2JsZW1zU2NoZW1hPikge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSB7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuICAgIH1cblxuICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gc2Vzc2lvbi51c2VyIGFzIGFueTtcblxuICAgIGlmICghW1wiQURNSU5cIiwgXCJJTlNUSVRVVElPTl9NQU5BR0VSXCIsIFwiQ09OVEVTVF9NQU5BR0VSXCIsIFwiVEVBQ0hFUlwiXS5pbmNsdWRlcyhjdXJyZW50VXNlci5yb2xlKSkge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCB2YWxpZGF0ZWREYXRhID0gY29udGVzdFdpdGhQcm9ibGVtc1NjaGVtYS5wYXJzZShkYXRhKTtcblxuICAgICAgICBjb25zdCBjb250ZXN0ID0gYXdhaXQgcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNvbnRlc3QgPSBhd2FpdCB0eC5jb250ZXN0LmNyZWF0ZSh7XG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICB0aXRsZTogdmFsaWRhdGVkRGF0YS50aXRsZSxcbiAgICAgICAgICAgICAgICAgICAgc2x1ZzogdmFsaWRhdGVkRGF0YS5zbHVnLFxuICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogdmFsaWRhdGVkRGF0YS5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICAgICAgc3RhcnRUaW1lOiB2YWxpZGF0ZWREYXRhLnN0YXJ0VGltZSxcbiAgICAgICAgICAgICAgICAgICAgZW5kVGltZTogdmFsaWRhdGVkRGF0YS5lbmRUaW1lLFxuICAgICAgICAgICAgICAgICAgICB2aXNpYmlsaXR5OiB2YWxpZGF0ZWREYXRhLnZpc2liaWxpdHkgYXMgYW55LFxuICAgICAgICAgICAgICAgICAgICBoaWRkZW46IHZhbGlkYXRlZERhdGEuaGlkZGVuLFxuICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kSW1hZ2U6IHZhbGlkYXRlZERhdGEuYmFja2dyb3VuZEltYWdlLFxuICAgICAgICAgICAgICAgICAgICBwcml6ZXM6IHZhbGlkYXRlZERhdGEucHJpemVzLFxuICAgICAgICAgICAgICAgICAgICBydWxlczogdmFsaWRhdGVkRGF0YS5ydWxlcyxcbiAgICAgICAgICAgICAgICAgICAgaW5zdGl0dXRpb25JZDogdmFsaWRhdGVkRGF0YS52aXNpYmlsaXR5ICE9PSBcIlBVQkxJQ1wiID8gKHZhbGlkYXRlZERhdGEuaW5zdGl0dXRpb25JZCB8fCBudWxsKSA6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIGNsYXNzcm9vbUlkOiB2YWxpZGF0ZWREYXRhLnZpc2liaWxpdHkgPT09IFwiQ0xBU1NST09NXCIgPyAodmFsaWRhdGVkRGF0YS5jbGFzc3Jvb21JZCB8fCBudWxsKSA6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIGNyZWF0b3JJZDogY3VycmVudFVzZXIuaWQsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlc3RQYXNzd29yZDogdmFsaWRhdGVkRGF0YS5jb250ZXN0UGFzc3dvcmQgfHwgbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgcmFuZG9taXplUXVlc3Rpb25zOiB2YWxpZGF0ZWREYXRhLnJhbmRvbWl6ZVF1ZXN0aW9ucyB8fCBmYWxzZSxcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB2YWxpZGF0ZWREYXRhLnByb2JsZW1zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcCA9IHZhbGlkYXRlZERhdGEucHJvYmxlbXNbaV07XG4gICAgICAgICAgICAgICAgLy8gR2VuZXJhdGUgdW5pcXVlIHNsdWcgYnkgYXBwZW5kaW5nIGNvbnRlc3Qgc2x1ZyBhbmQgaW5kZXhcbiAgICAgICAgICAgICAgICBjb25zdCB1bmlxdWVTbHVnID0gYCR7dmFsaWRhdGVkRGF0YS5zbHVnfS0ke3Auc2x1ZyB8fCBwLnRpdGxlLnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvXFxzKy9nLCAnLScpfS0ke0RhdGUubm93KCl9LSR7aX1gO1xuICAgICAgICAgICAgICAgIGNvbnN0IHByb2JsZW0gPSBhd2FpdCB0eC5wcm9ibGVtLmNyZWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBwLnRpdGxlLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHAuZGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICBkaWZmaWN1bHR5OiBwLmRpZmZpY3VsdHksXG4gICAgICAgICAgICAgICAgICAgICAgICBzbHVnOiB1bmlxdWVTbHVnLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcmU6IHAuc2NvcmUgfHwgMTAsXG4gICAgICAgICAgICAgICAgICAgICAgICBkb21haW46IHAuZG9tYWluLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJDT05URVNUXCIsIC8vIENvbnRlc3QgcHJvYmxlbXMgYXJlIG1hcmtlZCBzZXBhcmF0ZWx5XG4gICAgICAgICAgICAgICAgICAgICAgICBoaWRkZW46IHRydWUsIC8vIENvbnRlc3QgcHJvYmxlbXMgYXJlIGhpZGRlbiBmcm9tIG1haW4gYmFua1xuICAgICAgICAgICAgICAgICAgICAgICAgdGVzdENhc2VzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlOiBwLnRlc3RDYXNlcyxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICB0YWdzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29ubmVjdDogcC50YWdzPy5tYXAoKHQ6IHN0cmluZykgPT4gKHsgbmFtZTogdCB9KSkgfHwgW10sXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGF3YWl0IHR4LmNvbnRlc3RQcm9ibGVtLmNyZWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlc3RJZDogY29udGVzdC5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2JsZW1JZDogcHJvYmxlbS5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG9yZGVyOiBpLFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBjb250ZXN0O1xuICAgICAgICB9KTtcblxuICAgICAgICByZXZhbGlkYXRlUGF0aChcIi9kYXNoYm9hcmQvY29udGVzdHNcIik7XG4gICAgICAgIHJldmFsaWRhdGVQYXRoKFwiL2NvbnRlc3RzXCIpO1xuICAgICAgICByZXZhbGlkYXRlUGF0aChcIi9jb250ZXN0XCIpO1xuICAgICAgICByZXZhbGlkYXRlVGFnKFwiY29udGVzdHNcIiwgXCJtYXhcIik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGNvbnRlc3RJZDogY29udGVzdC5pZCB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gY3JlYXRlIGNvbnRlc3Qgd2l0aCBwcm9ibGVtczpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGNyZWF0ZSBjb250ZXN0XCIgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRJbnN0aXR1dGlvbmFsQ2xhc3Nyb29tcyhpbnN0aXR1dGlvbklkOiBzdHJpbmcpIHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjbGFzc3Jvb21zID0gYXdhaXQgcHJpc21hLmNsYXNzcm9vbS5maW5kTWFueSh7XG4gICAgICAgICAgICB3aGVyZTogeyBpbnN0aXR1dGlvbklkIH0sXG4gICAgICAgICAgICBzZWxlY3Q6IHsgaWQ6IHRydWUsIG5hbWU6IHRydWUsIHNlY3Rpb246IHRydWUgfSxcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGNsYXNzcm9vbXMgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGZldGNoIGNsYXNzcm9vbXM6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBmZXRjaCBjbGFzc3Jvb21zXCIgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRTZWxlY3RhYmxlUHJvYmxlbXMoc2VhcmNoOiBzdHJpbmcpIHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBwcm9ibGVtcyA9IGF3YWl0IHByaXNtYS5wcm9ibGVtLmZpbmRNYW55KHtcbiAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgT1I6IFtcbiAgICAgICAgICAgICAgICAgICAgeyB0aXRsZTogeyBjb250YWluczogc2VhcmNoLCBtb2RlOiBcImluc2Vuc2l0aXZlXCIgfSB9LFxuICAgICAgICAgICAgICAgICAgICB7IHNsdWc6IHsgY29udGFpbnM6IHNlYXJjaCwgbW9kZTogXCJpbnNlbnNpdGl2ZVwiIH0gfSxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIGhpZGRlbjogZmFsc2UsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2VsZWN0OiB7IGlkOiB0cnVlLCB0aXRsZTogdHJ1ZSwgZGlmZmljdWx0eTogdHJ1ZSwgc2x1ZzogdHJ1ZSB9LFxuICAgICAgICAgICAgdGFrZTogMTAsXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBwcm9ibGVtcyB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gZmV0Y2ggcHJvYmxlbXM6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBmZXRjaCBwcm9ibGVtc1wiIH07XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYWNjZXB0Q29udGVzdFJ1bGVzKGNvbnRlc3RJZDogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICBpZiAoIXNlc3Npb24/LnVzZXIpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuXG4gICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLnVwc2VydCh7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgIHVzZXJJZF9jb250ZXN0SWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkOiBzZXNzaW9uLnVzZXIuaWQsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlc3RJZDogY29udGVzdElkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHVwZGF0ZTogeyBhY2NlcHRlZFJ1bGVzOiB0cnVlIH0sXG4gICAgICAgICAgICBjcmVhdGU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWQ6IHNlc3Npb24udXNlci5pZCxcbiAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZCxcbiAgICAgICAgICAgICAgICBhY2NlcHRlZFJ1bGVzOiB0cnVlXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXZhbGlkYXRlUGF0aChgL2NvbnRlc3QvJHtjb250ZXN0SWR9YCk7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGFjY2VwdCBydWxlc1wiIH07XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZmluaXNoQ29udGVzdEFjdGlvbihjb250ZXN0SWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcblxuICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHByaXNtYS5jb250ZXN0UGFydGljaXBhdGlvbi51cHNlcnQoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1cGRhdGU6IHtcbiAgICAgICAgICAgICAgICBpc0ZpbmlzaGVkOiB0cnVlLFxuICAgICAgICAgICAgICAgIGZpbmlzaGVkQXQ6IG5ldyBEYXRlKClcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjcmVhdGU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWQ6IHNlc3Npb24udXNlci5pZCxcbiAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZCxcbiAgICAgICAgICAgICAgICBhY2NlcHRlZFJ1bGVzOiB0cnVlLFxuICAgICAgICAgICAgICAgIGlzRmluaXNoZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgZmluaXNoZWRBdDogbmV3IERhdGUoKVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV2YWxpZGF0ZVBhdGgoYC9jb250ZXN0LyR7Y29udGVzdElkfWApO1xuICAgICAgICByZXZhbGlkYXRlUGF0aChgL3Byb2JsZW1zYCk7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGZpbmlzaCBjb250ZXN0XCIgfTtcbiAgICB9XG59XG5cbi8qKlxuICogRmluYWxpemUgQ29udGVzdCAmIEF3YXJkIEJhZGdlc1xuICogLSBDYWxjdWxhdGVzIGxlYWRlcmJvYXJkXG4gKiAtIEF3YXJkcyBHb2xkLCBTaWx2ZXIsIEJyb256ZSB0byBUb3AgM1xuICogLSBNYXJrcyBjb250ZXN0IGFzIGZpbmFsaXplZFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZmluYWxpemVDb250ZXN0KGNvbnRlc3RJZDogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICBpZiAoIXNlc3Npb24/LnVzZXIpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuXG4gICAgLy8gT25seSBhZG1pbnMgb3IgY29udGVzdCBtYW5hZ2VycyBjYW4gZmluYWxpemVcbiAgICBjb25zdCBjdXJyZW50VXNlciA9IHNlc3Npb24udXNlciBhcyBhbnk7XG4gICAgaWYgKCFbXCJBRE1JTlwiLCBcIkNPTlRFU1RfTUFOQUdFUlwiLCBcIklOU1RJVFVUSU9OX01BTkFHRVJcIiwgXCJURUFDSEVSXCJdLmluY2x1ZGVzKGN1cnJlbnRVc2VyLnJvbGUpKSB7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRlc3QgPSBhd2FpdCBwcmlzbWEuY29udGVzdC5maW5kVW5pcXVlKHtcbiAgICAgICAgICAgICB3aGVyZTogeyBpZDogY29udGVzdElkIH0sXG4gICAgICAgICAgICAgc2VsZWN0OiB7IGlzRmluYWxpemVkOiB0cnVlLCB0aXRsZTogdHJ1ZSB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICghY29udGVzdCkgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkNvbnRlc3Qgbm90IGZvdW5kXCIgfTtcbiAgICAgICAgaWYgKGNvbnRlc3QuaXNGaW5hbGl6ZWQpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJDb250ZXN0IGlzIGFscmVhZHkgZmluYWxpemVkXCIgfTtcblxuICAgICAgICAvLyBSZXVzZSBsZWFkZXJib2FyZCBsb2dpYyB0byBnZXQgcmFua2luZ3NcbiAgICAgICAgY29uc3QgbGVhZGVyYm9hcmQgPSBhd2FpdCBnZXRDb250ZXN0TGVhZGVyYm9hcmQoY29udGVzdElkKTtcbiAgICAgICAgaWYgKCFsZWFkZXJib2FyZC5zdWNjZXNzIHx8ICFsZWFkZXJib2FyZC5zdHVkZW50cykge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBmZXRjaCBsZWFkZXJib2FyZFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBzdHVkZW50cyA9IGxlYWRlcmJvYXJkLnN0dWRlbnRzIGFzIGFueVtdO1xuXG4gICAgICAgIC8vIEF0IGxlYXN0IDEgc3R1ZGVudCBuZWVkZWRcbiAgICAgICAgaWYgKHN0dWRlbnRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgIGF3YWl0IHByaXNtYS5jb250ZXN0LnVwZGF0ZSh7XG4gICAgICAgICAgICAgICAgIHdoZXJlOiB7IGlkOiBjb250ZXN0SWQgfSxcbiAgICAgICAgICAgICAgICAgZGF0YTogeyBpc0ZpbmFsaXplZDogdHJ1ZSB9XG4gICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgbWVzc2FnZTogXCJDb250ZXN0IGZpbmFsaXplZCAobm8gcGFydGljaXBhbnRzKVwiIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBUb3AgMyBJRHNcbiAgICAgICAgY29uc3QgZ29sZFVzZXJJZCA9IHN0dWRlbnRzWzBdPy5pZDtcbiAgICAgICAgY29uc3Qgc2lsdmVyVXNlcklkID0gc3R1ZGVudHNbMV0/LmlkO1xuICAgICAgICBjb25zdCBicm9uemVVc2VySWQgPSBzdHVkZW50c1syXT8uaWQ7XG5cbiAgICAgICAgYXdhaXQgcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgICAgIC8vIEF3YXJkIEdvbGRcbiAgICAgICAgICAgIGlmIChnb2xkVXNlcklkKSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdHgudXNlci51cGRhdGUoe1xuICAgICAgICAgICAgICAgICAgICB3aGVyZTogeyBpZDogZ29sZFVzZXJJZCB9LFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7IGdvbGRCYWRnZXM6IHsgaW5jcmVtZW50OiAxIH0gfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gQXdhcmQgU2lsdmVyXG4gICAgICAgICAgICBpZiAoc2lsdmVyVXNlcklkKSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdHgudXNlci51cGRhdGUoe1xuICAgICAgICAgICAgICAgICAgICB3aGVyZTogeyBpZDogc2lsdmVyVXNlcklkIH0sXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IHsgc2lsdmVyQmFkZ2VzOiB7IGluY3JlbWVudDogMSB9IH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIEF3YXJkIEJyb256ZVxuICAgICAgICAgICAgaWYgKGJyb256ZVVzZXJJZCkge1xuICAgICAgICAgICAgICAgIGF3YWl0IHR4LnVzZXIudXBkYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IGJyb256ZVVzZXJJZCB9LFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7IGJyb256ZUJhZGdlczogeyBpbmNyZW1lbnQ6IDEgfSB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIE1hcmsgRmluYWxpemVkXG4gICAgICAgICAgICBhd2FpdCB0eC5jb250ZXN0LnVwZGF0ZSh7XG4gICAgICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IGNvbnRlc3RJZCB9LFxuICAgICAgICAgICAgICAgIGRhdGE6IHsgaXNGaW5hbGl6ZWQ6IHRydWUgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldmFsaWRhdGVQYXRoKGAvZGFzaGJvYXJkYCk7XG4gICAgICAgIHJldmFsaWRhdGVQYXRoKGAvcHJvZmlsZS8ke2dvbGRVc2VySWR9YCk7XG4gICAgICAgIGlmKHNpbHZlclVzZXJJZCkgcmV2YWxpZGF0ZVBhdGgoYC9wcm9maWxlLyR7c2lsdmVyVXNlcklkfWApO1xuICAgICAgICBpZihicm9uemVVc2VySWQpIHJldmFsaWRhdGVQYXRoKGAvcHJvZmlsZS8ke2Jyb256ZVVzZXJJZH1gKTtcbiAgICAgICAgcmV2YWxpZGF0ZVBhdGgoYC9jb250ZXN0LyR7Y29udGVzdElkfWApO1xuICAgICAgICByZXZhbGlkYXRlVGFnKGBjb250ZXN0LSR7Y29udGVzdElkfWAsIFwibWF4XCIpO1xuICAgICAgICByZXZhbGlkYXRlVGFnKGBsZWFkZXJib2FyZC0ke2NvbnRlc3RJZH1gLCBcIm1heFwiKTtcblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBmaW5hbGl6ZSBjb250ZXN0OlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZmluYWxpemUgY29udGVzdFwiIH07XG4gICAgfVxufVxuXG4vKipcbiAqIFZlcmlmeSBjb250ZXN0IHBhc3N3b3JkIHdpdGhvdXQgc3RhcnRpbmcgc2Vzc2lvbi5cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHZlcmlmeUNvbnRlc3RQYXNzd29yZChjb250ZXN0SWQ6IHN0cmluZywgcGFzc3dvcmQ/OiBzdHJpbmcpIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIGlmICghc2Vzc2lvbj8udXNlcikgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjb250ZXN0ID0gYXdhaXQgcHJpc21hLmNvbnRlc3QuZmluZFVuaXF1ZSh7XG4gICAgICAgICAgICB3aGVyZTogeyBpZDogY29udGVzdElkIH0sXG4gICAgICAgICAgICBzZWxlY3Q6IHsgY29udGVzdFBhc3N3b3JkOiB0cnVlIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKCFjb250ZXN0KSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiQ29udGVzdCBub3QgZm91bmRcIiB9O1xuXG4gICAgICAgIGlmIChjb250ZXN0LmNvbnRlc3RQYXNzd29yZCAmJiBjb250ZXN0LmNvbnRlc3RQYXNzd29yZCAhPT0gcGFzc3dvcmQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJJbnZhbGlkIGNvbnRlc3QgcGFzc3dvcmRcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gdmVyaWZ5IGNvbnRlc3QgcGFzc3dvcmQ6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byB2ZXJpZnkgcGFzc3dvcmRcIiB9O1xuICAgIH1cbn1cblxuXG4vKipcbiAqIFN0YXJ0IGEgY29udGVzdCBzZXNzaW9uIC0gdmFsaWRhdGVzIHRpbWUgYm91bmRzIGFuZCBjcmVhdGVzIHNlc3Npb24gSURcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHN0YXJ0Q29udGVzdFNlc3Npb24oY29udGVzdElkOiBzdHJpbmcsIHBhc3N3b3JkPzogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICBpZiAoIXNlc3Npb24/LnVzZXIpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgY29udGVzdCA9IGF3YWl0IHByaXNtYS5jb250ZXN0LmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IGNvbnRlc3RJZCB9LFxuICAgICAgICAgICAgc2VsZWN0OiB7IHN0YXJ0VGltZTogdHJ1ZSwgZW5kVGltZTogdHJ1ZSwgY29udGVzdFBhc3N3b3JkOiB0cnVlIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKCFjb250ZXN0KSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiQ29udGVzdCBub3QgZm91bmRcIiB9O1xuXG4gICAgICAgIGlmIChjb250ZXN0LmNvbnRlc3RQYXNzd29yZCAmJiBjb250ZXN0LmNvbnRlc3RQYXNzd29yZCAhPT0gcGFzc3dvcmQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJJbnZhbGlkIGNvbnRlc3QgcGFzc3dvcmRcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcblxuICAgICAgICAvLyBUaW1lIGJvdW5kcyBjaGVja1xuICAgICAgICBpZiAobm93IDwgY29udGVzdC5zdGFydFRpbWUpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJDb250ZXN0IGhhcyBub3Qgc3RhcnRlZCB5ZXRcIiB9O1xuICAgICAgICB9XG4gICAgICAgIGlmIChub3cgPiBjb250ZXN0LmVuZFRpbWUpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJDb250ZXN0IGhhcyBhbHJlYWR5IGVuZGVkXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEdlbmVyYXRlIHVuaXF1ZSBzZXNzaW9uIElEXG4gICAgICAgIGNvbnN0IHNlc3Npb25JZCA9IGAke3Nlc3Npb24udXNlci5pZH0tJHtjb250ZXN0SWR9LSR7RGF0ZS5ub3coKX1gO1xuXG4gICAgICAgIC8vIENoZWNrIGZvciBleGlzdGluZyBhY3RpdmUgc2Vzc2lvbiAobXVsdGktdGFiIGRldGVjdGlvbilcbiAgICAgICAgY29uc3QgZXhpc3RpbmdQYXJ0aWNpcGF0aW9uID0gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKGV4aXN0aW5nUGFydGljaXBhdGlvbj8uaXNCbG9ja2VkKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiWW91IGhhdmUgYmVlbiBibG9ja2VkIGZyb20gdGhpcyBjb250ZXN0IGR1ZSB0byB2aW9sYXRpb25zXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChleGlzdGluZ1BhcnRpY2lwYXRpb24/LmlzRmluaXNoZWQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJZb3UgaGF2ZSBhbHJlYWR5IGZpbmlzaGVkIHRoaXMgY29udGVzdFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBVcGRhdGUgb3IgY3JlYXRlIHBhcnRpY2lwYXRpb24gd2l0aCBuZXcgc2Vzc2lvblxuICAgICAgICBjb25zdCBwYXJ0aWNpcGF0aW9uID0gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLnVwc2VydCh7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgIHVzZXJJZF9jb250ZXN0SWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkOiBzZXNzaW9uLnVzZXIuaWQsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlc3RJZDogY29udGVzdElkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHVwZGF0ZToge1xuICAgICAgICAgICAgICAgIHNlc3Npb25JZCxcbiAgICAgICAgICAgICAgICBzZXNzaW9uU3RhcnRlZEF0OiBub3csXG4gICAgICAgICAgICAgICAgYWNjZXB0ZWRSdWxlczogdHJ1ZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNyZWF0ZToge1xuICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgIGNvbnRlc3RJZDogY29udGVzdElkLFxuICAgICAgICAgICAgICAgIHNlc3Npb25JZCxcbiAgICAgICAgICAgICAgICBzZXNzaW9uU3RhcnRlZEF0OiBub3csXG4gICAgICAgICAgICAgICAgYWNjZXB0ZWRSdWxlczogdHJ1ZVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgIHNlc3Npb25JZCxcbiAgICAgICAgICAgIHBhcnRpY2lwYXRpb25JZDogcGFydGljaXBhdGlvbi5pZCxcbiAgICAgICAgICAgIHRvdGFsVmlvbGF0aW9uczogcGFydGljaXBhdGlvbi50b3RhbFZpb2xhdGlvbnMsXG4gICAgICAgICAgICBpc0ZsYWdnZWQ6IHBhcnRpY2lwYXRpb24uaXNGbGFnZ2VkXG4gICAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBzdGFydCBjb250ZXN0IHNlc3Npb246XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBzdGFydCBjb250ZXN0IHNlc3Npb25cIiB9O1xuICAgIH1cbn1cblxuLyoqXG4gKiBMb2cgYSBjb250ZXN0IHZpb2xhdGlvbiAtIHJlY29yZHMgdG8gZGF0YWJhc2UgYW5kIHVwZGF0ZXMgY291bnRlcnNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxvZ0NvbnRlc3RWaW9sYXRpb24oXG4gICAgY29udGVzdElkOiBzdHJpbmcsXG4gICAgdHlwZTogXCJUQUJfU1dJVENIXCIgfCBcIkZVTExTQ1JFRU5fRVhJVFwiIHwgXCJDT1BZX1BBU1RFXCIgfCBcIkRFVlRPT0xTX09QRU5cIiB8IFwiS0VZQk9BUkRfU0hPUlRDVVRcIiB8IFwiTkFWSUdBVElPTl9BVFRFTVBUXCIgfCBcIk1VTFRJX1RBQlwiIHwgXCJTVVNQSUNJT1VTX0lOUFVUXCIsXG4gICAgbWVzc2FnZT86IHN0cmluZyxcbiAgICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT5cbikge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcblxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHBhcnRpY2lwYXRpb24gPSBhd2FpdCBwcmlzbWEuY29udGVzdFBhcnRpY2lwYXRpb24uZmluZFVuaXF1ZSh7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgIHVzZXJJZF9jb250ZXN0SWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkOiBzZXNzaW9uLnVzZXIuaWQsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlc3RJZDogY29udGVzdElkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoIXBhcnRpY2lwYXRpb24pIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJObyBhY3RpdmUgcGFydGljaXBhdGlvbiBmb3VuZFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBEZXRlcm1pbmUgd2hpY2ggY291bnRlciB0byBpbmNyZW1lbnRcbiAgICAgICAgY29uc3QgY291bnRlckZpZWxkID0ge1xuICAgICAgICAgICAgVEFCX1NXSVRDSDogXCJ0YWJTd2l0Y2hDb3VudFwiLFxuICAgICAgICAgICAgRlVMTFNDUkVFTl9FWElUOiBcImZ1bGxzY3JlZW5FeGl0Q291bnRcIixcbiAgICAgICAgICAgIENPUFlfUEFTVEU6IFwiY29weVBhc3RlQ291bnRcIixcbiAgICAgICAgICAgIERFVlRPT0xTX09QRU46IFwiZGV2VG9vbHNDb3VudFwiLFxuICAgICAgICAgICAgS0VZQk9BUkRfU0hPUlRDVVQ6IFwia2V5Ym9hcmRDb3VudFwiLFxuICAgICAgICAgICAgTkFWSUdBVElPTl9BVFRFTVBUOiBcIm5hdmlnYXRpb25Db3VudFwiLFxuICAgICAgICAgICAgTVVMVElfVEFCOiBcInRhYlN3aXRjaENvdW50XCIsXG4gICAgICAgICAgICBTVVNQSUNJT1VTX0lOUFVUOiBcImNvcHlQYXN0ZUNvdW50XCJcbiAgICAgICAgfVt0eXBlXSBhcyBzdHJpbmc7XG5cbiAgICAgICAgLy8gVXNlIHRyYW5zYWN0aW9uIHRvIGVuc3VyZSBhdG9taWMgdXBkYXRlXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHByaXNtYS4kdHJhbnNhY3Rpb24oYXN5bmMgKHR4KSA9PiB7XG4gICAgICAgICAgICAvLyBDaGVjayBsYXN0IHZpb2xhdGlvbiB0aW1lIHRvIHByZXZlbnQgcmFwaWQtZmlyZSBkdXBsaWNhdGVzIChTZXJ2ZXItc2lkZSBkZWJvdW5jZSlcbiAgICAgICAgICAgIGNvbnN0IGxhc3RWaW9sYXRpb24gPSBhd2FpdCB0eC5jb250ZXN0VmlvbGF0aW9uLmZpbmRGaXJzdCh7XG4gICAgICAgICAgICAgICAgd2hlcmU6IHsgcGFydGljaXBhdGlvbklkOiBwYXJ0aWNpcGF0aW9uLmlkIH0sXG4gICAgICAgICAgICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6ICdkZXNjJyB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKGxhc3RWaW9sYXRpb24pIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0aW1lRGlmZiA9IERhdGUubm93KCkgLSBsYXN0VmlvbGF0aW9uLmNyZWF0ZWRBdC5nZXRUaW1lKCk7XG4gICAgICAgICAgICAgICAgLy8gSWYgbGVzcyB0aGFuIDIgc2Vjb25kcyBzaW5jZSBsYXN0IHZpb2xhdGlvbiwgaWdub3JlIHRoaXMgb25lXG4gICAgICAgICAgICAgICAgaWYgKHRpbWVEaWZmIDwgMjAwMCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgLi4ucGFydGljaXBhdGlvbiwgLy8gUmV0dXJuIGV4aXN0aW5nIHN0YXRlXG4gICAgICAgICAgICAgICAgICAgICAgICBpc0ZsYWdnZWQ6IHBhcnRpY2lwYXRpb24uaXNGbGFnZ2VkLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNCbG9ja2VkOiBwYXJ0aWNpcGF0aW9uLmlzQmxvY2tlZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsVmlvbGF0aW9uczogcGFydGljaXBhdGlvbi50b3RhbFZpb2xhdGlvbnMsXG4gICAgICAgICAgICAgICAgICAgICAgICBwZXJtYW5lbnRseUJsb2NrZWQ6IHBhcnRpY2lwYXRpb24ucGVybWFuZW50bHlCbG9ja2VkLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcEJsb2NrZWRVbnRpbDogcGFydGljaXBhdGlvbi50ZW1wQmxvY2tlZFVudGlsXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBDcmVhdGUgdmlvbGF0aW9uIHJlY29yZFxuICAgICAgICAgICAgYXdhaXQgdHguY29udGVzdFZpb2xhdGlvbi5jcmVhdGUoe1xuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgcGFydGljaXBhdGlvbklkOiBwYXJ0aWNpcGF0aW9uLmlkLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiB0eXBlIGFzIGFueSxcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZSxcbiAgICAgICAgICAgICAgICAgICAgbWV0YWRhdGE6IG1ldGFkYXRhID8/IHVuZGVmaW5lZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBDYWxjdWxhdGUgbmV3IHRvdGFsIGFuZCBkZXRlcm1pbmUgYmxvY2tpbmcgdGllclxuICAgICAgICAgICAgY29uc3QgbmV3VG90YWxWaW9sYXRpb25zID0gcGFydGljaXBhdGlvbi50b3RhbFZpb2xhdGlvbnMgKyAxO1xuICAgICAgICAgICAgY29uc3Qgc2hvdWxkRmxhZyA9IG5ld1RvdGFsVmlvbGF0aW9ucyA+PSAzO1xuXG4gICAgICAgICAgICAvLyBUaWVyZWQgYmxvY2tpbmcgbG9naWNcbiAgICAgICAgICAgIGxldCB0ZW1wQmxvY2tlZFVudGlsOiBEYXRlIHwgbnVsbCA9IG51bGw7XG4gICAgICAgICAgICBsZXQgcGVybWFuZW50bHlCbG9ja2VkID0gZmFsc2U7XG4gICAgICAgICAgICBsZXQgaXNCbG9ja2VkID0gZmFsc2U7XG5cbiAgICAgICAgICAgIGlmIChuZXdUb3RhbFZpb2xhdGlvbnMgPj0gNikge1xuICAgICAgICAgICAgICAgIC8vIDYrIHZpb2xhdGlvbnMgPSBwZXJtYW5lbnQgYmxvY2tcbiAgICAgICAgICAgICAgICBwZXJtYW5lbnRseUJsb2NrZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGlzQmxvY2tlZCA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKG5ld1RvdGFsVmlvbGF0aW9ucyA+PSA0KSB7XG4gICAgICAgICAgICAgICAgLy8gNC01IHZpb2xhdGlvbnMgPSA1IG1pbnV0ZSB0ZW1wIGJsb2NrXG4gICAgICAgICAgICAgICAgdGVtcEJsb2NrZWRVbnRpbCA9IG5ldyBEYXRlKERhdGUubm93KCkgKyA1ICogNjAgKiAxMDAwKTsgLy8gNSBtaW51dGVzXG4gICAgICAgICAgICAgICAgaXNCbG9ja2VkID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgdXBkYXRlZCA9IGF3YWl0IHR4LmNvbnRlc3RQYXJ0aWNpcGF0aW9uLnVwZGF0ZSh7XG4gICAgICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IHBhcnRpY2lwYXRpb24uaWQgfSxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIFtjb3VudGVyRmllbGRdOiB7IGluY3JlbWVudDogMSB9LFxuICAgICAgICAgICAgICAgICAgICB0b3RhbFZpb2xhdGlvbnM6IHsgaW5jcmVtZW50OiAxIH0sXG4gICAgICAgICAgICAgICAgICAgIGlzRmxhZ2dlZDogc2hvdWxkRmxhZyB8fCBwYXJ0aWNpcGF0aW9uLmlzRmxhZ2dlZCxcbiAgICAgICAgICAgICAgICAgICAgaXNCbG9ja2VkLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wQmxvY2tlZFVudGlsLFxuICAgICAgICAgICAgICAgICAgICBwZXJtYW5lbnRseUJsb2NrZWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHVwZGF0ZWQ7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgdG90YWxWaW9sYXRpb25zOiByZXN1bHQudG90YWxWaW9sYXRpb25zLFxuICAgICAgICAgICAgaXNGbGFnZ2VkOiByZXN1bHQuaXNGbGFnZ2VkLFxuICAgICAgICAgICAgaXNCbG9ja2VkOiByZXN1bHQuaXNCbG9ja2VkLFxuICAgICAgICAgICAgdGVtcEJsb2NrZWRVbnRpbDogcmVzdWx0LnRlbXBCbG9ja2VkVW50aWw/LnRvSVNPU3RyaW5nKCkgfHwgbnVsbCxcbiAgICAgICAgICAgIHBlcm1hbmVudGx5QmxvY2tlZDogcmVzdWx0LnBlcm1hbmVudGx5QmxvY2tlZFxuICAgICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gbG9nIHZpb2xhdGlvbjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGxvZyB2aW9sYXRpb25cIiB9O1xuICAgIH1cbn1cblxuLyoqXG4gKiBWYWxpZGF0ZSBjb250ZXN0IHNlc3Npb24gLSBjaGVja3MgaWYgc2Vzc2lvbiBpcyB2YWxpZCBmb3Igc3VibWlzc2lvbnNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHZhbGlkYXRlQ29udGVzdFNlc3Npb24oY29udGVzdElkOiBzdHJpbmcsIHNlc3Npb25JZDogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICBpZiAoIXNlc3Npb24/LnVzZXIpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCB2YWxpZDogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBwYXJ0aWNpcGF0aW9uID0gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgY29udGVzdDoge1xuICAgICAgICAgICAgICAgICAgICBzZWxlY3Q6IHsgc3RhcnRUaW1lOiB0cnVlLCBlbmRUaW1lOiB0cnVlIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICghcGFydGljaXBhdGlvbikge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgdmFsaWQ6IGZhbHNlLCByZWFzb246IFwiTm8gcGFydGljaXBhdGlvbiBmb3VuZFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDaGVjayBpZiBibG9ja2VkXG4gICAgICAgIGlmIChwYXJ0aWNpcGF0aW9uLmlzQmxvY2tlZCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgdmFsaWQ6IGZhbHNlLCByZWFzb246IFwiQmxvY2tlZCBkdWUgdG8gdmlvbGF0aW9uc1wiIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDaGVjayBpZiBmaW5pc2hlZFxuICAgICAgICBpZiAocGFydGljaXBhdGlvbi5pc0ZpbmlzaGVkKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCB2YWxpZDogZmFsc2UsIHJlYXNvbjogXCJDb250ZXN0IGFscmVhZHkgZmluaXNoZWRcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ2hlY2sgc2Vzc2lvbiBJRCAobXVsdGktdGFiIGRldGVjdGlvbilcbiAgICAgICAgaWYgKHBhcnRpY2lwYXRpb24uc2Vzc2lvbklkICE9PSBzZXNzaW9uSWQpIHtcbiAgICAgICAgICAgIC8vIExvZyBtdWx0aS10YWIgdmlvbGF0aW9uXG4gICAgICAgICAgICBhd2FpdCBsb2dDb250ZXN0VmlvbGF0aW9uKGNvbnRlc3RJZCwgXCJNVUxUSV9UQUJcIiwgXCJNdWx0aXBsZSB0YWJzIGRldGVjdGVkXCIpO1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgdmFsaWQ6IGZhbHNlLCByZWFzb246IFwiU2Vzc2lvbiBtaXNtYXRjaCAtIHBvc3NpYmxlIG11bHRpcGxlIHRhYnNcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ2hlY2sgdGltZSBib3VuZHNcbiAgICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgICAgICAgaWYgKG5vdyA+IHBhcnRpY2lwYXRpb24uY29udGVzdC5lbmRUaW1lKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCB2YWxpZDogZmFsc2UsIHJlYXNvbjogXCJDb250ZXN0IGhhcyBlbmRlZFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgIHZhbGlkOiB0cnVlLFxuICAgICAgICAgICAgdG90YWxWaW9sYXRpb25zOiBwYXJ0aWNpcGF0aW9uLnRvdGFsVmlvbGF0aW9ucyxcbiAgICAgICAgICAgIGlzRmxhZ2dlZDogcGFydGljaXBhdGlvbi5pc0ZsYWdnZWRcbiAgICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIHZhbGlkYXRlIHNlc3Npb246XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIHZhbGlkOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIHZhbGlkYXRlIHNlc3Npb25cIiB9O1xuICAgIH1cbn1cblxuLyoqXG4gKiBDaGVjayBpZiB1c2VyIGlzIGVsaWdpYmxlIHRvIHN1Ym1pdCAtIHByZS1zdWJtaXNzaW9uIHZhbGlkYXRpb25cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNoZWNrU3VibWlzc2lvbkVsaWdpYmlsaXR5KGNvbnRlc3RJZDogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICBpZiAoIXNlc3Npb24/LnVzZXIpIHJldHVybiB7IGVsaWdpYmxlOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcblxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHBhcnRpY2lwYXRpb24gPSBhd2FpdCBwcmlzbWEuY29udGVzdFBhcnRpY2lwYXRpb24uZmluZFVuaXF1ZSh7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgIHVzZXJJZF9jb250ZXN0SWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkOiBzZXNzaW9uLnVzZXIuaWQsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlc3RJZDogY29udGVzdElkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICBjb250ZXN0OiB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdDogeyBzdGFydFRpbWU6IHRydWUsIGVuZFRpbWU6IHRydWUgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKCFwYXJ0aWNpcGF0aW9uKSB7XG4gICAgICAgICAgICByZXR1cm4geyBlbGlnaWJsZTogZmFsc2UsIHJlYXNvbjogXCJObyBwYXJ0aWNpcGF0aW9uIGZvdW5kXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENoZWNrIHZhcmlvdXMgY29uZGl0aW9uc1xuICAgICAgICBpZiAocGFydGljaXBhdGlvbi5pc0Jsb2NrZWQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IGVsaWdpYmxlOiBmYWxzZSwgcmVhc29uOiBcIkJsb2NrZWQgZHVlIHRvIGV4Y2Vzc2l2ZSB2aW9sYXRpb25zXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChwYXJ0aWNpcGF0aW9uLmlzRmluaXNoZWQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IGVsaWdpYmxlOiBmYWxzZSwgcmVhc29uOiBcIllvdSBoYXZlIGFscmVhZHkgZmluaXNoZWQgdGhpcyBjb250ZXN0XCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgICAgIGlmIChub3cgPCBwYXJ0aWNpcGF0aW9uLmNvbnRlc3Quc3RhcnRUaW1lKSB7XG4gICAgICAgICAgICByZXR1cm4geyBlbGlnaWJsZTogZmFsc2UsIHJlYXNvbjogXCJDb250ZXN0IGhhcyBub3Qgc3RhcnRlZFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobm93ID4gcGFydGljaXBhdGlvbi5jb250ZXN0LmVuZFRpbWUpIHtcbiAgICAgICAgICAgIHJldHVybiB7IGVsaWdpYmxlOiBmYWxzZSwgcmVhc29uOiBcIkNvbnRlc3QgaGFzIGVuZGVkXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBlbGlnaWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHdhcm5pbmdzOiBwYXJ0aWNpcGF0aW9uLmlzRmxhZ2dlZCA/IFtcIllvdXIgc2Vzc2lvbiBoYXMgYmVlbiBmbGFnZ2VkIGZvciByZXZpZXdcIl0gOiBbXVxuICAgICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gY2hlY2sgZWxpZ2liaWxpdHk6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgZWxpZ2libGU6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gY2hlY2sgZWxpZ2liaWxpdHlcIiB9O1xuICAgIH1cbn1cblxuLyoqXG4gKiBHZXQgcGFydGljaXBhdGlvbiBzdGF0dXMgLSBmb3IgVUkgc3RhdGVcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFBhcnRpY2lwYXRpb25TdGF0dXMoY29udGVzdElkOiBzdHJpbmcpIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIGlmICghc2Vzc2lvbj8udXNlcikgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBwYXJ0aWNpcGF0aW9uID0gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgICBhY2NlcHRlZFJ1bGVzOiB0cnVlLFxuICAgICAgICAgICAgICAgIGlzRmluaXNoZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgaXNGbGFnZ2VkOiB0cnVlLFxuICAgICAgICAgICAgICAgIGlzQmxvY2tlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICB0b3RhbFZpb2xhdGlvbnM6IHRydWUsXG4gICAgICAgICAgICAgICAgc2Vzc2lvbklkOiB0cnVlLFxuICAgICAgICAgICAgICAgIHRlbXBCbG9ja2VkVW50aWw6IHRydWUsXG4gICAgICAgICAgICAgICAgcGVybWFuZW50bHlCbG9ja2VkOiB0cnVlXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIENoZWNrIGlmIHRlbXAgYmxvY2sgaGFzIGV4cGlyZWRcbiAgICAgICAgaWYgKHBhcnRpY2lwYXRpb24/LnRlbXBCbG9ja2VkVW50aWwgJiYgbmV3IERhdGUoKSA+IHBhcnRpY2lwYXRpb24udGVtcEJsb2NrZWRVbnRpbCkge1xuICAgICAgICAgICAgLy8gVGVtcCBibG9jayBleHBpcmVkIC0gdW5ibG9ja1xuICAgICAgICAgICAgYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLnVwZGF0ZSh7XG4gICAgICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkX2NvbnRlc3RJZDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgdXNlcklkOiBzZXNzaW9uLnVzZXIuaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIGlzQmxvY2tlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBCbG9ja2VkVW50aWw6IG51bGxcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgICAgIHBhcnRpY2lwYXRpb246IHtcbiAgICAgICAgICAgICAgICAgICAgLi4ucGFydGljaXBhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgaXNCbG9ja2VkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgdGVtcEJsb2NrZWRVbnRpbDogbnVsbFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgIHBhcnRpY2lwYXRpb246IHBhcnRpY2lwYXRpb24gfHwgbnVsbFxuICAgICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZ2V0IHBhcnRpY2lwYXRpb24gc3RhdHVzXCIgfTtcbiAgICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBDT05URVNUIE1BTkFHRVIgLSBQQVJUSUNJUEFOVCBNQU5BR0VNRU5UXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqIEdldCBhbGwgcGFydGljaXBhbnRzIGZvciBhIGNvbnRlc3Qgd2l0aCB2aW9sYXRpb24gZGV0YWlscyAoZm9yIG1hbmFnZXJzKVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q29udGVzdFBhcnRpY2lwYW50cyhjb250ZXN0SWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcblxuICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gc2Vzc2lvbi51c2VyIGFzIGFueTtcblxuICAgIC8vIENoZWNrIGlmIHVzZXIgaXMgY29udGVzdCBtYW5hZ2VyL2NyZWF0b3JcbiAgICBjb25zdCBjb250ZXN0ID0gYXdhaXQgcHJpc21hLmNvbnRlc3QuZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiBjb250ZXN0SWQgfSxcbiAgICAgICAgc2VsZWN0OiB7IGNyZWF0b3JJZDogdHJ1ZSB9XG4gICAgfSk7XG5cbiAgICBpZiAoIWNvbnRlc3QpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJDb250ZXN0IG5vdCBmb3VuZFwiIH07XG5cbiAgICBjb25zdCBpc0F1dGhvcml6ZWQgPVxuICAgICAgICBjdXJyZW50VXNlci5yb2xlID09PSBcIkFETUlOXCIgfHxcbiAgICAgICAgY3VycmVudFVzZXIucm9sZSA9PT0gXCJDT05URVNUX01BTkFHRVJcIiB8fFxuICAgICAgICBjdXJyZW50VXNlci5yb2xlID09PSBcIlRFQUNIRVJcIiB8fFxuICAgICAgICBjb250ZXN0LmNyZWF0b3JJZCA9PT0gY3VycmVudFVzZXIuaWQ7XG5cbiAgICBpZiAoIWlzQXV0aG9yaXplZCkge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBwYXJ0aWNpcGFudHMgPSBhd2FpdCBwcmlzbWEuY29udGVzdFBhcnRpY2lwYXRpb24uZmluZE1hbnkoe1xuICAgICAgICAgICAgd2hlcmU6IHsgY29udGVzdElkIH0sXG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVtYWlsOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgaW1hZ2U6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgdmlvbGF0aW9uczoge1xuICAgICAgICAgICAgICAgICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogXCJkZXNjXCIgfSxcbiAgICAgICAgICAgICAgICAgICAgdGFrZTogMTBcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb3JkZXJCeTogW1xuICAgICAgICAgICAgICAgIHsgcGVybWFuZW50bHlCbG9ja2VkOiBcImRlc2NcIiB9LFxuICAgICAgICAgICAgICAgIHsgaXNCbG9ja2VkOiBcImRlc2NcIiB9LFxuICAgICAgICAgICAgICAgIHsgdG90YWxWaW9sYXRpb25zOiBcImRlc2NcIiB9XG4gICAgICAgICAgICBdXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHBhcnRpY2lwYW50cyB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gZ2V0IHBhcnRpY2lwYW50czpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGdldCBwYXJ0aWNpcGFudHNcIiB9O1xuICAgIH1cbn1cblxuLyoqXG4gKiBVbmJsb2NrIGEgcGFydGljaXBhbnQgKG1hbmFnZXIgb25seSlcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVuYmxvY2tQYXJ0aWNpcGFudChjb250ZXN0SWQ6IHN0cmluZywgdXNlcklkOiBzdHJpbmcpIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIGlmICghc2Vzc2lvbj8udXNlcikgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG5cbiAgICBjb25zdCBjdXJyZW50VXNlciA9IHNlc3Npb24udXNlciBhcyBhbnk7XG5cbiAgICAvLyBDaGVjayBhdXRob3JpemF0aW9uXG4gICAgY29uc3QgY29udGVzdCA9IGF3YWl0IHByaXNtYS5jb250ZXN0LmZpbmRVbmlxdWUoe1xuICAgICAgICB3aGVyZTogeyBpZDogY29udGVzdElkIH0sXG4gICAgICAgIHNlbGVjdDogeyBjcmVhdG9ySWQ6IHRydWUgfVxuICAgIH0pO1xuXG4gICAgaWYgKCFjb250ZXN0KSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiQ29udGVzdCBub3QgZm91bmRcIiB9O1xuXG4gICAgY29uc3QgaXNBdXRob3JpemVkID1cbiAgICAgICAgY3VycmVudFVzZXIucm9sZSA9PT0gXCJBRE1JTlwiIHx8XG4gICAgICAgIGN1cnJlbnRVc2VyLnJvbGUgPT09IFwiQ09OVEVTVF9NQU5BR0VSXCIgfHxcbiAgICAgICAgY3VycmVudFVzZXIucm9sZSA9PT0gXCJURUFDSEVSXCIgfHxcbiAgICAgICAgY29udGVzdC5jcmVhdG9ySWQgPT09IGN1cnJlbnRVc2VyLmlkO1xuXG4gICAgaWYgKCFpc0F1dGhvcml6ZWQpIHtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLnVwZGF0ZSh7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgIHVzZXJJZF9jb250ZXN0SWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgIGlzQmxvY2tlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgdGVtcEJsb2NrZWRVbnRpbDogbnVsbCxcbiAgICAgICAgICAgICAgICBwZXJtYW5lbnRseUJsb2NrZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHRvdGFsVmlvbGF0aW9uczogMCxcbiAgICAgICAgICAgICAgICB0YWJTd2l0Y2hDb3VudDogMCxcbiAgICAgICAgICAgICAgICBmdWxsc2NyZWVuRXhpdENvdW50OiAwLFxuICAgICAgICAgICAgICAgIGNvcHlQYXN0ZUNvdW50OiAwLFxuICAgICAgICAgICAgICAgIGRldlRvb2xzQ291bnQ6IDAsXG4gICAgICAgICAgICAgICAga2V5Ym9hcmRDb3VudDogMCxcbiAgICAgICAgICAgICAgICBuYXZpZ2F0aW9uQ291bnQ6IDAsXG4gICAgICAgICAgICAgICAgaXNGbGFnZ2VkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICB1bmJsb2NrZWRCeTogY3VycmVudFVzZXIuaWQsXG4gICAgICAgICAgICAgICAgdW5ibG9ja2VkQXQ6IG5ldyBEYXRlKClcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV2YWxpZGF0ZVBhdGgoYC9kYXNoYm9hcmQvY29udGVzdHMvJHtjb250ZXN0SWR9L3BhcnRpY2lwYW50c2ApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byB1bmJsb2NrIHBhcnRpY2lwYW50OlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gdW5ibG9jayBwYXJ0aWNpcGFudFwiIH07XG4gICAgfVxufVxuXG4vKipcbiAqIEdldCBkZXRhaWxlZCB2aW9sYXRpb25zIGZvciBhIHBhcnRpY2lwYW50XG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRQYXJ0aWNpcGFudFZpb2xhdGlvbnMoY29udGVzdElkOiBzdHJpbmcsIHVzZXJJZDogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICBpZiAoIXNlc3Npb24/LnVzZXIpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuXG4gICAgY29uc3QgY3VycmVudFVzZXIgPSBzZXNzaW9uLnVzZXIgYXMgYW55O1xuXG4gICAgLy8gQ2hlY2sgYXV0aG9yaXphdGlvblxuICAgIGNvbnN0IGNvbnRlc3QgPSBhd2FpdCBwcmlzbWEuY29udGVzdC5maW5kVW5pcXVlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6IGNvbnRlc3RJZCB9LFxuICAgICAgICBzZWxlY3Q6IHsgY3JlYXRvcklkOiB0cnVlIH1cbiAgICB9KTtcblxuICAgIGlmICghY29udGVzdCkgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkNvbnRlc3Qgbm90IGZvdW5kXCIgfTtcblxuICAgIGNvbnN0IGlzQXV0aG9yaXplZCA9XG4gICAgICAgIGN1cnJlbnRVc2VyLnJvbGUgPT09IFwiQURNSU5cIiB8fFxuICAgICAgICBjdXJyZW50VXNlci5yb2xlID09PSBcIkNPTlRFU1RfTUFOQUdFUlwiIHx8XG4gICAgICAgIGN1cnJlbnRVc2VyLnJvbGUgPT09IFwiVEVBQ0hFUlwiIHx8XG4gICAgICAgIGNvbnRlc3QuY3JlYXRvcklkID09PSBjdXJyZW50VXNlci5pZDtcblxuICAgIGlmICghaXNBdXRob3JpemVkKSB7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHBhcnRpY2lwYXRpb24gPSBhd2FpdCBwcmlzbWEuY29udGVzdFBhcnRpY2lwYXRpb24uZmluZFVuaXF1ZSh7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgIHVzZXJJZF9jb250ZXN0SWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0OiB7IGlkOiB0cnVlLCBuYW1lOiB0cnVlLCBlbWFpbDogdHJ1ZSB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB2aW9sYXRpb25zOiB7XG4gICAgICAgICAgICAgICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiBcImRlc2NcIiB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBwYXJ0aWNpcGF0aW9uIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBnZXQgdmlvbGF0aW9uc1wiIH07XG4gICAgfVxufVxuXG4vKipcbiAqIENhbGN1bGF0ZSBjb250ZXN0IGxlYWRlcmJvYXJkXG4gKiAtIEZldGNoZXMgYWxsIHBhcnRpY2lwYXRpb25zXG4gKiAtIEZldGNoZXMgYWxsIHJlbGV2YW50IHN1Ym1pc3Npb25zXG4gKiAtIENhbGN1bGF0ZXMgc2NvcmVzXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRDb250ZXN0TGVhZGVyYm9hcmQoY29udGVzdElkOiBzdHJpbmcpIHtcbiAgICBcInVzZSBjYWNoZVwiXG4gICAgY2FjaGVUYWcoYGxlYWRlcmJvYXJkLSR7Y29udGVzdElkfWApXG4gICAgY2FjaGVMaWZlKFwibGVhZGVyYm9hcmRcIilcblxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHBhcnRpY2lwYXRpb25zID0gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLmZpbmRNYW55KHtcbiAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgY29udGVzdElkLFxuICAgICAgICAgICAgICAgIC8vIHN0YXJ0ZWRBdDogeyBub3Q6IG51bGwgfSAvLyBPbmx5IHN0YXJ0ZWQgcGFydGljaXBhbnRzIChGaXggaWYgZmllbGQgZXhpc3RzLCBvdGhlcndpc2UgcmVseSBvbiBjcmVhdGVkKVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgaW1hZ2U6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgY29udGVzdCA9IGF3YWl0IHByaXNtYS5jb250ZXN0LmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IGNvbnRlc3RJZCB9LFxuICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgIHByb2JsZW1zOiB7XG4gICAgICAgICAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2JsZW06IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaWZmaWN1bHR5OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbHVnOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29yZTogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgb3JkZXJCeTogeyBvcmRlcjogXCJhc2NcIiB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoIWNvbnRlc3QpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJDb250ZXN0IG5vdCBmb3VuZFwiIH07XG5cbiAgICAgICAgY29uc3QgbGVhZGVyYm9hcmQgPSBhd2FpdCBQcm9taXNlLmFsbChwYXJ0aWNpcGF0aW9ucy5tYXAoYXN5bmMgKHApID0+IHtcbiAgICAgICAgICAgIC8vIEdldCB2YWxpZCBzdWJtaXNzaW9ucyBmb3IgdGhpcyB1c2VyIGluIHRoaXMgY29udGVzdFxuICAgICAgICAgICAgY29uc3Qgc3VibWlzc2lvbnMgPSBhd2FpdCBwcmlzbWEuc3VibWlzc2lvbi5maW5kTWFueSh7XG4gICAgICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkOiBwLnVzZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgY29udGVzdElkOiBjb250ZXN0SWQsXG4gICAgICAgICAgICAgICAgICAgIGNyZWF0ZWRBdDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgZ3RlOiBjb250ZXN0LnN0YXJ0VGltZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGx0ZTogY29udGVzdC5lbmRUaW1lXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBwcm9ibGVtSWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGNyZWF0ZWRBdDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgbGFuZ3VhZ2U6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBDYWxjdWxhdGUgdG90YWwgc2NvcmVcbiAgICAgICAgICAgIC8vIExvZ2ljOiBCZXN0IHN1Ym1pc3Npb24gcGVyIHByb2JsZW0gY291bnRzXG4gICAgICAgICAgICBjb25zdCBwcm9ibGVtU2NvcmVzID0gbmV3IE1hcDxzdHJpbmcsIG51bWJlcj4oKTtcbiAgICAgICAgICAgIGNvbnN0IHByb2JsZW1Tb2x2ZVRpbWVzID0gbmV3IE1hcDxzdHJpbmcsIERhdGU+KCk7XG4gICAgICAgICAgICBjb25zdCBwcm9ibGVtU3VibWlzc2lvbkNvdW50cyA9IG5ldyBNYXA8c3RyaW5nLCBudW1iZXI+KCk7XG4gICAgICAgICAgICBjb25zdCBwcm9ibGVtQmVzdFN1Ym1pc3Npb25zID0gbmV3IE1hcDxzdHJpbmcsIGFueT4oKTtcblxuICAgICAgICAgICAgc3VibWlzc2lvbnMuZm9yRWFjaChzdWIgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRDb3VudCA9IHByb2JsZW1TdWJtaXNzaW9uQ291bnRzLmdldChzdWIucHJvYmxlbUlkKSB8fCAwO1xuICAgICAgICAgICAgICAgIHByb2JsZW1TdWJtaXNzaW9uQ291bnRzLnNldChzdWIucHJvYmxlbUlkLCBjdXJyZW50Q291bnQgKyAxKTtcblxuICAgICAgICAgICAgICAgIGlmIChzdWIuc3RhdHVzID09PSBcIkFDQ0VQVEVEXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudEJlc3QgPSBwcm9ibGVtU2NvcmVzLmdldChzdWIucHJvYmxlbUlkKSB8fCAwO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBwcm9ibGVtRGVmID0gY29udGVzdC5wcm9ibGVtcy5maW5kKGNwID0+IGNwLnByb2JsZW1JZCA9PT0gc3ViLnByb2JsZW1JZCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG1heFNjb3JlID0gcHJvYmxlbURlZj8ucHJvYmxlbS5zY29yZSB8fCAwO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChtYXhTY29yZSA+IGN1cnJlbnRCZXN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgcHJvYmxlbVNjb3Jlcy5zZXQoc3ViLnByb2JsZW1JZCwgbWF4U2NvcmUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRCZXN0VGltZSA9IHByb2JsZW1Tb2x2ZVRpbWVzLmdldChzdWIucHJvYmxlbUlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWN1cnJlbnRCZXN0VGltZSB8fCBzdWIuY3JlYXRlZEF0IDwgY3VycmVudEJlc3RUaW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2JsZW1Tb2x2ZVRpbWVzLnNldChzdWIucHJvYmxlbUlkLCBzdWIuY3JlYXRlZEF0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvYmxlbUJlc3RTdWJtaXNzaW9ucy5zZXQoc3ViLnByb2JsZW1JZCwgc3ViKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgbGV0IHRvdGFsU2NvcmUgPSAwO1xuICAgICAgICAgICAgbGV0IHRvdGFsVGltZU1zID0gMDtcblxuICAgICAgICAgICAgcHJvYmxlbVNjb3Jlcy5mb3JFYWNoKChzY29yZSwgcHJvYmxlbUlkKSA9PiB7XG4gICAgICAgICAgICAgICAgdG90YWxTY29yZSArPSBzY29yZTtcbiAgICAgICAgICAgICAgICBjb25zdCBzb2x2ZW50VGltZSA9IHByb2JsZW1Tb2x2ZVRpbWVzLmdldChwcm9ibGVtSWQpO1xuICAgICAgICAgICAgICAgIGlmIChzb2x2ZW50VGltZSkge1xuICAgICAgICAgICAgICAgICAgICB0b3RhbFRpbWVNcyArPSAoc29sdmVudFRpbWUuZ2V0VGltZSgpIC0gY29udGVzdC5zdGFydFRpbWUuZ2V0VGltZSgpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gTWFwIHN0YXRzIGZvciBlYWNoIHByb2JsZW0gaW4gdGhlIGNvbnRlc3RcbiAgICAgICAgICAgIGNvbnN0IHByb2JsZW1TdGF0cyA9IGNvbnRlc3QucHJvYmxlbXMubWFwKGNwID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBiZXN0U3ViID0gcHJvYmxlbUJlc3RTdWJtaXNzaW9ucy5nZXQoY3AucHJvYmxlbUlkKTtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBwcm9ibGVtSWQ6IGNwLnByb2JsZW1JZCxcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IGNwLnByb2JsZW0udGl0bGUsXG4gICAgICAgICAgICAgICAgICAgIHNsdWc6IGNwLnByb2JsZW0uc2x1ZyxcbiAgICAgICAgICAgICAgICAgICAgc2NvcmU6IHByb2JsZW1TY29yZXMuZ2V0KGNwLnByb2JsZW1JZCkgfHwgMCxcbiAgICAgICAgICAgICAgICAgICAgbWF4U2NvcmU6IGNwLnByb2JsZW0uc2NvcmUsXG4gICAgICAgICAgICAgICAgICAgIHN1Ym1pc3Npb25zOiBwcm9ibGVtU3VibWlzc2lvbkNvdW50cy5nZXQoY3AucHJvYmxlbUlkKSB8fCAwLFxuICAgICAgICAgICAgICAgICAgICBzb2x2ZWQ6IHByb2JsZW1TY29yZXMuaGFzKGNwLnByb2JsZW1JZCksXG4gICAgICAgICAgICAgICAgICAgIHNvbHZlZEF0OiBwcm9ibGVtU29sdmVUaW1lcy5nZXQoY3AucHJvYmxlbUlkKSxcbiAgICAgICAgICAgICAgICAgICAgbGFuZ3VhZ2U6IGJlc3RTdWI/Lmxhbmd1YWdlPy5uYW1lIHx8IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIGxhbmd1YWdlSWQ6IGJlc3RTdWI/Lmxhbmd1YWdlPy5pZCB8fCBudWxsXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnAudXNlcixcbiAgICAgICAgICAgICAgICBzY29yZTogdG90YWxTY29yZSxcbiAgICAgICAgICAgICAgICB0aW1lVGFrZW46IHRvdGFsVGltZU1zLFxuICAgICAgICAgICAgICAgIHByb2JsZW1zU29sdmVkOiBwcm9ibGVtU2NvcmVzLnNpemUsXG4gICAgICAgICAgICAgICAgcHJvYmxlbVN0YXRzXG4gICAgICAgICAgICB9O1xuICAgICAgICB9KSk7XG5cbiAgICAgICAgLy8gU29ydDogSGlnaCBzY29yZSBmaXJzdCwgdGhlbiBsb3cgdGltZSB0YWtlblxuICAgICAgICBsZWFkZXJib2FyZC5zb3J0KChhLCBiKSA9PiB7XG4gICAgICAgICAgICBpZiAoYi5zY29yZSAhPT0gYS5zY29yZSkgcmV0dXJuIGIuc2NvcmUgLSBhLnNjb3JlO1xuICAgICAgICAgICAgcmV0dXJuIGEudGltZVRha2VuIC0gYi50aW1lVGFrZW47XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgc3R1ZGVudHM6IGxlYWRlcmJvYXJkLFxuICAgICAgICAgICAgaXNGaW5hbGl6ZWQ6IGNvbnRlc3QuaXNGaW5hbGl6ZWQsXG4gICAgICAgICAgICBwcm9ibGVtczogY29udGVzdC5wcm9ibGVtcy5tYXAoY3AgPT4gKHtcbiAgICAgICAgICAgICAgICBpZDogY3AucHJvYmxlbUlkLFxuICAgICAgICAgICAgICAgIHRpdGxlOiBjcC5wcm9ibGVtLnRpdGxlLFxuICAgICAgICAgICAgICAgIHNsdWc6IGNwLnByb2JsZW0uc2x1ZyxcbiAgICAgICAgICAgICAgICBtYXhTY29yZTogY3AucHJvYmxlbS5zY29yZVxuICAgICAgICAgICAgfSkpXG4gICAgICAgIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiTGVhZGVyYm9hcmQgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBnZW5lcmF0ZSBsZWFkZXJib2FyZFwiIH07XG4gICAgfVxufVxuXG4vKipcbiAqIEdldCBjdXJyZW50IHVzZXIncyByYW5raW5nIGluIGEgY29udGVzdFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q29udGVzdFJhbmtpbmcoY29udGVzdElkOiBzdHJpbmcpIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIGlmICghc2Vzc2lvbj8udXNlcikgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBnZXRDb250ZXN0TGVhZGVyYm9hcmQoY29udGVzdElkKTtcblxuICAgICAgICBpZiAoIXJlc3VsdC5zdWNjZXNzIHx8ICFyZXN1bHQuc3R1ZGVudHMpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZ2V0IHJhbmtpbmdcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgcmFuayA9IHJlc3VsdC5zdHVkZW50cy5maW5kSW5kZXgoKHM6IGFueSkgPT4gcy5pZCA9PT0gc2Vzc2lvbi51c2VyLmlkKSArIDE7XG5cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgcmFuazogcmFuayA+IDAgPyByYW5rIDogbnVsbCB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGdldCByYW5raW5nXCIgfTtcbiAgICB9XG59XG4iXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IitSQXd0QnNCIn0=
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/actions/data:11eb98 [app-client] (ecmascript) <text/javascript>", ((__turbopack_context__) => {
"use strict";

/* __next_internal_action_entry_do_not_use__ [{"4041a53321b8a41efa0515551dc3e636f81f59f7d7":"getParticipationStatus"},"actions/contest.ts",""] */ __turbopack_context__.s([
    "getParticipationStatus",
    ()=>getParticipationStatus
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-client] (ecmascript)");
"use turbopack no side effects";
;
var getParticipationStatus = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["createServerReference"])("4041a53321b8a41efa0515551dc3e636f81f59f7d7", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["findSourceMapURL"], "getParticipationStatus"); //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vY29udGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzZXJ2ZXJcIjtcblxuaW1wb3J0IHsgcHJpc21hIH0gZnJvbSBcIkAvbGliL3ByaXNtYVwiO1xuaW1wb3J0IHsgYXV0aCB9IGZyb20gXCJAL2xpYi9hdXRoXCI7XG5pbXBvcnQgeyBoZWFkZXJzIH0gZnJvbSBcIm5leHQvaGVhZGVyc1wiO1xuaW1wb3J0IHsgeiB9IGZyb20gXCJ6b2RcIjtcbmltcG9ydCB7IHJldmFsaWRhdGVQYXRoLCByZXZhbGlkYXRlVGFnIH0gZnJvbSBcIm5leHQvY2FjaGVcIjtcbmltcG9ydCB7IGNhY2hlVGFnLCBjYWNoZUxpZmUgfSBmcm9tIFwibmV4dC9jYWNoZVwiO1xuXG5jb25zdCBjb250ZXN0U2NoZW1hID0gei5vYmplY3Qoe1xuICAgIHRpdGxlOiB6LnN0cmluZygpLm1pbigzLCBcIlRpdGxlIG11c3QgYmUgYXQgbGVhc3QgMyBjaGFyYWN0ZXJzXCIpLFxuICAgIGRlc2NyaXB0aW9uOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgc3RhcnRUaW1lOiB6LmNvZXJjZS5kYXRlKCksXG4gICAgZW5kVGltZTogei5jb2VyY2UuZGF0ZSgpLFxuICAgIHZpc2liaWxpdHk6IHouZW51bShbXCJQVUJMSUNcIiwgXCJJTlNUSVRVVElPTlwiLCBcIkNMQVNTUk9PTVwiXSksXG4gICAgY2xhc3Nyb29tSWQ6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgICBpbnN0aXR1dGlvbklkOiB6LnN0cmluZygpLm9wdGlvbmFsKCkubnVsbGFibGUoKSxcbiAgICBwcm9ibGVtczogei5hcnJheSh6LnN0cmluZygpKS5taW4oMSwgXCJTZWxlY3QgYXQgbGVhc3Qgb25lIHByb2JsZW1cIiksXG4gICAgY29udGVzdFBhc3N3b3JkOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgcmFuZG9taXplUXVlc3Rpb25zOiB6LmJvb2xlYW4oKS5kZWZhdWx0KGZhbHNlKSxcbn0pO1xuXG5jb25zdCBjb250ZXN0V2l0aFByb2JsZW1zU2NoZW1hID0gei5vYmplY3Qoe1xuICAgIHRpdGxlOiB6LnN0cmluZygpLm1pbigzLCBcIlRpdGxlIG11c3QgYmUgYXQgbGVhc3QgMyBjaGFyYWN0ZXJzXCIpLFxuICAgIHNsdWc6IHouc3RyaW5nKCkubWluKDMsIFwiU2x1ZyBtdXN0IGJlIGF0IGxlYXN0IDMgY2hhcmFjdGVyc1wiKSxcbiAgICBkZXNjcmlwdGlvbjogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAgIHN0YXJ0VGltZTogei5kYXRlKCksXG4gICAgZW5kVGltZTogei5kYXRlKCksXG4gICAgdmlzaWJpbGl0eTogei5lbnVtKFtcIlBVQkxJQ1wiLCBcIklOU1RJVFVUSU9OXCIsIFwiQ0xBU1NST09NXCJdKSxcbiAgICBoaWRkZW46IHouYm9vbGVhbigpLmRlZmF1bHQoZmFsc2UpLFxuICAgIGNsYXNzcm9vbUlkOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgaW5zdGl0dXRpb25JZDogei5zdHJpbmcoKS5vcHRpb25hbCgpLm51bGxhYmxlKCksXG4gICAgYmFja2dyb3VuZEltYWdlOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgcHJpemVzOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgcnVsZXM6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgICBwcm9ibGVtczogei5hcnJheSh6LmFueSgpKSwgLy8gRnVsbCBwcm9ibGVtIGRhdGEgb2JqZWN0c1xuICAgIGNvbnRlc3RQYXNzd29yZDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAgIHJhbmRvbWl6ZVF1ZXN0aW9uczogei5ib29sZWFuKCkuZGVmYXVsdChmYWxzZSksXG59KTtcblxuLyoqXG4gKiBGZXRjaGVzIGNvbnRlc3RzIHZpc2libGUgdG8gdGhlIGN1cnJlbnQgdXNlci5cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFZpc2libGVDb250ZXN0cygpIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIHRyeSB7XG4gICAgICAgIGlmICghc2Vzc2lvbj8udXNlcikge1xuICAgICAgICAgICAgY29uc3QgY29udGVzdHMgPSBhd2FpdCBwcmlzbWEuY29udGVzdC5maW5kTWFueSh7XG4gICAgICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICAgICAgdmlzaWJpbGl0eTogXCJQVUJMSUNcIixcbiAgICAgICAgICAgICAgICAgICAgaGlkZGVuOiBmYWxzZSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICAgICAgX2NvdW50OiB7IHNlbGVjdDogeyBwcm9ibGVtczogdHJ1ZSB9IH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9yZGVyQnk6IHsgc3RhcnRUaW1lOiBcImRlc2NcIiB9LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBjb250ZXN0cyB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgY3VycmVudFVzZXIgPSBzZXNzaW9uLnVzZXIgYXMgYW55O1xuXG4gICAgICAgIGlmIChjdXJyZW50VXNlci5yb2xlID09PSBcIkFETUlOXCIpIHtcbiAgICAgICAgICAgIGNvbnN0IGNvbnRlc3RzID0gYXdhaXQgcHJpc21hLmNvbnRlc3QuZmluZE1hbnkoe1xuICAgICAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICAgICAgX2NvdW50OiB7IHNlbGVjdDogeyBwcm9ibGVtczogdHJ1ZSB9IH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9yZGVyQnk6IHsgc3RhcnRUaW1lOiBcImRlc2NcIiB9LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBjb250ZXN0cyB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgY29udGVzdHMgPSBhd2FpdCBwcmlzbWEuY29udGVzdC5maW5kTWFueSh7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgIE9SOiBbXG4gICAgICAgICAgICAgICAgICAgIHsgdmlzaWJpbGl0eTogXCJQVUJMSUNcIiB9LFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBBTkQ6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IHZpc2liaWxpdHk6IFwiSU5TVElUVVRJT05cIiB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgaW5zdGl0dXRpb25JZDogY3VycmVudFVzZXIuaW5zdGl0dXRpb25JZCB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgQU5EOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeyB2aXNpYmlsaXR5OiBcIkNMQVNTUk9PTVwiIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBPUjogW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBjbGFzc3Jvb206IHsgc3R1ZGVudHM6IHsgc29tZTogeyBpZDogY3VycmVudFVzZXIuaWQgfSB9IH0gfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgY3JlYXRvcklkOiBjdXJyZW50VXNlci5pZCB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB7IGNyZWF0b3JJZDogY3VycmVudFVzZXIuaWQgfSxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICBfY291bnQ6IHsgc2VsZWN0OiB7IHByb2JsZW1zOiB0cnVlIH0gfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9yZGVyQnk6IHsgc3RhcnRUaW1lOiBcImRlc2NcIiB9LFxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBjb250ZXN0cyB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gZmV0Y2ggY29udGVzdHM6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBmZXRjaCBjb250ZXN0c1wiIH07XG4gICAgfVxufVxuXG5cbi8qKlxuICogRmV0Y2hlcyBhIHNpbmdsZSBjb250ZXN0J3MgZGV0YWlscyB3aXRoIGF1dGhvcml6YXRpb24uXG4gKi9cbi8qKlxuICogRmV0Y2hlcyBhIHNpbmdsZSBjb250ZXN0J3MgZGV0YWlscyB3aXRoIGF1dGhvcml6YXRpb24uXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRDb250ZXN0RGV0YWlsKGNvbnRlc3RJZDogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjb250ZXN0ID0gYXdhaXQgcHJpc21hLmNvbnRlc3QuZmluZFVuaXF1ZSh7XG4gICAgICAgICAgICB3aGVyZTogeyBpZDogY29udGVzdElkIH0sXG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgX2NvdW50OiB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdDogeyBwcm9ibGVtczogdHJ1ZSB9LFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgcHJvYmxlbXM6IHtcbiAgICAgICAgICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJvYmxlbToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpZmZpY3VsdHk6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNsdWc6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIG9yZGVyQnk6IHsgb3JkZXI6IFwiYXNjXCIgfSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKCFjb250ZXN0KSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiQ29udGVzdCBub3QgZm91bmRcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgY3VycmVudFVzZXIgPSBzZXNzaW9uPy51c2VyIGFzIGFueTtcbiAgICAgICAgY29uc3QgcGFydGljaXBhdGlvbiA9IGN1cnJlbnRVc2VyID8gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZDogY3VycmVudFVzZXIuaWQsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlc3RJZDogY29udGVzdElkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KSA6IG51bGw7XG5cbiAgICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgICAgICAgY29uc3QgaGFzU3RhcnRlZCA9IG5vdyA+PSBjb250ZXN0LnN0YXJ0VGltZTtcbiAgICAgICAgY29uc3QgaXNDcmVhdG9yID0gY3VycmVudFVzZXI/LmlkID09PSBjb250ZXN0LmNyZWF0b3JJZDtcbiAgICAgICAgY29uc3QgaXNBZG1pbiA9IGN1cnJlbnRVc2VyPy5yb2xlID09PSBcIkFETUlOXCI7XG5cbiAgICAgICAgLy8gVmlzaWJpbGl0eSBDaGVja1xuICAgICAgICBsZXQgaXNBdXRob3JpemVkID0gZmFsc2U7XG4gICAgICAgIGlmIChjb250ZXN0LnZpc2liaWxpdHkgPT09IFwiUFVCTElDXCIpIHtcbiAgICAgICAgICAgIGlzQXV0aG9yaXplZCA9IHRydWU7XG4gICAgICAgIH0gZWxzZSBpZiAoaXNBZG1pbikge1xuICAgICAgICAgICAgaXNBdXRob3JpemVkID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIGlmIChjdXJyZW50VXNlcikge1xuICAgICAgICAgICAgaWYgKGlzQ3JlYXRvcikge1xuICAgICAgICAgICAgICAgIGlzQXV0aG9yaXplZCA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGNvbnRlc3QudmlzaWJpbGl0eSA9PT0gXCJJTlNUSVRVVElPTlwiKSB7XG4gICAgICAgICAgICAgICAgLy8gVXNlID09IGZvciBudWxsL3VuZGVmaW5lZCBsb29zZSBlcXVhbGl0eSBjaGVja1xuICAgICAgICAgICAgICAgIGlzQXV0aG9yaXplZCA9IGN1cnJlbnRVc2VyLmluc3RpdHV0aW9uSWQgPT0gY29udGVzdC5pbnN0aXR1dGlvbklkO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChjb250ZXN0LnZpc2liaWxpdHkgPT09IFwiQ0xBU1NST09NXCIpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlbnJvbGxtZW50ID0gYXdhaXQgcHJpc21hLmNsYXNzcm9vbS5maW5kRmlyc3Qoe1xuICAgICAgICAgICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGNvbnRlc3QuY2xhc3Nyb29tSWQgYXMgc3RyaW5nLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3R1ZGVudHM6IHsgc29tZTogeyBpZDogY3VycmVudFVzZXIuaWQgfSB9LFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGlzQXV0aG9yaXplZCA9ICEhZW5yb2xsbWVudDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghaXNBdXRob3JpemVkKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkIGFjY2VzcyB0byB0aGlzIGNvbnRlc3QuXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGNhblNlZVByb2JsZW1zID0gKGhhc1N0YXJ0ZWQgfHwgaXNBZG1pbiB8fCBpc0NyZWF0b3IpICYmIChwYXJ0aWNpcGF0aW9uPy5hY2NlcHRlZFJ1bGVzIHx8IGlzQ3JlYXRvciB8fCBpc0FkbWluKTtcblxuICAgICAgICAvLyBGaXg6IElmIHRoZSBjb250ZXN0IGlzIG92ZXIsIGFsbG93ZWQgcm9sZXMgc2hvdWxkIGNoZWNrIHBhcnRpY2lwYXRpb24gcHJvcGVybHksXG4gICAgICAgIC8vIGJ1dCB0eXBpY2FsbHkgYWxsb3dzIHZpZXdpbmcgaWYgcHVibGljL2F1dGhvcml6ZWQuXG4gICAgICAgIC8vIEJ1dCBmb3IgXCJMaXZlXCIgY29udGVzdHMsIHRoZSBjdXJyZW50IGxvZ2ljIGlzIGNvcnJlY3QuXG5cbiAgICAgICAgY29uc3QgcmVxdWlyZXNQYXNzd29yZCA9ICEhY29udGVzdC5jb250ZXN0UGFzc3dvcmQ7XG5cbiAgICAgICAgLy8gU2h1ZmZsZSBwcm9ibGVtcyBpZiByYW5kb21pemVRdWVzdGlvbnMgaXMgZW5hYmxlZFxuICAgICAgICAvLyBVc2UgYSBzaW1wbGUgc2VlZGVkIHNodWZmbGUgYmFzZWQgb24gdXNlcklkICsgY29udGVzdElkIGZvciBjb25zaXN0ZW5jeVxuICAgICAgICBsZXQgdmlzaWJsZVByb2JsZW1zID0gY2FuU2VlUHJvYmxlbXMgPyBjb250ZXN0LnByb2JsZW1zIDogW107XG5cbiAgICAgICAgaWYgKGNvbnRlc3QucmFuZG9taXplUXVlc3Rpb25zICYmIGN1cnJlbnRVc2VyICYmIHZpc2libGVQcm9ibGVtcy5sZW5ndGggPiAwICYmICFpc0FkbWluICYmICFpc0NyZWF0b3IpIHtcbiAgICAgICAgICAgIC8vIFNpbXBsZSBzdHJpbmcgaGFzaCBmdW5jdGlvbiBmb3Igc2VlZGluZ1xuICAgICAgICAgICAgY29uc3Qgc2VlZFN0ciA9IGAke2N1cnJlbnRVc2VyLmlkfS0ke2NvbnRlc3RJZH1gO1xuICAgICAgICAgICAgbGV0IHNlZWQgPSAwO1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzZWVkU3RyLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgc2VlZCA9ICgoc2VlZCA8PCA1KSAtIHNlZWQpICsgc2VlZFN0ci5jaGFyQ29kZUF0KGkpO1xuICAgICAgICAgICAgICAgIHNlZWQgfD0gMDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gRGV0ZXJtaW5pc3RpYyBzaHVmZmxlXG4gICAgICAgICAgICB2aXNpYmxlUHJvYmxlbXMgPSBbLi4udmlzaWJsZVByb2JsZW1zXS5zb3J0KChhLCBiKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgeCA9IE1hdGguc2luKHNlZWQrKykgKiAxMDAwMDtcbiAgICAgICAgICAgICAgICByZXR1cm4gKHggLSBNYXRoLmZsb29yKHgpKSAtIDAuNTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gRmV0Y2ggdXNlcidzIHNvbHZlZCBwcm9ibGVtcyBmb3IgdGhpcyBjb250ZXN0XG4gICAgICAgIGNvbnN0IHNvbHZlZFByb2JsZW1JZHMgPSBuZXcgU2V0PHN0cmluZz4oKTtcbiAgICAgICAgaWYgKGN1cnJlbnRVc2VyKSB7XG4gICAgICAgICAgICBjb25zdCBzb2x2ZWRTdWJtaXNzaW9ucyA9IGF3YWl0IHByaXNtYS5zdWJtaXNzaW9uLmZpbmRNYW55KHtcbiAgICAgICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IGN1cnJlbnRVc2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZCxcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiBcIkFDQ0VQVEVEXCIsXG4gICAgICAgICAgICAgICAgICAgIHByb2JsZW1JZDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgaW46IHZpc2libGVQcm9ibGVtcy5tYXAocCA9PiBwLnByb2JsZW0uaWQpXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHNlbGVjdDogeyBwcm9ibGVtSWQ6IHRydWUgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBzb2x2ZWRTdWJtaXNzaW9ucy5mb3JFYWNoKHMgPT4gc29sdmVkUHJvYmxlbUlkcy5hZGQocy5wcm9ibGVtSWQpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgY29udGVzdDoge1xuICAgICAgICAgICAgICAgIC4uLmNvbnRlc3QsXG4gICAgICAgICAgICAgICAgcHJvYmxlbXM6IHZpc2libGVQcm9ibGVtcy5tYXAodnAgPT4gKHtcbiAgICAgICAgICAgICAgICAgICAgLi4udnAsXG4gICAgICAgICAgICAgICAgICAgIGlzU29sdmVkOiBzb2x2ZWRQcm9ibGVtSWRzLmhhcyh2cC5wcm9ibGVtLmlkKVxuICAgICAgICAgICAgICAgIH0pKSxcbiAgICAgICAgICAgICAgICBoYXNTdGFydGVkLFxuICAgICAgICAgICAgICAgIGhhc0VuZGVkOiBub3cgPiBjb250ZXN0LmVuZFRpbWUsXG4gICAgICAgICAgICAgICAgY2FuTWFuYWdlOiBpc0FkbWluIHx8IGlzQ3JlYXRvcixcbiAgICAgICAgICAgICAgICBoYXNBY2NlcHRlZFJ1bGVzOiBwYXJ0aWNpcGF0aW9uPy5hY2NlcHRlZFJ1bGVzIHx8IGZhbHNlLFxuICAgICAgICAgICAgICAgIGlzRmluaXNoZWQ6IHBhcnRpY2lwYXRpb24/LmlzRmluaXNoZWQgfHwgZmFsc2UsXG4gICAgICAgICAgICAgICAgcmVxdWlyZXNQYXNzd29yZCxcbiAgICAgICAgICAgICAgICBjb250ZXN0UGFzc3dvcmQ6IG51bGwsIC8vIE5ldmVyIHJldHVybiBwbGFpbiBwYXNzd29yZFxuICAgICAgICAgICAgICAgIHNlc3Npb25JZDogcGFydGljaXBhdGlvbj8uc2Vzc2lvbklkIC8vIFJldHVybiBzZXNzaW9uSWQgZm9yIHByb3RlY3Rpb25cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGZldGNoIGNvbnRlc3QgZGV0YWlsOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZmV0Y2ggY29udGVzdFwiIH07XG4gICAgfVxufVxuXG4vLyAuLi4gZXhpc3RpbmcgY29kZSAuLi5cblxuLy8gLi4uIGV4aXN0aW5nIGNvZGUgLi4uXG5cbi8vIC4uLiBleGlzdGluZyBjb2RlIC4uLlxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlQ29udGVzdChkYXRhOiB6LmluZmVyPHR5cGVvZiBjb250ZXN0U2NoZW1hPikge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSB7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuICAgIH1cblxuICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gc2Vzc2lvbi51c2VyIGFzIGFueTtcblxuICAgIGlmICghW1wiQURNSU5cIiwgXCJJTlNUSVRVVElPTl9NQU5BR0VSXCIsIFwiQ09OVEVTVF9NQU5BR0VSXCIsIFwiVEVBQ0hFUlwiXS5pbmNsdWRlcyhjdXJyZW50VXNlci5yb2xlKSkge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCB2YWxpZGF0ZWREYXRhID0gY29udGVzdFNjaGVtYS5wYXJzZShkYXRhKTtcblxuICAgICAgICAvLyBHZW5lcmF0ZSBhIG1vcmUgcm9idXN0IHVuaXF1ZSBzbHVnXG4gICAgICAgIGNvbnN0IGJhc2VTbHVnID0gdmFsaWRhdGVkRGF0YS50aXRsZS50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoL1teYS16MC05XSsvZywgXCItXCIpLnJlcGxhY2UoLyheLXwtJCkvZywgXCJcIik7XG4gICAgICAgIGNvbnN0IHVuaXF1ZVNsdWcgPSBgJHtiYXNlU2x1Z30tJHtEYXRlLm5vdygpfWA7XG5cbiAgICAgICAgY29uc3QgY29udGVzdCA9IGF3YWl0IHByaXNtYS5jb250ZXN0LmNyZWF0ZSh7XG4gICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgdGl0bGU6IHZhbGlkYXRlZERhdGEudGl0bGUsXG4gICAgICAgICAgICAgICAgc2x1ZzogdW5pcXVlU2x1ZyxcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogdmFsaWRhdGVkRGF0YS5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICBzdGFydFRpbWU6IHZhbGlkYXRlZERhdGEuc3RhcnRUaW1lLFxuICAgICAgICAgICAgICAgIGVuZFRpbWU6IHZhbGlkYXRlZERhdGEuZW5kVGltZSxcbiAgICAgICAgICAgICAgICB2aXNpYmlsaXR5OiB2YWxpZGF0ZWREYXRhLnZpc2liaWxpdHkgYXMgYW55LFxuICAgICAgICAgICAgICAgIGluc3RpdHV0aW9uSWQ6IHZhbGlkYXRlZERhdGEudmlzaWJpbGl0eSAhPT0gXCJQVUJMSUNcIiA/ICh2YWxpZGF0ZWREYXRhLmluc3RpdHV0aW9uSWQgfHwgbnVsbCkgOiBudWxsLFxuICAgICAgICAgICAgICAgIGNsYXNzcm9vbUlkOiB2YWxpZGF0ZWREYXRhLnZpc2liaWxpdHkgPT09IFwiQ0xBU1NST09NXCIgPyAodmFsaWRhdGVkRGF0YS5jbGFzc3Jvb21JZCB8fCBudWxsKSA6IG51bGwsXG4gICAgICAgICAgICAgICAgY3JlYXRvcklkOiBjdXJyZW50VXNlci5pZCxcbiAgICAgICAgICAgICAgICBjb250ZXN0UGFzc3dvcmQ6IHZhbGlkYXRlZERhdGEuY29udGVzdFBhc3N3b3JkIHx8IG51bGwsXG4gICAgICAgICAgICAgICAgcmFuZG9taXplUXVlc3Rpb25zOiB2YWxpZGF0ZWREYXRhLnJhbmRvbWl6ZVF1ZXN0aW9ucyB8fCBmYWxzZSxcbiAgICAgICAgICAgICAgICBwcm9ibGVtczoge1xuICAgICAgICAgICAgICAgICAgICBjcmVhdGU6IHZhbGlkYXRlZERhdGEucHJvYmxlbXMubWFwKChwcm9ibGVtSWQsIGluZGV4KSA9PiAoe1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJvYmxlbUlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgb3JkZXI6IGluZGV4LFxuICAgICAgICAgICAgICAgICAgICB9KSksXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC9jb250ZXN0c1wiKTtcbiAgICAgICAgcmV2YWxpZGF0ZVBhdGgoXCIvY29udGVzdFwiKTtcbiAgICAgICAgcmV2YWxpZGF0ZVRhZyhcImNvbnRlc3RzXCIsIFwibWF4XCIpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBjb250ZXN0SWQ6IGNvbnRlc3QuaWQgfTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gY3JlYXRlIGNvbnRlc3Q6XCIsIGVycm9yKTtcbiAgICAgICAgLy8gUmV0dXJuIGNsZWFyZXIgZXJyb3IgbWVzc2FnZXNcbiAgICAgICAgbGV0IGVycm9yTWVzc2FnZSA9IFwiRmFpbGVkIHRvIGNyZWF0ZSBjb250ZXN0XCI7XG4gICAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIHouWm9kRXJyb3IpIHtcbiAgICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSAoZXJyb3IgYXMgYW55KS5lcnJvcnMubWFwKChlOiBhbnkpID0+IGUubWVzc2FnZSkuam9pbihcIiwgXCIpO1xuICAgICAgICB9IGVsc2UgaWYgKGVycm9yIGluc3RhbmNlb2YgRXJyb3IpIHtcbiAgICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSBlcnJvci5tZXNzYWdlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3JNZXNzYWdlIH07XG4gICAgfVxuICAgIH1cblxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlQ29udGVzdFdpdGhQcm9ibGVtcyhkYXRhOiB6LmluZmVyPHR5cGVvZiBjb250ZXN0V2l0aFByb2JsZW1zU2NoZW1hPikge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSB7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuICAgIH1cblxuICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gc2Vzc2lvbi51c2VyIGFzIGFueTtcblxuICAgIGlmICghW1wiQURNSU5cIiwgXCJJTlNUSVRVVElPTl9NQU5BR0VSXCIsIFwiQ09OVEVTVF9NQU5BR0VSXCIsIFwiVEVBQ0hFUlwiXS5pbmNsdWRlcyhjdXJyZW50VXNlci5yb2xlKSkge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCB2YWxpZGF0ZWREYXRhID0gY29udGVzdFdpdGhQcm9ibGVtc1NjaGVtYS5wYXJzZShkYXRhKTtcblxuICAgICAgICBjb25zdCBjb250ZXN0ID0gYXdhaXQgcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNvbnRlc3QgPSBhd2FpdCB0eC5jb250ZXN0LmNyZWF0ZSh7XG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICB0aXRsZTogdmFsaWRhdGVkRGF0YS50aXRsZSxcbiAgICAgICAgICAgICAgICAgICAgc2x1ZzogdmFsaWRhdGVkRGF0YS5zbHVnLFxuICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogdmFsaWRhdGVkRGF0YS5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICAgICAgc3RhcnRUaW1lOiB2YWxpZGF0ZWREYXRhLnN0YXJ0VGltZSxcbiAgICAgICAgICAgICAgICAgICAgZW5kVGltZTogdmFsaWRhdGVkRGF0YS5lbmRUaW1lLFxuICAgICAgICAgICAgICAgICAgICB2aXNpYmlsaXR5OiB2YWxpZGF0ZWREYXRhLnZpc2liaWxpdHkgYXMgYW55LFxuICAgICAgICAgICAgICAgICAgICBoaWRkZW46IHZhbGlkYXRlZERhdGEuaGlkZGVuLFxuICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kSW1hZ2U6IHZhbGlkYXRlZERhdGEuYmFja2dyb3VuZEltYWdlLFxuICAgICAgICAgICAgICAgICAgICBwcml6ZXM6IHZhbGlkYXRlZERhdGEucHJpemVzLFxuICAgICAgICAgICAgICAgICAgICBydWxlczogdmFsaWRhdGVkRGF0YS5ydWxlcyxcbiAgICAgICAgICAgICAgICAgICAgaW5zdGl0dXRpb25JZDogdmFsaWRhdGVkRGF0YS52aXNpYmlsaXR5ICE9PSBcIlBVQkxJQ1wiID8gKHZhbGlkYXRlZERhdGEuaW5zdGl0dXRpb25JZCB8fCBudWxsKSA6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIGNsYXNzcm9vbUlkOiB2YWxpZGF0ZWREYXRhLnZpc2liaWxpdHkgPT09IFwiQ0xBU1NST09NXCIgPyAodmFsaWRhdGVkRGF0YS5jbGFzc3Jvb21JZCB8fCBudWxsKSA6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIGNyZWF0b3JJZDogY3VycmVudFVzZXIuaWQsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlc3RQYXNzd29yZDogdmFsaWRhdGVkRGF0YS5jb250ZXN0UGFzc3dvcmQgfHwgbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgcmFuZG9taXplUXVlc3Rpb25zOiB2YWxpZGF0ZWREYXRhLnJhbmRvbWl6ZVF1ZXN0aW9ucyB8fCBmYWxzZSxcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB2YWxpZGF0ZWREYXRhLnByb2JsZW1zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcCA9IHZhbGlkYXRlZERhdGEucHJvYmxlbXNbaV07XG4gICAgICAgICAgICAgICAgLy8gR2VuZXJhdGUgdW5pcXVlIHNsdWcgYnkgYXBwZW5kaW5nIGNvbnRlc3Qgc2x1ZyBhbmQgaW5kZXhcbiAgICAgICAgICAgICAgICBjb25zdCB1bmlxdWVTbHVnID0gYCR7dmFsaWRhdGVkRGF0YS5zbHVnfS0ke3Auc2x1ZyB8fCBwLnRpdGxlLnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvXFxzKy9nLCAnLScpfS0ke0RhdGUubm93KCl9LSR7aX1gO1xuICAgICAgICAgICAgICAgIGNvbnN0IHByb2JsZW0gPSBhd2FpdCB0eC5wcm9ibGVtLmNyZWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBwLnRpdGxlLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHAuZGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICBkaWZmaWN1bHR5OiBwLmRpZmZpY3VsdHksXG4gICAgICAgICAgICAgICAgICAgICAgICBzbHVnOiB1bmlxdWVTbHVnLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcmU6IHAuc2NvcmUgfHwgMTAsXG4gICAgICAgICAgICAgICAgICAgICAgICBkb21haW46IHAuZG9tYWluLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJDT05URVNUXCIsIC8vIENvbnRlc3QgcHJvYmxlbXMgYXJlIG1hcmtlZCBzZXBhcmF0ZWx5XG4gICAgICAgICAgICAgICAgICAgICAgICBoaWRkZW46IHRydWUsIC8vIENvbnRlc3QgcHJvYmxlbXMgYXJlIGhpZGRlbiBmcm9tIG1haW4gYmFua1xuICAgICAgICAgICAgICAgICAgICAgICAgdGVzdENhc2VzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlOiBwLnRlc3RDYXNlcyxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICB0YWdzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29ubmVjdDogcC50YWdzPy5tYXAoKHQ6IHN0cmluZykgPT4gKHsgbmFtZTogdCB9KSkgfHwgW10sXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGF3YWl0IHR4LmNvbnRlc3RQcm9ibGVtLmNyZWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlc3RJZDogY29udGVzdC5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2JsZW1JZDogcHJvYmxlbS5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG9yZGVyOiBpLFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBjb250ZXN0O1xuICAgICAgICB9KTtcblxuICAgICAgICByZXZhbGlkYXRlUGF0aChcIi9kYXNoYm9hcmQvY29udGVzdHNcIik7XG4gICAgICAgIHJldmFsaWRhdGVQYXRoKFwiL2NvbnRlc3RzXCIpO1xuICAgICAgICByZXZhbGlkYXRlUGF0aChcIi9jb250ZXN0XCIpO1xuICAgICAgICByZXZhbGlkYXRlVGFnKFwiY29udGVzdHNcIiwgXCJtYXhcIik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGNvbnRlc3RJZDogY29udGVzdC5pZCB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gY3JlYXRlIGNvbnRlc3Qgd2l0aCBwcm9ibGVtczpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGNyZWF0ZSBjb250ZXN0XCIgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRJbnN0aXR1dGlvbmFsQ2xhc3Nyb29tcyhpbnN0aXR1dGlvbklkOiBzdHJpbmcpIHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjbGFzc3Jvb21zID0gYXdhaXQgcHJpc21hLmNsYXNzcm9vbS5maW5kTWFueSh7XG4gICAgICAgICAgICB3aGVyZTogeyBpbnN0aXR1dGlvbklkIH0sXG4gICAgICAgICAgICBzZWxlY3Q6IHsgaWQ6IHRydWUsIG5hbWU6IHRydWUsIHNlY3Rpb246IHRydWUgfSxcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGNsYXNzcm9vbXMgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGZldGNoIGNsYXNzcm9vbXM6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBmZXRjaCBjbGFzc3Jvb21zXCIgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRTZWxlY3RhYmxlUHJvYmxlbXMoc2VhcmNoOiBzdHJpbmcpIHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBwcm9ibGVtcyA9IGF3YWl0IHByaXNtYS5wcm9ibGVtLmZpbmRNYW55KHtcbiAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgT1I6IFtcbiAgICAgICAgICAgICAgICAgICAgeyB0aXRsZTogeyBjb250YWluczogc2VhcmNoLCBtb2RlOiBcImluc2Vuc2l0aXZlXCIgfSB9LFxuICAgICAgICAgICAgICAgICAgICB7IHNsdWc6IHsgY29udGFpbnM6IHNlYXJjaCwgbW9kZTogXCJpbnNlbnNpdGl2ZVwiIH0gfSxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIGhpZGRlbjogZmFsc2UsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2VsZWN0OiB7IGlkOiB0cnVlLCB0aXRsZTogdHJ1ZSwgZGlmZmljdWx0eTogdHJ1ZSwgc2x1ZzogdHJ1ZSB9LFxuICAgICAgICAgICAgdGFrZTogMTAsXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBwcm9ibGVtcyB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gZmV0Y2ggcHJvYmxlbXM6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBmZXRjaCBwcm9ibGVtc1wiIH07XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYWNjZXB0Q29udGVzdFJ1bGVzKGNvbnRlc3RJZDogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICBpZiAoIXNlc3Npb24/LnVzZXIpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuXG4gICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLnVwc2VydCh7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgIHVzZXJJZF9jb250ZXN0SWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkOiBzZXNzaW9uLnVzZXIuaWQsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlc3RJZDogY29udGVzdElkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHVwZGF0ZTogeyBhY2NlcHRlZFJ1bGVzOiB0cnVlIH0sXG4gICAgICAgICAgICBjcmVhdGU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWQ6IHNlc3Npb24udXNlci5pZCxcbiAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZCxcbiAgICAgICAgICAgICAgICBhY2NlcHRlZFJ1bGVzOiB0cnVlXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXZhbGlkYXRlUGF0aChgL2NvbnRlc3QvJHtjb250ZXN0SWR9YCk7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGFjY2VwdCBydWxlc1wiIH07XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZmluaXNoQ29udGVzdEFjdGlvbihjb250ZXN0SWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcblxuICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHByaXNtYS5jb250ZXN0UGFydGljaXBhdGlvbi51cHNlcnQoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1cGRhdGU6IHtcbiAgICAgICAgICAgICAgICBpc0ZpbmlzaGVkOiB0cnVlLFxuICAgICAgICAgICAgICAgIGZpbmlzaGVkQXQ6IG5ldyBEYXRlKClcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjcmVhdGU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWQ6IHNlc3Npb24udXNlci5pZCxcbiAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZCxcbiAgICAgICAgICAgICAgICBhY2NlcHRlZFJ1bGVzOiB0cnVlLFxuICAgICAgICAgICAgICAgIGlzRmluaXNoZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgZmluaXNoZWRBdDogbmV3IERhdGUoKVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV2YWxpZGF0ZVBhdGgoYC9jb250ZXN0LyR7Y29udGVzdElkfWApO1xuICAgICAgICByZXZhbGlkYXRlUGF0aChgL3Byb2JsZW1zYCk7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGZpbmlzaCBjb250ZXN0XCIgfTtcbiAgICB9XG59XG5cbi8qKlxuICogRmluYWxpemUgQ29udGVzdCAmIEF3YXJkIEJhZGdlc1xuICogLSBDYWxjdWxhdGVzIGxlYWRlcmJvYXJkXG4gKiAtIEF3YXJkcyBHb2xkLCBTaWx2ZXIsIEJyb256ZSB0byBUb3AgM1xuICogLSBNYXJrcyBjb250ZXN0IGFzIGZpbmFsaXplZFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZmluYWxpemVDb250ZXN0KGNvbnRlc3RJZDogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICBpZiAoIXNlc3Npb24/LnVzZXIpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuXG4gICAgLy8gT25seSBhZG1pbnMgb3IgY29udGVzdCBtYW5hZ2VycyBjYW4gZmluYWxpemVcbiAgICBjb25zdCBjdXJyZW50VXNlciA9IHNlc3Npb24udXNlciBhcyBhbnk7XG4gICAgaWYgKCFbXCJBRE1JTlwiLCBcIkNPTlRFU1RfTUFOQUdFUlwiLCBcIklOU1RJVFVUSU9OX01BTkFHRVJcIiwgXCJURUFDSEVSXCJdLmluY2x1ZGVzKGN1cnJlbnRVc2VyLnJvbGUpKSB7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRlc3QgPSBhd2FpdCBwcmlzbWEuY29udGVzdC5maW5kVW5pcXVlKHtcbiAgICAgICAgICAgICB3aGVyZTogeyBpZDogY29udGVzdElkIH0sXG4gICAgICAgICAgICAgc2VsZWN0OiB7IGlzRmluYWxpemVkOiB0cnVlLCB0aXRsZTogdHJ1ZSB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICghY29udGVzdCkgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkNvbnRlc3Qgbm90IGZvdW5kXCIgfTtcbiAgICAgICAgaWYgKGNvbnRlc3QuaXNGaW5hbGl6ZWQpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJDb250ZXN0IGlzIGFscmVhZHkgZmluYWxpemVkXCIgfTtcblxuICAgICAgICAvLyBSZXVzZSBsZWFkZXJib2FyZCBsb2dpYyB0byBnZXQgcmFua2luZ3NcbiAgICAgICAgY29uc3QgbGVhZGVyYm9hcmQgPSBhd2FpdCBnZXRDb250ZXN0TGVhZGVyYm9hcmQoY29udGVzdElkKTtcbiAgICAgICAgaWYgKCFsZWFkZXJib2FyZC5zdWNjZXNzIHx8ICFsZWFkZXJib2FyZC5zdHVkZW50cykge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBmZXRjaCBsZWFkZXJib2FyZFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBzdHVkZW50cyA9IGxlYWRlcmJvYXJkLnN0dWRlbnRzIGFzIGFueVtdO1xuXG4gICAgICAgIC8vIEF0IGxlYXN0IDEgc3R1ZGVudCBuZWVkZWRcbiAgICAgICAgaWYgKHN0dWRlbnRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgIGF3YWl0IHByaXNtYS5jb250ZXN0LnVwZGF0ZSh7XG4gICAgICAgICAgICAgICAgIHdoZXJlOiB7IGlkOiBjb250ZXN0SWQgfSxcbiAgICAgICAgICAgICAgICAgZGF0YTogeyBpc0ZpbmFsaXplZDogdHJ1ZSB9XG4gICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgbWVzc2FnZTogXCJDb250ZXN0IGZpbmFsaXplZCAobm8gcGFydGljaXBhbnRzKVwiIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBUb3AgMyBJRHNcbiAgICAgICAgY29uc3QgZ29sZFVzZXJJZCA9IHN0dWRlbnRzWzBdPy5pZDtcbiAgICAgICAgY29uc3Qgc2lsdmVyVXNlcklkID0gc3R1ZGVudHNbMV0/LmlkO1xuICAgICAgICBjb25zdCBicm9uemVVc2VySWQgPSBzdHVkZW50c1syXT8uaWQ7XG5cbiAgICAgICAgYXdhaXQgcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgICAgIC8vIEF3YXJkIEdvbGRcbiAgICAgICAgICAgIGlmIChnb2xkVXNlcklkKSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdHgudXNlci51cGRhdGUoe1xuICAgICAgICAgICAgICAgICAgICB3aGVyZTogeyBpZDogZ29sZFVzZXJJZCB9LFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7IGdvbGRCYWRnZXM6IHsgaW5jcmVtZW50OiAxIH0gfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gQXdhcmQgU2lsdmVyXG4gICAgICAgICAgICBpZiAoc2lsdmVyVXNlcklkKSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdHgudXNlci51cGRhdGUoe1xuICAgICAgICAgICAgICAgICAgICB3aGVyZTogeyBpZDogc2lsdmVyVXNlcklkIH0sXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IHsgc2lsdmVyQmFkZ2VzOiB7IGluY3JlbWVudDogMSB9IH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIEF3YXJkIEJyb256ZVxuICAgICAgICAgICAgaWYgKGJyb256ZVVzZXJJZCkge1xuICAgICAgICAgICAgICAgIGF3YWl0IHR4LnVzZXIudXBkYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IGJyb256ZVVzZXJJZCB9LFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7IGJyb256ZUJhZGdlczogeyBpbmNyZW1lbnQ6IDEgfSB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIE1hcmsgRmluYWxpemVkXG4gICAgICAgICAgICBhd2FpdCB0eC5jb250ZXN0LnVwZGF0ZSh7XG4gICAgICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IGNvbnRlc3RJZCB9LFxuICAgICAgICAgICAgICAgIGRhdGE6IHsgaXNGaW5hbGl6ZWQ6IHRydWUgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldmFsaWRhdGVQYXRoKGAvZGFzaGJvYXJkYCk7XG4gICAgICAgIHJldmFsaWRhdGVQYXRoKGAvcHJvZmlsZS8ke2dvbGRVc2VySWR9YCk7XG4gICAgICAgIGlmKHNpbHZlclVzZXJJZCkgcmV2YWxpZGF0ZVBhdGgoYC9wcm9maWxlLyR7c2lsdmVyVXNlcklkfWApO1xuICAgICAgICBpZihicm9uemVVc2VySWQpIHJldmFsaWRhdGVQYXRoKGAvcHJvZmlsZS8ke2Jyb256ZVVzZXJJZH1gKTtcbiAgICAgICAgcmV2YWxpZGF0ZVBhdGgoYC9jb250ZXN0LyR7Y29udGVzdElkfWApO1xuICAgICAgICByZXZhbGlkYXRlVGFnKGBjb250ZXN0LSR7Y29udGVzdElkfWAsIFwibWF4XCIpO1xuICAgICAgICByZXZhbGlkYXRlVGFnKGBsZWFkZXJib2FyZC0ke2NvbnRlc3RJZH1gLCBcIm1heFwiKTtcblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBmaW5hbGl6ZSBjb250ZXN0OlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZmluYWxpemUgY29udGVzdFwiIH07XG4gICAgfVxufVxuXG4vKipcbiAqIFZlcmlmeSBjb250ZXN0IHBhc3N3b3JkIHdpdGhvdXQgc3RhcnRpbmcgc2Vzc2lvbi5cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHZlcmlmeUNvbnRlc3RQYXNzd29yZChjb250ZXN0SWQ6IHN0cmluZywgcGFzc3dvcmQ/OiBzdHJpbmcpIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIGlmICghc2Vzc2lvbj8udXNlcikgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjb250ZXN0ID0gYXdhaXQgcHJpc21hLmNvbnRlc3QuZmluZFVuaXF1ZSh7XG4gICAgICAgICAgICB3aGVyZTogeyBpZDogY29udGVzdElkIH0sXG4gICAgICAgICAgICBzZWxlY3Q6IHsgY29udGVzdFBhc3N3b3JkOiB0cnVlIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKCFjb250ZXN0KSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiQ29udGVzdCBub3QgZm91bmRcIiB9O1xuXG4gICAgICAgIGlmIChjb250ZXN0LmNvbnRlc3RQYXNzd29yZCAmJiBjb250ZXN0LmNvbnRlc3RQYXNzd29yZCAhPT0gcGFzc3dvcmQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJJbnZhbGlkIGNvbnRlc3QgcGFzc3dvcmRcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gdmVyaWZ5IGNvbnRlc3QgcGFzc3dvcmQ6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byB2ZXJpZnkgcGFzc3dvcmRcIiB9O1xuICAgIH1cbn1cblxuXG4vKipcbiAqIFN0YXJ0IGEgY29udGVzdCBzZXNzaW9uIC0gdmFsaWRhdGVzIHRpbWUgYm91bmRzIGFuZCBjcmVhdGVzIHNlc3Npb24gSURcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHN0YXJ0Q29udGVzdFNlc3Npb24oY29udGVzdElkOiBzdHJpbmcsIHBhc3N3b3JkPzogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICBpZiAoIXNlc3Npb24/LnVzZXIpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgY29udGVzdCA9IGF3YWl0IHByaXNtYS5jb250ZXN0LmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IGNvbnRlc3RJZCB9LFxuICAgICAgICAgICAgc2VsZWN0OiB7IHN0YXJ0VGltZTogdHJ1ZSwgZW5kVGltZTogdHJ1ZSwgY29udGVzdFBhc3N3b3JkOiB0cnVlIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKCFjb250ZXN0KSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiQ29udGVzdCBub3QgZm91bmRcIiB9O1xuXG4gICAgICAgIGlmIChjb250ZXN0LmNvbnRlc3RQYXNzd29yZCAmJiBjb250ZXN0LmNvbnRlc3RQYXNzd29yZCAhPT0gcGFzc3dvcmQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJJbnZhbGlkIGNvbnRlc3QgcGFzc3dvcmRcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcblxuICAgICAgICAvLyBUaW1lIGJvdW5kcyBjaGVja1xuICAgICAgICBpZiAobm93IDwgY29udGVzdC5zdGFydFRpbWUpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJDb250ZXN0IGhhcyBub3Qgc3RhcnRlZCB5ZXRcIiB9O1xuICAgICAgICB9XG4gICAgICAgIGlmIChub3cgPiBjb250ZXN0LmVuZFRpbWUpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJDb250ZXN0IGhhcyBhbHJlYWR5IGVuZGVkXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEdlbmVyYXRlIHVuaXF1ZSBzZXNzaW9uIElEXG4gICAgICAgIGNvbnN0IHNlc3Npb25JZCA9IGAke3Nlc3Npb24udXNlci5pZH0tJHtjb250ZXN0SWR9LSR7RGF0ZS5ub3coKX1gO1xuXG4gICAgICAgIC8vIENoZWNrIGZvciBleGlzdGluZyBhY3RpdmUgc2Vzc2lvbiAobXVsdGktdGFiIGRldGVjdGlvbilcbiAgICAgICAgY29uc3QgZXhpc3RpbmdQYXJ0aWNpcGF0aW9uID0gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKGV4aXN0aW5nUGFydGljaXBhdGlvbj8uaXNCbG9ja2VkKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiWW91IGhhdmUgYmVlbiBibG9ja2VkIGZyb20gdGhpcyBjb250ZXN0IGR1ZSB0byB2aW9sYXRpb25zXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChleGlzdGluZ1BhcnRpY2lwYXRpb24/LmlzRmluaXNoZWQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJZb3UgaGF2ZSBhbHJlYWR5IGZpbmlzaGVkIHRoaXMgY29udGVzdFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBVcGRhdGUgb3IgY3JlYXRlIHBhcnRpY2lwYXRpb24gd2l0aCBuZXcgc2Vzc2lvblxuICAgICAgICBjb25zdCBwYXJ0aWNpcGF0aW9uID0gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLnVwc2VydCh7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgIHVzZXJJZF9jb250ZXN0SWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkOiBzZXNzaW9uLnVzZXIuaWQsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlc3RJZDogY29udGVzdElkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHVwZGF0ZToge1xuICAgICAgICAgICAgICAgIHNlc3Npb25JZCxcbiAgICAgICAgICAgICAgICBzZXNzaW9uU3RhcnRlZEF0OiBub3csXG4gICAgICAgICAgICAgICAgYWNjZXB0ZWRSdWxlczogdHJ1ZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNyZWF0ZToge1xuICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgIGNvbnRlc3RJZDogY29udGVzdElkLFxuICAgICAgICAgICAgICAgIHNlc3Npb25JZCxcbiAgICAgICAgICAgICAgICBzZXNzaW9uU3RhcnRlZEF0OiBub3csXG4gICAgICAgICAgICAgICAgYWNjZXB0ZWRSdWxlczogdHJ1ZVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgIHNlc3Npb25JZCxcbiAgICAgICAgICAgIHBhcnRpY2lwYXRpb25JZDogcGFydGljaXBhdGlvbi5pZCxcbiAgICAgICAgICAgIHRvdGFsVmlvbGF0aW9uczogcGFydGljaXBhdGlvbi50b3RhbFZpb2xhdGlvbnMsXG4gICAgICAgICAgICBpc0ZsYWdnZWQ6IHBhcnRpY2lwYXRpb24uaXNGbGFnZ2VkXG4gICAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBzdGFydCBjb250ZXN0IHNlc3Npb246XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBzdGFydCBjb250ZXN0IHNlc3Npb25cIiB9O1xuICAgIH1cbn1cblxuLyoqXG4gKiBMb2cgYSBjb250ZXN0IHZpb2xhdGlvbiAtIHJlY29yZHMgdG8gZGF0YWJhc2UgYW5kIHVwZGF0ZXMgY291bnRlcnNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxvZ0NvbnRlc3RWaW9sYXRpb24oXG4gICAgY29udGVzdElkOiBzdHJpbmcsXG4gICAgdHlwZTogXCJUQUJfU1dJVENIXCIgfCBcIkZVTExTQ1JFRU5fRVhJVFwiIHwgXCJDT1BZX1BBU1RFXCIgfCBcIkRFVlRPT0xTX09QRU5cIiB8IFwiS0VZQk9BUkRfU0hPUlRDVVRcIiB8IFwiTkFWSUdBVElPTl9BVFRFTVBUXCIgfCBcIk1VTFRJX1RBQlwiIHwgXCJTVVNQSUNJT1VTX0lOUFVUXCIsXG4gICAgbWVzc2FnZT86IHN0cmluZyxcbiAgICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT5cbikge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcblxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHBhcnRpY2lwYXRpb24gPSBhd2FpdCBwcmlzbWEuY29udGVzdFBhcnRpY2lwYXRpb24uZmluZFVuaXF1ZSh7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgIHVzZXJJZF9jb250ZXN0SWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkOiBzZXNzaW9uLnVzZXIuaWQsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlc3RJZDogY29udGVzdElkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoIXBhcnRpY2lwYXRpb24pIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJObyBhY3RpdmUgcGFydGljaXBhdGlvbiBmb3VuZFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBEZXRlcm1pbmUgd2hpY2ggY291bnRlciB0byBpbmNyZW1lbnRcbiAgICAgICAgY29uc3QgY291bnRlckZpZWxkID0ge1xuICAgICAgICAgICAgVEFCX1NXSVRDSDogXCJ0YWJTd2l0Y2hDb3VudFwiLFxuICAgICAgICAgICAgRlVMTFNDUkVFTl9FWElUOiBcImZ1bGxzY3JlZW5FeGl0Q291bnRcIixcbiAgICAgICAgICAgIENPUFlfUEFTVEU6IFwiY29weVBhc3RlQ291bnRcIixcbiAgICAgICAgICAgIERFVlRPT0xTX09QRU46IFwiZGV2VG9vbHNDb3VudFwiLFxuICAgICAgICAgICAgS0VZQk9BUkRfU0hPUlRDVVQ6IFwia2V5Ym9hcmRDb3VudFwiLFxuICAgICAgICAgICAgTkFWSUdBVElPTl9BVFRFTVBUOiBcIm5hdmlnYXRpb25Db3VudFwiLFxuICAgICAgICAgICAgTVVMVElfVEFCOiBcInRhYlN3aXRjaENvdW50XCIsXG4gICAgICAgICAgICBTVVNQSUNJT1VTX0lOUFVUOiBcImNvcHlQYXN0ZUNvdW50XCJcbiAgICAgICAgfVt0eXBlXSBhcyBzdHJpbmc7XG5cbiAgICAgICAgLy8gVXNlIHRyYW5zYWN0aW9uIHRvIGVuc3VyZSBhdG9taWMgdXBkYXRlXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHByaXNtYS4kdHJhbnNhY3Rpb24oYXN5bmMgKHR4KSA9PiB7XG4gICAgICAgICAgICAvLyBDaGVjayBsYXN0IHZpb2xhdGlvbiB0aW1lIHRvIHByZXZlbnQgcmFwaWQtZmlyZSBkdXBsaWNhdGVzIChTZXJ2ZXItc2lkZSBkZWJvdW5jZSlcbiAgICAgICAgICAgIGNvbnN0IGxhc3RWaW9sYXRpb24gPSBhd2FpdCB0eC5jb250ZXN0VmlvbGF0aW9uLmZpbmRGaXJzdCh7XG4gICAgICAgICAgICAgICAgd2hlcmU6IHsgcGFydGljaXBhdGlvbklkOiBwYXJ0aWNpcGF0aW9uLmlkIH0sXG4gICAgICAgICAgICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6ICdkZXNjJyB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKGxhc3RWaW9sYXRpb24pIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0aW1lRGlmZiA9IERhdGUubm93KCkgLSBsYXN0VmlvbGF0aW9uLmNyZWF0ZWRBdC5nZXRUaW1lKCk7XG4gICAgICAgICAgICAgICAgLy8gSWYgbGVzcyB0aGFuIDIgc2Vjb25kcyBzaW5jZSBsYXN0IHZpb2xhdGlvbiwgaWdub3JlIHRoaXMgb25lXG4gICAgICAgICAgICAgICAgaWYgKHRpbWVEaWZmIDwgMjAwMCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgLi4ucGFydGljaXBhdGlvbiwgLy8gUmV0dXJuIGV4aXN0aW5nIHN0YXRlXG4gICAgICAgICAgICAgICAgICAgICAgICBpc0ZsYWdnZWQ6IHBhcnRpY2lwYXRpb24uaXNGbGFnZ2VkLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNCbG9ja2VkOiBwYXJ0aWNpcGF0aW9uLmlzQmxvY2tlZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsVmlvbGF0aW9uczogcGFydGljaXBhdGlvbi50b3RhbFZpb2xhdGlvbnMsXG4gICAgICAgICAgICAgICAgICAgICAgICBwZXJtYW5lbnRseUJsb2NrZWQ6IHBhcnRpY2lwYXRpb24ucGVybWFuZW50bHlCbG9ja2VkLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcEJsb2NrZWRVbnRpbDogcGFydGljaXBhdGlvbi50ZW1wQmxvY2tlZFVudGlsXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBDcmVhdGUgdmlvbGF0aW9uIHJlY29yZFxuICAgICAgICAgICAgYXdhaXQgdHguY29udGVzdFZpb2xhdGlvbi5jcmVhdGUoe1xuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgcGFydGljaXBhdGlvbklkOiBwYXJ0aWNpcGF0aW9uLmlkLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiB0eXBlIGFzIGFueSxcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZSxcbiAgICAgICAgICAgICAgICAgICAgbWV0YWRhdGE6IG1ldGFkYXRhID8/IHVuZGVmaW5lZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBDYWxjdWxhdGUgbmV3IHRvdGFsIGFuZCBkZXRlcm1pbmUgYmxvY2tpbmcgdGllclxuICAgICAgICAgICAgY29uc3QgbmV3VG90YWxWaW9sYXRpb25zID0gcGFydGljaXBhdGlvbi50b3RhbFZpb2xhdGlvbnMgKyAxO1xuICAgICAgICAgICAgY29uc3Qgc2hvdWxkRmxhZyA9IG5ld1RvdGFsVmlvbGF0aW9ucyA+PSAzO1xuXG4gICAgICAgICAgICAvLyBUaWVyZWQgYmxvY2tpbmcgbG9naWNcbiAgICAgICAgICAgIGxldCB0ZW1wQmxvY2tlZFVudGlsOiBEYXRlIHwgbnVsbCA9IG51bGw7XG4gICAgICAgICAgICBsZXQgcGVybWFuZW50bHlCbG9ja2VkID0gZmFsc2U7XG4gICAgICAgICAgICBsZXQgaXNCbG9ja2VkID0gZmFsc2U7XG5cbiAgICAgICAgICAgIGlmIChuZXdUb3RhbFZpb2xhdGlvbnMgPj0gNikge1xuICAgICAgICAgICAgICAgIC8vIDYrIHZpb2xhdGlvbnMgPSBwZXJtYW5lbnQgYmxvY2tcbiAgICAgICAgICAgICAgICBwZXJtYW5lbnRseUJsb2NrZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGlzQmxvY2tlZCA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKG5ld1RvdGFsVmlvbGF0aW9ucyA+PSA0KSB7XG4gICAgICAgICAgICAgICAgLy8gNC01IHZpb2xhdGlvbnMgPSA1IG1pbnV0ZSB0ZW1wIGJsb2NrXG4gICAgICAgICAgICAgICAgdGVtcEJsb2NrZWRVbnRpbCA9IG5ldyBEYXRlKERhdGUubm93KCkgKyA1ICogNjAgKiAxMDAwKTsgLy8gNSBtaW51dGVzXG4gICAgICAgICAgICAgICAgaXNCbG9ja2VkID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgdXBkYXRlZCA9IGF3YWl0IHR4LmNvbnRlc3RQYXJ0aWNpcGF0aW9uLnVwZGF0ZSh7XG4gICAgICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IHBhcnRpY2lwYXRpb24uaWQgfSxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIFtjb3VudGVyRmllbGRdOiB7IGluY3JlbWVudDogMSB9LFxuICAgICAgICAgICAgICAgICAgICB0b3RhbFZpb2xhdGlvbnM6IHsgaW5jcmVtZW50OiAxIH0sXG4gICAgICAgICAgICAgICAgICAgIGlzRmxhZ2dlZDogc2hvdWxkRmxhZyB8fCBwYXJ0aWNpcGF0aW9uLmlzRmxhZ2dlZCxcbiAgICAgICAgICAgICAgICAgICAgaXNCbG9ja2VkLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wQmxvY2tlZFVudGlsLFxuICAgICAgICAgICAgICAgICAgICBwZXJtYW5lbnRseUJsb2NrZWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHVwZGF0ZWQ7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgdG90YWxWaW9sYXRpb25zOiByZXN1bHQudG90YWxWaW9sYXRpb25zLFxuICAgICAgICAgICAgaXNGbGFnZ2VkOiByZXN1bHQuaXNGbGFnZ2VkLFxuICAgICAgICAgICAgaXNCbG9ja2VkOiByZXN1bHQuaXNCbG9ja2VkLFxuICAgICAgICAgICAgdGVtcEJsb2NrZWRVbnRpbDogcmVzdWx0LnRlbXBCbG9ja2VkVW50aWw/LnRvSVNPU3RyaW5nKCkgfHwgbnVsbCxcbiAgICAgICAgICAgIHBlcm1hbmVudGx5QmxvY2tlZDogcmVzdWx0LnBlcm1hbmVudGx5QmxvY2tlZFxuICAgICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gbG9nIHZpb2xhdGlvbjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGxvZyB2aW9sYXRpb25cIiB9O1xuICAgIH1cbn1cblxuLyoqXG4gKiBWYWxpZGF0ZSBjb250ZXN0IHNlc3Npb24gLSBjaGVja3MgaWYgc2Vzc2lvbiBpcyB2YWxpZCBmb3Igc3VibWlzc2lvbnNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHZhbGlkYXRlQ29udGVzdFNlc3Npb24oY29udGVzdElkOiBzdHJpbmcsIHNlc3Npb25JZDogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICBpZiAoIXNlc3Npb24/LnVzZXIpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCB2YWxpZDogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBwYXJ0aWNpcGF0aW9uID0gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgY29udGVzdDoge1xuICAgICAgICAgICAgICAgICAgICBzZWxlY3Q6IHsgc3RhcnRUaW1lOiB0cnVlLCBlbmRUaW1lOiB0cnVlIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICghcGFydGljaXBhdGlvbikge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgdmFsaWQ6IGZhbHNlLCByZWFzb246IFwiTm8gcGFydGljaXBhdGlvbiBmb3VuZFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDaGVjayBpZiBibG9ja2VkXG4gICAgICAgIGlmIChwYXJ0aWNpcGF0aW9uLmlzQmxvY2tlZCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgdmFsaWQ6IGZhbHNlLCByZWFzb246IFwiQmxvY2tlZCBkdWUgdG8gdmlvbGF0aW9uc1wiIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDaGVjayBpZiBmaW5pc2hlZFxuICAgICAgICBpZiAocGFydGljaXBhdGlvbi5pc0ZpbmlzaGVkKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCB2YWxpZDogZmFsc2UsIHJlYXNvbjogXCJDb250ZXN0IGFscmVhZHkgZmluaXNoZWRcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ2hlY2sgc2Vzc2lvbiBJRCAobXVsdGktdGFiIGRldGVjdGlvbilcbiAgICAgICAgaWYgKHBhcnRpY2lwYXRpb24uc2Vzc2lvbklkICE9PSBzZXNzaW9uSWQpIHtcbiAgICAgICAgICAgIC8vIExvZyBtdWx0aS10YWIgdmlvbGF0aW9uXG4gICAgICAgICAgICBhd2FpdCBsb2dDb250ZXN0VmlvbGF0aW9uKGNvbnRlc3RJZCwgXCJNVUxUSV9UQUJcIiwgXCJNdWx0aXBsZSB0YWJzIGRldGVjdGVkXCIpO1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgdmFsaWQ6IGZhbHNlLCByZWFzb246IFwiU2Vzc2lvbiBtaXNtYXRjaCAtIHBvc3NpYmxlIG11bHRpcGxlIHRhYnNcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ2hlY2sgdGltZSBib3VuZHNcbiAgICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgICAgICAgaWYgKG5vdyA+IHBhcnRpY2lwYXRpb24uY29udGVzdC5lbmRUaW1lKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCB2YWxpZDogZmFsc2UsIHJlYXNvbjogXCJDb250ZXN0IGhhcyBlbmRlZFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgIHZhbGlkOiB0cnVlLFxuICAgICAgICAgICAgdG90YWxWaW9sYXRpb25zOiBwYXJ0aWNpcGF0aW9uLnRvdGFsVmlvbGF0aW9ucyxcbiAgICAgICAgICAgIGlzRmxhZ2dlZDogcGFydGljaXBhdGlvbi5pc0ZsYWdnZWRcbiAgICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIHZhbGlkYXRlIHNlc3Npb246XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIHZhbGlkOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIHZhbGlkYXRlIHNlc3Npb25cIiB9O1xuICAgIH1cbn1cblxuLyoqXG4gKiBDaGVjayBpZiB1c2VyIGlzIGVsaWdpYmxlIHRvIHN1Ym1pdCAtIHByZS1zdWJtaXNzaW9uIHZhbGlkYXRpb25cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNoZWNrU3VibWlzc2lvbkVsaWdpYmlsaXR5KGNvbnRlc3RJZDogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICBpZiAoIXNlc3Npb24/LnVzZXIpIHJldHVybiB7IGVsaWdpYmxlOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcblxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHBhcnRpY2lwYXRpb24gPSBhd2FpdCBwcmlzbWEuY29udGVzdFBhcnRpY2lwYXRpb24uZmluZFVuaXF1ZSh7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgIHVzZXJJZF9jb250ZXN0SWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkOiBzZXNzaW9uLnVzZXIuaWQsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlc3RJZDogY29udGVzdElkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICBjb250ZXN0OiB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdDogeyBzdGFydFRpbWU6IHRydWUsIGVuZFRpbWU6IHRydWUgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKCFwYXJ0aWNpcGF0aW9uKSB7XG4gICAgICAgICAgICByZXR1cm4geyBlbGlnaWJsZTogZmFsc2UsIHJlYXNvbjogXCJObyBwYXJ0aWNpcGF0aW9uIGZvdW5kXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENoZWNrIHZhcmlvdXMgY29uZGl0aW9uc1xuICAgICAgICBpZiAocGFydGljaXBhdGlvbi5pc0Jsb2NrZWQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IGVsaWdpYmxlOiBmYWxzZSwgcmVhc29uOiBcIkJsb2NrZWQgZHVlIHRvIGV4Y2Vzc2l2ZSB2aW9sYXRpb25zXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChwYXJ0aWNpcGF0aW9uLmlzRmluaXNoZWQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IGVsaWdpYmxlOiBmYWxzZSwgcmVhc29uOiBcIllvdSBoYXZlIGFscmVhZHkgZmluaXNoZWQgdGhpcyBjb250ZXN0XCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgICAgIGlmIChub3cgPCBwYXJ0aWNpcGF0aW9uLmNvbnRlc3Quc3RhcnRUaW1lKSB7XG4gICAgICAgICAgICByZXR1cm4geyBlbGlnaWJsZTogZmFsc2UsIHJlYXNvbjogXCJDb250ZXN0IGhhcyBub3Qgc3RhcnRlZFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobm93ID4gcGFydGljaXBhdGlvbi5jb250ZXN0LmVuZFRpbWUpIHtcbiAgICAgICAgICAgIHJldHVybiB7IGVsaWdpYmxlOiBmYWxzZSwgcmVhc29uOiBcIkNvbnRlc3QgaGFzIGVuZGVkXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBlbGlnaWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHdhcm5pbmdzOiBwYXJ0aWNpcGF0aW9uLmlzRmxhZ2dlZCA/IFtcIllvdXIgc2Vzc2lvbiBoYXMgYmVlbiBmbGFnZ2VkIGZvciByZXZpZXdcIl0gOiBbXVxuICAgICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gY2hlY2sgZWxpZ2liaWxpdHk6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgZWxpZ2libGU6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gY2hlY2sgZWxpZ2liaWxpdHlcIiB9O1xuICAgIH1cbn1cblxuLyoqXG4gKiBHZXQgcGFydGljaXBhdGlvbiBzdGF0dXMgLSBmb3IgVUkgc3RhdGVcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFBhcnRpY2lwYXRpb25TdGF0dXMoY29udGVzdElkOiBzdHJpbmcpIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIGlmICghc2Vzc2lvbj8udXNlcikgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBwYXJ0aWNpcGF0aW9uID0gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgICBhY2NlcHRlZFJ1bGVzOiB0cnVlLFxuICAgICAgICAgICAgICAgIGlzRmluaXNoZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgaXNGbGFnZ2VkOiB0cnVlLFxuICAgICAgICAgICAgICAgIGlzQmxvY2tlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICB0b3RhbFZpb2xhdGlvbnM6IHRydWUsXG4gICAgICAgICAgICAgICAgc2Vzc2lvbklkOiB0cnVlLFxuICAgICAgICAgICAgICAgIHRlbXBCbG9ja2VkVW50aWw6IHRydWUsXG4gICAgICAgICAgICAgICAgcGVybWFuZW50bHlCbG9ja2VkOiB0cnVlXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIENoZWNrIGlmIHRlbXAgYmxvY2sgaGFzIGV4cGlyZWRcbiAgICAgICAgaWYgKHBhcnRpY2lwYXRpb24/LnRlbXBCbG9ja2VkVW50aWwgJiYgbmV3IERhdGUoKSA+IHBhcnRpY2lwYXRpb24udGVtcEJsb2NrZWRVbnRpbCkge1xuICAgICAgICAgICAgLy8gVGVtcCBibG9jayBleHBpcmVkIC0gdW5ibG9ja1xuICAgICAgICAgICAgYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLnVwZGF0ZSh7XG4gICAgICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkX2NvbnRlc3RJZDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgdXNlcklkOiBzZXNzaW9uLnVzZXIuaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIGlzQmxvY2tlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBCbG9ja2VkVW50aWw6IG51bGxcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgICAgIHBhcnRpY2lwYXRpb246IHtcbiAgICAgICAgICAgICAgICAgICAgLi4ucGFydGljaXBhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgaXNCbG9ja2VkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgdGVtcEJsb2NrZWRVbnRpbDogbnVsbFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgIHBhcnRpY2lwYXRpb246IHBhcnRpY2lwYXRpb24gfHwgbnVsbFxuICAgICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZ2V0IHBhcnRpY2lwYXRpb24gc3RhdHVzXCIgfTtcbiAgICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBDT05URVNUIE1BTkFHRVIgLSBQQVJUSUNJUEFOVCBNQU5BR0VNRU5UXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqIEdldCBhbGwgcGFydGljaXBhbnRzIGZvciBhIGNvbnRlc3Qgd2l0aCB2aW9sYXRpb24gZGV0YWlscyAoZm9yIG1hbmFnZXJzKVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q29udGVzdFBhcnRpY2lwYW50cyhjb250ZXN0SWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcblxuICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gc2Vzc2lvbi51c2VyIGFzIGFueTtcblxuICAgIC8vIENoZWNrIGlmIHVzZXIgaXMgY29udGVzdCBtYW5hZ2VyL2NyZWF0b3JcbiAgICBjb25zdCBjb250ZXN0ID0gYXdhaXQgcHJpc21hLmNvbnRlc3QuZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiBjb250ZXN0SWQgfSxcbiAgICAgICAgc2VsZWN0OiB7IGNyZWF0b3JJZDogdHJ1ZSB9XG4gICAgfSk7XG5cbiAgICBpZiAoIWNvbnRlc3QpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJDb250ZXN0IG5vdCBmb3VuZFwiIH07XG5cbiAgICBjb25zdCBpc0F1dGhvcml6ZWQgPVxuICAgICAgICBjdXJyZW50VXNlci5yb2xlID09PSBcIkFETUlOXCIgfHxcbiAgICAgICAgY3VycmVudFVzZXIucm9sZSA9PT0gXCJDT05URVNUX01BTkFHRVJcIiB8fFxuICAgICAgICBjdXJyZW50VXNlci5yb2xlID09PSBcIlRFQUNIRVJcIiB8fFxuICAgICAgICBjb250ZXN0LmNyZWF0b3JJZCA9PT0gY3VycmVudFVzZXIuaWQ7XG5cbiAgICBpZiAoIWlzQXV0aG9yaXplZCkge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBwYXJ0aWNpcGFudHMgPSBhd2FpdCBwcmlzbWEuY29udGVzdFBhcnRpY2lwYXRpb24uZmluZE1hbnkoe1xuICAgICAgICAgICAgd2hlcmU6IHsgY29udGVzdElkIH0sXG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVtYWlsOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgaW1hZ2U6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgdmlvbGF0aW9uczoge1xuICAgICAgICAgICAgICAgICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogXCJkZXNjXCIgfSxcbiAgICAgICAgICAgICAgICAgICAgdGFrZTogMTBcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb3JkZXJCeTogW1xuICAgICAgICAgICAgICAgIHsgcGVybWFuZW50bHlCbG9ja2VkOiBcImRlc2NcIiB9LFxuICAgICAgICAgICAgICAgIHsgaXNCbG9ja2VkOiBcImRlc2NcIiB9LFxuICAgICAgICAgICAgICAgIHsgdG90YWxWaW9sYXRpb25zOiBcImRlc2NcIiB9XG4gICAgICAgICAgICBdXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHBhcnRpY2lwYW50cyB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gZ2V0IHBhcnRpY2lwYW50czpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGdldCBwYXJ0aWNpcGFudHNcIiB9O1xuICAgIH1cbn1cblxuLyoqXG4gKiBVbmJsb2NrIGEgcGFydGljaXBhbnQgKG1hbmFnZXIgb25seSlcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVuYmxvY2tQYXJ0aWNpcGFudChjb250ZXN0SWQ6IHN0cmluZywgdXNlcklkOiBzdHJpbmcpIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIGlmICghc2Vzc2lvbj8udXNlcikgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG5cbiAgICBjb25zdCBjdXJyZW50VXNlciA9IHNlc3Npb24udXNlciBhcyBhbnk7XG5cbiAgICAvLyBDaGVjayBhdXRob3JpemF0aW9uXG4gICAgY29uc3QgY29udGVzdCA9IGF3YWl0IHByaXNtYS5jb250ZXN0LmZpbmRVbmlxdWUoe1xuICAgICAgICB3aGVyZTogeyBpZDogY29udGVzdElkIH0sXG4gICAgICAgIHNlbGVjdDogeyBjcmVhdG9ySWQ6IHRydWUgfVxuICAgIH0pO1xuXG4gICAgaWYgKCFjb250ZXN0KSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiQ29udGVzdCBub3QgZm91bmRcIiB9O1xuXG4gICAgY29uc3QgaXNBdXRob3JpemVkID1cbiAgICAgICAgY3VycmVudFVzZXIucm9sZSA9PT0gXCJBRE1JTlwiIHx8XG4gICAgICAgIGN1cnJlbnRVc2VyLnJvbGUgPT09IFwiQ09OVEVTVF9NQU5BR0VSXCIgfHxcbiAgICAgICAgY3VycmVudFVzZXIucm9sZSA9PT0gXCJURUFDSEVSXCIgfHxcbiAgICAgICAgY29udGVzdC5jcmVhdG9ySWQgPT09IGN1cnJlbnRVc2VyLmlkO1xuXG4gICAgaWYgKCFpc0F1dGhvcml6ZWQpIHtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLnVwZGF0ZSh7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgIHVzZXJJZF9jb250ZXN0SWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgIGlzQmxvY2tlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgdGVtcEJsb2NrZWRVbnRpbDogbnVsbCxcbiAgICAgICAgICAgICAgICBwZXJtYW5lbnRseUJsb2NrZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHRvdGFsVmlvbGF0aW9uczogMCxcbiAgICAgICAgICAgICAgICB0YWJTd2l0Y2hDb3VudDogMCxcbiAgICAgICAgICAgICAgICBmdWxsc2NyZWVuRXhpdENvdW50OiAwLFxuICAgICAgICAgICAgICAgIGNvcHlQYXN0ZUNvdW50OiAwLFxuICAgICAgICAgICAgICAgIGRldlRvb2xzQ291bnQ6IDAsXG4gICAgICAgICAgICAgICAga2V5Ym9hcmRDb3VudDogMCxcbiAgICAgICAgICAgICAgICBuYXZpZ2F0aW9uQ291bnQ6IDAsXG4gICAgICAgICAgICAgICAgaXNGbGFnZ2VkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICB1bmJsb2NrZWRCeTogY3VycmVudFVzZXIuaWQsXG4gICAgICAgICAgICAgICAgdW5ibG9ja2VkQXQ6IG5ldyBEYXRlKClcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV2YWxpZGF0ZVBhdGgoYC9kYXNoYm9hcmQvY29udGVzdHMvJHtjb250ZXN0SWR9L3BhcnRpY2lwYW50c2ApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byB1bmJsb2NrIHBhcnRpY2lwYW50OlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gdW5ibG9jayBwYXJ0aWNpcGFudFwiIH07XG4gICAgfVxufVxuXG4vKipcbiAqIEdldCBkZXRhaWxlZCB2aW9sYXRpb25zIGZvciBhIHBhcnRpY2lwYW50XG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRQYXJ0aWNpcGFudFZpb2xhdGlvbnMoY29udGVzdElkOiBzdHJpbmcsIHVzZXJJZDogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICBpZiAoIXNlc3Npb24/LnVzZXIpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuXG4gICAgY29uc3QgY3VycmVudFVzZXIgPSBzZXNzaW9uLnVzZXIgYXMgYW55O1xuXG4gICAgLy8gQ2hlY2sgYXV0aG9yaXphdGlvblxuICAgIGNvbnN0IGNvbnRlc3QgPSBhd2FpdCBwcmlzbWEuY29udGVzdC5maW5kVW5pcXVlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6IGNvbnRlc3RJZCB9LFxuICAgICAgICBzZWxlY3Q6IHsgY3JlYXRvcklkOiB0cnVlIH1cbiAgICB9KTtcblxuICAgIGlmICghY29udGVzdCkgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkNvbnRlc3Qgbm90IGZvdW5kXCIgfTtcblxuICAgIGNvbnN0IGlzQXV0aG9yaXplZCA9XG4gICAgICAgIGN1cnJlbnRVc2VyLnJvbGUgPT09IFwiQURNSU5cIiB8fFxuICAgICAgICBjdXJyZW50VXNlci5yb2xlID09PSBcIkNPTlRFU1RfTUFOQUdFUlwiIHx8XG4gICAgICAgIGN1cnJlbnRVc2VyLnJvbGUgPT09IFwiVEVBQ0hFUlwiIHx8XG4gICAgICAgIGNvbnRlc3QuY3JlYXRvcklkID09PSBjdXJyZW50VXNlci5pZDtcblxuICAgIGlmICghaXNBdXRob3JpemVkKSB7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHBhcnRpY2lwYXRpb24gPSBhd2FpdCBwcmlzbWEuY29udGVzdFBhcnRpY2lwYXRpb24uZmluZFVuaXF1ZSh7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgIHVzZXJJZF9jb250ZXN0SWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0OiB7IGlkOiB0cnVlLCBuYW1lOiB0cnVlLCBlbWFpbDogdHJ1ZSB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB2aW9sYXRpb25zOiB7XG4gICAgICAgICAgICAgICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiBcImRlc2NcIiB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBwYXJ0aWNpcGF0aW9uIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBnZXQgdmlvbGF0aW9uc1wiIH07XG4gICAgfVxufVxuXG4vKipcbiAqIENhbGN1bGF0ZSBjb250ZXN0IGxlYWRlcmJvYXJkXG4gKiAtIEZldGNoZXMgYWxsIHBhcnRpY2lwYXRpb25zXG4gKiAtIEZldGNoZXMgYWxsIHJlbGV2YW50IHN1Ym1pc3Npb25zXG4gKiAtIENhbGN1bGF0ZXMgc2NvcmVzXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRDb250ZXN0TGVhZGVyYm9hcmQoY29udGVzdElkOiBzdHJpbmcpIHtcbiAgICBcInVzZSBjYWNoZVwiXG4gICAgY2FjaGVUYWcoYGxlYWRlcmJvYXJkLSR7Y29udGVzdElkfWApXG4gICAgY2FjaGVMaWZlKFwibGVhZGVyYm9hcmRcIilcblxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHBhcnRpY2lwYXRpb25zID0gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLmZpbmRNYW55KHtcbiAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgY29udGVzdElkLFxuICAgICAgICAgICAgICAgIC8vIHN0YXJ0ZWRBdDogeyBub3Q6IG51bGwgfSAvLyBPbmx5IHN0YXJ0ZWQgcGFydGljaXBhbnRzIChGaXggaWYgZmllbGQgZXhpc3RzLCBvdGhlcndpc2UgcmVseSBvbiBjcmVhdGVkKVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgaW1hZ2U6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgY29udGVzdCA9IGF3YWl0IHByaXNtYS5jb250ZXN0LmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IGNvbnRlc3RJZCB9LFxuICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgIHByb2JsZW1zOiB7XG4gICAgICAgICAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2JsZW06IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaWZmaWN1bHR5OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbHVnOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29yZTogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgb3JkZXJCeTogeyBvcmRlcjogXCJhc2NcIiB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoIWNvbnRlc3QpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJDb250ZXN0IG5vdCBmb3VuZFwiIH07XG5cbiAgICAgICAgY29uc3QgbGVhZGVyYm9hcmQgPSBhd2FpdCBQcm9taXNlLmFsbChwYXJ0aWNpcGF0aW9ucy5tYXAoYXN5bmMgKHApID0+IHtcbiAgICAgICAgICAgIC8vIEdldCB2YWxpZCBzdWJtaXNzaW9ucyBmb3IgdGhpcyB1c2VyIGluIHRoaXMgY29udGVzdFxuICAgICAgICAgICAgY29uc3Qgc3VibWlzc2lvbnMgPSBhd2FpdCBwcmlzbWEuc3VibWlzc2lvbi5maW5kTWFueSh7XG4gICAgICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkOiBwLnVzZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgY29udGVzdElkOiBjb250ZXN0SWQsXG4gICAgICAgICAgICAgICAgICAgIGNyZWF0ZWRBdDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgZ3RlOiBjb250ZXN0LnN0YXJ0VGltZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGx0ZTogY29udGVzdC5lbmRUaW1lXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBwcm9ibGVtSWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGNyZWF0ZWRBdDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgbGFuZ3VhZ2U6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBDYWxjdWxhdGUgdG90YWwgc2NvcmVcbiAgICAgICAgICAgIC8vIExvZ2ljOiBCZXN0IHN1Ym1pc3Npb24gcGVyIHByb2JsZW0gY291bnRzXG4gICAgICAgICAgICBjb25zdCBwcm9ibGVtU2NvcmVzID0gbmV3IE1hcDxzdHJpbmcsIG51bWJlcj4oKTtcbiAgICAgICAgICAgIGNvbnN0IHByb2JsZW1Tb2x2ZVRpbWVzID0gbmV3IE1hcDxzdHJpbmcsIERhdGU+KCk7XG4gICAgICAgICAgICBjb25zdCBwcm9ibGVtU3VibWlzc2lvbkNvdW50cyA9IG5ldyBNYXA8c3RyaW5nLCBudW1iZXI+KCk7XG4gICAgICAgICAgICBjb25zdCBwcm9ibGVtQmVzdFN1Ym1pc3Npb25zID0gbmV3IE1hcDxzdHJpbmcsIGFueT4oKTtcblxuICAgICAgICAgICAgc3VibWlzc2lvbnMuZm9yRWFjaChzdWIgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRDb3VudCA9IHByb2JsZW1TdWJtaXNzaW9uQ291bnRzLmdldChzdWIucHJvYmxlbUlkKSB8fCAwO1xuICAgICAgICAgICAgICAgIHByb2JsZW1TdWJtaXNzaW9uQ291bnRzLnNldChzdWIucHJvYmxlbUlkLCBjdXJyZW50Q291bnQgKyAxKTtcblxuICAgICAgICAgICAgICAgIGlmIChzdWIuc3RhdHVzID09PSBcIkFDQ0VQVEVEXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudEJlc3QgPSBwcm9ibGVtU2NvcmVzLmdldChzdWIucHJvYmxlbUlkKSB8fCAwO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBwcm9ibGVtRGVmID0gY29udGVzdC5wcm9ibGVtcy5maW5kKGNwID0+IGNwLnByb2JsZW1JZCA9PT0gc3ViLnByb2JsZW1JZCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG1heFNjb3JlID0gcHJvYmxlbURlZj8ucHJvYmxlbS5zY29yZSB8fCAwO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChtYXhTY29yZSA+IGN1cnJlbnRCZXN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgcHJvYmxlbVNjb3Jlcy5zZXQoc3ViLnByb2JsZW1JZCwgbWF4U2NvcmUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRCZXN0VGltZSA9IHByb2JsZW1Tb2x2ZVRpbWVzLmdldChzdWIucHJvYmxlbUlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWN1cnJlbnRCZXN0VGltZSB8fCBzdWIuY3JlYXRlZEF0IDwgY3VycmVudEJlc3RUaW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2JsZW1Tb2x2ZVRpbWVzLnNldChzdWIucHJvYmxlbUlkLCBzdWIuY3JlYXRlZEF0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvYmxlbUJlc3RTdWJtaXNzaW9ucy5zZXQoc3ViLnByb2JsZW1JZCwgc3ViKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgbGV0IHRvdGFsU2NvcmUgPSAwO1xuICAgICAgICAgICAgbGV0IHRvdGFsVGltZU1zID0gMDtcblxuICAgICAgICAgICAgcHJvYmxlbVNjb3Jlcy5mb3JFYWNoKChzY29yZSwgcHJvYmxlbUlkKSA9PiB7XG4gICAgICAgICAgICAgICAgdG90YWxTY29yZSArPSBzY29yZTtcbiAgICAgICAgICAgICAgICBjb25zdCBzb2x2ZW50VGltZSA9IHByb2JsZW1Tb2x2ZVRpbWVzLmdldChwcm9ibGVtSWQpO1xuICAgICAgICAgICAgICAgIGlmIChzb2x2ZW50VGltZSkge1xuICAgICAgICAgICAgICAgICAgICB0b3RhbFRpbWVNcyArPSAoc29sdmVudFRpbWUuZ2V0VGltZSgpIC0gY29udGVzdC5zdGFydFRpbWUuZ2V0VGltZSgpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gTWFwIHN0YXRzIGZvciBlYWNoIHByb2JsZW0gaW4gdGhlIGNvbnRlc3RcbiAgICAgICAgICAgIGNvbnN0IHByb2JsZW1TdGF0cyA9IGNvbnRlc3QucHJvYmxlbXMubWFwKGNwID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBiZXN0U3ViID0gcHJvYmxlbUJlc3RTdWJtaXNzaW9ucy5nZXQoY3AucHJvYmxlbUlkKTtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBwcm9ibGVtSWQ6IGNwLnByb2JsZW1JZCxcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IGNwLnByb2JsZW0udGl0bGUsXG4gICAgICAgICAgICAgICAgICAgIHNsdWc6IGNwLnByb2JsZW0uc2x1ZyxcbiAgICAgICAgICAgICAgICAgICAgc2NvcmU6IHByb2JsZW1TY29yZXMuZ2V0KGNwLnByb2JsZW1JZCkgfHwgMCxcbiAgICAgICAgICAgICAgICAgICAgbWF4U2NvcmU6IGNwLnByb2JsZW0uc2NvcmUsXG4gICAgICAgICAgICAgICAgICAgIHN1Ym1pc3Npb25zOiBwcm9ibGVtU3VibWlzc2lvbkNvdW50cy5nZXQoY3AucHJvYmxlbUlkKSB8fCAwLFxuICAgICAgICAgICAgICAgICAgICBzb2x2ZWQ6IHByb2JsZW1TY29yZXMuaGFzKGNwLnByb2JsZW1JZCksXG4gICAgICAgICAgICAgICAgICAgIHNvbHZlZEF0OiBwcm9ibGVtU29sdmVUaW1lcy5nZXQoY3AucHJvYmxlbUlkKSxcbiAgICAgICAgICAgICAgICAgICAgbGFuZ3VhZ2U6IGJlc3RTdWI/Lmxhbmd1YWdlPy5uYW1lIHx8IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIGxhbmd1YWdlSWQ6IGJlc3RTdWI/Lmxhbmd1YWdlPy5pZCB8fCBudWxsXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnAudXNlcixcbiAgICAgICAgICAgICAgICBzY29yZTogdG90YWxTY29yZSxcbiAgICAgICAgICAgICAgICB0aW1lVGFrZW46IHRvdGFsVGltZU1zLFxuICAgICAgICAgICAgICAgIHByb2JsZW1zU29sdmVkOiBwcm9ibGVtU2NvcmVzLnNpemUsXG4gICAgICAgICAgICAgICAgcHJvYmxlbVN0YXRzXG4gICAgICAgICAgICB9O1xuICAgICAgICB9KSk7XG5cbiAgICAgICAgLy8gU29ydDogSGlnaCBzY29yZSBmaXJzdCwgdGhlbiBsb3cgdGltZSB0YWtlblxuICAgICAgICBsZWFkZXJib2FyZC5zb3J0KChhLCBiKSA9PiB7XG4gICAgICAgICAgICBpZiAoYi5zY29yZSAhPT0gYS5zY29yZSkgcmV0dXJuIGIuc2NvcmUgLSBhLnNjb3JlO1xuICAgICAgICAgICAgcmV0dXJuIGEudGltZVRha2VuIC0gYi50aW1lVGFrZW47XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgc3R1ZGVudHM6IGxlYWRlcmJvYXJkLFxuICAgICAgICAgICAgaXNGaW5hbGl6ZWQ6IGNvbnRlc3QuaXNGaW5hbGl6ZWQsXG4gICAgICAgICAgICBwcm9ibGVtczogY29udGVzdC5wcm9ibGVtcy5tYXAoY3AgPT4gKHtcbiAgICAgICAgICAgICAgICBpZDogY3AucHJvYmxlbUlkLFxuICAgICAgICAgICAgICAgIHRpdGxlOiBjcC5wcm9ibGVtLnRpdGxlLFxuICAgICAgICAgICAgICAgIHNsdWc6IGNwLnByb2JsZW0uc2x1ZyxcbiAgICAgICAgICAgICAgICBtYXhTY29yZTogY3AucHJvYmxlbS5zY29yZVxuICAgICAgICAgICAgfSkpXG4gICAgICAgIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiTGVhZGVyYm9hcmQgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBnZW5lcmF0ZSBsZWFkZXJib2FyZFwiIH07XG4gICAgfVxufVxuXG4vKipcbiAqIEdldCBjdXJyZW50IHVzZXIncyByYW5raW5nIGluIGEgY29udGVzdFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q29udGVzdFJhbmtpbmcoY29udGVzdElkOiBzdHJpbmcpIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIGlmICghc2Vzc2lvbj8udXNlcikgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBnZXRDb250ZXN0TGVhZGVyYm9hcmQoY29udGVzdElkKTtcblxuICAgICAgICBpZiAoIXJlc3VsdC5zdWNjZXNzIHx8ICFyZXN1bHQuc3R1ZGVudHMpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZ2V0IHJhbmtpbmdcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgcmFuayA9IHJlc3VsdC5zdHVkZW50cy5maW5kSW5kZXgoKHM6IGFueSkgPT4gcy5pZCA9PT0gc2Vzc2lvbi51c2VyLmlkKSArIDE7XG5cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgcmFuazogcmFuayA+IDAgPyByYW5rIDogbnVsbCB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGdldCByYW5raW5nXCIgfTtcbiAgICB9XG59XG4iXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6ImtTQTI4QnNCIn0=
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/components/contest/ContestProtection.tsx [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "default",
    ()=>ContestProtection
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/jsx-dev-runtime.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/index.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$triangle$2d$alert$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__AlertTriangle$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/triangle-alert.js [app-client] (ecmascript) <export default as AlertTriangle>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$shield$2d$x$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__ShieldX$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/shield-x.js [app-client] (ecmascript) <export default as ShieldX>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$monitor$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Monitor$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/monitor.js [app-client] (ecmascript) <export default as Monitor>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$lock$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Lock$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/lock.js [app-client] (ecmascript) <export default as Lock>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$ban$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Ban$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/ban.js [app-client] (ecmascript) <export default as Ban>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$clock$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Clock$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/clock.js [app-client] (ecmascript) <export default as Clock>");
var __TURBOPACK__imported__module__$5b$project$5d2f$actions$2f$data$3a$93ad3e__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__ = __turbopack_context__.i("[project]/actions/data:93ad3e [app-client] (ecmascript) <text/javascript>");
var __TURBOPACK__imported__module__$5b$project$5d2f$actions$2f$data$3a$11eb98__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__ = __turbopack_context__.i("[project]/actions/data:11eb98 [app-client] (ecmascript) <text/javascript>");
;
var _s = __turbopack_context__.k.signature();
"use client";
;
;
;
const MAX_WARNINGS = 6;
const FLAG_THRESHOLD = 3;
// Blocked keyboard shortcuts
const BLOCKED_SHORTCUTS = [
    {
        key: "c",
        ctrl: true,
        shift: false
    },
    {
        key: "v",
        ctrl: true,
        shift: false
    },
    {
        key: "x",
        ctrl: true,
        shift: false
    },
    {
        key: "u",
        ctrl: true,
        shift: false
    },
    {
        key: "s",
        ctrl: true,
        shift: false
    },
    {
        key: "p",
        ctrl: true,
        shift: false
    },
    {
        key: "i",
        ctrl: true,
        shift: true
    },
    {
        key: "j",
        ctrl: true,
        shift: true
    },
    {
        key: "c",
        ctrl: true,
        shift: true
    },
    {
        key: "F12",
        ctrl: false,
        shift: false
    }
];
function ContestProtection({ contestId, sessionId, onAutoSubmit, onBlocked, paused = false }) {
    _s();
    const [violations, setViolations] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])({
        total: 0,
        isFlagged: false,
        isBlocked: false,
        tempBlockedUntil: null,
        permanentlyBlocked: false
    });
    const [showWarningPopup, setShowWarningPopup] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(false);
    const [needsFullscreen, setNeedsFullscreen] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(false);
    const [currentViolationType, setCurrentViolationType] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])("");
    const [isEditorLocked, setIsEditorLocked] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(false);
    const [tempBlockTimeLeft, setTempBlockTimeLeft] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(0);
    const isMounted = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(false);
    const broadcastChannel = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(null);
    const lastViolationTime = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(0);
    const isProcessingViolation = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(false);
    const isRefreshing = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(false);
    const isNavigating = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(false); // Track internal navigation to problem pages
    // Ref to track fullscreen needs for event listeners (avoids stale closures)
    const needsFullscreenRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(false);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "ContestProtection.useEffect": ()=>{
            needsFullscreenRef.current = needsFullscreen;
        }
    }["ContestProtection.useEffect"], [
        needsFullscreen
    ]);
    // Global debounce - only ONE violation allowed every 2 seconds
    const canLogViolation = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "ContestProtection.useCallback[canLogViolation]": ()=>{
            const now = Date.now();
            if (paused) return false;
            // If already processing or locked - DO NOT log more violations
            if (isProcessingViolation.current) return false;
            if (isEditorLocked) return false;
            // NOTE: We allow logging even if showWarningPopup is true (e.g. for tab switching while popup is open)
            // Violations are logged even during temp block to allow escalation to permanent block
            // 2 second global cooldown to prevent double-logging same event
            if (now - lastViolationTime.current < 2000) return false;
            return true;
        }
    }["ContestProtection.useCallback[canLogViolation]"], [
        isEditorLocked,
        paused
    ]);
    // Log violation to server and update state
    const handleViolation = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useCallback"])({
        "ContestProtection.useCallback[handleViolation]": async (type, message)=>{
            // Skip if navigating internally (prevents false positives when clicking problems)
            if (!isMounted.current || isRefreshing.current || isNavigating.current) return;
            // Always show popup for user awareness
            setCurrentViolationType(message);
            setShowWarningPopup(true);
            // Keyboard shortcuts and copy/paste ONLY show warning, don't count as violations
            const warningOnlyTypes = [
                "KEYBOARD_SHORTCUT",
                "COPY_PASTE"
            ];
            if (warningOnlyTypes.includes(type)) {
                // Just show warning, don't log to server or increment counter
                return;
            }
            // But only log to server if cooldown passed
            if (!canLogViolation()) {
                return;
            }
            // Lock and update timestamp immediately
            isProcessingViolation.current = true;
            lastViolationTime.current = Date.now();
            try {
                const result = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$actions$2f$data$3a$93ad3e__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__["logContestViolation"])(contestId, type, message);
                if (result.success) {
                    const newState = {
                        total: result.totalViolations || 0,
                        isFlagged: result.isFlagged || false,
                        isBlocked: result.isBlocked || false,
                        tempBlockedUntil: result.tempBlockedUntil || null,
                        permanentlyBlocked: result.permanentlyBlocked || false
                    };
                    setViolations(newState);
                    // Handle tiered escalation
                    if (result.permanentlyBlocked) {
                        setIsEditorLocked(true);
                        onBlocked?.();
                    } else if (result.tempBlockedUntil) {
                        setIsEditorLocked(true);
                        // Calculate time left
                        const timeLeft = new Date(result.tempBlockedUntil).getTime() - Date.now();
                        setTempBlockTimeLeft(Math.max(0, Math.floor(timeLeft / 1000)));
                    }
                }
            } catch (error) {
                console.error("Failed to log violation:", error);
            } finally{
                isProcessingViolation.current = false;
            }
        }
    }["ContestProtection.useCallback[handleViolation]"], [
        contestId,
        canLogViolation,
        onAutoSubmit,
        onBlocked
    ]);
    // Check for existing block status on mount (persists across refresh)
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "ContestProtection.useEffect": ()=>{
            if (!contestId) return;
            const checkBlockStatus = {
                "ContestProtection.useEffect.checkBlockStatus": async ()=>{
                    const result = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$actions$2f$data$3a$11eb98__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__["getParticipationStatus"])(contestId);
                    if (result.success && result.participation) {
                        const p = result.participation;
                        // ALWAYS sync the violation counts and flags
                        const newViolationState = {
                            total: p.totalViolations || 0,
                            isFlagged: p.isFlagged || false,
                            isBlocked: false,
                            tempBlockedUntil: null,
                            permanentlyBlocked: false
                        };
                        if (p.permanentlyBlocked) {
                            newViolationState.isBlocked = true;
                            newViolationState.permanentlyBlocked = true;
                            setIsEditorLocked(true);
                            onBlocked?.();
                        } else if (p.tempBlockedUntil) {
                            const blockEnd = new Date(p.tempBlockedUntil);
                            if (blockEnd > new Date()) {
                                newViolationState.isBlocked = true;
                                newViolationState.tempBlockedUntil = p.tempBlockedUntil;
                                setIsEditorLocked(true);
                                const timeLeft = blockEnd.getTime() - Date.now();
                                setTempBlockTimeLeft(Math.max(0, Math.floor(timeLeft / 1000)));
                            }
                        } else if (p.isBlocked) {
                            newViolationState.isBlocked = true;
                            setIsEditorLocked(true);
                        }
                        setViolations(newViolationState);
                    }
                }
            }["ContestProtection.useEffect.checkBlockStatus"];
            checkBlockStatus();
        }
    }["ContestProtection.useEffect"], [
        contestId,
        onBlocked
    ]);
    // Countdown timer for temp block
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "ContestProtection.useEffect": ()=>{
            if (tempBlockTimeLeft <= 0) return;
            const interval = setInterval({
                "ContestProtection.useEffect.interval": ()=>{
                    setTempBlockTimeLeft({
                        "ContestProtection.useEffect.interval": (prev)=>{
                            if (prev <= 1) {
                                // Timer expired - unblock
                                setIsEditorLocked(false);
                                setViolations({
                                    "ContestProtection.useEffect.interval": (v)=>({
                                            ...v,
                                            isBlocked: false,
                                            tempBlockedUntil: null
                                        })
                                }["ContestProtection.useEffect.interval"]);
                                return 0;
                            }
                            return prev - 1;
                        }
                    }["ContestProtection.useEffect.interval"]);
                }
            }["ContestProtection.useEffect.interval"], 1000);
            return ({
                "ContestProtection.useEffect": ()=>clearInterval(interval)
            })["ContestProtection.useEffect"];
        }
    }["ContestProtection.useEffect"], [
        tempBlockTimeLeft > 0
    ]); // Keep boolean dependency but ensure it works on reset
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "ContestProtection.useEffect": ()=>{
            if (!contestId || !sessionId) return;
            // Setup delay to prevent false positives
            const mountTimeout = setTimeout({
                "ContestProtection.useEffect.mountTimeout": ()=>{
                    isMounted.current = true;
                    // After refresh, check if we need to re-enter fullscreen
                    if (!document.fullscreenElement && !isRefreshing.current) {
                        setNeedsFullscreen(true);
                        needsFullscreenRef.current = true; // Immediate sync for event listeners
                    }
                }
            }["ContestProtection.useEffect.mountTimeout"], 3000);
            // =============================================
            // 1. MULTI-TAB DETECTION via BroadcastChannel
            // =============================================
            try {
                broadcastChannel.current = new BroadcastChannel(`contest-${contestId}`);
                // Announce presence
                broadcastChannel.current.postMessage({
                    type: "ping",
                    sessionId
                });
                // Listen for other tabs
                broadcastChannel.current.onmessage = ({
                    "ContestProtection.useEffect": (event)=>{
                        if (event.data.type === "ping" && event.data.sessionId !== sessionId) {
                            handleViolation("MULTI_TAB", "Contest opened in multiple tabs");
                            // Respond so the other tab knows
                            broadcastChannel.current?.postMessage({
                                type: "conflict",
                                sessionId
                            });
                        }
                        if (event.data.type === "conflict" && event.data.sessionId !== sessionId) {
                            handleViolation("MULTI_TAB", "Contest opened in multiple tabs");
                        }
                    }
                })["ContestProtection.useEffect"];
            } catch (e) {
                console.warn("BroadcastChannel not supported");
            }
            // =============================================
            // 2. FULLSCREEN ENFORCEMENT
            // =============================================
            const enterFullscreen = {
                "ContestProtection.useEffect.enterFullscreen": ()=>{
                    if (!document.fullscreenElement) {
                        document.documentElement.requestFullscreen().catch({
                            "ContestProtection.useEffect.enterFullscreen": ()=>{}
                        }["ContestProtection.useEffect.enterFullscreen"]);
                    }
                }
            }["ContestProtection.useEffect.enterFullscreen"];
            const handleFullscreenChange = {
                "ContestProtection.useEffect.handleFullscreenChange": ()=>{
                    if (!isMounted.current) return;
                    if (!document.fullscreenElement) {
                        handleViolation("FULLSCREEN_EXIT", "You exited fullscreen mode");
                    }
                }
            }["ContestProtection.useEffect.handleFullscreenChange"];
            document.addEventListener("fullscreenchange", handleFullscreenChange);
            // =============================================
            // 3. COPY/PASTE/CUT PREVENTION
            // =============================================
            const preventClipboard = {
                "ContestProtection.useEffect.preventClipboard": (e)=>{
                    if (!isMounted.current) return;
                    e.preventDefault();
                    handleViolation("COPY_PASTE", `${e.type.charAt(0).toUpperCase() + e.type.slice(1)} is not allowed`);
                    return false;
                }
            }["ContestProtection.useEffect.preventClipboard"];
            document.addEventListener("copy", preventClipboard);
            document.addEventListener("cut", preventClipboard);
            document.addEventListener("paste", preventClipboard);
            // =============================================
            // 4. KEYBOARD SHORTCUT BLOCKING
            // =============================================
            const handleKeyDown = {
                "ContestProtection.useEffect.handleKeyDown": (e)=>{
                    if (!isMounted.current) return;
                    // Check against blocked shortcuts
                    const isBlocked = BLOCKED_SHORTCUTS.some({
                        "ContestProtection.useEffect.handleKeyDown.isBlocked": (shortcut)=>{
                            const keyMatch = e.key.toLowerCase() === shortcut.key.toLowerCase();
                            const ctrlMatch = e.ctrlKey === shortcut.ctrl || e.metaKey === shortcut.ctrl;
                            const shiftMatch = e.shiftKey === shortcut.shift;
                            return keyMatch && ctrlMatch && shiftMatch;
                        }
                    }["ContestProtection.useEffect.handleKeyDown.isBlocked"]);
                    if (isBlocked) {
                        e.preventDefault();
                        e.stopPropagation();
                        handleViolation("KEYBOARD_SHORTCUT", `Blocked shortcut: ${e.ctrlKey ? "Ctrl+" : ""}${e.shiftKey ? "Shift+" : ""}${e.key}`);
                        return false;
                    }
                    // Detect Refresh to suppress false positives
                    const isRefresh = e.key === "F5" || e.key.toLowerCase() === "r" && (e.ctrlKey || e.metaKey);
                    if (isRefresh) {
                        isRefreshing.current = true;
                    }
                }
            }["ContestProtection.useEffect.handleKeyDown"];
            document.addEventListener("keydown", handleKeyDown, true);
            // =============================================
            // 5. TAB SWITCH / FOCUS DETECTION
            // =============================================
            const handleVisibilityChange = {
                "ContestProtection.useEffect.handleVisibilityChange": ()=>{
                    if (!isMounted.current) return;
                    if (document.hidden) {
                        handleViolation("TAB_SWITCH", "You switched away from the contest tab");
                    }
                }
            }["ContestProtection.useEffect.handleVisibilityChange"];
            const handleWindowBlur = {
                "ContestProtection.useEffect.handleWindowBlur": ()=>{
                    if (!isMounted.current) return;
                    handleViolation("TAB_SWITCH", "Window lost focus");
                }
            }["ContestProtection.useEffect.handleWindowBlur"];
            document.addEventListener("visibilitychange", handleVisibilityChange);
            window.addEventListener("blur", handleWindowBlur);
            // =============================================
            // 5b. INTERACTION-BASED COMPLIANCE (Optimized)
            // =============================================
            // =============================================
            // 5b. INTERACTION-BASED COMPLIANCE (Optimization: Throttled)
            // =============================================
            let lastCheck = 0;
            const checkCompliance = {
                "ContestProtection.useEffect.checkCompliance": ()=>{
                    const now = Date.now();
                    // Throttle: Max once per 2 seconds during active interaction
                    if (now - lastCheck < 2000) return;
                    lastCheck = now;
                    if (!isMounted.current) return;
                    // Skip if already processing/blocked OR if waiting for fullscreen (using Ref for live value) OR PAUSED
                    if (paused || isProcessingViolation.current || isEditorLocked || showWarningPopup || needsFullscreenRef.current) return;
                    // 1. Check Fullscreen
                    if (!document.fullscreenElement && !isRefreshing.current) {
                        handleViolation("FULLSCREEN_EXIT", "You must stay in fullscreen mode");
                        return;
                    }
                }
            }["ContestProtection.useEffect.checkCompliance"];
            // Event-driven checks are sufficient without polling overhead
            document.addEventListener("mousedown", checkCompliance);
            document.addEventListener("keydown", checkCompliance);
            document.addEventListener("touchstart", checkCompliance);
            // No polling heartbeat needed - visibilitychange and fullscreenchange handle the critical events instantly
            // =============================================
            // 6. DEVTOOLS DETECTION (Event-Driven)
            // =============================================
            let resizeTimeout;
            const checkDevTools = {
                "ContestProtection.useEffect.checkDevTools": ()=>{
                    if (!isMounted.current) return;
                    const threshold = 160;
                    const widthDiff = window.outerWidth - window.innerWidth;
                    const heightDiff = window.outerHeight - window.innerHeight;
                    if (widthDiff > threshold || heightDiff > threshold) {
                        handleViolation("DEVTOOLS_OPEN", "Developer tools detected");
                    }
                }
            }["ContestProtection.useEffect.checkDevTools"];
            const handleResize = {
                "ContestProtection.useEffect.handleResize": ()=>{
                    clearTimeout(resizeTimeout);
                    resizeTimeout = setTimeout(checkDevTools, 500); // Debounce resize check
                }
            }["ContestProtection.useEffect.handleResize"];
            window.addEventListener("resize", handleResize);
            // =============================================
            // 7. CONTEXT MENU DISABLE
            // =============================================
            const preventContextMenu = {
                "ContestProtection.useEffect.preventContextMenu": (e)=>{
                    e.preventDefault();
                    return false;
                }
            }["ContestProtection.useEffect.preventContextMenu"];
            document.addEventListener("contextmenu", preventContextMenu);
            // =============================================
            // 8. INTERNAL NAVIGATION TRACKING
            // =============================================
            // Track clicks on links to prevent false positives when navigating to problems
            const handleLinkClick = {
                "ContestProtection.useEffect.handleLinkClick": (e)=>{
                    const target = e.target;
                    const link = target.closest("a");
                    if (link) {
                        const href = link.getAttribute("href");
                        // If it's an internal link (same origin or relative path)
                        if (href && (href.startsWith("/") || href.startsWith(window.location.origin))) {
                            isNavigating.current = true;
                            // Reset after a short delay in case navigation is cancelled
                            setTimeout({
                                "ContestProtection.useEffect.handleLinkClick": ()=>{
                                    isNavigating.current = false;
                                }
                            }["ContestProtection.useEffect.handleLinkClick"], 2000);
                        }
                    }
                }
            }["ContestProtection.useEffect.handleLinkClick"];
            document.addEventListener("click", handleLinkClick, true);
            // =============================================
            // 8. BEFOREUNLOAD WARNING
            // =============================================
            const handleBeforeUnload = {
                "ContestProtection.useEffect.handleBeforeUnload": (e)=>{
                    isRefreshing.current = true; // Mark as refreshing/navigating
                // DISABLE LEAVE CONFIRMATION
                // e.preventDefault();
                // e.returnValue = "You are in contest mode. Are you sure you want to leave?";
                // return e.returnValue;
                }
            }["ContestProtection.useEffect.handleBeforeUnload"];
            window.addEventListener("beforeunload", handleBeforeUnload);
            // =============================================
            // 9. DRAG/DROP PREVENTION
            // =============================================
            const preventDragDrop = {
                "ContestProtection.useEffect.preventDragDrop": (e)=>{
                    e.preventDefault();
                    return false;
                }
            }["ContestProtection.useEffect.preventDragDrop"];
            document.addEventListener("dragover", preventDragDrop);
            document.addEventListener("drop", preventDragDrop);
            // Cleanup
            return ({
                "ContestProtection.useEffect": ()=>{
                    clearTimeout(mountTimeout);
                    clearTimeout(resizeTimeout);
                    broadcastChannel.current?.close();
                    document.removeEventListener("fullscreenchange", handleFullscreenChange);
                    document.removeEventListener("copy", preventClipboard);
                    document.removeEventListener("cut", preventClipboard);
                    document.removeEventListener("paste", preventClipboard);
                    document.removeEventListener("keydown", handleKeyDown, true);
                    document.removeEventListener("visibilitychange", handleVisibilityChange);
                    window.removeEventListener("blur", handleWindowBlur);
                    window.removeEventListener("resize", handleResize);
                    document.removeEventListener("mousedown", checkCompliance);
                    document.removeEventListener("keydown", checkCompliance);
                    document.removeEventListener("touchstart", checkCompliance);
                    document.removeEventListener("contextmenu", preventContextMenu);
                    document.removeEventListener("click", handleLinkClick, true);
                    window.removeEventListener("beforeunload", handleBeforeUnload);
                    document.removeEventListener("dragover", preventDragDrop);
                    document.removeEventListener("drop", preventDragDrop);
                }
            })["ContestProtection.useEffect"];
        }
    }["ContestProtection.useEffect"], [
        contestId,
        sessionId,
        handleViolation
    ]);
    const handleDismissWarning = ()=>{
        // Only allow dismissing if we successfully enter fullscreen
        const enterFullscreen = async ()=>{
            try {
                if (!document.fullscreenElement) {
                    await document.documentElement.requestFullscreen();
                }
                // Only if successful, close popup
                setShowWarningPopup(false);
            } catch (err) {
            // If user denies fullscreen or it fails, keep popup open
            // Maybe show a toast or shake animation in future
            }
        };
        enterFullscreen();
    };
    const handleReEnterFullscreen = ()=>{
        document.documentElement.requestFullscreen().then(()=>setNeedsFullscreen(false)).catch(()=>{
        // If fails, keeps the popup open
        });
    };
    const remainingWarnings = MAX_WARNINGS - violations.total;
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Fragment"], {
        children: [
            (isEditorLocked || showWarningPopup) && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "fixed inset-0 z-9999 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-in fade-in duration-200",
                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                    className: "bg-white dark:bg-[#141414] rounded-2xl shadow-2xl max-w-lg w-full overflow-hidden border border-orange-100 dark:border-orange-500/20 transform transition-all scale-100",
                    children: [
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: `h-2 w-full ${violations.permanentlyBlocked ? "bg-red-500" : "bg-orange-500"}`
                        }, void 0, false, {
                            fileName: "[project]/components/contest/ContestProtection.tsx",
                            lineNumber: 548,
                            columnNumber: 13
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "p-6 md:p-8",
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "flex flex-col md:flex-row gap-6 items-start md:items-center",
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: `w-16 h-16 rounded-2xl flex items-center justify-center shrink-0 shadow-sm ${violations.permanentlyBlocked ? "bg-red-50 dark:bg-red-500/10 text-red-500" : "bg-orange-50 dark:bg-orange-500/10 text-orange-500"}`,
                                            children: violations.permanentlyBlocked ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$ban$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Ban$3e$__["Ban"], {
                                                className: "w-8 h-8"
                                            }, void 0, false, {
                                                fileName: "[project]/components/contest/ContestProtection.tsx",
                                                lineNumber: 565,
                                                columnNumber: 21
                                            }, this) : tempBlockTimeLeft > 0 ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$clock$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Clock$3e$__["Clock"], {
                                                className: "w-8 h-8 animate-pulse"
                                            }, void 0, false, {
                                                fileName: "[project]/components/contest/ContestProtection.tsx",
                                                lineNumber: 567,
                                                columnNumber: 21
                                            }, this) : isEditorLocked ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$lock$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Lock$3e$__["Lock"], {
                                                className: "w-8 h-8"
                                            }, void 0, false, {
                                                fileName: "[project]/components/contest/ContestProtection.tsx",
                                                lineNumber: 569,
                                                columnNumber: 21
                                            }, this) : /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$triangle$2d$alert$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__AlertTriangle$3e$__["AlertTriangle"], {
                                                className: "w-8 h-8"
                                            }, void 0, false, {
                                                fileName: "[project]/components/contest/ContestProtection.tsx",
                                                lineNumber: 571,
                                                columnNumber: 21
                                            }, this)
                                        }, void 0, false, {
                                            fileName: "[project]/components/contest/ContestProtection.tsx",
                                            lineNumber: 557,
                                            columnNumber: 17
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "flex-1 space-y-1",
                                            children: [
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("h2", {
                                                    className: "text-xl font-bold text-gray-900 dark:text-white leading-tight",
                                                    children: violations.permanentlyBlocked ? "Contest Session Terminated" : tempBlockTimeLeft > 0 ? "Temporary Suspension" : "Violation Detected"
                                                }, void 0, false, {
                                                    fileName: "[project]/components/contest/ContestProtection.tsx",
                                                    lineNumber: 576,
                                                    columnNumber: 19
                                                }, this),
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                                    className: "text-gray-500 dark:text-gray-400 font-medium text-sm",
                                                    children: violations.permanentlyBlocked ? "Multiple violations detected. Your session has been permanently blocked." : tempBlockTimeLeft > 0 ? "Please wait for the timer to expire before continuing." : currentViolationType || "This action is prohibited during the contest."
                                                }, void 0, false, {
                                                    fileName: "[project]/components/contest/ContestProtection.tsx",
                                                    lineNumber: 583,
                                                    columnNumber: 19
                                                }, this)
                                            ]
                                        }, void 0, true, {
                                            fileName: "[project]/components/contest/ContestProtection.tsx",
                                            lineNumber: 575,
                                            columnNumber: 17
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/components/contest/ContestProtection.tsx",
                                    lineNumber: 555,
                                    columnNumber: 15
                                }, this),
                                tempBlockTimeLeft > 0 && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "mt-8 p-6 bg-orange-50 dark:bg-orange-500/10 rounded-xl border border-orange-100 dark:border-orange-500/20 flex flex-col items-center justify-center",
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                            className: "text-xs font-bold text-orange-400 uppercase tracking-widest mb-2",
                                            children: "Access Resumes In"
                                        }, void 0, false, {
                                            fileName: "[project]/components/contest/ContestProtection.tsx",
                                            lineNumber: 597,
                                            columnNumber: 19
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "text-5xl font-black text-orange-500 font-mono tracking-tighter tabular-nums",
                                            children: [
                                                Math.floor(tempBlockTimeLeft / 60),
                                                ":",
                                                String(tempBlockTimeLeft % 60).padStart(2, "0")
                                            ]
                                        }, void 0, true, {
                                            fileName: "[project]/components/contest/ContestProtection.tsx",
                                            lineNumber: 600,
                                            columnNumber: 19
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/components/contest/ContestProtection.tsx",
                                    lineNumber: 596,
                                    columnNumber: 17
                                }, this),
                                !violations.permanentlyBlocked && tempBlockTimeLeft <= 0 && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "mt-8 space-y-3",
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "flex justify-between items-end",
                                            children: [
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                    className: "text-xs font-semibold text-gray-400 uppercase tracking-wider",
                                                    children: "Warning Level"
                                                }, void 0, false, {
                                                    fileName: "[project]/components/contest/ContestProtection.tsx",
                                                    lineNumber: 611,
                                                    columnNumber: 21
                                                }, this),
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                    className: "text-sm font-bold text-gray-900 dark:text-white",
                                                    children: [
                                                        violations.total,
                                                        " ",
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                            className: "text-gray-400 font-normal",
                                                            children: [
                                                                "/ ",
                                                                MAX_WARNINGS
                                                            ]
                                                        }, void 0, true, {
                                                            fileName: "[project]/components/contest/ContestProtection.tsx",
                                                            lineNumber: 616,
                                                            columnNumber: 23
                                                        }, this)
                                                    ]
                                                }, void 0, true, {
                                                    fileName: "[project]/components/contest/ContestProtection.tsx",
                                                    lineNumber: 614,
                                                    columnNumber: 21
                                                }, this)
                                            ]
                                        }, void 0, true, {
                                            fileName: "[project]/components/contest/ContestProtection.tsx",
                                            lineNumber: 610,
                                            columnNumber: 19
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "h-3 bg-gray-100 dark:bg-[#1a1a1a] rounded-full overflow-hidden",
                                            children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                className: `h-full transition-all duration-500 ease-out ${violations.total >= 4 ? "bg-red-500" : "bg-orange-500"}`,
                                                style: {
                                                    width: `${Math.min(violations.total / MAX_WARNINGS * 100, 100)}%`
                                                }
                                            }, void 0, false, {
                                                fileName: "[project]/components/contest/ContestProtection.tsx",
                                                lineNumber: 622,
                                                columnNumber: 21
                                            }, this)
                                        }, void 0, false, {
                                            fileName: "[project]/components/contest/ContestProtection.tsx",
                                            lineNumber: 621,
                                            columnNumber: 19
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "flex items-center justify-between text-xs",
                                            children: [
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                    className: "text-gray-400",
                                                    children: "Low Risk"
                                                }, void 0, false, {
                                                    fileName: "[project]/components/contest/ContestProtection.tsx",
                                                    lineNumber: 635,
                                                    columnNumber: 21
                                                }, this),
                                                violations.total >= 4 ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                    className: "text-red-500 font-medium",
                                                    children: "Critical Risk"
                                                }, void 0, false, {
                                                    fileName: "[project]/components/contest/ContestProtection.tsx",
                                                    lineNumber: 637,
                                                    columnNumber: 23
                                                }, this) : /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                    className: "text-orange-500 font-medium",
                                                    children: "Caution"
                                                }, void 0, false, {
                                                    fileName: "[project]/components/contest/ContestProtection.tsx",
                                                    lineNumber: 641,
                                                    columnNumber: 23
                                                }, this)
                                            ]
                                        }, void 0, true, {
                                            fileName: "[project]/components/contest/ContestProtection.tsx",
                                            lineNumber: 634,
                                            columnNumber: 19
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/components/contest/ContestProtection.tsx",
                                    lineNumber: 609,
                                    columnNumber: 17
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "mt-8",
                                    children: !violations.permanentlyBlocked && tempBlockTimeLeft <= 0 ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                        onClick: handleDismissWarning,
                                        className: "w-full py-4 bg-gray-900 dark:bg-white text-white dark:text-black rounded-xl font-bold hover:bg-gray-800 dark:hover:bg-gray-200 transition-all transform active:scale-[0.98] shadow-lg shadow-gray-200 dark:shadow-none",
                                        children: "Acknowledge & Continue"
                                    }, void 0, false, {
                                        fileName: "[project]/components/contest/ContestProtection.tsx",
                                        lineNumber: 652,
                                        columnNumber: 19
                                    }, this) : tempBlockTimeLeft > 0 ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                        disabled: true,
                                        className: "w-full py-4 bg-gray-100 dark:bg-[#1a1a1a] text-gray-400 dark:text-gray-600 rounded-xl font-bold cursor-not-allowed",
                                        children: "Suspended"
                                    }, void 0, false, {
                                        fileName: "[project]/components/contest/ContestProtection.tsx",
                                        lineNumber: 659,
                                        columnNumber: 19
                                    }, this) : /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                        className: "w-full py-4 bg-red-50 dark:bg-red-500/10 text-red-600 dark:text-red-500 rounded-xl font-bold border border-red-100 dark:border-red-500/20 cursor-not-allowed",
                                        children: "Contact Administrator"
                                    }, void 0, false, {
                                        fileName: "[project]/components/contest/ContestProtection.tsx",
                                        lineNumber: 666,
                                        columnNumber: 19
                                    }, this)
                                }, void 0, false, {
                                    fileName: "[project]/components/contest/ContestProtection.tsx",
                                    lineNumber: 650,
                                    columnNumber: 15
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/components/contest/ContestProtection.tsx",
                            lineNumber: 554,
                            columnNumber: 13
                        }, this)
                    ]
                }, void 0, true, {
                    fileName: "[project]/components/contest/ContestProtection.tsx",
                    lineNumber: 546,
                    columnNumber: 11
                }, this)
            }, void 0, false, {
                fileName: "[project]/components/contest/ContestProtection.tsx",
                lineNumber: 545,
                columnNumber: 9
            }, this),
            needsFullscreen && !isEditorLocked && !showWarningPopup && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "fixed inset-0 z-10000 flex items-center justify-center bg-black/60 backdrop-blur-md",
                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                    className: "bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 overflow-hidden border-2 border-orange-500 animate-in fade-in zoom-in duration-300",
                    children: [
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "bg-orange-600 px-6 py-4 flex items-center gap-3",
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$monitor$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Monitor$3e$__["Monitor"], {
                                    className: "w-6 h-6 text-white"
                                }, void 0, false, {
                                    fileName: "[project]/components/contest/ContestProtection.tsx",
                                    lineNumber: 681,
                                    columnNumber: 15
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("h2", {
                                    className: "text-lg font-bold text-white uppercase tracking-wider",
                                    children: "Fullscreen Required"
                                }, void 0, false, {
                                    fileName: "[project]/components/contest/ContestProtection.tsx",
                                    lineNumber: 682,
                                    columnNumber: 15
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/components/contest/ContestProtection.tsx",
                            lineNumber: 680,
                            columnNumber: 13
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "p-6 text-center",
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "w-20 h-20 bg-orange-50 dark:bg-orange-500/10 rounded-full flex items-center justify-center mx-auto mb-6",
                                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$shield$2d$x$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__ShieldX$3e$__["ShieldX"], {
                                        className: "w-10 h-10 text-orange-500"
                                    }, void 0, false, {
                                        fileName: "[project]/components/contest/ContestProtection.tsx",
                                        lineNumber: 689,
                                        columnNumber: 17
                                    }, this)
                                }, void 0, false, {
                                    fileName: "[project]/components/contest/ContestProtection.tsx",
                                    lineNumber: 688,
                                    columnNumber: 15
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("h3", {
                                    className: "text-xl font-bold text-gray-900 mb-2",
                                    children: "Re-activate Proctoring"
                                }, void 0, false, {
                                    fileName: "[project]/components/contest/ContestProtection.tsx",
                                    lineNumber: 691,
                                    columnNumber: 15
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                    className: "text-gray-600 mb-8 text-sm",
                                    children: "To continue your contest session, you must re-enter fullscreen mode. This is required for proctoring accuracy."
                                }, void 0, false, {
                                    fileName: "[project]/components/contest/ContestProtection.tsx",
                                    lineNumber: 694,
                                    columnNumber: 15
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                    onClick: handleReEnterFullscreen,
                                    className: "w-full py-4 bg-orange-600 text-white rounded-xl font-black uppercase tracking-widest hover:bg-orange-700 transition-all shadow-lg shadow-orange-200 flex items-center justify-center gap-3 group",
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$monitor$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Monitor$3e$__["Monitor"], {
                                            className: "w-5 h-5 group-hover:scale-110 transition-transform"
                                        }, void 0, false, {
                                            fileName: "[project]/components/contest/ContestProtection.tsx",
                                            lineNumber: 703,
                                            columnNumber: 17
                                        }, this),
                                        "Go Full Screen"
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/components/contest/ContestProtection.tsx",
                                    lineNumber: 699,
                                    columnNumber: 15
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                    className: "text-[10px] text-gray-400 mt-4 font-medium uppercase tracking-tighter",
                                    children: "Do not attempt to stay in windowed mode"
                                }, void 0, false, {
                                    fileName: "[project]/components/contest/ContestProtection.tsx",
                                    lineNumber: 707,
                                    columnNumber: 15
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/components/contest/ContestProtection.tsx",
                            lineNumber: 687,
                            columnNumber: 13
                        }, this)
                    ]
                }, void 0, true, {
                    fileName: "[project]/components/contest/ContestProtection.tsx",
                    lineNumber: 679,
                    columnNumber: 11
                }, this)
            }, void 0, false, {
                fileName: "[project]/components/contest/ContestProtection.tsx",
                lineNumber: 678,
                columnNumber: 9
            }, this),
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "fixed top-4 right-4 z-100 flex items-center gap-2 px-3 py-2 bg-white dark:bg-[#141414] border border-gray-200 dark:border-[#262626] rounded-lg shadow-sm",
                children: [
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "w-2 h-2 bg-green-500 rounded-full animate-pulse"
                    }, void 0, false, {
                        fileName: "[project]/components/contest/ContestProtection.tsx",
                        lineNumber: 717,
                        columnNumber: 9
                    }, this),
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                        className: "text-sm text-gray-700 dark:text-gray-300 font-medium",
                        children: "Proctored"
                    }, void 0, false, {
                        fileName: "[project]/components/contest/ContestProtection.tsx",
                        lineNumber: 718,
                        columnNumber: 9
                    }, this),
                    violations.total > 0 && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                        className: "px-2 py-0.5 bg-orange-100 dark:bg-orange-500/10 text-orange-700 dark:text-orange-400 rounded text-xs font-semibold",
                        children: violations.total
                    }, void 0, false, {
                        fileName: "[project]/components/contest/ContestProtection.tsx",
                        lineNumber: 722,
                        columnNumber: 11
                    }, this)
                ]
            }, void 0, true, {
                fileName: "[project]/components/contest/ContestProtection.tsx",
                lineNumber: 716,
                columnNumber: 7
            }, this)
        ]
    }, void 0, true);
}
_s(ContestProtection, "TVtM+rsBi4sVC+dvWeq5XYlXRGE=");
_c = ContestProtection;
var _c;
__turbopack_context__.k.register(_c, "ContestProtection");
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/components/contest/ContestNavigationGuard.tsx [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "default",
    ()=>ContestNavigationGuard
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/index.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$navigation$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/navigation.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$actions$2f$data$3a$93ad3e__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__ = __turbopack_context__.i("[project]/actions/data:93ad3e [app-client] (ecmascript) <text/javascript>");
var _s = __turbopack_context__.k.signature();
"use client";
;
;
;
function ContestNavigationGuard({ contestId, allowedPaths }) {
    _s();
    const router = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$navigation$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRouter"])();
    const pathname = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$navigation$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["usePathname"])();
    const initialPath = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(pathname);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "ContestNavigationGuard.useEffect": ()=>{
            if (!contestId) return;
            // =============================================
            // 1. BLOCK BROWSER BACK/FORWARD
            // =============================================
            // Push current state to prevent back navigation
            const pushState = {
                "ContestNavigationGuard.useEffect.pushState": ()=>{
                    window.history.pushState(null, "", window.location.href);
                }
            }["ContestNavigationGuard.useEffect.pushState"];
            pushState();
            const handlePopState = {
                "ContestNavigationGuard.useEffect.handlePopState": (e)=>{
                    e.preventDefault();
                    pushState();
                    // Log navigation attempt
                    (0, __TURBOPACK__imported__module__$5b$project$5d2f$actions$2f$data$3a$93ad3e__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__["logContestViolation"])(contestId, "NAVIGATION_ATTEMPT", "Attempted to use browser back/forward");
                }
            }["ContestNavigationGuard.useEffect.handlePopState"];
            window.addEventListener("popstate", handlePopState);
            // =============================================
            // 2. INTERCEPT LINK CLICKS
            // =============================================
            const handleLinkClick = {
                "ContestNavigationGuard.useEffect.handleLinkClick": (e)=>{
                    const target = e.target;
                    const anchor = target.closest("a");
                    if (anchor) {
                        const href = anchor.getAttribute("href");
                        // Check if navigation is to an allowed path
                        // Ignore hash links, empty links, or javascript:void, or disabled links
                        if (href && href !== "#" && href.trim() !== "" && !href.startsWith("javascript:") && !allowedPaths.some({
                            "ContestNavigationGuard.useEffect.handleLinkClick": (path)=>href.startsWith(path)
                        }["ContestNavigationGuard.useEffect.handleLinkClick"])) {
                            e.preventDefault();
                            e.stopPropagation();
                            (0, __TURBOPACK__imported__module__$5b$project$5d2f$actions$2f$data$3a$93ad3e__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__["logContestViolation"])(contestId, "NAVIGATION_ATTEMPT", `Attempted to navigate to: ${href}`);
                            return false;
                        }
                    }
                }
            }["ContestNavigationGuard.useEffect.handleLinkClick"];
            document.addEventListener("click", handleLinkClick, true);
            // =============================================
            // 3. MONITOR PATH CHANGES
            // =============================================
            // If path changes unexpectedly, redirect back
            if (pathname !== initialPath.current) {
                const isAllowed = allowedPaths.some({
                    "ContestNavigationGuard.useEffect.isAllowed": (path)=>pathname?.startsWith(path)
                }["ContestNavigationGuard.useEffect.isAllowed"]);
                if (!isAllowed) {
                    (0, __TURBOPACK__imported__module__$5b$project$5d2f$actions$2f$data$3a$93ad3e__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__["logContestViolation"])(contestId, "NAVIGATION_ATTEMPT", `Unexpected navigation to: ${pathname}`);
                    // Redirect back to contest
                    router.replace(initialPath.current || "/");
                }
            }
            return ({
                "ContestNavigationGuard.useEffect": ()=>{
                    window.removeEventListener("popstate", handlePopState);
                    document.removeEventListener("click", handleLinkClick, true);
                }
            })["ContestNavigationGuard.useEffect"];
        }
    }["ContestNavigationGuard.useEffect"], [
        contestId,
        pathname,
        allowedPaths,
        router
    ]);
    // This component doesn't render anything
    return null;
}
_s(ContestNavigationGuard, "iPG3cX6oJ0ELxv2WzWdEVpIspDc=", false, function() {
    return [
        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$navigation$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRouter"],
        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$navigation$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["usePathname"]
    ];
});
_c = ContestNavigationGuard;
var _c;
__turbopack_context__.k.register(_c, "ContestNavigationGuard");
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/actions/data:445697 [app-client] (ecmascript) <text/javascript>", ((__turbopack_context__) => {
"use strict";

/* __next_internal_action_entry_do_not_use__ [{"40cb9402bcb3cefb68c56b22e13de3a9f637bd31ab":"finishContestAction"},"actions/contest.ts",""] */ __turbopack_context__.s([
    "finishContestAction",
    ()=>finishContestAction
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-client] (ecmascript)");
"use turbopack no side effects";
;
var finishContestAction = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["createServerReference"])("40cb9402bcb3cefb68c56b22e13de3a9f637bd31ab", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["findSourceMapURL"], "finishContestAction"); //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vY29udGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzZXJ2ZXJcIjtcblxuaW1wb3J0IHsgcHJpc21hIH0gZnJvbSBcIkAvbGliL3ByaXNtYVwiO1xuaW1wb3J0IHsgYXV0aCB9IGZyb20gXCJAL2xpYi9hdXRoXCI7XG5pbXBvcnQgeyBoZWFkZXJzIH0gZnJvbSBcIm5leHQvaGVhZGVyc1wiO1xuaW1wb3J0IHsgeiB9IGZyb20gXCJ6b2RcIjtcbmltcG9ydCB7IHJldmFsaWRhdGVQYXRoLCByZXZhbGlkYXRlVGFnIH0gZnJvbSBcIm5leHQvY2FjaGVcIjtcbmltcG9ydCB7IGNhY2hlVGFnLCBjYWNoZUxpZmUgfSBmcm9tIFwibmV4dC9jYWNoZVwiO1xuXG5jb25zdCBjb250ZXN0U2NoZW1hID0gei5vYmplY3Qoe1xuICAgIHRpdGxlOiB6LnN0cmluZygpLm1pbigzLCBcIlRpdGxlIG11c3QgYmUgYXQgbGVhc3QgMyBjaGFyYWN0ZXJzXCIpLFxuICAgIGRlc2NyaXB0aW9uOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgc3RhcnRUaW1lOiB6LmNvZXJjZS5kYXRlKCksXG4gICAgZW5kVGltZTogei5jb2VyY2UuZGF0ZSgpLFxuICAgIHZpc2liaWxpdHk6IHouZW51bShbXCJQVUJMSUNcIiwgXCJJTlNUSVRVVElPTlwiLCBcIkNMQVNTUk9PTVwiXSksXG4gICAgY2xhc3Nyb29tSWQ6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgICBpbnN0aXR1dGlvbklkOiB6LnN0cmluZygpLm9wdGlvbmFsKCkubnVsbGFibGUoKSxcbiAgICBwcm9ibGVtczogei5hcnJheSh6LnN0cmluZygpKS5taW4oMSwgXCJTZWxlY3QgYXQgbGVhc3Qgb25lIHByb2JsZW1cIiksXG4gICAgY29udGVzdFBhc3N3b3JkOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgcmFuZG9taXplUXVlc3Rpb25zOiB6LmJvb2xlYW4oKS5kZWZhdWx0KGZhbHNlKSxcbn0pO1xuXG5jb25zdCBjb250ZXN0V2l0aFByb2JsZW1zU2NoZW1hID0gei5vYmplY3Qoe1xuICAgIHRpdGxlOiB6LnN0cmluZygpLm1pbigzLCBcIlRpdGxlIG11c3QgYmUgYXQgbGVhc3QgMyBjaGFyYWN0ZXJzXCIpLFxuICAgIHNsdWc6IHouc3RyaW5nKCkubWluKDMsIFwiU2x1ZyBtdXN0IGJlIGF0IGxlYXN0IDMgY2hhcmFjdGVyc1wiKSxcbiAgICBkZXNjcmlwdGlvbjogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAgIHN0YXJ0VGltZTogei5kYXRlKCksXG4gICAgZW5kVGltZTogei5kYXRlKCksXG4gICAgdmlzaWJpbGl0eTogei5lbnVtKFtcIlBVQkxJQ1wiLCBcIklOU1RJVFVUSU9OXCIsIFwiQ0xBU1NST09NXCJdKSxcbiAgICBoaWRkZW46IHouYm9vbGVhbigpLmRlZmF1bHQoZmFsc2UpLFxuICAgIGNsYXNzcm9vbUlkOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgaW5zdGl0dXRpb25JZDogei5zdHJpbmcoKS5vcHRpb25hbCgpLm51bGxhYmxlKCksXG4gICAgYmFja2dyb3VuZEltYWdlOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgcHJpemVzOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgcnVsZXM6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgICBwcm9ibGVtczogei5hcnJheSh6LmFueSgpKSwgLy8gRnVsbCBwcm9ibGVtIGRhdGEgb2JqZWN0c1xuICAgIGNvbnRlc3RQYXNzd29yZDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAgIHJhbmRvbWl6ZVF1ZXN0aW9uczogei5ib29sZWFuKCkuZGVmYXVsdChmYWxzZSksXG59KTtcblxuLyoqXG4gKiBGZXRjaGVzIGNvbnRlc3RzIHZpc2libGUgdG8gdGhlIGN1cnJlbnQgdXNlci5cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFZpc2libGVDb250ZXN0cygpIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIHRyeSB7XG4gICAgICAgIGlmICghc2Vzc2lvbj8udXNlcikge1xuICAgICAgICAgICAgY29uc3QgY29udGVzdHMgPSBhd2FpdCBwcmlzbWEuY29udGVzdC5maW5kTWFueSh7XG4gICAgICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICAgICAgdmlzaWJpbGl0eTogXCJQVUJMSUNcIixcbiAgICAgICAgICAgICAgICAgICAgaGlkZGVuOiBmYWxzZSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICAgICAgX2NvdW50OiB7IHNlbGVjdDogeyBwcm9ibGVtczogdHJ1ZSB9IH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9yZGVyQnk6IHsgc3RhcnRUaW1lOiBcImRlc2NcIiB9LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBjb250ZXN0cyB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgY3VycmVudFVzZXIgPSBzZXNzaW9uLnVzZXIgYXMgYW55O1xuXG4gICAgICAgIGlmIChjdXJyZW50VXNlci5yb2xlID09PSBcIkFETUlOXCIpIHtcbiAgICAgICAgICAgIGNvbnN0IGNvbnRlc3RzID0gYXdhaXQgcHJpc21hLmNvbnRlc3QuZmluZE1hbnkoe1xuICAgICAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICAgICAgX2NvdW50OiB7IHNlbGVjdDogeyBwcm9ibGVtczogdHJ1ZSB9IH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9yZGVyQnk6IHsgc3RhcnRUaW1lOiBcImRlc2NcIiB9LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBjb250ZXN0cyB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgY29udGVzdHMgPSBhd2FpdCBwcmlzbWEuY29udGVzdC5maW5kTWFueSh7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgIE9SOiBbXG4gICAgICAgICAgICAgICAgICAgIHsgdmlzaWJpbGl0eTogXCJQVUJMSUNcIiB9LFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBBTkQ6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IHZpc2liaWxpdHk6IFwiSU5TVElUVVRJT05cIiB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgaW5zdGl0dXRpb25JZDogY3VycmVudFVzZXIuaW5zdGl0dXRpb25JZCB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgQU5EOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeyB2aXNpYmlsaXR5OiBcIkNMQVNTUk9PTVwiIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBPUjogW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBjbGFzc3Jvb206IHsgc3R1ZGVudHM6IHsgc29tZTogeyBpZDogY3VycmVudFVzZXIuaWQgfSB9IH0gfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgY3JlYXRvcklkOiBjdXJyZW50VXNlci5pZCB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB7IGNyZWF0b3JJZDogY3VycmVudFVzZXIuaWQgfSxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICBfY291bnQ6IHsgc2VsZWN0OiB7IHByb2JsZW1zOiB0cnVlIH0gfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9yZGVyQnk6IHsgc3RhcnRUaW1lOiBcImRlc2NcIiB9LFxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBjb250ZXN0cyB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gZmV0Y2ggY29udGVzdHM6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBmZXRjaCBjb250ZXN0c1wiIH07XG4gICAgfVxufVxuXG5cbi8qKlxuICogRmV0Y2hlcyBhIHNpbmdsZSBjb250ZXN0J3MgZGV0YWlscyB3aXRoIGF1dGhvcml6YXRpb24uXG4gKi9cbi8qKlxuICogRmV0Y2hlcyBhIHNpbmdsZSBjb250ZXN0J3MgZGV0YWlscyB3aXRoIGF1dGhvcml6YXRpb24uXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRDb250ZXN0RGV0YWlsKGNvbnRlc3RJZDogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjb250ZXN0ID0gYXdhaXQgcHJpc21hLmNvbnRlc3QuZmluZFVuaXF1ZSh7XG4gICAgICAgICAgICB3aGVyZTogeyBpZDogY29udGVzdElkIH0sXG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgX2NvdW50OiB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdDogeyBwcm9ibGVtczogdHJ1ZSB9LFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgcHJvYmxlbXM6IHtcbiAgICAgICAgICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJvYmxlbToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpZmZpY3VsdHk6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNsdWc6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIG9yZGVyQnk6IHsgb3JkZXI6IFwiYXNjXCIgfSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKCFjb250ZXN0KSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiQ29udGVzdCBub3QgZm91bmRcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgY3VycmVudFVzZXIgPSBzZXNzaW9uPy51c2VyIGFzIGFueTtcbiAgICAgICAgY29uc3QgcGFydGljaXBhdGlvbiA9IGN1cnJlbnRVc2VyID8gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZDogY3VycmVudFVzZXIuaWQsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlc3RJZDogY29udGVzdElkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KSA6IG51bGw7XG5cbiAgICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgICAgICAgY29uc3QgaGFzU3RhcnRlZCA9IG5vdyA+PSBjb250ZXN0LnN0YXJ0VGltZTtcbiAgICAgICAgY29uc3QgaXNDcmVhdG9yID0gY3VycmVudFVzZXI/LmlkID09PSBjb250ZXN0LmNyZWF0b3JJZDtcbiAgICAgICAgY29uc3QgaXNBZG1pbiA9IGN1cnJlbnRVc2VyPy5yb2xlID09PSBcIkFETUlOXCI7XG5cbiAgICAgICAgLy8gVmlzaWJpbGl0eSBDaGVja1xuICAgICAgICBsZXQgaXNBdXRob3JpemVkID0gZmFsc2U7XG4gICAgICAgIGlmIChjb250ZXN0LnZpc2liaWxpdHkgPT09IFwiUFVCTElDXCIpIHtcbiAgICAgICAgICAgIGlzQXV0aG9yaXplZCA9IHRydWU7XG4gICAgICAgIH0gZWxzZSBpZiAoaXNBZG1pbikge1xuICAgICAgICAgICAgaXNBdXRob3JpemVkID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIGlmIChjdXJyZW50VXNlcikge1xuICAgICAgICAgICAgaWYgKGlzQ3JlYXRvcikge1xuICAgICAgICAgICAgICAgIGlzQXV0aG9yaXplZCA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGNvbnRlc3QudmlzaWJpbGl0eSA9PT0gXCJJTlNUSVRVVElPTlwiKSB7XG4gICAgICAgICAgICAgICAgLy8gVXNlID09IGZvciBudWxsL3VuZGVmaW5lZCBsb29zZSBlcXVhbGl0eSBjaGVja1xuICAgICAgICAgICAgICAgIGlzQXV0aG9yaXplZCA9IGN1cnJlbnRVc2VyLmluc3RpdHV0aW9uSWQgPT0gY29udGVzdC5pbnN0aXR1dGlvbklkO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChjb250ZXN0LnZpc2liaWxpdHkgPT09IFwiQ0xBU1NST09NXCIpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlbnJvbGxtZW50ID0gYXdhaXQgcHJpc21hLmNsYXNzcm9vbS5maW5kRmlyc3Qoe1xuICAgICAgICAgICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGNvbnRlc3QuY2xhc3Nyb29tSWQgYXMgc3RyaW5nLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3R1ZGVudHM6IHsgc29tZTogeyBpZDogY3VycmVudFVzZXIuaWQgfSB9LFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGlzQXV0aG9yaXplZCA9ICEhZW5yb2xsbWVudDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghaXNBdXRob3JpemVkKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkIGFjY2VzcyB0byB0aGlzIGNvbnRlc3QuXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGNhblNlZVByb2JsZW1zID0gKGhhc1N0YXJ0ZWQgfHwgaXNBZG1pbiB8fCBpc0NyZWF0b3IpICYmIChwYXJ0aWNpcGF0aW9uPy5hY2NlcHRlZFJ1bGVzIHx8IGlzQ3JlYXRvciB8fCBpc0FkbWluKTtcblxuICAgICAgICAvLyBGaXg6IElmIHRoZSBjb250ZXN0IGlzIG92ZXIsIGFsbG93ZWQgcm9sZXMgc2hvdWxkIGNoZWNrIHBhcnRpY2lwYXRpb24gcHJvcGVybHksXG4gICAgICAgIC8vIGJ1dCB0eXBpY2FsbHkgYWxsb3dzIHZpZXdpbmcgaWYgcHVibGljL2F1dGhvcml6ZWQuXG4gICAgICAgIC8vIEJ1dCBmb3IgXCJMaXZlXCIgY29udGVzdHMsIHRoZSBjdXJyZW50IGxvZ2ljIGlzIGNvcnJlY3QuXG5cbiAgICAgICAgY29uc3QgcmVxdWlyZXNQYXNzd29yZCA9ICEhY29udGVzdC5jb250ZXN0UGFzc3dvcmQ7XG5cbiAgICAgICAgLy8gU2h1ZmZsZSBwcm9ibGVtcyBpZiByYW5kb21pemVRdWVzdGlvbnMgaXMgZW5hYmxlZFxuICAgICAgICAvLyBVc2UgYSBzaW1wbGUgc2VlZGVkIHNodWZmbGUgYmFzZWQgb24gdXNlcklkICsgY29udGVzdElkIGZvciBjb25zaXN0ZW5jeVxuICAgICAgICBsZXQgdmlzaWJsZVByb2JsZW1zID0gY2FuU2VlUHJvYmxlbXMgPyBjb250ZXN0LnByb2JsZW1zIDogW107XG5cbiAgICAgICAgaWYgKGNvbnRlc3QucmFuZG9taXplUXVlc3Rpb25zICYmIGN1cnJlbnRVc2VyICYmIHZpc2libGVQcm9ibGVtcy5sZW5ndGggPiAwICYmICFpc0FkbWluICYmICFpc0NyZWF0b3IpIHtcbiAgICAgICAgICAgIC8vIFNpbXBsZSBzdHJpbmcgaGFzaCBmdW5jdGlvbiBmb3Igc2VlZGluZ1xuICAgICAgICAgICAgY29uc3Qgc2VlZFN0ciA9IGAke2N1cnJlbnRVc2VyLmlkfS0ke2NvbnRlc3RJZH1gO1xuICAgICAgICAgICAgbGV0IHNlZWQgPSAwO1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzZWVkU3RyLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgc2VlZCA9ICgoc2VlZCA8PCA1KSAtIHNlZWQpICsgc2VlZFN0ci5jaGFyQ29kZUF0KGkpO1xuICAgICAgICAgICAgICAgIHNlZWQgfD0gMDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gRGV0ZXJtaW5pc3RpYyBzaHVmZmxlXG4gICAgICAgICAgICB2aXNpYmxlUHJvYmxlbXMgPSBbLi4udmlzaWJsZVByb2JsZW1zXS5zb3J0KChhLCBiKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgeCA9IE1hdGguc2luKHNlZWQrKykgKiAxMDAwMDtcbiAgICAgICAgICAgICAgICByZXR1cm4gKHggLSBNYXRoLmZsb29yKHgpKSAtIDAuNTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gRmV0Y2ggdXNlcidzIHNvbHZlZCBwcm9ibGVtcyBmb3IgdGhpcyBjb250ZXN0XG4gICAgICAgIGNvbnN0IHNvbHZlZFByb2JsZW1JZHMgPSBuZXcgU2V0PHN0cmluZz4oKTtcbiAgICAgICAgaWYgKGN1cnJlbnRVc2VyKSB7XG4gICAgICAgICAgICBjb25zdCBzb2x2ZWRTdWJtaXNzaW9ucyA9IGF3YWl0IHByaXNtYS5zdWJtaXNzaW9uLmZpbmRNYW55KHtcbiAgICAgICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IGN1cnJlbnRVc2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZCxcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiBcIkFDQ0VQVEVEXCIsXG4gICAgICAgICAgICAgICAgICAgIHByb2JsZW1JZDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgaW46IHZpc2libGVQcm9ibGVtcy5tYXAocCA9PiBwLnByb2JsZW0uaWQpXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHNlbGVjdDogeyBwcm9ibGVtSWQ6IHRydWUgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBzb2x2ZWRTdWJtaXNzaW9ucy5mb3JFYWNoKHMgPT4gc29sdmVkUHJvYmxlbUlkcy5hZGQocy5wcm9ibGVtSWQpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgY29udGVzdDoge1xuICAgICAgICAgICAgICAgIC4uLmNvbnRlc3QsXG4gICAgICAgICAgICAgICAgcHJvYmxlbXM6IHZpc2libGVQcm9ibGVtcy5tYXAodnAgPT4gKHtcbiAgICAgICAgICAgICAgICAgICAgLi4udnAsXG4gICAgICAgICAgICAgICAgICAgIGlzU29sdmVkOiBzb2x2ZWRQcm9ibGVtSWRzLmhhcyh2cC5wcm9ibGVtLmlkKVxuICAgICAgICAgICAgICAgIH0pKSxcbiAgICAgICAgICAgICAgICBoYXNTdGFydGVkLFxuICAgICAgICAgICAgICAgIGhhc0VuZGVkOiBub3cgPiBjb250ZXN0LmVuZFRpbWUsXG4gICAgICAgICAgICAgICAgY2FuTWFuYWdlOiBpc0FkbWluIHx8IGlzQ3JlYXRvcixcbiAgICAgICAgICAgICAgICBoYXNBY2NlcHRlZFJ1bGVzOiBwYXJ0aWNpcGF0aW9uPy5hY2NlcHRlZFJ1bGVzIHx8IGZhbHNlLFxuICAgICAgICAgICAgICAgIGlzRmluaXNoZWQ6IHBhcnRpY2lwYXRpb24/LmlzRmluaXNoZWQgfHwgZmFsc2UsXG4gICAgICAgICAgICAgICAgcmVxdWlyZXNQYXNzd29yZCxcbiAgICAgICAgICAgICAgICBjb250ZXN0UGFzc3dvcmQ6IG51bGwsIC8vIE5ldmVyIHJldHVybiBwbGFpbiBwYXNzd29yZFxuICAgICAgICAgICAgICAgIHNlc3Npb25JZDogcGFydGljaXBhdGlvbj8uc2Vzc2lvbklkIC8vIFJldHVybiBzZXNzaW9uSWQgZm9yIHByb3RlY3Rpb25cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGZldGNoIGNvbnRlc3QgZGV0YWlsOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZmV0Y2ggY29udGVzdFwiIH07XG4gICAgfVxufVxuXG4vLyAuLi4gZXhpc3RpbmcgY29kZSAuLi5cblxuLy8gLi4uIGV4aXN0aW5nIGNvZGUgLi4uXG5cbi8vIC4uLiBleGlzdGluZyBjb2RlIC4uLlxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlQ29udGVzdChkYXRhOiB6LmluZmVyPHR5cGVvZiBjb250ZXN0U2NoZW1hPikge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSB7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuICAgIH1cblxuICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gc2Vzc2lvbi51c2VyIGFzIGFueTtcblxuICAgIGlmICghW1wiQURNSU5cIiwgXCJJTlNUSVRVVElPTl9NQU5BR0VSXCIsIFwiQ09OVEVTVF9NQU5BR0VSXCIsIFwiVEVBQ0hFUlwiXS5pbmNsdWRlcyhjdXJyZW50VXNlci5yb2xlKSkge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCB2YWxpZGF0ZWREYXRhID0gY29udGVzdFNjaGVtYS5wYXJzZShkYXRhKTtcblxuICAgICAgICAvLyBHZW5lcmF0ZSBhIG1vcmUgcm9idXN0IHVuaXF1ZSBzbHVnXG4gICAgICAgIGNvbnN0IGJhc2VTbHVnID0gdmFsaWRhdGVkRGF0YS50aXRsZS50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoL1teYS16MC05XSsvZywgXCItXCIpLnJlcGxhY2UoLyheLXwtJCkvZywgXCJcIik7XG4gICAgICAgIGNvbnN0IHVuaXF1ZVNsdWcgPSBgJHtiYXNlU2x1Z30tJHtEYXRlLm5vdygpfWA7XG5cbiAgICAgICAgY29uc3QgY29udGVzdCA9IGF3YWl0IHByaXNtYS5jb250ZXN0LmNyZWF0ZSh7XG4gICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgdGl0bGU6IHZhbGlkYXRlZERhdGEudGl0bGUsXG4gICAgICAgICAgICAgICAgc2x1ZzogdW5pcXVlU2x1ZyxcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogdmFsaWRhdGVkRGF0YS5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICBzdGFydFRpbWU6IHZhbGlkYXRlZERhdGEuc3RhcnRUaW1lLFxuICAgICAgICAgICAgICAgIGVuZFRpbWU6IHZhbGlkYXRlZERhdGEuZW5kVGltZSxcbiAgICAgICAgICAgICAgICB2aXNpYmlsaXR5OiB2YWxpZGF0ZWREYXRhLnZpc2liaWxpdHkgYXMgYW55LFxuICAgICAgICAgICAgICAgIGluc3RpdHV0aW9uSWQ6IHZhbGlkYXRlZERhdGEudmlzaWJpbGl0eSAhPT0gXCJQVUJMSUNcIiA/ICh2YWxpZGF0ZWREYXRhLmluc3RpdHV0aW9uSWQgfHwgbnVsbCkgOiBudWxsLFxuICAgICAgICAgICAgICAgIGNsYXNzcm9vbUlkOiB2YWxpZGF0ZWREYXRhLnZpc2liaWxpdHkgPT09IFwiQ0xBU1NST09NXCIgPyAodmFsaWRhdGVkRGF0YS5jbGFzc3Jvb21JZCB8fCBudWxsKSA6IG51bGwsXG4gICAgICAgICAgICAgICAgY3JlYXRvcklkOiBjdXJyZW50VXNlci5pZCxcbiAgICAgICAgICAgICAgICBjb250ZXN0UGFzc3dvcmQ6IHZhbGlkYXRlZERhdGEuY29udGVzdFBhc3N3b3JkIHx8IG51bGwsXG4gICAgICAgICAgICAgICAgcmFuZG9taXplUXVlc3Rpb25zOiB2YWxpZGF0ZWREYXRhLnJhbmRvbWl6ZVF1ZXN0aW9ucyB8fCBmYWxzZSxcbiAgICAgICAgICAgICAgICBwcm9ibGVtczoge1xuICAgICAgICAgICAgICAgICAgICBjcmVhdGU6IHZhbGlkYXRlZERhdGEucHJvYmxlbXMubWFwKChwcm9ibGVtSWQsIGluZGV4KSA9PiAoe1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJvYmxlbUlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgb3JkZXI6IGluZGV4LFxuICAgICAgICAgICAgICAgICAgICB9KSksXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldmFsaWRhdGVQYXRoKFwiL2Rhc2hib2FyZC9jb250ZXN0c1wiKTtcbiAgICAgICAgcmV2YWxpZGF0ZVBhdGgoXCIvY29udGVzdFwiKTtcbiAgICAgICAgcmV2YWxpZGF0ZVRhZyhcImNvbnRlc3RzXCIsIFwibWF4XCIpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBjb250ZXN0SWQ6IGNvbnRlc3QuaWQgfTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gY3JlYXRlIGNvbnRlc3Q6XCIsIGVycm9yKTtcbiAgICAgICAgLy8gUmV0dXJuIGNsZWFyZXIgZXJyb3IgbWVzc2FnZXNcbiAgICAgICAgbGV0IGVycm9yTWVzc2FnZSA9IFwiRmFpbGVkIHRvIGNyZWF0ZSBjb250ZXN0XCI7XG4gICAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIHouWm9kRXJyb3IpIHtcbiAgICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSAoZXJyb3IgYXMgYW55KS5lcnJvcnMubWFwKChlOiBhbnkpID0+IGUubWVzc2FnZSkuam9pbihcIiwgXCIpO1xuICAgICAgICB9IGVsc2UgaWYgKGVycm9yIGluc3RhbmNlb2YgRXJyb3IpIHtcbiAgICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSBlcnJvci5tZXNzYWdlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3JNZXNzYWdlIH07XG4gICAgfVxuICAgIH1cblxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlQ29udGVzdFdpdGhQcm9ibGVtcyhkYXRhOiB6LmluZmVyPHR5cGVvZiBjb250ZXN0V2l0aFByb2JsZW1zU2NoZW1hPikge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSB7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuICAgIH1cblxuICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gc2Vzc2lvbi51c2VyIGFzIGFueTtcblxuICAgIGlmICghW1wiQURNSU5cIiwgXCJJTlNUSVRVVElPTl9NQU5BR0VSXCIsIFwiQ09OVEVTVF9NQU5BR0VSXCIsIFwiVEVBQ0hFUlwiXS5pbmNsdWRlcyhjdXJyZW50VXNlci5yb2xlKSkge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCB2YWxpZGF0ZWREYXRhID0gY29udGVzdFdpdGhQcm9ibGVtc1NjaGVtYS5wYXJzZShkYXRhKTtcblxuICAgICAgICBjb25zdCBjb250ZXN0ID0gYXdhaXQgcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNvbnRlc3QgPSBhd2FpdCB0eC5jb250ZXN0LmNyZWF0ZSh7XG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICB0aXRsZTogdmFsaWRhdGVkRGF0YS50aXRsZSxcbiAgICAgICAgICAgICAgICAgICAgc2x1ZzogdmFsaWRhdGVkRGF0YS5zbHVnLFxuICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogdmFsaWRhdGVkRGF0YS5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICAgICAgc3RhcnRUaW1lOiB2YWxpZGF0ZWREYXRhLnN0YXJ0VGltZSxcbiAgICAgICAgICAgICAgICAgICAgZW5kVGltZTogdmFsaWRhdGVkRGF0YS5lbmRUaW1lLFxuICAgICAgICAgICAgICAgICAgICB2aXNpYmlsaXR5OiB2YWxpZGF0ZWREYXRhLnZpc2liaWxpdHkgYXMgYW55LFxuICAgICAgICAgICAgICAgICAgICBoaWRkZW46IHZhbGlkYXRlZERhdGEuaGlkZGVuLFxuICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kSW1hZ2U6IHZhbGlkYXRlZERhdGEuYmFja2dyb3VuZEltYWdlLFxuICAgICAgICAgICAgICAgICAgICBwcml6ZXM6IHZhbGlkYXRlZERhdGEucHJpemVzLFxuICAgICAgICAgICAgICAgICAgICBydWxlczogdmFsaWRhdGVkRGF0YS5ydWxlcyxcbiAgICAgICAgICAgICAgICAgICAgaW5zdGl0dXRpb25JZDogdmFsaWRhdGVkRGF0YS52aXNpYmlsaXR5ICE9PSBcIlBVQkxJQ1wiID8gKHZhbGlkYXRlZERhdGEuaW5zdGl0dXRpb25JZCB8fCBudWxsKSA6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIGNsYXNzcm9vbUlkOiB2YWxpZGF0ZWREYXRhLnZpc2liaWxpdHkgPT09IFwiQ0xBU1NST09NXCIgPyAodmFsaWRhdGVkRGF0YS5jbGFzc3Jvb21JZCB8fCBudWxsKSA6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIGNyZWF0b3JJZDogY3VycmVudFVzZXIuaWQsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlc3RQYXNzd29yZDogdmFsaWRhdGVkRGF0YS5jb250ZXN0UGFzc3dvcmQgfHwgbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgcmFuZG9taXplUXVlc3Rpb25zOiB2YWxpZGF0ZWREYXRhLnJhbmRvbWl6ZVF1ZXN0aW9ucyB8fCBmYWxzZSxcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB2YWxpZGF0ZWREYXRhLnByb2JsZW1zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcCA9IHZhbGlkYXRlZERhdGEucHJvYmxlbXNbaV07XG4gICAgICAgICAgICAgICAgLy8gR2VuZXJhdGUgdW5pcXVlIHNsdWcgYnkgYXBwZW5kaW5nIGNvbnRlc3Qgc2x1ZyBhbmQgaW5kZXhcbiAgICAgICAgICAgICAgICBjb25zdCB1bmlxdWVTbHVnID0gYCR7dmFsaWRhdGVkRGF0YS5zbHVnfS0ke3Auc2x1ZyB8fCBwLnRpdGxlLnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvXFxzKy9nLCAnLScpfS0ke0RhdGUubm93KCl9LSR7aX1gO1xuICAgICAgICAgICAgICAgIGNvbnN0IHByb2JsZW0gPSBhd2FpdCB0eC5wcm9ibGVtLmNyZWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBwLnRpdGxlLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHAuZGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICBkaWZmaWN1bHR5OiBwLmRpZmZpY3VsdHksXG4gICAgICAgICAgICAgICAgICAgICAgICBzbHVnOiB1bmlxdWVTbHVnLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcmU6IHAuc2NvcmUgfHwgMTAsXG4gICAgICAgICAgICAgICAgICAgICAgICBkb21haW46IHAuZG9tYWluLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJDT05URVNUXCIsIC8vIENvbnRlc3QgcHJvYmxlbXMgYXJlIG1hcmtlZCBzZXBhcmF0ZWx5XG4gICAgICAgICAgICAgICAgICAgICAgICBoaWRkZW46IHRydWUsIC8vIENvbnRlc3QgcHJvYmxlbXMgYXJlIGhpZGRlbiBmcm9tIG1haW4gYmFua1xuICAgICAgICAgICAgICAgICAgICAgICAgdGVzdENhc2VzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlOiBwLnRlc3RDYXNlcyxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICB0YWdzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29ubmVjdDogcC50YWdzPy5tYXAoKHQ6IHN0cmluZykgPT4gKHsgbmFtZTogdCB9KSkgfHwgW10sXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGF3YWl0IHR4LmNvbnRlc3RQcm9ibGVtLmNyZWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlc3RJZDogY29udGVzdC5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2JsZW1JZDogcHJvYmxlbS5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG9yZGVyOiBpLFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBjb250ZXN0O1xuICAgICAgICB9KTtcblxuICAgICAgICByZXZhbGlkYXRlUGF0aChcIi9kYXNoYm9hcmQvY29udGVzdHNcIik7XG4gICAgICAgIHJldmFsaWRhdGVQYXRoKFwiL2NvbnRlc3RzXCIpO1xuICAgICAgICByZXZhbGlkYXRlUGF0aChcIi9jb250ZXN0XCIpO1xuICAgICAgICByZXZhbGlkYXRlVGFnKFwiY29udGVzdHNcIiwgXCJtYXhcIik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGNvbnRlc3RJZDogY29udGVzdC5pZCB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gY3JlYXRlIGNvbnRlc3Qgd2l0aCBwcm9ibGVtczpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGNyZWF0ZSBjb250ZXN0XCIgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRJbnN0aXR1dGlvbmFsQ2xhc3Nyb29tcyhpbnN0aXR1dGlvbklkOiBzdHJpbmcpIHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjbGFzc3Jvb21zID0gYXdhaXQgcHJpc21hLmNsYXNzcm9vbS5maW5kTWFueSh7XG4gICAgICAgICAgICB3aGVyZTogeyBpbnN0aXR1dGlvbklkIH0sXG4gICAgICAgICAgICBzZWxlY3Q6IHsgaWQ6IHRydWUsIG5hbWU6IHRydWUsIHNlY3Rpb246IHRydWUgfSxcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGNsYXNzcm9vbXMgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGZldGNoIGNsYXNzcm9vbXM6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBmZXRjaCBjbGFzc3Jvb21zXCIgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRTZWxlY3RhYmxlUHJvYmxlbXMoc2VhcmNoOiBzdHJpbmcpIHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBwcm9ibGVtcyA9IGF3YWl0IHByaXNtYS5wcm9ibGVtLmZpbmRNYW55KHtcbiAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgT1I6IFtcbiAgICAgICAgICAgICAgICAgICAgeyB0aXRsZTogeyBjb250YWluczogc2VhcmNoLCBtb2RlOiBcImluc2Vuc2l0aXZlXCIgfSB9LFxuICAgICAgICAgICAgICAgICAgICB7IHNsdWc6IHsgY29udGFpbnM6IHNlYXJjaCwgbW9kZTogXCJpbnNlbnNpdGl2ZVwiIH0gfSxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIGhpZGRlbjogZmFsc2UsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2VsZWN0OiB7IGlkOiB0cnVlLCB0aXRsZTogdHJ1ZSwgZGlmZmljdWx0eTogdHJ1ZSwgc2x1ZzogdHJ1ZSB9LFxuICAgICAgICAgICAgdGFrZTogMTAsXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBwcm9ibGVtcyB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gZmV0Y2ggcHJvYmxlbXM6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBmZXRjaCBwcm9ibGVtc1wiIH07XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYWNjZXB0Q29udGVzdFJ1bGVzKGNvbnRlc3RJZDogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICBpZiAoIXNlc3Npb24/LnVzZXIpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuXG4gICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLnVwc2VydCh7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgIHVzZXJJZF9jb250ZXN0SWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkOiBzZXNzaW9uLnVzZXIuaWQsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlc3RJZDogY29udGVzdElkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHVwZGF0ZTogeyBhY2NlcHRlZFJ1bGVzOiB0cnVlIH0sXG4gICAgICAgICAgICBjcmVhdGU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWQ6IHNlc3Npb24udXNlci5pZCxcbiAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZCxcbiAgICAgICAgICAgICAgICBhY2NlcHRlZFJ1bGVzOiB0cnVlXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXZhbGlkYXRlUGF0aChgL2NvbnRlc3QvJHtjb250ZXN0SWR9YCk7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGFjY2VwdCBydWxlc1wiIH07XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZmluaXNoQ29udGVzdEFjdGlvbihjb250ZXN0SWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcblxuICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHByaXNtYS5jb250ZXN0UGFydGljaXBhdGlvbi51cHNlcnQoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1cGRhdGU6IHtcbiAgICAgICAgICAgICAgICBpc0ZpbmlzaGVkOiB0cnVlLFxuICAgICAgICAgICAgICAgIGZpbmlzaGVkQXQ6IG5ldyBEYXRlKClcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjcmVhdGU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWQ6IHNlc3Npb24udXNlci5pZCxcbiAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZCxcbiAgICAgICAgICAgICAgICBhY2NlcHRlZFJ1bGVzOiB0cnVlLFxuICAgICAgICAgICAgICAgIGlzRmluaXNoZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgZmluaXNoZWRBdDogbmV3IERhdGUoKVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV2YWxpZGF0ZVBhdGgoYC9jb250ZXN0LyR7Y29udGVzdElkfWApO1xuICAgICAgICByZXZhbGlkYXRlUGF0aChgL3Byb2JsZW1zYCk7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGZpbmlzaCBjb250ZXN0XCIgfTtcbiAgICB9XG59XG5cbi8qKlxuICogRmluYWxpemUgQ29udGVzdCAmIEF3YXJkIEJhZGdlc1xuICogLSBDYWxjdWxhdGVzIGxlYWRlcmJvYXJkXG4gKiAtIEF3YXJkcyBHb2xkLCBTaWx2ZXIsIEJyb256ZSB0byBUb3AgM1xuICogLSBNYXJrcyBjb250ZXN0IGFzIGZpbmFsaXplZFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZmluYWxpemVDb250ZXN0KGNvbnRlc3RJZDogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICBpZiAoIXNlc3Npb24/LnVzZXIpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuXG4gICAgLy8gT25seSBhZG1pbnMgb3IgY29udGVzdCBtYW5hZ2VycyBjYW4gZmluYWxpemVcbiAgICBjb25zdCBjdXJyZW50VXNlciA9IHNlc3Npb24udXNlciBhcyBhbnk7XG4gICAgaWYgKCFbXCJBRE1JTlwiLCBcIkNPTlRFU1RfTUFOQUdFUlwiLCBcIklOU1RJVFVUSU9OX01BTkFHRVJcIiwgXCJURUFDSEVSXCJdLmluY2x1ZGVzKGN1cnJlbnRVc2VyLnJvbGUpKSB7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRlc3QgPSBhd2FpdCBwcmlzbWEuY29udGVzdC5maW5kVW5pcXVlKHtcbiAgICAgICAgICAgICB3aGVyZTogeyBpZDogY29udGVzdElkIH0sXG4gICAgICAgICAgICAgc2VsZWN0OiB7IGlzRmluYWxpemVkOiB0cnVlLCB0aXRsZTogdHJ1ZSB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICghY29udGVzdCkgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkNvbnRlc3Qgbm90IGZvdW5kXCIgfTtcbiAgICAgICAgaWYgKGNvbnRlc3QuaXNGaW5hbGl6ZWQpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJDb250ZXN0IGlzIGFscmVhZHkgZmluYWxpemVkXCIgfTtcblxuICAgICAgICAvLyBSZXVzZSBsZWFkZXJib2FyZCBsb2dpYyB0byBnZXQgcmFua2luZ3NcbiAgICAgICAgY29uc3QgbGVhZGVyYm9hcmQgPSBhd2FpdCBnZXRDb250ZXN0TGVhZGVyYm9hcmQoY29udGVzdElkKTtcbiAgICAgICAgaWYgKCFsZWFkZXJib2FyZC5zdWNjZXNzIHx8ICFsZWFkZXJib2FyZC5zdHVkZW50cykge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBmZXRjaCBsZWFkZXJib2FyZFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBzdHVkZW50cyA9IGxlYWRlcmJvYXJkLnN0dWRlbnRzIGFzIGFueVtdO1xuXG4gICAgICAgIC8vIEF0IGxlYXN0IDEgc3R1ZGVudCBuZWVkZWRcbiAgICAgICAgaWYgKHN0dWRlbnRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgIGF3YWl0IHByaXNtYS5jb250ZXN0LnVwZGF0ZSh7XG4gICAgICAgICAgICAgICAgIHdoZXJlOiB7IGlkOiBjb250ZXN0SWQgfSxcbiAgICAgICAgICAgICAgICAgZGF0YTogeyBpc0ZpbmFsaXplZDogdHJ1ZSB9XG4gICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgbWVzc2FnZTogXCJDb250ZXN0IGZpbmFsaXplZCAobm8gcGFydGljaXBhbnRzKVwiIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBUb3AgMyBJRHNcbiAgICAgICAgY29uc3QgZ29sZFVzZXJJZCA9IHN0dWRlbnRzWzBdPy5pZDtcbiAgICAgICAgY29uc3Qgc2lsdmVyVXNlcklkID0gc3R1ZGVudHNbMV0/LmlkO1xuICAgICAgICBjb25zdCBicm9uemVVc2VySWQgPSBzdHVkZW50c1syXT8uaWQ7XG5cbiAgICAgICAgYXdhaXQgcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgICAgIC8vIEF3YXJkIEdvbGRcbiAgICAgICAgICAgIGlmIChnb2xkVXNlcklkKSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdHgudXNlci51cGRhdGUoe1xuICAgICAgICAgICAgICAgICAgICB3aGVyZTogeyBpZDogZ29sZFVzZXJJZCB9LFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7IGdvbGRCYWRnZXM6IHsgaW5jcmVtZW50OiAxIH0gfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gQXdhcmQgU2lsdmVyXG4gICAgICAgICAgICBpZiAoc2lsdmVyVXNlcklkKSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdHgudXNlci51cGRhdGUoe1xuICAgICAgICAgICAgICAgICAgICB3aGVyZTogeyBpZDogc2lsdmVyVXNlcklkIH0sXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IHsgc2lsdmVyQmFkZ2VzOiB7IGluY3JlbWVudDogMSB9IH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIEF3YXJkIEJyb256ZVxuICAgICAgICAgICAgaWYgKGJyb256ZVVzZXJJZCkge1xuICAgICAgICAgICAgICAgIGF3YWl0IHR4LnVzZXIudXBkYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IGJyb256ZVVzZXJJZCB9LFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7IGJyb256ZUJhZGdlczogeyBpbmNyZW1lbnQ6IDEgfSB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIE1hcmsgRmluYWxpemVkXG4gICAgICAgICAgICBhd2FpdCB0eC5jb250ZXN0LnVwZGF0ZSh7XG4gICAgICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IGNvbnRlc3RJZCB9LFxuICAgICAgICAgICAgICAgIGRhdGE6IHsgaXNGaW5hbGl6ZWQ6IHRydWUgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldmFsaWRhdGVQYXRoKGAvZGFzaGJvYXJkYCk7XG4gICAgICAgIHJldmFsaWRhdGVQYXRoKGAvcHJvZmlsZS8ke2dvbGRVc2VySWR9YCk7XG4gICAgICAgIGlmKHNpbHZlclVzZXJJZCkgcmV2YWxpZGF0ZVBhdGgoYC9wcm9maWxlLyR7c2lsdmVyVXNlcklkfWApO1xuICAgICAgICBpZihicm9uemVVc2VySWQpIHJldmFsaWRhdGVQYXRoKGAvcHJvZmlsZS8ke2Jyb256ZVVzZXJJZH1gKTtcbiAgICAgICAgcmV2YWxpZGF0ZVBhdGgoYC9jb250ZXN0LyR7Y29udGVzdElkfWApO1xuICAgICAgICByZXZhbGlkYXRlVGFnKGBjb250ZXN0LSR7Y29udGVzdElkfWAsIFwibWF4XCIpO1xuICAgICAgICByZXZhbGlkYXRlVGFnKGBsZWFkZXJib2FyZC0ke2NvbnRlc3RJZH1gLCBcIm1heFwiKTtcblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBmaW5hbGl6ZSBjb250ZXN0OlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZmluYWxpemUgY29udGVzdFwiIH07XG4gICAgfVxufVxuXG4vKipcbiAqIFZlcmlmeSBjb250ZXN0IHBhc3N3b3JkIHdpdGhvdXQgc3RhcnRpbmcgc2Vzc2lvbi5cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHZlcmlmeUNvbnRlc3RQYXNzd29yZChjb250ZXN0SWQ6IHN0cmluZywgcGFzc3dvcmQ/OiBzdHJpbmcpIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIGlmICghc2Vzc2lvbj8udXNlcikgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjb250ZXN0ID0gYXdhaXQgcHJpc21hLmNvbnRlc3QuZmluZFVuaXF1ZSh7XG4gICAgICAgICAgICB3aGVyZTogeyBpZDogY29udGVzdElkIH0sXG4gICAgICAgICAgICBzZWxlY3Q6IHsgY29udGVzdFBhc3N3b3JkOiB0cnVlIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKCFjb250ZXN0KSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiQ29udGVzdCBub3QgZm91bmRcIiB9O1xuXG4gICAgICAgIGlmIChjb250ZXN0LmNvbnRlc3RQYXNzd29yZCAmJiBjb250ZXN0LmNvbnRlc3RQYXNzd29yZCAhPT0gcGFzc3dvcmQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJJbnZhbGlkIGNvbnRlc3QgcGFzc3dvcmRcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gdmVyaWZ5IGNvbnRlc3QgcGFzc3dvcmQ6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byB2ZXJpZnkgcGFzc3dvcmRcIiB9O1xuICAgIH1cbn1cblxuXG4vKipcbiAqIFN0YXJ0IGEgY29udGVzdCBzZXNzaW9uIC0gdmFsaWRhdGVzIHRpbWUgYm91bmRzIGFuZCBjcmVhdGVzIHNlc3Npb24gSURcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHN0YXJ0Q29udGVzdFNlc3Npb24oY29udGVzdElkOiBzdHJpbmcsIHBhc3N3b3JkPzogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICBpZiAoIXNlc3Npb24/LnVzZXIpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgY29udGVzdCA9IGF3YWl0IHByaXNtYS5jb250ZXN0LmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IGNvbnRlc3RJZCB9LFxuICAgICAgICAgICAgc2VsZWN0OiB7IHN0YXJ0VGltZTogdHJ1ZSwgZW5kVGltZTogdHJ1ZSwgY29udGVzdFBhc3N3b3JkOiB0cnVlIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKCFjb250ZXN0KSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiQ29udGVzdCBub3QgZm91bmRcIiB9O1xuXG4gICAgICAgIGlmIChjb250ZXN0LmNvbnRlc3RQYXNzd29yZCAmJiBjb250ZXN0LmNvbnRlc3RQYXNzd29yZCAhPT0gcGFzc3dvcmQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJJbnZhbGlkIGNvbnRlc3QgcGFzc3dvcmRcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcblxuICAgICAgICAvLyBUaW1lIGJvdW5kcyBjaGVja1xuICAgICAgICBpZiAobm93IDwgY29udGVzdC5zdGFydFRpbWUpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJDb250ZXN0IGhhcyBub3Qgc3RhcnRlZCB5ZXRcIiB9O1xuICAgICAgICB9XG4gICAgICAgIGlmIChub3cgPiBjb250ZXN0LmVuZFRpbWUpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJDb250ZXN0IGhhcyBhbHJlYWR5IGVuZGVkXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEdlbmVyYXRlIHVuaXF1ZSBzZXNzaW9uIElEXG4gICAgICAgIGNvbnN0IHNlc3Npb25JZCA9IGAke3Nlc3Npb24udXNlci5pZH0tJHtjb250ZXN0SWR9LSR7RGF0ZS5ub3coKX1gO1xuXG4gICAgICAgIC8vIENoZWNrIGZvciBleGlzdGluZyBhY3RpdmUgc2Vzc2lvbiAobXVsdGktdGFiIGRldGVjdGlvbilcbiAgICAgICAgY29uc3QgZXhpc3RpbmdQYXJ0aWNpcGF0aW9uID0gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKGV4aXN0aW5nUGFydGljaXBhdGlvbj8uaXNCbG9ja2VkKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiWW91IGhhdmUgYmVlbiBibG9ja2VkIGZyb20gdGhpcyBjb250ZXN0IGR1ZSB0byB2aW9sYXRpb25zXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChleGlzdGluZ1BhcnRpY2lwYXRpb24/LmlzRmluaXNoZWQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJZb3UgaGF2ZSBhbHJlYWR5IGZpbmlzaGVkIHRoaXMgY29udGVzdFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBVcGRhdGUgb3IgY3JlYXRlIHBhcnRpY2lwYXRpb24gd2l0aCBuZXcgc2Vzc2lvblxuICAgICAgICBjb25zdCBwYXJ0aWNpcGF0aW9uID0gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLnVwc2VydCh7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgIHVzZXJJZF9jb250ZXN0SWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkOiBzZXNzaW9uLnVzZXIuaWQsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlc3RJZDogY29udGVzdElkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHVwZGF0ZToge1xuICAgICAgICAgICAgICAgIHNlc3Npb25JZCxcbiAgICAgICAgICAgICAgICBzZXNzaW9uU3RhcnRlZEF0OiBub3csXG4gICAgICAgICAgICAgICAgYWNjZXB0ZWRSdWxlczogdHJ1ZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNyZWF0ZToge1xuICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgIGNvbnRlc3RJZDogY29udGVzdElkLFxuICAgICAgICAgICAgICAgIHNlc3Npb25JZCxcbiAgICAgICAgICAgICAgICBzZXNzaW9uU3RhcnRlZEF0OiBub3csXG4gICAgICAgICAgICAgICAgYWNjZXB0ZWRSdWxlczogdHJ1ZVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgIHNlc3Npb25JZCxcbiAgICAgICAgICAgIHBhcnRpY2lwYXRpb25JZDogcGFydGljaXBhdGlvbi5pZCxcbiAgICAgICAgICAgIHRvdGFsVmlvbGF0aW9uczogcGFydGljaXBhdGlvbi50b3RhbFZpb2xhdGlvbnMsXG4gICAgICAgICAgICBpc0ZsYWdnZWQ6IHBhcnRpY2lwYXRpb24uaXNGbGFnZ2VkXG4gICAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBzdGFydCBjb250ZXN0IHNlc3Npb246XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBzdGFydCBjb250ZXN0IHNlc3Npb25cIiB9O1xuICAgIH1cbn1cblxuLyoqXG4gKiBMb2cgYSBjb250ZXN0IHZpb2xhdGlvbiAtIHJlY29yZHMgdG8gZGF0YWJhc2UgYW5kIHVwZGF0ZXMgY291bnRlcnNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxvZ0NvbnRlc3RWaW9sYXRpb24oXG4gICAgY29udGVzdElkOiBzdHJpbmcsXG4gICAgdHlwZTogXCJUQUJfU1dJVENIXCIgfCBcIkZVTExTQ1JFRU5fRVhJVFwiIHwgXCJDT1BZX1BBU1RFXCIgfCBcIkRFVlRPT0xTX09QRU5cIiB8IFwiS0VZQk9BUkRfU0hPUlRDVVRcIiB8IFwiTkFWSUdBVElPTl9BVFRFTVBUXCIgfCBcIk1VTFRJX1RBQlwiIHwgXCJTVVNQSUNJT1VTX0lOUFVUXCIsXG4gICAgbWVzc2FnZT86IHN0cmluZyxcbiAgICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT5cbikge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcblxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHBhcnRpY2lwYXRpb24gPSBhd2FpdCBwcmlzbWEuY29udGVzdFBhcnRpY2lwYXRpb24uZmluZFVuaXF1ZSh7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgIHVzZXJJZF9jb250ZXN0SWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkOiBzZXNzaW9uLnVzZXIuaWQsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlc3RJZDogY29udGVzdElkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoIXBhcnRpY2lwYXRpb24pIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJObyBhY3RpdmUgcGFydGljaXBhdGlvbiBmb3VuZFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBEZXRlcm1pbmUgd2hpY2ggY291bnRlciB0byBpbmNyZW1lbnRcbiAgICAgICAgY29uc3QgY291bnRlckZpZWxkID0ge1xuICAgICAgICAgICAgVEFCX1NXSVRDSDogXCJ0YWJTd2l0Y2hDb3VudFwiLFxuICAgICAgICAgICAgRlVMTFNDUkVFTl9FWElUOiBcImZ1bGxzY3JlZW5FeGl0Q291bnRcIixcbiAgICAgICAgICAgIENPUFlfUEFTVEU6IFwiY29weVBhc3RlQ291bnRcIixcbiAgICAgICAgICAgIERFVlRPT0xTX09QRU46IFwiZGV2VG9vbHNDb3VudFwiLFxuICAgICAgICAgICAgS0VZQk9BUkRfU0hPUlRDVVQ6IFwia2V5Ym9hcmRDb3VudFwiLFxuICAgICAgICAgICAgTkFWSUdBVElPTl9BVFRFTVBUOiBcIm5hdmlnYXRpb25Db3VudFwiLFxuICAgICAgICAgICAgTVVMVElfVEFCOiBcInRhYlN3aXRjaENvdW50XCIsXG4gICAgICAgICAgICBTVVNQSUNJT1VTX0lOUFVUOiBcImNvcHlQYXN0ZUNvdW50XCJcbiAgICAgICAgfVt0eXBlXSBhcyBzdHJpbmc7XG5cbiAgICAgICAgLy8gVXNlIHRyYW5zYWN0aW9uIHRvIGVuc3VyZSBhdG9taWMgdXBkYXRlXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHByaXNtYS4kdHJhbnNhY3Rpb24oYXN5bmMgKHR4KSA9PiB7XG4gICAgICAgICAgICAvLyBDaGVjayBsYXN0IHZpb2xhdGlvbiB0aW1lIHRvIHByZXZlbnQgcmFwaWQtZmlyZSBkdXBsaWNhdGVzIChTZXJ2ZXItc2lkZSBkZWJvdW5jZSlcbiAgICAgICAgICAgIGNvbnN0IGxhc3RWaW9sYXRpb24gPSBhd2FpdCB0eC5jb250ZXN0VmlvbGF0aW9uLmZpbmRGaXJzdCh7XG4gICAgICAgICAgICAgICAgd2hlcmU6IHsgcGFydGljaXBhdGlvbklkOiBwYXJ0aWNpcGF0aW9uLmlkIH0sXG4gICAgICAgICAgICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6ICdkZXNjJyB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKGxhc3RWaW9sYXRpb24pIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0aW1lRGlmZiA9IERhdGUubm93KCkgLSBsYXN0VmlvbGF0aW9uLmNyZWF0ZWRBdC5nZXRUaW1lKCk7XG4gICAgICAgICAgICAgICAgLy8gSWYgbGVzcyB0aGFuIDIgc2Vjb25kcyBzaW5jZSBsYXN0IHZpb2xhdGlvbiwgaWdub3JlIHRoaXMgb25lXG4gICAgICAgICAgICAgICAgaWYgKHRpbWVEaWZmIDwgMjAwMCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgLi4ucGFydGljaXBhdGlvbiwgLy8gUmV0dXJuIGV4aXN0aW5nIHN0YXRlXG4gICAgICAgICAgICAgICAgICAgICAgICBpc0ZsYWdnZWQ6IHBhcnRpY2lwYXRpb24uaXNGbGFnZ2VkLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNCbG9ja2VkOiBwYXJ0aWNpcGF0aW9uLmlzQmxvY2tlZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsVmlvbGF0aW9uczogcGFydGljaXBhdGlvbi50b3RhbFZpb2xhdGlvbnMsXG4gICAgICAgICAgICAgICAgICAgICAgICBwZXJtYW5lbnRseUJsb2NrZWQ6IHBhcnRpY2lwYXRpb24ucGVybWFuZW50bHlCbG9ja2VkLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcEJsb2NrZWRVbnRpbDogcGFydGljaXBhdGlvbi50ZW1wQmxvY2tlZFVudGlsXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBDcmVhdGUgdmlvbGF0aW9uIHJlY29yZFxuICAgICAgICAgICAgYXdhaXQgdHguY29udGVzdFZpb2xhdGlvbi5jcmVhdGUoe1xuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgcGFydGljaXBhdGlvbklkOiBwYXJ0aWNpcGF0aW9uLmlkLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiB0eXBlIGFzIGFueSxcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZSxcbiAgICAgICAgICAgICAgICAgICAgbWV0YWRhdGE6IG1ldGFkYXRhID8/IHVuZGVmaW5lZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBDYWxjdWxhdGUgbmV3IHRvdGFsIGFuZCBkZXRlcm1pbmUgYmxvY2tpbmcgdGllclxuICAgICAgICAgICAgY29uc3QgbmV3VG90YWxWaW9sYXRpb25zID0gcGFydGljaXBhdGlvbi50b3RhbFZpb2xhdGlvbnMgKyAxO1xuICAgICAgICAgICAgY29uc3Qgc2hvdWxkRmxhZyA9IG5ld1RvdGFsVmlvbGF0aW9ucyA+PSAzO1xuXG4gICAgICAgICAgICAvLyBUaWVyZWQgYmxvY2tpbmcgbG9naWNcbiAgICAgICAgICAgIGxldCB0ZW1wQmxvY2tlZFVudGlsOiBEYXRlIHwgbnVsbCA9IG51bGw7XG4gICAgICAgICAgICBsZXQgcGVybWFuZW50bHlCbG9ja2VkID0gZmFsc2U7XG4gICAgICAgICAgICBsZXQgaXNCbG9ja2VkID0gZmFsc2U7XG5cbiAgICAgICAgICAgIGlmIChuZXdUb3RhbFZpb2xhdGlvbnMgPj0gNikge1xuICAgICAgICAgICAgICAgIC8vIDYrIHZpb2xhdGlvbnMgPSBwZXJtYW5lbnQgYmxvY2tcbiAgICAgICAgICAgICAgICBwZXJtYW5lbnRseUJsb2NrZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGlzQmxvY2tlZCA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKG5ld1RvdGFsVmlvbGF0aW9ucyA+PSA0KSB7XG4gICAgICAgICAgICAgICAgLy8gNC01IHZpb2xhdGlvbnMgPSA1IG1pbnV0ZSB0ZW1wIGJsb2NrXG4gICAgICAgICAgICAgICAgdGVtcEJsb2NrZWRVbnRpbCA9IG5ldyBEYXRlKERhdGUubm93KCkgKyA1ICogNjAgKiAxMDAwKTsgLy8gNSBtaW51dGVzXG4gICAgICAgICAgICAgICAgaXNCbG9ja2VkID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgdXBkYXRlZCA9IGF3YWl0IHR4LmNvbnRlc3RQYXJ0aWNpcGF0aW9uLnVwZGF0ZSh7XG4gICAgICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IHBhcnRpY2lwYXRpb24uaWQgfSxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIFtjb3VudGVyRmllbGRdOiB7IGluY3JlbWVudDogMSB9LFxuICAgICAgICAgICAgICAgICAgICB0b3RhbFZpb2xhdGlvbnM6IHsgaW5jcmVtZW50OiAxIH0sXG4gICAgICAgICAgICAgICAgICAgIGlzRmxhZ2dlZDogc2hvdWxkRmxhZyB8fCBwYXJ0aWNpcGF0aW9uLmlzRmxhZ2dlZCxcbiAgICAgICAgICAgICAgICAgICAgaXNCbG9ja2VkLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wQmxvY2tlZFVudGlsLFxuICAgICAgICAgICAgICAgICAgICBwZXJtYW5lbnRseUJsb2NrZWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHVwZGF0ZWQ7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgdG90YWxWaW9sYXRpb25zOiByZXN1bHQudG90YWxWaW9sYXRpb25zLFxuICAgICAgICAgICAgaXNGbGFnZ2VkOiByZXN1bHQuaXNGbGFnZ2VkLFxuICAgICAgICAgICAgaXNCbG9ja2VkOiByZXN1bHQuaXNCbG9ja2VkLFxuICAgICAgICAgICAgdGVtcEJsb2NrZWRVbnRpbDogcmVzdWx0LnRlbXBCbG9ja2VkVW50aWw/LnRvSVNPU3RyaW5nKCkgfHwgbnVsbCxcbiAgICAgICAgICAgIHBlcm1hbmVudGx5QmxvY2tlZDogcmVzdWx0LnBlcm1hbmVudGx5QmxvY2tlZFxuICAgICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gbG9nIHZpb2xhdGlvbjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGxvZyB2aW9sYXRpb25cIiB9O1xuICAgIH1cbn1cblxuLyoqXG4gKiBWYWxpZGF0ZSBjb250ZXN0IHNlc3Npb24gLSBjaGVja3MgaWYgc2Vzc2lvbiBpcyB2YWxpZCBmb3Igc3VibWlzc2lvbnNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHZhbGlkYXRlQ29udGVzdFNlc3Npb24oY29udGVzdElkOiBzdHJpbmcsIHNlc3Npb25JZDogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICBpZiAoIXNlc3Npb24/LnVzZXIpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCB2YWxpZDogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBwYXJ0aWNpcGF0aW9uID0gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgY29udGVzdDoge1xuICAgICAgICAgICAgICAgICAgICBzZWxlY3Q6IHsgc3RhcnRUaW1lOiB0cnVlLCBlbmRUaW1lOiB0cnVlIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICghcGFydGljaXBhdGlvbikge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgdmFsaWQ6IGZhbHNlLCByZWFzb246IFwiTm8gcGFydGljaXBhdGlvbiBmb3VuZFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDaGVjayBpZiBibG9ja2VkXG4gICAgICAgIGlmIChwYXJ0aWNpcGF0aW9uLmlzQmxvY2tlZCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgdmFsaWQ6IGZhbHNlLCByZWFzb246IFwiQmxvY2tlZCBkdWUgdG8gdmlvbGF0aW9uc1wiIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDaGVjayBpZiBmaW5pc2hlZFxuICAgICAgICBpZiAocGFydGljaXBhdGlvbi5pc0ZpbmlzaGVkKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCB2YWxpZDogZmFsc2UsIHJlYXNvbjogXCJDb250ZXN0IGFscmVhZHkgZmluaXNoZWRcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ2hlY2sgc2Vzc2lvbiBJRCAobXVsdGktdGFiIGRldGVjdGlvbilcbiAgICAgICAgaWYgKHBhcnRpY2lwYXRpb24uc2Vzc2lvbklkICE9PSBzZXNzaW9uSWQpIHtcbiAgICAgICAgICAgIC8vIExvZyBtdWx0aS10YWIgdmlvbGF0aW9uXG4gICAgICAgICAgICBhd2FpdCBsb2dDb250ZXN0VmlvbGF0aW9uKGNvbnRlc3RJZCwgXCJNVUxUSV9UQUJcIiwgXCJNdWx0aXBsZSB0YWJzIGRldGVjdGVkXCIpO1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgdmFsaWQ6IGZhbHNlLCByZWFzb246IFwiU2Vzc2lvbiBtaXNtYXRjaCAtIHBvc3NpYmxlIG11bHRpcGxlIHRhYnNcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ2hlY2sgdGltZSBib3VuZHNcbiAgICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgICAgICAgaWYgKG5vdyA+IHBhcnRpY2lwYXRpb24uY29udGVzdC5lbmRUaW1lKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCB2YWxpZDogZmFsc2UsIHJlYXNvbjogXCJDb250ZXN0IGhhcyBlbmRlZFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgIHZhbGlkOiB0cnVlLFxuICAgICAgICAgICAgdG90YWxWaW9sYXRpb25zOiBwYXJ0aWNpcGF0aW9uLnRvdGFsVmlvbGF0aW9ucyxcbiAgICAgICAgICAgIGlzRmxhZ2dlZDogcGFydGljaXBhdGlvbi5pc0ZsYWdnZWRcbiAgICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIHZhbGlkYXRlIHNlc3Npb246XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIHZhbGlkOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIHZhbGlkYXRlIHNlc3Npb25cIiB9O1xuICAgIH1cbn1cblxuLyoqXG4gKiBDaGVjayBpZiB1c2VyIGlzIGVsaWdpYmxlIHRvIHN1Ym1pdCAtIHByZS1zdWJtaXNzaW9uIHZhbGlkYXRpb25cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNoZWNrU3VibWlzc2lvbkVsaWdpYmlsaXR5KGNvbnRlc3RJZDogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICBpZiAoIXNlc3Npb24/LnVzZXIpIHJldHVybiB7IGVsaWdpYmxlOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcblxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHBhcnRpY2lwYXRpb24gPSBhd2FpdCBwcmlzbWEuY29udGVzdFBhcnRpY2lwYXRpb24uZmluZFVuaXF1ZSh7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgIHVzZXJJZF9jb250ZXN0SWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkOiBzZXNzaW9uLnVzZXIuaWQsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlc3RJZDogY29udGVzdElkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICBjb250ZXN0OiB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdDogeyBzdGFydFRpbWU6IHRydWUsIGVuZFRpbWU6IHRydWUgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKCFwYXJ0aWNpcGF0aW9uKSB7XG4gICAgICAgICAgICByZXR1cm4geyBlbGlnaWJsZTogZmFsc2UsIHJlYXNvbjogXCJObyBwYXJ0aWNpcGF0aW9uIGZvdW5kXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENoZWNrIHZhcmlvdXMgY29uZGl0aW9uc1xuICAgICAgICBpZiAocGFydGljaXBhdGlvbi5pc0Jsb2NrZWQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IGVsaWdpYmxlOiBmYWxzZSwgcmVhc29uOiBcIkJsb2NrZWQgZHVlIHRvIGV4Y2Vzc2l2ZSB2aW9sYXRpb25zXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChwYXJ0aWNpcGF0aW9uLmlzRmluaXNoZWQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IGVsaWdpYmxlOiBmYWxzZSwgcmVhc29uOiBcIllvdSBoYXZlIGFscmVhZHkgZmluaXNoZWQgdGhpcyBjb250ZXN0XCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgICAgIGlmIChub3cgPCBwYXJ0aWNpcGF0aW9uLmNvbnRlc3Quc3RhcnRUaW1lKSB7XG4gICAgICAgICAgICByZXR1cm4geyBlbGlnaWJsZTogZmFsc2UsIHJlYXNvbjogXCJDb250ZXN0IGhhcyBub3Qgc3RhcnRlZFwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobm93ID4gcGFydGljaXBhdGlvbi5jb250ZXN0LmVuZFRpbWUpIHtcbiAgICAgICAgICAgIHJldHVybiB7IGVsaWdpYmxlOiBmYWxzZSwgcmVhc29uOiBcIkNvbnRlc3QgaGFzIGVuZGVkXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBlbGlnaWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHdhcm5pbmdzOiBwYXJ0aWNpcGF0aW9uLmlzRmxhZ2dlZCA/IFtcIllvdXIgc2Vzc2lvbiBoYXMgYmVlbiBmbGFnZ2VkIGZvciByZXZpZXdcIl0gOiBbXVxuICAgICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gY2hlY2sgZWxpZ2liaWxpdHk6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgZWxpZ2libGU6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gY2hlY2sgZWxpZ2liaWxpdHlcIiB9O1xuICAgIH1cbn1cblxuLyoqXG4gKiBHZXQgcGFydGljaXBhdGlvbiBzdGF0dXMgLSBmb3IgVUkgc3RhdGVcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFBhcnRpY2lwYXRpb25TdGF0dXMoY29udGVzdElkOiBzdHJpbmcpIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIGlmICghc2Vzc2lvbj8udXNlcikgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBwYXJ0aWNpcGF0aW9uID0gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB1c2VySWRfY29udGVzdElkOiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgICBhY2NlcHRlZFJ1bGVzOiB0cnVlLFxuICAgICAgICAgICAgICAgIGlzRmluaXNoZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgaXNGbGFnZ2VkOiB0cnVlLFxuICAgICAgICAgICAgICAgIGlzQmxvY2tlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICB0b3RhbFZpb2xhdGlvbnM6IHRydWUsXG4gICAgICAgICAgICAgICAgc2Vzc2lvbklkOiB0cnVlLFxuICAgICAgICAgICAgICAgIHRlbXBCbG9ja2VkVW50aWw6IHRydWUsXG4gICAgICAgICAgICAgICAgcGVybWFuZW50bHlCbG9ja2VkOiB0cnVlXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIENoZWNrIGlmIHRlbXAgYmxvY2sgaGFzIGV4cGlyZWRcbiAgICAgICAgaWYgKHBhcnRpY2lwYXRpb24/LnRlbXBCbG9ja2VkVW50aWwgJiYgbmV3IERhdGUoKSA+IHBhcnRpY2lwYXRpb24udGVtcEJsb2NrZWRVbnRpbCkge1xuICAgICAgICAgICAgLy8gVGVtcCBibG9jayBleHBpcmVkIC0gdW5ibG9ja1xuICAgICAgICAgICAgYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLnVwZGF0ZSh7XG4gICAgICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkX2NvbnRlc3RJZDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgdXNlcklkOiBzZXNzaW9uLnVzZXIuaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWQ6IGNvbnRlc3RJZFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIGlzQmxvY2tlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBCbG9ja2VkVW50aWw6IG51bGxcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgICAgIHBhcnRpY2lwYXRpb246IHtcbiAgICAgICAgICAgICAgICAgICAgLi4ucGFydGljaXBhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgaXNCbG9ja2VkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgdGVtcEJsb2NrZWRVbnRpbDogbnVsbFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgIHBhcnRpY2lwYXRpb246IHBhcnRpY2lwYXRpb24gfHwgbnVsbFxuICAgICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZ2V0IHBhcnRpY2lwYXRpb24gc3RhdHVzXCIgfTtcbiAgICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBDT05URVNUIE1BTkFHRVIgLSBQQVJUSUNJUEFOVCBNQU5BR0VNRU5UXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqIEdldCBhbGwgcGFydGljaXBhbnRzIGZvciBhIGNvbnRlc3Qgd2l0aCB2aW9sYXRpb24gZGV0YWlscyAoZm9yIG1hbmFnZXJzKVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q29udGVzdFBhcnRpY2lwYW50cyhjb250ZXN0SWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoLmFwaS5nZXRTZXNzaW9uKHtcbiAgICAgICAgaGVhZGVyczogYXdhaXQgaGVhZGVycygpLFxuICAgIH0pO1xuXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcblxuICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gc2Vzc2lvbi51c2VyIGFzIGFueTtcblxuICAgIC8vIENoZWNrIGlmIHVzZXIgaXMgY29udGVzdCBtYW5hZ2VyL2NyZWF0b3JcbiAgICBjb25zdCBjb250ZXN0ID0gYXdhaXQgcHJpc21hLmNvbnRlc3QuZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiBjb250ZXN0SWQgfSxcbiAgICAgICAgc2VsZWN0OiB7IGNyZWF0b3JJZDogdHJ1ZSB9XG4gICAgfSk7XG5cbiAgICBpZiAoIWNvbnRlc3QpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJDb250ZXN0IG5vdCBmb3VuZFwiIH07XG5cbiAgICBjb25zdCBpc0F1dGhvcml6ZWQgPVxuICAgICAgICBjdXJyZW50VXNlci5yb2xlID09PSBcIkFETUlOXCIgfHxcbiAgICAgICAgY3VycmVudFVzZXIucm9sZSA9PT0gXCJDT05URVNUX01BTkFHRVJcIiB8fFxuICAgICAgICBjdXJyZW50VXNlci5yb2xlID09PSBcIlRFQUNIRVJcIiB8fFxuICAgICAgICBjb250ZXN0LmNyZWF0b3JJZCA9PT0gY3VycmVudFVzZXIuaWQ7XG5cbiAgICBpZiAoIWlzQXV0aG9yaXplZCkge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBwYXJ0aWNpcGFudHMgPSBhd2FpdCBwcmlzbWEuY29udGVzdFBhcnRpY2lwYXRpb24uZmluZE1hbnkoe1xuICAgICAgICAgICAgd2hlcmU6IHsgY29udGVzdElkIH0sXG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVtYWlsOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgaW1hZ2U6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgdmlvbGF0aW9uczoge1xuICAgICAgICAgICAgICAgICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogXCJkZXNjXCIgfSxcbiAgICAgICAgICAgICAgICAgICAgdGFrZTogMTBcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb3JkZXJCeTogW1xuICAgICAgICAgICAgICAgIHsgcGVybWFuZW50bHlCbG9ja2VkOiBcImRlc2NcIiB9LFxuICAgICAgICAgICAgICAgIHsgaXNCbG9ja2VkOiBcImRlc2NcIiB9LFxuICAgICAgICAgICAgICAgIHsgdG90YWxWaW9sYXRpb25zOiBcImRlc2NcIiB9XG4gICAgICAgICAgICBdXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHBhcnRpY2lwYW50cyB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gZ2V0IHBhcnRpY2lwYW50czpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGdldCBwYXJ0aWNpcGFudHNcIiB9O1xuICAgIH1cbn1cblxuLyoqXG4gKiBVbmJsb2NrIGEgcGFydGljaXBhbnQgKG1hbmFnZXIgb25seSlcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVuYmxvY2tQYXJ0aWNpcGFudChjb250ZXN0SWQ6IHN0cmluZywgdXNlcklkOiBzdHJpbmcpIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIGlmICghc2Vzc2lvbj8udXNlcikgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG5cbiAgICBjb25zdCBjdXJyZW50VXNlciA9IHNlc3Npb24udXNlciBhcyBhbnk7XG5cbiAgICAvLyBDaGVjayBhdXRob3JpemF0aW9uXG4gICAgY29uc3QgY29udGVzdCA9IGF3YWl0IHByaXNtYS5jb250ZXN0LmZpbmRVbmlxdWUoe1xuICAgICAgICB3aGVyZTogeyBpZDogY29udGVzdElkIH0sXG4gICAgICAgIHNlbGVjdDogeyBjcmVhdG9ySWQ6IHRydWUgfVxuICAgIH0pO1xuXG4gICAgaWYgKCFjb250ZXN0KSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiQ29udGVzdCBub3QgZm91bmRcIiB9O1xuXG4gICAgY29uc3QgaXNBdXRob3JpemVkID1cbiAgICAgICAgY3VycmVudFVzZXIucm9sZSA9PT0gXCJBRE1JTlwiIHx8XG4gICAgICAgIGN1cnJlbnRVc2VyLnJvbGUgPT09IFwiQ09OVEVTVF9NQU5BR0VSXCIgfHxcbiAgICAgICAgY3VycmVudFVzZXIucm9sZSA9PT0gXCJURUFDSEVSXCIgfHxcbiAgICAgICAgY29udGVzdC5jcmVhdG9ySWQgPT09IGN1cnJlbnRVc2VyLmlkO1xuXG4gICAgaWYgKCFpc0F1dGhvcml6ZWQpIHtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLnVwZGF0ZSh7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgIHVzZXJJZF9jb250ZXN0SWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgIGlzQmxvY2tlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgdGVtcEJsb2NrZWRVbnRpbDogbnVsbCxcbiAgICAgICAgICAgICAgICBwZXJtYW5lbnRseUJsb2NrZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHRvdGFsVmlvbGF0aW9uczogMCxcbiAgICAgICAgICAgICAgICB0YWJTd2l0Y2hDb3VudDogMCxcbiAgICAgICAgICAgICAgICBmdWxsc2NyZWVuRXhpdENvdW50OiAwLFxuICAgICAgICAgICAgICAgIGNvcHlQYXN0ZUNvdW50OiAwLFxuICAgICAgICAgICAgICAgIGRldlRvb2xzQ291bnQ6IDAsXG4gICAgICAgICAgICAgICAga2V5Ym9hcmRDb3VudDogMCxcbiAgICAgICAgICAgICAgICBuYXZpZ2F0aW9uQ291bnQ6IDAsXG4gICAgICAgICAgICAgICAgaXNGbGFnZ2VkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICB1bmJsb2NrZWRCeTogY3VycmVudFVzZXIuaWQsXG4gICAgICAgICAgICAgICAgdW5ibG9ja2VkQXQ6IG5ldyBEYXRlKClcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV2YWxpZGF0ZVBhdGgoYC9kYXNoYm9hcmQvY29udGVzdHMvJHtjb250ZXN0SWR9L3BhcnRpY2lwYW50c2ApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byB1bmJsb2NrIHBhcnRpY2lwYW50OlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gdW5ibG9jayBwYXJ0aWNpcGFudFwiIH07XG4gICAgfVxufVxuXG4vKipcbiAqIEdldCBkZXRhaWxlZCB2aW9sYXRpb25zIGZvciBhIHBhcnRpY2lwYW50XG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRQYXJ0aWNpcGFudFZpb2xhdGlvbnMoY29udGVzdElkOiBzdHJpbmcsIHVzZXJJZDogc3RyaW5nKSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGguYXBpLmdldFNlc3Npb24oe1xuICAgICAgICBoZWFkZXJzOiBhd2FpdCBoZWFkZXJzKCksXG4gICAgfSk7XG5cbiAgICBpZiAoIXNlc3Npb24/LnVzZXIpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuXG4gICAgY29uc3QgY3VycmVudFVzZXIgPSBzZXNzaW9uLnVzZXIgYXMgYW55O1xuXG4gICAgLy8gQ2hlY2sgYXV0aG9yaXphdGlvblxuICAgIGNvbnN0IGNvbnRlc3QgPSBhd2FpdCBwcmlzbWEuY29udGVzdC5maW5kVW5pcXVlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6IGNvbnRlc3RJZCB9LFxuICAgICAgICBzZWxlY3Q6IHsgY3JlYXRvcklkOiB0cnVlIH1cbiAgICB9KTtcblxuICAgIGlmICghY29udGVzdCkgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkNvbnRlc3Qgbm90IGZvdW5kXCIgfTtcblxuICAgIGNvbnN0IGlzQXV0aG9yaXplZCA9XG4gICAgICAgIGN1cnJlbnRVc2VyLnJvbGUgPT09IFwiQURNSU5cIiB8fFxuICAgICAgICBjdXJyZW50VXNlci5yb2xlID09PSBcIkNPTlRFU1RfTUFOQUdFUlwiIHx8XG4gICAgICAgIGN1cnJlbnRVc2VyLnJvbGUgPT09IFwiVEVBQ0hFUlwiIHx8XG4gICAgICAgIGNvbnRlc3QuY3JlYXRvcklkID09PSBjdXJyZW50VXNlci5pZDtcblxuICAgIGlmICghaXNBdXRob3JpemVkKSB7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9O1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHBhcnRpY2lwYXRpb24gPSBhd2FpdCBwcmlzbWEuY29udGVzdFBhcnRpY2lwYXRpb24uZmluZFVuaXF1ZSh7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgIHVzZXJJZF9jb250ZXN0SWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXN0SWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0OiB7IGlkOiB0cnVlLCBuYW1lOiB0cnVlLCBlbWFpbDogdHJ1ZSB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB2aW9sYXRpb25zOiB7XG4gICAgICAgICAgICAgICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiBcImRlc2NcIiB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBwYXJ0aWNpcGF0aW9uIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBnZXQgdmlvbGF0aW9uc1wiIH07XG4gICAgfVxufVxuXG4vKipcbiAqIENhbGN1bGF0ZSBjb250ZXN0IGxlYWRlcmJvYXJkXG4gKiAtIEZldGNoZXMgYWxsIHBhcnRpY2lwYXRpb25zXG4gKiAtIEZldGNoZXMgYWxsIHJlbGV2YW50IHN1Ym1pc3Npb25zXG4gKiAtIENhbGN1bGF0ZXMgc2NvcmVzXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRDb250ZXN0TGVhZGVyYm9hcmQoY29udGVzdElkOiBzdHJpbmcpIHtcbiAgICBcInVzZSBjYWNoZVwiXG4gICAgY2FjaGVUYWcoYGxlYWRlcmJvYXJkLSR7Y29udGVzdElkfWApXG4gICAgY2FjaGVMaWZlKFwibGVhZGVyYm9hcmRcIilcblxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHBhcnRpY2lwYXRpb25zID0gYXdhaXQgcHJpc21hLmNvbnRlc3RQYXJ0aWNpcGF0aW9uLmZpbmRNYW55KHtcbiAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgY29udGVzdElkLFxuICAgICAgICAgICAgICAgIC8vIHN0YXJ0ZWRBdDogeyBub3Q6IG51bGwgfSAvLyBPbmx5IHN0YXJ0ZWQgcGFydGljaXBhbnRzIChGaXggaWYgZmllbGQgZXhpc3RzLCBvdGhlcndpc2UgcmVseSBvbiBjcmVhdGVkKVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgaW1hZ2U6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgY29udGVzdCA9IGF3YWl0IHByaXNtYS5jb250ZXN0LmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IGNvbnRlc3RJZCB9LFxuICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgIHByb2JsZW1zOiB7XG4gICAgICAgICAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2JsZW06IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaWZmaWN1bHR5OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbHVnOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29yZTogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgb3JkZXJCeTogeyBvcmRlcjogXCJhc2NcIiB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoIWNvbnRlc3QpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJDb250ZXN0IG5vdCBmb3VuZFwiIH07XG5cbiAgICAgICAgY29uc3QgbGVhZGVyYm9hcmQgPSBhd2FpdCBQcm9taXNlLmFsbChwYXJ0aWNpcGF0aW9ucy5tYXAoYXN5bmMgKHApID0+IHtcbiAgICAgICAgICAgIC8vIEdldCB2YWxpZCBzdWJtaXNzaW9ucyBmb3IgdGhpcyB1c2VyIGluIHRoaXMgY29udGVzdFxuICAgICAgICAgICAgY29uc3Qgc3VibWlzc2lvbnMgPSBhd2FpdCBwcmlzbWEuc3VibWlzc2lvbi5maW5kTWFueSh7XG4gICAgICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkOiBwLnVzZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgY29udGVzdElkOiBjb250ZXN0SWQsXG4gICAgICAgICAgICAgICAgICAgIGNyZWF0ZWRBdDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgZ3RlOiBjb250ZXN0LnN0YXJ0VGltZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGx0ZTogY29udGVzdC5lbmRUaW1lXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBwcm9ibGVtSWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGNyZWF0ZWRBdDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgbGFuZ3VhZ2U6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBDYWxjdWxhdGUgdG90YWwgc2NvcmVcbiAgICAgICAgICAgIC8vIExvZ2ljOiBCZXN0IHN1Ym1pc3Npb24gcGVyIHByb2JsZW0gY291bnRzXG4gICAgICAgICAgICBjb25zdCBwcm9ibGVtU2NvcmVzID0gbmV3IE1hcDxzdHJpbmcsIG51bWJlcj4oKTtcbiAgICAgICAgICAgIGNvbnN0IHByb2JsZW1Tb2x2ZVRpbWVzID0gbmV3IE1hcDxzdHJpbmcsIERhdGU+KCk7XG4gICAgICAgICAgICBjb25zdCBwcm9ibGVtU3VibWlzc2lvbkNvdW50cyA9IG5ldyBNYXA8c3RyaW5nLCBudW1iZXI+KCk7XG4gICAgICAgICAgICBjb25zdCBwcm9ibGVtQmVzdFN1Ym1pc3Npb25zID0gbmV3IE1hcDxzdHJpbmcsIGFueT4oKTtcblxuICAgICAgICAgICAgc3VibWlzc2lvbnMuZm9yRWFjaChzdWIgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRDb3VudCA9IHByb2JsZW1TdWJtaXNzaW9uQ291bnRzLmdldChzdWIucHJvYmxlbUlkKSB8fCAwO1xuICAgICAgICAgICAgICAgIHByb2JsZW1TdWJtaXNzaW9uQ291bnRzLnNldChzdWIucHJvYmxlbUlkLCBjdXJyZW50Q291bnQgKyAxKTtcblxuICAgICAgICAgICAgICAgIGlmIChzdWIuc3RhdHVzID09PSBcIkFDQ0VQVEVEXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudEJlc3QgPSBwcm9ibGVtU2NvcmVzLmdldChzdWIucHJvYmxlbUlkKSB8fCAwO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBwcm9ibGVtRGVmID0gY29udGVzdC5wcm9ibGVtcy5maW5kKGNwID0+IGNwLnByb2JsZW1JZCA9PT0gc3ViLnByb2JsZW1JZCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG1heFNjb3JlID0gcHJvYmxlbURlZj8ucHJvYmxlbS5zY29yZSB8fCAwO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChtYXhTY29yZSA+IGN1cnJlbnRCZXN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgcHJvYmxlbVNjb3Jlcy5zZXQoc3ViLnByb2JsZW1JZCwgbWF4U2NvcmUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRCZXN0VGltZSA9IHByb2JsZW1Tb2x2ZVRpbWVzLmdldChzdWIucHJvYmxlbUlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWN1cnJlbnRCZXN0VGltZSB8fCBzdWIuY3JlYXRlZEF0IDwgY3VycmVudEJlc3RUaW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2JsZW1Tb2x2ZVRpbWVzLnNldChzdWIucHJvYmxlbUlkLCBzdWIuY3JlYXRlZEF0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvYmxlbUJlc3RTdWJtaXNzaW9ucy5zZXQoc3ViLnByb2JsZW1JZCwgc3ViKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgbGV0IHRvdGFsU2NvcmUgPSAwO1xuICAgICAgICAgICAgbGV0IHRvdGFsVGltZU1zID0gMDtcblxuICAgICAgICAgICAgcHJvYmxlbVNjb3Jlcy5mb3JFYWNoKChzY29yZSwgcHJvYmxlbUlkKSA9PiB7XG4gICAgICAgICAgICAgICAgdG90YWxTY29yZSArPSBzY29yZTtcbiAgICAgICAgICAgICAgICBjb25zdCBzb2x2ZW50VGltZSA9IHByb2JsZW1Tb2x2ZVRpbWVzLmdldChwcm9ibGVtSWQpO1xuICAgICAgICAgICAgICAgIGlmIChzb2x2ZW50VGltZSkge1xuICAgICAgICAgICAgICAgICAgICB0b3RhbFRpbWVNcyArPSAoc29sdmVudFRpbWUuZ2V0VGltZSgpIC0gY29udGVzdC5zdGFydFRpbWUuZ2V0VGltZSgpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gTWFwIHN0YXRzIGZvciBlYWNoIHByb2JsZW0gaW4gdGhlIGNvbnRlc3RcbiAgICAgICAgICAgIGNvbnN0IHByb2JsZW1TdGF0cyA9IGNvbnRlc3QucHJvYmxlbXMubWFwKGNwID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBiZXN0U3ViID0gcHJvYmxlbUJlc3RTdWJtaXNzaW9ucy5nZXQoY3AucHJvYmxlbUlkKTtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBwcm9ibGVtSWQ6IGNwLnByb2JsZW1JZCxcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IGNwLnByb2JsZW0udGl0bGUsXG4gICAgICAgICAgICAgICAgICAgIHNsdWc6IGNwLnByb2JsZW0uc2x1ZyxcbiAgICAgICAgICAgICAgICAgICAgc2NvcmU6IHByb2JsZW1TY29yZXMuZ2V0KGNwLnByb2JsZW1JZCkgfHwgMCxcbiAgICAgICAgICAgICAgICAgICAgbWF4U2NvcmU6IGNwLnByb2JsZW0uc2NvcmUsXG4gICAgICAgICAgICAgICAgICAgIHN1Ym1pc3Npb25zOiBwcm9ibGVtU3VibWlzc2lvbkNvdW50cy5nZXQoY3AucHJvYmxlbUlkKSB8fCAwLFxuICAgICAgICAgICAgICAgICAgICBzb2x2ZWQ6IHByb2JsZW1TY29yZXMuaGFzKGNwLnByb2JsZW1JZCksXG4gICAgICAgICAgICAgICAgICAgIHNvbHZlZEF0OiBwcm9ibGVtU29sdmVUaW1lcy5nZXQoY3AucHJvYmxlbUlkKSxcbiAgICAgICAgICAgICAgICAgICAgbGFuZ3VhZ2U6IGJlc3RTdWI/Lmxhbmd1YWdlPy5uYW1lIHx8IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIGxhbmd1YWdlSWQ6IGJlc3RTdWI/Lmxhbmd1YWdlPy5pZCB8fCBudWxsXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnAudXNlcixcbiAgICAgICAgICAgICAgICBzY29yZTogdG90YWxTY29yZSxcbiAgICAgICAgICAgICAgICB0aW1lVGFrZW46IHRvdGFsVGltZU1zLFxuICAgICAgICAgICAgICAgIHByb2JsZW1zU29sdmVkOiBwcm9ibGVtU2NvcmVzLnNpemUsXG4gICAgICAgICAgICAgICAgcHJvYmxlbVN0YXRzXG4gICAgICAgICAgICB9O1xuICAgICAgICB9KSk7XG5cbiAgICAgICAgLy8gU29ydDogSGlnaCBzY29yZSBmaXJzdCwgdGhlbiBsb3cgdGltZSB0YWtlblxuICAgICAgICBsZWFkZXJib2FyZC5zb3J0KChhLCBiKSA9PiB7XG4gICAgICAgICAgICBpZiAoYi5zY29yZSAhPT0gYS5zY29yZSkgcmV0dXJuIGIuc2NvcmUgLSBhLnNjb3JlO1xuICAgICAgICAgICAgcmV0dXJuIGEudGltZVRha2VuIC0gYi50aW1lVGFrZW47XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgc3R1ZGVudHM6IGxlYWRlcmJvYXJkLFxuICAgICAgICAgICAgaXNGaW5hbGl6ZWQ6IGNvbnRlc3QuaXNGaW5hbGl6ZWQsXG4gICAgICAgICAgICBwcm9ibGVtczogY29udGVzdC5wcm9ibGVtcy5tYXAoY3AgPT4gKHtcbiAgICAgICAgICAgICAgICBpZDogY3AucHJvYmxlbUlkLFxuICAgICAgICAgICAgICAgIHRpdGxlOiBjcC5wcm9ibGVtLnRpdGxlLFxuICAgICAgICAgICAgICAgIHNsdWc6IGNwLnByb2JsZW0uc2x1ZyxcbiAgICAgICAgICAgICAgICBtYXhTY29yZTogY3AucHJvYmxlbS5zY29yZVxuICAgICAgICAgICAgfSkpXG4gICAgICAgIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiTGVhZGVyYm9hcmQgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byBnZW5lcmF0ZSBsZWFkZXJib2FyZFwiIH07XG4gICAgfVxufVxuXG4vKipcbiAqIEdldCBjdXJyZW50IHVzZXIncyByYW5raW5nIGluIGEgY29udGVzdFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q29udGVzdFJhbmtpbmcoY29udGVzdElkOiBzdHJpbmcpIHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aC5hcGkuZ2V0U2Vzc2lvbih7XG4gICAgICAgIGhlYWRlcnM6IGF3YWl0IGhlYWRlcnMoKSxcbiAgICB9KTtcblxuICAgIGlmICghc2Vzc2lvbj8udXNlcikgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH07XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBnZXRDb250ZXN0TGVhZGVyYm9hcmQoY29udGVzdElkKTtcblxuICAgICAgICBpZiAoIXJlc3VsdC5zdWNjZXNzIHx8ICFyZXN1bHQuc3R1ZGVudHMpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJGYWlsZWQgdG8gZ2V0IHJhbmtpbmdcIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgcmFuayA9IHJlc3VsdC5zdHVkZW50cy5maW5kSW5kZXgoKHM6IGFueSkgPT4gcy5pZCA9PT0gc2Vzc2lvbi51c2VyLmlkKSArIDE7XG5cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgcmFuazogcmFuayA+IDAgPyByYW5rIDogbnVsbCB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGdldCByYW5raW5nXCIgfTtcbiAgICB9XG59XG4iXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IitSQTZkc0IifQ==
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/components/contest/ContestDetails.tsx [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "default",
    ()=>ContestDetails
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/jsx-dev-runtime.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/index.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$chevron$2d$right$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__ChevronRight$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/chevron-right.js [app-client] (ecmascript) <export default as ChevronRight>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$lock$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Lock$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/lock.js [app-client] (ecmascript) <export default as Lock>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$chevron$2d$left$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__ChevronLeft$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/chevron-left.js [app-client] (ecmascript) <export default as ChevronLeft>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$circle$2d$check$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__CheckCircle2$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/circle-check.js [app-client] (ecmascript) <export default as CheckCircle2>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$shield$2d$alert$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__ShieldAlert$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/shield-alert.js [app-client] (ecmascript) <export default as ShieldAlert>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/sonner/dist/index.mjs [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$client$2f$app$2d$dir$2f$link$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/client/app-dir/link.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$navigation$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/navigation.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$components$2f$contest$2f$ContestEntryModal$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/components/contest/ContestEntryModal.tsx [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$components$2f$contest$2f$ContestProtection$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/components/contest/ContestProtection.tsx [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$components$2f$contest$2f$ContestNavigationGuard$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/components/contest/ContestNavigationGuard.tsx [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$actions$2f$data$3a$445697__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__ = __turbopack_context__.i("[project]/actions/data:445697 [app-client] (ecmascript) <text/javascript>");
;
var _s = __turbopack_context__.k.signature();
"use client";
;
;
;
;
;
;
;
;
;
const PROBLEMS_PER_PAGE = 20;
function ContestDetails({ contest, user }) {
    _s();
    const router = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$navigation$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRouter"])();
    const [timeLeft, setTimeLeft] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])("");
    const [currentPage, setCurrentPage] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(1);
    const [showRulesPopup, setShowRulesPopup] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(false);
    const [hasAcceptedRules, setHasAcceptedRules] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(contest.hasAcceptedRules || false);
    const [isSubmittingContest, setIsSubmittingContest] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(false);
    const isFinished = contest.isFinished || false;
    // Protection State
    const [sessionId, setSessionId] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(contest.sessionId || null);
    // DEBUG: Log protection conditions
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "ContestDetails.useEffect": ()=>{
            console.log('[ContestProtection Debug]', {
                hasAcceptedRules,
                sessionId,
                isFinished,
                willRenderProtection: hasAcceptedRules && sessionId && !isFinished
            });
        }
    }["ContestDetails.useEffect"], [
        hasAcceptedRules,
        sessionId,
        isFinished,
        contest.canManage
    ]);
    const now = new Date();
    const startTime = new Date(contest.startTime);
    const endTime = new Date(contest.endTime);
    const hasStarted = now >= startTime;
    const hasEnded = now > endTime;
    const [showEndModal, setShowEndModal] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(false);
    const [endConfirmText, setEndConfirmText] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])("");
    const handleContestFinish = ()=>{
        setShowEndModal(true);
    };
    const confirmEndContest = async ()=>{
        if (endConfirmText.toLowerCase() !== "end") {
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error("Please type 'end' to confirm");
            return;
        }
        setIsSubmittingContest(true);
        try {
            const res = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$actions$2f$data$3a$445697__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__["finishContestAction"])(contest.id);
            if (res.success) {
                __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].success("Contest submitted successfully!");
                router.push("/");
            } else {
                __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error("Failed to submit contest");
                setIsSubmittingContest(false);
            }
        } catch (error) {
            console.error(error);
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error("Something went wrong");
            setIsSubmittingContest(false);
        }
        setShowEndModal(false);
    };
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "ContestDetails.useEffect": ()=>{
            if (isFinished) return;
            const accepted = localStorage.getItem(`contest-rules-${contest.id}`);
            // If we have local storage record AND the server says we accepted rules (or we rely on server only)
            // But let's trust server state 'hasAcceptedRules' primarily if available
            if (hasAcceptedRules) {
                if (hasStarted && !hasEnded) {
                // Already started logic
                }
            } else if (hasStarted && !hasEnded) {
                setShowRulesPopup(true);
            }
        }
    }["ContestDetails.useEffect"], [
        contest.id,
        hasStarted,
        hasEnded,
        hasAcceptedRules,
        isFinished
    ]);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "ContestDetails.useEffect": ()=>{
            const timer = setInterval({
                "ContestDetails.useEffect.timer": ()=>{
                    const now = new Date();
                    const target = hasStarted ? endTime : startTime;
                    const diff = target.getTime() - now.getTime();
                    if (diff <= 0) {
                        setTimeLeft(hasStarted ? "Contest Ended" : "Starting Now");
                        clearInterval(timer);
                        return;
                    }
                    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                    const hours = Math.floor(diff % (1000 * 60 * 60 * 24) / (1000 * 60 * 60));
                    const minutes = Math.floor(diff % (1000 * 60 * 60) / (1000 * 60));
                    const seconds = Math.floor(diff % (1000 * 60) / 1000);
                    setTimeLeft(`${days > 0 ? `${days}d ` : ""}${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`);
                }
            }["ContestDetails.useEffect.timer"], 1000);
            return ({
                "ContestDetails.useEffect": ()=>clearInterval(timer)
            })["ContestDetails.useEffect"];
        }
    }["ContestDetails.useEffect"], [
        hasStarted,
        startTime,
        endTime
    ]);
    const handleContestStart = (newSessionId)=>{
        localStorage.setItem(`contest-rules-${contest.id}`, "true");
        setHasAcceptedRules(true);
        setShowRulesPopup(false);
        setSessionId(newSessionId);
        // Reload page to refresh questions (if shuffled) or unlock content
        window.location.reload();
    };
    const totalPages = Math.ceil(contest.problems.length / PROBLEMS_PER_PAGE);
    const startIndex = (currentPage - 1) * PROBLEMS_PER_PAGE;
    const endIndex = startIndex + PROBLEMS_PER_PAGE;
    const currentProblems = contest.problems.slice(startIndex, endIndex);
    const getStatusBadge = ()=>{
        if (isFinished) {
            return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                className: "px-2.5 py-0.5 rounded-full text-xs font-medium bg-emerald-100 dark:bg-emerald-500/20 text-emerald-700 dark:text-emerald-400",
                children: "Completed"
            }, void 0, false, {
                fileName: "[project]/components/contest/ContestDetails.tsx",
                lineNumber: 134,
                columnNumber: 20
            }, this);
        }
        if (hasEnded) {
            return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                className: "px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 dark:bg-gray-500/20 text-gray-700 dark:text-gray-400",
                children: "Ended"
            }, void 0, false, {
                fileName: "[project]/components/contest/ContestDetails.tsx",
                lineNumber: 137,
                columnNumber: 20
            }, this);
        }
        if (hasStarted) {
            return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                className: "px-2.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 dark:bg-orange-500/20 text-orange-700 dark:text-orange-400",
                children: "Live"
            }, void 0, false, {
                fileName: "[project]/components/contest/ContestDetails.tsx",
                lineNumber: 140,
                columnNumber: 20
            }, this);
        }
        return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
            className: "px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 dark:bg-blue-500/20 text-blue-700 dark:text-blue-400",
            children: "Upcoming"
        }, void 0, false, {
            fileName: "[project]/components/contest/ContestDetails.tsx",
            lineNumber: 142,
            columnNumber: 16
        }, this);
    };
    const getDifficultyColor = (difficulty)=>{
        switch(difficulty){
            case "EASY":
                return "bg-emerald-100 dark:bg-emerald-500/20 text-emerald-700 dark:text-emerald-400";
            case "MEDIUM":
                return "bg-orange-100 dark:bg-orange-500/20 text-orange-700 dark:text-orange-400";
            case "HARD":
                return "bg-red-100 dark:bg-red-500/20 text-red-700 dark:text-red-400";
            default:
                return "bg-gray-100 dark:bg-gray-500/20 text-gray-700 dark:text-gray-400";
        }
    };
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Fragment"], {
        children: [
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$components$2f$contest$2f$ContestEntryModal$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["default"], {
                contestId: contest.id,
                contestTitle: contest.title,
                requiresPassword: contest.requiresPassword,
                isOpen: showRulesPopup,
                onClose: ()=>setShowRulesPopup(false),
                onStart: handleContestStart
            }, void 0, false, {
                fileName: "[project]/components/contest/ContestDetails.tsx",
                lineNumber: 156,
                columnNumber: 13
            }, this),
            hasAcceptedRules && sessionId && !isFinished && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Fragment"], {
                children: [
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$components$2f$contest$2f$ContestProtection$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["default"], {
                        contestId: contest.id,
                        sessionId: sessionId,
                        paused: isSubmittingContest || showEndModal
                    }, void 0, false, {
                        fileName: "[project]/components/contest/ContestDetails.tsx",
                        lineNumber: 168,
                        columnNumber: 21
                    }, this),
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$components$2f$contest$2f$ContestNavigationGuard$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["default"], {
                        contestId: contest.id,
                        allowedPaths: [
                            `/problems/`,
                            `/contest/${contest.id}`
                        ]
                    }, void 0, false, {
                        fileName: "[project]/components/contest/ContestDetails.tsx",
                        lineNumber: 173,
                        columnNumber: 21
                    }, this)
                ]
            }, void 0, true),
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "min-h-screen bg-white dark:bg-[#0a0a0a] py-8",
                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                    className: "w-full max-w-7xl mx-auto px-4 md:px-6",
                    children: [
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "mb-8",
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "flex items-center gap-2 mb-3",
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                            className: "px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 dark:bg-[#262626] text-gray-700 dark:text-gray-300",
                                            children: contest.visibility
                                        }, void 0, false, {
                                            fileName: "[project]/components/contest/ContestDetails.tsx",
                                            lineNumber: 188,
                                            columnNumber: 29
                                        }, this),
                                        getStatusBadge()
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                    lineNumber: 187,
                                    columnNumber: 25
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("h1", {
                                    className: "text-3xl font-bold text-gray-900 dark:text-gray-100 mb-2",
                                    children: contest.title
                                }, void 0, false, {
                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                    lineNumber: 194,
                                    columnNumber: 25
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                    className: "text-gray-600 dark:text-gray-400",
                                    children: contest.description || "Test your skills in this competitive programming arena."
                                }, void 0, false, {
                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                    lineNumber: 198,
                                    columnNumber: 25
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/components/contest/ContestDetails.tsx",
                            lineNumber: 186,
                            columnNumber: 21
                        }, this),
                        isFinished && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "mb-8 p-6 bg-emerald-50 dark:bg-emerald-500/10 border border-emerald-100 dark:border-emerald-500/20 rounded-2xl flex items-center gap-4",
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "w-12 h-12 bg-emerald-100 dark:bg-emerald-500/20 rounded-xl flex items-center justify-center shrink-0",
                                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$circle$2d$check$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__CheckCircle2$3e$__["CheckCircle2"], {
                                        className: "w-6 h-6 text-emerald-600 dark:text-emerald-400"
                                    }, void 0, false, {
                                        fileName: "[project]/components/contest/ContestDetails.tsx",
                                        lineNumber: 206,
                                        columnNumber: 33
                                    }, this)
                                }, void 0, false, {
                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                    lineNumber: 205,
                                    columnNumber: 29
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("h3", {
                                            className: "text-lg font-bold text-emerald-900 dark:text-emerald-400",
                                            children: "Contest Session Completed"
                                        }, void 0, false, {
                                            fileName: "[project]/components/contest/ContestDetails.tsx",
                                            lineNumber: 209,
                                            columnNumber: 33
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                            className: "text-emerald-700 dark:text-emerald-500 text-sm",
                                            children: "You have successfully ended your session. Your submissions have been recorded and you can view the final standings once the contest ends."
                                        }, void 0, false, {
                                            fileName: "[project]/components/contest/ContestDetails.tsx",
                                            lineNumber: 210,
                                            columnNumber: 33
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                    lineNumber: 208,
                                    columnNumber: 29
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/components/contest/ContestDetails.tsx",
                            lineNumber: 204,
                            columnNumber: 25
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "flex flex-wrap items-center gap-6 mb-6 pb-6 border-b border-gray-200 dark:border-[#262626] text-sm",
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                            className: "text-gray-500 dark:text-gray-400",
                                            children: "Start:"
                                        }, void 0, false, {
                                            fileName: "[project]/components/contest/ContestDetails.tsx",
                                            lineNumber: 220,
                                            columnNumber: 29
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                            className: "ml-2 text-gray-900 dark:text-gray-100 font-medium",
                                            children: startTime.toLocaleString()
                                        }, void 0, false, {
                                            fileName: "[project]/components/contest/ContestDetails.tsx",
                                            lineNumber: 221,
                                            columnNumber: 29
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                    lineNumber: 219,
                                    columnNumber: 25
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                            className: "text-gray-500 dark:text-gray-400",
                                            children: "End:"
                                        }, void 0, false, {
                                            fileName: "[project]/components/contest/ContestDetails.tsx",
                                            lineNumber: 224,
                                            columnNumber: 29
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                            className: "ml-2 text-gray-900 dark:text-gray-100 font-medium",
                                            children: endTime.toLocaleString()
                                        }, void 0, false, {
                                            fileName: "[project]/components/contest/ContestDetails.tsx",
                                            lineNumber: 225,
                                            columnNumber: 29
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                    lineNumber: 223,
                                    columnNumber: 25
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                            className: "text-gray-500 dark:text-gray-400",
                                            children: "Problems:"
                                        }, void 0, false, {
                                            fileName: "[project]/components/contest/ContestDetails.tsx",
                                            lineNumber: 228,
                                            columnNumber: 29
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                            className: "ml-2 text-gray-900 dark:text-gray-100 font-medium",
                                            children: contest._count.problems
                                        }, void 0, false, {
                                            fileName: "[project]/components/contest/ContestDetails.tsx",
                                            lineNumber: 229,
                                            columnNumber: 29
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                    lineNumber: 227,
                                    columnNumber: 25
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                            className: "text-gray-500 dark:text-gray-400",
                                            children: "Time:"
                                        }, void 0, false, {
                                            fileName: "[project]/components/contest/ContestDetails.tsx",
                                            lineNumber: 232,
                                            columnNumber: 29
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                            className: "ml-2 text-gray-900 dark:text-gray-100 font-medium font-mono",
                                            children: timeLeft
                                        }, void 0, false, {
                                            fileName: "[project]/components/contest/ContestDetails.tsx",
                                            lineNumber: 233,
                                            columnNumber: 29
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                    lineNumber: 231,
                                    columnNumber: 25
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "ml-auto flex gap-2",
                                    children: [
                                        hasAcceptedRules && hasStarted && !hasEnded && !isFinished && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                            onClick: handleContestFinish,
                                            className: "px-4 py-2 bg-red-600 text-white rounded text-sm font-medium hover:bg-red-700 transition-colors flex items-center gap-2 shadow-lg shadow-red-500/20",
                                            children: [
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$circle$2d$check$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__CheckCircle2$3e$__["CheckCircle2"], {
                                                    className: "w-4 h-4"
                                                }, void 0, false, {
                                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                                    lineNumber: 244,
                                                    columnNumber: 37
                                                }, this),
                                                "End Contest"
                                            ]
                                        }, void 0, true, {
                                            fileName: "[project]/components/contest/ContestDetails.tsx",
                                            lineNumber: 240,
                                            columnNumber: 33
                                        }, this),
                                        hasEnded && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$client$2f$app$2d$dir$2f$link$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["default"], {
                                            href: `/contest/${contest.id}/standings`,
                                            className: "px-4 py-2 bg-orange-600 text-white rounded text-sm font-medium hover:bg-orange-700 transition-colors shadow-lg shadow-orange-500/20",
                                            children: "Leaderboard"
                                        }, void 0, false, {
                                            fileName: "[project]/components/contest/ContestDetails.tsx",
                                            lineNumber: 250,
                                            columnNumber: 33
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                    lineNumber: 237,
                                    columnNumber: 25
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/components/contest/ContestDetails.tsx",
                            lineNumber: 218,
                            columnNumber: 21
                        }, this),
                        !hasStarted && !contest.canManage ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "text-center py-20 border border-gray-200 dark:border-[#262626] rounded-lg bg-white dark:bg-[#141414]",
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$lock$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Lock$3e$__["Lock"], {
                                    className: "w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-4"
                                }, void 0, false, {
                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                    lineNumber: 262,
                                    columnNumber: 29
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("h3", {
                                    className: "text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2",
                                    children: "Problems Locked"
                                }, void 0, false, {
                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                    lineNumber: 263,
                                    columnNumber: 29
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                    className: "text-gray-500 dark:text-gray-400",
                                    children: "Problems will be revealed when the contest starts."
                                }, void 0, false, {
                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                    lineNumber: 264,
                                    columnNumber: 29
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/components/contest/ContestDetails.tsx",
                            lineNumber: 261,
                            columnNumber: 25
                        }, this) : /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["Fragment"], {
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "grid grid-cols-12 gap-4 px-6 py-4 border-b border-gray-100 dark:border-[#262626] text-[11px] font-bold text-gray-400 uppercase tracking-widest",
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "col-span-1",
                                            children: "#"
                                        }, void 0, false, {
                                            fileName: "[project]/components/contest/ContestDetails.tsx",
                                            lineNumber: 272,
                                            columnNumber: 33
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "col-span-6 md:col-span-7",
                                            children: "Title"
                                        }, void 0, false, {
                                            fileName: "[project]/components/contest/ContestDetails.tsx",
                                            lineNumber: 273,
                                            columnNumber: 33
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "col-span-3 md:col-span-2",
                                            children: "Difficulty"
                                        }, void 0, false, {
                                            fileName: "[project]/components/contest/ContestDetails.tsx",
                                            lineNumber: 274,
                                            columnNumber: 33
                                        }, this),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                            className: "col-span-2 md:col-span-2",
                                            children: "Status"
                                        }, void 0, false, {
                                            fileName: "[project]/components/contest/ContestDetails.tsx",
                                            lineNumber: 275,
                                            columnNumber: 33
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                    lineNumber: 271,
                                    columnNumber: 29
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "mt-2",
                                    children: currentProblems.map((cp, index)=>{
                                        const globalIndex = startIndex + index;
                                        const canAccess = (hasAcceptedRules || contest.canManage || !hasStarted || hasEnded) && (!isFinished || contest.canManage);
                                        const isSolved = cp.isSolved; // Access the property we added
                                        // If problem is solved, block access (even for managers during testing/consistency)
                                        const isBlockedByCompletion = isSolved;
                                        return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$client$2f$app$2d$dir$2f$link$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["default"], {
                                            href: canAccess && (hasStarted || contest.canManage) && !isBlockedByCompletion ? `/problems/${cp.problem.slug}?contestId=${contest.id}` : "#",
                                            onClick: (e)=>{
                                                if (isFinished && !contest.canManage) {
                                                    e.preventDefault();
                                                    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].error("Contest session ended", {
                                                        description: "You have already completed this contest."
                                                    });
                                                    return;
                                                }
                                                // Prevent re-attempting solved problems
                                                if (isBlockedByCompletion) {
                                                    e.preventDefault();
                                                    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$sonner$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["toast"].success("Problem Solved!", {
                                                        description: "You have already completed this challenge. Great job!"
                                                    });
                                                    return;
                                                }
                                                if (!canAccess && hasStarted && !hasEnded) {
                                                    e.preventDefault();
                                                    setShowRulesPopup(true);
                                                }
                                            },
                                            className: `grid grid-cols-12 gap-4 px-6 py-4 rounded-xl items-center transition-all duration-200 ${canAccess && (hasStarted || contest.canManage) && !isBlockedByCompletion ? "hover:bg-gray-50/50 dark:hover:bg-[#1a1a1a] cursor-pointer" : isSolved ? "opacity-75 bg-emerald-50/30 dark:bg-emerald-500/5 cursor-not-allowed" : "opacity-50 cursor-not-allowed"}`,
                                            children: [
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                    className: "col-span-1 text-sm text-gray-500 dark:text-gray-400 font-medium",
                                                    children: globalIndex + 1
                                                }, void 0, false, {
                                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                                    lineNumber: 319,
                                                    columnNumber: 45
                                                }, this),
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                    className: "col-span-6 md:col-span-7 font-medium text-gray-900 dark:text-gray-100 flex items-center gap-2",
                                                    children: [
                                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                            className: `truncate ${canAccess && !isBlockedByCompletion ? "hover:text-orange-600 transition-colors" : ""}`,
                                                            children: cp.problem.title
                                                        }, void 0, false, {
                                                            fileName: "[project]/components/contest/ContestDetails.tsx",
                                                            lineNumber: 323,
                                                            columnNumber: 49
                                                        }, this),
                                                        isSolved && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                            className: "px-2 py-0.5 rounded-full bg-emerald-100 dark:bg-emerald-500/20 text-emerald-700 dark:text-emerald-400 text-[10px] font-bold uppercase tracking-wider flex items-center gap-1",
                                                            children: [
                                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$circle$2d$check$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__CheckCircle2$3e$__["CheckCircle2"], {
                                                                    className: "w-3 h-3"
                                                                }, void 0, false, {
                                                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                                                    lineNumber: 328,
                                                                    columnNumber: 57
                                                                }, this),
                                                                "Solved"
                                                            ]
                                                        }, void 0, true, {
                                                            fileName: "[project]/components/contest/ContestDetails.tsx",
                                                            lineNumber: 327,
                                                            columnNumber: 54
                                                        }, this)
                                                    ]
                                                }, void 0, true, {
                                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                                    lineNumber: 322,
                                                    columnNumber: 45
                                                }, this),
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                    className: "col-span-3 md:col-span-2",
                                                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                                        className: `px-2.5 py-0.5 rounded-full text-xs font-medium ${getDifficultyColor(cp.problem.difficulty)}`,
                                                        children: cp.problem.difficulty === "MEDIUM" ? "Med." : cp.problem.difficulty.charAt(0) + cp.problem.difficulty.slice(1).toLowerCase()
                                                    }, void 0, false, {
                                                        fileName: "[project]/components/contest/ContestDetails.tsx",
                                                        lineNumber: 334,
                                                        columnNumber: 49
                                                    }, this)
                                                }, void 0, false, {
                                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                                    lineNumber: 333,
                                                    columnNumber: 45
                                                }, this),
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                                    className: "col-span-2 md:col-span-2 text-sm text-gray-500 dark:text-gray-400",
                                                    children: isSolved ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$circle$2d$check$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__CheckCircle2$3e$__["CheckCircle2"], {
                                                        className: "w-5 h-5 text-emerald-500"
                                                    }, void 0, false, {
                                                        fileName: "[project]/components/contest/ContestDetails.tsx",
                                                        lineNumber: 340,
                                                        columnNumber: 54
                                                    }, this) : canAccess && (hasStarted || contest.canManage) ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$chevron$2d$right$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__ChevronRight$3e$__["ChevronRight"], {
                                                        className: "w-5 h-5 text-gray-400"
                                                    }, void 0, false, {
                                                        fileName: "[project]/components/contest/ContestDetails.tsx",
                                                        lineNumber: 342,
                                                        columnNumber: 53
                                                    }, this) : /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$lock$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Lock$3e$__["Lock"], {
                                                        className: "w-4 h-4 text-gray-400"
                                                    }, void 0, false, {
                                                        fileName: "[project]/components/contest/ContestDetails.tsx",
                                                        lineNumber: 344,
                                                        columnNumber: 53
                                                    }, this)
                                                }, void 0, false, {
                                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                                    lineNumber: 338,
                                                    columnNumber: 45
                                                }, this)
                                            ]
                                        }, cp.problem.id, true, {
                                            fileName: "[project]/components/contest/ContestDetails.tsx",
                                            lineNumber: 289,
                                            columnNumber: 41
                                        }, this);
                                    })
                                }, void 0, false, {
                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                    lineNumber: 279,
                                    columnNumber: 29
                                }, this),
                                totalPages > 1 && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                                    className: "flex items-center justify-center gap-2 mt-12 mb-8",
                                    children: [
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                            onClick: ()=>setCurrentPage((p)=>Math.max(1, p - 1)),
                                            disabled: currentPage === 1,
                                            className: `p-2 border border-gray-200 dark:border-[#262626] rounded transition-colors ${currentPage === 1 ? "text-gray-300 dark:text-gray-600 cursor-not-allowed" : "text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-[#1a1a1a]"}`,
                                            children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$chevron$2d$left$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__ChevronLeft$3e$__["ChevronLeft"], {
                                                className: "w-4 h-4"
                                            }, void 0, false, {
                                                fileName: "[project]/components/contest/ContestDetails.tsx",
                                                lineNumber: 363,
                                                columnNumber: 41
                                            }, this)
                                        }, void 0, false, {
                                            fileName: "[project]/components/contest/ContestDetails.tsx",
                                            lineNumber: 355,
                                            columnNumber: 37
                                        }, this),
                                        Array.from({
                                            length: totalPages
                                        }, (_, i)=>i + 1).map((page)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                                onClick: ()=>setCurrentPage(page),
                                                className: `w-9 h-9 rounded text-sm font-medium transition-colors ${currentPage === page ? "bg-orange-600 text-white" : "border border-gray-200 dark:border-[#262626] text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-[#1a1a1a]"}`,
                                                children: page
                                            }, page, false, {
                                                fileName: "[project]/components/contest/ContestDetails.tsx",
                                                lineNumber: 367,
                                                columnNumber: 41
                                            }, this)),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                            onClick: ()=>setCurrentPage((p)=>Math.min(totalPages, p + 1)),
                                            disabled: currentPage === totalPages,
                                            className: `p-2 border border-gray-200 dark:border-[#262626] rounded transition-colors ${currentPage === totalPages ? "text-gray-300 dark:text-gray-600 cursor-not-allowed" : "text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-[#1a1a1a]"}`,
                                            children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$chevron$2d$right$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__ChevronRight$3e$__["ChevronRight"], {
                                                className: "w-4 h-4"
                                            }, void 0, false, {
                                                fileName: "[project]/components/contest/ContestDetails.tsx",
                                                lineNumber: 387,
                                                columnNumber: 41
                                            }, this)
                                        }, void 0, false, {
                                            fileName: "[project]/components/contest/ContestDetails.tsx",
                                            lineNumber: 379,
                                            columnNumber: 37
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                    lineNumber: 354,
                                    columnNumber: 33
                                }, this)
                            ]
                        }, void 0, true)
                    ]
                }, void 0, true, {
                    fileName: "[project]/components/contest/ContestDetails.tsx",
                    lineNumber: 184,
                    columnNumber: 17
                }, this)
            }, void 0, false, {
                fileName: "[project]/components/contest/ContestDetails.tsx",
                lineNumber: 183,
                columnNumber: 13
            }, this),
            showEndModal && /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",
                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                    className: "bg-white dark:bg-[#141414] rounded-xl shadow-2xl w-full max-w-md p-6 border border-gray-100 dark:border-[#262626] transform scale-100 transition-all",
                    children: [
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "flex items-center gap-3 mb-4 text-red-600 dark:text-red-400",
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$shield$2d$alert$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__ShieldAlert$3e$__["ShieldAlert"], {
                                    className: "w-8 h-8"
                                }, void 0, false, {
                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                    lineNumber: 401,
                                    columnNumber: 29
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("h3", {
                                    className: "text-xl font-bold text-gray-900 dark:text-gray-100",
                                    children: "End Contest Session?"
                                }, void 0, false, {
                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                    lineNumber: 402,
                                    columnNumber: 29
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/components/contest/ContestDetails.tsx",
                            lineNumber: 400,
                            columnNumber: 25
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                            className: "text-gray-600 dark:text-gray-400 mb-6",
                            children: [
                                "Are you sure you want to end your session? You will ",
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("strong", {
                                    children: "NOT"
                                }, void 0, false, {
                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                    lineNumber: 406,
                                    columnNumber: 81
                                }, this),
                                " be able to re-enter or solve more problems after this.",
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("br", {}, void 0, false, {
                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                    lineNumber: 407,
                                    columnNumber: 29
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("br", {}, void 0, false, {
                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                    lineNumber: 407,
                                    columnNumber: 35
                                }, this),
                                "Type ",
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                                    className: "font-mono font-bold text-red-600 dark:text-red-400",
                                    children: "end"
                                }, void 0, false, {
                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                    lineNumber: 408,
                                    columnNumber: 34
                                }, this),
                                " below to confirm."
                            ]
                        }, void 0, true, {
                            fileName: "[project]/components/contest/ContestDetails.tsx",
                            lineNumber: 405,
                            columnNumber: 25
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("input", {
                            type: "text",
                            placeholder: "Type 'end' to confirm",
                            value: endConfirmText,
                            onChange: (e)=>setEndConfirmText(e.target.value),
                            className: "w-full px-4 py-3 border border-gray-200 dark:border-[#262626] rounded-lg mb-6 bg-gray-50 dark:bg-[#1a1a1a] focus:bg-white dark:focus:bg-[#0a0a0a] focus:ring-2 focus:ring-red-500/20 focus:border-red-500 outline-none transition-all font-mono text-center uppercase tracking-widest placeholder:normal-case placeholder:tracking-normal text-gray-900 dark:text-gray-100",
                            autoFocus: true
                        }, void 0, false, {
                            fileName: "[project]/components/contest/ContestDetails.tsx",
                            lineNumber: 411,
                            columnNumber: 25
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "flex gap-3",
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                    onClick: ()=>{
                                        setShowEndModal(false);
                                        setEndConfirmText("");
                                    },
                                    className: "flex-1 px-4 py-3 border border-gray-200 dark:border-[#262626] rounded-lg font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-[#1a1a1a] transition-colors",
                                    children: "Cancel"
                                }, void 0, false, {
                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                    lineNumber: 421,
                                    columnNumber: 29
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
                                    onClick: confirmEndContest,
                                    disabled: endConfirmText.toLowerCase() !== "end" || isSubmittingContest,
                                    className: "flex-1 px-4 py-3 bg-red-600 text-white rounded-lg font-bold hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-red-500/20",
                                    children: isSubmittingContest ? "Ending..." : "End Contest"
                                }, void 0, false, {
                                    fileName: "[project]/components/contest/ContestDetails.tsx",
                                    lineNumber: 427,
                                    columnNumber: 29
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/components/contest/ContestDetails.tsx",
                            lineNumber: 420,
                            columnNumber: 25
                        }, this)
                    ]
                }, void 0, true, {
                    fileName: "[project]/components/contest/ContestDetails.tsx",
                    lineNumber: 399,
                    columnNumber: 21
                }, this)
            }, void 0, false, {
                fileName: "[project]/components/contest/ContestDetails.tsx",
                lineNumber: 398,
                columnNumber: 17
            }, this)
        ]
    }, void 0, true);
}
_s(ContestDetails, "7HtDmzoFP9z4423ug4pc9C1CfHw=", false, function() {
    return [
        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$navigation$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRouter"]
    ];
});
_c = ContestDetails;
var _c;
__turbopack_context__.k.register(_c, "ContestDetails");
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
"[project]/components/BackButton.tsx [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "default",
    ()=>BackButton
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/jsx-dev-runtime.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$navigation$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/navigation.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$arrow$2d$left$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__ArrowLeft$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/arrow-left.js [app-client] (ecmascript) <export default as ArrowLeft>");
;
var _s = __turbopack_context__.k.signature();
"use client";
;
;
function BackButton({ href, label = "Back", children, className = "" }) {
    _s();
    const router = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$navigation$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRouter"])();
    const handleClick = ()=>{
        if (href) {
            router.push(href);
        } else {
            router.back();
        }
    };
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("button", {
        onClick: handleClick,
        className: `inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-colors rounded-lg hover:bg-gray-100 dark:hover:bg-[#1a1a1a] ${className}`,
        children: [
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$arrow$2d$left$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__ArrowLeft$3e$__["ArrowLeft"], {
                className: "w-4 h-4"
            }, void 0, false, {
                fileName: "[project]/components/BackButton.tsx",
                lineNumber: 34,
                columnNumber: 7
            }, this),
            children || label
        ]
    }, void 0, true, {
        fileName: "[project]/components/BackButton.tsx",
        lineNumber: 30,
        columnNumber: 5
    }, this);
}
_s(BackButton, "fN7XvhJ+p5oE6+Xlo0NJmXpxjC8=", false, function() {
    return [
        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$navigation$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRouter"]
    ];
});
_c = BackButton;
var _c;
__turbopack_context__.k.register(_c, "BackButton");
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
]);

//# sourceMappingURL=_32dc7b0a._.js.map