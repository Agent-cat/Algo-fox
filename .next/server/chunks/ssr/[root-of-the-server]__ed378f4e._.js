module.exports=[650301,a=>{"use strict";var b=a.i(137936),c=a.i(402597),d=a.i(800717),e=a.i(231191),f=a.i(167784);class g{static async getDashboardStats(a){let b=`dashboard:stats:${a}`;try{let a=await f.default.get(b);if(a)return JSON.parse(a)}catch(a){console.error("Redis get error:",a)}let c=e.prisma.user.findUnique({where:{id:a},select:{id:!0,name:!0,email:!0,image:!0,role:!0,institution:{select:{name:!0}},problemsSolved:!0,totalScore:!0,bio:!0,goldBadges:!0,silverBadges:!0,bronzeBadges:!0,leetCodeHandle:!0,leetCodeVerified:!0,codeChefHandle:!0,codeChefVerified:!0,codeforcesHandle:!0,codeforcesVerified:!0,githubHandle:!0,submissions:{where:{mode:"SUBMIT"},select:{id:!0,createdAt:!0,status:!0,code:!0,language:{select:{name:!0}},problem:{select:{id:!0,difficulty:!0,slug:!0,title:!0}}},orderBy:{createdAt:"desc"},take:20}}}),d=e.prisma.$queryRaw`
            SELECT
                p."difficulty",
                CAST(COUNT(DISTINCT s."problemId") AS INTEGER) as "count"
            FROM "Submission" s
            JOIN "Problem" p ON s."problemId" = p."id"
            WHERE s."userId" = ${a}
              AND s."status" = 'ACCEPTED'::"SubmissionResult"
              AND s."mode" = 'SUBMIT'::"SubmissionMode"
              AND p."difficulty" != 'CONCEPT'::"Difficulty"
            GROUP BY p."difficulty"
        `,g=e.prisma.$queryRaw`
            SELECT
                l."name",
                CAST(COUNT(DISTINCT s."problemId") AS INTEGER) as "count"
            FROM "Submission" s
            JOIN "Language" l ON s."languageId" = l."id"
            JOIN "Problem" p ON s."problemId" = p."id"
            WHERE s."userId" = ${a}
              AND s."status" = 'ACCEPTED'::"SubmissionResult"
              AND s."mode" = 'SUBMIT'::"SubmissionMode"
              AND p."difficulty" != 'CONCEPT'::"Difficulty"
            GROUP BY l."name"
        `,h=e.prisma.$queryRaw`
            SELECT DISTINCT
                DATE(s."createdAt") as "date"
            FROM "Submission" s
            JOIN "Problem" p ON s."problemId" = p."id"
            WHERE s."userId" = ${a}
              AND s."status" = 'ACCEPTED'::"SubmissionResult"
              AND s."mode" = 'SUBMIT'::"SubmissionMode"
              AND p."difficulty" != 'CONCEPT'::"Difficulty"
            ORDER BY "date" ASC
        `,i=e.prisma.problem.groupBy({by:["difficulty"],where:{hidden:!1,difficulty:{not:"CONCEPT"}},_count:{id:!0}}),[j,k,l,m,n]=await Promise.all([c,d,g,h,i]);if(!j)return null;let o={EASY:0,MEDIUM:0,HARD:0};k.forEach(a=>{a.difficulty in o&&(o[a.difficulty]=a.count)});let p={EASY:0,MEDIUM:0,HARD:0,TOTAL:0};n.forEach(a=>{let b=a._count.id;a.difficulty in p&&(p[a.difficulty]=b),p.TOTAL+=b});let q={};l.forEach(a=>{let b=a.name,c=b;b.toLowerCase().includes("cpp")||b.toLowerCase().includes("c++")?c="Cpp":b.toLowerCase().includes("java")?c="Java":b.toLowerCase().includes("javascript")&&(c="JavaScript"),q[c]||(q[c]=0),q[c]+=a.count});let r=0,s=0;if(m.length>0){let a=m.map(a=>new Date(a.date)),b=1;s=1;for(let c=1;c<a.length;c++){let d=Math.ceil(Math.abs(a[c].getTime()-a[c-1].getTime())/864e5);1===d?s=Math.max(s,++b):d>1&&(b=1)}let c=new Date;c.setHours(0,0,0,0);let d=new Date(a[a.length-1]);if(d.setHours(0,0,0,0),(c.getTime()-d.getTime())/864e5<=1){r=1;for(let b=a.length-1;b>0;b--){let c=a[b],d=a[b-1],e=(c.getTime()-d.getTime())/864e5;if(e<=1)1===e&&r++;else break}}else r=0}let t={...j,solvedByDifficulty:o,totalProblems:p,languageCounts:q,currentStreak:r,bestStreak:Math.max(s,r)};try{await f.default.setex(b,300,JSON.stringify(t))}catch(a){console.error("Redis set error:",a)}return t}}var h=a.i(409223),i=a.i(905246),j=a.i(118558);let k=async function(){(0,j.cacheLife)({stale:300,revalidate:300});let a=await h.auth.api.getSession({headers:await (0,i.headers)()});if(!a?.user)return null;let b=a.user.id;return(0,j.cacheTag)(`dashboard-${b}`,"dashboard-stats"),g.getDashboardStats(b)};var l=(0,d.cache)(function(){return(0,c.cache)("private","80ed94cd005d41fd173dde2ed7b417a5e9943fc022",0,k,arguments)});(0,b.registerServerReference)(l,"80ed94cd005d41fd173dde2ed7b417a5e9943fc022",null),Object.defineProperty(l,"name",{value:"getDashboardStats"});let m=async function(a){(0,j.cacheLife)({stale:300,revalidate:300});let b=await h.auth.api.getSession({headers:await (0,i.headers)()});return b?.user?((0,j.cacheTag)(`dashboard-${a}`,"dashboard-stats"),g.getDashboardStats(a)):null};var n=(0,d.cache)(function(){return(0,c.cache)("private","c00f4e719da58b0122f1cc40a1864a7c5979676c4c",0,m,arguments)});(0,b.registerServerReference)(n,"c00f4e719da58b0122f1cc40a1864a7c5979676c4c",null),Object.defineProperty(n,"name",{value:"getUserProfile"}),a.s(["$$RSC_SERVER_CACHE_0",()=>l,"$$RSC_SERVER_CACHE_1",()=>n,"getDashboardStats",()=>l,"getUserProfile",()=>n],650301)},859664,(a,b,c)=>{b.exports=a.x("jsdom-4cccfac9827ebcfe",()=>require("jsdom-4cccfac9827ebcfe"))},363212,a=>{"use strict";var b=a.i(260711),c=a.i(137936),d=a.i(859664),e=a.i(409223),f=a.i(231191),g=a.i(118558),h=a.i(905246);async function i(a,b=!1){try{let c=await fetch(`https://www.codechef.com/users/${a}`,b?{cache:"no-store"}:{next:{revalidate:3600}});if(200!=c.status)return{success:!1,status:c.status};{let a=await c.text(),b=a.search("var userDailySubmissionsStats =")+31,e=a.search("'#js-heatmap")-34,f=a.substring(b,e),g=null;try{g=JSON.parse(f)}catch(a){console.log("Error parsing heatmap data",a)}let h=a.search("var all_rating = ")+17,i=a.search("var current_user_rating =")-6,j=null;try{j=JSON.parse(a.substring(h,i))}catch(a){console.log("Error parsing rating data",a)}let k=new d.JSDOM(a).window.document,l=k.querySelector(".user-details-container")?.children[0]?.children[1]?.textContent||"",m=k.querySelector(".user-details-container")?.children[0]?.children[0]?.getAttribute("src")||"",n=k.querySelector(".rating-number")?.textContent,o=n?parseInt(n):0,p=k.querySelector(".rating-number")?.parentNode?.children[4]?.textContent?.split("Rating")[1],q=p?parseInt(p):0,r=k.querySelector(".user-country-flag")?.getAttribute("src")||"",s=k.querySelector(".user-country-name")?.textContent||"",t=k.querySelector(".rating-ranks")?.children[0]?.children[0]?.children[0]?.children[0]?.innerHTML,u=t?parseInt(t):0,v=k.querySelector(".rating-ranks")?.children[0]?.children[1]?.children[0]?.children[0]?.innerHTML,w=v?parseInt(v):0,x=k.querySelector(".rating")?.textContent||"unrated",y=0;for(let a of k.querySelectorAll("h5"))if(a.textContent?.includes("Fully Solved")){let b=a.textContent.match(/\d+/);b&&(y=parseInt(b[0]));break}return{success:!0,status:c.status,profile:m,name:l,currentRating:o,highestRating:q,countryFlag:r,countryName:s,globalRank:u,countryRank:w,stars:x,heatMap:g,ratingData:j,fullySolvedCount:y}}}catch(a){return console.log(a),{success:!1,status:404}}}async function j(a,b){let c=await e.auth.api.getSession({headers:await (0,h.headers)()});if(!c||!c.user)return{success:!1,error:"Unauthorized"};let d=await i(a,!0);if(d.success&&d.name)if(!d.name.includes(b))return{success:!1,error:"Verification code not found in CodeChef name. Please ensure you have updated your profile name."};else try{return await f.prisma.user.update({where:{id:c.user.id},data:{codeChefVerified:!0,codeChefHandle:a}}),(0,g.revalidatePath)("/dashboard/settings"),(0,g.revalidateTag)(`user-${c.user.id}`,"max"),{success:!0}}catch(a){return console.error("Database update error:",a),{success:!1,error:"Failed to update verification status"}}return{success:!1,error:"Failed to fetch CodeChef profile"}}async function k(a,b=!1){try{let c=b?{cache:"no-store"}:{next:{revalidate:3600}},[d,e]=await Promise.all([fetch(`https://codeforces.com/api/user.info?handles=${a}`,c),fetch(`https://codeforces.com/api/user.status?handle=${a}`,c)]);if(d.ok&&e.ok){let a=await d.json(),b=await e.json();if("OK"===a.status&&a.result.length>0){let c=a.result[0],d=new Set,e={EASY:0,MEDIUM:0,HARD:0,TOTAL:0};if("OK"===b.status){for(let a of b.result)if("OK"===a.verdict){let b=`${a.problem.contestId}-${a.problem.index}`;if(!d.has(b)){d.add(b);let c=a.problem.rating;c&&(c<1200?e.EASY++:c<1600?e.MEDIUM++:e.HARD++)}}e.TOTAL=d.size}return{success:!0,status:200,firstName:c.firstName,rating:c.rating,rank:c.rank,maxRating:c.maxRating,maxRank:c.maxRank,avatar:c.titlePhoto||c.avatar,solvedByDifficulty:e}}}return{success:!1,status:d.status}}catch(a){return console.error(a),{success:!1,status:500}}}async function l(a,b){let c=await e.auth.api.getSession({headers:await (0,h.headers)()});if(!c||!c.user)return{success:!1,error:"Unauthorized"};let d=await k(a,!0);if(d.success)if(!(d.firstName&&d.firstName.includes(b)))return{success:!1,error:"Verification code not found in Codeforces First Name. Please ensure you have updated it in your profile settings."};else try{return await f.prisma.user.update({where:{id:c.user.id},data:{codeforcesVerified:!0,codeforcesHandle:a}}),(0,g.revalidatePath)("/dashboard/settings"),(0,g.revalidateTag)(`user-${c.user.id}`,"max"),{success:!0}}catch(a){return console.error("Database update error:",a),{success:!1,error:"Failed to update verification status"}}return{success:!1,error:"Failed to fetch Codeforces profile"}}async function m(c,d=!1){try{let{LeetCode:e}=await (0,b.trackDynamicImport)(a.A(444063)),f=new e,g=await f.user(c),h=`
            query userContestRankingInfo($username: String!) {
                userContestRanking(username: $username) {
                    attendedContestsCount
                    rating
                    globalRanking
                    topPercentage
                    badge {
                        name
                    }
                }
                userContestRankingHistory(username: $username) {
                    attended
                    rating
                    contest {
                        title
                        startTime
                    }
                }
            }
        `,i=await fetch("https://leetcode.com/graphql",{method:"POST",headers:{"Content-Type":"application/json",Referer:"https://leetcode.com"},body:JSON.stringify({query:h,variables:{username:c}}),...d?{cache:"no-store"}:{next:{revalidate:3600}}}),j=await i.json(),k=j.data?.userContestRanking,l=j.data?.userContestRankingHistory?.filter(a=>a.attended);if(g&&g.matchedUser)return{success:!0,status:200,name:g.matchedUser.profile.realName,avatar:g.matchedUser.profile.userAvatar,submitStats:g.matchedUser.submitStats,contestStats:k||null,contestHistory:l||[]};return{success:!1,status:404}}catch(a){return console.error("LeetCode check error:",a),{success:!1,status:500}}}async function n(a,b){let c=await e.auth.api.getSession({headers:await (0,h.headers)()});if(!c||!c.user)return{success:!1,error:"Unauthorized"};try{let d=await m(a,!0);if(d.success&&d.name)if(!d.name.includes(b))return{success:!1,error:"Verification code not found in LeetCode Name. Please ensure you have updated it in your profile."};else try{return await f.prisma.user.update({where:{id:c.user.id},data:{leetCodeVerified:!0,leetCodeHandle:a}}),(0,g.revalidatePath)("/dashboard/settings"),(0,g.revalidateTag)(`user-${c.user.id}`,"max"),{success:!0}}catch(a){return console.error("Database update error:",a),{success:!1,error:"Failed to update verification status"}}}catch(a){return{success:!1,error:"Failed to verify LeetCode profile"}}return{success:!1,error:"Failed to fetch LeetCode profile or name is empty"}}(0,a.i(713095).ensureServerEntryExports)([i,j,k,l,m,n]),(0,c.registerServerReference)(i,"6063cd483379a41c765892304ba2c4b6076f9fe25a",null),(0,c.registerServerReference)(j,"6025b82b45ad39180ed262d4932bb5045a0e8415db",null),(0,c.registerServerReference)(k,"60f28e01956bf5c9d597a2fde65801b141c59b3d64",null),(0,c.registerServerReference)(l,"60544a97665a44c2f404559d69526b2c7b9f0295a2",null),(0,c.registerServerReference)(m,"602e4c595e83925f2fb97d138792c6c901bc6651d1",null),(0,c.registerServerReference)(n,"601fb0da0dfc97022be5342d2cad339f22823cb918",null),a.s(["checkCodeChefUser",()=>i,"checkCodeforcesUser",()=>k,"checkLeetCodeUser",()=>m,"verifyCodeChefOwnership",()=>j,"verifyCodeforcesOwnership",()=>l,"verifyLeetCodeOwnership",()=>n])},663294,a=>{"use strict";var b=a.i(191679),c=a.i(650301),d=a.i(154470),e=a.i(363212);a.s([],762867),a.i(762867),a.s(["004e22ef7336191bc1fe8b683adb39c115fb22318c",()=>d.syncUserProfile,"00f4c838ce10f91796a39f1558a3b75432fa49882a",()=>b.checkSessionConflict,"409bc5870257fe05de038549e85b0722c4e09c83d4",()=>b.resolveSessionConflict,"602e4c595e83925f2fb97d138792c6c901bc6651d1",()=>e.checkLeetCodeUser,"6063cd483379a41c765892304ba2c4b6076f9fe25a",()=>e.checkCodeChefUser,"60f28e01956bf5c9d597a2fde65801b141c59b3d64",()=>e.checkCodeforcesUser,"80ed94cd005d41fd173dde2ed7b417a5e9943fc022",()=>c.$$RSC_SERVER_CACHE_0,"c00f4e719da58b0122f1cc40a1864a7c5979676c4c",()=>c.$$RSC_SERVER_CACHE_1],663294)},588010,a=>{a.v(b=>Promise.all(["server/chunks/ssr/node_modules_better-auth_dist_adapters_memory-adapter_index_mjs_35d2dbfd._.js"].map(b=>a.l(b))).then(()=>b(700031)))},860484,a=>{a.v(b=>Promise.all(["server/chunks/ssr/node_modules_better-auth_dist_adapters_kysely-adapter_index_mjs_0abbd964._.js"].map(b=>a.l(b))).then(()=>b(536063)))},946014,a=>{a.v(b=>Promise.all(["server/chunks/ssr/a9bf9_better-auth_dist_adapters_kysely-adapter_bun-sqlite-dialect_mjs_23698f07._.js"].map(b=>a.l(b))).then(()=>b(496824)))},945599,a=>{a.v(b=>Promise.all(["server/chunks/ssr/a9bf9_better-auth_dist_adapters_kysely-adapter_node-sqlite-dialect_mjs_9102e2ec._.js"].map(b=>a.l(b))).then(()=>b(68928)))},1067,a=>{a.v(a=>Promise.resolve().then(()=>a(167784)))},444063,a=>{a.v(b=>Promise.all(["server/chunks/ssr/[root-of-the-server]__9a763770._.js"].map(b=>a.l(b))).then(()=>b(559175)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__ed378f4e._.js.map