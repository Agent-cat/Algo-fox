module.exports=[191679,a=>{"use strict";var b=a.i(137936),c=a.i(409223),d=a.i(231191),e=a.i(905246);async function f(){let a=await c.auth.api.getSession({headers:await (0,e.headers)()});if(!a)return{conflict:!1};let b=(await d.prisma.session.findMany({where:{userId:a.user.id},select:{id:!0,expiresAt:!0,userAgent:!0,ipAddress:!0,token:!0}})).filter(a=>a.expiresAt>new Date);return b.length>1?{conflict:!0,currentSessionToken:a.session.token,sessions:b.map(b=>({...b,isCurrent:b.token===a.session.token}))}:{conflict:!1}}async function g(a){let b=await c.auth.api.getSession({headers:await (0,e.headers)()});if(!b)throw Error("No active session");return"LOGOUT_OTHERS"===a?(await d.prisma.session.deleteMany({where:{userId:b.user.id,token:{not:b.session.token}}}),{success:!0,message:"Other sessions terminated"}):"LOGOUT_CURRENT"===a?(await d.prisma.session.delete({where:{token:b.session.token}}),{success:!0,message:"Current session terminated"}):void 0}(0,a.i(713095).ensureServerEntryExports)([f,g]),(0,b.registerServerReference)(f,"00f4c838ce10f91796a39f1558a3b75432fa49882a",null),(0,b.registerServerReference)(g,"409bc5870257fe05de038549e85b0722c4e09c83d4",null),a.s(["checkSessionConflict",()=>f,"resolveSessionConflict",()=>g])},951187,(a,b,c)=>{b.exports=a.x("next/dist/server/lib/incremental-cache/tags-manifest.external.js",()=>require("next/dist/server/lib/incremental-cache/tags-manifest.external.js"))},137936,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"registerServerReference",{enumerable:!0,get:function(){return d.registerServerReference}});let d=a.r(211857)},713095,(a,b,c)=>{"use strict";function d(a){for(let b=0;b<a.length;b++){let c=a[b];if("function"!=typeof c)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof c}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"ensureServerEntryExports",{enumerable:!0,get:function(){return d}})},792509,(a,b,c)=>{b.exports=a.x("url",()=>require("url"))},688947,(a,b,c)=>{b.exports=a.x("stream",()=>require("stream"))},907378,a=>{"use strict";function b(a){switch(a){case"EASY":return 5;case"MEDIUM":return 10;case"HARD":return 15;default:return 0}}a.s(["getPointsForDifficulty",()=>b])},154470,a=>{"use strict";var b=a.i(260711),c=a.i(137936),d=a.i(402597),e=a.i(800717),f=a.i(231191),g=a.i(907378),h=a.i(167784);class i{static async getUserScore(a){let b=`user-score-${a}`;try{let a=await h.default.get(b);if(a)return parseInt(a,10)}catch(a){console.error("Redis get error:",a)}let c=await f.prisma.user.findUnique({where:{id:a},select:{totalScore:!0}}),d=c?.totalScore||0;try{await h.default.setex(b,30,d.toString())}catch(a){console.error("Redis set error:",a)}return d}static async recalculateUserScore(a){try{let b=await f.prisma.submission.findMany({where:{userId:a,status:"ACCEPTED",mode:"SUBMIT"},select:{problemId:!0,problem:{select:{difficulty:!0}}},distinct:["problemId"]}),c=0;for(let a of b){let b=(0,g.getPointsForDifficulty)(a.problem.difficulty);c+=b}await f.prisma.user.update({where:{id:a},data:{totalScore:c}});try{await h.default.del(`user-score-${a}`)}catch(a){console.error("Failed to invalidate user score cache:",a)}return{success:!0,newScore:c}}catch(a){throw console.error("Failed to recalculate user score:",a),Error("Failed to recalculate user score")}}static async completeOnboarding(a,b){try{await f.prisma.user.update({where:{id:a},data:{name:b.name,collegeId:b.collegeId||null,year:b.year?parseInt(b.year):null,bio:b.bio||null,leetCodeHandle:b.leetCodeHandle||null,codeChefHandle:b.codeChefHandle||null,codeforcesHandle:b.codeforcesHandle||b.hackerrankHandle||null,githubHandle:b.githubHandle||null,onboardingCompleted:!0}});try{await h.default.del(`dashboard:stats:${a}`)}catch(a){console.error("Failed to invalidate dashboard cache:",a)}return{success:!0}}catch(a){return console.error("Failed to complete onboarding:",a),{success:!1,error:"Failed to complete onboarding"}}}}var j=a.i(409223),k=a.i(905246),l=a.i(118558),m=a.i(713095);let n=async function(){(0,l.cacheLife)({stale:300,revalidate:300});let a=await j.auth.api.getSession({headers:await (0,k.headers)()});if(!a?.user?.id)return 0;let b=a.user.id;return(0,l.cacheTag)(`user-score-${b}`,`user-${b}`),i.getUserScore(b)};var o=(0,e.cache)(function(){return(0,d.cache)("private","806283762cd0bce0ac074567811476f29644f6b5e2",0,n,arguments)});async function p(){let a=await j.auth.api.getSession({headers:await (0,k.headers)()});if(!a?.user?.id)throw Error("Unauthorized");let b=a.user.id;return i.recalculateUserScore(b)}async function q(c){let d=await j.auth.api.getSession({headers:await (0,k.headers)()});if(!d?.user?.id)return{success:!1,error:"Unauthorized"};let e=d.user.id,f=await i.completeOnboarding(e,c);if(f.success){try{let c=(await (0,b.trackDynamicImport)(a.A(1067))).default;await c.del(`dashboard:stats:${e}`)}catch(a){console.error("Failed to invalidate dashboard redis cache:",a)}(0,l.revalidatePath)("/dashboard"),(0,l.updateTag)(`user-${e}`),(0,l.updateTag)(`dashboard-${e}`),(0,l.updateTag)("dashboard-stats")}return f}async function r(c){let d=await j.auth.api.getSession({headers:await (0,k.headers)()});if(!d?.user?.id)return{success:!1,error:"Unauthorized"};let e=d.user.id;try{let d=await f.prisma.user.findUnique({where:{id:e},select:{codeChefHandle:!0,codeforcesHandle:!0,leetCodeHandle:!0}}),g={name:c.name,bio:c.bio,leetCodeHandle:c.leetCodeHandle,codeChefHandle:c.codeChefHandle,codeforcesHandle:c.codeforcesHandle,githubHandle:c.githubHandle};d&&(void 0!==c.codeChefHandle&&c.codeChefHandle!==d.codeChefHandle&&(g.codeChefVerified=!1),void 0!==c.codeforcesHandle&&c.codeforcesHandle!==d.codeforcesHandle&&(g.codeforcesVerified=!1),void 0!==c.leetCodeHandle&&c.leetCodeHandle!==d.leetCodeHandle&&(g.leetCodeVerified=!1)),await f.prisma.user.update({where:{id:e},data:g});try{let c=(await (0,b.trackDynamicImport)(a.A(1067))).default;await c.del(`dashboard:stats:${e}`)}catch(a){console.error("Failed to invalidate dashboard redis cache:",a)}return(0,l.revalidatePath)("/dashboard"),(0,l.revalidatePath)("/dashboard/settings"),(0,l.updateTag)(`user-${e}`),(0,l.updateTag)(`user-score-${e}`),(0,l.updateTag)(`dashboard-${e}`),(0,l.updateTag)("dashboard-stats"),{success:!0}}catch(a){return console.error("Failed to update user info:",a),{success:!1,error:"Failed to update profile"}}}async function s(){let c=await j.auth.api.getSession({headers:await (0,k.headers)()});if(!c?.user?.id)return{success:!1,error:"Unauthorized"};let d=c.user.id;try{try{let c=(await (0,b.trackDynamicImport)(a.A(1067))).default;await c.del(`dashboard:stats:${d}`),await c.del(`user-score-${d}`)}catch(a){console.error("Failed to invalidate redis cache during sync:",a)}return(0,l.revalidatePath)("/dashboard"),(0,l.updateTag)(`user-${d}`),(0,l.updateTag)(`user-score-${d}`),(0,l.updateTag)("dashboard-stats"),{success:!0}}catch(a){return console.error("Sync failed:",a),{success:!1,error:"Failed to sync profile"}}}(0,c.registerServerReference)(o,"806283762cd0bce0ac074567811476f29644f6b5e2",null),Object.defineProperty(o,"name",{value:"getUserScore"});let t=async function(){(0,l.cacheLife)({stale:300,revalidate:300});let a=await j.auth.api.getSession({headers:await (0,k.headers)()});if(!a?.user?.id)return null;let b=a.user.id;(0,l.cacheTag)(`user-${b}`);let c=await f.prisma.user.findUnique({where:{id:b},include:{institution:!0}});return c?{id:c.id,name:c.name,email:c.email,image:c.image,bio:c.bio,institutionName:c.institution?.name}:null};var u=(0,e.cache)(function(){return(0,d.cache)("private","801090a862b4d5f5c1a62c9c0bb04047d7a9910873",0,t,arguments)});(0,c.registerServerReference)(u,"801090a862b4d5f5c1a62c9c0bb04047d7a9910873",null),Object.defineProperty(u,"name",{value:"getUserSettings"}),(0,m.ensureServerEntryExports)([p,q,r,s]),(0,c.registerServerReference)(p,"007977239056561ea7766ffef604a1b67e3430e9af",null),(0,c.registerServerReference)(q,"4022a02ca4ee842a7ee3b7772e041cc7b3c57f2de4",null),(0,c.registerServerReference)(r,"401adb5bf0163fd65ff314479b20d5a44231d975ab",null),(0,c.registerServerReference)(s,"004e22ef7336191bc1fe8b683adb39c115fb22318c",null),a.s(["$$RSC_SERVER_CACHE_0",()=>o,"$$RSC_SERVER_CACHE_1",()=>u,"completeOnboarding",()=>q,"getUserScore",()=>o,"getUserSettings",()=>u,"recalculateUserScore",()=>p,"syncUserProfile",()=>s,"updateUserInfo",()=>r],154470)},53112,a=>{"use strict";var b=a.i(954757);a.s(["z",0,b])},340499,a=>{"use strict";var b=a.i(167784);let c={SHORT:{ttl:30,stale:15},MEDIUM:{ttl:120,stale:60},LONG:{ttl:600,stale:300},STATIC:{ttl:3600,stale:1800}};function d(a,...b){return`algofox:${a}:${b.join(":")}`}async function e(a){try{let c=await b.default.get(a);if(!c)return null;return JSON.parse(c)}catch(a){return console.error("[Cache] Get error:",a),null}}async function f(a,d,e=c.MEDIUM.ttl){try{await b.default.setex(a,e,JSON.stringify(d))}catch(a){console.error("[Cache] Set error:",a)}}async function g(a){try{await b.default.del(a)}catch(a){console.error("[Cache] Delete error:",a)}}async function h(a,b,d=c.MEDIUM.ttl){let g=await e(a);if(null!==g)return g;let i=await b();return f(a,i,d).catch(()=>{}),i}a.s(["CACHE_CONFIG",0,c,"cacheKey",()=>d,"cachedFetch",()=>h,"deleteFromCache",()=>g])},405781,a=>{"use strict";var b=a.i(137936),c=a.i(231191),d=a.i(167784),e=a.i(409223),f=a.i(905246),g=a.i(53112),h=a.i(118558),i=a.i(340499),j=a.i(713095);let k=g.z.object({name:g.z.string().min(2,"Name must be at least 2 characters"),section:g.z.string().optional().or(g.z.literal("")),subject:g.z.string().optional().or(g.z.literal("")),institutionId:g.z.string()});async function l(a){let b=await e.auth.api.getSession({headers:await (0,f.headers)()});if(!b?.user)return{success:!1,error:"Unauthorized"};let d=b.user;if(!["ADMIN","INSTITUTION_MANAGER","TEACHER"].includes(d.role))return{success:!1,error:"Unauthorized. Only teachers or managers can create classrooms."};try{let b=k.parse(a),e="",f=!1,g=0;for(;!f&&g<10;)e=function(){let a="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",b="";for(let c=0;c<6;c++)b+=a.charAt(Math.floor(Math.random()*a.length));return b}(),await c.prisma.classroom.findUnique({where:{joinCode:e}})||(f=!0),g++;if(!f)return{success:!1,error:"Failed to generate a unique join code. Please try again."};let i=await c.prisma.classroom.create({data:{name:b.name,section:b.section||null,subject:b.subject||null,joinCode:e,institutionId:b.institutionId,teacherId:d.id}});return(0,h.revalidateTag)(`teacher-classrooms-${d.id}`,"max"),(0,h.revalidateTag)(`institution-classrooms-${b.institutionId}`,"max"),(0,h.revalidatePath)("/dashboard/institution/classrooms"),{success:!0,data:i}}catch(a){if(a instanceof g.z.ZodError)return{success:!1,error:a.issues[0].message};return console.error("Failed to create classroom:",a),{success:!1,error:"Failed to create classroom"}}}async function m(a){let b=await e.auth.api.getSession({headers:await (0,f.headers)()});if(!b?.user)return{success:!1,error:"Unauthorized"};let g=b.user;try{let b=await c.prisma.classroom.findUnique({where:{joinCode:a.toUpperCase()},include:{students:{where:{id:g.id}}}});if(!b)return{success:!1,error:"Invalid join code."};if(b.students.length>0)return{success:!1,error:"You are already enrolled in this classroom."};if(g.institutionId&&g.institutionId!==b.institutionId)return{success:!1,error:"You cannot join this classroom because it belongs to a different institution."};await c.prisma.classroom.update({where:{id:b.id},data:{students:{connect:{id:g.id}}}});let e={onboardingCompleted:!0};g.institutionId||(e.institutionId=b.institutionId),await c.prisma.user.update({where:{id:g.id},data:e});let f=`classroom:students:${b.id}`;return await d.default.sadd(f,g.id),(0,h.revalidateTag)(`student-classrooms-${g.id}`,"max"),(0,h.revalidateTag)(`classroom-${b.id}`,"max"),(0,h.revalidatePath)("/dashboard/classrooms"),{success:!0,message:`Successfully joined ${b.name}`}}catch(a){return console.error("Failed to join classroom:",a),{success:!1,error:"Failed to join classroom"}}}async function n(a){try{let b=await c.prisma.classroom.findUnique({where:{joinCode:a.toUpperCase()},select:{id:!0,name:!0,subject:!0,section:!0,teacher:{select:{id:!0,name:!0,image:!0}},_count:{select:{students:!0}}}});if(!b)return{success:!1,error:"Classroom not found"};let d=await e.auth.api.getSession({headers:await (0,f.headers)()}),g=!!d?.user&&await c.prisma.classroom.findFirst({where:{id:b.id,students:{some:{id:d.user.id}}}});return{success:!0,classroom:b,isEnrolled:!!g}}catch(a){return console.error("Failed to fetch classroom by code:",a),{success:!1,error:"Failed to fetch classroom"}}}async function o(){let a=await e.auth.api.getSession({headers:await (0,f.headers)()});if(!a?.user)return{success:!1,error:"Unauthorized"};let b=a.user.id,d=(0,h.unstable_cache)(async()=>await c.prisma.classroom.findMany({where:{teacherId:b},include:{_count:{select:{students:!0}}},orderBy:{createdAt:"desc"}}),[`teacher-classrooms-${b}`],{tags:[`teacher-classrooms-${b}`],revalidate:120});try{let a=await d();return{success:!0,classrooms:a}}catch(a){return console.error("Failed to fetch teacher classrooms:",a),{success:!1,error:"Failed to fetch classrooms"}}}async function p(){let a=await e.auth.api.getSession({headers:await (0,f.headers)()});if(!a?.user)return{success:!1,error:"Unauthorized"};let b=a.user.id,d=(0,h.unstable_cache)(async()=>{let a=await c.prisma.user.findUnique({where:{id:b},include:{enrolledClassrooms:{include:{teacher:{select:{name:!0}}},orderBy:{createdAt:"desc"}}}});return a?.enrolledClassrooms||[]},[`student-classrooms-${b}`],{tags:[`student-classrooms-${b}`],revalidate:120});try{let a=await d();return{success:!0,classrooms:a}}catch(a){return console.error("Failed to fetch student classrooms:",a),{success:!1,error:"Failed to fetch classrooms"}}}async function q(a,b=1,d=50){let g=await e.auth.api.getSession({headers:await (0,f.headers)()});if(!g?.user)return{success:!1,error:"Unauthorized"};let i=(b-1)*d,j=(0,h.unstable_cache)(async()=>{let[b,e]=await Promise.all([c.prisma.classroom.findUnique({where:{id:a},select:{id:!0,name:!0,subject:!0,section:!0,joinCode:!0,isTrackingActive:!0,trackingStartedAt:!0,teacher:{select:{name:!0,id:!0}},students:{select:{id:!0,name:!0,totalScore:!0,image:!0},orderBy:{totalScore:"desc"},skip:i,take:d}}}),c.prisma.user.count({where:{enrolledClassrooms:{some:{id:a}}}})]);return{classroom:b,totalStudents:e}},[`classroom-${a}-page-${b}`],{tags:[`classroom-${a}`],revalidate:60});try{let{classroom:a,totalStudents:c}=await j();if(!a)return{success:!1,error:"Classroom not found"};return{success:!0,classroom:a,pagination:{total:c,pages:Math.ceil(c/d),current:b,limit:d}}}catch(a){return console.error("Failed to fetch classroom detail:",a),{success:!1,error:"Failed to fetch classroom"}}}async function r(a,b){let d=await e.auth.api.getSession({headers:await (0,f.headers)()});if(!d?.user)return{success:!1,error:"Unauthorized"};let g=await c.prisma.classroom.findUnique({where:{id:a},select:{teacherId:!0}});return g&&(g.teacherId===d.user.id||"ADMIN"===d.user.role)?(await c.prisma.classroom.update({where:{id:a},data:{isTrackingActive:b,trackingStartedAt:b?new Date:null}}),await (0,i.deleteFromCache)((0,i.cacheKey)("live-tracking",a)),(0,h.revalidateTag)(`classroom-${a}`,"max"),(0,h.revalidatePath)(`/dashboard/classrooms/${a}`),{success:!0}):{success:!1,error:"Access denied"}}async function s(a){let b=await e.auth.api.getSession({headers:await (0,f.headers)()});if(!b?.user)return{success:!1,error:"Unauthorized"};let d=(0,i.cacheKey)("live-tracking",a),g=async()=>{let b=await c.prisma.classroom.findUnique({where:{id:a},select:{isTrackingActive:!0,trackingStartedAt:!0,students:{select:{id:!0,name:!0,image:!0,submissions:{where:{mode:"SUBMIT"},orderBy:{createdAt:"desc"},take:20,include:{problem:{select:{title:!0}}}}}}}});if(!b)return null;let d=b.students.map(a=>{let c=a.submissions.filter(a=>b.isTrackingActive&&b.trackingStartedAt&&new Date(a.createdAt)>=new Date(b.trackingStartedAt)).map(a=>({id:a.id,code:a.code,status:a.status,problemTitle:a.problem.title,createdAt:a.createdAt}));return{id:a.id,name:a.name,image:a.image,submissions:c}});return{isTrackingActive:b.isTrackingActive,trackingStartedAt:b.trackingStartedAt,students:d}};try{let a=await (0,i.cachedFetch)(d,g,i.CACHE_CONFIG.SHORT.ttl);if(!a)return{success:!1,error:"Classroom not found"};return{success:!0,...a}}catch(a){return console.error("Failed to fetch live tracking:",a),{success:!1,error:"Failed to fetch tracking data"}}}async function t(a=1,b=20){let d=await e.auth.api.getSession({headers:await (0,f.headers)()});if(!d?.user)return{success:!1,error:"Unauthorized"};let g=d.user;if("ADMIN"!==g.role&&"INSTITUTION_MANAGER"!==g.role)return{success:!1,error:"Unauthorized"};let i=g.institutionId,j=(a-1)*b,k=(0,h.unstable_cache)(async()=>{let[a,d]=await Promise.all([c.prisma.classroom.findMany({where:{institutionId:i},include:{teacher:{select:{name:!0,email:!0}},_count:{select:{students:!0}}},orderBy:{createdAt:"desc"},skip:j,take:b}),c.prisma.classroom.count({where:{institutionId:i}})]);return{classrooms:a,total:d}},[`institution-classrooms-${i}-page-${a}`],{tags:[`institution-classrooms-${i}`],revalidate:120});try{let{classrooms:c,total:d}=await k();return{success:!0,classrooms:c,pagination:{total:d,pages:Math.ceil(d/b),current:a,limit:b}}}catch(a){return console.error("Failed to fetch institution classrooms:",a),{success:!1,error:"Failed to fetch classrooms"}}}async function u(a,b){let g=await e.auth.api.getSession({headers:await (0,f.headers)()});if(!g?.user)return{success:!1,error:"Unauthorized"};let i=g.user,j=["ADMIN","INSTITUTION_MANAGER"].includes(i.role);try{let e=await c.prisma.classroom.findUnique({where:{id:a},select:{teacherId:!0,institutionId:!0}});if(!e)return{success:!1,error:"Classroom not found"};if(!j&&e.teacherId!==i.id)return{success:!1,error:"Unauthorized"};await c.prisma.classroom.update({where:{id:a},data:{students:{disconnect:{id:b}}}});let f=`classroom:students:${a}`;return await d.default.srem(f,b),(0,h.revalidateTag)(`classroom-${a}`,"max"),(0,h.revalidateTag)(`student-classrooms-${b}`,"max"),(0,h.revalidatePath)(`/dashboard/classrooms/${a}`),{success:!0}}catch(a){return console.error("Failed to remove student:",a),{success:!1,error:"Failed to remove student"}}}(0,j.ensureServerEntryExports)([l,m,n,o,p,q,r,s,t,u]),(0,b.registerServerReference)(l,"405d122aba3f5928800ed130a7b71a1b47271751ba",null),(0,b.registerServerReference)(m,"4052b0471161707b49db8311132ddb7c92790d847f",null),(0,b.registerServerReference)(n,"4037d92f3a67eb2428d5b2dab919914d5756aace36",null),(0,b.registerServerReference)(o,"002a588abb136c6f86adadd291e7fdda7347bfa1e9",null),(0,b.registerServerReference)(p,"00dc41dbc84f1082ddd9f6a9207eb5b406ea5c543e",null),(0,b.registerServerReference)(q,"700d160d9099ae66508f5d181cf879265ecd403e7d",null),(0,b.registerServerReference)(r,"60034d10a668ce8353cc35e9db8784a8a275d2b2e0",null),(0,b.registerServerReference)(s,"40e294f0f9e4303d3615ddc6a66cada537036c1b97",null),(0,b.registerServerReference)(t,"6029e68e22d85ff157089c99e60915beba555ec65d",null),(0,b.registerServerReference)(u,"602532808556a300ed5e0f4a5f69437cc6db044dc7",null),a.s(["createClassroom",()=>l,"getClassroomByCode",()=>n,"getClassroomLiveTracking",()=>s,"getClassroomWithStudents",()=>q,"getInstitutionClassrooms",()=>t,"getStudentClassrooms",()=>p,"getTeacherClassrooms",()=>o,"joinClassroom",()=>m,"removeStudentFromClassroom",()=>u,"toggleClassroomTracking",()=>r])},587313,a=>{"use strict";var b=a.i(137936),c=a.i(231191),d=a.i(409223),e=a.i(905246),f=a.i(118558),g=a.i(340499);async function h(a,b=1,d=20){let e=new Date;e.setDate(e.getDate()-21);let g=(b-1)*d,i=(0,f.unstable_cache)(async()=>{let[b,f]=await Promise.all([c.prisma.assignment.findMany({where:{classroomId:a,createdAt:{gte:e}},include:{_count:{select:{problems:!0}}},orderBy:{createdAt:"desc"},skip:g,take:d}),c.prisma.assignment.count({where:{classroomId:a,createdAt:{gte:e}}})]);return{assignments:b,total:f}},[`classroom-assignments-${a}-page-${b}`],{tags:[`assignments-classroom-${a}`,"assignments-all"],revalidate:60}),{assignments:j,total:k}=await i();return{assignments:j,pagination:{total:k,pages:Math.ceil(k/d),current:b,limit:d}}}async function i(a){let b=new Date;return b.setDate(b.getDate()-21),await c.prisma.assignment.findMany({where:{classroomId:a,createdAt:{gte:b}},include:{_count:{select:{problems:!0}}},orderBy:{createdAt:"desc"}})}async function j(a,b){let g=await d.auth.api.getSession({headers:await (0,e.headers)()});if(!g?.user||"TEACHER"!==g.user.role)return{success:!1,error:"Unauthorized"};try{let d=await c.prisma.classroom.findUnique({where:{id:a},select:{teacherId:!0}});if(!d||d.teacherId!==g.user.id)return{success:!1,error:"Unauthorized access to classroom"};let e=await c.prisma.assignment.create({data:{title:b.title,description:b.description,dueDate:b.dueDate,classroomId:a,problems:{create:b.problemIds.map((a,b)=>({problemId:a,order:b}))}}});return(0,f.revalidateTag)(`assignments-classroom-${a}`,"max"),(0,f.revalidateTag)("assignments-all","max"),{success:!0,assignmentId:e.id}}catch(a){return console.error("Create assignment error:",a),{success:!1,error:"Failed to create assignment"}}}async function k(a){let b=(0,f.unstable_cache)(async()=>await c.prisma.assignment.findUnique({where:{id:a},include:{problems:{include:{problem:{select:{id:!0,title:!0,slug:!0,difficulty:!0,type:!0,domain:!0}}},orderBy:{order:"asc"}},classroom:{select:{name:!0,id:!0}}}}),[`assignment-details-${a}`],{tags:[`assignment-${a}`],revalidate:3600});return await b()}async function l(a=1,b=20){let g=await d.auth.api.getSession({headers:await (0,e.headers)()});if(!g?.user)return{assignments:[],pagination:null};let h=new Date;h.setDate(h.getDate()-21);let i=(a-1)*b,j=g.user.id,k=(0,f.unstable_cache)(async()=>{let a=await c.prisma.user.findUnique({where:{id:j},select:{enrolledClassrooms:{select:{id:!0}}}});if(!a||0===a.enrolledClassrooms.length)return{assignments:[],total:0};let d=a.enrolledClassrooms.map(a=>a.id),[e,f]=await Promise.all([c.prisma.assignment.findMany({where:{classroomId:{in:d},createdAt:{gte:h}},include:{classroom:{select:{name:!0}},_count:{select:{problems:!0}}},orderBy:{dueDate:"asc"},skip:i,take:b}),c.prisma.assignment.count({where:{classroomId:{in:d},createdAt:{gte:h}}})]);return{assignments:e,total:f}},[`student-assignments-${j}-page-${a}`],{tags:[`student-assignments-${j}`,"assignments-all"],revalidate:60}),{assignments:m,total:n}=await k();return{assignments:m,pagination:n>0?{total:n,pages:Math.ceil(n/b),current:a,limit:b}:null}}async function m(a,b){let f=await d.auth.api.getSession({headers:await (0,e.headers)()}),h=b||f?.user?.id;if(!h)return null;let i=await k(a);if(!i)return null;let j=i.problems.map(a=>a.problemId),l=(0,g.cacheKey)("assignment-progress",a,h);return await (0,g.cachedFetch)(l,async()=>{let a=new Set((await c.prisma.submission.findMany({where:{userId:h,problemId:{in:j},status:"ACCEPTED"},select:{problemId:!0},distinct:["problemId"]})).map(a=>a.problemId)),b={},d=0;return i.problems.forEach(c=>{let e=a.has(c.problemId);b[c.problemId]=e,e&&d++}),{total:i.problems.length,completed:d,progressMap:b}},g.CACHE_CONFIG.SHORT.ttl)}async function n(a,b,f=1,h=50){let i=await d.auth.api.getSession({headers:await (0,e.headers)()});if(!i?.user||"TEACHER"!==i.user.role)throw Error("Unauthorized");let j=(f-1)*h,k=(0,g.cacheKey)("assignment-analytics",a,b,String(f));return await (0,g.cachedFetch)(k,async()=>{let[d,e,g]=await Promise.all([c.prisma.classroom.findUnique({where:{id:b},select:{students:{select:{id:!0,name:!0,image:!0,email:!0},skip:j,take:h}}}),c.prisma.assignment.findUnique({where:{id:a},include:{problems:{select:{problemId:!0}}}}),c.prisma.user.count({where:{enrolledClassrooms:{some:{id:b}}}})]);if(!d||!e)return null;let i=d.students.map(a=>a.id),k=e.problems.map(a=>a.problemId),l=await c.prisma.submission.findMany({where:{userId:{in:i},problemId:{in:k},status:"ACCEPTED"},select:{userId:!0,problemId:!0}}),m=new Map;return l.forEach(a=>{m.has(a.userId)||m.set(a.userId,new Set),m.get(a.userId).add(a.problemId)}),{analytics:d.students.map(a=>{let b=m.get(a.id)||new Set;return{student:a,completedCount:b.size,totalCount:k.length,completionPercentage:k.length>0?b.size/k.length*100:0,hasCompletedAll:b.size===k.length}}),pagination:{total:g,pages:Math.ceil(g/h),current:f,limit:h}}},g.CACHE_CONFIG.MEDIUM.ttl)}async function o(a){let b=await d.auth.api.getSession({headers:await (0,e.headers)()});if(!b?.user||"TEACHER"!==b.user.role)return{success:!1,error:"Unauthorized"};try{let d=await c.prisma.assignment.findUnique({where:{id:a},include:{classroom:{select:{teacherId:!0,id:!0}}}});if(!d||d.classroom.teacherId!==b.user.id)return{success:!1,error:"Unauthorized"};return await c.prisma.$transaction([c.prisma.assignmentProblem.deleteMany({where:{assignmentId:a}}),c.prisma.assignment.delete({where:{id:a}})]),(0,f.revalidateTag)(`assignment-${a}`,"max"),(0,f.revalidateTag)(`assignments-classroom-${d.classroom.id}`,"max"),(0,f.revalidateTag)("assignments-all","max"),{success:!0}}catch(a){return console.error("Delete assignment error:",a),{success:!1,error:"Failed to delete assignment"}}}(0,a.i(713095).ensureServerEntryExports)([h,i,j,k,l,m,n,o]),(0,b.registerServerReference)(h,"700c4e6486b9377d27cb659a4ae483dea658d585bb",null),(0,b.registerServerReference)(i,"4095cf52719904b827b4deee82f67d5a76149d1129",null),(0,b.registerServerReference)(j,"6003528168c7674a84bb868c01fba11e7a85ec3436",null),(0,b.registerServerReference)(k,"4099ddd2d442f39886d1924e57ac5366b48e0feab2",null),(0,b.registerServerReference)(l,"6056904424410eeba8322d9865e2d963de944ba2a8",null),(0,b.registerServerReference)(m,"602cca1a113fc5f6dd104c638d2e02baf898bef1e6",null),(0,b.registerServerReference)(n,"78f6517bba230a956bb82c20c45f1fb75536890525",null),(0,b.registerServerReference)(o,"409f14d17b68b32800d1b89d54d9c1362f16655a51",null),a.s(["createAssignment",()=>j,"deleteAssignment",()=>o,"getAssignmentDetails",()=>k,"getAssignmentProgress",()=>m,"getClassroomAssignments",()=>h,"getStudentAssignments",()=>l,"getTeacherAssignmentAnalytics",()=>n,"refreshClassroomAssignments",()=>i])},909857,a=>{"use strict";let b=(0,a.i(701269).default)("school",[["path",{d:"M14 21v-3a2 2 0 0 0-4 0v3",key:"1rgiei"}],["path",{d:"M18 5v16",key:"1ethyx"}],["path",{d:"m4 6 7.106-3.79a2 2 0 0 1 1.788 0L20 6",key:"zywc2d"}],["path",{d:"m6 11-3.52 2.147a1 1 0 0 0-.48.854V19a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-5a1 1 0 0 0-.48-.853L18 11",key:"1d4ql0"}],["path",{d:"M6 5v16",key:"1sn0nx"}],["circle",{cx:"12",cy:"9",r:"2",key:"1092wv"}]]);a.s(["School",()=>b],909857)},355526,a=>{"use strict";a.s(["ClassroomDashboard",()=>b]);let b=(0,a.i(211857).registerClientReference)(function(){throw Error("Attempted to call ClassroomDashboard() from the server but ClassroomDashboard is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/components/classroom/ClassroomDashboard.tsx <module evaluation>","ClassroomDashboard")},658115,a=>{"use strict";a.s(["ClassroomDashboard",()=>b]);let b=(0,a.i(211857).registerClientReference)(function(){throw Error("Attempted to call ClassroomDashboard() from the server but ClassroomDashboard is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/components/classroom/ClassroomDashboard.tsx","ClassroomDashboard")},528423,a=>{"use strict";a.i(355526);var b=a.i(658115);a.n(b)},673735,a=>{"use strict";var b=a.i(907997),c=a.i(137936),d=a.i(402597),e=a.i(800717),f=a.i(405781),g=a.i(528423),h=a.i(409223),i=a.i(905246);a.i(570396);var j=a.i(673727),k=a.i(395936),l=a.i(713743),m=a.i(909857);let n=async function({params:a}){let{id:c}=await a,d=await h.auth.api.getSession({headers:await (0,i.headers)()});d?.user||(0,j.redirect)("/signin");let e=await (0,f.getClassroomWithStudents)(c);if(!e.success||!e.classroom)return(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-white dark:bg-[#0a0a0a] p-6",children:(0,b.jsxs)("div",{className:"text-center max-w-sm",children:[(0,b.jsx)("div",{className:"p-4 bg-gray-50 dark:bg-[#1a1a1a] rounded-3xl mb-6 inline-block",children:(0,b.jsx)(m.School,{className:"w-12 h-12 text-gray-300 dark:text-gray-600"})}),(0,b.jsx)("h1",{className:"text-3xl font-black text-gray-900 dark:text-white mb-2 tracking-tighter",children:"Classroom Not Found"}),(0,b.jsxs)(k.default,{href:"/dashboard/classrooms",className:"inline-flex items-center gap-2 text-orange-600 dark:text-orange-500 font-bold",children:[(0,b.jsx)(l.ArrowLeft,{className:"w-5 h-5"}),"Back to Hub"]})]})});let n=e.classroom;return(0,b.jsx)(g.ClassroomDashboard,{classroom:n,currentUserId:d.user.id})};var o=(0,e.cache)(function(){return(0,d.cache)("private","c0c910ffaeadb5655b8799d56a6573193c01a2861a",0,n,arguments)});function p({params:a}){return(0,b.jsx)(e.Suspense,{fallback:(0,b.jsx)("div",{className:"min-h-screen bg-white dark:bg-[#0a0a0a] flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500 mx-auto"}),(0,b.jsx)("p",{className:"mt-4 text-gray-600 dark:text-gray-400",children:"Loading classroom..."})]})}),children:(0,b.jsx)(o,{params:a})})}(0,c.registerServerReference)(o,"c0c910ffaeadb5655b8799d56a6573193c01a2861a",null),Object.defineProperty(o,"name",{value:"ClassroomDetailContent"}),a.s(["$$RSC_SERVER_CACHE_0",()=>o,"default",()=>p])},122916,a=>{"use strict";var b=a.i(191679),c=a.i(154470),d=a.i(673735),e=a.i(405781),f=a.i(587313),g=a.i(165099);a.s([],729768),a.i(729768),a.s(["002a588abb136c6f86adadd291e7fdda7347bfa1e9",()=>e.getTeacherClassrooms,"00dc41dbc84f1082ddd9f6a9207eb5b406ea5c543e",()=>e.getStudentClassrooms,"00f4c838ce10f91796a39f1558a3b75432fa49882a",()=>b.checkSessionConflict,"4037d92f3a67eb2428d5b2dab919914d5756aace36",()=>e.getClassroomByCode,"4052b0471161707b49db8311132ddb7c92790d847f",()=>e.joinClassroom,"405d122aba3f5928800ed130a7b71a1b47271751ba",()=>e.createClassroom,"4095cf52719904b827b4deee82f67d5a76149d1129",()=>f.refreshClassroomAssignments,"409bc5870257fe05de038549e85b0722c4e09c83d4",()=>b.resolveSessionConflict,"40e294f0f9e4303d3615ddc6a66cada537036c1b97",()=>e.getClassroomLiveTracking,"60034d10a668ce8353cc35e9db8784a8a275d2b2e0",()=>e.toggleClassroomTracking,"6003528168c7674a84bb868c01fba11e7a85ec3436",()=>f.createAssignment,"602532808556a300ed5e0f4a5f69437cc6db044dc7",()=>e.removeStudentFromClassroom,"6029e68e22d85ff157089c99e60915beba555ec65d",()=>e.getInstitutionClassrooms,"700c4e6486b9377d27cb659a4ae483dea658d585bb",()=>f.getClassroomAssignments,"700d160d9099ae66508f5d181cf879265ecd403e7d",()=>e.getClassroomWithStudents,"78f6517bba230a956bb82c20c45f1fb75536890525",()=>f.getTeacherAssignmentAnalytics,"80ee7282f708e60661ecc42477a6d2afba42f1d5ed",()=>c.getUserScore,"c0c910ffaeadb5655b8799d56a6573193c01a2861a",()=>d.$$RSC_SERVER_CACHE_0,"f07500676e7437c89c7059a3d08b36e62d85af89e8",()=>g.searchProblems],122916)},1067,a=>{a.v(a=>Promise.resolve().then(()=>a(167784)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__e67d89b3._.js.map