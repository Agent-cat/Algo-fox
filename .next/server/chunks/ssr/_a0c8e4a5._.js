module.exports=[338253,a=>{"use strict";var b=a.i(137936),c=a.i(402597),d=a.i(800717),e=a.i(409223),f=a.i(905246),g=a.i(231191),h=a.i(463021),i=a.i(118558),j=a.i(713095);let k=async function(){(0,i.cacheLife)({stale:900,revalidate:900}),(0,i.cacheTag)("course-allocations");try{let a=await g.prisma.courseAllocation.findMany({orderBy:[{year:"asc"},{domain:"asc"}]});return{success:!0,allocations:a}}catch(a){return console.error("Error fetching course allocations:",a),{success:!1,error:"Failed to fetch course allocations"}}};var l=(0,d.cache)(function(){return(0,c.cache)("default","80acd0e5cdc01b35c11a77653c46d7535a3eaba534",0,k,arguments)});(0,b.registerServerReference)(l,"80acd0e5cdc01b35c11a77653c46d7535a3eaba534",null),Object.defineProperty(l,"name",{value:"getCourseAllocations"});let m=async function(a){(0,i.cacheLife)({stale:900,revalidate:900}),(0,i.cacheTag)("course-allocations",`course-year-${a}`);try{let b=await g.prisma.courseAllocation.findMany({where:{year:a},select:{domain:!0}});return{success:!0,domains:b.map(a=>a.domain)}}catch(a){return console.error("Error fetching courses by year:",a),{success:!1,error:"Failed to fetch courses",domains:[]}}};var n=(0,d.cache)(function(){return(0,c.cache)("default","c0dd08b727db429b3d86d07cae53567fbf3e0e70e9",0,m,arguments)});(0,b.registerServerReference)(n,"c0dd08b727db429b3d86d07cae53567fbf3e0e70e9",null),Object.defineProperty(n,"name",{value:"getCoursesByYear"});let o=async function(){(0,i.cacheLife)({stale:900,revalidate:900});let a=await e.auth.api.getSession({headers:await (0,f.headers)()});if(!a?.user)return{success:!1,error:"Unauthorized",domains:[]};let b=a.user.id;(0,i.cacheTag)(`user-courses-${b}`);try{let a=await g.prisma.user.findUnique({where:{id:b},select:{year:!0,role:!0}});if(!a)return{success:!1,error:"User not found",domains:[]};if(["ADMIN","TEACHER","INSTITUTION_MANAGER","CONTEST_MANAGER"].includes(a.role))return{success:!0,domains:Object.values(h.ProblemDomain),isPrivileged:!0};if(!a.year)return{success:!0,domains:[],isPrivileged:!1};let c=await g.prisma.courseAllocation.findMany({where:{year:a.year},select:{domain:!0}});return{success:!0,domains:c.map(a=>a.domain),isPrivileged:!1}}catch(a){return console.error("Error fetching user allocated courses:",a),{success:!1,error:"Failed to fetch courses",domains:[]}}};var p=(0,d.cache)(function(){return(0,c.cache)("private","8086c1a77f679988322147222ee681d1ea6c8bf63b",0,o,arguments)});async function q(a,b){let c=await e.auth.api.getSession({headers:await (0,f.headers)()});if(!c?.user)return{success:!1,error:"Unauthorized"};if(!["ADMIN","INSTITUTION_MANAGER"].includes(c.user.role))return{success:!1,error:"Insufficient permissions"};try{return await g.prisma.courseAllocation.create({data:{year:a,domain:b}}),(0,i.revalidatePath)("/admin/course-allocation"),(0,i.revalidatePath)("/dashboard/institution/course-allocation"),(0,i.revalidatePath)("/problems"),{success:!0}}catch(a){if(console.error("Error allocating course:",a),"P2002"===a.code)return{success:!1,error:"Course already allocated to this year"};return{success:!1,error:"Failed to allocate course"}}}async function r(a,b){let c=await e.auth.api.getSession({headers:await (0,f.headers)()});if(!c?.user)return{success:!1,error:"Unauthorized"};if(!["ADMIN","INSTITUTION_MANAGER"].includes(c.user.role))return{success:!1,error:"Insufficient permissions"};try{return await g.prisma.courseAllocation.delete({where:{year_domain:{year:a,domain:b}}}),(0,i.revalidatePath)("/admin/course-allocation"),(0,i.revalidatePath)("/dashboard/institution/course-allocation"),(0,i.revalidatePath)("/problems"),{success:!0}}catch(a){return console.error("Error removing course allocation:",a),{success:!1,error:"Failed to remove allocation"}}}async function s(a,b){let c=await e.auth.api.getSession({headers:await (0,f.headers)()});if(!c?.user)return{success:!1,error:"Unauthorized"};if(!["ADMIN","INSTITUTION_MANAGER"].includes(c.user.role))return{success:!1,error:"Insufficient permissions"};try{return await g.prisma.courseAllocation.deleteMany({where:{year:a}}),b.length>0&&await g.prisma.courseAllocation.createMany({data:b.map(b=>({year:a,domain:b}))}),(0,i.revalidatePath)("/admin/course-allocation"),(0,i.revalidatePath)("/dashboard/institution/course-allocation"),(0,i.revalidatePath)("/problems"),{success:!0}}catch(a){return console.error("Error updating year allocations:",a),{success:!1,error:"Failed to update allocations"}}}(0,b.registerServerReference)(p,"8086c1a77f679988322147222ee681d1ea6c8bf63b",null),Object.defineProperty(p,"name",{value:"getUserAllocatedCourses"}),(0,j.ensureServerEntryExports)([q,r,s]),(0,b.registerServerReference)(q,"6053406d501a7d100a71d59fc57a4cf00b4de33871",null),(0,b.registerServerReference)(r,"60d31e458fff4a256f0b5e0352ddb7776d5ecf338d",null),(0,b.registerServerReference)(s,"60c2e1a72d096d3c7e7e0c1e61858d61d675213bad",null),a.s(["$$RSC_SERVER_CACHE_0",()=>l,"$$RSC_SERVER_CACHE_1",()=>n,"$$RSC_SERVER_CACHE_2",()=>p,"allocateCourse",()=>q,"getCourseAllocations",()=>l,"getUserAllocatedCourses",()=>p,"removeCourseAllocation",()=>r,"updateYearAllocations",()=>s])},457309,a=>{"use strict";var b=a.i(191679),c=a.i(154470),d=a.i(338253);a.s([],801808),a.i(801808),a.s(["00f4c838ce10f91796a39f1558a3b75432fa49882a",()=>b.checkSessionConflict,"409bc5870257fe05de038549e85b0722c4e09c83d4",()=>b.resolveSessionConflict,"80acc4fbdb1d18310399913f74806d50b70763f4fa",()=>d.getUserAllocatedCourses,"80ee7282f708e60661ecc42477a6d2afba42f1d5ed",()=>c.getUserScore],457309)},588010,a=>{a.v(b=>Promise.all(["server/chunks/ssr/node_modules_better-auth_dist_adapters_memory-adapter_index_mjs_35d2dbfd._.js"].map(b=>a.l(b))).then(()=>b(700031)))},860484,a=>{a.v(b=>Promise.all(["server/chunks/ssr/node_modules_better-auth_dist_adapters_kysely-adapter_index_mjs_0abbd964._.js"].map(b=>a.l(b))).then(()=>b(536063)))},946014,a=>{a.v(b=>Promise.all(["server/chunks/ssr/a9bf9_better-auth_dist_adapters_kysely-adapter_bun-sqlite-dialect_mjs_23698f07._.js"].map(b=>a.l(b))).then(()=>b(496824)))},945599,a=>{a.v(b=>Promise.all(["server/chunks/ssr/a9bf9_better-auth_dist_adapters_kysely-adapter_node-sqlite-dialect_mjs_9102e2ec._.js"].map(b=>a.l(b))).then(()=>b(68928)))},1067,a=>{a.v(a=>Promise.resolve().then(()=>a(167784)))}];

//# sourceMappingURL=_a0c8e4a5._.js.map