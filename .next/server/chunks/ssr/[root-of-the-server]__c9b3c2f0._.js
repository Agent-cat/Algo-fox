module.exports=[463021,(a,b,c)=>{b.exports=a.x("@prisma/client-2c3a283f134fdcb6",()=>require("@prisma/client-2c3a283f134fdcb6"))},434270,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/module-loading/track-module-loading.external.js",()=>require("next/dist/server/app-render/module-loading/track-module-loading.external.js"))},118129,944309,a=>{"use strict";var b=a.i(123651);a.s([],118129),a.s(["logger",()=>b.i],944309)},231191,a=>{"use strict";var b=a.i(463021);let c=globalThis.prisma_fox??new b.PrismaClient({log:["error"]}).$extends({query:{$allModels:{async $allOperations({operation:a,model:b,args:c,query:d}){let e=performance.now(),f=await d(c),g=performance.now();return g-e>1e3&&console.warn(`Slow query: ${b}.${a} took ${(g-e).toFixed(2)}ms`),f}}}});a.s(["prisma",()=>c])},137936,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"registerServerReference",{enumerable:!0,get:function(){return d.registerServerReference}});let d=a.r(211857)},713095,(a,b,c)=>{"use strict";function d(a){for(let b=0;b<a.length;b++){let c=a[b];if("function"!=typeof c)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof c}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"ensureServerEntryExports",{enumerable:!0,get:function(){return d}})},792509,(a,b,c)=>{b.exports=a.x("url",()=>require("url"))},688947,(a,b,c)=>{b.exports=a.x("stream",()=>require("stream"))},191679,a=>{"use strict";var b=a.i(137936),c=a.i(409223),d=a.i(231191),e=a.i(905246);async function f(){let a=await c.auth.api.getSession({headers:await (0,e.headers)()});if(!a)return{conflict:!1};let b=(await d.prisma.session.findMany({where:{userId:a.user.id},select:{id:!0,expiresAt:!0,userAgent:!0,ipAddress:!0,token:!0}})).filter(a=>a.expiresAt>new Date);return b.length>1?{conflict:!0,currentSessionToken:a.session.token,sessions:b.map(b=>({...b,isCurrent:b.token===a.session.token}))}:{conflict:!1}}async function g(a){let b=await c.auth.api.getSession({headers:await (0,e.headers)()});if(!b)throw Error("No active session");return"LOGOUT_OTHERS"===a?(await d.prisma.session.deleteMany({where:{userId:b.user.id,token:{not:b.session.token}}}),{success:!0,message:"Other sessions terminated"}):"LOGOUT_CURRENT"===a?(await d.prisma.session.delete({where:{token:b.session.token}}),{success:!0,message:"Current session terminated"}):void 0}(0,a.i(713095).ensureServerEntryExports)([f,g]),(0,b.registerServerReference)(f,"00f4c838ce10f91796a39f1558a3b75432fa49882a",null),(0,b.registerServerReference)(g,"409bc5870257fe05de038549e85b0722c4e09c83d4",null),a.s(["checkSessionConflict",()=>f,"resolveSessionConflict",()=>g])},340499,a=>{"use strict";var b=a.i(167784);let c={SHORT:{ttl:30,stale:15},MEDIUM:{ttl:120,stale:60},LONG:{ttl:600,stale:300},STATIC:{ttl:3600,stale:1800}};function d(a,...b){return`algofox:${a}:${b.join(":")}`}async function e(a){try{let c=await b.default.get(a);if(!c)return null;return JSON.parse(c)}catch(a){return console.error("[Cache] Get error:",a),null}}async function f(a,d,e=c.MEDIUM.ttl){try{await b.default.setex(a,e,JSON.stringify(d))}catch(a){console.error("[Cache] Set error:",a)}}async function g(a){try{await b.default.del(a)}catch(a){console.error("[Cache] Delete error:",a)}}async function h(a,b,d=c.MEDIUM.ttl){let g=await e(a);if(null!==g)return g;let i=await b();return f(a,i,d).catch(()=>{}),i}a.s(["CACHE_CONFIG",0,c,"cacheKey",()=>d,"cachedFetch",()=>h,"deleteFromCache",()=>g])},587313,a=>{"use strict";var b=a.i(137936),c=a.i(231191),d=a.i(409223),e=a.i(905246),f=a.i(118558),g=a.i(340499);async function h(a,b=1,d=20){let e=new Date;e.setDate(e.getDate()-21);let g=(b-1)*d,i=(0,f.unstable_cache)(async()=>{let[b,f]=await Promise.all([c.prisma.assignment.findMany({where:{classroomId:a,createdAt:{gte:e}},include:{_count:{select:{problems:!0}}},orderBy:{createdAt:"desc"},skip:g,take:d}),c.prisma.assignment.count({where:{classroomId:a,createdAt:{gte:e}}})]);return{assignments:b,total:f}},[`classroom-assignments-${a}-page-${b}`],{tags:[`assignments-classroom-${a}`,"assignments-all"],revalidate:60}),{assignments:j,total:k}=await i();return{assignments:j,pagination:{total:k,pages:Math.ceil(k/d),current:b,limit:d}}}async function i(a){let b=new Date;return b.setDate(b.getDate()-21),await c.prisma.assignment.findMany({where:{classroomId:a,createdAt:{gte:b}},include:{_count:{select:{problems:!0}}},orderBy:{createdAt:"desc"}})}async function j(a,b){let g=await d.auth.api.getSession({headers:await (0,e.headers)()});if(!g?.user||"TEACHER"!==g.user.role)return{success:!1,error:"Unauthorized"};try{let d=await c.prisma.classroom.findUnique({where:{id:a},select:{teacherId:!0}});if(!d||d.teacherId!==g.user.id)return{success:!1,error:"Unauthorized access to classroom"};let e=await c.prisma.assignment.create({data:{title:b.title,description:b.description,dueDate:b.dueDate,classroomId:a,problems:{create:b.problemIds.map((a,b)=>({problemId:a,order:b}))}}});return(0,f.revalidateTag)(`assignments-classroom-${a}`,"max"),(0,f.revalidateTag)("assignments-all","max"),{success:!0,assignmentId:e.id}}catch(a){return console.error("Create assignment error:",a),{success:!1,error:"Failed to create assignment"}}}async function k(a){let b=(0,f.unstable_cache)(async()=>await c.prisma.assignment.findUnique({where:{id:a},include:{problems:{include:{problem:{select:{id:!0,title:!0,slug:!0,difficulty:!0,type:!0,domain:!0}}},orderBy:{order:"asc"}},classroom:{select:{name:!0,id:!0}}}}),[`assignment-details-${a}`],{tags:[`assignment-${a}`],revalidate:3600});return await b()}async function l(a=1,b=20){let g=await d.auth.api.getSession({headers:await (0,e.headers)()});if(!g?.user)return{assignments:[],pagination:null};let h=new Date;h.setDate(h.getDate()-21);let i=(a-1)*b,j=g.user.id,k=(0,f.unstable_cache)(async()=>{let a=await c.prisma.user.findUnique({where:{id:j},select:{enrolledClassrooms:{select:{id:!0}}}});if(!a||0===a.enrolledClassrooms.length)return{assignments:[],total:0};let d=a.enrolledClassrooms.map(a=>a.id),[e,f]=await Promise.all([c.prisma.assignment.findMany({where:{classroomId:{in:d},createdAt:{gte:h}},include:{classroom:{select:{name:!0}},_count:{select:{problems:!0}}},orderBy:{dueDate:"asc"},skip:i,take:b}),c.prisma.assignment.count({where:{classroomId:{in:d},createdAt:{gte:h}}})]);return{assignments:e,total:f}},[`student-assignments-${j}-page-${a}`],{tags:[`student-assignments-${j}`,"assignments-all"],revalidate:60}),{assignments:m,total:n}=await k();return{assignments:m,pagination:n>0?{total:n,pages:Math.ceil(n/b),current:a,limit:b}:null}}async function m(a,b){let f=await d.auth.api.getSession({headers:await (0,e.headers)()}),h=b||f?.user?.id;if(!h)return null;let i=await k(a);if(!i)return null;let j=i.problems.map(a=>a.problemId),l=(0,g.cacheKey)("assignment-progress",a,h);return await (0,g.cachedFetch)(l,async()=>{let a=new Set((await c.prisma.submission.findMany({where:{userId:h,problemId:{in:j},status:"ACCEPTED"},select:{problemId:!0},distinct:["problemId"]})).map(a=>a.problemId)),b={},d=0;return i.problems.forEach(c=>{let e=a.has(c.problemId);b[c.problemId]=e,e&&d++}),{total:i.problems.length,completed:d,progressMap:b}},g.CACHE_CONFIG.SHORT.ttl)}async function n(a,b,f=1,h=50){let i=await d.auth.api.getSession({headers:await (0,e.headers)()});if(!i?.user||"TEACHER"!==i.user.role)throw Error("Unauthorized");let j=(f-1)*h,k=(0,g.cacheKey)("assignment-analytics",a,b,String(f));return await (0,g.cachedFetch)(k,async()=>{let[d,e,g]=await Promise.all([c.prisma.classroom.findUnique({where:{id:b},select:{students:{select:{id:!0,name:!0,image:!0,email:!0},skip:j,take:h}}}),c.prisma.assignment.findUnique({where:{id:a},include:{problems:{select:{problemId:!0}}}}),c.prisma.user.count({where:{enrolledClassrooms:{some:{id:b}}}})]);if(!d||!e)return null;let i=d.students.map(a=>a.id),k=e.problems.map(a=>a.problemId),l=await c.prisma.submission.findMany({where:{userId:{in:i},problemId:{in:k},status:"ACCEPTED"},select:{userId:!0,problemId:!0}}),m=new Map;return l.forEach(a=>{m.has(a.userId)||m.set(a.userId,new Set),m.get(a.userId).add(a.problemId)}),{analytics:d.students.map(a=>{let b=m.get(a.id)||new Set;return{student:a,completedCount:b.size,totalCount:k.length,completionPercentage:k.length>0?b.size/k.length*100:0,hasCompletedAll:b.size===k.length}}),pagination:{total:g,pages:Math.ceil(g/h),current:f,limit:h}}},g.CACHE_CONFIG.MEDIUM.ttl)}async function o(a){let b=await d.auth.api.getSession({headers:await (0,e.headers)()});if(!b?.user||"TEACHER"!==b.user.role)return{success:!1,error:"Unauthorized"};try{let d=await c.prisma.assignment.findUnique({where:{id:a},include:{classroom:{select:{teacherId:!0,id:!0}}}});if(!d||d.classroom.teacherId!==b.user.id)return{success:!1,error:"Unauthorized"};return await c.prisma.$transaction([c.prisma.assignmentProblem.deleteMany({where:{assignmentId:a}}),c.prisma.assignment.delete({where:{id:a}})]),(0,f.revalidateTag)(`assignment-${a}`,"max"),(0,f.revalidateTag)(`assignments-classroom-${d.classroom.id}`,"max"),(0,f.revalidateTag)("assignments-all","max"),{success:!0}}catch(a){return console.error("Delete assignment error:",a),{success:!1,error:"Failed to delete assignment"}}}(0,a.i(713095).ensureServerEntryExports)([h,i,j,k,l,m,n,o]),(0,b.registerServerReference)(h,"700c4e6486b9377d27cb659a4ae483dea658d585bb",null),(0,b.registerServerReference)(i,"4095cf52719904b827b4deee82f67d5a76149d1129",null),(0,b.registerServerReference)(j,"6003528168c7674a84bb868c01fba11e7a85ec3436",null),(0,b.registerServerReference)(k,"4099ddd2d442f39886d1924e57ac5366b48e0feab2",null),(0,b.registerServerReference)(l,"6056904424410eeba8322d9865e2d963de944ba2a8",null),(0,b.registerServerReference)(m,"602cca1a113fc5f6dd104c638d2e02baf898bef1e6",null),(0,b.registerServerReference)(n,"78f6517bba230a956bb82c20c45f1fb75536890525",null),(0,b.registerServerReference)(o,"409f14d17b68b32800d1b89d54d9c1362f16655a51",null),a.s(["createAssignment",()=>j,"deleteAssignment",()=>o,"getAssignmentDetails",()=>k,"getAssignmentProgress",()=>m,"getClassroomAssignments",()=>h,"getStudentAssignments",()=>l,"getTeacherAssignmentAnalytics",()=>n,"refreshClassroomAssignments",()=>i])},162063,a=>{"use strict";var b=a.i(191679),c=a.i(587313);a.s([],981445),a.i(981445),a.s(["00f4c838ce10f91796a39f1558a3b75432fa49882a",()=>b.checkSessionConflict,"4095cf52719904b827b4deee82f67d5a76149d1129",()=>c.refreshClassroomAssignments,"4099ddd2d442f39886d1924e57ac5366b48e0feab2",()=>c.getAssignmentDetails,"409bc5870257fe05de038549e85b0722c4e09c83d4",()=>b.resolveSessionConflict,"409f14d17b68b32800d1b89d54d9c1362f16655a51",()=>c.deleteAssignment,"6003528168c7674a84bb868c01fba11e7a85ec3436",()=>c.createAssignment,"602cca1a113fc5f6dd104c638d2e02baf898bef1e6",()=>c.getAssignmentProgress,"6056904424410eeba8322d9865e2d963de944ba2a8",()=>c.getStudentAssignments,"700c4e6486b9377d27cb659a4ae483dea658d585bb",()=>c.getClassroomAssignments,"78f6517bba230a956bb82c20c45f1fb75536890525",()=>c.getTeacherAssignmentAnalytics],162063)},588010,a=>{a.v(b=>Promise.all(["server/chunks/ssr/node_modules_better-auth_dist_adapters_memory-adapter_index_mjs_35d2dbfd._.js"].map(b=>a.l(b))).then(()=>b(700031)))},860484,a=>{a.v(b=>Promise.all(["server/chunks/ssr/node_modules_better-auth_dist_adapters_kysely-adapter_index_mjs_0abbd964._.js"].map(b=>a.l(b))).then(()=>b(536063)))},946014,a=>{a.v(b=>Promise.all(["server/chunks/ssr/a9bf9_better-auth_dist_adapters_kysely-adapter_bun-sqlite-dialect_mjs_23698f07._.js"].map(b=>a.l(b))).then(()=>b(496824)))},945599,a=>{a.v(b=>Promise.all(["server/chunks/ssr/a9bf9_better-auth_dist_adapters_kysely-adapter_node-sqlite-dialect_mjs_9102e2ec._.js"].map(b=>a.l(b))).then(()=>b(68928)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__c9b3c2f0._.js.map