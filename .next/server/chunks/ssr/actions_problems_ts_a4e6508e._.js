module.exports=[165099,a=>{"use strict";var b=a.i(137936),c=a.i(402597),d=a.i(800717),e=a.i(231191),f=a.i(167784);let g=a=>`problem:${a}`;class h{static async getCachedProblems(a,b,c,d="DSA",g,h=[],i){let j=i?`problems:list:${d}:${c}:cursor:${i}:pageSize:${b}:diff:${g||"all"}:tags:${h.sort().join(",")}`:((a,b,c,d,e=[])=>`problems:list:${b}:${a}:page:${c}:diff:${d||"all"}:tags:${e.sort().join(",")}`)(c,d,a,g,h);try{let a=await f.default.get(j);if(a)return JSON.parse(a)}catch(a){console.error("Redis get error:",a)}let k={where:{type:c,domain:d,difficulty:g,hidden:!1,tags:h.length>0?{some:{slug:{in:h}}}:void 0},take:b,orderBy:{createdAt:"desc"},select:{id:!0,title:!0,slug:!0,difficulty:!0,score:!0,solved:!0,createdAt:!0,type:!0,_count:{select:{submissions:!0}},tags:{select:{name:!0,slug:!0}}}};i?(k.cursor={id:i},k.skip=1):k.skip=(a-1)*b;let[l,m]=await Promise.all([e.prisma.problem.findMany(k),e.prisma.problem.count({where:{type:c,domain:d,difficulty:g,hidden:!1,tags:h.length>0?{some:{slug:{in:h}}}:void 0}})]),n={problems:l,total:m};try{await f.default.setex(j,300,JSON.stringify(n))}catch(a){console.error("Redis set error:",a)}return n}static async getProblems(a=1,b=10,c="PRACTICE",d="DSA",f,g,h=[],i){let{problems:j,total:k}=await this.getCachedProblems(a,b,c,d,g,h,i),l=new Set;if(f&&j.length>0){let a=j.map(a=>a.id);l=new Set((await e.prisma.submission.findMany({where:{userId:f,problemId:{in:a},status:"ACCEPTED",mode:"SUBMIT"},select:{problemId:!0},distinct:["problemId"]})).map(a=>a.problemId))}return{problems:j.map(a=>({...a,isSolved:l.has(a.id),acceptance:a._count.submissions>0?(a.solved||0)/a._count.submissions*100:0})),totalPages:Math.ceil(k/b),currentPage:a,total:k}}static async getAdminProblems(a=1,b=50,c,d,g){let h=`admin:problems:${c||"all"}:page:${a}`;try{await f.default.get(h)}catch(a){console.error("Redis get error:",a)}let i=c?{domain:c}:{};g?i.type=g:i.type={not:"CONTEST"},d&&(i.difficulty={not:d});let[j,k]=await Promise.all([e.prisma.problem.findMany({where:i,skip:(a-1)*b,take:b,orderBy:{createdAt:"desc"},select:{id:!0,title:!0,slug:!0,difficulty:!0,hidden:!0,score:!0,type:!0,domain:!0,createdAt:!0,updatedAt:!0}}),e.prisma.problem.count({where:i})]),l={problems:j,totalPages:Math.ceil(k/b),currentPage:a,total:k};try{await f.default.setex(h,300,JSON.stringify(l))}catch(a){console.error("Redis set error:",a)}return l}static async searchProblems(a,b="PRACTICE",c="DSA",d){let f=await e.prisma.problem.findMany({where:{type:b,domain:c,hidden:!1,title:{contains:a,mode:"insensitive"}},take:10,orderBy:{createdAt:"desc"},select:{id:!0,title:!0,slug:!0,difficulty:!0,score:!0,solved:!0,createdAt:!0,type:!0,_count:{select:{submissions:!0}},tags:{select:{name:!0,slug:!0}}}}),g=new Set;if(d&&f.length>0){let a=f.map(a=>a.id);g=new Set((await e.prisma.submission.findMany({where:{userId:d,problemId:{in:a},status:"ACCEPTED",mode:"SUBMIT"},select:{problemId:!0},distinct:["problemId"]})).map(a=>a.problemId))}return{problems:f.map(a=>({...a,isSolved:g.has(a.id),acceptance:a._count.submissions>0?(a.solved||0)/a._count.submissions*100:0}))}}static async getCachedProblem(a){let b=g(a);try{let a=await f.default.get(b);if(a)return JSON.parse(a)}catch(a){console.error("Redis get error:",a)}let c=await e.prisma.problem.findUnique({where:{slug:a},include:{testCases:!0,user:{select:{name:!0,image:!0}},tags:{select:{name:!0,slug:!0}},functionTemplates:!0}});if(c)try{await f.default.setex(b,3600,JSON.stringify(c))}catch(a){console.error("Redis set error:",a)}return c}static async getProblem(a){return await this.getCachedProblem(a)}static async getProblemById(a){try{let b=await e.prisma.problem.findUnique({where:{id:a},include:{testCases:!0,tags:{select:{name:!0,slug:!0}},functionTemplates:!0}});return{success:!0,data:b}}catch(a){return console.error("Failed to get problem by id:",a),{success:!1,error:"Failed to get problem by id"}}}static async getNextProblem(a,b,c){try{let d=await e.prisma.problem.findFirst({where:{domain:b,type:c,hidden:!1,createdAt:{lt:a}},orderBy:{createdAt:"desc"},select:{slug:!0}});return d?.slug||null}catch(a){return console.error("Failed to get next problem:",a),null}}static async getPreviousProblem(a,b,c){try{let d=await e.prisma.problem.findFirst({where:{domain:b,type:c,hidden:!1,createdAt:{gt:a}},orderBy:{createdAt:"asc"},select:{slug:!0}});return d?.slug||null}catch(a){return console.error("Failed to get previous problem:",a),null}}static async getRandomProblem(a,b){try{let c=await e.prisma.problem.count({where:{domain:a,type:b,hidden:!1}});if(0===c)return null;let d=Math.floor(Math.random()*c),f=await e.prisma.problem.findFirst({where:{domain:a,type:b,hidden:!1},skip:d,select:{slug:!0}});return f?.slug||null}catch(a){return console.error("Failed to get random problem:",a),null}}static async createProblem(a){try{let b=await e.prisma.problem.create({data:{title:a.title,description:a.description,difficulty:a.difficulty,slug:a.slug,score:10,hidden:a.hidden,hiddenQuery:a.hiddenQuery||null,domain:a.domain||"DSA",useFunctionTemplate:a.useFunctionTemplate||!1,solution:a.solution||null,testCases:{create:a.testCases.map(a=>({input:a.input,output:a.output,hidden:a.hidden??!1}))},tags:a.tags?{connect:a.tags.map(a=>({slug:a}))}:void 0,functionTemplates:a.useFunctionTemplate&&a.functionTemplates?.length?{create:a.functionTemplates.map(a=>({languageId:a.languageId,functionTemplate:a.functionTemplate,driverCode:a.driverCode}))}:void 0}});return await this.invalidateProblemCaches(),{success:!0,problem:b}}catch(a){return console.error("Failed to create problem:",a),{success:!1,error:"Failed to create problem"}}}static async updateProblem(a,b){try{let{testCases:c,tags:d,functionTemplates:h,...i}=b,j={...i};c&&(j.testCases={deleteMany:{},create:c.map(a=>({input:a.input,output:a.output,hidden:a.hidden??!1}))}),d&&(j.tags={set:[],connect:d.map(a=>({slug:a}))}),void 0!==h&&(j.functionTemplates={deleteMany:{},create:h.map(a=>({languageId:a.languageId,functionTemplate:a.functionTemplate,driverCode:a.driverCode}))});let k=await e.prisma.problem.update({where:{id:a},data:j});return await this.invalidateProblemCaches(),await f.default.del(g(k.slug)),await f.default.del(`problem-templates:${a}`),{success:!0,data:k}}catch(a){return console.error("Failed to update problem:",a),{success:!1,error:"Failed to update problem"}}}static async deleteProblem(a){try{let b=await e.prisma.problem.findUnique({where:{id:a},select:{slug:!0}});return await e.prisma.problem.delete({where:{id:a}}),await this.invalidateProblemCaches(),b&&await f.default.del(g(b.slug)),{success:!0}}catch(a){return console.error("Failed to delete problem:",a),{success:!1,error:"Failed to delete problem"}}}static async invalidateProblemCaches(){let a=await f.default.keys("problems:list:*");a.length>0&&await f.default.del(...a);let b=await f.default.keys("admin:problems:*");b.length>0&&await f.default.del(...b)}}var i=a.i(905246),j=a.i(409223),k=a.i(118558),l=a.i(713095);let m=async function(a=1,b=10,c="PRACTICE",d="DSA",e,f,g){(0,k.cacheLife)({stale:900,revalidate:900});let l=await j.auth.api.getSession({headers:await (0,i.headers)()}),m=l?.user?.id,n=`problems-${d}-${c}${e?`-${e}`:""}${f&&f.length>0?`-${f.join("-")}`:""}${g?`-cursor-${g}`:`-page-${a}`}${m?`-user-${m}`:""}`;return(0,k.cacheTag)(n,"problems-list",`problems-${d}-${c}`),h.getProblems(a,b,c,d,m,e,f||[],g)};var n=(0,d.cache)(function(){return(0,c.cache)("private","ff6bc2d62895e81f7126d34f9a415b147fa12a5d49",0,m,arguments)});(0,b.registerServerReference)(n,"ff6bc2d62895e81f7126d34f9a415b147fa12a5d49",null),Object.defineProperty(n,"name",{value:"getProblems"});let o=async function(a=1,b=50,c,d,e){(0,k.cacheLife)({stale:900,revalidate:900});let f=await j.auth.api.getSession({headers:await (0,i.headers)()});if(!f||"ADMIN"!==f.user.role)throw Error("Unauthorized");let g=`admin-problems-${c||"all"}${d?`-exclude-${d}`:""}${e?`-type-${e}`:""}-page-${a}`;return(0,k.cacheTag)(g,"admin-problems-list"),h.getAdminProblems(a,b,c,d,e)};var p=(0,d.cache)(function(){return(0,c.cache)("private","fc6089c08b8fd4da2ff5bc9722749dd142f0f694c9",0,o,arguments)});(0,b.registerServerReference)(p,"fc6089c08b8fd4da2ff5bc9722749dd142f0f694c9",null),Object.defineProperty(p,"name",{value:"getAdminProblems"});let q=async function(a,b="PRACTICE",c="DSA"){(0,k.cacheLife)({stale:300,revalidate:300});let d=await j.auth.api.getSession({headers:await (0,i.headers)()}),e=d?.user?.id,f=`search-${c}-${b}-${a.toLowerCase().slice(0,20)}${e?`-user-${e}`:""}`;return(0,k.cacheTag)(f,"problems-search"),h.searchProblems(a,b,c,e)};var r=(0,d.cache)(function(){return(0,c.cache)("private","f0f7678f6e9ee9a273c95a794bbd1ddada625c36e9",0,q,arguments)});(0,b.registerServerReference)(r,"f0f7678f6e9ee9a273c95a794bbd1ddada625c36e9",null),Object.defineProperty(r,"name",{value:"searchProblems"});let s=async function(a){return(0,k.cacheLife)({stale:900,revalidate:900}),(0,k.cacheTag)(`problem-${a}`,"problems-list"),h.getProblem(a)};var t=(0,d.cache)(function(){return(0,c.cache)("default","c0090c3cc685cca6f4fe73f9ef4401da8480e19875",0,s,arguments)});async function u(a){let b=await j.auth.api.getSession({headers:await (0,i.headers)()});if(!b||"ADMIN"!==b.user.role)throw Error("Unauthorized");let c=await h.createProblem(a);return c.success&&((0,k.revalidatePath)("/problems"),(0,k.revalidatePath)("/problems/dsa"),(0,k.revalidatePath)("/problems/sql"),(0,k.revalidatePath)("/admin/problems"),(0,k.revalidatePath)("/admin/dsa/problems"),(0,k.revalidatePath)("/admin/sql/problems"),(0,k.updateTag)("admin-problems-list"),(0,k.updateTag)("problems-list"),(0,k.updateTag)("problems-SQL-PRACTICE"),(0,k.updateTag)("problems-DSA-PRACTICE")),c}(0,b.registerServerReference)(t,"c0090c3cc685cca6f4fe73f9ef4401da8480e19875",null),Object.defineProperty(t,"name",{value:"getProblem"});let v=async function(a){return(0,k.cacheLife)({stale:900,revalidate:900}),(0,k.cacheTag)(`problem-id-${a}`,"problems-list"),h.getProblemById(a)};var w=(0,d.cache)(function(){return(0,c.cache)("default","c05cc84f5f8727b30adaa19d44f3e39f9db10a7f17",0,v,arguments)});(0,b.registerServerReference)(w,"c05cc84f5f8727b30adaa19d44f3e39f9db10a7f17",null),Object.defineProperty(w,"name",{value:"getProblemById"});let x=async function(a,b,c){return(0,k.cacheLife)({stale:300,revalidate:300}),h.getNextProblem(a,b,c)};var y=(0,d.cache)(function(){return(0,c.cache)("private","f077257b04a73a21a1d692378f13f78950446717fc",0,x,arguments)});(0,b.registerServerReference)(y,"f077257b04a73a21a1d692378f13f78950446717fc",null),Object.defineProperty(y,"name",{value:"getNextProblem"});let z=async function(a,b,c){return(0,k.cacheLife)({stale:300,revalidate:300}),h.getPreviousProblem(a,b,c)};var A=(0,d.cache)(function(){return(0,c.cache)("private","f0e0317bcb5e24d39cc2377125fbdeb0bc1c35e67c",0,z,arguments)});async function B(a,b){return h.getRandomProblem(a,b)}async function C(a,b){let c=await j.auth.api.getSession({headers:await (0,i.headers)()});if(!c||"ADMIN"!==c.user.role)throw Error("Unauthorized");let d=await h.updateProblem(a,b);return d.success&&((0,k.revalidatePath)("/problems"),(0,k.revalidatePath)("/problems/dsa"),(0,k.revalidatePath)("/problems/sql"),(0,k.revalidatePath)("/admin/problems"),(0,k.revalidatePath)("/admin/dsa/problems"),(0,k.revalidatePath)("/admin/sql/problems"),(0,k.updateTag)("admin-problems-list"),(0,k.updateTag)("problems-list"),(0,k.updateTag)(`problems-${d.data?.domain||"DSA"}-${d.data?.type||"PRACTICE"}`),(0,k.updateTag)(`problem-${d.data?.slug}`)),d}async function D(a){let b=await j.auth.api.getSession({headers:await (0,i.headers)()});if(!b||"ADMIN"!==b.user.role)throw Error("Unauthorized");let c=await h.deleteProblem(a);return c.success&&((0,k.revalidatePath)("/problems"),(0,k.revalidatePath)("/problems/dsa"),(0,k.revalidatePath)("/problems/sql"),(0,k.revalidatePath)("/admin/problems"),(0,k.revalidatePath)("/admin/dsa/problems"),(0,k.revalidatePath)("/admin/sql/problems"),(0,k.updateTag)("admin-problems-list"),(0,k.updateTag)("problems-list")),c}(0,b.registerServerReference)(A,"f0e0317bcb5e24d39cc2377125fbdeb0bc1c35e67c",null),Object.defineProperty(A,"name",{value:"getPreviousProblem"}),(0,l.ensureServerEntryExports)([u,B,C,D]),(0,b.registerServerReference)(u,"40b4d5864070c7b6edb8869c1fcce466b6809a0539",null),(0,b.registerServerReference)(B,"60f939b39f4831cb4a058085a92b431d4db6188317",null),(0,b.registerServerReference)(C,"600f6f3caf5a8c8c1145943bebf743da138bfc0b62",null),(0,b.registerServerReference)(D,"40129b5c4d4dd69240da3895f395c9f7f51ce108e6",null),a.s(["$$RSC_SERVER_CACHE_0",()=>n,"$$RSC_SERVER_CACHE_1",()=>p,"$$RSC_SERVER_CACHE_2",()=>r,"$$RSC_SERVER_CACHE_3",()=>t,"$$RSC_SERVER_CACHE_4",()=>w,"$$RSC_SERVER_CACHE_5",()=>y,"$$RSC_SERVER_CACHE_6",()=>A,"createProblem",()=>u,"deleteProblem",()=>D,"getAdminProblems",()=>p,"getNextProblem",()=>y,"getPreviousProblem",()=>A,"getProblem",()=>t,"getProblemById",()=>w,"getProblems",()=>n,"getRandomProblem",()=>B,"searchProblems",()=>r,"updateProblem",()=>C],165099)}];

//# sourceMappingURL=actions_problems_ts_a4e6508e._.js.map