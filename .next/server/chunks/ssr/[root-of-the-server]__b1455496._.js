module.exports=[191679,a=>{"use strict";var b=a.i(137936),c=a.i(409223),d=a.i(231191),e=a.i(905246);async function f(){let a=await c.auth.api.getSession({headers:await (0,e.headers)()});if(!a)return{conflict:!1};let b=(await d.prisma.session.findMany({where:{userId:a.user.id},select:{id:!0,expiresAt:!0,userAgent:!0,ipAddress:!0,token:!0}})).filter(a=>a.expiresAt>new Date);return b.length>1?{conflict:!0,currentSessionToken:a.session.token,sessions:b.map(b=>({...b,isCurrent:b.token===a.session.token}))}:{conflict:!1}}async function g(a){let b=await c.auth.api.getSession({headers:await (0,e.headers)()});if(!b)throw Error("No active session");return"LOGOUT_OTHERS"===a?(await d.prisma.session.deleteMany({where:{userId:b.user.id,token:{not:b.session.token}}}),{success:!0,message:"Other sessions terminated"}):"LOGOUT_CURRENT"===a?(await d.prisma.session.delete({where:{token:b.session.token}}),{success:!0,message:"Current session terminated"}):void 0}(0,a.i(713095).ensureServerEntryExports)([f,g]),(0,b.registerServerReference)(f,"00f4c838ce10f91796a39f1558a3b75432fa49882a",null),(0,b.registerServerReference)(g,"409bc5870257fe05de038549e85b0722c4e09c83d4",null),a.s(["checkSessionConflict",()=>f,"resolveSessionConflict",()=>g])},951187,(a,b,c)=>{b.exports=a.x("next/dist/server/lib/incremental-cache/tags-manifest.external.js",()=>require("next/dist/server/lib/incremental-cache/tags-manifest.external.js"))},137936,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"registerServerReference",{enumerable:!0,get:function(){return d.registerServerReference}});let d=a.r(211857)},713095,(a,b,c)=>{"use strict";function d(a){for(let b=0;b<a.length;b++){let c=a[b];if("function"!=typeof c)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof c}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"ensureServerEntryExports",{enumerable:!0,get:function(){return d}})},792509,(a,b,c)=>{b.exports=a.x("url",()=>require("url"))},688947,(a,b,c)=>{b.exports=a.x("stream",()=>require("stream"))},907378,a=>{"use strict";function b(a){switch(a){case"EASY":return 5;case"MEDIUM":return 10;case"HARD":return 15;default:return 0}}a.s(["getPointsForDifficulty",()=>b])},154470,a=>{"use strict";var b=a.i(260711),c=a.i(137936),d=a.i(402597),e=a.i(800717),f=a.i(231191),g=a.i(907378),h=a.i(167784);class i{static async getUserScore(a){let b=`user-score-${a}`;try{let a=await h.default.get(b);if(a)return parseInt(a,10)}catch(a){console.error("Redis get error:",a)}let c=await f.prisma.user.findUnique({where:{id:a},select:{totalScore:!0}}),d=c?.totalScore||0;try{await h.default.setex(b,30,d.toString())}catch(a){console.error("Redis set error:",a)}return d}static async recalculateUserScore(a){try{let b=await f.prisma.submission.findMany({where:{userId:a,status:"ACCEPTED",mode:"SUBMIT"},select:{problemId:!0,problem:{select:{difficulty:!0}}},distinct:["problemId"]}),c=0;for(let a of b){let b=(0,g.getPointsForDifficulty)(a.problem.difficulty);c+=b}await f.prisma.user.update({where:{id:a},data:{totalScore:c}});try{await h.default.del(`user-score-${a}`)}catch(a){console.error("Failed to invalidate user score cache:",a)}return{success:!0,newScore:c}}catch(a){throw console.error("Failed to recalculate user score:",a),Error("Failed to recalculate user score")}}static async completeOnboarding(a,b){try{await f.prisma.user.update({where:{id:a},data:{name:b.name,collegeId:b.collegeId||null,year:b.year?parseInt(b.year):null,bio:b.bio||null,leetCodeHandle:b.leetCodeHandle||null,codeChefHandle:b.codeChefHandle||null,codeforcesHandle:b.codeforcesHandle||b.hackerrankHandle||null,githubHandle:b.githubHandle||null,onboardingCompleted:!0}});try{await h.default.del(`dashboard:stats:${a}`)}catch(a){console.error("Failed to invalidate dashboard cache:",a)}return{success:!0}}catch(a){return console.error("Failed to complete onboarding:",a),{success:!1,error:"Failed to complete onboarding"}}}}var j=a.i(409223),k=a.i(905246),l=a.i(118558),m=a.i(713095);let n=async function(){(0,l.cacheLife)({stale:300,revalidate:300});let a=await j.auth.api.getSession({headers:await (0,k.headers)()});if(!a?.user?.id)return 0;let b=a.user.id;return(0,l.cacheTag)(`user-score-${b}`,`user-${b}`),i.getUserScore(b)};var o=(0,e.cache)(function(){return(0,d.cache)("private","806283762cd0bce0ac074567811476f29644f6b5e2",0,n,arguments)});async function p(){let a=await j.auth.api.getSession({headers:await (0,k.headers)()});if(!a?.user?.id)throw Error("Unauthorized");let b=a.user.id;return i.recalculateUserScore(b)}async function q(c){let d=await j.auth.api.getSession({headers:await (0,k.headers)()});if(!d?.user?.id)return{success:!1,error:"Unauthorized"};let e=d.user.id,f=await i.completeOnboarding(e,c);if(f.success){try{let c=(await (0,b.trackDynamicImport)(a.A(1067))).default;await c.del(`dashboard:stats:${e}`)}catch(a){console.error("Failed to invalidate dashboard redis cache:",a)}(0,l.revalidatePath)("/dashboard"),(0,l.updateTag)(`user-${e}`),(0,l.updateTag)(`dashboard-${e}`),(0,l.updateTag)("dashboard-stats")}return f}async function r(c){let d=await j.auth.api.getSession({headers:await (0,k.headers)()});if(!d?.user?.id)return{success:!1,error:"Unauthorized"};let e=d.user.id;try{let d=await f.prisma.user.findUnique({where:{id:e},select:{codeChefHandle:!0,codeforcesHandle:!0,leetCodeHandle:!0}}),g={name:c.name,bio:c.bio,leetCodeHandle:c.leetCodeHandle,codeChefHandle:c.codeChefHandle,codeforcesHandle:c.codeforcesHandle,githubHandle:c.githubHandle};d&&(void 0!==c.codeChefHandle&&c.codeChefHandle!==d.codeChefHandle&&(g.codeChefVerified=!1),void 0!==c.codeforcesHandle&&c.codeforcesHandle!==d.codeforcesHandle&&(g.codeforcesVerified=!1),void 0!==c.leetCodeHandle&&c.leetCodeHandle!==d.leetCodeHandle&&(g.leetCodeVerified=!1)),await f.prisma.user.update({where:{id:e},data:g});try{let c=(await (0,b.trackDynamicImport)(a.A(1067))).default;await c.del(`dashboard:stats:${e}`)}catch(a){console.error("Failed to invalidate dashboard redis cache:",a)}return(0,l.revalidatePath)("/dashboard"),(0,l.revalidatePath)("/dashboard/settings"),(0,l.updateTag)(`user-${e}`),(0,l.updateTag)(`user-score-${e}`),(0,l.updateTag)(`dashboard-${e}`),(0,l.updateTag)("dashboard-stats"),{success:!0}}catch(a){return console.error("Failed to update user info:",a),{success:!1,error:"Failed to update profile"}}}async function s(){let c=await j.auth.api.getSession({headers:await (0,k.headers)()});if(!c?.user?.id)return{success:!1,error:"Unauthorized"};let d=c.user.id;try{try{let c=(await (0,b.trackDynamicImport)(a.A(1067))).default;await c.del(`dashboard:stats:${d}`),await c.del(`user-score-${d}`)}catch(a){console.error("Failed to invalidate redis cache during sync:",a)}return(0,l.revalidatePath)("/dashboard"),(0,l.updateTag)(`user-${d}`),(0,l.updateTag)(`user-score-${d}`),(0,l.updateTag)("dashboard-stats"),{success:!0}}catch(a){return console.error("Sync failed:",a),{success:!1,error:"Failed to sync profile"}}}(0,c.registerServerReference)(o,"806283762cd0bce0ac074567811476f29644f6b5e2",null),Object.defineProperty(o,"name",{value:"getUserScore"});let t=async function(){(0,l.cacheLife)({stale:300,revalidate:300});let a=await j.auth.api.getSession({headers:await (0,k.headers)()});if(!a?.user?.id)return null;let b=a.user.id;(0,l.cacheTag)(`user-${b}`);let c=await f.prisma.user.findUnique({where:{id:b},include:{institution:!0}});return c?{id:c.id,name:c.name,email:c.email,image:c.image,bio:c.bio,institutionName:c.institution?.name}:null};var u=(0,e.cache)(function(){return(0,d.cache)("private","801090a862b4d5f5c1a62c9c0bb04047d7a9910873",0,t,arguments)});(0,c.registerServerReference)(u,"801090a862b4d5f5c1a62c9c0bb04047d7a9910873",null),Object.defineProperty(u,"name",{value:"getUserSettings"}),(0,m.ensureServerEntryExports)([p,q,r,s]),(0,c.registerServerReference)(p,"007977239056561ea7766ffef604a1b67e3430e9af",null),(0,c.registerServerReference)(q,"4022a02ca4ee842a7ee3b7772e041cc7b3c57f2de4",null),(0,c.registerServerReference)(r,"401adb5bf0163fd65ff314479b20d5a44231d975ab",null),(0,c.registerServerReference)(s,"004e22ef7336191bc1fe8b683adb39c115fb22318c",null),a.s(["$$RSC_SERVER_CACHE_0",()=>o,"$$RSC_SERVER_CACHE_1",()=>u,"completeOnboarding",()=>q,"getUserScore",()=>o,"getUserSettings",()=>u,"recalculateUserScore",()=>p,"syncUserProfile",()=>s,"updateUserInfo",()=>r],154470)},53112,a=>{"use strict";var b=a.i(954757);a.s(["z",0,b])},775949,a=>{"use strict";a.s(["default",()=>b]);let b=(0,a.i(211857).registerClientReference)(function(){throw Error("Attempted to call the default export of [project]/components/BackButton.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/components/BackButton.tsx <module evaluation>","default")},519670,a=>{"use strict";a.s(["default",()=>b]);let b=(0,a.i(211857).registerClientReference)(function(){throw Error("Attempted to call the default export of [project]/components/BackButton.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/components/BackButton.tsx","default")},260445,a=>{"use strict";a.i(775949);var b=a.i(519670);a.n(b)},169510,a=>{"use strict";a.s(["ContestList",()=>b]);let b=(0,a.i(211857).registerClientReference)(function(){throw Error("Attempted to call ContestList() from the server but ContestList is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/components/contest/ContestList.tsx <module evaluation>","ContestList")},170371,a=>{"use strict";a.s(["ContestList",()=>b]);let b=(0,a.i(211857).registerClientReference)(function(){throw Error("Attempted to call ContestList() from the server but ContestList is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/components/contest/ContestList.tsx","ContestList")},98404,a=>{"use strict";a.i(169510);var b=a.i(170371);a.n(b)},882696,a=>{"use strict";var b=a.i(907997),c=a.i(137936),d=a.i(402597),e=a.i(800717),f=a.i(409223),g=a.i(905246);a.i(570396);var h=a.i(673727),i=a.i(758964),j=a.i(98404),k=a.i(260445);let l=async function(){let a=await f.auth.api.getSession({headers:await (0,g.headers)()});a?.user||(0,h.redirect)("/signin");let c=a.user.role;["ADMIN","CONTEST_MANAGER"].includes(c)||(0,h.redirect)("/contests");let d=await (0,i.getVisibleContests)(),e=d.success&&d.contests||[];return(0,b.jsx)(j.ContestList,{contests:e,userRole:c})};var m=(0,e.cache)(function(){return(0,d.cache)("private","8000d95cf2c7b10c802179be4a519886a9f84c0441",0,l,arguments)});async function n(){return(0,b.jsxs)("div",{className:"min-h-screen bg-white dark:bg-[#0a0a0a] pb-12",children:[(0,b.jsx)("div",{className:"bg-white dark:bg-[#141414] border-b border-gray-200 dark:border-[#262626]",children:(0,b.jsxs)("div",{className:"max-w-7xl mx-auto px-6 py-8",children:[(0,b.jsx)("div",{className:"mb-4",children:(0,b.jsx)(k.default,{})}),(0,b.jsx)("div",{className:"flex items-center justify-between",children:(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"Contest Management"}),(0,b.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Create, edit, and manage coding competitions"})]})})]})}),(0,b.jsx)("div",{className:"max-w-7xl mx-auto px-6 py-6",children:(0,b.jsx)(e.Suspense,{fallback:(0,b.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500 mx-auto"}),(0,b.jsx)("p",{className:"mt-4 text-gray-600 dark:text-gray-400",children:"Loading contests..."})]})}),children:(0,b.jsx)(m,{})})})]})}(0,c.registerServerReference)(m,"8000d95cf2c7b10c802179be4a519886a9f84c0441",null),Object.defineProperty(m,"name",{value:"ContestsContent"}),a.s(["$$RSC_SERVER_CACHE_0",()=>m,"default",()=>n])},308854,a=>{"use strict";var b=a.i(191679),c=a.i(154470),d=a.i(882696),e=a.i(758964);a.s([],17882),a.i(17882),a.s(["00832625e68b53b4f2054e042aa76c52995192cece",()=>e.getVisibleContests,"00f4c838ce10f91796a39f1558a3b75432fa49882a",()=>b.checkSessionConflict,"400c8385b179b249f8f2b1e04f6bbe29a73028adaa",()=>e.acceptContestRules,"40143a75ea5765fb88ac9bf3c96a0eabcf8c510a58",()=>e.getInstitutionalClassrooms,"401a1a28bd2e49379be125257c4115d7ecc57f70f3",()=>e.createContestWithProblems,"401a4fbf2ff70b136418170cd4f92105d0d9f9eb7b",()=>e.getContestRanking,"4050b6d7261e7a6fa97816d9dd7891742fa5be61cf",()=>e.getParticipationStatus,"405fb5f68efcec07d64b8a03d4e11d8a1571a1325a",()=>e.checkSubmissionEligibility,"40662e9ddea2bbf3d0b684f6d080569fe729f1c1c3",()=>e.createContest,"406cdc651bddb729aed5c9ed8a61b22fd85586aa37",()=>e.finalizeContest,"4092871713fd49951fb96de6880895702406eeacf3",()=>e.getContestParticipants,"4098047632820cd0448f2d2528471fa663ac8499b7",()=>e.getSelectableProblems,"409bc5870257fe05de038549e85b0722c4e09c83d4",()=>b.resolveSessionConflict,"40e408761adff7d832a403f8b3de67dd3150702624",()=>e.getContestDetail,"40f1b84b507cbed77bbd694a76ce511a8893db67cb",()=>e.finishContestAction,"6056877ff0b936524f0713c621512340498d9b6a4e",()=>e.unblockParticipant,"60b64dd74a42f4e7ada0d4314abeb1a11d4e5ab6f3",()=>e.getParticipantViolations,"60d3252bd45f48968dec686bb41d7abb72b2b3fa40",()=>e.startContestSession,"60d7b7d92c9e22bf280512e3f5de148c2f7a4efd0b",()=>e.validateContestSession,"60e4bb3f837a3366538a85855a444a9a4c1f3ce841",()=>e.verifyContestPassword,"78c1cd378517a292ad03dee9242ae6d4c6eb499f21",()=>e.logContestViolation,"8000d95cf2c7b10c802179be4a519886a9f84c0441",()=>d.$$RSC_SERVER_CACHE_0,"80ad8df1de46115cbf4e6a7e47dc598cc611fdcba1",()=>e.$$RSC_SERVER_CACHE_0,"80ee7282f708e60661ecc42477a6d2afba42f1d5ed",()=>c.getUserScore,"c08470ca0cca037f820a4e0f58851b7e0cf4e3be61",()=>e.$$RSC_SERVER_CACHE_1,"c0e243ef3de5d223ce4583d16064cf4bda30aa3e62",()=>e.$$RSC_SERVER_CACHE_2],308854)},1067,a=>{a.v(a=>Promise.resolve().then(()=>a(167784)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__b1455496._.js.map