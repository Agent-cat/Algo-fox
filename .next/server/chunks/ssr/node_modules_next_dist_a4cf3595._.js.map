{"version":3,"sources":["../../../../node_modules/next/src/shared/lib/router/utils/parse-path.ts","../../../../node_modules/next/src/shared/lib/router/utils/path-has-prefix.ts","../../../../node_modules/next/src/shared/lib/router/utils/remove-path-prefix.ts","../../../../node_modules/next/src/server/lib/trace/constants.ts","../../../../node_modules/next/src/server/lib/trace/tracer.ts","../../../../node_modules/next/src/lib/detached-promise.ts","../../../../node_modules/next/src/server/stream-utils/encoded-tags.ts","../../../../node_modules/next/src/server/stream-utils/uint8array-helpers.ts","../../../../node_modules/next/src/shared/lib/errors/constants.ts","../../../../node_modules/next/src/shared/lib/segment-cache/output-export-prefetch-encoding.ts","../../../../node_modules/next/src/shared/lib/router/utils/cache-busting-search-param.ts","../../../../node_modules/next/src/server/stream-utils/node-web-streams-helper.ts","../../../../node_modules/next/src/server/request-meta.ts","../../../../node_modules/next/src/shared/lib/i18n/detect-domain-locale.ts","../../../../node_modules/next/src/shared/lib/router/utils/add-path-prefix.ts","../../../../node_modules/next/src/shared/lib/router/utils/add-path-suffix.ts","../../../../node_modules/next/src/shared/lib/router/utils/add-locale.ts","../../../../node_modules/next/src/shared/lib/router/utils/format-next-pathname-info.ts","../../../../node_modules/next/src/shared/lib/get-hostname.ts","../../../../node_modules/next/src/shared/lib/router/utils/get-next-pathname-info.ts","../../../../node_modules/next/src/server/web/next-url.ts","../../../../node_modules/next/src/server/web/error.ts","../../../../node_modules/next/src/server/web/spec-extension/request.ts","../../../../node_modules/next/src/server/base-http/helpers.ts","../../../../node_modules/next/src/server/web/spec-extension/adapters/next-request.ts","../../../../node_modules/next/src/server/client-component-renderer-logger.ts","../../../../node_modules/next/src/server/pipe-readable.ts","../../../../node_modules/next/src/server/lib/lru-cache.ts","../../../../node_modules/next/src/lib/picocolors.ts","../../../../node_modules/next/src/build/output/log.ts"],"sourcesContent":["/**\n * Given a path this function will find the pathname, query and hash and return\n * them. This is useful to parse full paths on the client side.\n * @param path A path to parse e.g. /foo/bar?id=1#hash\n */\nexport function parsePath(path: string) {\n  const hashIndex = path.indexOf('#')\n  const queryIndex = path.indexOf('?')\n  const hasQuery = queryIndex > -1 && (hashIndex < 0 || queryIndex < hashIndex)\n\n  if (hasQuery || hashIndex > -1) {\n    return {\n      pathname: path.substring(0, hasQuery ? queryIndex : hashIndex),\n      query: hasQuery\n        ? path.substring(queryIndex, hashIndex > -1 ? hashIndex : undefined)\n        : '',\n      hash: hashIndex > -1 ? path.slice(hashIndex) : '',\n    }\n  }\n\n  return { pathname: path, query: '', hash: '' }\n}\n","import { parsePath } from './parse-path'\n\n/**\n * Checks if a given path starts with a given prefix. It ensures it matches\n * exactly without containing extra chars. e.g. prefix /docs should replace\n * for /docs, /docs/, /docs/a but not /docsss\n * @param path The path to check.\n * @param prefix The prefix to check against.\n */\nexport function pathHasPrefix(path: string, prefix: string) {\n  if (typeof path !== 'string') {\n    return false\n  }\n\n  const { pathname } = parsePath(path)\n  return pathname === prefix || pathname.startsWith(prefix + '/')\n}\n","import { pathHasPrefix } from './path-has-prefix'\n\n/**\n * Given a path and a prefix it will remove the prefix when it exists in the\n * given path. It ensures it matches exactly without containing extra chars\n * and if the prefix is not there it will be noop.\n *\n * @param path The path to remove the prefix from.\n * @param prefix The prefix to be removed.\n */\nexport function removePathPrefix(path: string, prefix: string): string {\n  // If the path doesn't start with the prefix we can return it as is. This\n  // protects us from situations where the prefix is a substring of the path\n  // prefix such as:\n  //\n  // For prefix: /blog\n  //\n  //   /blog -> true\n  //   /blog/ -> true\n  //   /blog/1 -> true\n  //   /blogging -> false\n  //   /blogging/ -> false\n  //   /blogging/1 -> false\n  if (!pathHasPrefix(path, prefix)) {\n    return path\n  }\n\n  // Remove the prefix from the path via slicing.\n  const withoutPrefix = path.slice(prefix.length)\n\n  // If the path without the prefix starts with a `/` we can return it as is.\n  if (withoutPrefix.startsWith('/')) {\n    return withoutPrefix\n  }\n\n  // If the path without the prefix doesn't start with a `/` we need to add it\n  // back to the path to make sure it's a valid path.\n  return `/${withoutPrefix}`\n}\n","/**\n * Contains predefined constants for the trace span name in next/server.\n *\n * Currently, next/server/tracer is internal implementation only for tracking\n * next.js's implementation only with known span names defined here.\n **/\n\n// eslint typescript has a bug with TS enums\n\nenum BaseServerSpan {\n  handleRequest = 'BaseServer.handleRequest',\n  run = 'BaseServer.run',\n  pipe = 'BaseServer.pipe',\n  getStaticHTML = 'BaseServer.getStaticHTML',\n  render = 'BaseServer.render',\n  renderToResponseWithComponents = 'BaseServer.renderToResponseWithComponents',\n  renderToResponse = 'BaseServer.renderToResponse',\n  renderToHTML = 'BaseServer.renderToHTML',\n  renderError = 'BaseServer.renderError',\n  renderErrorToResponse = 'BaseServer.renderErrorToResponse',\n  renderErrorToHTML = 'BaseServer.renderErrorToHTML',\n  render404 = 'BaseServer.render404',\n}\n\nenum LoadComponentsSpan {\n  loadDefaultErrorComponents = 'LoadComponents.loadDefaultErrorComponents',\n  loadComponents = 'LoadComponents.loadComponents',\n}\n\nenum NextServerSpan {\n  getRequestHandler = 'NextServer.getRequestHandler',\n  getRequestHandlerWithMetadata = 'NextServer.getRequestHandlerWithMetadata',\n  getServer = 'NextServer.getServer',\n  getServerRequestHandler = 'NextServer.getServerRequestHandler',\n  createServer = 'createServer.createServer',\n}\n\nenum NextNodeServerSpan {\n  compression = 'NextNodeServer.compression',\n  getBuildId = 'NextNodeServer.getBuildId',\n  createComponentTree = 'NextNodeServer.createComponentTree',\n  clientComponentLoading = 'NextNodeServer.clientComponentLoading',\n  getLayoutOrPageModule = 'NextNodeServer.getLayoutOrPageModule',\n  generateStaticRoutes = 'NextNodeServer.generateStaticRoutes',\n  generateFsStaticRoutes = 'NextNodeServer.generateFsStaticRoutes',\n  generatePublicRoutes = 'NextNodeServer.generatePublicRoutes',\n  generateImageRoutes = 'NextNodeServer.generateImageRoutes.route',\n  sendRenderResult = 'NextNodeServer.sendRenderResult',\n  proxyRequest = 'NextNodeServer.proxyRequest',\n  runApi = 'NextNodeServer.runApi',\n  render = 'NextNodeServer.render',\n  renderHTML = 'NextNodeServer.renderHTML',\n  imageOptimizer = 'NextNodeServer.imageOptimizer',\n  getPagePath = 'NextNodeServer.getPagePath',\n  getRoutesManifest = 'NextNodeServer.getRoutesManifest',\n  findPageComponents = 'NextNodeServer.findPageComponents',\n  getFontManifest = 'NextNodeServer.getFontManifest',\n  getServerComponentManifest = 'NextNodeServer.getServerComponentManifest',\n  getRequestHandler = 'NextNodeServer.getRequestHandler',\n  renderToHTML = 'NextNodeServer.renderToHTML',\n  renderError = 'NextNodeServer.renderError',\n  renderErrorToHTML = 'NextNodeServer.renderErrorToHTML',\n  render404 = 'NextNodeServer.render404',\n  startResponse = 'NextNodeServer.startResponse',\n\n  // nested inner span, does not require parent scope name\n  route = 'route',\n  onProxyReq = 'onProxyReq',\n  apiResolver = 'apiResolver',\n  internalFetch = 'internalFetch',\n}\n\nenum StartServerSpan {\n  startServer = 'startServer.startServer',\n}\n\nenum RenderSpan {\n  getServerSideProps = 'Render.getServerSideProps',\n  getStaticProps = 'Render.getStaticProps',\n  renderToString = 'Render.renderToString',\n  renderDocument = 'Render.renderDocument',\n  createBodyResult = 'Render.createBodyResult',\n}\n\nenum AppRenderSpan {\n  renderToString = 'AppRender.renderToString',\n  renderToReadableStream = 'AppRender.renderToReadableStream',\n  getBodyResult = 'AppRender.getBodyResult',\n  fetch = 'AppRender.fetch',\n}\n\nenum RouterSpan {\n  executeRoute = 'Router.executeRoute',\n}\n\nenum NodeSpan {\n  runHandler = 'Node.runHandler',\n}\n\nenum AppRouteRouteHandlersSpan {\n  runHandler = 'AppRouteRouteHandlers.runHandler',\n}\n\nenum ResolveMetadataSpan {\n  generateMetadata = 'ResolveMetadata.generateMetadata',\n  generateViewport = 'ResolveMetadata.generateViewport',\n}\n\nenum MiddlewareSpan {\n  execute = 'Middleware.execute',\n}\n\ntype SpanTypes =\n  | `${BaseServerSpan}`\n  | `${LoadComponentsSpan}`\n  | `${NextServerSpan}`\n  | `${StartServerSpan}`\n  | `${NextNodeServerSpan}`\n  | `${RenderSpan}`\n  | `${RouterSpan}`\n  | `${AppRenderSpan}`\n  | `${NodeSpan}`\n  | `${AppRouteRouteHandlersSpan}`\n  | `${ResolveMetadataSpan}`\n  | `${MiddlewareSpan}`\n\n// This list is used to filter out spans that are not relevant to the user\nexport const NextVanillaSpanAllowlist = new Set([\n  MiddlewareSpan.execute,\n  BaseServerSpan.handleRequest,\n  RenderSpan.getServerSideProps,\n  RenderSpan.getStaticProps,\n  AppRenderSpan.fetch,\n  AppRenderSpan.getBodyResult,\n  RenderSpan.renderDocument,\n  NodeSpan.runHandler,\n  AppRouteRouteHandlersSpan.runHandler,\n  ResolveMetadataSpan.generateMetadata,\n  ResolveMetadataSpan.generateViewport,\n  NextNodeServerSpan.createComponentTree,\n  NextNodeServerSpan.findPageComponents,\n  NextNodeServerSpan.getLayoutOrPageModule,\n  NextNodeServerSpan.startResponse,\n  NextNodeServerSpan.clientComponentLoading,\n])\n\n// These Spans are allowed to be always logged\n// when the otel log prefix env is set\nexport const LogSpanAllowList = new Set([\n  NextNodeServerSpan.findPageComponents,\n  NextNodeServerSpan.createComponentTree,\n  NextNodeServerSpan.clientComponentLoading,\n])\n\nexport {\n  BaseServerSpan,\n  LoadComponentsSpan,\n  NextServerSpan,\n  NextNodeServerSpan,\n  StartServerSpan,\n  RenderSpan,\n  RouterSpan,\n  AppRenderSpan,\n  NodeSpan,\n  AppRouteRouteHandlersSpan,\n  ResolveMetadataSpan,\n  MiddlewareSpan,\n}\n\nexport type { SpanTypes }\n","import type { FetchEventResult } from '../../web/types'\nimport type { TextMapSetter } from '@opentelemetry/api'\nimport type { SpanTypes } from './constants'\nimport { LogSpanAllowList, NextVanillaSpanAllowlist } from './constants'\n\nimport type {\n  ContextAPI,\n  Span,\n  SpanOptions,\n  Tracer,\n  AttributeValue,\n  TextMapGetter,\n} from 'next/dist/compiled/@opentelemetry/api'\nimport { isThenable } from '../../../shared/lib/is-thenable'\n\nconst NEXT_OTEL_PERFORMANCE_PREFIX = process.env.NEXT_OTEL_PERFORMANCE_PREFIX\n\nlet api: typeof import('next/dist/compiled/@opentelemetry/api')\n\n// we want to allow users to use their own version of @opentelemetry/api if they\n// want to, so we try to require it first, and if it fails we fall back to the\n// version that is bundled with Next.js\n// this is because @opentelemetry/api has to be synced with the version of\n// @opentelemetry/tracing that is used, and we don't want to force users to use\n// the version that is bundled with Next.js.\n// the API is ~stable, so this should be fine\nif (process.env.NEXT_RUNTIME === 'edge') {\n  api = require('@opentelemetry/api') as typeof import('@opentelemetry/api')\n} else {\n  try {\n    api = require('@opentelemetry/api') as typeof import('@opentelemetry/api')\n  } catch (err) {\n    api =\n      require('next/dist/compiled/@opentelemetry/api') as typeof import('next/dist/compiled/@opentelemetry/api')\n  }\n}\n\nconst { context, propagation, trace, SpanStatusCode, SpanKind, ROOT_CONTEXT } =\n  api\n\nexport class BubbledError extends Error {\n  constructor(\n    public readonly bubble?: boolean,\n    public readonly result?: FetchEventResult\n  ) {\n    super()\n  }\n}\n\nexport function isBubbledError(error: unknown): error is BubbledError {\n  if (typeof error !== 'object' || error === null) return false\n  return error instanceof BubbledError\n}\n\nconst closeSpanWithError = (span: Span, error?: Error) => {\n  if (isBubbledError(error) && error.bubble) {\n    span.setAttribute('next.bubble', true)\n  } else {\n    if (error) {\n      span.recordException(error)\n      span.setAttribute('error.type', error.name)\n    }\n    span.setStatus({ code: SpanStatusCode.ERROR, message: error?.message })\n  }\n  span.end()\n}\n\ntype TracerSpanOptions = Omit<SpanOptions, 'attributes'> & {\n  parentSpan?: Span\n  spanName?: string\n  attributes?: Partial<Record<AttributeNames, AttributeValue | undefined>>\n  hideSpan?: boolean\n}\n\ninterface NextTracer {\n  getContext(): ContextAPI\n\n  /**\n   * Instruments a function by automatically creating a span activated on its\n   * scope.\n   *\n   * The span will automatically be finished when one of these conditions is\n   * met:\n   *\n   * * The function returns a promise, in which case the span will finish when\n   * the promise is resolved or rejected.\n   * * The function takes a callback as its second parameter, in which case the\n   * span will finish when that callback is called.\n   * * The function doesn't accept a callback and doesn't return a promise, in\n   * which case the span will finish at the end of the function execution.\n   *\n   */\n  trace<T>(\n    type: SpanTypes,\n    fn: (span?: Span, done?: (error?: Error) => any) => Promise<T>\n  ): Promise<T>\n  trace<T>(\n    type: SpanTypes,\n    fn: (span?: Span, done?: (error?: Error) => any) => T\n  ): T\n  trace<T>(\n    type: SpanTypes,\n    options: TracerSpanOptions,\n    fn: (span?: Span, done?: (error?: Error) => any) => Promise<T>\n  ): Promise<T>\n  trace<T>(\n    type: SpanTypes,\n    options: TracerSpanOptions,\n    fn: (span?: Span, done?: (error?: Error) => any) => T\n  ): T\n\n  /**\n   * Wrap a function to automatically create a span activated on its\n   * scope when it's called.\n   *\n   * The span will automatically be finished when one of these conditions is\n   * met:\n   *\n   * * The function returns a promise, in which case the span will finish when\n   * the promise is resolved or rejected.\n   * * The function takes a callback as its last parameter, in which case the\n   * span will finish when that callback is called.\n   * * The function doesn't accept a callback and doesn't return a promise, in\n   * which case the span will finish at the end of the function execution.\n   */\n  wrap<T = (...args: Array<any>) => any>(type: SpanTypes, fn: T): T\n  wrap<T = (...args: Array<any>) => any>(\n    type: SpanTypes,\n    options: TracerSpanOptions,\n    fn: T\n  ): T\n  wrap<T = (...args: Array<any>) => any>(\n    type: SpanTypes,\n    options: (...args: any[]) => TracerSpanOptions,\n    fn: T\n  ): T\n\n  /**\n   * Starts and returns a new Span representing a logical unit of work.\n   *\n   * This method do NOT modify the current Context by default. In result, any inner span will not\n   * automatically set its parent context to the span created by this method unless manually activate\n   * context via `tracer.getContext().with`. `trace`, or `wrap` is generally recommended as it gracefully\n   * handles context activation. (ref: https://github.com/open-telemetry/opentelemetry-js/issues/1923)\n   */\n  startSpan(type: SpanTypes): Span\n  startSpan(type: SpanTypes, options: TracerSpanOptions): Span\n\n  /**\n   * Returns currently activated span if current context is in the scope of the span.\n   * Returns undefined otherwise.\n   */\n  getActiveScopeSpan(): Span | undefined\n\n  /**\n   * Returns trace propagation data for the currently active context. The format is equal to data provided\n   * through the OpenTelemetry propagator API.\n   */\n  getTracePropagationData(): ClientTraceDataEntry[]\n\n  /**\n   * Executes a function with the given span set as the active span in the context.\n   * This allows child spans created within the function to automatically parent to this span.\n   */\n  withSpan<T>(span: Span, fn: () => T): T\n}\n\ntype NextAttributeNames =\n  | 'next.route'\n  | 'next.page'\n  | 'next.rsc'\n  | 'next.segment'\n  | 'next.span_name'\n  | 'next.span_type'\n  | 'next.clientComponentLoadCount'\ntype OTELAttributeNames = `http.${string}` | `net.${string}`\ntype AttributeNames = NextAttributeNames | OTELAttributeNames\n\n/** we use this map to propagate attributes from nested spans to the top span */\nconst rootSpanAttributesStore = new Map<\n  number,\n  Map<AttributeNames, AttributeValue | undefined>\n>()\nconst rootSpanIdKey = api.createContextKey('next.rootSpanId')\nlet lastSpanId = 0\nconst getSpanId = () => lastSpanId++\n\nexport interface ClientTraceDataEntry {\n  key: string\n  value: string\n}\n\nconst clientTraceDataSetter: TextMapSetter<ClientTraceDataEntry[]> = {\n  set(carrier, key, value) {\n    carrier.push({\n      key,\n      value,\n    })\n  },\n}\n\nclass NextTracerImpl implements NextTracer {\n  /**\n   * Returns an instance to the trace with configured name.\n   * Since wrap / trace can be defined in any place prior to actual trace subscriber initialization,\n   * This should be lazily evaluated.\n   */\n  private getTracerInstance(): Tracer {\n    return trace.getTracer('next.js', '0.0.1')\n  }\n\n  public getContext(): ContextAPI {\n    return context\n  }\n\n  public getTracePropagationData(): ClientTraceDataEntry[] {\n    const activeContext = context.active()\n    const entries: ClientTraceDataEntry[] = []\n    propagation.inject(activeContext, entries, clientTraceDataSetter)\n    return entries\n  }\n\n  public getActiveScopeSpan(): Span | undefined {\n    return trace.getSpan(context?.active())\n  }\n\n  public withPropagatedContext<T, C>(\n    carrier: C,\n    fn: () => T,\n    getter?: TextMapGetter<C>\n  ): T {\n    const activeContext = context.active()\n    if (trace.getSpanContext(activeContext)) {\n      // Active span is already set, too late to propagate.\n      return fn()\n    }\n    const remoteContext = propagation.extract(activeContext, carrier, getter)\n    return context.with(remoteContext, fn)\n  }\n\n  // Trace, wrap implementation is inspired by datadog trace implementation\n  // (https://datadoghq.dev/dd-trace-js/interfaces/tracer.html#trace).\n  public trace<T>(\n    type: SpanTypes,\n    fn: (span?: Span, done?: (error?: Error) => any) => Promise<T>\n  ): Promise<T>\n  public trace<T>(\n    type: SpanTypes,\n    fn: (span?: Span, done?: (error?: Error) => any) => T\n  ): T\n  public trace<T>(\n    type: SpanTypes,\n    options: TracerSpanOptions,\n    fn: (span?: Span, done?: (error?: Error) => any) => Promise<T>\n  ): Promise<T>\n  public trace<T>(\n    type: SpanTypes,\n    options: TracerSpanOptions,\n    fn: (span?: Span, done?: (error?: Error) => any) => T\n  ): T\n  public trace<T>(...args: Array<any>) {\n    const [type, fnOrOptions, fnOrEmpty] = args\n\n    // coerce options form overload\n    const {\n      fn,\n      options,\n    }: {\n      fn: (span?: Span, done?: (error?: Error) => any) => T | Promise<T>\n      options: TracerSpanOptions\n    } =\n      typeof fnOrOptions === 'function'\n        ? {\n            fn: fnOrOptions,\n            options: {},\n          }\n        : {\n            fn: fnOrEmpty,\n            options: { ...fnOrOptions },\n          }\n\n    const spanName = options.spanName ?? type\n\n    if (\n      (!NextVanillaSpanAllowlist.has(type) &&\n        process.env.NEXT_OTEL_VERBOSE !== '1') ||\n      options.hideSpan\n    ) {\n      return fn()\n    }\n\n    // Trying to get active scoped span to assign parent. If option specifies parent span manually, will try to use it.\n    let spanContext = this.getSpanContext(\n      options?.parentSpan ?? this.getActiveScopeSpan()\n    )\n\n    if (!spanContext) {\n      spanContext = context?.active() ?? ROOT_CONTEXT\n    }\n    // Check if there's already a root span in the store for this trace\n    // We are intentionally not checking whether there is an active context\n    // from outside of nextjs to ensure that we can provide the same level\n    // of telemetry when using a custom server\n    const existingRootSpanId = spanContext.getValue(rootSpanIdKey)\n    const isRootSpan =\n      typeof existingRootSpanId !== 'number' ||\n      !rootSpanAttributesStore.has(existingRootSpanId)\n\n    const spanId = getSpanId()\n\n    options.attributes = {\n      'next.span_name': spanName,\n      'next.span_type': type,\n      ...options.attributes,\n    }\n\n    return context.with(spanContext.setValue(rootSpanIdKey, spanId), () =>\n      this.getTracerInstance().startActiveSpan(\n        spanName,\n        options,\n        (span: Span) => {\n          let startTime: number | undefined\n          if (\n            NEXT_OTEL_PERFORMANCE_PREFIX &&\n            type &&\n            LogSpanAllowList.has(type)\n          ) {\n            startTime =\n              'performance' in globalThis && 'measure' in performance\n                ? globalThis.performance.now()\n                : undefined\n          }\n\n          let cleanedUp = false\n          const onCleanup = () => {\n            if (cleanedUp) return\n            cleanedUp = true\n            rootSpanAttributesStore.delete(spanId)\n            if (startTime) {\n              performance.measure(\n                `${NEXT_OTEL_PERFORMANCE_PREFIX}:next-${(\n                  type.split('.').pop() || ''\n                ).replace(\n                  /[A-Z]/g,\n                  (match: string) => '-' + match.toLowerCase()\n                )}`,\n                {\n                  start: startTime,\n                  end: performance.now(),\n                }\n              )\n            }\n          }\n\n          if (isRootSpan) {\n            rootSpanAttributesStore.set(\n              spanId,\n              new Map(\n                Object.entries(options.attributes ?? {}) as [\n                  AttributeNames,\n                  AttributeValue | undefined,\n                ][]\n              )\n            )\n          }\n          if (fn.length > 1) {\n            try {\n              return fn(span, (err) => closeSpanWithError(span, err))\n            } catch (err: any) {\n              closeSpanWithError(span, err)\n              throw err\n            } finally {\n              onCleanup()\n            }\n          }\n\n          try {\n            const result = fn(span)\n            if (isThenable(result)) {\n              // If there's error make sure it throws\n              return result\n                .then((res) => {\n                  span.end()\n                  // Need to pass down the promise result,\n                  // it could be react stream response with error { error, stream }\n                  return res\n                })\n                .catch((err) => {\n                  closeSpanWithError(span, err)\n                  throw err\n                })\n                .finally(onCleanup)\n            } else {\n              span.end()\n              onCleanup()\n            }\n\n            return result\n          } catch (err: any) {\n            closeSpanWithError(span, err)\n            onCleanup()\n            throw err\n          }\n        }\n      )\n    )\n  }\n\n  public wrap<T = (...args: Array<any>) => any>(type: SpanTypes, fn: T): T\n  public wrap<T = (...args: Array<any>) => any>(\n    type: SpanTypes,\n    options: TracerSpanOptions,\n    fn: T\n  ): T\n  public wrap<T = (...args: Array<any>) => any>(\n    type: SpanTypes,\n    options: (...args: any[]) => TracerSpanOptions,\n    fn: T\n  ): T\n  public wrap(...args: Array<any>) {\n    const tracer = this\n    const [name, options, fn] =\n      args.length === 3 ? args : [args[0], {}, args[1]]\n\n    if (\n      !NextVanillaSpanAllowlist.has(name) &&\n      process.env.NEXT_OTEL_VERBOSE !== '1'\n    ) {\n      return fn\n    }\n\n    return function (this: any) {\n      let optionsObj = options\n      if (typeof optionsObj === 'function' && typeof fn === 'function') {\n        optionsObj = optionsObj.apply(this, arguments)\n      }\n\n      const lastArgId = arguments.length - 1\n      const cb = arguments[lastArgId]\n\n      if (typeof cb === 'function') {\n        const scopeBoundCb = tracer.getContext().bind(context.active(), cb)\n        return tracer.trace(name, optionsObj, (_span, done) => {\n          arguments[lastArgId] = function (err: any) {\n            done?.(err)\n            return scopeBoundCb.apply(this, arguments)\n          }\n\n          return fn.apply(this, arguments)\n        })\n      } else {\n        return tracer.trace(name, optionsObj, () => fn.apply(this, arguments))\n      }\n    }\n  }\n\n  public startSpan(type: SpanTypes): Span\n  public startSpan(type: SpanTypes, options: TracerSpanOptions): Span\n  public startSpan(...args: Array<any>): Span {\n    const [type, options]: [string, TracerSpanOptions | undefined] = args as any\n\n    const spanContext = this.getSpanContext(\n      options?.parentSpan ?? this.getActiveScopeSpan()\n    )\n    return this.getTracerInstance().startSpan(type, options, spanContext)\n  }\n\n  private getSpanContext(parentSpan?: Span) {\n    const spanContext = parentSpan\n      ? trace.setSpan(context.active(), parentSpan)\n      : undefined\n\n    return spanContext\n  }\n\n  public getRootSpanAttributes() {\n    const spanId = context.active().getValue(rootSpanIdKey) as number\n    return rootSpanAttributesStore.get(spanId)\n  }\n\n  public setRootSpanAttribute(key: AttributeNames, value: AttributeValue) {\n    const spanId = context.active().getValue(rootSpanIdKey) as number\n    const attributes = rootSpanAttributesStore.get(spanId)\n    if (attributes && !attributes.has(key)) {\n      attributes.set(key, value)\n    }\n  }\n\n  public withSpan<T>(span: Span, fn: () => T): T {\n    const spanContext = trace.setSpan(context.active(), span)\n    return context.with(spanContext, fn)\n  }\n}\n\nconst getTracer = (() => {\n  const tracer = new NextTracerImpl()\n\n  return () => tracer\n})()\n\nexport { getTracer, SpanStatusCode, SpanKind }\nexport type { NextTracer, Span, SpanOptions, ContextAPI, TracerSpanOptions }\n","/**\n * A `Promise.withResolvers` implementation that exposes the `resolve` and\n * `reject` functions on a `Promise`.\n *\n * @see https://tc39.es/proposal-promise-with-resolvers/\n */\nexport class DetachedPromise<T = any> {\n  public readonly resolve: (value: T | PromiseLike<T>) => void\n  public readonly reject: (reason: any) => void\n  public readonly promise: Promise<T>\n\n  constructor() {\n    let resolve: (value: T | PromiseLike<T>) => void\n    let reject: (reason: any) => void\n\n    // Create the promise and assign the resolvers to the object.\n    this.promise = new Promise<T>((res, rej) => {\n      resolve = res\n      reject = rej\n    })\n\n    // We know that resolvers is defined because the Promise constructor runs\n    // synchronously.\n    this.resolve = resolve!\n    this.reject = reject!\n  }\n}\n","export const ENCODED_TAGS = {\n  // opening tags do not have the closing `>` since they can contain other attributes such as `<body className=''>`\n  OPENING: {\n    // <html\n    HTML: new Uint8Array([60, 104, 116, 109, 108]),\n    // <body\n    BODY: new Uint8Array([60, 98, 111, 100, 121]),\n  },\n  CLOSED: {\n    // </head>\n    HEAD: new Uint8Array([60, 47, 104, 101, 97, 100, 62]),\n    // </body>\n    BODY: new Uint8Array([60, 47, 98, 111, 100, 121, 62]),\n    // </html>\n    HTML: new Uint8Array([60, 47, 104, 116, 109, 108, 62]),\n    // </body></html>\n    BODY_AND_HTML: new Uint8Array([\n      60, 47, 98, 111, 100, 121, 62, 60, 47, 104, 116, 109, 108, 62,\n    ]),\n  },\n  META: {\n    // Only the match the prefix cause the suffix can be different wether it's xml compatible or not \">\" or \"/>\"\n    // <meta name=\"«nxt-icon»\"\n    // This is a special mark that will be replaced by the icon insertion script tag.\n    ICON_MARK: new Uint8Array([\n      60, 109, 101, 116, 97, 32, 110, 97, 109, 101, 61, 34, 194, 171, 110, 120,\n      116, 45, 105, 99, 111, 110, 194, 187, 34,\n    ]),\n  },\n} as const\n","/**\n * Find the starting index of Uint8Array `b` within Uint8Array `a`.\n */\nexport function indexOfUint8Array(a: Uint8Array, b: Uint8Array) {\n  if (b.length === 0) return 0\n  if (a.length === 0 || b.length > a.length) return -1\n\n  // start iterating through `a`\n  for (let i = 0; i <= a.length - b.length; i++) {\n    let completeMatch = true\n    // from index `i`, iterate through `b` and check for mismatch\n    for (let j = 0; j < b.length; j++) {\n      // if the values do not match, then this isn't a complete match, exit `b` iteration early and iterate to next index of `a`.\n      if (a[i + j] !== b[j]) {\n        completeMatch = false\n        break\n      }\n    }\n\n    if (completeMatch) {\n      return i\n    }\n  }\n\n  return -1\n}\n\n/**\n * Check if two Uint8Arrays are strictly equivalent.\n */\nexport function isEquivalentUint8Arrays(a: Uint8Array, b: Uint8Array) {\n  if (a.length !== b.length) return false\n\n  for (let i = 0; i < a.length; i++) {\n    if (a[i] !== b[i]) return false\n  }\n\n  return true\n}\n\n/**\n * Remove Uint8Array `b` from Uint8Array `a`.\n *\n * If `b` is not in `a`, `a` is returned unchanged.\n *\n * Otherwise, the function returns a new Uint8Array instance with size `a.length - b.length`\n */\nexport function removeFromUint8Array(a: Uint8Array, b: Uint8Array) {\n  const tagIndex = indexOfUint8Array(a, b)\n  if (tagIndex === 0) return a.subarray(b.length)\n  if (tagIndex > -1) {\n    const removed = new Uint8Array(a.length - b.length)\n    removed.set(a.slice(0, tagIndex))\n    removed.set(a.slice(tagIndex + b.length), tagIndex)\n    return removed\n  } else {\n    return a\n  }\n}\n","export const MISSING_ROOT_TAGS_ERROR = 'NEXT_MISSING_ROOT_TAGS'\n","// In output: export mode, the build id is added to the start of the HTML\n// document, directly after the doctype declaration. During a prefetch, the\n// client performs a range request to get the build id, so it can check whether\n// the target page belongs to the same build.\n//\n// The first 64 bytes of the document are requested. The exact number isn't\n// too important; it must be larger than the build id + doctype + closing and\n// ending comment markers, but it doesn't need to match the end of the\n// comment exactly.\n//\n// Build ids are 21 bytes long in the default implementation, though this\n// can be overridden in the Next.js config. For the purposes of this check,\n// it's OK to only match the start of the id, so we'll truncate it if exceeds\n// a certain length.\n\nconst DOCTYPE_PREFIX = '<!DOCTYPE html>' // 15 bytes\nconst MAX_BUILD_ID_LENGTH = 24\n\nfunction escapeBuildId(buildId: string) {\n  // If the build id is longer than the given limit, it's OK for our purposes\n  // to only match the beginning.\n  const truncated = buildId.slice(0, MAX_BUILD_ID_LENGTH)\n  // Replace hyphens with underscores so it doesn't break the HTML comment.\n  // (Unlikely, but if this did happen it would break the whole document.)\n  return truncated.replace(/-/g, '_')\n}\n\nexport function insertBuildIdComment(originalHtml: string, buildId: string) {\n  if (\n    // Skip if the build id contains a closing comment marker.\n    buildId.includes('-->') ||\n    // React always inserts a doctype at the start of the document. Skip if it\n    // isn't present. Shouldn't happen; suggests an issue elsewhere.\n    !originalHtml.startsWith(DOCTYPE_PREFIX)\n  ) {\n    // Return the original HTML unchanged. This means the document will not\n    // be prefetched.\n    // TODO: The build id comment is currently only used during prefetches, but\n    // if we eventually use this mechanism for regular navigations, we may need\n    // to error during build if we fail to insert it for some reason.\n    return originalHtml\n  }\n  // The comment must be inserted after the doctype.\n  return originalHtml.replace(\n    DOCTYPE_PREFIX,\n    DOCTYPE_PREFIX + '<!--' + escapeBuildId(buildId) + '-->'\n  )\n}\n","import { hexHash } from '../../hash'\n\nexport function computeCacheBustingSearchParam(\n  prefetchHeader: '1' | '2' | '0' | undefined,\n  segmentPrefetchHeader: string | string[] | undefined,\n  stateTreeHeader: string | string[] | undefined,\n  nextUrlHeader: string | string[] | undefined\n): string {\n  if (\n    (prefetchHeader === undefined || prefetchHeader === '0') &&\n    segmentPrefetchHeader === undefined &&\n    stateTreeHeader === undefined &&\n    nextUrlHeader === undefined\n  ) {\n    return ''\n  }\n  return hexHash(\n    [\n      prefetchHeader || '0',\n      segmentPrefetchHeader || '0',\n      stateTreeHeader || '0',\n      nextUrlHeader || '0',\n    ].join(',')\n  )\n}\n","import type { ReactDOMServerReadableStream } from 'react-dom/server'\nimport { getTracer } from '../lib/trace/tracer'\nimport { AppRenderSpan } from '../lib/trace/constants'\nimport { DetachedPromise } from '../../lib/detached-promise'\nimport {\n  scheduleImmediate,\n  atLeastOneTask,\n  waitAtLeastOneReactRenderTask,\n} from '../../lib/scheduler'\nimport { ENCODED_TAGS } from './encoded-tags'\nimport {\n  indexOfUint8Array,\n  isEquivalentUint8Arrays,\n  removeFromUint8Array,\n} from './uint8array-helpers'\nimport { MISSING_ROOT_TAGS_ERROR } from '../../shared/lib/errors/constants'\nimport { insertBuildIdComment } from '../../shared/lib/segment-cache/output-export-prefetch-encoding'\nimport {\n  RSC_HEADER,\n  NEXT_ROUTER_PREFETCH_HEADER,\n  NEXT_ROUTER_SEGMENT_PREFETCH_HEADER,\n  NEXT_RSC_UNION_QUERY,\n} from '../../client/components/app-router-headers'\nimport { computeCacheBustingSearchParam } from '../../shared/lib/router/utils/cache-busting-search-param'\n\nfunction voidCatch() {\n  // this catcher is designed to be used with pipeTo where we expect the underlying\n  // pipe implementation to forward errors but we don't want the pipeTo promise to reject\n  // and be unhandled\n}\n\n// We can share the same encoder instance everywhere\n// Notably we cannot do the same for TextDecoder because it is stateful\n// when handling streaming data\nconst encoder = new TextEncoder()\n\nexport function chainStreams<T>(\n  ...streams: ReadableStream<T>[]\n): ReadableStream<T> {\n  // If we have no streams, return an empty stream. This behavior is\n  // intentional as we're now providing the `RenderResult.EMPTY` value.\n  if (streams.length === 0) {\n    return new ReadableStream<T>({\n      start(controller) {\n        controller.close()\n      },\n    })\n  }\n\n  // If we only have 1 stream we fast path it by returning just this stream\n  if (streams.length === 1) {\n    return streams[0]\n  }\n\n  const { readable, writable } = new TransformStream()\n\n  // We always initiate pipeTo immediately. We know we have at least 2 streams\n  // so we need to avoid closing the writable when this one finishes.\n  let promise = streams[0].pipeTo(writable, { preventClose: true })\n\n  let i = 1\n  for (; i < streams.length - 1; i++) {\n    const nextStream = streams[i]\n    promise = promise.then(() =>\n      nextStream.pipeTo(writable, { preventClose: true })\n    )\n  }\n\n  // We can omit the length check because we halted before the last stream and there\n  // is at least two streams so the lastStream here will always be defined\n  const lastStream = streams[i]\n  promise = promise.then(() => lastStream.pipeTo(writable))\n\n  // Catch any errors from the streams and ignore them, they will be handled\n  // by whatever is consuming the readable stream.\n  promise.catch(voidCatch)\n\n  return readable\n}\n\nexport function streamFromString(str: string): ReadableStream<Uint8Array> {\n  return new ReadableStream({\n    start(controller) {\n      controller.enqueue(encoder.encode(str))\n      controller.close()\n    },\n  })\n}\n\nexport function streamFromBuffer(chunk: Buffer): ReadableStream<Uint8Array> {\n  return new ReadableStream({\n    start(controller) {\n      controller.enqueue(chunk)\n      controller.close()\n    },\n  })\n}\n\nasync function streamToChunks(\n  stream: ReadableStream<Uint8Array>\n): Promise<Array<Uint8Array>> {\n  const reader = stream.getReader()\n  const chunks: Array<Uint8Array> = []\n\n  while (true) {\n    const { done, value } = await reader.read()\n    if (done) {\n      break\n    }\n\n    chunks.push(value)\n  }\n\n  return chunks\n}\n\nfunction concatUint8Arrays(chunks: Array<Uint8Array>): Uint8Array {\n  const totalLength = chunks.reduce((sum, chunk) => sum + chunk.length, 0)\n  const result = new Uint8Array(totalLength)\n  let offset = 0\n  for (const chunk of chunks) {\n    result.set(chunk, offset)\n    offset += chunk.length\n  }\n  return result\n}\n\nexport async function streamToUint8Array(\n  stream: ReadableStream<Uint8Array>\n): Promise<Uint8Array> {\n  return concatUint8Arrays(await streamToChunks(stream))\n}\n\nexport async function streamToBuffer(\n  stream: ReadableStream<Uint8Array>\n): Promise<Buffer> {\n  return Buffer.concat(await streamToChunks(stream))\n}\n\nexport async function streamToString(\n  stream: ReadableStream<Uint8Array>,\n  signal?: AbortSignal\n): Promise<string> {\n  const decoder = new TextDecoder('utf-8', { fatal: true })\n  let string = ''\n\n  for await (const chunk of stream) {\n    if (signal?.aborted) {\n      return string\n    }\n\n    string += decoder.decode(chunk, { stream: true })\n  }\n\n  string += decoder.decode()\n\n  return string\n}\n\nexport type BufferedTransformOptions = {\n  /**\n   * Flush synchronously once the buffer reaches this many bytes.\n   */\n  readonly maxBufferByteLength?: number\n}\n\nexport function createBufferedTransformStream(\n  options: BufferedTransformOptions = {}\n): TransformStream<Uint8Array, Uint8Array> {\n  const { maxBufferByteLength = Infinity } = options\n\n  let bufferedChunks: Array<Uint8Array> = []\n  let bufferByteLength: number = 0\n  let pending: DetachedPromise<void> | undefined\n\n  const flush = (controller: TransformStreamDefaultController) => {\n    try {\n      if (bufferedChunks.length === 0) {\n        return\n      }\n\n      const chunk = new Uint8Array(bufferByteLength)\n      let copiedBytes = 0\n\n      for (let i = 0; i < bufferedChunks.length; i++) {\n        const bufferedChunk = bufferedChunks[i]\n        chunk.set(bufferedChunk, copiedBytes)\n        copiedBytes += bufferedChunk.byteLength\n      }\n      // We just wrote all the buffered chunks so we need to reset the bufferedChunks array\n      // and our bufferByteLength to prepare for the next round of buffered chunks\n      bufferedChunks.length = 0\n      bufferByteLength = 0\n      controller.enqueue(chunk)\n    } catch {\n      // If an error occurs while enqueuing, it can't be due to this\n      // transformer. It's most likely caused by the controller having been\n      // errored (for example, if the stream was cancelled).\n    }\n  }\n\n  const scheduleFlush = (controller: TransformStreamDefaultController) => {\n    if (pending) {\n      return\n    }\n\n    const detached = new DetachedPromise<void>()\n    pending = detached\n\n    scheduleImmediate(() => {\n      try {\n        flush(controller)\n      } finally {\n        pending = undefined\n        detached.resolve()\n      }\n    })\n  }\n\n  return new TransformStream({\n    transform(chunk, controller) {\n      // Combine the previous buffer with the new chunk.\n      bufferedChunks.push(chunk)\n      bufferByteLength += chunk.byteLength\n\n      if (bufferByteLength >= maxBufferByteLength) {\n        flush(controller)\n      } else {\n        scheduleFlush(controller)\n      }\n    },\n    flush() {\n      return pending?.promise\n    },\n  })\n}\n\nfunction createPrefetchCommentStream(\n  isBuildTimePrerendering: boolean,\n  buildId: string\n): TransformStream<Uint8Array, Uint8Array> {\n  // Insert an extra comment at the beginning of the HTML document. This must\n  // come after the DOCTYPE, which is inserted by React.\n  //\n  // The first chunk sent by React will contain the doctype. After that, we can\n  // pass through the rest of the chunks as-is.\n  let didTransformFirstChunk = false\n  return new TransformStream({\n    transform(chunk, controller) {\n      if (isBuildTimePrerendering && !didTransformFirstChunk) {\n        didTransformFirstChunk = true\n        const decoder = new TextDecoder('utf-8', { fatal: true })\n        const chunkStr = decoder.decode(chunk, {\n          stream: true,\n        })\n        const updatedChunkStr = insertBuildIdComment(chunkStr, buildId)\n        controller.enqueue(encoder.encode(updatedChunkStr))\n        return\n      }\n      controller.enqueue(chunk)\n    },\n  })\n}\n\nexport function renderToInitialFizzStream({\n  ReactDOMServer,\n  element,\n  streamOptions,\n}: {\n  ReactDOMServer: {\n    renderToReadableStream: typeof import('react-dom/server').renderToReadableStream\n  }\n  element: React.ReactElement\n  streamOptions?: Parameters<typeof ReactDOMServer.renderToReadableStream>[1]\n}): Promise<ReactDOMServerReadableStream> {\n  return getTracer().trace(AppRenderSpan.renderToReadableStream, async () =>\n    ReactDOMServer.renderToReadableStream(element, streamOptions)\n  )\n}\n\nfunction createMetadataTransformStream(\n  insert: () => Promise<string> | string\n): TransformStream<Uint8Array, Uint8Array> {\n  let chunkIndex = -1\n  let isMarkRemoved = false\n\n  return new TransformStream({\n    async transform(chunk, controller) {\n      let iconMarkIndex = -1\n      let closedHeadIndex = -1\n      chunkIndex++\n\n      if (isMarkRemoved) {\n        controller.enqueue(chunk)\n        return\n      }\n      let iconMarkLength = 0\n      // Only search for the closed head tag once\n      if (iconMarkIndex === -1) {\n        iconMarkIndex = indexOfUint8Array(chunk, ENCODED_TAGS.META.ICON_MARK)\n        if (iconMarkIndex === -1) {\n          controller.enqueue(chunk)\n          return\n        } else {\n          // When we found the `<meta name=\"«nxt-icon»\"` tag prefix, we will remove it from the chunk.\n          // Its close tag could either be `/>` or `>`, checking the next char to ensure we cover both cases.\n          iconMarkLength = ENCODED_TAGS.META.ICON_MARK.length\n          // Check if next char is /, this is for xml mode.\n          if (chunk[iconMarkIndex + iconMarkLength] === 47) {\n            iconMarkLength += 2\n          } else {\n            // The last char is `>`\n            iconMarkLength++\n          }\n        }\n      }\n\n      // Check if icon mark is inside <head> tag in the first chunk.\n      if (chunkIndex === 0) {\n        closedHeadIndex = indexOfUint8Array(chunk, ENCODED_TAGS.CLOSED.HEAD)\n        if (iconMarkIndex !== -1) {\n          // The mark icon is located in the 1st chunk before the head tag.\n          // We do not need to insert the script tag in this case because it's in the head.\n          // Just remove the icon mark from the chunk.\n          if (iconMarkIndex < closedHeadIndex) {\n            const replaced = new Uint8Array(chunk.length - iconMarkLength)\n\n            // Remove the icon mark from the chunk.\n            replaced.set(chunk.subarray(0, iconMarkIndex))\n            replaced.set(\n              chunk.subarray(iconMarkIndex + iconMarkLength),\n              iconMarkIndex\n            )\n            chunk = replaced\n          } else {\n            // The icon mark is after the head tag, replace and insert the script tag at that position.\n            const insertion = await insert()\n            const encodedInsertion = encoder.encode(insertion)\n            const insertionLength = encodedInsertion.length\n            const replaced = new Uint8Array(\n              chunk.length - iconMarkLength + insertionLength\n            )\n            replaced.set(chunk.subarray(0, iconMarkIndex))\n            replaced.set(encodedInsertion, iconMarkIndex)\n            replaced.set(\n              chunk.subarray(iconMarkIndex + iconMarkLength),\n              iconMarkIndex + insertionLength\n            )\n            chunk = replaced\n          }\n          isMarkRemoved = true\n        }\n        // If there's no icon mark located, it will be handled later when if present in the following chunks.\n      } else {\n        // When it's appeared in the following chunks, we'll need to\n        // remove the mark and then insert the script tag at that position.\n        const insertion = await insert()\n        const encodedInsertion = encoder.encode(insertion)\n        const insertionLength = encodedInsertion.length\n        // Replace the icon mark with the hoist script or empty string.\n        const replaced = new Uint8Array(\n          chunk.length - iconMarkLength + insertionLength\n        )\n        // Set the first part of the chunk, before the icon mark.\n        replaced.set(chunk.subarray(0, iconMarkIndex))\n        // Set the insertion after the icon mark.\n        replaced.set(encodedInsertion, iconMarkIndex)\n\n        // Set the rest of the chunk after the icon mark.\n        replaced.set(\n          chunk.subarray(iconMarkIndex + iconMarkLength),\n          iconMarkIndex + insertionLength\n        )\n        chunk = replaced\n        isMarkRemoved = true\n      }\n      controller.enqueue(chunk)\n    },\n  })\n}\n\nfunction createHeadInsertionTransformStream(\n  insert: () => Promise<string>\n): TransformStream<Uint8Array, Uint8Array> {\n  let inserted = false\n\n  // We need to track if this transform saw any bytes because if it didn't\n  // we won't want to insert any server HTML at all\n  let hasBytes = false\n\n  return new TransformStream({\n    async transform(chunk, controller) {\n      hasBytes = true\n\n      const insertion = await insert()\n      if (inserted) {\n        if (insertion) {\n          const encodedInsertion = encoder.encode(insertion)\n          controller.enqueue(encodedInsertion)\n        }\n        controller.enqueue(chunk)\n      } else {\n        // TODO (@Ethan-Arrowood): Replace the generic `indexOfUint8Array` method with something finely tuned for the subset of things actually being checked for.\n        const index = indexOfUint8Array(chunk, ENCODED_TAGS.CLOSED.HEAD)\n        // In fully static rendering or non PPR rendering cases:\n        // `/head>` will always be found in the chunk in first chunk rendering.\n        if (index !== -1) {\n          if (insertion) {\n            const encodedInsertion = encoder.encode(insertion)\n            // Get the total count of the bytes in the chunk and the insertion\n            // e.g.\n            // chunk = <head><meta charset=\"utf-8\"></head>\n            // insertion = <script>...</script>\n            // output = <head><meta charset=\"utf-8\"> [ <script>...</script> ] </head>\n            const insertedHeadContent = new Uint8Array(\n              chunk.length + encodedInsertion.length\n            )\n            // Append the first part of the chunk, before the head tag\n            insertedHeadContent.set(chunk.slice(0, index))\n            // Append the server inserted content\n            insertedHeadContent.set(encodedInsertion, index)\n            // Append the rest of the chunk\n            insertedHeadContent.set(\n              chunk.slice(index),\n              index + encodedInsertion.length\n            )\n            controller.enqueue(insertedHeadContent)\n          } else {\n            controller.enqueue(chunk)\n          }\n          inserted = true\n        } else {\n          // This will happens in PPR rendering during next start, when the page is partially rendered.\n          // When the page resumes, the head tag will be found in the middle of the chunk.\n          // Where we just need to append the insertion and chunk to the current stream.\n          // e.g.\n          // PPR-static: <head>...</head><body> [ resume content ] </body>\n          // PPR-resume: [ insertion ] [ rest content ]\n          if (insertion) {\n            controller.enqueue(encoder.encode(insertion))\n          }\n          controller.enqueue(chunk)\n          inserted = true\n        }\n      }\n    },\n    async flush(controller) {\n      // Check before closing if there's anything remaining to insert.\n      if (hasBytes) {\n        const insertion = await insert()\n        if (insertion) {\n          controller.enqueue(encoder.encode(insertion))\n        }\n      }\n    },\n  })\n}\n\nfunction createClientResumeScriptInsertionTransformStream(): TransformStream<\n  Uint8Array,\n  Uint8Array\n> {\n  const segmentPath = '/_full'\n  const cacheBustingHeader = computeCacheBustingSearchParam(\n    '1', //            headers[NEXT_ROUTER_PREFETCH_HEADER]\n    '/_full', //       headers[NEXT_ROUTER_SEGMENT_PREFETCH_HEADER]\n    undefined, //      headers[NEXT_ROUTER_STATE_TREE_HEADER]\n    undefined //       headers[NEXT_URL]\n  )\n  const searchStr = `${NEXT_RSC_UNION_QUERY}=${cacheBustingHeader}`\n  const NEXT_CLIENT_RESUME_SCRIPT = `<script>__NEXT_CLIENT_RESUME=fetch(location.pathname+'?${searchStr}',{credentials:'same-origin',headers:{'${RSC_HEADER}': '1','${NEXT_ROUTER_PREFETCH_HEADER}': '1','${NEXT_ROUTER_SEGMENT_PREFETCH_HEADER}': '${segmentPath}'}})</script>`\n\n  let didAlreadyInsert = false\n  return new TransformStream({\n    transform(chunk, controller) {\n      if (didAlreadyInsert) {\n        // Already inserted the script into the head. Pass through.\n        controller.enqueue(chunk)\n        return\n      }\n      // TODO (@Ethan-Arrowood): Replace the generic `indexOfUint8Array` method with something finely tuned for the subset of things actually being checked for.\n      const headClosingTagIndex = indexOfUint8Array(\n        chunk,\n        ENCODED_TAGS.CLOSED.HEAD\n      )\n\n      if (headClosingTagIndex === -1) {\n        // In fully static rendering or non PPR rendering cases:\n        // `/head>` will always be found in the chunk in first chunk rendering.\n        controller.enqueue(chunk)\n        return\n      }\n\n      const encodedInsertion = encoder.encode(NEXT_CLIENT_RESUME_SCRIPT)\n      // Get the total count of the bytes in the chunk and the insertion\n      // e.g.\n      // chunk = <head><meta charset=\"utf-8\"></head>\n      // insertion = <script>...</script>\n      // output = <head><meta charset=\"utf-8\"> [ <script>...</script> ] </head>\n      const insertedHeadContent = new Uint8Array(\n        chunk.length + encodedInsertion.length\n      )\n      // Append the first part of the chunk, before the head tag\n      insertedHeadContent.set(chunk.slice(0, headClosingTagIndex))\n      // Append the server inserted content\n      insertedHeadContent.set(encodedInsertion, headClosingTagIndex)\n      // Append the rest of the chunk\n      insertedHeadContent.set(\n        chunk.slice(headClosingTagIndex),\n        headClosingTagIndex + encodedInsertion.length\n      )\n\n      controller.enqueue(insertedHeadContent)\n      didAlreadyInsert = true\n    },\n  })\n}\n\n// Suffix after main body content - scripts before </body>,\n// but wait for the major chunks to be enqueued.\nfunction createDeferredSuffixStream(\n  suffix: string\n): TransformStream<Uint8Array, Uint8Array> {\n  let flushed = false\n  let pending: DetachedPromise<void> | undefined\n\n  const flush = (controller: TransformStreamDefaultController) => {\n    const detached = new DetachedPromise<void>()\n    pending = detached\n\n    scheduleImmediate(() => {\n      try {\n        controller.enqueue(encoder.encode(suffix))\n      } catch {\n        // If an error occurs while enqueuing it can't be due to this\n        // transformers fault. It's likely due to the controller being\n        // errored due to the stream being cancelled.\n      } finally {\n        pending = undefined\n        detached.resolve()\n      }\n    })\n  }\n\n  return new TransformStream({\n    transform(chunk, controller) {\n      controller.enqueue(chunk)\n\n      // If we've already flushed, we're done.\n      if (flushed) return\n\n      // Schedule the flush to happen.\n      flushed = true\n      flush(controller)\n    },\n    flush(controller) {\n      if (pending) return pending.promise\n      if (flushed) return\n\n      // Flush now.\n      controller.enqueue(encoder.encode(suffix))\n    },\n  })\n}\n\nfunction createFlightDataInjectionTransformStream(\n  stream: ReadableStream<Uint8Array>,\n  delayDataUntilFirstHtmlChunk: boolean\n): TransformStream<Uint8Array, Uint8Array> {\n  let htmlStreamFinished = false\n\n  let pull: Promise<void> | null = null\n  let donePulling = false\n\n  function startOrContinuePulling(\n    controller: TransformStreamDefaultController\n  ) {\n    if (!pull) {\n      pull = startPulling(controller)\n    }\n    return pull\n  }\n\n  async function startPulling(controller: TransformStreamDefaultController) {\n    const reader = stream.getReader()\n\n    if (delayDataUntilFirstHtmlChunk) {\n      // NOTE: streaming flush\n      // We are buffering here for the inlined data stream because the\n      // \"shell\" stream might be chunkenized again by the underlying stream\n      // implementation, e.g. with a specific high-water mark. To ensure it's\n      // the safe timing to pipe the data stream, this extra tick is\n      // necessary.\n\n      // We don't start reading until we've left the current Task to ensure\n      // that it's inserted after flushing the shell. Note that this implementation\n      // might get stale if impl details of Fizz change in the future.\n      await atLeastOneTask()\n    }\n\n    try {\n      while (true) {\n        const { done, value } = await reader.read()\n        if (done) {\n          donePulling = true\n          return\n        }\n\n        // We want to prioritize HTML over RSC data.\n        // The SSR render is based on the same RSC stream, so when we get a new RSC chunk,\n        // we're likely to produce an HTML chunk as well, so give it a chance to flush first.\n        if (!delayDataUntilFirstHtmlChunk && !htmlStreamFinished) {\n          await atLeastOneTask()\n        }\n        controller.enqueue(value)\n      }\n    } catch (err) {\n      controller.error(err)\n    }\n  }\n\n  return new TransformStream({\n    start(controller) {\n      if (!delayDataUntilFirstHtmlChunk) {\n        startOrContinuePulling(controller)\n      }\n    },\n    transform(chunk, controller) {\n      controller.enqueue(chunk)\n\n      // Start the streaming if it hasn't already been started yet.\n      if (delayDataUntilFirstHtmlChunk) {\n        startOrContinuePulling(controller)\n      }\n    },\n    flush(controller) {\n      htmlStreamFinished = true\n      if (donePulling) {\n        return\n      }\n      return startOrContinuePulling(controller)\n    },\n  })\n}\n\nconst CLOSE_TAG = '</body></html>'\n\n/**\n * This transform stream moves the suffix to the end of the stream, so results\n * like `</body></html><script>...</script>` will be transformed to\n * `<script>...</script></body></html>`.\n */\nfunction createMoveSuffixStream(): TransformStream<Uint8Array, Uint8Array> {\n  let foundSuffix = false\n\n  return new TransformStream({\n    transform(chunk, controller) {\n      if (foundSuffix) {\n        return controller.enqueue(chunk)\n      }\n\n      const index = indexOfUint8Array(chunk, ENCODED_TAGS.CLOSED.BODY_AND_HTML)\n      if (index > -1) {\n        foundSuffix = true\n\n        // If the whole chunk is the suffix, then don't write anything, it will\n        // be written in the flush.\n        if (chunk.length === ENCODED_TAGS.CLOSED.BODY_AND_HTML.length) {\n          return\n        }\n\n        // Write out the part before the suffix.\n        const before = chunk.slice(0, index)\n        controller.enqueue(before)\n\n        // In the case where the suffix is in the middle of the chunk, we need\n        // to split the chunk into two parts.\n        if (chunk.length > ENCODED_TAGS.CLOSED.BODY_AND_HTML.length + index) {\n          // Write out the part after the suffix.\n          const after = chunk.slice(\n            index + ENCODED_TAGS.CLOSED.BODY_AND_HTML.length\n          )\n          controller.enqueue(after)\n        }\n      } else {\n        controller.enqueue(chunk)\n      }\n    },\n    flush(controller) {\n      // Even if we didn't find the suffix, the HTML is not valid if we don't\n      // add it, so insert it at the end.\n      controller.enqueue(ENCODED_TAGS.CLOSED.BODY_AND_HTML)\n    },\n  })\n}\n\nfunction createStripDocumentClosingTagsTransform(): TransformStream<\n  Uint8Array,\n  Uint8Array\n> {\n  return new TransformStream({\n    transform(chunk, controller) {\n      // We rely on the assumption that chunks will never break across a code unit.\n      // This is reasonable because we currently concat all of React's output from a single\n      // flush into one chunk before streaming it forward which means the chunk will represent\n      // a single coherent utf-8 string. This is not safe to use if we change our streaming to no\n      // longer do this large buffered chunk\n      if (\n        isEquivalentUint8Arrays(chunk, ENCODED_TAGS.CLOSED.BODY_AND_HTML) ||\n        isEquivalentUint8Arrays(chunk, ENCODED_TAGS.CLOSED.BODY) ||\n        isEquivalentUint8Arrays(chunk, ENCODED_TAGS.CLOSED.HTML)\n      ) {\n        // the entire chunk is the closing tags; return without enqueueing anything.\n        return\n      }\n\n      // We assume these tags will go at together at the end of the document and that\n      // they won't appear anywhere else in the document. This is not really a safe assumption\n      // but until we revamp our streaming infra this is a performant way to string the tags\n      chunk = removeFromUint8Array(chunk, ENCODED_TAGS.CLOSED.BODY)\n      chunk = removeFromUint8Array(chunk, ENCODED_TAGS.CLOSED.HTML)\n\n      controller.enqueue(chunk)\n    },\n  })\n}\n\n/*\n * Checks if the root layout is missing the html or body tags\n * and if so, it will inject a script tag to throw an error in the browser, showing the user\n * the error message in the error overlay.\n */\nexport function createRootLayoutValidatorStream(): TransformStream<\n  Uint8Array,\n  Uint8Array\n> {\n  let foundHtml = false\n  let foundBody = false\n  return new TransformStream({\n    async transform(chunk, controller) {\n      // Peek into the streamed chunk to see if the tags are present.\n      if (\n        !foundHtml &&\n        indexOfUint8Array(chunk, ENCODED_TAGS.OPENING.HTML) > -1\n      ) {\n        foundHtml = true\n      }\n\n      if (\n        !foundBody &&\n        indexOfUint8Array(chunk, ENCODED_TAGS.OPENING.BODY) > -1\n      ) {\n        foundBody = true\n      }\n\n      controller.enqueue(chunk)\n    },\n    flush(controller) {\n      const missingTags: ('html' | 'body')[] = []\n      if (!foundHtml) missingTags.push('html')\n      if (!foundBody) missingTags.push('body')\n\n      if (!missingTags.length) return\n\n      controller.enqueue(\n        encoder.encode(\n          `<html id=\"__next_error__\">\n            <template\n              data-next-error-message=\"Missing ${missingTags\n                .map((c) => `<${c}>`)\n                .join(\n                  missingTags.length > 1 ? ' and ' : ''\n                )} tags in the root layout.\\nRead more at https://nextjs.org/docs/messages/missing-root-layout-tags\"\n              data-next-error-digest=\"${MISSING_ROOT_TAGS_ERROR}\"\n              data-next-error-stack=\"\"\n            ></template>\n          `\n        )\n      )\n    },\n  })\n}\n\nfunction chainTransformers<T>(\n  readable: ReadableStream<T>,\n  transformers: ReadonlyArray<TransformStream<T, T> | null>\n): ReadableStream<T> {\n  let stream = readable\n  for (const transformer of transformers) {\n    if (!transformer) continue\n\n    stream = stream.pipeThrough(transformer)\n  }\n  return stream\n}\n\nexport type ContinueStreamOptions = {\n  inlinedDataStream: ReadableStream<Uint8Array> | undefined\n  isStaticGeneration: boolean\n  isBuildTimePrerendering: boolean\n  buildId: string\n  getServerInsertedHTML: () => Promise<string>\n  getServerInsertedMetadata: () => Promise<string>\n  validateRootLayout?: boolean\n  /**\n   * Suffix to inject after the buffered data, but before the close tags.\n   */\n  suffix?: string | undefined\n}\n\nexport async function continueFizzStream(\n  renderStream: ReactDOMServerReadableStream,\n  {\n    suffix,\n    inlinedDataStream,\n    isStaticGeneration,\n    isBuildTimePrerendering,\n    buildId,\n    getServerInsertedHTML,\n    getServerInsertedMetadata,\n    validateRootLayout,\n  }: ContinueStreamOptions\n): Promise<ReadableStream<Uint8Array>> {\n  // Suffix itself might contain close tags at the end, so we need to split it.\n  const suffixUnclosed = suffix ? suffix.split(CLOSE_TAG, 1)[0] : null\n\n  if (isStaticGeneration) {\n    // If we're generating static HTML we need to wait for it to resolve before continuing.\n    await renderStream.allReady\n  } else {\n    // Otherwise, we want to make sure Fizz is done with all microtasky work\n    // before we start pulling the stream and cause a flush.\n    await waitAtLeastOneReactRenderTask()\n  }\n\n  return chainTransformers(renderStream, [\n    // Buffer everything to avoid flushing too frequently\n    createBufferedTransformStream(),\n\n    // Add build id comment to start of the HTML document (in export mode)\n    createPrefetchCommentStream(isBuildTimePrerendering, buildId),\n\n    // Transform metadata\n    createMetadataTransformStream(getServerInsertedMetadata),\n\n    // Insert suffix content\n    suffixUnclosed != null && suffixUnclosed.length > 0\n      ? createDeferredSuffixStream(suffixUnclosed)\n      : null,\n\n    // Insert the inlined data (Flight data, form state, etc.) stream into the HTML\n    inlinedDataStream\n      ? createFlightDataInjectionTransformStream(inlinedDataStream, true)\n      : null,\n\n    // Validate the root layout for missing html or body tags\n    validateRootLayout ? createRootLayoutValidatorStream() : null,\n\n    // Close tags should always be deferred to the end\n    createMoveSuffixStream(),\n\n    // Special head insertions\n    // TODO-APP: Insert server side html to end of head in app layout rendering, to avoid\n    // hydration errors. Remove this once it's ready to be handled by react itself.\n    createHeadInsertionTransformStream(getServerInsertedHTML),\n  ])\n}\n\ntype ContinueDynamicPrerenderOptions = {\n  getServerInsertedHTML: () => Promise<string>\n  getServerInsertedMetadata: () => Promise<string>\n}\n\nexport async function continueDynamicPrerender(\n  prerenderStream: ReadableStream<Uint8Array>,\n  {\n    getServerInsertedHTML,\n    getServerInsertedMetadata,\n  }: ContinueDynamicPrerenderOptions\n) {\n  return (\n    prerenderStream\n      // Buffer everything to avoid flushing too frequently\n      .pipeThrough(createBufferedTransformStream())\n      .pipeThrough(createStripDocumentClosingTagsTransform())\n      // Insert generated tags to head\n      .pipeThrough(createHeadInsertionTransformStream(getServerInsertedHTML))\n      // Transform metadata\n      .pipeThrough(createMetadataTransformStream(getServerInsertedMetadata))\n  )\n}\n\ntype ContinueStaticPrerenderOptions = {\n  inlinedDataStream: ReadableStream<Uint8Array>\n  getServerInsertedHTML: () => Promise<string>\n  getServerInsertedMetadata: () => Promise<string>\n  isBuildTimePrerendering: boolean\n  buildId: string\n}\n\nexport async function continueStaticPrerender(\n  prerenderStream: ReadableStream<Uint8Array>,\n  {\n    inlinedDataStream,\n    getServerInsertedHTML,\n    getServerInsertedMetadata,\n    isBuildTimePrerendering,\n    buildId,\n  }: ContinueStaticPrerenderOptions\n) {\n  return (\n    prerenderStream\n      // Buffer everything to avoid flushing too frequently\n      .pipeThrough(createBufferedTransformStream())\n      // Add build id comment to start of the HTML document (in export mode)\n      .pipeThrough(\n        createPrefetchCommentStream(isBuildTimePrerendering, buildId)\n      )\n      // Insert generated tags to head\n      .pipeThrough(createHeadInsertionTransformStream(getServerInsertedHTML))\n      // Transform metadata\n      .pipeThrough(createMetadataTransformStream(getServerInsertedMetadata))\n      // Insert the inlined data (Flight data, form state, etc.) stream into the HTML\n      .pipeThrough(\n        createFlightDataInjectionTransformStream(inlinedDataStream, true)\n      )\n      // Close tags should always be deferred to the end\n      .pipeThrough(createMoveSuffixStream())\n  )\n}\n\nexport async function continueStaticFallbackPrerender(\n  prerenderStream: ReadableStream<Uint8Array>,\n  {\n    inlinedDataStream,\n    getServerInsertedHTML,\n    getServerInsertedMetadata,\n    isBuildTimePrerendering,\n    buildId,\n  }: ContinueStaticPrerenderOptions\n) {\n  // Same as `continueStaticPrerender`, but also inserts an additional script\n  // to instruct the client to start fetching the hydration data as early\n  // as possible.\n  return (\n    prerenderStream\n      // Buffer everything to avoid flushing too frequently\n      .pipeThrough(createBufferedTransformStream())\n      // Add build id comment to start of the HTML document (in export mode)\n      .pipeThrough(\n        createPrefetchCommentStream(isBuildTimePrerendering, buildId)\n      )\n      // Insert generated tags to head\n      .pipeThrough(createHeadInsertionTransformStream(getServerInsertedHTML))\n      // Insert the client resume script into the head\n      .pipeThrough(createClientResumeScriptInsertionTransformStream())\n      // Transform metadata\n      .pipeThrough(createMetadataTransformStream(getServerInsertedMetadata))\n      // Insert the inlined data (Flight data, form state, etc.) stream into the HTML\n      .pipeThrough(\n        createFlightDataInjectionTransformStream(inlinedDataStream, true)\n      )\n      // Close tags should always be deferred to the end\n      .pipeThrough(createMoveSuffixStream())\n  )\n}\n\ntype ContinueResumeOptions = {\n  inlinedDataStream: ReadableStream<Uint8Array>\n  getServerInsertedHTML: () => Promise<string>\n  getServerInsertedMetadata: () => Promise<string>\n  delayDataUntilFirstHtmlChunk: boolean\n}\n\nexport async function continueDynamicHTMLResume(\n  renderStream: ReadableStream<Uint8Array>,\n  {\n    delayDataUntilFirstHtmlChunk,\n    inlinedDataStream,\n    getServerInsertedHTML,\n    getServerInsertedMetadata,\n  }: ContinueResumeOptions\n) {\n  return (\n    renderStream\n      // Buffer everything to avoid flushing too frequently\n      .pipeThrough(createBufferedTransformStream())\n      // Insert generated tags to head\n      .pipeThrough(createHeadInsertionTransformStream(getServerInsertedHTML))\n      // Transform metadata\n      .pipeThrough(createMetadataTransformStream(getServerInsertedMetadata))\n      // Insert the inlined data (Flight data, form state, etc.) stream into the HTML\n      .pipeThrough(\n        createFlightDataInjectionTransformStream(\n          inlinedDataStream,\n          delayDataUntilFirstHtmlChunk\n        )\n      )\n      // Close tags should always be deferred to the end\n      .pipeThrough(createMoveSuffixStream())\n  )\n}\n\nexport function createDocumentClosingStream(): ReadableStream<Uint8Array> {\n  return streamFromString(CLOSE_TAG)\n}\n","import type { IncomingMessage } from 'http'\nimport type { ParsedUrlQuery } from 'querystring'\nimport type { UrlWithParsedQuery } from 'url'\nimport type { BaseNextRequest } from './base-http'\nimport type { CloneableBody } from './body-streams'\nimport type { RouteMatch } from './route-matches/route-match'\nimport type { NEXT_RSC_UNION_QUERY } from '../client/components/app-router-headers'\nimport type {\n  ResponseCacheEntry,\n  ServerComponentsHmrCache,\n} from './response-cache'\nimport type { PagesDevOverlayBridgeType } from '../next-devtools/userspace/pages/pages-dev-overlay-setup'\nimport type { OpaqueFallbackRouteParams } from './request/fallback-params'\nimport type { IncrementalCache } from './lib/incremental-cache'\n\n// FIXME: (wyattjoh) this is a temporary solution to allow us to pass data between bundled modules\nexport const NEXT_REQUEST_META = Symbol.for('NextInternalRequestMeta')\n\nexport type NextIncomingMessage = (BaseNextRequest | IncomingMessage) & {\n  [NEXT_REQUEST_META]?: RequestMeta\n}\n\n/**\n * The callback function to call when a response cache entry was generated or\n * looked up in the cache. When it returns true, the server assumes that the\n * handler has already responded to the request and will not do so itself.\n */\nexport type OnCacheEntryHandler = (\n  /**\n   * The response cache entry that was generated or looked up in the cache.\n   */\n  cacheEntry: ResponseCacheEntry,\n\n  /**\n   * The request metadata.\n   */\n  requestMeta: {\n    /**\n     * The URL that was used to make the request.\n     */\n    url: string | undefined\n  }\n) => Promise<boolean | void> | boolean | void\n\nexport interface RequestMeta {\n  /**\n   * The query that was used to make the request.\n   */\n  initQuery?: ParsedUrlQuery\n\n  /**\n   * The URL that was used to make the request.\n   */\n  initURL?: string\n\n  /**\n   * The protocol that was used to make the request.\n   */\n  initProtocol?: string\n\n  /**\n   * The body that was read from the request. This is used to allow the body to\n   * be read multiple times.\n   */\n  clonableBody?: CloneableBody\n\n  /**\n   * True when the request matched a locale domain that was configured in the\n   * next.config.js file.\n   */\n  isLocaleDomain?: boolean\n\n  /**\n   * True when the request had locale information stripped from the pathname\n   * part of the URL.\n   */\n  didStripLocale?: boolean\n\n  /**\n   * If the request had it's URL rewritten, this is the URL it was rewritten to.\n   */\n  rewroteURL?: string\n\n  /**\n   * The cookies that were added by middleware and were added to the response.\n   */\n  middlewareCookie?: string[]\n\n  /**\n   * The match on the request for a given route.\n   */\n  match?: RouteMatch\n\n  /**\n   * The incremental cache to use for the request.\n   */\n  incrementalCache?: IncrementalCache\n\n  /**\n   * The server components HMR cache, only for dev.\n   */\n  serverComponentsHmrCache?: ServerComponentsHmrCache\n\n  /**\n   * Equals the segment path that was used for the prefetch RSC request.\n   */\n  segmentPrefetchRSCRequest?: string\n\n  /**\n   * True when the request is for the prefetch flight data.\n   */\n  isPrefetchRSCRequest?: true\n\n  /**\n   * True when the request is for the flight data.\n   */\n  isRSCRequest?: true\n\n  /**\n   * A search param set by the Next.js client when performing RSC requests.\n   * Because some CDNs do not vary their cache entries on our custom headers,\n   * this search param represents a hash of the header values. For any cached\n   * RSC request, we should verify that the hash matches before responding.\n   * Otherwise this can lead to cache poisoning.\n   * TODO: Consider not using custom request headers at all, and instead encode\n   * everything into the search param.\n   */\n  cacheBustingSearchParam?: string\n\n  /**\n   * True when the request is for the `/_next/data` route using the pages\n   * router.\n   */\n  isNextDataReq?: true\n\n  /**\n   * Postponed state to use for resumption. If present it's assumed that the\n   * request is for a page that has postponed (there are no guarantees that the\n   * page actually has postponed though as it would incur an additional cache\n   * lookup).\n   */\n  postponed?: string\n\n  /**\n   * If provided, this will be called when a response cache entry was generated\n   * or looked up in the cache.\n   *\n   * @deprecated Use `onCacheEntryV2` instead.\n   */\n  onCacheEntry?: OnCacheEntryHandler\n\n  /**\n   * If provided, this will be called when a response cache entry was generated\n   * or looked up in the cache.\n   */\n  onCacheEntryV2?: OnCacheEntryHandler\n\n  /**\n   * The previous revalidate before rendering 404 page for notFound: true\n   */\n  notFoundRevalidate?: number | false\n\n  /**\n   * In development, the original source page that returned a 404.\n   */\n  developmentNotFoundSourcePage?: string\n\n  /**\n   * The path we routed to and should be invoked\n   */\n  invokePath?: string\n\n  /**\n   * The specific page output we should be matching\n   */\n  invokeOutput?: string\n\n  /**\n   * The status we are invoking the request with from routing\n   */\n  invokeStatus?: number\n\n  /**\n   * The routing error we are invoking with\n   */\n  invokeError?: Error\n\n  /**\n   * The query parsed for the invocation\n   */\n  invokeQuery?: Record<string, undefined | string | string[]>\n\n  /**\n   * Whether the request is a middleware invocation\n   */\n  middlewareInvoke?: boolean\n\n  /**\n   * Whether the request should render the fallback shell or not.\n   */\n  renderFallbackShell?: boolean\n\n  /**\n   * Whether the request is for the custom error page.\n   */\n  customErrorRender?: true\n\n  /**\n   * Whether to bubble up the NoFallbackError to the caller when a 404 is\n   * returned.\n   */\n  bubbleNoFallback?: true\n\n  /**\n   * True when the request had locale information inferred from the default\n   * locale.\n   */\n  localeInferredFromDefault?: true\n\n  /**\n   * The locale that was inferred or explicitly set for the request.\n   */\n  locale?: string\n\n  /**\n   * The default locale that was inferred or explicitly set for the request.\n   */\n  defaultLocale?: string\n\n  /**\n   * The relative project dir the server is running in from project root\n   */\n  relativeProjectDir?: string\n\n  /**\n   * The dist directory the server is currently using\n   */\n  distDir?: string\n\n  /**\n   * The query after resolving routes\n   */\n  query?: ParsedUrlQuery\n\n  /**\n   * The params after resolving routes\n   */\n  params?: ParsedUrlQuery\n\n  /**\n   * ErrorOverlay component to use in development for pages router\n   */\n  PagesErrorDebug?: PagesDevOverlayBridgeType\n\n  /**\n   * Whether server is in minimal mode (this will be replaced with more\n   * specific flags in future)\n   */\n  minimalMode?: boolean\n\n  /**\n   * DEV only: The fallback params that should be used when validating prerenders during dev\n   */\n  devFallbackParams?: OpaqueFallbackRouteParams\n\n  /**\n   * DEV only: Request timings in process.hrtime.bigint()\n   */\n  devRequestTimingStart?: bigint\n  devRequestTimingMiddlewareStart?: bigint\n  devRequestTimingMiddlewareEnd?: bigint\n  devRequestTimingInternalsEnd?: bigint\n\n  /**\n   * DEV only: The duration of getStaticPaths/generateStaticParams in process.hrtime.bigint()\n   */\n  devGenerateStaticParamsDuration?: bigint\n}\n\n/**\n * Gets the request metadata. If no key is provided, the entire metadata object\n * is returned.\n *\n * @param req the request to get the metadata from\n * @param key the key to get from the metadata (optional)\n * @returns the value for the key or the entire metadata object\n */\nexport function getRequestMeta(\n  req: NextIncomingMessage,\n  key?: undefined\n): RequestMeta\nexport function getRequestMeta<K extends keyof RequestMeta>(\n  req: NextIncomingMessage,\n  key: K\n): RequestMeta[K]\nexport function getRequestMeta<K extends keyof RequestMeta>(\n  req: NextIncomingMessage,\n  key?: K\n): RequestMeta | RequestMeta[K] {\n  const meta = req[NEXT_REQUEST_META] || {}\n  return typeof key === 'string' ? meta[key] : meta\n}\n\n/**\n * Sets the request metadata.\n *\n * @param req the request to set the metadata on\n * @param meta the metadata to set\n * @returns the mutated request metadata\n */\nexport function setRequestMeta(req: NextIncomingMessage, meta: RequestMeta) {\n  req[NEXT_REQUEST_META] = meta\n  return meta\n}\n\n/**\n * Adds a value to the request metadata.\n *\n * @param request the request to mutate\n * @param key the key to set\n * @param value the value to set\n * @returns the mutated request metadata\n */\nexport function addRequestMeta<K extends keyof RequestMeta>(\n  request: NextIncomingMessage,\n  key: K,\n  value: RequestMeta[K]\n) {\n  const meta = getRequestMeta(request)\n  meta[key] = value\n  return setRequestMeta(request, meta)\n}\n\n/**\n * Removes a key from the request metadata.\n *\n * @param request the request to mutate\n * @param key the key to remove\n * @returns the mutated request metadata\n */\nexport function removeRequestMeta<K extends keyof RequestMeta>(\n  request: NextIncomingMessage,\n  key: K\n) {\n  const meta = getRequestMeta(request)\n  delete meta[key]\n  return setRequestMeta(request, meta)\n}\n\ntype NextQueryMetadata = {\n  /**\n   * The `_rsc` query parameter used for cache busting to ensure that the RSC\n   * requests do not get cached by the browser explicitly.\n   */\n  [NEXT_RSC_UNION_QUERY]?: string\n}\n\nexport type NextParsedUrlQuery = ParsedUrlQuery & NextQueryMetadata\n\nexport interface NextUrlWithParsedQuery extends UrlWithParsedQuery {\n  query: NextParsedUrlQuery\n}\n","import type { DomainLocale } from '../../../server/config-shared'\n\nexport function detectDomainLocale(\n  domainItems?: readonly DomainLocale[],\n  hostname?: string,\n  detectedLocale?: string\n) {\n  if (!domainItems) return\n\n  if (detectedLocale) {\n    detectedLocale = detectedLocale.toLowerCase()\n  }\n\n  for (const item of domainItems) {\n    // remove port if present\n    const domainHostname = item.domain?.split(':', 1)[0].toLowerCase()\n    if (\n      hostname === domainHostname ||\n      detectedLocale === item.defaultLocale.toLowerCase() ||\n      item.locales?.some((locale) => locale.toLowerCase() === detectedLocale)\n    ) {\n      return item\n    }\n  }\n}\n","import { parsePath } from './parse-path'\n\n/**\n * Adds the provided prefix to the given path. It first ensures that the path\n * is indeed starting with a slash.\n */\nexport function addPathPrefix(path: string, prefix?: string) {\n  if (!path.startsWith('/') || !prefix) {\n    return path\n  }\n\n  const { pathname, query, hash } = parsePath(path)\n  return `${prefix}${pathname}${query}${hash}`\n}\n","import { parsePath } from './parse-path'\n\n/**\n * Similarly to `addPathPrefix`, this function adds a suffix at the end on the\n * provided path. It also works only for paths ensuring the argument starts\n * with a slash.\n */\nexport function addPathSuffix(path: string, suffix?: string) {\n  if (!path.startsWith('/') || !suffix) {\n    return path\n  }\n\n  const { pathname, query, hash } = parsePath(path)\n  return `${pathname}${suffix}${query}${hash}`\n}\n","import { addPathPrefix } from './add-path-prefix'\nimport { pathHasPrefix } from './path-has-prefix'\n\n/**\n * For a given path and a locale, if the locale is given, it will prefix the\n * locale. The path shouldn't be an API path. If a default locale is given the\n * prefix will be omitted if the locale is already the default locale.\n */\nexport function addLocale(\n  path: string,\n  locale?: string | false,\n  defaultLocale?: string,\n  ignorePrefix?: boolean\n) {\n  // If no locale was given or the locale is the default locale, we don't need\n  // to prefix the path.\n  if (!locale || locale === defaultLocale) return path\n\n  const lower = path.toLowerCase()\n\n  // If the path is an API path or the path already has the locale prefix, we\n  // don't need to prefix the path.\n  if (!ignorePrefix) {\n    if (pathHasPrefix(lower, '/api')) return path\n    if (pathHasPrefix(lower, `/${locale.toLowerCase()}`)) return path\n  }\n\n  // Add the locale prefix to the path.\n  return addPathPrefix(path, `/${locale}`)\n}\n","import type { NextPathnameInfo } from './get-next-pathname-info'\nimport { removeTrailingSlash } from './remove-trailing-slash'\nimport { addPathPrefix } from './add-path-prefix'\nimport { addPathSuffix } from './add-path-suffix'\nimport { addLocale } from './add-locale'\n\ninterface ExtendedInfo extends NextPathnameInfo {\n  defaultLocale?: string\n  ignorePrefix?: boolean\n}\n\nexport function formatNextPathnameInfo(info: ExtendedInfo) {\n  let pathname = addLocale(\n    info.pathname,\n    info.locale,\n    info.buildId ? undefined : info.defaultLocale,\n    info.ignorePrefix\n  )\n\n  if (info.buildId || !info.trailingSlash) {\n    pathname = removeTrailingSlash(pathname)\n  }\n\n  if (info.buildId) {\n    pathname = addPathSuffix(\n      addPathPrefix(pathname, `/_next/data/${info.buildId}`),\n      info.pathname === '/' ? 'index.json' : '.json'\n    )\n  }\n\n  pathname = addPathPrefix(pathname, info.basePath)\n  return !info.buildId && info.trailingSlash\n    ? !pathname.endsWith('/')\n      ? addPathSuffix(pathname, '/')\n      : pathname\n    : removeTrailingSlash(pathname)\n}\n","import type { OutgoingHttpHeaders } from 'http'\n\n/**\n * Takes an object with a hostname property (like a parsed URL) and some\n * headers that may contain Host and returns the preferred hostname.\n * @param parsed An object containing a hostname property.\n * @param headers A dictionary with headers containing a `host`.\n */\nexport function getHostname(\n  parsed: { hostname?: string | null },\n  headers?: OutgoingHttpHeaders\n): string | undefined {\n  // Get the hostname from the headers if it exists, otherwise use the parsed\n  // hostname.\n  let hostname: string\n  if (headers?.host && !Array.isArray(headers.host)) {\n    hostname = headers.host.toString().split(':', 1)[0]\n  } else if (parsed.hostname) {\n    hostname = parsed.hostname\n  } else return\n\n  return hostname.toLowerCase()\n}\n","import { normalizeLocalePath } from '../../i18n/normalize-locale-path'\nimport { removePathPrefix } from './remove-path-prefix'\nimport { pathHasPrefix } from './path-has-prefix'\nimport type { I18NProvider } from '../../../../server/lib/i18n-provider'\n\nexport interface NextPathnameInfo {\n  /**\n   * The base path in case the pathname included it.\n   */\n  basePath?: string\n  /**\n   * The buildId for when the parsed URL is a data URL. Parsing it can be\n   * disabled with the `parseData` option.\n   */\n  buildId?: string\n  /**\n   * If there was a locale in the pathname, this will hold its value.\n   */\n  locale?: string\n  /**\n   * The processed pathname without a base path, locale, or data URL elements\n   * when parsing it is enabled.\n   */\n  pathname: string\n  /**\n   * A boolean telling if the pathname had a trailingSlash. This can be only\n   * true if trailingSlash is enabled.\n   */\n  trailingSlash?: boolean\n}\n\ninterface Options {\n  /**\n   * When passed to true, this function will also parse Nextjs data URLs.\n   */\n  parseData?: boolean\n  /**\n   * A partial of the Next.js configuration to parse the URL.\n   */\n  nextConfig?: {\n    basePath?: string\n    i18n?: { locales?: readonly string[] } | null\n    trailingSlash?: boolean\n  }\n\n  /**\n   * If provided, this normalizer will be used to detect the locale instead of\n   * the default locale detection.\n   */\n  i18nProvider?: I18NProvider\n}\n\nexport function getNextPathnameInfo(\n  pathname: string,\n  options: Options\n): NextPathnameInfo {\n  const { basePath, i18n, trailingSlash } = options.nextConfig ?? {}\n  const info: NextPathnameInfo = {\n    pathname,\n    trailingSlash: pathname !== '/' ? pathname.endsWith('/') : trailingSlash,\n  }\n\n  if (basePath && pathHasPrefix(info.pathname, basePath)) {\n    info.pathname = removePathPrefix(info.pathname, basePath)\n    info.basePath = basePath\n  }\n  let pathnameNoDataPrefix = info.pathname\n\n  if (\n    info.pathname.startsWith('/_next/data/') &&\n    info.pathname.endsWith('.json')\n  ) {\n    const paths = info.pathname\n      .replace(/^\\/_next\\/data\\//, '')\n      .replace(/\\.json$/, '')\n      .split('/')\n\n    const buildId = paths[0]\n    info.buildId = buildId\n    pathnameNoDataPrefix =\n      paths[1] !== 'index' ? `/${paths.slice(1).join('/')}` : '/'\n\n    // update pathname with normalized if enabled although\n    // we use normalized to populate locale info still\n    if (options.parseData === true) {\n      info.pathname = pathnameNoDataPrefix\n    }\n  }\n\n  // If provided, use the locale route normalizer to detect the locale instead\n  // of the function below.\n  if (i18n) {\n    let result = options.i18nProvider\n      ? options.i18nProvider.analyze(info.pathname)\n      : normalizeLocalePath(info.pathname, i18n.locales)\n\n    info.locale = result.detectedLocale\n    info.pathname = result.pathname ?? info.pathname\n\n    if (!result.detectedLocale && info.buildId) {\n      result = options.i18nProvider\n        ? options.i18nProvider.analyze(pathnameNoDataPrefix)\n        : normalizeLocalePath(pathnameNoDataPrefix, i18n.locales)\n\n      if (result.detectedLocale) {\n        info.locale = result.detectedLocale\n      }\n    }\n  }\n  return info\n}\n","import type { OutgoingHttpHeaders } from 'http'\nimport type { DomainLocale, I18NConfig } from '../config-shared'\nimport type { I18NProvider } from '../lib/i18n-provider'\n\nimport { detectDomainLocale } from '../../shared/lib/i18n/detect-domain-locale'\nimport { formatNextPathnameInfo } from '../../shared/lib/router/utils/format-next-pathname-info'\nimport { getHostname } from '../../shared/lib/get-hostname'\nimport { getNextPathnameInfo } from '../../shared/lib/router/utils/get-next-pathname-info'\n\ninterface Options {\n  base?: string | URL\n  headers?: OutgoingHttpHeaders\n  forceLocale?: boolean\n  nextConfig?: {\n    basePath?: string\n    i18n?: I18NConfig | null\n    trailingSlash?: boolean\n  }\n  i18nProvider?: I18NProvider\n}\n\nconst REGEX_LOCALHOST_HOSTNAME =\n  /(?!^https?:\\/\\/)(127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}|\\[::1\\]|localhost)/\n\nfunction parseURL(url: string | URL, base?: string | URL) {\n  return new URL(\n    String(url).replace(REGEX_LOCALHOST_HOSTNAME, 'localhost'),\n    base && String(base).replace(REGEX_LOCALHOST_HOSTNAME, 'localhost')\n  )\n}\n\nconst Internal = Symbol('NextURLInternal')\n\nexport class NextURL {\n  private [Internal]: {\n    basePath: string\n    buildId?: string\n    flightSearchParameters?: Record<string, string>\n    defaultLocale?: string\n    domainLocale?: DomainLocale\n    locale?: string\n    options: Options\n    trailingSlash?: boolean\n    url: URL\n  }\n\n  constructor(input: string | URL, base?: string | URL, opts?: Options)\n  constructor(input: string | URL, opts?: Options)\n  constructor(\n    input: string | URL,\n    baseOrOpts?: string | URL | Options,\n    opts?: Options\n  ) {\n    let base: undefined | string | URL\n    let options: Options\n\n    if (\n      (typeof baseOrOpts === 'object' && 'pathname' in baseOrOpts) ||\n      typeof baseOrOpts === 'string'\n    ) {\n      base = baseOrOpts\n      options = opts || {}\n    } else {\n      options = opts || baseOrOpts || {}\n    }\n\n    this[Internal] = {\n      url: parseURL(input, base ?? options.base),\n      options: options,\n      basePath: '',\n    }\n\n    this.analyze()\n  }\n\n  private analyze() {\n    const info = getNextPathnameInfo(this[Internal].url.pathname, {\n      nextConfig: this[Internal].options.nextConfig,\n      parseData: !process.env.__NEXT_NO_MIDDLEWARE_URL_NORMALIZE,\n      i18nProvider: this[Internal].options.i18nProvider,\n    })\n\n    const hostname = getHostname(\n      this[Internal].url,\n      this[Internal].options.headers\n    )\n    this[Internal].domainLocale = this[Internal].options.i18nProvider\n      ? this[Internal].options.i18nProvider.detectDomainLocale(hostname)\n      : detectDomainLocale(\n          this[Internal].options.nextConfig?.i18n?.domains,\n          hostname\n        )\n\n    const defaultLocale =\n      this[Internal].domainLocale?.defaultLocale ||\n      this[Internal].options.nextConfig?.i18n?.defaultLocale\n\n    this[Internal].url.pathname = info.pathname\n    this[Internal].defaultLocale = defaultLocale\n    this[Internal].basePath = info.basePath ?? ''\n    this[Internal].buildId = info.buildId\n    this[Internal].locale = info.locale ?? defaultLocale\n    this[Internal].trailingSlash = info.trailingSlash\n  }\n\n  private formatPathname() {\n    return formatNextPathnameInfo({\n      basePath: this[Internal].basePath,\n      buildId: this[Internal].buildId,\n      defaultLocale: !this[Internal].options.forceLocale\n        ? this[Internal].defaultLocale\n        : undefined,\n      locale: this[Internal].locale,\n      pathname: this[Internal].url.pathname,\n      trailingSlash: this[Internal].trailingSlash,\n    })\n  }\n\n  private formatSearch() {\n    return this[Internal].url.search\n  }\n\n  public get buildId() {\n    return this[Internal].buildId\n  }\n\n  public set buildId(buildId: string | undefined) {\n    this[Internal].buildId = buildId\n  }\n\n  public get locale() {\n    return this[Internal].locale ?? ''\n  }\n\n  public set locale(locale: string) {\n    if (\n      !this[Internal].locale ||\n      !this[Internal].options.nextConfig?.i18n?.locales.includes(locale)\n    ) {\n      throw new TypeError(\n        `The NextURL configuration includes no locale \"${locale}\"`\n      )\n    }\n\n    this[Internal].locale = locale\n  }\n\n  get defaultLocale() {\n    return this[Internal].defaultLocale\n  }\n\n  get domainLocale() {\n    return this[Internal].domainLocale\n  }\n\n  get searchParams() {\n    return this[Internal].url.searchParams\n  }\n\n  get host() {\n    return this[Internal].url.host\n  }\n\n  set host(value: string) {\n    this[Internal].url.host = value\n  }\n\n  get hostname() {\n    return this[Internal].url.hostname\n  }\n\n  set hostname(value: string) {\n    this[Internal].url.hostname = value\n  }\n\n  get port() {\n    return this[Internal].url.port\n  }\n\n  set port(value: string) {\n    this[Internal].url.port = value\n  }\n\n  get protocol() {\n    return this[Internal].url.protocol\n  }\n\n  set protocol(value: string) {\n    this[Internal].url.protocol = value\n  }\n\n  get href() {\n    const pathname = this.formatPathname()\n    const search = this.formatSearch()\n    return `${this.protocol}//${this.host}${pathname}${search}${this.hash}`\n  }\n\n  set href(url: string) {\n    this[Internal].url = parseURL(url)\n    this.analyze()\n  }\n\n  get origin() {\n    return this[Internal].url.origin\n  }\n\n  get pathname() {\n    return this[Internal].url.pathname\n  }\n\n  set pathname(value: string) {\n    this[Internal].url.pathname = value\n  }\n\n  get hash() {\n    return this[Internal].url.hash\n  }\n\n  set hash(value: string) {\n    this[Internal].url.hash = value\n  }\n\n  get search() {\n    return this[Internal].url.search\n  }\n\n  set search(value: string) {\n    this[Internal].url.search = value\n  }\n\n  get password() {\n    return this[Internal].url.password\n  }\n\n  set password(value: string) {\n    this[Internal].url.password = value\n  }\n\n  get username() {\n    return this[Internal].url.username\n  }\n\n  set username(value: string) {\n    this[Internal].url.username = value\n  }\n\n  get basePath() {\n    return this[Internal].basePath\n  }\n\n  set basePath(value: string) {\n    this[Internal].basePath = value.startsWith('/') ? value : `/${value}`\n  }\n\n  toString() {\n    return this.href\n  }\n\n  toJSON() {\n    return this.href\n  }\n\n  [Symbol.for('edge-runtime.inspect.custom')]() {\n    return {\n      href: this.href,\n      origin: this.origin,\n      protocol: this.protocol,\n      username: this.username,\n      password: this.password,\n      host: this.host,\n      hostname: this.hostname,\n      port: this.port,\n      pathname: this.pathname,\n      search: this.search,\n      searchParams: this.searchParams,\n      hash: this.hash,\n    }\n  }\n\n  clone() {\n    return new NextURL(String(this), this[Internal].options)\n  }\n}\n","export class PageSignatureError extends Error {\n  constructor({ page }: { page: string }) {\n    super(`The middleware \"${page}\" accepts an async API directly with the form:\n  \n  export function middleware(request, event) {\n    return NextResponse.redirect('/new-location')\n  }\n  \n  Read more: https://nextjs.org/docs/messages/middleware-new-signature\n  `)\n  }\n}\n\nexport class RemovedPageError extends Error {\n  constructor() {\n    super(`The request.page has been deprecated in favour of \\`URLPattern\\`.\n  Read more: https://nextjs.org/docs/messages/middleware-request-page\n  `)\n  }\n}\n\nexport class RemovedUAError extends Error {\n  constructor() {\n    super(`The request.ua has been removed in favour of \\`userAgent\\` function.\n  Read more: https://nextjs.org/docs/messages/middleware-parse-user-agent\n  `)\n  }\n}\n","import type { I18NConfig } from '../../config-shared'\nimport { NextURL } from '../next-url'\nimport { toNodeOutgoingHttpHeaders, validateURL } from '../utils'\nimport { RemovedUAError, RemovedPageError } from '../error'\nimport { RequestCookies } from './cookies'\n\nexport const INTERNALS = Symbol('internal request')\n\n/**\n * This class extends the [Web `Request` API](https://developer.mozilla.org/docs/Web/API/Request) with additional convenience methods.\n *\n * Read more: [Next.js Docs: `NextRequest`](https://nextjs.org/docs/app/api-reference/functions/next-request)\n */\nexport class NextRequest extends Request {\n  /** @internal */\n  [INTERNALS]: {\n    cookies: RequestCookies\n    url: string\n    nextUrl: NextURL\n  }\n\n  constructor(input: URL | RequestInfo, init: RequestInit = {}) {\n    const url =\n      typeof input !== 'string' && 'url' in input ? input.url : String(input)\n\n    validateURL(url)\n\n    // node Request instance requires duplex option when a body\n    // is present or it errors, we don't handle this for\n    // Request being passed in since it would have already\n    // errored if this wasn't configured\n    if (process.env.NEXT_RUNTIME !== 'edge') {\n      if (init.body && init.duplex !== 'half') {\n        init.duplex = 'half'\n      }\n    }\n\n    if (input instanceof Request) super(input, init)\n    else super(url, init)\n\n    const nextUrl = new NextURL(url, {\n      headers: toNodeOutgoingHttpHeaders(this.headers),\n      nextConfig: init.nextConfig,\n    })\n    this[INTERNALS] = {\n      cookies: new RequestCookies(this.headers),\n      nextUrl,\n      url: process.env.__NEXT_NO_MIDDLEWARE_URL_NORMALIZE\n        ? url\n        : nextUrl.toString(),\n    }\n  }\n\n  [Symbol.for('edge-runtime.inspect.custom')]() {\n    return {\n      cookies: this.cookies,\n      nextUrl: this.nextUrl,\n      url: this.url,\n      // rest of props come from Request\n      bodyUsed: this.bodyUsed,\n      cache: this.cache,\n      credentials: this.credentials,\n      destination: this.destination,\n      headers: Object.fromEntries(this.headers),\n      integrity: this.integrity,\n      keepalive: this.keepalive,\n      method: this.method,\n      mode: this.mode,\n      redirect: this.redirect,\n      referrer: this.referrer,\n      referrerPolicy: this.referrerPolicy,\n      signal: this.signal,\n    }\n  }\n\n  public get cookies() {\n    return this[INTERNALS].cookies\n  }\n\n  public get nextUrl() {\n    return this[INTERNALS].nextUrl\n  }\n\n  /**\n   * @deprecated\n   * `page` has been deprecated in favour of `URLPattern`.\n   * Read more: https://nextjs.org/docs/messages/middleware-request-page\n   */\n  public get page() {\n    throw new RemovedPageError()\n  }\n\n  /**\n   * @deprecated\n   * `ua` has been removed in favour of \\`userAgent\\` function.\n   * Read more: https://nextjs.org/docs/messages/middleware-parse-user-agent\n   */\n  public get ua() {\n    throw new RemovedUAError()\n  }\n\n  public get url() {\n    return this[INTERNALS].url\n  }\n}\n\nexport interface RequestInit extends globalThis.RequestInit {\n  nextConfig?: {\n    basePath?: string\n    i18n?: I18NConfig | null\n    trailingSlash?: boolean\n  }\n  signal?: AbortSignal\n  // see https://github.com/whatwg/fetch/pull/1457\n  duplex?: 'half'\n}\n","import type { BaseNextRequest, BaseNextResponse } from './'\nimport type { NodeNextRequest, NodeNextResponse } from './node'\nimport type { WebNextRequest, WebNextResponse } from './web'\n\n/**\n * This file provides some helpers that should be used in conjunction with\n * explicit environment checks. When combined with the environment checks, it\n * will ensure that the correct typings are used as well as enable code\n * elimination.\n */\n\n/**\n * Type guard to determine if a request is a WebNextRequest. This does not\n * actually check the type of the request, but rather the runtime environment.\n * It's expected that when the runtime environment is the edge runtime, that any\n * base request is a WebNextRequest.\n */\nexport const isWebNextRequest = (req: BaseNextRequest): req is WebNextRequest =>\n  process.env.NEXT_RUNTIME === 'edge'\n\n/**\n * Type guard to determine if a response is a WebNextResponse. This does not\n * actually check the type of the response, but rather the runtime environment.\n * It's expected that when the runtime environment is the edge runtime, that any\n * base response is a WebNextResponse.\n */\nexport const isWebNextResponse = (\n  res: BaseNextResponse\n): res is WebNextResponse => process.env.NEXT_RUNTIME === 'edge'\n\n/**\n * Type guard to determine if a request is a NodeNextRequest. This does not\n * actually check the type of the request, but rather the runtime environment.\n * It's expected that when the runtime environment is the node runtime, that any\n * base request is a NodeNextRequest.\n */\nexport const isNodeNextRequest = (\n  req: BaseNextRequest\n): req is NodeNextRequest => process.env.NEXT_RUNTIME !== 'edge'\n\n/**\n * Type guard to determine if a response is a NodeNextResponse. This does not\n * actually check the type of the response, but rather the runtime environment.\n * It's expected that when the runtime environment is the node runtime, that any\n * base response is a NodeNextResponse.\n */\nexport const isNodeNextResponse = (\n  res: BaseNextResponse\n): res is NodeNextResponse => process.env.NEXT_RUNTIME !== 'edge'\n","import type { BaseNextRequest } from '../../../base-http'\nimport type { NodeNextRequest } from '../../../base-http/node'\nimport type { WebNextRequest } from '../../../base-http/web'\nimport type { Writable } from 'node:stream'\n\nimport { getRequestMeta } from '../../../request-meta'\nimport { fromNodeOutgoingHttpHeaders } from '../../utils'\nimport { NextRequest } from '../request'\nimport { isNodeNextRequest, isWebNextRequest } from '../../../base-http/helpers'\n\nexport const ResponseAbortedName = 'ResponseAborted'\nexport class ResponseAborted extends Error {\n  public readonly name = ResponseAbortedName\n}\n\n/**\n * Creates an AbortController tied to the closing of a ServerResponse (or other\n * appropriate Writable).\n *\n * If the `close` event is fired before the `finish` event, then we'll send the\n * `abort` signal.\n */\nexport function createAbortController(response: Writable): AbortController {\n  const controller = new AbortController()\n\n  // If `finish` fires first, then `res.end()` has been called and the close is\n  // just us finishing the stream on our side. If `close` fires first, then we\n  // know the client disconnected before we finished.\n  response.once('close', () => {\n    if (response.writableFinished) return\n\n    controller.abort(new ResponseAborted())\n  })\n\n  return controller\n}\n\n/**\n * Creates an AbortSignal tied to the closing of a ServerResponse (or other\n * appropriate Writable).\n *\n * This cannot be done with the request (IncomingMessage or Readable) because\n * the `abort` event will not fire if to data has been fully read (because that\n * will \"close\" the readable stream and nothing fires after that).\n */\nexport function signalFromNodeResponse(response: Writable): AbortSignal {\n  const { errored, destroyed } = response\n  if (errored || destroyed) {\n    return AbortSignal.abort(errored ?? new ResponseAborted())\n  }\n\n  const { signal } = createAbortController(response)\n  return signal\n}\n\nexport class NextRequestAdapter {\n  public static fromBaseNextRequest(\n    request: BaseNextRequest,\n    signal: AbortSignal\n  ): NextRequest {\n    if (\n      // The type check here ensures that `req` is correctly typed, and the\n      // environment variable check provides dead code elimination.\n      process.env.NEXT_RUNTIME === 'edge' &&\n      isWebNextRequest(request)\n    ) {\n      return NextRequestAdapter.fromWebNextRequest(request)\n    } else if (\n      // The type check here ensures that `req` is correctly typed, and the\n      // environment variable check provides dead code elimination.\n      process.env.NEXT_RUNTIME !== 'edge' &&\n      isNodeNextRequest(request)\n    ) {\n      return NextRequestAdapter.fromNodeNextRequest(request, signal)\n    } else {\n      throw new Error('Invariant: Unsupported NextRequest type')\n    }\n  }\n\n  public static fromNodeNextRequest(\n    request: NodeNextRequest,\n    signal: AbortSignal\n  ): NextRequest {\n    // HEAD and GET requests can not have a body.\n    let body: BodyInit | null = null\n    if (request.method !== 'GET' && request.method !== 'HEAD' && request.body) {\n      // @ts-expect-error - this is handled by undici, when streams/web land use it instead\n      body = request.body\n    }\n\n    let url: URL\n    if (request.url.startsWith('http')) {\n      url = new URL(request.url)\n    } else {\n      // Grab the full URL from the request metadata.\n      const base = getRequestMeta(request, 'initURL')\n      if (!base || !base.startsWith('http')) {\n        // Because the URL construction relies on the fact that the URL provided\n        // is absolute, we need to provide a base URL. We can't use the request\n        // URL because it's relative, so we use a dummy URL instead.\n        url = new URL(request.url, 'http://n')\n      } else {\n        url = new URL(request.url, base)\n      }\n    }\n\n    return new NextRequest(url, {\n      method: request.method,\n      headers: fromNodeOutgoingHttpHeaders(request.headers),\n      duplex: 'half',\n      signal,\n      // geo\n      // ip\n      // nextConfig\n\n      // body can not be passed if request was aborted\n      // or we get a Request body was disturbed error\n      ...(signal.aborted\n        ? {}\n        : {\n            body,\n          }),\n    })\n  }\n\n  public static fromWebNextRequest(request: WebNextRequest): NextRequest {\n    // HEAD and GET requests can not have a body.\n    let body: ReadableStream | null = null\n    if (request.method !== 'GET' && request.method !== 'HEAD') {\n      body = request.body\n    }\n\n    return new NextRequest(request.url, {\n      method: request.method,\n      headers: fromNodeOutgoingHttpHeaders(request.headers),\n      duplex: 'half',\n      signal: request.request.signal,\n      // geo\n      // ip\n      // nextConfig\n\n      // body can not be passed if request was aborted\n      // or we get a Request body was disturbed error\n      ...(request.request.signal.aborted\n        ? {}\n        : {\n            body,\n          }),\n    })\n  }\n}\n","import type { AppPageModule } from './route-modules/app-page/module'\n\n// Combined load times for loading client components\nlet clientComponentLoadStart = 0\nlet clientComponentLoadTimes = 0\nlet clientComponentLoadCount = 0\n\nexport function wrapClientComponentLoader(\n  ComponentMod: AppPageModule\n): AppPageModule['__next_app__'] {\n  if (!('performance' in globalThis)) {\n    return ComponentMod.__next_app__\n  }\n\n  return {\n    require: (...args) => {\n      const startTime = performance.now()\n\n      if (clientComponentLoadStart === 0) {\n        clientComponentLoadStart = startTime\n      }\n\n      try {\n        clientComponentLoadCount += 1\n        return ComponentMod.__next_app__.require(...args)\n      } finally {\n        clientComponentLoadTimes += performance.now() - startTime\n      }\n    },\n    loadChunk: (...args) => {\n      const startTime = performance.now()\n      const result = ComponentMod.__next_app__.loadChunk(...args)\n      // Avoid wrapping `loadChunk`'s result in an extra promise in case something like React depends on its identity.\n      // We only need to know when it's settled.\n      result.finally(() => {\n        clientComponentLoadTimes += performance.now() - startTime\n      })\n      return result\n    },\n  }\n}\n\nexport function getClientComponentLoaderMetrics(\n  options: { reset?: boolean } = {}\n) {\n  const metrics =\n    clientComponentLoadStart === 0\n      ? undefined\n      : {\n          clientComponentLoadStart,\n          clientComponentLoadTimes,\n          clientComponentLoadCount,\n        }\n\n  if (options.reset) {\n    clientComponentLoadStart = 0\n    clientComponentLoadTimes = 0\n    clientComponentLoadCount = 0\n  }\n\n  return metrics\n}\n","import type { ServerResponse } from 'node:http'\n\nimport {\n  ResponseAbortedName,\n  createAbortController,\n} from './web/spec-extension/adapters/next-request'\nimport { DetachedPromise } from '../lib/detached-promise'\nimport { getTracer } from './lib/trace/tracer'\nimport { NextNodeServerSpan } from './lib/trace/constants'\nimport { getClientComponentLoaderMetrics } from './client-component-renderer-logger'\n\nexport function isAbortError(e: any): e is Error & { name: 'AbortError' } {\n  return e?.name === 'AbortError' || e?.name === ResponseAbortedName\n}\n\nfunction createWriterFromResponse(\n  res: ServerResponse,\n  waitUntilForEnd?: Promise<unknown>\n): WritableStream<Uint8Array> {\n  let started = false\n\n  // Create a promise that will resolve once the response has drained. See\n  // https://nodejs.org/api/stream.html#stream_event_drain\n  let drained = new DetachedPromise<void>()\n  function onDrain() {\n    drained.resolve()\n  }\n  res.on('drain', onDrain)\n\n  // If the finish event fires, it means we shouldn't block and wait for the\n  // drain event.\n  res.once('close', () => {\n    res.off('drain', onDrain)\n    drained.resolve()\n  })\n\n  // Create a promise that will resolve once the response has finished. See\n  // https://nodejs.org/api/http.html#event-finish_1\n  const finished = new DetachedPromise<void>()\n  res.once('finish', () => {\n    finished.resolve()\n  })\n\n  // Create a writable stream that will write to the response.\n  return new WritableStream<Uint8Array>({\n    write: async (chunk) => {\n      // You'd think we'd want to use `start` instead of placing this in `write`\n      // but this ensures that we don't actually flush the headers until we've\n      // started writing chunks.\n      if (!started) {\n        started = true\n\n        if (\n          'performance' in globalThis &&\n          process.env.NEXT_OTEL_PERFORMANCE_PREFIX\n        ) {\n          const metrics = getClientComponentLoaderMetrics()\n          if (metrics) {\n            performance.measure(\n              `${process.env.NEXT_OTEL_PERFORMANCE_PREFIX}:next-client-component-loading`,\n              {\n                start: metrics.clientComponentLoadStart,\n                end:\n                  metrics.clientComponentLoadStart +\n                  metrics.clientComponentLoadTimes,\n              }\n            )\n          }\n        }\n\n        res.flushHeaders()\n        getTracer().trace(\n          NextNodeServerSpan.startResponse,\n          {\n            spanName: 'start response',\n          },\n          () => undefined\n        )\n      }\n\n      try {\n        const ok = res.write(chunk)\n\n        // Added by the `compression` middleware, this is a function that will\n        // flush the partially-compressed response to the client.\n        if ('flush' in res && typeof res.flush === 'function') {\n          res.flush()\n        }\n\n        // If the write returns false, it means there's some backpressure, so\n        // wait until it's streamed before continuing.\n        if (!ok) {\n          await drained.promise\n\n          // Reset the drained promise so that we can wait for the next drain event.\n          drained = new DetachedPromise<void>()\n        }\n      } catch (err) {\n        res.end()\n        throw new Error('failed to write chunk to response', { cause: err })\n      }\n    },\n    abort: (err) => {\n      if (res.writableFinished) return\n\n      res.destroy(err)\n    },\n    close: async () => {\n      // if a waitUntil promise was passed, wait for it to resolve before\n      // ending the response.\n      if (waitUntilForEnd) {\n        await waitUntilForEnd\n      }\n\n      if (res.writableFinished) return\n\n      res.end()\n      return finished.promise\n    },\n  })\n}\n\nexport async function pipeToNodeResponse(\n  readable: ReadableStream<Uint8Array>,\n  res: ServerResponse,\n  waitUntilForEnd?: Promise<unknown>\n) {\n  try {\n    // If the response has already errored, then just return now.\n    const { errored, destroyed } = res\n    if (errored || destroyed) return\n\n    // Create a new AbortController so that we can abort the readable if the\n    // client disconnects.\n    const controller = createAbortController(res)\n\n    const writer = createWriterFromResponse(res, waitUntilForEnd)\n\n    await readable.pipeTo(writer, { signal: controller.signal })\n  } catch (err: any) {\n    // If this isn't related to an abort error, re-throw it.\n    if (isAbortError(err)) return\n\n    throw new Error('failed to pipe response', { cause: err })\n  }\n}\n","/**\n * Node in the doubly-linked list used for LRU tracking.\n * Each node represents a cache entry with bidirectional pointers.\n */\nclass LRUNode<T> {\n  public readonly key: string\n  public data: T\n  public size: number\n  public prev: LRUNode<T> | SentinelNode<T> | null = null\n  public next: LRUNode<T> | SentinelNode<T> | null = null\n\n  constructor(key: string, data: T, size: number) {\n    this.key = key\n    this.data = data\n    this.size = size\n  }\n}\n\n/**\n * Sentinel node used for head/tail boundaries.\n * These nodes don't contain actual cache data but simplify list operations.\n */\nclass SentinelNode<T> {\n  public prev: LRUNode<T> | SentinelNode<T> | null = null\n  public next: LRUNode<T> | SentinelNode<T> | null = null\n}\n\n/**\n * LRU (Least Recently Used) Cache implementation using a doubly-linked list\n * and hash map for O(1) operations.\n *\n * Algorithm:\n * - Uses a doubly-linked list to maintain access order (most recent at head)\n * - Hash map provides O(1) key-to-node lookup\n * - Sentinel head/tail nodes simplify edge case handling\n * - Size-based eviction supports custom size calculation functions\n *\n * Data Structure Layout:\n * HEAD <-> [most recent] <-> ... <-> [least recent] <-> TAIL\n *\n * Operations:\n * - get(): Move accessed node to head (mark as most recent)\n * - set(): Add new node at head, evict from tail if over capacity\n * - Eviction: Remove least recent node (tail.prev) when size exceeds limit\n */\nexport class LRUCache<T> {\n  private readonly cache: Map<string, LRUNode<T>> = new Map()\n  private readonly head: SentinelNode<T>\n  private readonly tail: SentinelNode<T>\n  private totalSize: number = 0\n  private readonly maxSize: number\n  private readonly calculateSize: ((value: T) => number) | undefined\n  private readonly onEvict: ((key: string, value: T) => void) | undefined\n\n  constructor(\n    maxSize: number,\n    calculateSize?: (value: T) => number,\n    onEvict?: (key: string, value: T) => void\n  ) {\n    this.maxSize = maxSize\n    this.calculateSize = calculateSize\n    this.onEvict = onEvict\n\n    // Create sentinel nodes to simplify doubly-linked list operations\n    // HEAD <-> TAIL (empty list)\n    this.head = new SentinelNode<T>()\n    this.tail = new SentinelNode<T>()\n    this.head.next = this.tail\n    this.tail.prev = this.head\n  }\n\n  /**\n   * Adds a node immediately after the head (marks as most recently used).\n   * Used when inserting new items or when an item is accessed.\n   * PRECONDITION: node must be disconnected (prev/next should be null)\n   */\n  private addToHead(node: LRUNode<T>): void {\n    node.prev = this.head\n    node.next = this.head.next\n    // head.next is always non-null (points to tail or another node)\n    this.head.next!.prev = node\n    this.head.next = node\n  }\n\n  /**\n   * Removes a node from its current position in the doubly-linked list.\n   * Updates the prev/next pointers of adjacent nodes to maintain list integrity.\n   * PRECONDITION: node must be connected (prev/next are non-null)\n   */\n  private removeNode(node: LRUNode<T>): void {\n    // Connected nodes always have non-null prev/next\n    node.prev!.next = node.next\n    node.next!.prev = node.prev\n  }\n\n  /**\n   * Moves an existing node to the head position (marks as most recently used).\n   * This is the core LRU operation - accessed items become most recent.\n   */\n  private moveToHead(node: LRUNode<T>): void {\n    this.removeNode(node)\n    this.addToHead(node)\n  }\n\n  /**\n   * Removes and returns the least recently used node (the one before tail).\n   * This is called during eviction when the cache exceeds capacity.\n   * PRECONDITION: cache is not empty (ensured by caller)\n   */\n  private removeTail(): LRUNode<T> {\n    const lastNode = this.tail.prev as LRUNode<T>\n    // tail.prev is always non-null and always LRUNode when cache is not empty\n    this.removeNode(lastNode)\n    return lastNode\n  }\n\n  /**\n   * Sets a key-value pair in the cache.\n   * If the key exists, updates the value and moves to head.\n   * If new, adds at head and evicts from tail if necessary.\n   *\n   * Time Complexity:\n   * - O(1) for uniform item sizes\n   * - O(k) where k is the number of items evicted (can be O(N) for variable sizes)\n   */\n  public set(key: string, value: T): void {\n    const size = this.calculateSize?.(value) ?? 1\n    if (size > this.maxSize) {\n      console.warn('Single item size exceeds maxSize')\n      return\n    }\n\n    const existing = this.cache.get(key)\n    if (existing) {\n      // Update existing node: adjust size and move to head (most recent)\n      existing.data = value\n      this.totalSize = this.totalSize - existing.size + size\n      existing.size = size\n      this.moveToHead(existing)\n    } else {\n      // Add new node at head (most recent position)\n      const newNode = new LRUNode(key, value, size)\n      this.cache.set(key, newNode)\n      this.addToHead(newNode)\n      this.totalSize += size\n    }\n\n    // Evict least recently used items until under capacity\n    while (this.totalSize > this.maxSize && this.cache.size > 0) {\n      const tail = this.removeTail()\n      this.cache.delete(tail.key)\n      this.totalSize -= tail.size\n      this.onEvict?.(tail.key, tail.data)\n    }\n  }\n\n  /**\n   * Checks if a key exists in the cache.\n   * This is a pure query operation - does NOT update LRU order.\n   *\n   * Time Complexity: O(1)\n   */\n  public has(key: string): boolean {\n    return this.cache.has(key)\n  }\n\n  /**\n   * Retrieves a value by key and marks it as most recently used.\n   * Moving to head maintains the LRU property for future evictions.\n   *\n   * Time Complexity: O(1)\n   */\n  public get(key: string): T | undefined {\n    const node = this.cache.get(key)\n    if (!node) return undefined\n\n    // Mark as most recently used by moving to head\n    this.moveToHead(node)\n\n    return node.data\n  }\n\n  /**\n   * Returns an iterator over the cache entries. The order is outputted in the\n   * order of most recently used to least recently used.\n   */\n  public *[Symbol.iterator](): IterableIterator<[string, T]> {\n    let current = this.head.next\n    while (current && current !== this.tail) {\n      // Between head and tail, current is always LRUNode\n      const node = current as LRUNode<T>\n      yield [node.key, node.data]\n      current = current.next\n    }\n  }\n\n  /**\n   * Removes a specific key from the cache.\n   * Updates both the hash map and doubly-linked list.\n   *\n   * Note: This is an explicit removal and does NOT trigger the `onEvict`\n   * callback. Use this for intentional deletions where eviction tracking\n   * is not needed.\n   *\n   * Time Complexity: O(1)\n   */\n  public remove(key: string): void {\n    const node = this.cache.get(key)\n    if (!node) return\n\n    this.removeNode(node)\n    this.cache.delete(key)\n    this.totalSize -= node.size\n  }\n\n  /**\n   * Returns the number of items in the cache.\n   */\n  public get size(): number {\n    return this.cache.size\n  }\n\n  /**\n   * Returns the current total size of all cached items.\n   * This uses the custom size calculation if provided.\n   */\n  public get currentSize(): number {\n    return this.totalSize\n  }\n}\n","// ISC License\n\n// Copyright (c) 2021 Alexey Raspopov, Kostiantyn Denysov, Anton Verinov\n\n// Permission to use, copy, modify, and/or distribute this software for any\n// purpose with or without fee is hereby granted, provided that the above\n// copyright notice and this permission notice appear in all copies.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES\n// WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF\n// MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR\n// ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES\n// WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN\n// ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF\n// OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.\n//\n// https://github.com/alexeyraspopov/picocolors/blob/b6261487e7b81aaab2440e397a356732cad9e342/picocolors.js#L1\n\nconst { env, stdout } = globalThis?.process ?? {}\n\nconst enabled =\n  env &&\n  !env.NO_COLOR &&\n  (env.FORCE_COLOR || (stdout?.isTTY && !env.CI && env.TERM !== 'dumb'))\n\nconst replaceClose = (\n  str: string,\n  close: string,\n  replace: string,\n  index: number\n): string => {\n  const start = str.substring(0, index) + replace\n  const end = str.substring(index + close.length)\n  const nextIndex = end.indexOf(close)\n  return ~nextIndex\n    ? start + replaceClose(end, close, replace, nextIndex)\n    : start + end\n}\n\nconst formatter = (open: string, close: string, replace = open) => {\n  if (!enabled) return String\n  return (input: string) => {\n    const string = '' + input\n    const index = string.indexOf(close, open.length)\n    return ~index\n      ? open + replaceClose(string, close, replace, index) + close\n      : open + string + close\n  }\n}\n\nexport const reset = enabled ? (s: string) => `\\x1b[0m${s}\\x1b[0m` : String\nexport const bold = formatter('\\x1b[1m', '\\x1b[22m', '\\x1b[22m\\x1b[1m')\nexport const dim = formatter('\\x1b[2m', '\\x1b[22m', '\\x1b[22m\\x1b[2m')\nexport const italic = formatter('\\x1b[3m', '\\x1b[23m')\nexport const underline = formatter('\\x1b[4m', '\\x1b[24m')\nexport const inverse = formatter('\\x1b[7m', '\\x1b[27m')\nexport const hidden = formatter('\\x1b[8m', '\\x1b[28m')\nexport const strikethrough = formatter('\\x1b[9m', '\\x1b[29m')\nexport const black = formatter('\\x1b[30m', '\\x1b[39m')\nexport const red = formatter('\\x1b[31m', '\\x1b[39m')\nexport const green = formatter('\\x1b[32m', '\\x1b[39m')\nexport const yellow = formatter('\\x1b[33m', '\\x1b[39m')\nexport const blue = formatter('\\x1b[34m', '\\x1b[39m')\nexport const magenta = formatter('\\x1b[35m', '\\x1b[39m')\nexport const purple = formatter('\\x1b[38;2;173;127;168m', '\\x1b[39m')\nexport const cyan = formatter('\\x1b[36m', '\\x1b[39m')\nexport const white = formatter('\\x1b[37m', '\\x1b[39m')\nexport const gray = formatter('\\x1b[90m', '\\x1b[39m')\nexport const bgBlack = formatter('\\x1b[40m', '\\x1b[49m')\nexport const bgRed = formatter('\\x1b[41m', '\\x1b[49m')\nexport const bgGreen = formatter('\\x1b[42m', '\\x1b[49m')\nexport const bgYellow = formatter('\\x1b[43m', '\\x1b[49m')\nexport const bgBlue = formatter('\\x1b[44m', '\\x1b[49m')\nexport const bgMagenta = formatter('\\x1b[45m', '\\x1b[49m')\nexport const bgCyan = formatter('\\x1b[46m', '\\x1b[49m')\nexport const bgWhite = formatter('\\x1b[47m', '\\x1b[49m')\n","import { bold, green, magenta, red, yellow, white } from '../../lib/picocolors'\nimport { LRUCache } from '../../server/lib/lru-cache'\n\nexport const prefixes = {\n  wait: white(bold('○')),\n  error: red(bold('⨯')),\n  warn: yellow(bold('⚠')),\n  ready: '▲', // no color\n  info: white(bold(' ')),\n  event: green(bold('✓')),\n  trace: magenta(bold('»')),\n} as const\n\nconst LOGGING_METHOD = {\n  log: 'log',\n  warn: 'warn',\n  error: 'error',\n} as const\n\nfunction prefixedLog(prefixType: keyof typeof prefixes, ...message: any[]) {\n  if ((message[0] === '' || message[0] === undefined) && message.length === 1) {\n    message.shift()\n  }\n\n  const consoleMethod: keyof typeof LOGGING_METHOD =\n    prefixType in LOGGING_METHOD\n      ? LOGGING_METHOD[prefixType as keyof typeof LOGGING_METHOD]\n      : 'log'\n\n  const prefix = prefixes[prefixType]\n  // If there's no message, don't print the prefix but a new line\n  if (message.length === 0) {\n    console[consoleMethod]('')\n  } else {\n    // Ensure if there's ANSI escape codes it's concatenated into one string.\n    // Chrome DevTool can only handle color if it's in one string.\n    if (message.length === 1 && typeof message[0] === 'string') {\n      console[consoleMethod](prefix + ' ' + message[0])\n    } else {\n      console[consoleMethod](prefix, ...message)\n    }\n  }\n}\n\nexport function bootstrap(message: string) {\n  console.log(message)\n}\n\nexport function wait(...message: any[]) {\n  prefixedLog('wait', ...message)\n}\n\nexport function error(...message: any[]) {\n  prefixedLog('error', ...message)\n}\n\nexport function warn(...message: any[]) {\n  prefixedLog('warn', ...message)\n}\n\nexport function ready(...message: any[]) {\n  prefixedLog('ready', ...message)\n}\n\nexport function info(...message: any[]) {\n  prefixedLog('info', ...message)\n}\n\nexport function event(...message: any[]) {\n  prefixedLog('event', ...message)\n}\n\nexport function trace(...message: any[]) {\n  prefixedLog('trace', ...message)\n}\n\nconst warnOnceCache = new LRUCache<string>(10_000, (value) => value.length)\nexport function warnOnce(...message: any[]) {\n  const key = message.join(' ')\n  if (!warnOnceCache.has(key)) {\n    warnOnceCache.set(key, key)\n    warn(...message)\n  }\n}\n\nconst errorOnceCache = new LRUCache<string>(10_000, (value) => value.length)\nexport function errorOnce(...message: any[]) {\n  const key = message.join(' ')\n  if (!errorOnceCache.has(key)) {\n    errorOnceCache.set(key, key)\n    error(...message)\n  }\n}\n"],"names":["parsePath","path","hashIndex","indexOf","queryIndex","hasQuery","pathname","substring","query","undefined","hash","slice","pathHasPrefix","prefix","startsWith","removePathPrefix","withoutPrefix","length","AppRenderSpan","AppRouteRouteHandlersSpan","BaseServerSpan","LoadComponentsSpan","LogSpanAllowList","MiddlewareSpan","NextNodeServerSpan","NextServerSpan","NextVanillaSpanAllowlist","NodeSpan","RenderSpan","ResolveMetadataSpan","RouterSpan","StartServerSpan","Set","BubbledError","SpanKind","SpanStatusCode","getTracer","isBubbledError","NEXT_OTEL_PERFORMANCE_PREFIX","process","env","api","NEXT_RUNTIME","require","err","context","propagation","trace","ROOT_CONTEXT","Error","constructor","bubble","result","error","closeSpanWithError","span","setAttribute","recordException","name","setStatus","code","ERROR","message","end","rootSpanAttributesStore","Map","rootSpanIdKey","createContextKey","lastSpanId","getSpanId","clientTraceDataSetter","set","carrier","key","value","push","NextTracerImpl","getTracerInstance","getContext","getTracePropagationData","activeContext","active","entries","inject","getActiveScopeSpan","getSpan","withPropagatedContext","fn","getter","getSpanContext","remoteContext","extract","with","args","type","fnOrOptions","fnOrEmpty","options","spanName","has","NEXT_OTEL_VERBOSE","hideSpan","spanContext","parentSpan","existingRootSpanId","getValue","isRootSpan","spanId","attributes","setValue","startActiveSpan","startTime","globalThis","performance","now","cleanedUp","onCleanup","delete","measure","split","pop","replace","match","toLowerCase","start","Object","isThenable","then","res","catch","finally","wrap","tracer","optionsObj","apply","arguments","lastArgId","cb","scopeBoundCb","bind","_span","done","startSpan","setSpan","getRootSpanAttributes","get","setRootSpanAttribute","withSpan","DetachedPromise","resolve","reject","promise","Promise","rej","ENCODED_TAGS","OPENING","HTML","Uint8Array","BODY","CLOSED","HEAD","BODY_AND_HTML","META","ICON_MARK","indexOfUint8Array","isEquivalentUint8Arrays","removeFromUint8Array","a","b","i","completeMatch","j","tagIndex","subarray","removed","MISSING_ROOT_TAGS_ERROR","insertBuildIdComment","DOCTYPE_PREFIX","MAX_BUILD_ID_LENGTH","escapeBuildId","buildId","truncated","originalHtml","includes","computeCacheBustingSearchParam","prefetchHeader","segmentPrefetchHeader","stateTreeHeader","nextUrlHeader","hexHash","join","chainStreams","continueDynamicHTMLResume","continueDynamicPrerender","continueFizzStream","continueStaticFallbackPrerender","continueStaticPrerender","createBufferedTransformStream","createDocumentClosingStream","createRootLayoutValidatorStream","renderToInitialFizzStream","streamFromBuffer","streamFromString","streamToBuffer","streamToString","streamToUint8Array","voidCatch","encoder","TextEncoder","streams","ReadableStream","controller","close","readable","writable","TransformStream","pipeTo","preventClose","nextStream","lastStream","str","enqueue","encode","chunk","streamToChunks","stream","reader","getReader","chunks","read","concatUint8Arrays","totalLength","reduce","sum","offset","Buffer","concat","signal","decoder","TextDecoder","fatal","string","aborted","decode","maxBufferByteLength","Infinity","bufferedChunks","bufferByteLength","pending","flush","copiedBytes","bufferedChunk","byteLength","scheduleFlush","detached","scheduleImmediate","transform","createPrefetchCommentStream","isBuildTimePrerendering","didTransformFirstChunk","chunkStr","updatedChunkStr","ReactDOMServer","element","streamOptions","renderToReadableStream","createMetadataTransformStream","insert","chunkIndex","isMarkRemoved","iconMarkIndex","closedHeadIndex","iconMarkLength","replaced","insertion","encodedInsertion","insertionLength","createHeadInsertionTransformStream","inserted","hasBytes","index","insertedHeadContent","createClientResumeScriptInsertionTransformStream","segmentPath","cacheBustingHeader","searchStr","NEXT_RSC_UNION_QUERY","NEXT_CLIENT_RESUME_SCRIPT","RSC_HEADER","NEXT_ROUTER_PREFETCH_HEADER","NEXT_ROUTER_SEGMENT_PREFETCH_HEADER","didAlreadyInsert","headClosingTagIndex","createDeferredSuffixStream","suffix","flushed","createFlightDataInjectionTransformStream","delayDataUntilFirstHtmlChunk","htmlStreamFinished","pull","donePulling","startOrContinuePulling","startPulling","atLeastOneTask","CLOSE_TAG","createMoveSuffixStream","foundSuffix","before","after","createStripDocumentClosingTagsTransform","foundHtml","foundBody","missingTags","map","c","chainTransformers","transformers","transformer","pipeThrough","renderStream","inlinedDataStream","isStaticGeneration","getServerInsertedHTML","getServerInsertedMetadata","validateRootLayout","suffixUnclosed","allReady","waitAtLeastOneReactRenderTask","prerenderStream","NEXT_REQUEST_META","addRequestMeta","getRequestMeta","removeRequestMeta","setRequestMeta","Symbol","for","req","meta","request","detectDomainLocale","domainItems","hostname","detectedLocale","item","domainHostname","domain","defaultLocale","locales","some","locale","addPathPrefix","addPathSuffix","addLocale","ignorePrefix","lower","formatNextPathnameInfo","info","trailingSlash","removeTrailingSlash","basePath","endsWith","getHostname","parsed","headers","host","Array","isArray","toString","getNextPathnameInfo","i18n","nextConfig","pathnameNoDataPrefix","paths","parseData","i18nProvider","analyze","normalizeLocalePath","NextURL","REGEX_LOCALHOST_HOSTNAME","parseURL","url","base","URL","String","Internal","input","baseOrOpts","opts","__NEXT_NO_MIDDLEWARE_URL_NORMALIZE","domainLocale","domains","formatPathname","forceLocale","formatSearch","search","TypeError","searchParams","port","protocol","href","origin","password","username","toJSON","clone","PageSignatureError","RemovedPageError","RemovedUAError","page","INTERNALS","NextRequest","Request","init","validateURL","body","duplex","nextUrl","toNodeOutgoingHttpHeaders","cookies","RequestCookies","bodyUsed","cache","credentials","destination","fromEntries","integrity","keepalive","method","mode","redirect","referrer","referrerPolicy","ua","isNodeNextRequest","isNodeNextResponse","isWebNextRequest","isWebNextResponse","NextRequestAdapter","ResponseAborted","ResponseAbortedName","createAbortController","signalFromNodeResponse","response","AbortController","once","writableFinished","abort","errored","destroyed","AbortSignal","fromBaseNextRequest","fromWebNextRequest","fromNodeNextRequest","fromNodeOutgoingHttpHeaders","getClientComponentLoaderMetrics","wrapClientComponentLoader","clientComponentLoadStart","clientComponentLoadTimes","clientComponentLoadCount","ComponentMod","__next_app__","loadChunk","metrics","reset","isAbortError","pipeToNodeResponse","e","createWriterFromResponse","waitUntilForEnd","started","drained","onDrain","on","off","finished","WritableStream","write","flushHeaders","startResponse","ok","cause","destroy","writer","LRUCache","LRUNode","data","size","prev","next","SentinelNode","maxSize","calculateSize","onEvict","totalSize","head","tail","addToHead","node","removeNode","moveToHead","removeTail","lastNode","console","warn","existing","newNode","iterator","current","remove","currentSize","bgBlack","bgBlue","bgCyan","bgGreen","bgMagenta","bgRed","bgWhite","bgYellow","black","blue","bold","cyan","dim","gray","green","hidden","inverse","italic","magenta","purple","red","strikethrough","underline","white","yellow","stdout","enabled","NO_COLOR","FORCE_COLOR","isTTY","CI","TERM","replaceClose","nextIndex","formatter","open","s","bootstrap","errorOnce","event","prefixes","ready","wait","warnOnce","LOGGING_METHOD","log","prefixedLog","prefixType","shift","consoleMethod","warnOnceCache","errorOnceCache"],"mappings":"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","ignoreList":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29]}