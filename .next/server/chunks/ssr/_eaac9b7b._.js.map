{"version":3,"sources":["../../../../core/services/institution.service.ts","../../../../actions/admin/institution.ts","../../../../.next-internal/server/app/%28main%29/admin/users/page/actions.js%20%28server%20actions%20loader%29","../../../../actions/admin/user.action.ts"],"sourcesContent":["import { prisma } from \"@/lib/prisma\";\n\nexport class InstitutionService {\n    /**\n     * Get all institutions with counts of users and classrooms\n     */\n    static async getInstitutions() {\n        const institutions = await prisma.institution.findMany({\n            include: {\n                _count: {\n                    select: {\n                        users: true,\n                        classrooms: true,\n                    },\n                },\n                users: {\n                    where: {\n                        role: \"INSTITUTION_MANAGER\",\n                    },\n                    select: {\n                        name: true,\n                    },\n                    take: 1,\n                },\n            },\n            orderBy: {\n                createdAt: \"desc\",\n            },\n        });\n\n        return institutions.map((inst) => ({\n            ...inst,\n            managerName: inst.users[0]?.name || \"Unassigned\",\n        }));\n    }\n\n    /**\n     * Get an institution by ID with users and classrooms\n     */\n    static async getInstitutionById(id: string) {\n        return prisma.institution.findUnique({\n            where: { id },\n            include: {\n                users: {\n                    where: {\n                        role: \"INSTITUTION_MANAGER\",\n                    },\n                },\n                classrooms: true,\n                _count: {\n                    select: {\n                        users: true,\n                        classrooms: true,\n                    },\n                },\n            },\n        });\n    }\n\n    /**\n     * Update institution details\n     */\n    static async updateInstitution(id: string, data: {\n        name?: string;\n        logo?: string | null;\n        domain?: string | null;\n    }) {\n        return prisma.institution.update({\n            where: { id },\n            data,\n        });\n    }\n\n    /**\n     * Delete an institution\n     */\n    static async deleteInstitution(id: string) {\n        return prisma.institution.delete({\n            where: { id },\n        });\n    }\n\n    /**\n     * Get detailed stats for an institution\n     */\n    static async getInstitutionStats(id: string) {\n        const stats = await prisma.user.groupBy({\n            by: ['role'],\n            where: {\n                institutionId: id,\n            },\n            _count: true,\n        });\n\n        const classroomCount = await prisma.classroom.count({\n            where: { institutionId: id },\n        });\n\n        const roleCounts = stats.reduce((acc, curr) => {\n            acc[curr.role as string] = curr._count;\n            return acc;\n        }, {} as Record<string, number>);\n\n        return {\n            students: roleCounts[\"STUDENT\"] || 0,\n            teachers: roleCounts[\"TEACHER\"] || 0,\n            contestManagers: roleCounts[\"CONTEST_MANAGER\"] || 0,\n            classrooms: classroomCount,\n        };\n    }\n}\n","\"use server\";\n\nimport { InstitutionService } from \"@/core/services/institution.service\";\nimport { z } from \"zod\";\nimport { revalidatePath, revalidateTag } from \"next/cache\";\nimport redis from \"@/lib/redis\";\n\nconst institutionSchema = z.object({\n    name: z.string().min(2, \"Name must be at least 2 characters\"),\n    slug: z.string().min(2, \"Slug must be at least 2 characters\").regex(/^[a-z0-9-]+$/, \"Slug must be lowercase alphanumeric and hyphens\"),\n    logo: z.string().url().optional().or(z.literal(\"\")),\n    domain: z.string().optional().or(z.literal(\"\")),\n});\n\nconst updateInstitutionSchema = institutionSchema.partial();\n\nexport async function getInstitutions() {\n    try {\n        const institutions = await InstitutionService.getInstitutions();\n        return { success: true, institutions };\n    } catch (error) {\n        console.error(\"Failed to fetch institutions:\", error);\n        return { success: false, error: \"Failed to fetch institutions\" };\n    }\n}\n\nexport async function getInstitutionById(id: string) {\n    try {\n        const institution = await InstitutionService.getInstitutionById(id);\n        if (!institution) return { success: false, error: \"Institution not found\" };\n        return { success: true, institution };\n    } catch (error) {\n        console.error(\"Failed to fetch institution:\", error);\n        return { success: false, error: \"Failed to fetch institution\" };\n    }\n}\n\n\n// Redefining create in Service for clarity\nexport async function createInstitutionAction(data: z.infer<typeof institutionSchema>) {\n    try {\n        const validatedData = institutionSchema.parse(data);\n        // Directly use prisma for create if not in service yet\n        const { prisma } = await import(\"@/lib/prisma\");\n        const institution = await prisma.institution.create({\n            data: {\n                name: validatedData.name,\n                slug: validatedData.slug,\n                logo: validatedData.logo || null,\n                domain: validatedData.domain || null,\n            },\n        });\n\n        revalidatePath(\"/admin/institutions\");\n        return { success: true, data: institution };\n    } catch (error) {\n        if (error instanceof z.ZodError) {\n            return { success: false, error: error.issues[0].message };\n        }\n        console.error(\"Failed to create institution:\", error);\n        return { success: false, error: \"Failed to create institution\" };\n    }\n}\n\nexport async function updateInstitutionAction(id: string, data: z.infer<typeof updateInstitutionSchema>) {\n    try {\n        const validatedData = updateInstitutionSchema.parse(data);\n        const institution = await InstitutionService.updateInstitution(id, {\n            ...validatedData,\n            logo: validatedData.logo || undefined,\n            domain: validatedData.domain || undefined,\n        });\n\n        revalidatePath(\"/admin/institutions\");\n        revalidatePath(`/admin/institutions/${id}`);\n        return { success: true, data: institution };\n    } catch (error) {\n        if (error instanceof z.ZodError) {\n            return { success: false, error: error.issues[0].message };\n        }\n        console.error(\"Failed to update institution:\", error);\n        return { success: false, error: \"Failed to update institution\" };\n    }\n}\n\nexport async function assignInstitutionManager(email: string, institutionId: string) {\n    try {\n        const { prisma } = await import(\"@/lib/prisma\");\n        const user = await prisma.user.findUnique({\n            where: { email },\n        });\n\n        if (!user) {\n            return { success: false, error: \"User not found\" };\n        }\n\n        const updatedUser = await prisma.user.update({\n            where: { id: user.id },\n            data: {\n                role: \"INSTITUTION_MANAGER\",\n                institutionId: institutionId,\n            },\n        });\n\n        revalidatePath(\"/admin/users\");\n        revalidatePath(`/admin/institutions/${institutionId}`);\n        revalidateTag(`dashboard-${user.id}`, \"max\");\n        await redis.del(`dashboard:stats:${user.id}`);\n\n        return { success: true, data: updatedUser };\n    } catch (error) {\n        console.error(\"Failed to assign institution manager:\", error);\n        return { success: false, error: \"Failed to assign institution manager\" };\n    }\n}\n\nexport async function searchUsersByEmail(query: string) {\n    try {\n        const { prisma } = await import(\"@/lib/prisma\");\n        const users = await prisma.user.findMany({\n            where: {\n                email: {\n                    contains: query,\n                    mode: \"insensitive\",\n                },\n            },\n            select: {\n                id: true,\n                email: true,\n                name: true,\n            },\n            take: 5,\n        });\n\n        return { success: true, users };\n    } catch (error) {\n        console.error(\"Failed to search users:\", error);\n        return { success: false, error: \"Failed to search users\" };\n    }\n}\n\nexport async function removeInstitutionManager(userId: string, institutionId: string) {\n    try {\n        const { prisma } = await import(\"@/lib/prisma\");\n\n        // Downgrade to STUDENT and remove institution assignment\n        await prisma.user.update({\n            where: { id: userId },\n            data: {\n                role: \"STUDENT\",\n                institutionId: null,\n            },\n        });\n\n        revalidatePath(`/admin/institutions/${institutionId}`);\n        revalidateTag(`dashboard-${userId}`, \"max\");\n        await redis.del(`dashboard:stats:${userId}`);\n\n        return { success: true };\n    } catch (error) {\n        console.error(\"Failed to remove manager:\", error);\n        return { success: false, error: \"Failed to remove administrative access\" };\n    }\n}\n\nexport async function deleteInstitutionAction(id: string) {\n    try {\n        // First disconnect all users from this institution\n        const { prisma } = await import(\"@/lib/prisma\");\n\n        // This is a safety measure to avoid orphan institution IDs on users\n        await prisma.user.updateMany({\n            where: { institutionId: id },\n            data: { institutionId: null },\n        });\n\n        await InstitutionService.deleteInstitution(id);\n\n        revalidatePath(\"/admin/institutions\");\n        return { success: true };\n    } catch (error) {\n        console.error(\"Failed to delete institution:\", error);\n        return { success: false, error: \"Failed to delete institution. Ensure it has no active classrooms.\" };\n    }\n}\n\nexport async function getInstitutionUsers(institutionId: string, page: number = 1, searchQuery: string = \"\") {\n    try {\n        const { prisma } = await import(\"@/lib/prisma\");\n        const limit = 20;\n        const skip = (page - 1) * limit;\n\n        const where: any = {\n            institutionId,\n        };\n\n        if (searchQuery) {\n            where.OR = [\n                { name: { contains: searchQuery, mode: \"insensitive\" } },\n                { email: { contains: searchQuery, mode: \"insensitive\" } },\n            ];\n        }\n\n        const [users, total] = await Promise.all([\n            prisma.user.findMany({\n                where,\n                skip,\n                take: limit,\n                orderBy: { createdAt: \"desc\" },\n                select: {\n                    id: true,\n                    name: true,\n                    email: true,\n                    role: true,\n                    createdAt: true,\n                },\n            }),\n            prisma.user.count({ where }),\n        ]);\n\n        return { success: true, users, total };\n    } catch (error) {\n        console.error(\"Failed to fetch institution users:\", error);\n        return { success: false, error: \"Failed to fetch institution users\" };\n    }\n}\n\nexport async function removeUserFromInstitution(userId: string) {\n    try {\n        const { prisma } = await import(\"@/lib/prisma\");\n\n        const user = await prisma.user.update({\n            where: { id: userId },\n            data: {\n                institutionId: null,\n                // If they were a manager, teacher, etc. specifically for this institution,\n                // we might want to downgrade them to STUDENT, but for now we'll just remove the link.\n            },\n        });\n\n        revalidateTag(`user-${userId}`, \"max\");\n        revalidateTag(`dashboard-${userId}`, \"max\");\n\n        // Clear redis if it exists\n        try {\n            const redis = (await import(\"@/lib/redis\")).default;\n            await redis.del(`dashboard:stats:${userId}`);\n        } catch (e) {}\n\n        return { success: true };\n    } catch (error) {\n        console.error(\"Failed to remove user from institution:\", error);\n        return { success: false, error: \"Failed to remove user from institution\" };\n    }\n}\n","export {checkSessionConflict as '00f4c838ce10f91796a39f1558a3b75432fa49882a'} from 'ACTIONS_MODULE0'\nexport {resolveSessionConflict as '409bc5870257fe05de038549e85b0722c4e09c83d4'} from 'ACTIONS_MODULE0'\nexport {getUserScore as '80ee7282f708e60661ecc42477a6d2afba42f1d5ed'} from 'ACTIONS_MODULE1'\nexport {deleteUserAction as '40f97450be6512b9094b3b1e412428a6338250337b'} from 'ACTIONS_MODULE2'\nexport {updateUserRoleAction as '602f4f364a30190965bb9e0a1fe6350eacea315092'} from 'ACTIONS_MODULE2'\nexport {getInstitutions as '009f0a1e5777df118a0513af529d00d008ce515130'} from 'ACTIONS_MODULE3'\nexport {getFilteredUsers as '40dcda7245806dbdcef52a1d264e93ad3d1ccab337'} from 'ACTIONS_MODULE2'\n","\"use server\";\n\nimport { prisma } from \"@/lib/prisma\";\nimport { auth } from \"@/lib/auth\";\nimport { headers } from \"next/headers\";\nimport { Role } from \"@prisma/client\";\nimport { revalidateTag } from \"next/cache\";\nimport redis from \"@/lib/redis\";\n\nexport async function getFilteredUsers(params: {\n    page: number;\n    limit: number;\n    search?: string;\n    roles?: Role[];\n    institutionId?: string;\n}) {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n\n    if (session?.user?.role !== \"ADMIN\") {\n        throw new Error(\"Unauthorized\");\n    }\n\n    const { page, limit, search, roles, institutionId } = params;\n    const skip = (page - 1) * limit;\n\n    const where: any = {};\n\n    if (search) {\n        where.OR = [\n            { name: { contains: search, mode: \"insensitive\" } },\n            { email: { contains: search, mode: \"insensitive\" } },\n        ];\n    }\n\n    if (roles && roles.length > 0) {\n        where.role = { in: roles };\n    }\n\n    if (institutionId && institutionId !== \"all\") {\n        if (institutionId === \"none\") {\n            where.institutionId = null;\n        } else {\n            where.institutionId = institutionId;\n        }\n    }\n\n    const [users, total] = await Promise.all([\n        prisma.user.findMany({\n            where,\n            skip,\n            take: limit,\n            orderBy: { createdAt: \"desc\" },\n            select: {\n                id: true,\n                name: true,\n                email: true,\n                role: true,\n                institutionId: true,\n                createdAt: true,\n                banned: true,\n            }\n        }),\n        prisma.user.count({ where })\n    ]);\n\n    return {\n        users,\n        total,\n    };\n}\n\nexport async function deleteUserAction(userId: string) {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n\n    if (session?.user?.role !== \"ADMIN\") {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    if (session.user.id === userId) {\n        return { success: false, error: \"You cannot delete yourself\" };\n    }\n\n    try {\n        await prisma.$transaction(async (tx) => {\n            // 1. Check for dependent classrooms\n            const classrooms = await tx.classroom.count({ where: { teacherId: userId } });\n            if (classrooms > 0) {\n                // Option A: Hard delete classrooms (dangerous but fulfills \"delete\" request)\n                await tx.classroom.deleteMany({ where: { teacherId: userId } });\n            }\n\n            // 2. Handle Problems (Nullable userId usually means we can keep the problem but orphan it)\n            await tx.problem.updateMany({\n                where: { userId: userId },\n                data: { userId: null }\n            });\n\n            // 3. Contests have onDelete: Cascade for creatorId, but let's be safe\n            // However, prisma might still need manual help if there are other relations\n\n            // Final Delete\n            await tx.user.delete({\n                where: { id: userId }\n            });\n        });\n\n        return { success: true };\n    } catch (error: any) {\n        console.error(\"Failed to delete user:\", error);\n        return { success: false, error: error.message || \"Failed to delete user\" };\n    }\n}\n\nexport async function updateUserRoleAction(userId: string, role: string) {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n\n    if (session?.user?.role !== \"ADMIN\") {\n        return { success: false, error: \"Unauthorized\" };\n    }\n\n    try {\n        await prisma.user.update({\n            where: { id: userId },\n            data: { role: role as Role }\n        });\n\n        // Invalidate dashboard cache\n        revalidateTag(`dashboard-${userId}`, \"max\");\n        await redis.del(`dashboard:stats:${userId}`);\n\n        return { success: true };\n    } catch (error: any) {\n        console.error(\"Failed to update role:\", error);\n        return { success: false, error: error.message || \"Failed to update role\" };\n    }\n}\n"],"names":[],"mappings":"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"}