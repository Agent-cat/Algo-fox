module.exports=[222981,(a,b,c)=>{"use strict";function d(a){return null!==a&&"object"==typeof a&&"then"in a&&"function"==typeof a.then}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"isThenable",{enumerable:!0,get:function(){return d}})},945271,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"trackDynamicImport",{enumerable:!0,get:function(){return g}});let d=a.r(950640),e=a.r(222981),f=a.r(434270);function g(a){if(!(0,e.isThenable)(a))throw Object.defineProperty(new d.InvariantError("`trackDynamicImport` should always receive a promise. Something went wrong in the dynamic imports transform."),"__NEXT_ERROR_CODE",{value:"E677",enumerable:!1,configurable:!0});return(0,f.trackPendingImport)(a),a}},260711,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"trackDynamicImport",{enumerable:!0,get:function(){return d.trackDynamicImport}});let d=a.r(945271)},297251,a=>{"use strict";var b=a.i(260711),c=a.i(852460);let d=(0,c.freeze)({is:a=>"AlterTableNode"===a.kind,create:a=>(0,c.freeze)({kind:"AlterTableNode",table:a}),cloneWithTableProps:(a,b)=>(0,c.freeze)({...a,...b}),cloneWithColumnAlteration:(a,b)=>(0,c.freeze)({...a,columnAlterations:a.columnAlterations?[...a.columnAlterations,b]:[b]})});var e=a.i(620860);let f=(0,c.freeze)({is:a=>"CreateIndexNode"===a.kind,create:a=>(0,c.freeze)({kind:"CreateIndexNode",name:e.IdentifierNode.create(a)}),cloneWith:(a,b)=>(0,c.freeze)({...a,...b}),cloneWithColumns:(a,b)=>(0,c.freeze)({...a,columns:[...a.columns||[],...b]})}),g=(0,c.freeze)({is:a=>"CreateSchemaNode"===a.kind,create:(a,b)=>(0,c.freeze)({kind:"CreateSchemaNode",schema:e.IdentifierNode.create(a),...b}),cloneWith:(a,b)=>(0,c.freeze)({...a,...b})});var h=a.i(919945),i=a.i(908896);let j=(0,c.freeze)({is:a=>"DropIndexNode"===a.kind,create:(a,b)=>(0,c.freeze)({kind:"DropIndexNode",name:i.SchemableIdentifierNode.create(a),...b}),cloneWith:(a,b)=>(0,c.freeze)({...a,...b})}),k=(0,c.freeze)({is:a=>"DropSchemaNode"===a.kind,create:(a,b)=>(0,c.freeze)({kind:"DropSchemaNode",schema:e.IdentifierNode.create(a),...b}),cloneWith:(a,b)=>(0,c.freeze)({...a,...b})}),l=(0,c.freeze)({is:a=>"DropTableNode"===a.kind,create:(a,b)=>(0,c.freeze)({kind:"DropTableNode",table:a,...b}),cloneWith:(a,b)=>(0,c.freeze)({...a,...b})});var m=a.i(966101);let n=(0,c.freeze)({is:a=>"AddColumnNode"===a.kind,create:a=>(0,c.freeze)({kind:"AddColumnNode",column:a})});var o=a.i(340672);let p=(0,c.freeze)({is:a=>"ColumnDefinitionNode"===a.kind,create:(a,b)=>(0,c.freeze)({kind:"ColumnDefinitionNode",column:o.ColumnNode.create(a),dataType:b}),cloneWithFrontModifier:(a,b)=>(0,c.freeze)({...a,frontModifiers:a.frontModifiers?(0,c.freeze)([...a.frontModifiers,b]):[b]}),cloneWithEndModifier:(a,b)=>(0,c.freeze)({...a,endModifiers:a.endModifiers?(0,c.freeze)([...a.endModifiers,b]):[b]}),cloneWith:(a,b)=>(0,c.freeze)({...a,...b})}),q=(0,c.freeze)({is:a=>"DropColumnNode"===a.kind,create:a=>(0,c.freeze)({kind:"DropColumnNode",column:o.ColumnNode.create(a)})}),r=(0,c.freeze)({is:a=>"RenameColumnNode"===a.kind,create:(a,b)=>(0,c.freeze)({kind:"RenameColumnNode",column:o.ColumnNode.create(a),renameTo:o.ColumnNode.create(b)})}),s=(0,c.freeze)({is:a=>"CheckConstraintNode"===a.kind,create:(a,b)=>(0,c.freeze)({kind:"CheckConstraintNode",expression:a,name:b?e.IdentifierNode.create(b):void 0})}),t=["no action","restrict","cascade","set null","set default"],u=(0,c.freeze)({is:a=>"ReferencesNode"===a.kind,create:(a,b)=>(0,c.freeze)({kind:"ReferencesNode",table:a,columns:(0,c.freeze)([...b])}),cloneWithOnDelete:(a,b)=>(0,c.freeze)({...a,onDelete:b}),cloneWithOnUpdate:(a,b)=>(0,c.freeze)({...a,onUpdate:b})});var v=a.i(198722),w=a.i(489774),x=a.i(158758),y=a.i(620033);function z(a){return(0,x.isOperationNodeSource)(a)?a.toOperationNode():y.ValueNode.createImmediate(a)}let A=(0,c.freeze)({is:a=>"GeneratedNode"===a.kind,create:a=>(0,c.freeze)({kind:"GeneratedNode",...a}),createWithExpression:a=>(0,c.freeze)({kind:"GeneratedNode",always:!0,expression:a}),cloneWith:(a,b)=>(0,c.freeze)({...a,...b})}),B=(0,c.freeze)({is:a=>"DefaultValueNode"===a.kind,create:a=>(0,c.freeze)({kind:"DefaultValueNode",defaultValue:a})});function C(a){if(t.includes(a))return a;throw Error(`invalid OnModifyForeignAction ${a}`)}class D{#a;constructor(a){this.#a=a}autoIncrement(){return new D(p.cloneWith(this.#a,{autoIncrement:!0}))}identity(){return new D(p.cloneWith(this.#a,{identity:!0}))}primaryKey(){return new D(p.cloneWith(this.#a,{primaryKey:!0}))}references(a){let b=(0,w.parseStringReference)(a);if(!b.table||v.SelectAllNode.is(b.column))throw Error(`invalid call references('${a}'). The reference must have format table.column or schema.table.column`);return new D(p.cloneWith(this.#a,{references:u.create(b.table,[b.column])}))}onDelete(a){if(!this.#a.references)throw Error("on delete constraint can only be added for foreign keys");return new D(p.cloneWith(this.#a,{references:u.cloneWithOnDelete(this.#a.references,C(a))}))}onUpdate(a){if(!this.#a.references)throw Error("on update constraint can only be added for foreign keys");return new D(p.cloneWith(this.#a,{references:u.cloneWithOnUpdate(this.#a.references,C(a))}))}unique(){return new D(p.cloneWith(this.#a,{unique:!0}))}notNull(){return new D(p.cloneWith(this.#a,{notNull:!0}))}unsigned(){return new D(p.cloneWith(this.#a,{unsigned:!0}))}defaultTo(a){return new D(p.cloneWith(this.#a,{defaultTo:B.create(z(a))}))}check(a){return new D(p.cloneWith(this.#a,{check:s.create(a.toOperationNode())}))}generatedAlwaysAs(a){return new D(p.cloneWith(this.#a,{generated:A.createWithExpression(a.toOperationNode())}))}generatedAlwaysAsIdentity(){return new D(p.cloneWith(this.#a,{generated:A.create({identity:!0,always:!0})}))}generatedByDefaultAsIdentity(){return new D(p.cloneWith(this.#a,{generated:A.create({identity:!0,byDefault:!0})}))}stored(){if(!this.#a.generated)throw Error("stored() can only be called after generatedAlwaysAs");return new D(p.cloneWith(this.#a,{generated:A.cloneWith(this.#a.generated,{stored:!0})}))}modifyFront(a){return new D(p.cloneWithFrontModifier(this.#a,a.toOperationNode()))}nullsNotDistinct(){return new D(p.cloneWith(this.#a,{nullsNotDistinct:!0}))}ifNotExists(){return new D(p.cloneWith(this.#a,{ifNotExists:!0}))}modifyEnd(a){return new D(p.cloneWithEndModifier(this.#a,a.toOperationNode()))}$call(a){return a(this)}toOperationNode(){return this.#a}}let E=(0,c.freeze)({is:a=>"ModifyColumnNode"===a.kind,create:a=>(0,c.freeze)({kind:"ModifyColumnNode",column:a})});var F=a.i(9582);let G=(0,c.freeze)({is:a=>"ForeignKeyConstraintNode"===a.kind,create:(a,b,d,f)=>(0,c.freeze)({kind:"ForeignKeyConstraintNode",columns:a,references:u.create(b,d),name:f?e.IdentifierNode.create(f):void 0}),cloneWith:(a,b)=>(0,c.freeze)({...a,...b})});class H{#a;constructor(a){this.#a=a}onDelete(a){return new H(G.cloneWith(this.#a,{onDelete:C(a)}))}onUpdate(a){return new H(G.cloneWith(this.#a,{onUpdate:C(a)}))}deferrable(){return new H(G.cloneWith(this.#a,{deferrable:!0}))}notDeferrable(){return new H(G.cloneWith(this.#a,{deferrable:!1}))}initiallyDeferred(){return new H(G.cloneWith(this.#a,{initiallyDeferred:!0}))}initiallyImmediate(){return new H(G.cloneWith(this.#a,{initiallyDeferred:!1}))}$call(a){return a(this)}toOperationNode(){return this.#a}}let I=(0,c.freeze)({is:a=>"AddConstraintNode"===a.kind,create:a=>(0,c.freeze)({kind:"AddConstraintNode",constraint:a})}),J=(0,c.freeze)({is:a=>"UniqueConstraintNode"===a.kind,create:(a,b,d)=>(0,c.freeze)({kind:"UniqueConstraintNode",columns:(0,c.freeze)(a.map(o.ColumnNode.create)),name:b?e.IdentifierNode.create(b):void 0,nullsNotDistinct:d}),cloneWith:(a,b)=>(0,c.freeze)({...a,...b})}),K=(0,c.freeze)({is:a=>"DropConstraintNode"===a.kind,create:a=>(0,c.freeze)({kind:"DropConstraintNode",constraintName:e.IdentifierNode.create(a)}),cloneWith:(a,b)=>(0,c.freeze)({...a,...b})}),L=(0,c.freeze)({is:a=>"AlterColumnNode"===a.kind,create:(a,b,d)=>(0,c.freeze)({kind:"AlterColumnNode",column:o.ColumnNode.create(a),[b]:d})});class M{#b;constructor(a){this.#b=a}setDataType(a){return new N(L.create(this.#b,"dataType",(0,F.parseDataTypeExpression)(a)))}setDefault(a){return new N(L.create(this.#b,"setDefault",z(a)))}dropDefault(){return new N(L.create(this.#b,"dropDefault",!0))}setNotNull(){return new N(L.create(this.#b,"setNotNull",!0))}dropNotNull(){return new N(L.create(this.#b,"dropNotNull",!0))}$call(a){return a(this)}}class N{#c;constructor(a){this.#c=a}toOperationNode(){return this.#c}}class O{#d;constructor(a){this.#d=(0,c.freeze)(a)}toOperationNode(){return this.#d.executor.transformQuery(this.#d.node,this.#d.queryId)}compile(){return this.#d.executor.compileQuery(this.toOperationNode(),this.#d.queryId)}async execute(){await this.#d.executor.executeQuery(this.compile())}}class P{#d;constructor(a){this.#d=(0,c.freeze)(a)}onDelete(a){return new P({...this.#d,constraintBuilder:this.#d.constraintBuilder.onDelete(a)})}onUpdate(a){return new P({...this.#d,constraintBuilder:this.#d.constraintBuilder.onUpdate(a)})}deferrable(){return new P({...this.#d,constraintBuilder:this.#d.constraintBuilder.deferrable()})}notDeferrable(){return new P({...this.#d,constraintBuilder:this.#d.constraintBuilder.notDeferrable()})}initiallyDeferred(){return new P({...this.#d,constraintBuilder:this.#d.constraintBuilder.initiallyDeferred()})}initiallyImmediate(){return new P({...this.#d,constraintBuilder:this.#d.constraintBuilder.initiallyImmediate()})}$call(a){return a(this)}toOperationNode(){return this.#d.executor.transformQuery(d.cloneWithTableProps(this.#d.node,{addConstraint:I.create(this.#d.constraintBuilder.toOperationNode())}),this.#d.queryId)}compile(){return this.#d.executor.compileQuery(this.toOperationNode(),this.#d.queryId)}async execute(){await this.#d.executor.executeQuery(this.compile())}}class Q{#d;constructor(a){this.#d=(0,c.freeze)(a)}ifExists(){return new Q({...this.#d,node:d.cloneWithTableProps(this.#d.node,{dropConstraint:K.cloneWith(this.#d.node.dropConstraint,{ifExists:!0})})})}cascade(){return new Q({...this.#d,node:d.cloneWithTableProps(this.#d.node,{dropConstraint:K.cloneWith(this.#d.node.dropConstraint,{modifier:"cascade"})})})}restrict(){return new Q({...this.#d,node:d.cloneWithTableProps(this.#d.node,{dropConstraint:K.cloneWith(this.#d.node.dropConstraint,{modifier:"restrict"})})})}$call(a){return a(this)}toOperationNode(){return this.#d.executor.transformQuery(this.#d.node,this.#d.queryId)}compile(){return this.#d.executor.compileQuery(this.toOperationNode(),this.#d.queryId)}async execute(){await this.#d.executor.executeQuery(this.compile())}}let R=(0,c.freeze)({is:a=>"PrimaryKeyConstraintNode"===a.kind,create:(a,b)=>(0,c.freeze)({kind:"PrimaryKeyConstraintNode",columns:(0,c.freeze)(a.map(o.ColumnNode.create)),name:b?e.IdentifierNode.create(b):void 0}),cloneWith:(a,b)=>(0,c.freeze)({...a,...b})}),S=(0,c.freeze)({is:a=>"AddIndexNode"===a.kind,create:a=>(0,c.freeze)({kind:"AddIndexNode",name:e.IdentifierNode.create(a)}),cloneWith:(a,b)=>(0,c.freeze)({...a,...b}),cloneWithColumns:(a,b)=>(0,c.freeze)({...a,columns:[...a.columns||[],...b]})});var T=a.i(293807);class U{#d;constructor(a){this.#d=(0,c.freeze)(a)}unique(){return new U({...this.#d,node:d.cloneWithTableProps(this.#d.node,{addIndex:S.cloneWith(this.#d.node.addIndex,{unique:!0})})})}column(a){return new U({...this.#d,node:d.cloneWithTableProps(this.#d.node,{addIndex:S.cloneWithColumns(this.#d.node.addIndex,[(0,w.parseOrderedColumnName)(a)])})})}columns(a){return new U({...this.#d,node:d.cloneWithTableProps(this.#d.node,{addIndex:S.cloneWithColumns(this.#d.node.addIndex,a.map(w.parseOrderedColumnName))})})}expression(a){return new U({...this.#d,node:d.cloneWithTableProps(this.#d.node,{addIndex:S.cloneWithColumns(this.#d.node.addIndex,[a.toOperationNode()])})})}using(a){return new U({...this.#d,node:d.cloneWithTableProps(this.#d.node,{addIndex:S.cloneWith(this.#d.node.addIndex,{using:T.RawNode.createWithSql(a)})})})}$call(a){return a(this)}toOperationNode(){return this.#d.executor.transformQuery(this.#d.node,this.#d.queryId)}compile(){return this.#d.executor.compileQuery(this.toOperationNode(),this.#d.queryId)}async execute(){await this.#d.executor.executeQuery(this.compile())}}class V{#a;constructor(a){this.#a=a}nullsNotDistinct(){return new V(J.cloneWith(this.#a,{nullsNotDistinct:!0}))}deferrable(){return new V(J.cloneWith(this.#a,{deferrable:!0}))}notDeferrable(){return new V(J.cloneWith(this.#a,{deferrable:!1}))}initiallyDeferred(){return new V(J.cloneWith(this.#a,{initiallyDeferred:!0}))}initiallyImmediate(){return new V(J.cloneWith(this.#a,{initiallyDeferred:!1}))}$call(a){return a(this)}toOperationNode(){return this.#a}}class W{#a;constructor(a){this.#a=a}deferrable(){return new W(R.cloneWith(this.#a,{deferrable:!0}))}notDeferrable(){return new W(R.cloneWith(this.#a,{deferrable:!1}))}initiallyDeferred(){return new W(R.cloneWith(this.#a,{initiallyDeferred:!0}))}initiallyImmediate(){return new W(R.cloneWith(this.#a,{initiallyDeferred:!1}))}$call(a){return a(this)}toOperationNode(){return this.#a}}class X{#a;constructor(a){this.#a=a}$call(a){return a(this)}toOperationNode(){return this.#a}}let Y=(0,c.freeze)({is:a=>"RenameConstraintNode"===a.kind,create:(a,b)=>(0,c.freeze)({kind:"RenameConstraintNode",oldName:e.IdentifierNode.create(a),newName:e.IdentifierNode.create(b)})});class Z{#d;constructor(a){this.#d=(0,c.freeze)(a)}renameTo(a){return new O({...this.#d,node:d.cloneWithTableProps(this.#d.node,{renameTo:(0,m.parseTable)(a)})})}setSchema(a){return new O({...this.#d,node:d.cloneWithTableProps(this.#d.node,{setSchema:e.IdentifierNode.create(a)})})}alterColumn(a,b){let c=b(new M(a));return new $({...this.#d,node:d.cloneWithColumnAlteration(this.#d.node,c.toOperationNode())})}dropColumn(a){return new $({...this.#d,node:d.cloneWithColumnAlteration(this.#d.node,q.create(a))})}renameColumn(a,b){return new $({...this.#d,node:d.cloneWithColumnAlteration(this.#d.node,r.create(a,b))})}addColumn(a,b,e=c.noop){let f=e(new D(p.create(a,(0,F.parseDataTypeExpression)(b))));return new $({...this.#d,node:d.cloneWithColumnAlteration(this.#d.node,n.create(f.toOperationNode()))})}modifyColumn(a,b,e=c.noop){let f=e(new D(p.create(a,(0,F.parseDataTypeExpression)(b))));return new $({...this.#d,node:d.cloneWithColumnAlteration(this.#d.node,E.create(f.toOperationNode()))})}addUniqueConstraint(a,b,e=c.noop){let f=e(new V(J.create(b,a)));return new O({...this.#d,node:d.cloneWithTableProps(this.#d.node,{addConstraint:I.create(f.toOperationNode())})})}addCheckConstraint(a,b,e=c.noop){let f=e(new X(s.create(b.toOperationNode(),a)));return new O({...this.#d,node:d.cloneWithTableProps(this.#d.node,{addConstraint:I.create(f.toOperationNode())})})}addForeignKeyConstraint(a,b,d,e,f=c.noop){let g=f(new H(G.create(b.map(o.ColumnNode.create),(0,m.parseTable)(d),e.map(o.ColumnNode.create),a)));return new P({...this.#d,constraintBuilder:g})}addPrimaryKeyConstraint(a,b,e=c.noop){let f=e(new W(R.create(b,a)));return new O({...this.#d,node:d.cloneWithTableProps(this.#d.node,{addConstraint:I.create(f.toOperationNode())})})}dropConstraint(a){return new Q({...this.#d,node:d.cloneWithTableProps(this.#d.node,{dropConstraint:K.create(a)})})}renameConstraint(a,b){return new Q({...this.#d,node:d.cloneWithTableProps(this.#d.node,{renameConstraint:Y.create(a,b)})})}addIndex(a){return new U({...this.#d,node:d.cloneWithTableProps(this.#d.node,{addIndex:S.create(a)})})}dropIndex(a){return new O({...this.#d,node:d.cloneWithTableProps(this.#d.node,{dropIndex:j.create(a)})})}$call(a){return a(this)}}class ${#d;constructor(a){this.#d=(0,c.freeze)(a)}alterColumn(a,b){let c=b(new M(a));return new $({...this.#d,node:d.cloneWithColumnAlteration(this.#d.node,c.toOperationNode())})}dropColumn(a){return new $({...this.#d,node:d.cloneWithColumnAlteration(this.#d.node,q.create(a))})}renameColumn(a,b){return new $({...this.#d,node:d.cloneWithColumnAlteration(this.#d.node,r.create(a,b))})}addColumn(a,b,e=c.noop){let f=e(new D(p.create(a,(0,F.parseDataTypeExpression)(b))));return new $({...this.#d,node:d.cloneWithColumnAlteration(this.#d.node,n.create(f.toOperationNode()))})}modifyColumn(a,b,e=c.noop){let f=e(new D(p.create(a,(0,F.parseDataTypeExpression)(b))));return new $({...this.#d,node:d.cloneWithColumnAlteration(this.#d.node,E.create(f.toOperationNode()))})}toOperationNode(){return this.#d.executor.transformQuery(this.#d.node,this.#d.queryId)}compile(){return this.#d.executor.compileQuery(this.toOperationNode(),this.#d.queryId)}async execute(){await this.#d.executor.executeQuery(this.compile())}}var _=a.i(245228),aa=a.i(639399),ab=a.i(197365),ac=a.i(372590);class ad extends ab.OperationNodeTransformer{transformPrimitiveValueList(a){return ac.ValueListNode.create(a.values.map(y.ValueNode.createImmediate))}transformValue(a){return y.ValueNode.createImmediate(a.value)}}class ae{#d;constructor(a){this.#d=(0,c.freeze)(a)}ifNotExists(){return new ae({...this.#d,node:f.cloneWith(this.#d.node,{ifNotExists:!0})})}unique(){return new ae({...this.#d,node:f.cloneWith(this.#d.node,{unique:!0})})}nullsNotDistinct(){return new ae({...this.#d,node:f.cloneWith(this.#d.node,{nullsNotDistinct:!0})})}on(a){return new ae({...this.#d,node:f.cloneWith(this.#d.node,{table:(0,m.parseTable)(a)})})}column(a){return new ae({...this.#d,node:f.cloneWithColumns(this.#d.node,[(0,w.parseOrderedColumnName)(a)])})}columns(a){return new ae({...this.#d,node:f.cloneWithColumns(this.#d.node,a.map(w.parseOrderedColumnName))})}expression(a){return new ae({...this.#d,node:f.cloneWithColumns(this.#d.node,[a.toOperationNode()])})}using(a){return new ae({...this.#d,node:f.cloneWith(this.#d.node,{using:T.RawNode.createWithSql(a)})})}where(...a){let b=new ad;return new ae({...this.#d,node:aa.QueryNode.cloneWithWhere(this.#d.node,b.transformNode((0,_.parseValueBinaryOperationOrExpression)(a),this.#d.queryId))})}$call(a){return a(this)}toOperationNode(){return this.#d.executor.transformQuery(this.#d.node,this.#d.queryId)}compile(){return this.#d.executor.compileQuery(this.toOperationNode(),this.#d.queryId)}async execute(){await this.#d.executor.executeQuery(this.compile())}}class af{#d;constructor(a){this.#d=(0,c.freeze)(a)}ifNotExists(){return new af({...this.#d,node:g.cloneWith(this.#d.node,{ifNotExists:!0})})}$call(a){return a(this)}toOperationNode(){return this.#d.executor.transformQuery(this.#d.node,this.#d.queryId)}compile(){return this.#d.executor.compileQuery(this.toOperationNode(),this.#d.queryId)}async execute(){await this.#d.executor.executeQuery(this.compile())}}var ag=a.i(704789);class ah{#d;constructor(a){this.#d=(0,c.freeze)(a)}temporary(){return new ah({...this.#d,node:h.CreateTableNode.cloneWith(this.#d.node,{temporary:!0})})}onCommit(a){return new ah({...this.#d,node:h.CreateTableNode.cloneWith(this.#d.node,{onCommit:function(a){if(h.ON_COMMIT_ACTIONS.includes(a))return a;throw Error(`invalid OnCommitAction ${a}`)}(a)})})}ifNotExists(){return new ah({...this.#d,node:h.CreateTableNode.cloneWith(this.#d.node,{ifNotExists:!0})})}addColumn(a,b,d=c.noop){let e=d(new D(p.create(a,(0,F.parseDataTypeExpression)(b))));return new ah({...this.#d,node:h.CreateTableNode.cloneWithColumn(this.#d.node,e.toOperationNode())})}addPrimaryKeyConstraint(a,b,d=c.noop){let e=d(new W(R.create(b,a)));return new ah({...this.#d,node:h.CreateTableNode.cloneWithConstraint(this.#d.node,e.toOperationNode())})}addUniqueConstraint(a,b,d=c.noop){let e=d(new V(J.create(b,a)));return new ah({...this.#d,node:h.CreateTableNode.cloneWithConstraint(this.#d.node,e.toOperationNode())})}addCheckConstraint(a,b,d=c.noop){let e=d(new X(s.create(b.toOperationNode(),a)));return new ah({...this.#d,node:h.CreateTableNode.cloneWithConstraint(this.#d.node,e.toOperationNode())})}addForeignKeyConstraint(a,b,d,e,f=c.noop){let g=f(new H(G.create(b.map(o.ColumnNode.create),(0,m.parseTable)(d),e.map(o.ColumnNode.create),a)));return new ah({...this.#d,node:h.CreateTableNode.cloneWithConstraint(this.#d.node,g.toOperationNode())})}modifyFront(a){return new ah({...this.#d,node:h.CreateTableNode.cloneWithFrontModifier(this.#d.node,a.toOperationNode())})}modifyEnd(a){return new ah({...this.#d,node:h.CreateTableNode.cloneWithEndModifier(this.#d.node,a.toOperationNode())})}as(a){return new ah({...this.#d,node:h.CreateTableNode.cloneWith(this.#d.node,{selectQuery:(0,ag.parseExpression)(a)})})}$call(a){return a(this)}toOperationNode(){return this.#d.executor.transformQuery(this.#d.node,this.#d.queryId)}compile(){return this.#d.executor.compileQuery(this.toOperationNode(),this.#d.queryId)}async execute(){await this.#d.executor.executeQuery(this.compile())}}class ai{#d;constructor(a){this.#d=(0,c.freeze)(a)}on(a){return new ai({...this.#d,node:j.cloneWith(this.#d.node,{table:(0,m.parseTable)(a)})})}ifExists(){return new ai({...this.#d,node:j.cloneWith(this.#d.node,{ifExists:!0})})}cascade(){return new ai({...this.#d,node:j.cloneWith(this.#d.node,{cascade:!0})})}$call(a){return a(this)}toOperationNode(){return this.#d.executor.transformQuery(this.#d.node,this.#d.queryId)}compile(){return this.#d.executor.compileQuery(this.toOperationNode(),this.#d.queryId)}async execute(){await this.#d.executor.executeQuery(this.compile())}}class aj{#d;constructor(a){this.#d=(0,c.freeze)(a)}ifExists(){return new aj({...this.#d,node:k.cloneWith(this.#d.node,{ifExists:!0})})}cascade(){return new aj({...this.#d,node:k.cloneWith(this.#d.node,{cascade:!0})})}$call(a){return a(this)}toOperationNode(){return this.#d.executor.transformQuery(this.#d.node,this.#d.queryId)}compile(){return this.#d.executor.compileQuery(this.toOperationNode(),this.#d.queryId)}async execute(){await this.#d.executor.executeQuery(this.compile())}}class ak{#d;constructor(a){this.#d=(0,c.freeze)(a)}ifExists(){return new ak({...this.#d,node:l.cloneWith(this.#d.node,{ifExists:!0})})}cascade(){return new ak({...this.#d,node:l.cloneWith(this.#d.node,{cascade:!0})})}$call(a){return a(this)}toOperationNode(){return this.#d.executor.transformQuery(this.#d.node,this.#d.queryId)}compile(){return this.#d.executor.compileQuery(this.toOperationNode(),this.#d.queryId)}async execute(){await this.#d.executor.executeQuery(this.compile())}}var al=a.i(613344),am=a.i(185545),an=a.i(112741);class ao{#e=new ad;transformQuery(a){return this.#e.transformNode(a.node,a.queryId)}transformResult(a){return Promise.resolve(a.result)}}class ap{#d;constructor(a){this.#d=(0,c.freeze)(a)}temporary(){return new ap({...this.#d,node:an.CreateViewNode.cloneWith(this.#d.node,{temporary:!0})})}materialized(){return new ap({...this.#d,node:an.CreateViewNode.cloneWith(this.#d.node,{materialized:!0})})}ifNotExists(){return new ap({...this.#d,node:an.CreateViewNode.cloneWith(this.#d.node,{ifNotExists:!0})})}orReplace(){return new ap({...this.#d,node:an.CreateViewNode.cloneWith(this.#d.node,{orReplace:!0})})}columns(a){return new ap({...this.#d,node:an.CreateViewNode.cloneWith(this.#d.node,{columns:a.map(w.parseColumnName)})})}as(a){let b=a.withPlugin(new ao).toOperationNode();return new ap({...this.#d,node:an.CreateViewNode.cloneWith(this.#d.node,{as:b})})}$call(a){return a(this)}toOperationNode(){return this.#d.executor.transformQuery(this.#d.node,this.#d.queryId)}compile(){return this.#d.executor.compileQuery(this.toOperationNode(),this.#d.queryId)}async execute(){await this.#d.executor.executeQuery(this.compile())}}let aq=(0,c.freeze)({is:a=>"DropViewNode"===a.kind,create:a=>(0,c.freeze)({kind:"DropViewNode",name:i.SchemableIdentifierNode.create(a)}),cloneWith:(a,b)=>(0,c.freeze)({...a,...b})});class ar{#d;constructor(a){this.#d=(0,c.freeze)(a)}materialized(){return new ar({...this.#d,node:aq.cloneWith(this.#d.node,{materialized:!0})})}ifExists(){return new ar({...this.#d,node:aq.cloneWith(this.#d.node,{ifExists:!0})})}cascade(){return new ar({...this.#d,node:aq.cloneWith(this.#d.node,{cascade:!0})})}$call(a){return a(this)}toOperationNode(){return this.#d.executor.transformQuery(this.#d.node,this.#d.queryId)}compile(){return this.#d.executor.compileQuery(this.toOperationNode(),this.#d.queryId)}async execute(){await this.#d.executor.executeQuery(this.compile())}}let as=(0,c.freeze)({is:a=>"CreateTypeNode"===a.kind,create:a=>(0,c.freeze)({kind:"CreateTypeNode",name:a}),cloneWithEnum:(a,b)=>(0,c.freeze)({...a,enum:ac.ValueListNode.create(b.map(y.ValueNode.createImmediate))})});class at{#d;constructor(a){this.#d=(0,c.freeze)(a)}toOperationNode(){return this.#d.executor.transformQuery(this.#d.node,this.#d.queryId)}asEnum(a){return new at({...this.#d,node:as.cloneWithEnum(this.#d.node,a)})}$call(a){return a(this)}compile(){return this.#d.executor.compileQuery(this.toOperationNode(),this.#d.queryId)}async execute(){await this.#d.executor.executeQuery(this.compile())}}let au=(0,c.freeze)({is:a=>"DropTypeNode"===a.kind,create:a=>(0,c.freeze)({kind:"DropTypeNode",name:a}),cloneWith:(a,b)=>(0,c.freeze)({...a,...b})});class av{#d;constructor(a){this.#d=(0,c.freeze)(a)}ifExists(){return new av({...this.#d,node:au.cloneWith(this.#d.node,{ifExists:!0})})}$call(a){return a(this)}toOperationNode(){return this.#d.executor.transformQuery(this.#d.node,this.#d.queryId)}compile(){return this.#d.executor.compileQuery(this.toOperationNode(),this.#d.queryId)}async execute(){await this.#d.executor.executeQuery(this.compile())}}function aw(a){if(!a.includes("."))return i.SchemableIdentifierNode.create(a);{let b=a.split(".").map(ax);if(2===b.length)return i.SchemableIdentifierNode.createWithSchema(b[0],b[1]);throw Error(`invalid schemable identifier ${a}`)}}function ax(a){return a.trim()}let ay=(0,c.freeze)({is:a=>"RefreshMaterializedViewNode"===a.kind,create:a=>(0,c.freeze)({kind:"RefreshMaterializedViewNode",name:i.SchemableIdentifierNode.create(a)}),cloneWith:(a,b)=>(0,c.freeze)({...a,...b})});class az{#d;constructor(a){this.#d=(0,c.freeze)(a)}concurrently(){return new az({...this.#d,node:ay.cloneWith(this.#d.node,{concurrently:!0,withNoData:!1})})}withData(){return new az({...this.#d,node:ay.cloneWith(this.#d.node,{withNoData:!1})})}withNoData(){return new az({...this.#d,node:ay.cloneWith(this.#d.node,{withNoData:!0,concurrently:!1})})}$call(a){return a(this)}toOperationNode(){return this.#d.executor.transformQuery(this.#d.node,this.#d.queryId)}compile(){return this.#d.executor.compileQuery(this.toOperationNode(),this.#d.queryId)}async execute(){await this.#d.executor.executeQuery(this.compile())}}class aA{#f;constructor(a){this.#f=a}createTable(a){return new ah({queryId:(0,al.createQueryId)(),executor:this.#f,node:h.CreateTableNode.create((0,m.parseTable)(a))})}dropTable(a){return new ak({queryId:(0,al.createQueryId)(),executor:this.#f,node:l.create((0,m.parseTable)(a))})}createIndex(a){return new ae({queryId:(0,al.createQueryId)(),executor:this.#f,node:f.create(a)})}dropIndex(a){return new ai({queryId:(0,al.createQueryId)(),executor:this.#f,node:j.create(a)})}createSchema(a){return new af({queryId:(0,al.createQueryId)(),executor:this.#f,node:g.create(a)})}dropSchema(a){return new aj({queryId:(0,al.createQueryId)(),executor:this.#f,node:k.create(a)})}alterTable(a){return new Z({queryId:(0,al.createQueryId)(),executor:this.#f,node:d.create((0,m.parseTable)(a))})}createView(a){return new ap({queryId:(0,al.createQueryId)(),executor:this.#f,node:an.CreateViewNode.create(a)})}refreshMaterializedView(a){return new az({queryId:(0,al.createQueryId)(),executor:this.#f,node:ay.create(a)})}dropView(a){return new ar({queryId:(0,al.createQueryId)(),executor:this.#f,node:aq.create(a)})}createType(a){return new at({queryId:(0,al.createQueryId)(),executor:this.#f,node:as.create(aw(a))})}dropType(a){return new av({queryId:(0,al.createQueryId)(),executor:this.#f,node:au.create(aw(a))})}withPlugin(a){return new aA(this.#f.withPlugin(a))}withoutPlugins(){return new aA(this.#f.withoutPlugins())}withSchema(a){return new aA(this.#f.withPluginAtFront(new am.WithSchemaPlugin(a)))}}var aB=a.i(627675),aC=a.i(542769);class aD{ref(a){return new aB.DynamicReferenceBuilder(a)}table(a){return new aC.DynamicTableBuilder(a)}}class aE{#g;constructor(a){this.#g=a}async provideConnection(a){let b=await this.#g.acquireConnection();try{return await a(b)}finally{await this.#g.releaseConnection(b)}}}var aF=a.i(272839),aG=a.i(406271);class aH extends aG.QueryExecutorBase{#h;#i;#j;constructor(a,b,c,d=[]){super(d),this.#h=a,this.#i=b,this.#j=c}get adapter(){return this.#i}compileQuery(a,b){return this.#h.compileQuery(a,b)}provideConnection(a){return this.#j.provideConnection(a)}withPlugins(a){return new aH(this.#h,this.#i,this.#j,[...this.plugins,...a])}withPlugin(a){return new aH(this.#h,this.#i,this.#j,[...this.plugins,a])}withPluginAtFront(a){return new aH(this.#h,this.#i,this.#j,[a,...this.plugins])}withConnectionProvider(a){return new aH(this.#h,this.#i,a,[...this.plugins])}withoutPlugins(){return new aH(this.#h,this.#i,this.#j,[])}}function aI(){return"u">typeof performance&&(0,c.isFunction)(performance.now)?performance.now():Date.now()}class aJ{#g;#k;#l;#m;#n;#o=new WeakSet;constructor(a,b){this.#m=!1,this.#g=a,this.#k=b}async init(){if(this.#n)throw Error("driver has already been destroyed");this.#l||(this.#l=this.#g.init().then(()=>{this.#m=!0}).catch(a=>(this.#l=void 0,Promise.reject(a)))),await this.#l}async acquireConnection(){if(this.#n)throw Error("driver has already been destroyed");this.#m||await this.init();let a=await this.#g.acquireConnection();return this.#o.has(a)||(this.#p()&&this.#q(a),this.#o.add(a)),a}async releaseConnection(a){await this.#g.releaseConnection(a)}beginTransaction(a,b){return this.#g.beginTransaction(a,b)}commitTransaction(a){return this.#g.commitTransaction(a)}rollbackTransaction(a){return this.#g.rollbackTransaction(a)}savepoint(a,b,c){if(this.#g.savepoint)return this.#g.savepoint(a,b,c);throw Error("The `savepoint` method is not supported by this driver")}rollbackToSavepoint(a,b,c){if(this.#g.rollbackToSavepoint)return this.#g.rollbackToSavepoint(a,b,c);throw Error("The `rollbackToSavepoint` method is not supported by this driver")}releaseSavepoint(a,b,c){if(this.#g.releaseSavepoint)return this.#g.releaseSavepoint(a,b,c);throw Error("The `releaseSavepoint` method is not supported by this driver")}async destroy(){this.#l&&(await this.#l,this.#n||(this.#n=this.#g.destroy().catch(a=>(this.#n=void 0,Promise.reject(a)))),await this.#n)}#p(){return this.#k.isLevelEnabled("query")||this.#k.isLevelEnabled("error")}#q(a){let b=a.executeQuery,c=a.streamQuery,d=this;a.executeQuery=async c=>{let e,f=aI();try{return await b.call(a,c)}catch(a){throw e=a,await d.#r(a,c,f),a}finally{e||await d.#s(c,f)}},a.streamQuery=async function*(b,e){let f,g=aI();try{for await(let d of c.call(a,b,e))yield d}catch(a){throw f=a,await d.#r(a,b,g),a}finally{f||await d.#s(b,g,!0)}}}async #r(a,b,c){await this.#k.error(()=>({level:"error",error:a,query:b,queryDurationMillis:this.#t(c)}))}async #s(a,b,c=!1){await this.#k.query(()=>({level:"query",isStream:c,query:a,queryDurationMillis:this.#t(b)}))}#t(a){return aI()-a}}let aK=()=>{};class aL{#u;#v;constructor(a){this.#u=a}async provideConnection(a){for(;this.#v;)await this.#v.catch(aK);return this.#v=this.#w(a).finally(()=>{this.#v=void 0}),this.#v}async #w(a){return await a(this.#u)}}let aM=["read only","read write"],aN=["read uncommitted","read committed","repeatable read","serializable","snapshot"];function aO(a){if(a.accessMode&&!aM.includes(a.accessMode))throw Error(`invalid transaction access mode ${a.accessMode}`);if(a.isolationLevel&&!aN.includes(a.isolationLevel))throw Error(`invalid transaction isolation level ${a.isolationLevel}`)}var aP=a.i(737327);(0,c.freeze)(["query","error"]);class aQ{#x;#y;constructor(a){(0,c.isFunction)(a)?(this.#y=a,this.#x=(0,c.freeze)({query:!0,error:!0})):(this.#y=aR,this.#x=(0,c.freeze)({query:a.includes("query"),error:a.includes("error")}))}isLevelEnabled(a){return this.#x[a]}async query(a){this.#x.query&&await this.#y(a())}async error(a){this.#x.error&&await this.#y(a())}}function aR(a){if("query"===a.level){let b=`kysely:query:${a.isStream?"stream:":""}`;console.log(`${b} ${a.query.sql}`),console.log(`${b} duration: ${a.queryDurationMillis.toFixed(1)}ms`)}else"error"===a.level&&(a.error instanceof Error?console.error(`kysely:error: ${a.error.stack??a.error.message}`):console.error(`kysely:error: ${JSON.stringify({error:a.error,query:a.query.sql,queryDurationMillis:a.queryDurationMillis})}`))}var aS=a.i(552817),aT=a.i(273664),aU=a.i(885184),aV=a.i(328283);Symbol.asyncDispose??=Symbol("Symbol.asyncDispose");class aW extends aF.QueryCreator{#d;constructor(a){let b,d;if(function(a){return(0,c.isObject)(a)&&(0,c.isObject)(a.config)&&(0,c.isObject)(a.driver)&&(0,c.isObject)(a.executor)&&(0,c.isObject)(a.dialect)}(a))b={executor:a.executor},d={...a};else{const c=a.dialect,e=c.createDriver(),f=c.createQueryCompiler(),g=c.createAdapter(),h=new aJ(e,new aQ(a.log??[])),i=new aH(f,g,new aE(h),a.plugins??[]);b={executor:i},d={config:a,executor:i,dialect:c,driver:h}}super(b),this.#d=(0,c.freeze)(d)}get schema(){return new aA(this.#d.executor)}get dynamic(){return new aD}get introspection(){return this.#d.dialect.createIntrospector(this.withoutPlugins())}case(a){return new aS.CaseBuilder({node:aT.CaseNode.create((0,c.isUndefined)(a)?void 0:(0,ag.parseExpression)(a))})}get fn(){return(0,aP.createFunctionModule)()}transaction(){return new aZ({...this.#d})}startTransaction(){return new a$({...this.#d})}connection(){return new aY({...this.#d})}withPlugin(a){return new aW({...this.#d,executor:this.#d.executor.withPlugin(a)})}withoutPlugins(){return new aW({...this.#d,executor:this.#d.executor.withoutPlugins()})}withSchema(a){return new aW({...this.#d,executor:this.#d.executor.withPluginAtFront(new am.WithSchemaPlugin(a))})}withTables(){return new aW({...this.#d})}async destroy(){await this.#d.driver.destroy()}get isTransaction(){return!1}getExecutor(){return this.#d.executor}executeQuery(a,b){void 0!==b&&(0,aV.logOnce)("Passing `queryId` in `db.executeQuery` is deprecated and will result in a compile-time error in the future.");let d=(0,c.isObject)(a)&&(0,c.isFunction)(a.compile)?a.compile():a;return this.getExecutor().executeQuery(d)}async [Symbol.asyncDispose](){await this.destroy()}}class aX extends aW{#d;constructor(a){super(a),this.#d=a}get isTransaction(){return!0}transaction(){throw Error("calling the transaction method for a Transaction is not supported")}connection(){throw Error("calling the connection method for a Transaction is not supported")}async destroy(){throw Error("calling the destroy method for a Transaction is not supported")}withPlugin(a){return new aX({...this.#d,executor:this.#d.executor.withPlugin(a)})}withoutPlugins(){return new aX({...this.#d,executor:this.#d.executor.withoutPlugins()})}withSchema(a){return new aX({...this.#d,executor:this.#d.executor.withPluginAtFront(new am.WithSchemaPlugin(a))})}withTables(){return new aX({...this.#d})}}class aY{#d;constructor(a){this.#d=(0,c.freeze)(a)}async execute(a){return this.#d.executor.provideConnection(async b=>{let c=this.#d.executor.withConnectionProvider(new aL(b)),d=new aW({...this.#d,executor:c});return await a(d)})}}class aZ{#d;constructor(a){this.#d=(0,c.freeze)(a)}setAccessMode(a){return new aZ({...this.#d,accessMode:a})}setIsolationLevel(a){return new aZ({...this.#d,isolationLevel:a})}async execute(a){let{isolationLevel:b,accessMode:c,...d}=this.#d,e={isolationLevel:b,accessMode:c};return aO(e),this.#d.executor.provideConnection(async b=>{let c=this.#d.executor.withConnectionProvider(new aL(b)),f=new aX({...d,executor:c}),g=!1;try{await this.#d.driver.beginTransaction(b,e),g=!0;let c=await a(f);return await this.#d.driver.commitTransaction(b),c}catch(a){throw g&&await this.#d.driver.rollbackTransaction(b),a}})}}class a${#d;constructor(a){this.#d=(0,c.freeze)(a)}setAccessMode(a){return new a$({...this.#d,accessMode:a})}setIsolationLevel(a){return new a$({...this.#d,isolationLevel:a})}async execute(){let{isolationLevel:a,accessMode:b,...c}=this.#d,d={isolationLevel:a,accessMode:b};aO(d);let e=await (0,aU.provideControlledConnection)(this.#d.executor);return await this.#d.driver.beginTransaction(e.connection,d),new a_({...c,connection:e,executor:this.#d.executor.withConnectionProvider(new aL(e.connection))})}}class a_ extends aX{#d;#z;#A;constructor(a){const b={isCommitted:!1,isRolledBack:!1},{connection:d,...e}=a={...a,executor:new a2(a.executor,b)};super(e),this.#d=(0,c.freeze)(a),this.#A=b;const f=(0,al.createQueryId)();this.#z=b=>a.executor.compileQuery(b,f)}get isCommitted(){return this.#A.isCommitted}get isRolledBack(){return this.#A.isRolledBack}commit(){return a1(this.#A),new a0(async()=>{await this.#d.driver.commitTransaction(this.#d.connection.connection),this.#A.isCommitted=!0,this.#d.connection.release()})}rollback(){return a1(this.#A),new a0(async()=>{await this.#d.driver.rollbackTransaction(this.#d.connection.connection),this.#A.isRolledBack=!0,this.#d.connection.release()})}savepoint(a){return a1(this.#A),new a0(async()=>(await this.#d.driver.savepoint?.(this.#d.connection.connection,a,this.#z),new a_({...this.#d})))}rollbackToSavepoint(a){return a1(this.#A),new a0(async()=>(await this.#d.driver.rollbackToSavepoint?.(this.#d.connection.connection,a,this.#z),new a_({...this.#d})))}releaseSavepoint(a){return a1(this.#A),new a0(async()=>(await this.#d.driver.releaseSavepoint?.(this.#d.connection.connection,a,this.#z),new a_({...this.#d})))}withPlugin(a){return new a_({...this.#d,executor:this.#d.executor.withPlugin(a)})}withoutPlugins(){return new a_({...this.#d,executor:this.#d.executor.withoutPlugins()})}withSchema(a){return new a_({...this.#d,executor:this.#d.executor.withPluginAtFront(new am.WithSchemaPlugin(a))})}withTables(){return new a_({...this.#d})}}class a0{#B;constructor(a){this.#B=a}async execute(){return await this.#B()}}function a1(a){if(a.isCommitted)throw Error("Transaction is already committed");if(a.isRolledBack)throw Error("Transaction is already rolled back")}class a2{#f;#A;constructor(a,b){a instanceof a2?this.#f=a.#f:this.#f=a,this.#A=b}get adapter(){return this.#f.adapter}get plugins(){return this.#f.plugins}transformQuery(a,b){return this.#f.transformQuery(a,b)}compileQuery(a,b){return this.#f.compileQuery(a,b)}provideConnection(a){return this.#f.provideConnection(a)}executeQuery(a){return a1(this.#A),this.#f.executeQuery(a)}stream(a,b){return a1(this.#A),this.#f.stream(a,b)}withConnectionProvider(a){return new a2(this.#f.withConnectionProvider(a),this.#A)}withPlugin(a){return new a2(this.#f.withPlugin(a),this.#A)}withPlugins(a){return new a2(this.#f.withPlugins(a),this.#A)}withPluginAtFront(a){return new a2(this.#f.withPluginAtFront(a),this.#A)}withoutPlugins(){return new a2(this.#f.withoutPlugins(),this.#A)}}var a3=a.i(154132),a4=a.i(919560);class a5{get supportsCreateIfNotExists(){return!0}get supportsTransactionalDdl(){return!1}get supportsReturning(){return!1}get supportsOutput(){return!1}}class a6 extends a5{get supportsCreateIfNotExists(){return!1}get supportsTransactionalDdl(){return!0}get supportsOutput(){return!0}async acquireMigrationLock(a){await a4.sql`exec sp_getapplock @DbPrincipal = ${a4.sql.lit("dbo")}, @Resource = ${a4.sql.lit(a3.DEFAULT_MIGRATION_TABLE)}, @LockMode = ${a4.sql.lit("Exclusive")}`.execute(a)}async releaseMigrationLock(){}}var a7=a.i(204781);function a8(a,b){var d;if(d=a,(0,c.isObject)(d)&&(0,c.isString)(d.stack)&&b.stack){let c=b.stack.split("\n").slice(1).join("\n");a.stack+=`
${c}`}return a}var a9=a.i(452779),ba=a.i(270557);let bb=Symbol(),bc=Symbol(),bd=Symbol();class be{#C;#D;constructor(a){this.#C=(0,c.freeze)({...a});const{tarn:b,tedious:d,validateConnections:e}=this.#C,{validateConnections:f,...g}=b.options;this.#D=new b.Pool({...g,create:async()=>{let a=await d.connectionFactory();return await new bf(a,d).connect()},destroy:async a=>{await a[bc]()},validate:!1===e||!1===f?void 0:a=>a[bd]()})}async init(){}async acquireConnection(){return await this.#D.acquire().promise}async beginTransaction(a,b){await a.beginTransaction(b)}async commitTransaction(a){await a.commitTransaction()}async rollbackTransaction(a){await a.rollbackTransaction()}async savepoint(a,b){await a.savepoint(b)}async rollbackToSavepoint(a,b){await a.rollbackTransaction(b)}async releaseConnection(a){(this.#C.resetConnectionsOnRelease||this.#C.tedious.resetConnectionOnRelease)&&await a[bb](),this.#D.release(a)}async destroy(){await this.#D.destroy()}}class bf{#u;#E;#F;constructor(a,b){this.#u=a,this.#E=!1,this.#F=b}async beginTransaction(a){let{isolationLevel:b}=a;await new Promise((a,c)=>this.#u.beginTransaction(b=>{b?c(b):a(void 0)},b?(0,a9.randomString)(8):void 0,b?this.#G(b):void 0))}async commitTransaction(){await new Promise((a,b)=>this.#u.commitTransaction(c=>{c?b(c):a(void 0)}))}async connect(){let{promise:a,reject:b,resolve:c}=new ba.Deferred;function d(){b(Error("The connection ended without ever completing the connection"))}return this.#u.connect(a=>{if(a)return b(a);c()}),this.#u.on("error",a=>{a instanceof Error&&"code"in a&&"ESOCKET"===a.code&&(this.#E=!0),console.error(a),b(a)}),this.#u.once("end",d),await a,this.#u.off("end",d),this}async executeQuery(a){try{let b=new ba.Deferred,c=new bg({compiledQuery:a,tedious:this.#F,onDone:b});this.#u.execSql(c.request);let{rowCount:d,rows:e}=await b.promise;return{numAffectedRows:void 0!==d?BigInt(d):void 0,rows:e}}catch(a){throw a8(a,Error())}}async rollbackTransaction(a){await new Promise((b,c)=>this.#u.rollbackTransaction(a=>{a?c(a):b(void 0)},a))}async savepoint(a){await new Promise((b,c)=>this.#u.saveTransaction(a=>{a?c(a):b(void 0)},a))}async *streamQuery(a,b){if(!Number.isInteger(b)||b<=0)throw Error("chunkSize must be a positive integer");let c=new bg({compiledQuery:a,streamChunkSize:b,tedious:this.#F});this.#u.execSql(c.request);try{for(;;){let a=await c.readChunk();if(0===a.length||(yield{rows:a},a.length<b))break}}finally{await this.#H(c)}}#G(a){let{ISOLATION_LEVEL:b}=this.#F,c={"read committed":b.READ_COMMITTED,"read uncommitted":b.READ_UNCOMMITTED,"repeatable read":b.REPEATABLE_READ,serializable:b.SERIALIZABLE,snapshot:b.SNAPSHOT}[a];if(void 0===c)throw Error(`Unknown isolation level: ${a}`);return c}#H(a){return new Promise(b=>{a.request.once("requestCompleted",b),this.#u.cancel()||(a.request.off("requestCompleted",b),b())})}[bc](){return"closed"in this.#u&&this.#u.closed?Promise.resolve():new Promise(a=>{this.#u.once("end",a),this.#u.close()})}async [bb](){await new Promise((a,b)=>{this.#u.reset(c=>{if(c)return b(c);a()})})}async [bd](){if(this.#E||this.#I())return!1;try{let a=new ba.Deferred,b=new bg({compiledQuery:a7.CompiledQuery.raw("select 1"),onDone:a,tedious:this.#F});return this.#u.execSql(b.request),await a.promise,!0}catch{return!1}}#I(){return"closed"in this.#u&&!!this.#u.closed}}class bg{#J;#K;#L;#M;#F;#N;constructor(a){const{compiledQuery:b,onDone:c,streamChunkSize:d,tedious:e}=a;if(this.#K=[],this.#L=d,this.#M={},this.#F=e,c){const a="onDone";this.#M[a]=(b,d)=>{if("chunkReady"!==b){if(delete this.#M[a],"error"===b)return c.reject(d);c.resolve({rowCount:this.#N,rows:this.#K})}}}this.#J=new this.#F.Request(b.sql,(a,b)=>{if(a)return Object.values(this.#M).forEach(b=>b("error",a instanceof AggregateError?a.errors:a));this.#N=b}),this.#O(b.parameters),this.#P()}get request(){return this.#J}readChunk(){let a=this.readChunk.name;return new Promise((b,c)=>{this.#M[a]=(d,e)=>{if(delete this.#M[a],"error"===d)return c(e);b(this.#K.splice(0,this.#L))},this.#J.resume()})}#O(a){for(let b=0;b<a.length;b++){let c=a[b];this.#J.addParameter(String(b+1),this.#Q(c),c)}}#P(){let a=this.#L?()=>{this.#L<=this.#K.length&&(this.#J.pause(),Object.values(this.#M).forEach(a=>a("chunkReady")))}:()=>{},b=b=>{let c={};for(let a of b)c[a.metadata.colName]=a.value;this.#K.push(c),a()};this.#J.on("row",b),this.#J.once("requestCompleted",()=>{Object.values(this.#M).forEach(a=>a("completed")),this.#J.off("row",b)})}#Q(a){if((0,c.isNull)(a)||(0,c.isUndefined)(a)||(0,c.isString)(a))return this.#F.TYPES.NVarChar;if((0,c.isBigInt)(a)||(0,c.isNumber)(a)&&a%1==0)if(a<-0x80000000||a>0x7fffffff)return this.#F.TYPES.BigInt;else return this.#F.TYPES.Int;return(0,c.isNumber)(a)?this.#F.TYPES.Float:(0,c.isBoolean)(a)?this.#F.TYPES.Bit:(0,c.isDate)(a)?this.#F.TYPES.DateTime:(0,c.isBuffer)(a)?this.#F.TYPES.VarBinary:this.#F.TYPES.NVarChar}}class bh{#R;constructor(a){this.#R=a}async getSchemas(){return await this.#R.selectFrom("sys.schemas").select("name").execute()}async getTables(a={withInternalKyselyTables:!1}){let b=await this.#R.selectFrom("sys.tables as tables").leftJoin("sys.schemas as table_schemas","table_schemas.schema_id","tables.schema_id").innerJoin("sys.columns as columns","columns.object_id","tables.object_id").innerJoin("sys.types as types","types.user_type_id","columns.user_type_id").leftJoin("sys.schemas as type_schemas","type_schemas.schema_id","types.schema_id").leftJoin("sys.extended_properties as comments",a=>a.onRef("comments.major_id","=","tables.object_id").onRef("comments.minor_id","=","columns.column_id").on("comments.name","=","MS_Description")).$if(!a.withInternalKyselyTables,a=>a.where("tables.name","!=",a3.DEFAULT_MIGRATION_TABLE).where("tables.name","!=",a3.DEFAULT_MIGRATION_LOCK_TABLE)).select(["tables.name as table_name",a=>a.ref("tables.type").$castTo().as("table_type"),"table_schemas.name as table_schema_name","columns.default_object_id as column_default_object_id","columns.generated_always_type_desc as column_generated_always_type","columns.is_computed as column_is_computed","columns.is_identity as column_is_identity","columns.is_nullable as column_is_nullable","columns.is_rowguidcol as column_is_rowguidcol","columns.name as column_name","types.is_nullable as type_is_nullable","types.name as type_name","type_schemas.name as type_schema_name","comments.value as column_comment"]).unionAll(this.#R.selectFrom("sys.views as views").leftJoin("sys.schemas as view_schemas","view_schemas.schema_id","views.schema_id").innerJoin("sys.columns as columns","columns.object_id","views.object_id").innerJoin("sys.types as types","types.user_type_id","columns.user_type_id").leftJoin("sys.schemas as type_schemas","type_schemas.schema_id","types.schema_id").leftJoin("sys.extended_properties as comments",a=>a.onRef("comments.major_id","=","views.object_id").onRef("comments.minor_id","=","columns.column_id").on("comments.name","=","MS_Description")).select(["views.name as table_name","views.type as table_type","view_schemas.name as table_schema_name","columns.default_object_id as column_default_object_id","columns.generated_always_type_desc as column_generated_always_type","columns.is_computed as column_is_computed","columns.is_identity as column_is_identity","columns.is_nullable as column_is_nullable","columns.is_rowguidcol as column_is_rowguidcol","columns.name as column_name","types.is_nullable as type_is_nullable","types.name as type_name","type_schemas.name as type_schema_name","comments.value as column_comment"])).orderBy("table_schema_name").orderBy("table_name").orderBy("column_name").execute(),d={};for(let a of b){let b=`${a.table_schema_name}.${a.table_name}`;(d[b]=d[b]||(0,c.freeze)({columns:[],isView:"V "===a.table_type,name:a.table_name,schema:a.table_schema_name??void 0})).columns.push((0,c.freeze)({dataType:a.type_name,dataTypeSchema:a.type_schema_name??void 0,hasDefaultValue:a.column_default_object_id>0||"NOT_APPLICABLE"!==a.column_generated_always_type||a.column_is_identity||a.column_is_computed||a.column_is_rowguidcol,isAutoIncrementing:a.column_is_identity,isNullable:a.column_is_nullable&&a.type_is_nullable,name:a.column_name,comment:a.column_comment??void 0}))}return Object.values(d)}async getMetadata(a){return{tables:await this.getTables(a)}}}var bi=a.i(776452);let bj=/^[a-z0-9_]$/i;class bk extends bi.DefaultQueryCompiler{getCurrentParameterPlaceholder(){return`@${this.numParameters}`}visitOffset(a){super.visitOffset(a),this.append(" rows")}compileColumnAlterations(a){let b={};for(let c of a)b[c.kind]||(b[c.kind]=[]),b[c.kind].push(c);let c=!0;b.AddColumnNode&&(this.append("add "),this.compileList(b.AddColumnNode),c=!1),b.AlterColumnNode&&(c||this.append(", "),this.compileList(b.AlterColumnNode)),b.DropColumnNode&&(c||this.append(", "),this.append("drop column "),this.compileList(b.DropColumnNode)),b.ModifyColumnNode&&(c||this.append(", "),this.compileList(b.ModifyColumnNode)),b.RenameColumnNode&&(c||this.append(", "),this.compileList(b.RenameColumnNode))}visitAddColumn(a){this.visitNode(a.column)}visitDropColumn(a){this.visitNode(a.column)}visitMergeQuery(a){super.visitMergeQuery(a),this.append(";")}visitCollate(a){this.append("collate ");let{name:b}=a.collation;for(let a of b)if(!bj.test(a))throw Error(`Invalid collation: ${b}`);this.append(b)}announcesNewColumnDataType(){return!1}}class bl{#C;constructor(a){this.#C=a}createDriver(){return new be(this.#C)}createQueryCompiler(){return new bk}createAdapter(){return new a6}createIntrospector(a){return new bh(a)}}function bm(a,b){return T.RawNode.createWithChildren([T.RawNode.createWithSql(`${a} `),e.IdentifierNode.create(b)])}let bn=Symbol();class bo{#C;#o=new WeakMap;#D;constructor(a){this.#C=(0,c.freeze)({...a})}async init(){this.#D=(0,c.isFunction)(this.#C.pool)?await this.#C.pool():this.#C.pool}async acquireConnection(){let a=await this.#S(),b=this.#o.get(a);return!b&&(b=new bp(a),this.#o.set(a,b),this.#C?.onCreateConnection&&await this.#C.onCreateConnection(b)),this.#C?.onReserveConnection&&await this.#C.onReserveConnection(b),b}async #S(){return new Promise((a,b)=>{this.#D.getConnection(async(c,d)=>{c?b(c):a(d)})})}async beginTransaction(a,b){if(b.isolationLevel||b.accessMode){let c=[];b.isolationLevel&&c.push(`isolation level ${b.isolationLevel}`),b.accessMode&&c.push(b.accessMode);let d=`set transaction ${c.join(", ")}`;await a.executeQuery(a7.CompiledQuery.raw(d))}await a.executeQuery(a7.CompiledQuery.raw("begin"))}async commitTransaction(a){await a.executeQuery(a7.CompiledQuery.raw("commit"))}async rollbackTransaction(a){await a.executeQuery(a7.CompiledQuery.raw("rollback"))}async savepoint(a,b,c){await a.executeQuery(c(bm("savepoint",b),(0,al.createQueryId)()))}async rollbackToSavepoint(a,b,c){await a.executeQuery(c(bm("rollback to",b),(0,al.createQueryId)()))}async releaseSavepoint(a,b,c){await a.executeQuery(c(bm("release savepoint",b),(0,al.createQueryId)()))}async releaseConnection(a){a[bn]()}async destroy(){return new Promise((a,b)=>{this.#D.end(c=>{c?b(c):a()})})}}class bp{#T;constructor(a){this.#T=a}async executeQuery(a){try{let b=await this.#U(a);if((0,c.isObject)(b)&&"insertId"in b&&"affectedRows"in b){let{insertId:a,affectedRows:c,changedRows:d}=b;return{insertId:null!=a&&"0"!==a.toString()?BigInt(a):void 0,numAffectedRows:null!=c?BigInt(c):void 0,numChangedRows:null!=d?BigInt(d):void 0,rows:[]}}if(Array.isArray(b))return{rows:b};return{rows:[]}}catch(a){throw a8(a,Error())}}#U(a){return new Promise((b,c)=>{this.#T.query(a.sql,a.parameters,(a,d)=>{a?c(a):b(d)})})}async *streamQuery(a,b){let c=this.#T.query(a.sql,a.parameters).stream({objectMode:!0});try{for await(let a of c)yield{rows:[a]}}catch(a){if(a&&"object"==typeof a&&"code"in a&&"ERR_STREAM_PREMATURE_CLOSE"===a.code)return;throw a}}[bn](){this.#T.release()}}var bq=bi;let br=/`/g;class bs extends bq.DefaultQueryCompiler{getCurrentParameterPlaceholder(){return"?"}getLeftExplainOptionsWrapper(){return""}getExplainOptionAssignment(){return"="}getExplainOptionsDelimiter(){return" "}getRightExplainOptionsWrapper(){return""}getLeftIdentifierWrapper(){return"`"}getRightIdentifierWrapper(){return"`"}sanitizeIdentifier(a){return a.replace(br,"``")}visitCreateIndex(a){this.append("create "),a.unique&&this.append("unique "),this.append("index "),a.ifNotExists&&this.append("if not exists "),this.visitNode(a.name),a.using&&(this.append(" using "),this.visitNode(a.using)),a.table&&(this.append(" on "),this.visitNode(a.table)),a.columns&&(this.append(" ("),this.compileList(a.columns),this.append(")")),a.where&&(this.append(" "),this.visitNode(a.where))}}class bt{#R;constructor(a){this.#R=a}async getSchemas(){return(await this.#R.selectFrom("information_schema.schemata").select("schema_name").$castTo().execute()).map(a=>({name:a.SCHEMA_NAME}))}async getTables(a={withInternalKyselyTables:!1}){let b=this.#R.selectFrom("information_schema.columns as columns").innerJoin("information_schema.tables as tables",a=>a.onRef("columns.TABLE_CATALOG","=","tables.TABLE_CATALOG").onRef("columns.TABLE_SCHEMA","=","tables.TABLE_SCHEMA").onRef("columns.TABLE_NAME","=","tables.TABLE_NAME")).select(["columns.COLUMN_NAME","columns.COLUMN_DEFAULT","columns.TABLE_NAME","columns.TABLE_SCHEMA","tables.TABLE_TYPE","columns.IS_NULLABLE","columns.DATA_TYPE","columns.EXTRA","columns.COLUMN_COMMENT"]).where("columns.TABLE_SCHEMA","=",a4.sql`database()`).orderBy("columns.TABLE_NAME").orderBy("columns.ORDINAL_POSITION").$castTo();a.withInternalKyselyTables||(b=b.where("columns.TABLE_NAME","!=",a3.DEFAULT_MIGRATION_TABLE).where("columns.TABLE_NAME","!=",a3.DEFAULT_MIGRATION_LOCK_TABLE));let c=await b.execute();return this.#V(c)}async getMetadata(a){return{tables:await this.getTables(a)}}#V(a){return a.reduce((a,b)=>{let d=a.find(a=>a.name===b.TABLE_NAME);return d||(d=(0,c.freeze)({name:b.TABLE_NAME,isView:"VIEW"===b.TABLE_TYPE,schema:b.TABLE_SCHEMA,columns:[]}),a.push(d)),d.columns.push((0,c.freeze)({name:b.COLUMN_NAME,dataType:b.DATA_TYPE,isNullable:"YES"===b.IS_NULLABLE,isAutoIncrementing:b.EXTRA.toLowerCase().includes("auto_increment"),hasDefaultValue:null!==b.COLUMN_DEFAULT,comment:""===b.COLUMN_COMMENT?void 0:b.COLUMN_COMMENT})),a},[])}}let bu="ea586330-2c93-47c8-908d-981d9d270f9d";class bv extends a5{get supportsTransactionalDdl(){return!1}get supportsReturning(){return!1}async acquireMigrationLock(a,b){await a4.sql`select get_lock(${a4.sql.lit(bu)}, ${a4.sql.lit(3600)})`.execute(a)}async releaseMigrationLock(a,b){await a4.sql`select release_lock(${a4.sql.lit(bu)})`.execute(a)}}class bw{#C;constructor(a){this.#C=a}createDriver(){return new bo(this.#C)}createQueryCompiler(){return new bs}createAdapter(){return new bv}createIntrospector(a){return new bt(a)}}let bx=Symbol();class by{#C;#o=new WeakMap;#D;constructor(a){this.#C=(0,c.freeze)({...a})}async init(){this.#D=(0,c.isFunction)(this.#C.pool)?await this.#C.pool():this.#C.pool}async acquireConnection(){let a=await this.#D.connect(),b=this.#o.get(a);return!b&&(b=new bz(a,{cursor:this.#C.cursor??null}),this.#o.set(a,b),this.#C.onCreateConnection&&await this.#C.onCreateConnection(b)),this.#C.onReserveConnection&&await this.#C.onReserveConnection(b),b}async beginTransaction(a,b){if(b.isolationLevel||b.accessMode){let c="start transaction";b.isolationLevel&&(c+=` isolation level ${b.isolationLevel}`),b.accessMode&&(c+=` ${b.accessMode}`),await a.executeQuery(a7.CompiledQuery.raw(c))}else await a.executeQuery(a7.CompiledQuery.raw("begin"))}async commitTransaction(a){await a.executeQuery(a7.CompiledQuery.raw("commit"))}async rollbackTransaction(a){await a.executeQuery(a7.CompiledQuery.raw("rollback"))}async savepoint(a,b,c){await a.executeQuery(c(bm("savepoint",b),(0,al.createQueryId)()))}async rollbackToSavepoint(a,b,c){await a.executeQuery(c(bm("rollback to",b),(0,al.createQueryId)()))}async releaseSavepoint(a,b,c){await a.executeQuery(c(bm("release",b),(0,al.createQueryId)()))}async releaseConnection(a){a[bx]()}async destroy(){if(this.#D){let a=this.#D;this.#D=void 0,await a.end()}}}class bz{#W;#X;constructor(a,b){this.#W=a,this.#X=b}async executeQuery(a){try{let{command:b,rowCount:c,rows:d}=await this.#W.query(a.sql,[...a.parameters]);return{numAffectedRows:"INSERT"===b||"UPDATE"===b||"DELETE"===b||"MERGE"===b?BigInt(c):void 0,rows:d??[]}}catch(a){throw a8(a,Error())}}async *streamQuery(a,b){if(!this.#X.cursor)throw Error("'cursor' is not present in your postgres dialect config. It's required to make streaming work in postgres.");if(!Number.isInteger(b)||b<=0)throw Error("chunkSize must be a positive integer");let c=this.#W.query(new this.#X.cursor(a.sql,a.parameters.slice()));try{for(;;){let a=await c.read(b);if(0===a.length)break;yield{rows:a}}}finally{await c.close()}}[bx](){this.#W.release()}}class bA{#R;constructor(a){this.#R=a}async getSchemas(){return(await this.#R.selectFrom("pg_catalog.pg_namespace").select("nspname").$castTo().execute()).map(a=>({name:a.nspname}))}async getTables(a={withInternalKyselyTables:!1}){let b=this.#R.selectFrom("pg_catalog.pg_attribute as a").innerJoin("pg_catalog.pg_class as c","a.attrelid","c.oid").innerJoin("pg_catalog.pg_namespace as ns","c.relnamespace","ns.oid").innerJoin("pg_catalog.pg_type as typ","a.atttypid","typ.oid").innerJoin("pg_catalog.pg_namespace as dtns","typ.typnamespace","dtns.oid").select(["a.attname as column","a.attnotnull as not_null","a.atthasdef as has_default","c.relname as table","c.relkind as table_type","ns.nspname as schema","typ.typname as type","dtns.nspname as type_schema",a4.sql`col_description(a.attrelid, a.attnum)`.as("column_description"),a4.sql`pg_get_serial_sequence(quote_ident(ns.nspname) || '.' || quote_ident(c.relname), a.attname)`.as("auto_incrementing")]).where("c.relkind","in",["r","v","p"]).where("ns.nspname","!~","^pg_").where("ns.nspname","!=","information_schema").where("ns.nspname","!=","crdb_internal").where(a4.sql`has_schema_privilege(ns.nspname, 'USAGE')`).where("a.attnum",">=",0).where("a.attisdropped","!=",!0).orderBy("ns.nspname").orderBy("c.relname").orderBy("a.attnum").$castTo();a.withInternalKyselyTables||(b=b.where("c.relname","!=",a3.DEFAULT_MIGRATION_TABLE).where("c.relname","!=",a3.DEFAULT_MIGRATION_LOCK_TABLE));let c=await b.execute();return this.#V(c)}async getMetadata(a){return{tables:await this.getTables(a)}}#V(a){return a.reduce((a,b)=>{let d=a.find(a=>a.name===b.table&&a.schema===b.schema);return d||(d=(0,c.freeze)({name:b.table,isView:"v"===b.table_type,schema:b.schema,columns:[]}),a.push(d)),d.columns.push((0,c.freeze)({name:b.column,dataType:b.type,dataTypeSchema:b.type_schema,isNullable:!b.not_null,isAutoIncrementing:null!==b.auto_incrementing,hasDefaultValue:b.has_default,comment:b.column_description??void 0})),a},[])}}var bB=bi;let bC=/"/g;class bD extends bB.DefaultQueryCompiler{sanitizeIdentifier(a){return a.replace(bC,'""')}}let bE=BigInt("3853314791062309107");class bF extends a5{get supportsTransactionalDdl(){return!0}get supportsReturning(){return!0}async acquireMigrationLock(a,b){await a4.sql`select pg_advisory_xact_lock(${a4.sql.lit(bE)})`.execute(a)}async releaseMigrationLock(a,b){}}class bG{#C;constructor(a){this.#C=a}createDriver(){return new by(this.#C)}createQueryCompiler(){return new bD}createAdapter(){return new bF}createIntrospector(a){return new bA(a)}}var bH=a.i(541595);class bI{#C;#Y=new bK;#R;#u;constructor(a){this.#C=(0,c.freeze)({...a})}async init(){this.#R=(0,c.isFunction)(this.#C.database)?await this.#C.database():this.#C.database,this.#u=new bJ(this.#R),this.#C.onCreateConnection&&await this.#C.onCreateConnection(this.#u)}async acquireConnection(){return await this.#Y.lock(),this.#u}async beginTransaction(a){await a.executeQuery(a7.CompiledQuery.raw("begin"))}async commitTransaction(a){await a.executeQuery(a7.CompiledQuery.raw("commit"))}async rollbackTransaction(a){await a.executeQuery(a7.CompiledQuery.raw("rollback"))}async savepoint(a,b,c){await a.executeQuery(c(bm("savepoint",b),(0,al.createQueryId)()))}async rollbackToSavepoint(a,b,c){await a.executeQuery(c(bm("rollback to",b),(0,al.createQueryId)()))}async releaseSavepoint(a,b,c){await a.executeQuery(c(bm("release",b),(0,al.createQueryId)()))}async releaseConnection(){this.#Y.unlock()}async destroy(){this.#R?.close()}}class bJ{#R;constructor(a){this.#R=a}executeQuery(a){let{sql:b,parameters:c}=a,d=this.#R.prepare(b);if(d.reader)return Promise.resolve({rows:d.all(c)});let{changes:e,lastInsertRowid:f}=d.run(c);return Promise.resolve({numAffectedRows:null!=e?BigInt(e):void 0,insertId:null!=f?BigInt(f):void 0,rows:[]})}async *streamQuery(a,b){let{sql:c,parameters:d,query:e}=a,f=this.#R.prepare(c);if(bH.SelectQueryNode.is(e))for(let a of f.iterate(d))yield{rows:[a]};else throw Error("Sqlite driver only supports streaming of select queries")}}class bK{#Z;#$;async lock(){for(;this.#Z;)await this.#Z;this.#Z=new Promise(a=>{this.#$=a})}unlock(){let a=this.#$;this.#Z=void 0,this.#$=void 0,a?.()}}var bL=bi;let bM=/"/g;class bN extends bL.DefaultQueryCompiler{visitOrAction(a){this.append("or "),this.append(a.action)}getCurrentParameterPlaceholder(){return"?"}getLeftExplainOptionsWrapper(){return""}getRightExplainOptionsWrapper(){return""}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getAutoIncrement(){return"autoincrement"}sanitizeIdentifier(a){return a.replace(bM,'""')}visitDefaultInsertValue(a){this.append("null")}}class bO{#R;constructor(a){this.#R=a}async getSchemas(){return[]}async getTables(a={withInternalKyselyTables:!1}){return await this.#_(a)}async getMetadata(a){return{tables:await this.getTables(a)}}#aa(a,b){let c=a.selectFrom("sqlite_master").where("type","in",["table","view"]).where("name","not like","sqlite_%").select(["name","sql","type"]).orderBy("name");return b.withInternalKyselyTables||(c=c.where("name","!=",a3.DEFAULT_MIGRATION_TABLE).where("name","!=",a3.DEFAULT_MIGRATION_LOCK_TABLE)),c}async #_(a){let b=await this.#aa(this.#R,a).execute(),c=await this.#R.with("table_list",b=>this.#aa(b,a)).selectFrom(["table_list as tl",a4.sql`pragma_table_info(tl.name)`.as("p")]).select(["tl.name as table","p.cid","p.name","p.type","p.notnull","p.dflt_value","p.pk"]).orderBy("tl.name").orderBy("p.cid").execute(),d={};for(let a of c)d[a.table]??=[],d[a.table].push(a);return b.map(({name:a,sql:b,type:c})=>{let e=b?.split(/[\(\),]/)?.find(a=>a.toLowerCase().includes("autoincrement"))?.trimStart()?.split(/\s+/)?.[0]?.replace(/["`]/g,""),f=d[a]??[];if(!e){let a=f.filter(a=>a.pk>0);1===a.length&&"integer"===a[0].type.toLowerCase()&&(e=a[0].name)}return{name:a,isView:"view"===c,columns:f.map(a=>({name:a.name,dataType:a.type,isNullable:!a.notnull,isAutoIncrementing:a.name===e,hasDefaultValue:null!=a.dflt_value,comment:void 0}))}})}}class bP extends a5{get supportsTransactionalDdl(){return!1}get supportsReturning(){return!0}async acquireMigrationLock(a,b){}async releaseMigrationLock(a,b){}}class bQ{#C;constructor(a){this.#C=(0,c.freeze)({...a})}createDriver(){return new bI(this.#C)}createQueryCompiler(){return new bN}createAdapter(){return new bP}createIntrospector(a){return new bO(a)}}function bR(a){if(!a)return null;if("dialect"in a)return bR(a.dialect);if("createDriver"in a){if(a instanceof bQ)return"sqlite";if(a instanceof bw)return"mysql";if(a instanceof bG)return"postgres";if(a instanceof bl)return"mssql"}return"aggregate"in a?"sqlite":"getConnection"in a?"mysql":"connect"in a?"postgres":"fileControl"in a||"open"in a&&"close"in a&&"prepare"in a?"sqlite":null}let bS=async c=>{let d,e=c.database;if(!e)return{kysely:null,databaseType:null,transaction:void 0};if("db"in e)return{kysely:e.db,databaseType:e.type,transaction:e.transaction};if("dialect"in e)return{kysely:new aW({dialect:e.dialect}),databaseType:e.type,transaction:e.transaction};let f=bR(e);if("createDriver"in e&&(d=e),"aggregate"in e&&!("createSession"in e)&&(d=new bQ({database:e})),"getConnection"in e&&(d=new bw(e)),"connect"in e&&(d=new bG({pool:e})),"fileControl"in e){let{BunSqliteDialect:c}=await (0,b.trackDynamicImport)(a.A(946014));d=new c({database:e})}if("createSession"in e){let c;try{({DatabaseSync:c}=await (0,b.trackDynamicImport)(import("node:sqlite")))}catch(a){if(null!==a&&"object"==typeof a&&"code"in a&&"ERR_UNKNOWN_BUILTIN_MODULE"!==a.code)throw a}if(c&&e instanceof c){let{NodeSqliteDialect:c}=await (0,b.trackDynamicImport)(a.A(945599));d=new c({database:e})}}return{kysely:d?new aW({dialect:d}):null,databaseType:f,transaction:void 0}};a.s(["createKyselyAdapter",()=>bS,"getKyselyDatabaseType",()=>bR],297251)}];

//# sourceMappingURL=node_modules_8af8aa3a._.js.map