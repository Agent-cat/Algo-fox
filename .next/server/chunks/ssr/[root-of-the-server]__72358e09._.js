module.exports=[463021,(a,b,c)=>{b.exports=a.x("@prisma/client-2c3a283f134fdcb6",()=>require("@prisma/client-2c3a283f134fdcb6"))},434270,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/module-loading/track-module-loading.external.js",()=>require("next/dist/server/app-render/module-loading/track-module-loading.external.js"))},118129,944309,a=>{"use strict";var b=a.i(123651);a.s([],118129),a.s(["logger",()=>b.i],944309)},231191,a=>{"use strict";var b=a.i(463021);let c=globalThis.prisma_fox??new b.PrismaClient({log:["error"]}).$extends({query:{$allModels:{async $allOperations({operation:a,model:b,args:c,query:d}){let e=performance.now(),f=await d(c),g=performance.now();return g-e>1e3&&console.warn(`Slow query: ${b}.${a} took ${(g-e).toFixed(2)}ms`),f}}}});a.s(["prisma",()=>c])},137936,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"registerServerReference",{enumerable:!0,get:function(){return d.registerServerReference}});let d=a.r(211857)},713095,(a,b,c)=>{"use strict";function d(a){for(let b=0;b<a.length;b++){let c=a[b];if("function"!=typeof c)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof c}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"ensureServerEntryExports",{enumerable:!0,get:function(){return d}})},191679,a=>{"use strict";var b=a.i(137936),c=a.i(409223),d=a.i(231191),e=a.i(905246);async function f(){let a=await c.auth.api.getSession({headers:await (0,e.headers)()});if(!a)return{conflict:!1};let b=(await d.prisma.session.findMany({where:{userId:a.user.id},select:{id:!0,expiresAt:!0,userAgent:!0,ipAddress:!0,token:!0}})).filter(a=>a.expiresAt>new Date);return b.length>1?{conflict:!0,currentSessionToken:a.session.token,sessions:b.map(b=>({...b,isCurrent:b.token===a.session.token}))}:{conflict:!1}}async function g(a){let b=await c.auth.api.getSession({headers:await (0,e.headers)()});if(!b)throw Error("No active session");return"LOGOUT_OTHERS"===a?(await d.prisma.session.deleteMany({where:{userId:b.user.id,token:{not:b.session.token}}}),{success:!0,message:"Other sessions terminated"}):"LOGOUT_CURRENT"===a?(await d.prisma.session.delete({where:{token:b.session.token}}),{success:!0,message:"Current session terminated"}):void 0}(0,a.i(713095).ensureServerEntryExports)([f,g]),(0,b.registerServerReference)(f,"00f4c838ce10f91796a39f1558a3b75432fa49882a",null),(0,b.registerServerReference)(g,"409bc5870257fe05de038549e85b0722c4e09c83d4",null),a.s(["checkSessionConflict",()=>f,"resolveSessionConflict",()=>g])},53112,a=>{"use strict";var b=a.i(954757);a.s(["z",0,b])},257728,a=>{"use strict";var b=a.i(137936),c=a.i(53112),d=a.i(409223),e=a.i(905246),f=a.i(231191),g=a.i(118558),h=a.i(713095);let i=c.z.object({institutionId:c.z.string(),role:c.z.enum(["TEACHER","CONTEST_MANAGER","STUDENT"]),maxUses:c.z.number().int().positive().optional(),expiresAt:c.z.string().optional().transform(a=>a?new Date(a):void 0)});async function j(a){try{let b=await d.auth.api.getSession({headers:await (0,e.headers)()});if(!b?.user)return{success:!1,error:"Unauthorized"};let c=b.user;if("ADMIN"!==c.role&&("INSTITUTION_MANAGER"!==c.role||c.institutionId!==a.institutionId))return{success:!1,error:"Unauthorized"};let{institutionId:h,role:j,maxUses:k,expiresAt:l}=i.parse(a),m="",n=!1;for(;!n;)m=Math.random().toString(36).substring(2,8).toUpperCase(),await f.prisma.institutionInvite.findUnique({where:{code:m}})||(n=!0);let o=await f.prisma.institutionInvite.create({data:{code:m,institutionId:h,role:j,maxUses:k,expiresAt:l}});return(0,g.revalidateTag)(`institution-invites-${h}`,"max"),(0,g.revalidatePath)("/dashboard/institution/invites"),{success:!0,invite:o}}catch(a){return console.error("Create invite error:",a),{success:!1,error:"Failed to create invite"}}}async function k(a){try{let b=await d.auth.api.getSession({headers:await (0,e.headers)()});if(!b?.user)return{success:!1,error:"Unauthorized"};let c=await f.prisma.institutionInvite.findUnique({where:{id:a}});if(!c)return{success:!1,error:"Invite not found"};let h=b.user;if("ADMIN"!==h.role&&("INSTITUTION_MANAGER"!==h.role||h.institutionId!==c.institutionId))return{success:!1,error:"Unauthorized"};return await f.prisma.institutionInvite.update({where:{id:a},data:{isActive:!c.isActive}}),(0,g.revalidateTag)(`institution-invites-${c.institutionId}`,"max"),(0,g.revalidatePath)("/dashboard/institution/invites"),{success:!0}}catch(a){return console.error("Toggle invite error:",a),{success:!1,error:"Failed to toggle invite"}}}async function l(a){try{let b=await d.auth.api.getSession({headers:await (0,e.headers)()});if(!b?.user)return{success:!1,error:"Unauthorized"};let c=await f.prisma.institutionInvite.findUnique({where:{id:a}});if(!c)return{success:!1,error:"Invite not found"};let h=b.user;if("ADMIN"!==h.role&&("INSTITUTION_MANAGER"!==h.role||h.institutionId!==c.institutionId))return{success:!1,error:"Unauthorized"};let i=c.institutionId;return await f.prisma.institutionInvite.delete({where:{id:a}}),(0,g.revalidateTag)(`institution-invites-${i}`,"max"),(0,g.revalidatePath)("/dashboard/institution/invites"),{success:!0}}catch(a){return console.error("Delete invite error:",a),{success:!1,error:"Failed to delete invite"}}}async function m(a){try{let b=await d.auth.api.getSession({headers:await (0,e.headers)()});if(!b?.user)return{success:!1,error:"Unauthorized"};let c=b.user;if("ADMIN"!==c.role&&("INSTITUTION_MANAGER"!==c.role||c.institutionId!==a))return{success:!1,error:"Unauthorized"};let h=(0,g.unstable_cache)(async()=>await f.prisma.institutionInvite.findMany({where:{institutionId:a},orderBy:{createdAt:"desc"}}),[`institution-invites-${a}`],{tags:[`institution-invites-${a}`],revalidate:120}),i=await h();return{success:!0,invites:i}}catch(a){return console.error("Get invites error:",a),{success:!1,error:"Failed to get invites"}}}async function n(a){try{let b=(0,g.unstable_cache)(async()=>await f.prisma.institutionInvite.findUnique({where:{code:a},include:{institution:{select:{name:!0,logo:!0,id:!0}}}}),[`invite-${a}`],{revalidate:300}),c=await b();if(!c)return{success:!1,error:"Invite not found"};if(!c.isActive)return{success:!1,error:"Invite is deactivated"};if(c.expiresAt&&new Date>c.expiresAt)return{success:!1,error:"Invite expired"};if(c.maxUses&&c.uses>=c.maxUses)return{success:!1,error:"Invite limit reached"};return{success:!0,invite:{role:c.role,institutionName:c.institution.name,institutionLogo:c.institution.logo,institutionId:c.institution.id,code:c.code}}}catch(a){return console.error("Get invite details error:",a),{success:!1,error:"Invalid invite"}}}async function o(a){try{let b=await d.auth.api.getSession({headers:await (0,e.headers)()});if(!b?.user)return{success:!1,error:"Unauthorized"};let c=b.user,{invite:h,onboardingCompleted:i}=await f.prisma.$transaction(async b=>{let d=await b.institutionInvite.findUnique({where:{code:a},include:{institution:!0}});if(!d)throw Error("Invite not found");if(!d.isActive)throw Error("Invite is deactivated");if(d.expiresAt&&new Date>d.expiresAt)throw Error("Invite expired");if(d.maxUses&&d.uses>=d.maxUses)throw Error("Invite usage limit reached");await b.user.update({where:{id:c.id},data:{institutionId:d.institutionId,role:d.role}}),await b.institutionInvite.update({where:{id:d.id},data:{uses:{increment:1}}});let e=await b.user.findUnique({where:{id:c.id},select:{onboardingCompleted:!0}});return{invite:d,onboardingCompleted:!!e?.onboardingCompleted}});return(0,g.revalidateTag)(`institution-invites-${h.institutionId}`,"max"),(0,g.revalidateTag)(`institution-stats-${h.institutionId}`,"max"),(0,g.revalidateTag)(`institution-staff-${h.institutionId}`,"max"),(0,g.revalidatePath)("/dashboard"),(0,g.revalidatePath)("/onboarding"),{success:!0,institutionName:h.institution.name,onboardingCompleted:i}}catch(a){return console.error("Accept invite error:",a),{success:!1,error:a.message||"Failed to accept invite"}}}(0,h.ensureServerEntryExports)([j,k,l,m,n,o]),(0,b.registerServerReference)(j,"401c0b56e0da3b528a24dc847cca9a8169ec930301",null),(0,b.registerServerReference)(k,"4070b35c934e0b3b368b7e82f87c0d943dad42d08a",null),(0,b.registerServerReference)(l,"403793a01b4e61bf4760f03221283fe03f82e3feff",null),(0,b.registerServerReference)(m,"404e29d679764283f39ad846a4fa6f88e3cbdde468",null),(0,b.registerServerReference)(n,"4066b84c2f45d13f02d3bdb725aeccf656557b6247",null),(0,b.registerServerReference)(o,"404868956ef6b4b20cd8403454848c0d661f9addce",null),a.s(["acceptInvite",()=>o,"createInvite",()=>j,"deleteInvite",()=>l,"getInstitutionInvites",()=>m,"getInviteDetails",()=>n,"toggleInvite",()=>k])},637688,a=>{"use strict";var b=a.i(191679),c=a.i(257728);a.s([],83368),a.i(83368),a.s(["00f4c838ce10f91796a39f1558a3b75432fa49882a",()=>b.checkSessionConflict,"401c0b56e0da3b528a24dc847cca9a8169ec930301",()=>c.createInvite,"403793a01b4e61bf4760f03221283fe03f82e3feff",()=>c.deleteInvite,"404868956ef6b4b20cd8403454848c0d661f9addce",()=>c.acceptInvite,"404e29d679764283f39ad846a4fa6f88e3cbdde468",()=>c.getInstitutionInvites,"4066b84c2f45d13f02d3bdb725aeccf656557b6247",()=>c.getInviteDetails,"4070b35c934e0b3b368b7e82f87c0d943dad42d08a",()=>c.toggleInvite,"409bc5870257fe05de038549e85b0722c4e09c83d4",()=>b.resolveSessionConflict],637688)},588010,a=>{a.v(b=>Promise.all(["server/chunks/ssr/node_modules_better-auth_dist_adapters_memory-adapter_index_mjs_35d2dbfd._.js"].map(b=>a.l(b))).then(()=>b(700031)))},860484,a=>{a.v(b=>Promise.all(["server/chunks/ssr/node_modules_better-auth_dist_adapters_kysely-adapter_index_mjs_0abbd964._.js"].map(b=>a.l(b))).then(()=>b(536063)))},946014,a=>{a.v(b=>Promise.all(["server/chunks/ssr/a9bf9_better-auth_dist_adapters_kysely-adapter_bun-sqlite-dialect_mjs_23698f07._.js"].map(b=>a.l(b))).then(()=>b(496824)))},945599,a=>{a.v(b=>Promise.all(["server/chunks/ssr/a9bf9_better-auth_dist_adapters_kysely-adapter_node-sqlite-dialect_mjs_9102e2ec._.js"].map(b=>a.l(b))).then(()=>b(68928)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__72358e09._.js.map