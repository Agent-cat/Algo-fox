module.exports=[53112,a=>{"use strict";var b=a.i(954757);a.s(["z",0,b])},216911,a=>{"use strict";var b=a.i(260711),c=a.i(137936),d=a.i(231191);class e{static async getInstitutions(){return(await d.prisma.institution.findMany({include:{_count:{select:{users:!0,classrooms:!0}},users:{where:{role:"INSTITUTION_MANAGER"},select:{name:!0},take:1}},orderBy:{createdAt:"desc"}})).map(a=>({...a,managerName:a.users[0]?.name||"Unassigned"}))}static async getInstitutionById(a){return d.prisma.institution.findUnique({where:{id:a},include:{users:{where:{role:"INSTITUTION_MANAGER"}},classrooms:!0,_count:{select:{users:!0,classrooms:!0}}}})}static async updateInstitution(a,b){return d.prisma.institution.update({where:{id:a},data:b})}static async deleteInstitution(a){return d.prisma.institution.delete({where:{id:a}})}static async getInstitutionStats(a){let b=await d.prisma.user.groupBy({by:["role"],where:{institutionId:a},_count:!0}),c=await d.prisma.classroom.count({where:{institutionId:a}}),e=b.reduce((a,b)=>(a[b.role]=b._count,a),{});return{students:e.STUDENT||0,teachers:e.TEACHER||0,contestManagers:e.CONTEST_MANAGER||0,classrooms:c}}}var f=a.i(53112),g=a.i(118558),h=a.i(167784),i=a.i(713095);let j=f.z.object({name:f.z.string().min(2,"Name must be at least 2 characters"),slug:f.z.string().min(2,"Slug must be at least 2 characters").regex(/^[a-z0-9-]+$/,"Slug must be lowercase alphanumeric and hyphens"),logo:f.z.string().url().optional().or(f.z.literal("")),domain:f.z.string().optional().or(f.z.literal(""))}),k=j.partial();async function l(){try{let a=await e.getInstitutions();return{success:!0,institutions:a}}catch(a){return console.error("Failed to fetch institutions:",a),{success:!1,error:"Failed to fetch institutions"}}}async function m(a){try{let b=await e.getInstitutionById(a);if(!b)return{success:!1,error:"Institution not found"};return{success:!0,institution:b}}catch(a){return console.error("Failed to fetch institution:",a),{success:!1,error:"Failed to fetch institution"}}}async function n(c){try{let d=j.parse(c),{prisma:e}=await (0,b.trackDynamicImport)(a.A(634945)),f=await e.institution.create({data:{name:d.name,slug:d.slug,logo:d.logo||null,domain:d.domain||null}});return(0,g.revalidatePath)("/admin/institutions"),{success:!0,data:f}}catch(a){if(a instanceof f.z.ZodError)return{success:!1,error:a.issues[0].message};return console.error("Failed to create institution:",a),{success:!1,error:"Failed to create institution"}}}async function o(a,b){try{let c=k.parse(b),d=await e.updateInstitution(a,{...c,logo:c.logo||void 0,domain:c.domain||void 0});return(0,g.revalidatePath)("/admin/institutions"),(0,g.revalidatePath)(`/admin/institutions/${a}`),{success:!0,data:d}}catch(a){if(a instanceof f.z.ZodError)return{success:!1,error:a.issues[0].message};return console.error("Failed to update institution:",a),{success:!1,error:"Failed to update institution"}}}async function p(c,d){try{let{prisma:e}=await (0,b.trackDynamicImport)(a.A(634945)),f=await e.user.findUnique({where:{email:c}});if(!f)return{success:!1,error:"User not found"};let i=await e.user.update({where:{id:f.id},data:{role:"INSTITUTION_MANAGER",institutionId:d}});return(0,g.revalidatePath)("/admin/users"),(0,g.revalidatePath)(`/admin/institutions/${d}`),(0,g.revalidateTag)(`dashboard-${f.id}`,"max"),await h.default.del(`dashboard:stats:${f.id}`),{success:!0,data:i}}catch(a){return console.error("Failed to assign institution manager:",a),{success:!1,error:"Failed to assign institution manager"}}}async function q(c){try{let{prisma:d}=await (0,b.trackDynamicImport)(a.A(634945)),e=await d.user.findMany({where:{email:{contains:c,mode:"insensitive"}},select:{id:!0,email:!0,name:!0},take:5});return{success:!0,users:e}}catch(a){return console.error("Failed to search users:",a),{success:!1,error:"Failed to search users"}}}async function r(c,d){try{let{prisma:e}=await (0,b.trackDynamicImport)(a.A(634945));return await e.user.update({where:{id:c},data:{role:"STUDENT",institutionId:null}}),(0,g.revalidatePath)(`/admin/institutions/${d}`),(0,g.revalidateTag)(`dashboard-${c}`,"max"),await h.default.del(`dashboard:stats:${c}`),{success:!0}}catch(a){return console.error("Failed to remove manager:",a),{success:!1,error:"Failed to remove administrative access"}}}async function s(c){try{let{prisma:d}=await (0,b.trackDynamicImport)(a.A(634945));return await d.user.updateMany({where:{institutionId:c},data:{institutionId:null}}),await e.deleteInstitution(c),(0,g.revalidatePath)("/admin/institutions"),{success:!0}}catch(a){return console.error("Failed to delete institution:",a),{success:!1,error:"Failed to delete institution. Ensure it has no active classrooms."}}}async function t(c,d=1,e=""){try{let{prisma:f}=await (0,b.trackDynamicImport)(a.A(634945)),g={institutionId:c};e&&(g.OR=[{name:{contains:e,mode:"insensitive"}},{email:{contains:e,mode:"insensitive"}}]);let[h,i]=await Promise.all([f.user.findMany({where:g,skip:(d-1)*20,take:20,orderBy:{createdAt:"desc"},select:{id:!0,name:!0,email:!0,role:!0,createdAt:!0}}),f.user.count({where:g})]);return{success:!0,users:h,total:i}}catch(a){return console.error("Failed to fetch institution users:",a),{success:!1,error:"Failed to fetch institution users"}}}async function u(c){try{let{prisma:d}=await (0,b.trackDynamicImport)(a.A(634945));await d.user.update({where:{id:c},data:{institutionId:null}}),(0,g.revalidateTag)(`user-${c}`,"max"),(0,g.revalidateTag)(`dashboard-${c}`,"max");try{let d=(await (0,b.trackDynamicImport)(a.A(1067))).default;await d.del(`dashboard:stats:${c}`)}catch(a){}return{success:!0}}catch(a){return console.error("Failed to remove user from institution:",a),{success:!1,error:"Failed to remove user from institution"}}}(0,i.ensureServerEntryExports)([l,m,n,o,p,q,r,s,t,u]),(0,c.registerServerReference)(l,"009f0a1e5777df118a0513af529d00d008ce515130",null),(0,c.registerServerReference)(m,"40f6e9b8f8e8e2c92343e663c6d94ca77704b32c4e",null),(0,c.registerServerReference)(n,"404707d597b612077a9812f2b843d2b5b9751c8364",null),(0,c.registerServerReference)(o,"6075645c773012bc11c3239c26bef68c4de8d10e19",null),(0,c.registerServerReference)(p,"604b7b931351a82ff375e1ad934da00ce596e4182b",null),(0,c.registerServerReference)(q,"405e04aceede4e9292ab1f13da65c7c83541f66504",null),(0,c.registerServerReference)(r,"6075b431ad4b8613bf0a20a1b82bb9a3bfb1302a11",null),(0,c.registerServerReference)(s,"40d50a5da54d4b47318823f3556380c9628e0b2897",null),(0,c.registerServerReference)(t,"704aaa81b27b1cd4a3693d4125a9deb09cf53f3df0",null),(0,c.registerServerReference)(u,"40ceda26fecb25470088093f1e29c21c664fd95b32",null),a.s(["assignInstitutionManager",()=>p,"createInstitutionAction",()=>n,"deleteInstitutionAction",()=>s,"getInstitutionById",()=>m,"getInstitutionUsers",()=>t,"getInstitutions",()=>l,"removeInstitutionManager",()=>r,"removeUserFromInstitution",()=>u,"searchUsersByEmail",()=>q,"updateInstitutionAction",()=>o],216911)},262925,a=>{"use strict";var b=a.i(191679),c=a.i(154470),d=a.i(216911);a.s([],838960),a.i(838960),a.s(["00f4c838ce10f91796a39f1558a3b75432fa49882a",()=>b.checkSessionConflict,"405e04aceede4e9292ab1f13da65c7c83541f66504",()=>d.searchUsersByEmail,"409bc5870257fe05de038549e85b0722c4e09c83d4",()=>b.resolveSessionConflict,"40ceda26fecb25470088093f1e29c21c664fd95b32",()=>d.removeUserFromInstitution,"40f6e9b8f8e8e2c92343e663c6d94ca77704b32c4e",()=>d.getInstitutionById,"604b7b931351a82ff375e1ad934da00ce596e4182b",()=>d.assignInstitutionManager,"6075645c773012bc11c3239c26bef68c4de8d10e19",()=>d.updateInstitutionAction,"6075b431ad4b8613bf0a20a1b82bb9a3bfb1302a11",()=>d.removeInstitutionManager,"704aaa81b27b1cd4a3693d4125a9deb09cf53f3df0",()=>d.getInstitutionUsers,"80ee7282f708e60661ecc42477a6d2afba42f1d5ed",()=>c.getUserScore],262925)},588010,a=>{a.v(b=>Promise.all(["server/chunks/ssr/node_modules_better-auth_dist_adapters_memory-adapter_index_mjs_35d2dbfd._.js"].map(b=>a.l(b))).then(()=>b(700031)))},860484,a=>{a.v(b=>Promise.all(["server/chunks/ssr/node_modules_better-auth_dist_adapters_kysely-adapter_index_mjs_0abbd964._.js"].map(b=>a.l(b))).then(()=>b(536063)))},946014,a=>{a.v(b=>Promise.all(["server/chunks/ssr/a9bf9_better-auth_dist_adapters_kysely-adapter_bun-sqlite-dialect_mjs_23698f07._.js"].map(b=>a.l(b))).then(()=>b(496824)))},945599,a=>{a.v(b=>Promise.all(["server/chunks/ssr/a9bf9_better-auth_dist_adapters_kysely-adapter_node-sqlite-dialect_mjs_9102e2ec._.js"].map(b=>a.l(b))).then(()=>b(68928)))},1067,a=>{a.v(a=>Promise.resolve().then(()=>a(167784)))},634945,a=>{a.v(a=>Promise.resolve().then(()=>a(231191)))}];

//# sourceMappingURL=_d61dd502._.js.map