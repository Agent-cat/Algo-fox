module.exports=[191679,a=>{"use strict";var b=a.i(137936),c=a.i(409223),d=a.i(231191),e=a.i(905246);async function f(){let a=await c.auth.api.getSession({headers:await (0,e.headers)()});if(!a)return{conflict:!1};let b=(await d.prisma.session.findMany({where:{userId:a.user.id},select:{id:!0,expiresAt:!0,userAgent:!0,ipAddress:!0,token:!0}})).filter(a=>a.expiresAt>new Date);return b.length>1?{conflict:!0,currentSessionToken:a.session.token,sessions:b.map(b=>({...b,isCurrent:b.token===a.session.token}))}:{conflict:!1}}async function g(a){let b=await c.auth.api.getSession({headers:await (0,e.headers)()});if(!b)throw Error("No active session");return"LOGOUT_OTHERS"===a?(await d.prisma.session.deleteMany({where:{userId:b.user.id,token:{not:b.session.token}}}),{success:!0,message:"Other sessions terminated"}):"LOGOUT_CURRENT"===a?(await d.prisma.session.delete({where:{token:b.session.token}}),{success:!0,message:"Current session terminated"}):void 0}(0,a.i(713095).ensureServerEntryExports)([f,g]),(0,b.registerServerReference)(f,"00f4c838ce10f91796a39f1558a3b75432fa49882a",null),(0,b.registerServerReference)(g,"409bc5870257fe05de038549e85b0722c4e09c83d4",null),a.s(["checkSessionConflict",()=>f,"resolveSessionConflict",()=>g])},951187,(a,b,c)=>{b.exports=a.x("next/dist/server/lib/incremental-cache/tags-manifest.external.js",()=>require("next/dist/server/lib/incremental-cache/tags-manifest.external.js"))},137936,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"registerServerReference",{enumerable:!0,get:function(){return d.registerServerReference}});let d=a.r(211857)},713095,(a,b,c)=>{"use strict";function d(a){for(let b=0;b<a.length;b++){let c=a[b];if("function"!=typeof c)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof c}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"ensureServerEntryExports",{enumerable:!0,get:function(){return d}})},792509,(a,b,c)=>{b.exports=a.x("url",()=>require("url"))},688947,(a,b,c)=>{b.exports=a.x("stream",()=>require("stream"))},907378,a=>{"use strict";function b(a){switch(a){case"EASY":return 5;case"MEDIUM":return 10;case"HARD":return 15;default:return 0}}a.s(["getPointsForDifficulty",()=>b])},154470,a=>{"use strict";var b=a.i(260711),c=a.i(137936),d=a.i(402597),e=a.i(800717),f=a.i(231191),g=a.i(907378),h=a.i(167784);class i{static async getUserScore(a){let b=`user-score-${a}`;try{let a=await h.default.get(b);if(a)return parseInt(a,10)}catch(a){console.error("Redis get error:",a)}let c=await f.prisma.user.findUnique({where:{id:a},select:{totalScore:!0}}),d=c?.totalScore||0;try{await h.default.setex(b,30,d.toString())}catch(a){console.error("Redis set error:",a)}return d}static async recalculateUserScore(a){try{let b=await f.prisma.submission.findMany({where:{userId:a,status:"ACCEPTED",mode:"SUBMIT"},select:{problemId:!0,problem:{select:{difficulty:!0}}},distinct:["problemId"]}),c=0;for(let a of b){let b=(0,g.getPointsForDifficulty)(a.problem.difficulty);c+=b}await f.prisma.user.update({where:{id:a},data:{totalScore:c}});try{await h.default.del(`user-score-${a}`)}catch(a){console.error("Failed to invalidate user score cache:",a)}return{success:!0,newScore:c}}catch(a){throw console.error("Failed to recalculate user score:",a),Error("Failed to recalculate user score")}}static async completeOnboarding(a,b){try{await f.prisma.user.update({where:{id:a},data:{name:b.name,collegeId:b.collegeId||null,year:b.year?parseInt(b.year):null,bio:b.bio||null,leetCodeHandle:b.leetCodeHandle||null,codeChefHandle:b.codeChefHandle||null,codeforcesHandle:b.codeforcesHandle||b.hackerrankHandle||null,githubHandle:b.githubHandle||null,onboardingCompleted:!0}});try{await h.default.del(`dashboard:stats:${a}`)}catch(a){console.error("Failed to invalidate dashboard cache:",a)}return{success:!0}}catch(a){return console.error("Failed to complete onboarding:",a),{success:!1,error:"Failed to complete onboarding"}}}}var j=a.i(409223),k=a.i(905246),l=a.i(118558),m=a.i(713095);let n=async function(){(0,l.cacheLife)({stale:300,revalidate:300});let a=await j.auth.api.getSession({headers:await (0,k.headers)()});if(!a?.user?.id)return 0;let b=a.user.id;return(0,l.cacheTag)(`user-score-${b}`,`user-${b}`),i.getUserScore(b)};var o=(0,e.cache)(function(){return(0,d.cache)("private","806283762cd0bce0ac074567811476f29644f6b5e2",0,n,arguments)});async function p(){let a=await j.auth.api.getSession({headers:await (0,k.headers)()});if(!a?.user?.id)throw Error("Unauthorized");let b=a.user.id;return i.recalculateUserScore(b)}async function q(c){let d=await j.auth.api.getSession({headers:await (0,k.headers)()});if(!d?.user?.id)return{success:!1,error:"Unauthorized"};let e=d.user.id,f=await i.completeOnboarding(e,c);if(f.success){try{let c=(await (0,b.trackDynamicImport)(a.A(1067))).default;await c.del(`dashboard:stats:${e}`)}catch(a){console.error("Failed to invalidate dashboard redis cache:",a)}(0,l.revalidatePath)("/dashboard"),(0,l.updateTag)(`user-${e}`),(0,l.updateTag)(`dashboard-${e}`),(0,l.updateTag)("dashboard-stats")}return f}async function r(c){let d=await j.auth.api.getSession({headers:await (0,k.headers)()});if(!d?.user?.id)return{success:!1,error:"Unauthorized"};let e=d.user.id;try{let d=await f.prisma.user.findUnique({where:{id:e},select:{codeChefHandle:!0,codeforcesHandle:!0,leetCodeHandle:!0}}),g={name:c.name,bio:c.bio,leetCodeHandle:c.leetCodeHandle,codeChefHandle:c.codeChefHandle,codeforcesHandle:c.codeforcesHandle,githubHandle:c.githubHandle};d&&(void 0!==c.codeChefHandle&&c.codeChefHandle!==d.codeChefHandle&&(g.codeChefVerified=!1),void 0!==c.codeforcesHandle&&c.codeforcesHandle!==d.codeforcesHandle&&(g.codeforcesVerified=!1),void 0!==c.leetCodeHandle&&c.leetCodeHandle!==d.leetCodeHandle&&(g.leetCodeVerified=!1)),await f.prisma.user.update({where:{id:e},data:g});try{let c=(await (0,b.trackDynamicImport)(a.A(1067))).default;await c.del(`dashboard:stats:${e}`)}catch(a){console.error("Failed to invalidate dashboard redis cache:",a)}return(0,l.revalidatePath)("/dashboard"),(0,l.revalidatePath)("/dashboard/settings"),(0,l.updateTag)(`user-${e}`),(0,l.updateTag)(`user-score-${e}`),(0,l.updateTag)(`dashboard-${e}`),(0,l.updateTag)("dashboard-stats"),{success:!0}}catch(a){return console.error("Failed to update user info:",a),{success:!1,error:"Failed to update profile"}}}async function s(){let c=await j.auth.api.getSession({headers:await (0,k.headers)()});if(!c?.user?.id)return{success:!1,error:"Unauthorized"};let d=c.user.id;try{try{let c=(await (0,b.trackDynamicImport)(a.A(1067))).default;await c.del(`dashboard:stats:${d}`),await c.del(`user-score-${d}`)}catch(a){console.error("Failed to invalidate redis cache during sync:",a)}return(0,l.revalidatePath)("/dashboard"),(0,l.updateTag)(`user-${d}`),(0,l.updateTag)(`user-score-${d}`),(0,l.updateTag)("dashboard-stats"),{success:!0}}catch(a){return console.error("Sync failed:",a),{success:!1,error:"Failed to sync profile"}}}(0,c.registerServerReference)(o,"806283762cd0bce0ac074567811476f29644f6b5e2",null),Object.defineProperty(o,"name",{value:"getUserScore"});let t=async function(){(0,l.cacheLife)({stale:300,revalidate:300});let a=await j.auth.api.getSession({headers:await (0,k.headers)()});if(!a?.user?.id)return null;let b=a.user.id;(0,l.cacheTag)(`user-${b}`);let c=await f.prisma.user.findUnique({where:{id:b},include:{institution:!0}});return c?{id:c.id,name:c.name,email:c.email,image:c.image,bio:c.bio,institutionName:c.institution?.name}:null};var u=(0,e.cache)(function(){return(0,d.cache)("private","801090a862b4d5f5c1a62c9c0bb04047d7a9910873",0,t,arguments)});(0,c.registerServerReference)(u,"801090a862b4d5f5c1a62c9c0bb04047d7a9910873",null),Object.defineProperty(u,"name",{value:"getUserSettings"}),(0,m.ensureServerEntryExports)([p,q,r,s]),(0,c.registerServerReference)(p,"007977239056561ea7766ffef604a1b67e3430e9af",null),(0,c.registerServerReference)(q,"4022a02ca4ee842a7ee3b7772e041cc7b3c57f2de4",null),(0,c.registerServerReference)(r,"401adb5bf0163fd65ff314479b20d5a44231d975ab",null),(0,c.registerServerReference)(s,"004e22ef7336191bc1fe8b683adb39c115fb22318c",null),a.s(["$$RSC_SERVER_CACHE_0",()=>o,"$$RSC_SERVER_CACHE_1",()=>u,"completeOnboarding",()=>q,"getUserScore",()=>o,"getUserSettings",()=>u,"recalculateUserScore",()=>p,"syncUserProfile",()=>s,"updateUserInfo",()=>r],154470)},859664,(a,b,c)=>{b.exports=a.x("jsdom-4cccfac9827ebcfe",()=>require("jsdom-4cccfac9827ebcfe"))},363212,a=>{"use strict";var b=a.i(260711),c=a.i(137936),d=a.i(859664),e=a.i(409223),f=a.i(231191),g=a.i(118558),h=a.i(905246);async function i(a,b=!1){try{let c=await fetch(`https://www.codechef.com/users/${a}`,b?{cache:"no-store"}:{next:{revalidate:3600}});if(200!=c.status)return{success:!1,status:c.status};{let a=await c.text(),b=a.search("var userDailySubmissionsStats =")+31,e=a.search("'#js-heatmap")-34,f=a.substring(b,e),g=null;try{g=JSON.parse(f)}catch(a){console.log("Error parsing heatmap data",a)}let h=a.search("var all_rating = ")+17,i=a.search("var current_user_rating =")-6,j=null;try{j=JSON.parse(a.substring(h,i))}catch(a){console.log("Error parsing rating data",a)}let k=new d.JSDOM(a).window.document,l=k.querySelector(".user-details-container")?.children[0]?.children[1]?.textContent||"",m=k.querySelector(".user-details-container")?.children[0]?.children[0]?.getAttribute("src")||"",n=k.querySelector(".rating-number")?.textContent,o=n?parseInt(n):0,p=k.querySelector(".rating-number")?.parentNode?.children[4]?.textContent?.split("Rating")[1],q=p?parseInt(p):0,r=k.querySelector(".user-country-flag")?.getAttribute("src")||"",s=k.querySelector(".user-country-name")?.textContent||"",t=k.querySelector(".rating-ranks")?.children[0]?.children[0]?.children[0]?.children[0]?.innerHTML,u=t?parseInt(t):0,v=k.querySelector(".rating-ranks")?.children[0]?.children[1]?.children[0]?.children[0]?.innerHTML,w=v?parseInt(v):0,x=k.querySelector(".rating")?.textContent||"unrated",y=0;for(let a of k.querySelectorAll("h5"))if(a.textContent?.includes("Fully Solved")){let b=a.textContent.match(/\d+/);b&&(y=parseInt(b[0]));break}return{success:!0,status:c.status,profile:m,name:l,currentRating:o,highestRating:q,countryFlag:r,countryName:s,globalRank:u,countryRank:w,stars:x,heatMap:g,ratingData:j,fullySolvedCount:y}}}catch(a){return console.log(a),{success:!1,status:404}}}async function j(a,b){let c=await e.auth.api.getSession({headers:await (0,h.headers)()});if(!c||!c.user)return{success:!1,error:"Unauthorized"};let d=await i(a,!0);if(d.success&&d.name)if(!d.name.includes(b))return{success:!1,error:"Verification code not found in CodeChef name. Please ensure you have updated your profile name."};else try{return await f.prisma.user.update({where:{id:c.user.id},data:{codeChefVerified:!0,codeChefHandle:a}}),(0,g.revalidatePath)("/dashboard/settings"),(0,g.revalidateTag)(`user-${c.user.id}`,"max"),{success:!0}}catch(a){return console.error("Database update error:",a),{success:!1,error:"Failed to update verification status"}}return{success:!1,error:"Failed to fetch CodeChef profile"}}async function k(a,b=!1){try{let c=b?{cache:"no-store"}:{next:{revalidate:3600}},[d,e]=await Promise.all([fetch(`https://codeforces.com/api/user.info?handles=${a}`,c),fetch(`https://codeforces.com/api/user.status?handle=${a}`,c)]);if(d.ok&&e.ok){let a=await d.json(),b=await e.json();if("OK"===a.status&&a.result.length>0){let c=a.result[0],d=new Set,e={EASY:0,MEDIUM:0,HARD:0,TOTAL:0};if("OK"===b.status){for(let a of b.result)if("OK"===a.verdict){let b=`${a.problem.contestId}-${a.problem.index}`;if(!d.has(b)){d.add(b);let c=a.problem.rating;c&&(c<1200?e.EASY++:c<1600?e.MEDIUM++:e.HARD++)}}e.TOTAL=d.size}return{success:!0,status:200,firstName:c.firstName,rating:c.rating,rank:c.rank,maxRating:c.maxRating,maxRank:c.maxRank,avatar:c.titlePhoto||c.avatar,solvedByDifficulty:e}}}return{success:!1,status:d.status}}catch(a){return console.error(a),{success:!1,status:500}}}async function l(a,b){let c=await e.auth.api.getSession({headers:await (0,h.headers)()});if(!c||!c.user)return{success:!1,error:"Unauthorized"};let d=await k(a,!0);if(d.success)if(!(d.firstName&&d.firstName.includes(b)))return{success:!1,error:"Verification code not found in Codeforces First Name. Please ensure you have updated it in your profile settings."};else try{return await f.prisma.user.update({where:{id:c.user.id},data:{codeforcesVerified:!0,codeforcesHandle:a}}),(0,g.revalidatePath)("/dashboard/settings"),(0,g.revalidateTag)(`user-${c.user.id}`,"max"),{success:!0}}catch(a){return console.error("Database update error:",a),{success:!1,error:"Failed to update verification status"}}return{success:!1,error:"Failed to fetch Codeforces profile"}}async function m(c,d=!1){try{let{LeetCode:e}=await (0,b.trackDynamicImport)(a.A(444063)),f=new e,g=await f.user(c),h=`
            query userContestRankingInfo($username: String!) {
                userContestRanking(username: $username) {
                    attendedContestsCount
                    rating
                    globalRanking
                    topPercentage
                    badge {
                        name
                    }
                }
                userContestRankingHistory(username: $username) {
                    attended
                    rating
                    contest {
                        title
                        startTime
                    }
                }
            }
        `,i=await fetch("https://leetcode.com/graphql",{method:"POST",headers:{"Content-Type":"application/json",Referer:"https://leetcode.com"},body:JSON.stringify({query:h,variables:{username:c}}),...d?{cache:"no-store"}:{next:{revalidate:3600}}}),j=await i.json(),k=j.data?.userContestRanking,l=j.data?.userContestRankingHistory?.filter(a=>a.attended);if(g&&g.matchedUser)return{success:!0,status:200,name:g.matchedUser.profile.realName,avatar:g.matchedUser.profile.userAvatar,submitStats:g.matchedUser.submitStats,contestStats:k||null,contestHistory:l||[]};return{success:!1,status:404}}catch(a){return console.error("LeetCode check error:",a),{success:!1,status:500}}}async function n(a,b){let c=await e.auth.api.getSession({headers:await (0,h.headers)()});if(!c||!c.user)return{success:!1,error:"Unauthorized"};try{let d=await m(a,!0);if(d.success&&d.name)if(!d.name.includes(b))return{success:!1,error:"Verification code not found in LeetCode Name. Please ensure you have updated it in your profile."};else try{return await f.prisma.user.update({where:{id:c.user.id},data:{leetCodeVerified:!0,leetCodeHandle:a}}),(0,g.revalidatePath)("/dashboard/settings"),(0,g.revalidateTag)(`user-${c.user.id}`,"max"),{success:!0}}catch(a){return console.error("Database update error:",a),{success:!1,error:"Failed to update verification status"}}}catch(a){return{success:!1,error:"Failed to verify LeetCode profile"}}return{success:!1,error:"Failed to fetch LeetCode profile or name is empty"}}(0,a.i(713095).ensureServerEntryExports)([i,j,k,l,m,n]),(0,c.registerServerReference)(i,"6063cd483379a41c765892304ba2c4b6076f9fe25a",null),(0,c.registerServerReference)(j,"6025b82b45ad39180ed262d4932bb5045a0e8415db",null),(0,c.registerServerReference)(k,"60f28e01956bf5c9d597a2fde65801b141c59b3d64",null),(0,c.registerServerReference)(l,"60544a97665a44c2f404559d69526b2c7b9f0295a2",null),(0,c.registerServerReference)(m,"602e4c595e83925f2fb97d138792c6c901bc6651d1",null),(0,c.registerServerReference)(n,"601fb0da0dfc97022be5342d2cad339f22823cb918",null),a.s(["checkCodeChefUser",()=>i,"checkCodeforcesUser",()=>k,"checkLeetCodeUser",()=>m,"verifyCodeChefOwnership",()=>j,"verifyCodeforcesOwnership",()=>l,"verifyLeetCodeOwnership",()=>n])},388205,a=>{"use strict";var b=a.i(191679),c=a.i(154470),d=a.i(363212);a.s([],514776),a.i(514776),a.s(["00f4c838ce10f91796a39f1558a3b75432fa49882a",()=>b.checkSessionConflict,"401adb5bf0163fd65ff314479b20d5a44231d975ab",()=>c.updateUserInfo,"409bc5870257fe05de038549e85b0722c4e09c83d4",()=>b.resolveSessionConflict,"601fb0da0dfc97022be5342d2cad339f22823cb918",()=>d.verifyLeetCodeOwnership,"6025b82b45ad39180ed262d4932bb5045a0e8415db",()=>d.verifyCodeChefOwnership,"602e4c595e83925f2fb97d138792c6c901bc6651d1",()=>d.checkLeetCodeUser,"60544a97665a44c2f404559d69526b2c7b9f0295a2",()=>d.verifyCodeforcesOwnership,"6063cd483379a41c765892304ba2c4b6076f9fe25a",()=>d.checkCodeChefUser,"60f28e01956bf5c9d597a2fde65801b141c59b3d64",()=>d.checkCodeforcesUser,"80ee7282f708e60661ecc42477a6d2afba42f1d5ed",()=>c.getUserScore],388205)},1067,a=>{a.v(a=>Promise.resolve().then(()=>a(167784)))},444063,a=>{a.v(b=>Promise.all(["server/chunks/ssr/[root-of-the-server]__9a763770._.js"].map(b=>a.l(b))).then(()=>b(559175)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__2f33041a._.js.map