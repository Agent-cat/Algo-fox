module.exports=[368610,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(405050);let e=(0,d.createServerReference)("40f6e9b8f8e8e2c92343e663c6d94ca77704b32c4e",d.callServer,void 0,d.findSourceMapURL,"getInstitutionById"),f=(0,d.createServerReference)("6075645c773012bc11c3239c26bef68c4de8d10e19",d.callServer,void 0,d.findSourceMapURL,"updateInstitutionAction"),g=(0,d.createServerReference)("604b7b931351a82ff375e1ad934da00ce596e4182b",d.callServer,void 0,d.findSourceMapURL,"assignInstitutionManager");var h=a.i(266494);let i=(0,d.createServerReference)("6075b431ad4b8613bf0a20a1b82bb9a3bfb1302a11",d.callServer,void 0,d.findSourceMapURL,"removeInstitutionManager"),j=(0,d.createServerReference)("704aaa81b27b1cd4a3693d4125a9deb09cf53f3df0",d.callServer,void 0,d.findSourceMapURL,"getInstitutionUsers"),k=(0,d.createServerReference)("40ceda26fecb25470088093f1e29c21c664fd95b32",d.callServer,void 0,d.findSourceMapURL,"removeUserFromInstitution");var l=a.i(267900),m=a.i(992258),n=a.i(915618),o=a.i(596221),p=a.i(170106);let q=(0,p.default)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);var r=a.i(244494),s=a.i(781560),t=a.i(732860),u=a.i(603314),v=a.i(290669),w=a.i(452495),x=a.i(660246),y=a.i(587532);let z=(0,p.default)("user-minus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);var A=a.i(823292),B=a.i(238246),C=a.i(695245),D=a.i(159501),E=a.i(954714),F=a.i(262036),G=a.i(346271),H=a.i(892291);let I=E.object({name:E.string().min(2,"Name must be at least 2 characters"),logo:E.string().url().optional().or(E.literal("")),domain:E.string().optional().or(E.literal(""))});function J({params:a}){let[d,p]=(0,c.useState)(""),[E,J]=(0,c.useState)(null),[K,L]=(0,c.useState)(!0),[M,N]=(0,c.useState)("details"),[O,P]=(0,c.useState)(""),[Q,R]=(0,c.useState)([]),[S,T]=(0,c.useState)(!1),[U,V]=(0,c.useState)(!1),[W,X]=(0,c.useState)([]),[Y,Z]=(0,c.useState)(!1),[$,_]=(0,c.useState)(""),[aa,ab]=(0,c.useState)(1),[ac,ad]=(0,c.useState)(0),ae=(0,H.useDebounce)($,500),af=(0,H.useDebounce)(O,300),ag=(0,C.useForm)({resolver:(0,D.zodResolver)(I)});(0,c.useEffect)(()=>{a.then(a=>p(a.id))},[a]);let ah=async()=>{if(d){L(!0);try{let a=await e(d);a.success&&a.institution&&(J(a.institution),ag.reset({name:a.institution.name,logo:a.institution.logo||"",domain:a.institution.domain||""}))}catch(a){console.error("Fetch error:",a),A.toast.error("Failed to load institution data")}finally{L(!1)}}};(0,c.useEffect)(()=>{d&&ah()},[d]),(0,c.useEffect)(()=>{(async()=>{if(af.length<2)return R([]);try{let a=await (0,h.searchUsersByEmail)(af);a.success&&R(a.users||[])}catch(a){console.error("Search error:",a)}})()},[af]);let ai=async a=>{try{let b=await f(d,a);b.success?(A.toast.success("Institution updated successfully"),ah()):A.toast.error(b.error||"Failed to update institution")}catch(a){console.error("Update error:",a),A.toast.error("An unexpected error occurred")}},aj=async a=>{V(!0);try{let b=await g(a,d);b.success?(A.toast.success("Manager assigned successfully"),P(""),T(!1),ah()):A.toast.error(b.error||"Failed to assign manager")}catch(a){console.error("Assign error:",a),A.toast.error("Failed to assign manager")}finally{V(!1)}},ak=async(a,b)=>{if(confirm(`Are you sure you want to remove ${b} as a manager?`))try{let b=await i(a,d);b.success?(A.toast.success("Manager removed successfully"),ah()):A.toast.error(b.error||"Failed to remove manager")}catch(a){console.error("Remove manager error:",a),A.toast.error("Protocol failure during removal")}},al=async()=>{if(d){Z(!0);try{let a=await j(d,aa,ae);a.success&&(X(a.users||[]),ad(a.total||0))}catch(a){console.error("Fetch users error:",a),A.toast.error("Failed to load users")}finally{Z(!1)}}};(0,c.useEffect)(()=>{"users"===M&&d&&al()},[d,M,aa,ae]);let am=async(a,b)=>{if(confirm(`Are you sure you want to remove ${b} from this institution?`))try{let c=await k(a);c.success?(A.toast.success(`${b} removed from institution`),al(),ah()):A.toast.error(c.error||"Failed to remove user")}catch(a){console.error("Remove user error:",a),A.toast.error("Failed to remove user")}};return K?(0,b.jsx)("div",{className:"min-h-screen bg-[#FAFAFA] flex items-center justify-center",children:(0,b.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,b.jsx)(o.Loader2,{className:"w-12 h-12 text-orange-500 animate-spin"}),(0,b.jsx)("span",{className:"text-xs font-black uppercase tracking-[0.3em] text-gray-400",children:"Loading Node..."})]})}):E?(0,b.jsxs)("div",{className:"min-h-screen bg-white pb-12",children:[(0,b.jsx)("div",{className:"bg-white border-b border-gray-200",children:(0,b.jsx)("div",{className:"max-w-7xl mx-auto px-6 py-6",children:(0,b.jsx)("div",{className:"flex items-center justify-between",children:(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)(B.default,{href:"/admin/institutions",className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,b.jsx)(t.ArrowRight,{className:"w-5 h-5 rotate-180"})}),(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)("div",{className:"w-12 h-12 bg-gray-100 flex items-center justify-center overflow-hidden",children:E.logo?(0,b.jsx)("img",{src:E.logo,alt:E.name,className:"w-full h-full object-cover",referrerPolicy:"no-referrer"}):(0,b.jsx)(l.Building2,{className:"w-6 h-6 text-gray-400"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:E.name}),(0,b.jsxs)("div",{className:"flex items-center gap-4 mt-1",children:[(0,b.jsx)("span",{className:"text-sm text-gray-500",children:E.slug}),(0,b.jsx)("span",{className:"text-sm text-gray-400",children:"•"}),(0,b.jsxs)("span",{className:"text-sm text-gray-500",children:[E._count.users," users"]}),(0,b.jsx)("span",{className:"text-sm text-gray-400",children:"•"}),(0,b.jsxs)("span",{className:"text-sm text-gray-500",children:[E._count.classrooms," batches"]})]})]})]})]})})})}),(0,b.jsx)("div",{className:"bg-white border-b border-gray-200",children:(0,b.jsx)("div",{className:"max-w-7xl mx-auto px-6",children:(0,b.jsxs)("div",{className:"flex",children:[(0,b.jsx)("button",{onClick:()=>N("details"),className:`px-6 py-4 text-sm font-semibold transition-colors relative ${"details"===M?"text-orange-600 border-b-2 border-orange-600":"text-gray-500 hover:text-gray-900"}`,children:"Details"}),(0,b.jsx)("button",{onClick:()=>N("access"),className:`px-6 py-4 text-sm font-semibold transition-colors relative ${"access"===M?"text-orange-600 border-b-2 border-orange-600":"text-gray-500 hover:text-gray-900"}`,children:"Access Control"}),(0,b.jsx)("button",{onClick:()=>N("users"),className:`px-6 py-4 text-sm font-semibold transition-colors relative ${"users"===M?"text-orange-600 border-b-2 border-orange-600":"text-gray-500 hover:text-gray-900"}`,children:"Users"})]})})}),(0,b.jsxs)("main",{className:"max-w-7xl mx-auto px-6 py-8 grid grid-cols-1 lg:grid-cols-12 gap-8",children:[(0,b.jsx)("div",{className:"lg:col-span-8",children:(0,b.jsx)(F.AnimatePresence,{mode:"wait",children:"details"===M?(0,b.jsx)(G.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"space-y-6",children:(0,b.jsxs)("div",{className:"bg-white border border-gray-200 p-6",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Institution Details"}),(0,b.jsxs)("form",{onSubmit:ag.handleSubmit(ai),className:"space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Institution Name"}),(0,b.jsx)("input",{...ag.register("name"),className:"w-full px-4 py-2 border border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all"})]}),(0,b.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Domain"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(r.Globe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),(0,b.jsx)("input",{...ag.register("domain"),className:"w-full pl-10 pr-4 py-2 border border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all lowercase",placeholder:"domain.edu"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Logo URL"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(w.ExternalLink,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),(0,b.jsx)("input",{...ag.register("logo"),className:"w-full pl-10 pr-4 py-2 border border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all",placeholder:"https://..."})]})]})]}),(0,b.jsx)("div",{className:"pt-4",children:(0,b.jsx)("button",{type:"submit",disabled:ag.formState.isSubmitting,className:"w-full flex items-center justify-center gap-2 px-6 py-3 bg-gray-900 text-white hover:bg-orange-600 transition-colors font-semibold disabled:opacity-50",children:ag.formState.isSubmitting?(0,b.jsx)(o.Loader2,{className:"w-5 h-5 animate-spin"}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(q,{className:"w-4 h-4"}),"Save Changes"]})})})]})]})},"details"):"access"===M?(0,b.jsx)(G.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"space-y-6",children:(0,b.jsxs)("div",{className:"bg-white border border-gray-200 p-6",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Manager Access"}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Assign New Manager"}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsxs)("div",{className:"relative flex-1",children:[(0,b.jsx)(m.Mail,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),(0,b.jsx)("input",{type:"email",placeholder:"Enter email address...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all",value:O,onChange:a=>{P(a.target.value),T(!0)}}),S&&Q.length>0&&(0,b.jsx)("div",{className:"absolute top-full left-0 w-full bg-white border border-gray-200 mt-2 shadow-lg z-50 overflow-hidden",children:Q.map(a=>(0,b.jsxs)("button",{onClick:()=>{aj(a.email),T(!1)},className:"w-full px-4 py-3 flex items-center justify-between hover:bg-gray-50 transition-colors text-left",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm font-medium text-gray-900",children:a.name}),(0,b.jsx)("div",{className:"text-xs text-gray-500",children:a.email})]}),(0,b.jsx)(n.Plus,{className:"w-4 h-4 text-gray-400"})]},a.id))})]}),(0,b.jsx)("button",{disabled:!O||U,onClick:()=>aj(O),className:"px-6 py-2 bg-gray-900 text-white hover:bg-orange-600 transition-colors font-semibold disabled:opacity-50 disabled:cursor-not-allowed",children:U?(0,b.jsx)(o.Loader2,{className:"w-4 h-4 animate-spin"}):"Add"})]})]}),(0,b.jsxs)("div",{className:"pt-6 border-t border-gray-200",children:[(0,b.jsxs)("h4",{className:"text-sm font-semibold text-gray-900 mb-4",children:["Active Managers (",E.users?.length||0,")"]}),(0,b.jsxs)("div",{className:"space-y-3",children:[E.users?.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 border border-gray-200 hover:bg-gray-100 transition-colors",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"w-10 h-10 bg-orange-100 rounded flex items-center justify-center text-orange-600 text-sm font-semibold",children:a.name.charAt(0).toUpperCase()}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm font-medium text-gray-900",children:a.name}),(0,b.jsx)("div",{className:"text-xs text-gray-500",children:a.email})]})]}),(0,b.jsx)("button",{onClick:()=>ak(a.id,a.name),className:"p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 transition-colors",title:"Remove Manager",children:(0,b.jsx)(s.Trash2,{className:"w-4 h-4"})})]},a.id)),(!E.users||0===E.users.length)&&(0,b.jsxs)("div",{className:"py-12 text-center",children:[(0,b.jsx)(u.Shield,{className:"w-10 h-10 text-gray-300 mx-auto mb-3"}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"No managers assigned yet"})]})]})]})]})]})},"access"):(0,b.jsx)(G.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"space-y-6",children:(0,b.jsxs)("div",{className:"bg-white border border-gray-200 p-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,b.jsxs)("h3",{className:"text-lg font-semibold text-gray-900",children:["Registered Users (",ac,")"]}),(0,b.jsxs)("div",{className:"relative w-64",children:[(0,b.jsx)(y.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),(0,b.jsx)("input",{type:"text",placeholder:"Search users...",className:"w-full pl-10 pr-4 py-2 text-sm border border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-500 transition-all rounded-lg",value:$,onChange:a=>_(a.target.value)})]})]}),(0,b.jsx)("div",{className:"space-y-3",children:Y?[1,2,3].map(a=>(0,b.jsx)("div",{className:"h-16 bg-gray-50 animate-pulse border border-gray-100"},a)):W.length>0?W.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 border border-gray-200 hover:bg-gray-100 transition-colors",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"w-10 h-10 bg-gray-200 rounded flex items-center justify-center text-gray-600 text-sm font-bold",children:a.name?.charAt(0).toUpperCase()}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-gray-900",children:a.name}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"text-xs text-gray-500",children:a.email}),(0,b.jsx)("span",{className:"text-[10px] px-1.5 py-0.5 bg-gray-200 text-gray-600 rounded-full font-bold uppercase",children:a.role})]})]})]}),(0,b.jsx)("button",{onClick:()=>am(a.id,a.name),className:"p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 transition-colors",title:"Remove from Institution",children:(0,b.jsx)(z,{className:"w-4 h-4"})})]},a.id)):(0,b.jsxs)("div",{className:"py-16 text-center",children:[(0,b.jsx)(x.Users,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-gray-500",children:"No users found for this institution"})]})}),ac>20&&(0,b.jsxs)("div",{className:"mt-8 flex justify-center gap-2",children:[(0,b.jsx)("button",{disabled:1===aa,onClick:()=>ab(a=>a-1),className:"px-4 py-2 border border-gray-200 text-xs font-bold hover:bg-gray-50 disabled:opacity-50",children:"Previous"}),(0,b.jsx)("button",{disabled:20*aa>=ac,onClick:()=>ab(a=>a+1),className:"px-4 py-2 border border-gray-200 text-xs font-bold hover:bg-gray-50 disabled:opacity-50",children:"Next"})]})]})},"users")})}),(0,b.jsx)("div",{className:"lg:col-span-4 space-y-6",children:(0,b.jsxs)("div",{className:"bg-white border border-gray-200 p-6",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-6",children:[(0,b.jsx)(v.Activity,{className:"w-5 h-5 text-orange-600"}),(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Quick Links"})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)(B.default,{href:`/institutions/${E.slug}`,target:"_blank",className:"flex items-center justify-between p-4 bg-gray-50 border border-gray-200 hover:bg-gray-100 transition-colors",children:[(0,b.jsx)("span",{className:"text-sm font-medium text-gray-900",children:"Public Portal"}),(0,b.jsx)(w.ExternalLink,{className:"w-4 h-4 text-gray-400"})]}),(0,b.jsx)("div",{className:"p-4 bg-orange-50 border border-orange-100",children:(0,b.jsxs)("p",{className:"text-xs text-orange-700",children:["Last updated: ",new Date().toLocaleTimeString()]})})]})]})})]})]}):(0,b.jsxs)("div",{className:"min-h-screen bg-[#FAFAFA] flex flex-col items-center justify-center p-6 text-center",children:[(0,b.jsx)("h1",{className:"text-4xl font-black text-gray-900 mb-4",children:"404"}),(0,b.jsx)("p",{className:"text-gray-500 mb-8",children:"Node not found in registry."}),(0,b.jsx)(B.default,{href:"/admin/institutions",className:"px-8 py-4 bg-gray-900 text-white rounded-2xl font-black uppercase tracking-widest text-xs shadow-2xl shadow-gray-200",children:"Back to Registry"})]})}a.s(["default",()=>J],368610)}];

//# sourceMappingURL=app_%28main%29_admin_institutions_%5Bid%5D_page_tsx_17b30c31._.js.map