{"version":3,"sources":["../../../../app/%28main%29/admin/course-allocation/page.tsx","../../../../actions/data%3Adc2964%20%3Ctext/javascript%3E","../../../../actions/data%3Aaf86a7%20%3Ctext/javascript%3E"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport {\n  getCourseAllocations,\n  updateYearAllocations,\n} from \"@/actions/courseAllocation.action\";\nimport { ProblemDomain } from \"@prisma/client\";\nimport { toast } from \"sonner\";\n\ninterface Allocation {\n  id: string;\n  year: number;\n  domain: ProblemDomain;\n}\n\nexport default function CourseAllocationPage() {\n  const [allocations, setAllocations] = useState<Allocation[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [saving, setSaving] = useState(false);\n\n  // State for year selections\n  const [yearAllocations, setYearAllocations] = useState<{\n    [year: number]: ProblemDomain[];\n  }>({});\n\n  const availableDomains: ProblemDomain[] = [\"DSA\", \"SQL\"];\n  const years = [1, 2, 3, 4];\n\n  useEffect(() => {\n    loadAllocations();\n  }, []);\n\n  async function loadAllocations() {\n    setLoading(true);\n    const result = await getCourseAllocations();\n    if (result.success && result.allocations) {\n      setAllocations(result.allocations);\n\n      // Build year allocations map\n      const yearMap: { [year: number]: ProblemDomain[] } = {};\n      years.forEach((year) => {\n        yearMap[year] = result.allocations!\n          .filter((a) => a.year === year)\n          .map((a) => a.domain);\n      });\n      setYearAllocations(yearMap);\n    }\n    setLoading(false);\n  }\n\n  const toggleDomain = (year: number, domain: ProblemDomain) => {\n    setYearAllocations((prev) => {\n      const current = prev[year] || [];\n      const updated = current.includes(domain)\n        ? current.filter((d) => d !== domain)\n        : [...current, domain];\n      return { ...prev, [year]: updated };\n    });\n  };\n\n  const saveAllocations = async (year: number) => {\n    setSaving(true);\n    const domains = yearAllocations[year] || [];\n    const result = await updateYearAllocations(year, domains);\n    if (result.success) {\n      toast.success(`Year ${year} allocations updated successfully`);\n      await loadAllocations(); // Reload to sync\n    } else {\n      toast.error(result.error || \"Failed to update allocations\");\n    }\n    setSaving(false);\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 dark:bg-[#0a0a0a] flex items-center justify-center transition-colors\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500 mx-auto\"></div>\n          <p className=\"mt-4 text-gray-600 dark:text-gray-400\">Loading allocations...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 dark:bg-[#0a0a0a] py-8 px-4 sm:px-6 lg:px-8 transition-colors\">\n      <div className=\"max-w-5xl mx-auto\">\n        <div className=\"mb-8\">\n          <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white\">\n            Course Allocation Management\n          </h1>\n          <p className=\"mt-2 text-gray-600 dark:text-gray-400\">\n            Allocate courses to different academic years. Students will only see courses allocated to their year.\n          </p>\n        </div>\n\n        <div className=\"space-y-6\">\n          {years.map((year) => (\n            <div\n              key={year}\n              className=\"bg-white dark:bg-[#141414] rounded-lg shadow-sm border border-gray-200 dark:border-[#262626] p-6\"\n            >\n              <div className=\"flex items-center justify-between mb-4\">\n                <h2 className=\"text-xl font-semibold text-gray-900 dark:text-white\">\n                  Year {year}\n                </h2>\n                <button\n                  onClick={() => saveAllocations(year)}\n                  disabled={saving}\n                  className=\"px-4 py-2 bg-orange-500 text-white rounded-lg font-medium hover:bg-orange-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n                >\n                  {saving ? \"Saving...\" : \"Save\"}\n                </button>\n              </div>\n\n              <div className=\"grid grid-cols-2 md:grid-cols-3 gap-4\">\n                {availableDomains.map((domain) => {\n                  const isSelected = (yearAllocations[year] || []).includes(\n                    domain\n                  );\n                  return (\n                    <button\n                      key={domain}\n                      onClick={() => toggleDomain(year, domain)}\n                      className={`p-4 rounded-lg border-2 transition-all text-left ${\n                        isSelected\n                          ? \"border-orange-500 bg-orange-50 dark:bg-orange-500/10\"\n                          : \"border-gray-200 dark:border-[#333] bg-white dark:bg-[#1a1a1a] hover:border-gray-300 dark:hover:border-[#444]\"\n                      }`}\n                    >\n                      <div className=\"flex items-center justify-between\">\n                        <span className=\"font-semibold text-gray-900 dark:text-gray-100\">\n                          {domain}\n                        </span>\n                        {isSelected && (\n                          <svg\n                            className=\"w-5 h-5 text-orange-500\"\n                            fill=\"none\"\n                            viewBox=\"0 0 24 24\"\n                            stroke=\"currentColor\"\n                          >\n                            <path\n                              strokeLinecap=\"round\"\n                              strokeLinejoin=\"round\"\n                              strokeWidth={2}\n                              d=\"M5 13l4 4L19 7\"\n                            />\n                          </svg>\n                        )}\n                      </div>\n                    </button>\n                  );\n                })}\n              </div>\n            </div>\n          ))}\n        </div>\n\n        <div className=\"mt-8 bg-blue-50 dark:bg-blue-500/10 border border-blue-200 dark:border-blue-500/20 rounded-lg p-4\">\n          <div className=\"flex\">\n            <svg\n              className=\"w-5 h-5 text-blue-500 dark:text-blue-400 mt-0.5\"\n              fill=\"none\"\n              viewBox=\"0 0 24 24\"\n              stroke=\"currentColor\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                strokeWidth={2}\n                d=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"\n              />\n            </svg>\n            <div className=\"ml-3\">\n              <p className=\"text-sm text-blue-700 dark:text-blue-300\">\n                <strong>Note:</strong> Students will only see courses allocated to their academic year.\n                Admins, teachers, institution managers, and contest managers can view all courses regardless of allocations.\n              </p>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","/* __next_internal_action_entry_do_not_use__ [{\"8053ef532fb41c6359c04a7f723b56e161407ad14a\":\"getCourseAllocations\"},\"actions/courseAllocation.action.ts\",\"\"] */\"use turbopack no side effects\";import{createServerReference,callServer,findSourceMapURL}from\"private-next-rsc-action-client-wrapper\";const $$RSC_SERVER_ACTION_0=/*#__PURE__*/createServerReference(\"8053ef532fb41c6359c04a7f723b56e161407ad14a\",callServer,void 0,findSourceMapURL,\"getCourseAllocations\");export{$$RSC_SERVER_ACTION_0 as getCourseAllocations};","/* __next_internal_action_entry_do_not_use__ [{\"606ba5e2787fb77b3f798f01271c02f40d553ffc8e\":\"updateYearAllocations\"},\"actions/courseAllocation.action.ts\",\"\"] */\"use turbopack no side effects\";import{createServerReference,callServer,findSourceMapURL}from\"private-next-rsc-action-client-wrapper\";const $$RSC_SERVER_ACTION_5=/*#__PURE__*/createServerReference(\"606ba5e2787fb77b3f798f01271c02f40d553ffc8e\",callServer,void 0,findSourceMapURL,\"updateYearAllocations\");export{$$RSC_SERVER_ACTION_5 as updateYearAllocations};"],"names":[],"mappings":"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"}