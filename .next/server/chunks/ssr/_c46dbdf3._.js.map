{"version":3,"sources":["../../../../core/services/institution.service.ts","../../../../actions/admin/institution.ts","../../../../.next-internal/server/app/%28main%29/leaderboard/page/actions.js%20%28server%20actions%20loader%29","../../../../core/services/leaderboard.service.ts","../../../../actions/leaderboard.action.ts"],"sourcesContent":["import { prisma } from \"@/lib/prisma\";\n\nexport class InstitutionService {\n    /**\n     * Get all institutions with counts of users and classrooms\n     */\n    static async getInstitutions() {\n        const institutions = await prisma.institution.findMany({\n            include: {\n                _count: {\n                    select: {\n                        users: true,\n                        classrooms: true,\n                    },\n                },\n                users: {\n                    where: {\n                        role: \"INSTITUTION_MANAGER\",\n                    },\n                    select: {\n                        name: true,\n                    },\n                    take: 1,\n                },\n            },\n            orderBy: {\n                createdAt: \"desc\",\n            },\n        });\n\n        return institutions.map((inst) => ({\n            ...inst,\n            managerName: inst.users[0]?.name || \"Unassigned\",\n        }));\n    }\n\n    /**\n     * Get an institution by ID with users and classrooms\n     */\n    static async getInstitutionById(id: string) {\n        return prisma.institution.findUnique({\n            where: { id },\n            include: {\n                users: {\n                    where: {\n                        role: \"INSTITUTION_MANAGER\",\n                    },\n                },\n                classrooms: true,\n                _count: {\n                    select: {\n                        users: true,\n                        classrooms: true,\n                    },\n                },\n            },\n        });\n    }\n\n    /**\n     * Update institution details\n     */\n    static async updateInstitution(id: string, data: {\n        name?: string;\n        logo?: string | null;\n        domain?: string | null;\n    }) {\n        return prisma.institution.update({\n            where: { id },\n            data,\n        });\n    }\n\n    /**\n     * Delete an institution\n     */\n    static async deleteInstitution(id: string) {\n        return prisma.institution.delete({\n            where: { id },\n        });\n    }\n\n    /**\n     * Get detailed stats for an institution\n     */\n    static async getInstitutionStats(id: string) {\n        const stats = await prisma.user.groupBy({\n            by: ['role'],\n            where: {\n                institutionId: id,\n            },\n            _count: true,\n        });\n\n        const classroomCount = await prisma.classroom.count({\n            where: { institutionId: id },\n        });\n\n        const roleCounts = stats.reduce((acc, curr) => {\n            acc[curr.role as string] = curr._count;\n            return acc;\n        }, {} as Record<string, number>);\n\n        return {\n            students: roleCounts[\"STUDENT\"] || 0,\n            teachers: roleCounts[\"TEACHER\"] || 0,\n            contestManagers: roleCounts[\"CONTEST_MANAGER\"] || 0,\n            classrooms: classroomCount,\n        };\n    }\n}\n","\"use server\";\n\nimport { InstitutionService } from \"@/core/services/institution.service\";\nimport { z } from \"zod\";\nimport { revalidatePath, revalidateTag } from \"next/cache\";\nimport redis from \"@/lib/redis\";\n\nconst institutionSchema = z.object({\n    name: z.string().min(2, \"Name must be at least 2 characters\"),\n    slug: z.string().min(2, \"Slug must be at least 2 characters\").regex(/^[a-z0-9-]+$/, \"Slug must be lowercase alphanumeric and hyphens\"),\n    logo: z.string().url().optional().or(z.literal(\"\")),\n    domain: z.string().optional().or(z.literal(\"\")),\n});\n\nconst updateInstitutionSchema = institutionSchema.partial();\n\nexport async function getInstitutions() {\n    try {\n        const institutions = await InstitutionService.getInstitutions();\n        return { success: true, institutions };\n    } catch (error) {\n        console.error(\"Failed to fetch institutions:\", error);\n        return { success: false, error: \"Failed to fetch institutions\" };\n    }\n}\n\nexport async function getInstitutionById(id: string) {\n    try {\n        const institution = await InstitutionService.getInstitutionById(id);\n        if (!institution) return { success: false, error: \"Institution not found\" };\n        return { success: true, institution };\n    } catch (error) {\n        console.error(\"Failed to fetch institution:\", error);\n        return { success: false, error: \"Failed to fetch institution\" };\n    }\n}\n\n\n// Redefining create in Service for clarity\nexport async function createInstitutionAction(data: z.infer<typeof institutionSchema>) {\n    try {\n        const validatedData = institutionSchema.parse(data);\n        // Directly use prisma for create if not in service yet\n        const { prisma } = await import(\"@/lib/prisma\");\n        const institution = await prisma.institution.create({\n            data: {\n                name: validatedData.name,\n                slug: validatedData.slug,\n                logo: validatedData.logo || null,\n                domain: validatedData.domain || null,\n            },\n        });\n\n        revalidatePath(\"/admin/institutions\");\n        return { success: true, data: institution };\n    } catch (error) {\n        if (error instanceof z.ZodError) {\n            return { success: false, error: error.issues[0].message };\n        }\n        console.error(\"Failed to create institution:\", error);\n        return { success: false, error: \"Failed to create institution\" };\n    }\n}\n\nexport async function updateInstitutionAction(id: string, data: z.infer<typeof updateInstitutionSchema>) {\n    try {\n        const validatedData = updateInstitutionSchema.parse(data);\n        const institution = await InstitutionService.updateInstitution(id, {\n            ...validatedData,\n            logo: validatedData.logo || undefined,\n            domain: validatedData.domain || undefined,\n        });\n\n        revalidatePath(\"/admin/institutions\");\n        revalidatePath(`/admin/institutions/${id}`);\n        return { success: true, data: institution };\n    } catch (error) {\n        if (error instanceof z.ZodError) {\n            return { success: false, error: error.issues[0].message };\n        }\n        console.error(\"Failed to update institution:\", error);\n        return { success: false, error: \"Failed to update institution\" };\n    }\n}\n\nexport async function assignInstitutionManager(email: string, institutionId: string) {\n    try {\n        const { prisma } = await import(\"@/lib/prisma\");\n        const user = await prisma.user.findUnique({\n            where: { email },\n        });\n\n        if (!user) {\n            return { success: false, error: \"User not found\" };\n        }\n\n        const updatedUser = await prisma.user.update({\n            where: { id: user.id },\n            data: {\n                role: \"INSTITUTION_MANAGER\",\n                institutionId: institutionId,\n            },\n        });\n\n        revalidatePath(\"/admin/users\");\n        revalidatePath(`/admin/institutions/${institutionId}`);\n        revalidateTag(`dashboard-${user.id}`, \"max\");\n        await redis.del(`dashboard:stats:${user.id}`);\n\n        return { success: true, data: updatedUser };\n    } catch (error) {\n        console.error(\"Failed to assign institution manager:\", error);\n        return { success: false, error: \"Failed to assign institution manager\" };\n    }\n}\n\nexport async function searchUsersByEmail(query: string) {\n    try {\n        const { prisma } = await import(\"@/lib/prisma\");\n        const users = await prisma.user.findMany({\n            where: {\n                email: {\n                    contains: query,\n                    mode: \"insensitive\",\n                },\n            },\n            select: {\n                id: true,\n                email: true,\n                name: true,\n            },\n            take: 5,\n        });\n\n        return { success: true, users };\n    } catch (error) {\n        console.error(\"Failed to search users:\", error);\n        return { success: false, error: \"Failed to search users\" };\n    }\n}\n\nexport async function removeInstitutionManager(userId: string, institutionId: string) {\n    try {\n        const { prisma } = await import(\"@/lib/prisma\");\n\n        // Downgrade to STUDENT and remove institution assignment\n        await prisma.user.update({\n            where: { id: userId },\n            data: {\n                role: \"STUDENT\",\n                institutionId: null,\n            },\n        });\n\n        revalidatePath(`/admin/institutions/${institutionId}`);\n        revalidateTag(`dashboard-${userId}`, \"max\");\n        await redis.del(`dashboard:stats:${userId}`);\n\n        return { success: true };\n    } catch (error) {\n        console.error(\"Failed to remove manager:\", error);\n        return { success: false, error: \"Failed to remove administrative access\" };\n    }\n}\n\nexport async function deleteInstitutionAction(id: string) {\n    try {\n        // First disconnect all users from this institution\n        const { prisma } = await import(\"@/lib/prisma\");\n\n        // This is a safety measure to avoid orphan institution IDs on users\n        await prisma.user.updateMany({\n            where: { institutionId: id },\n            data: { institutionId: null },\n        });\n\n        await InstitutionService.deleteInstitution(id);\n\n        revalidatePath(\"/admin/institutions\");\n        return { success: true };\n    } catch (error) {\n        console.error(\"Failed to delete institution:\", error);\n        return { success: false, error: \"Failed to delete institution. Ensure it has no active classrooms.\" };\n    }\n}\n\nexport async function getInstitutionUsers(institutionId: string, page: number = 1, searchQuery: string = \"\") {\n    try {\n        const { prisma } = await import(\"@/lib/prisma\");\n        const limit = 20;\n        const skip = (page - 1) * limit;\n\n        const where: any = {\n            institutionId,\n        };\n\n        if (searchQuery) {\n            where.OR = [\n                { name: { contains: searchQuery, mode: \"insensitive\" } },\n                { email: { contains: searchQuery, mode: \"insensitive\" } },\n            ];\n        }\n\n        const [users, total] = await Promise.all([\n            prisma.user.findMany({\n                where,\n                skip,\n                take: limit,\n                orderBy: { createdAt: \"desc\" },\n                select: {\n                    id: true,\n                    name: true,\n                    email: true,\n                    role: true,\n                    createdAt: true,\n                },\n            }),\n            prisma.user.count({ where }),\n        ]);\n\n        return { success: true, users, total };\n    } catch (error) {\n        console.error(\"Failed to fetch institution users:\", error);\n        return { success: false, error: \"Failed to fetch institution users\" };\n    }\n}\n\nexport async function removeUserFromInstitution(userId: string) {\n    try {\n        const { prisma } = await import(\"@/lib/prisma\");\n\n        const user = await prisma.user.update({\n            where: { id: userId },\n            data: {\n                institutionId: null,\n                // If they were a manager, teacher, etc. specifically for this institution,\n                // we might want to downgrade them to STUDENT, but for now we'll just remove the link.\n            },\n        });\n\n        revalidateTag(`user-${userId}`, \"max\");\n        revalidateTag(`dashboard-${userId}`, \"max\");\n\n        // Clear redis if it exists\n        try {\n            const redis = (await import(\"@/lib/redis\")).default;\n            await redis.del(`dashboard:stats:${userId}`);\n        } catch (e) {}\n\n        return { success: true };\n    } catch (error) {\n        console.error(\"Failed to remove user from institution:\", error);\n        return { success: false, error: \"Failed to remove user from institution\" };\n    }\n}\n","export {checkSessionConflict as '00f4c838ce10f91796a39f1558a3b75432fa49882a'} from 'ACTIONS_MODULE0'\nexport {resolveSessionConflict as '409bc5870257fe05de038549e85b0722c4e09c83d4'} from 'ACTIONS_MODULE0'\nexport {getUserScore as '80ee7282f708e60661ecc42477a6d2afba42f1d5ed'} from 'ACTIONS_MODULE1'\nexport {getLeaderboardData as '609409ea906081354499a1d8542ce166007483e325'} from 'ACTIONS_MODULE2'\nexport {getInstitutions as '009f0a1e5777df118a0513af529d00d008ce515130'} from 'ACTIONS_MODULE3'\n","\nimport { prisma } from \"@/lib/prisma\";\nimport { SubmissionResult } from \"@prisma/client\";\nimport redis from \"@/lib/redis\";\n\nexport type LeaderboardEntry = {\n    rank: number;\n    userId: string;\n    name: string;\n    image: string | null;\n    tags: string[];\n    problemsSolved: number;\n    totalScore: number;\n    socials: {\n        leetcode: string | null;\n        codechef: string | null;\n        github: string | null;\n        linkedin: string | null;\n    };\n    stats: {\n        easy: number;\n        medium: number;\n        hard: number;\n    };\n};\n\nexport class LeaderboardService {\n    static async getGlobalLeaderboard(institutionId?: string, forceRefresh: boolean = false) {\n        // Try to get cached leaderboard from Redis\n        const cacheKey = institutionId ? `lb:inst:${institutionId}` : 'lb:global';\n        const CACHE_TTL = 10 * 60; // 10 minutes\n\n        try {\n            if (!forceRefresh) {\n                const cached = await redis.get(cacheKey);\n                if (cached) {\n                    return JSON.parse(cached);\n                }\n            }\n        } catch (error) {\n            // Redis error - continue without cache\n            console.error('Redis get error:', error);\n        }\n\n        // Fetch top 100 users by totalScore directly from DB\n        const users = await prisma.user.findMany({\n            where: {\n                role: 'STUDENT',\n                ...(institutionId ? { institutionId } : {})\n            },\n            orderBy: {\n                totalScore: 'desc'\n            },\n            take: 100,\n            select: {\n                id: true,\n                name: true,\n                image: true,\n                tags: true,\n                leetCodeHandle: true,\n                codeChefHandle: true,\n                githubHandle: true,\n                totalScore: true,\n                problemsSolved: true,\n                submissions: {\n                    where: {\n                        status: SubmissionResult.ACCEPTED,\n                        mode: \"SUBMIT\" as const\n                    },\n                    select: {\n                        problem: {\n                            select: {\n                                difficulty: true\n                            }\n                        }\n                    },\n                    distinct: ['problemId']\n                }\n            }\n        });\n\n        const leaderboard: LeaderboardEntry[] = users.map((user, index) => {\n            let easyCount = 0;\n            let mediumCount = 0;\n            let hardCount = 0;\n\n            user.submissions.forEach(sub => {\n                if (sub.problem.difficulty === 'EASY') easyCount++;\n                else if (sub.problem.difficulty === 'MEDIUM') mediumCount++;\n                else if (sub.problem.difficulty === 'HARD') hardCount++;\n            });\n\n            return {\n                rank: index + 1,\n                userId: user.id,\n                name: user.name,\n                image: user.image,\n                tags: user.tags,\n                problemsSolved: user.problemsSolved,\n                totalScore: user.totalScore,\n                socials: {\n                    leetcode: user.leetCodeHandle,\n                    codechef: user.codeChefHandle,\n                    github: user.githubHandle,\n                    linkedin: null\n                },\n                stats: {\n                    easy: easyCount,\n                    medium: mediumCount,\n                    hard: hardCount\n                }\n            };\n        });\n\n        const result = leaderboard;\n\n        // Cache the leaderboard in Redis\n        try {\n            await redis.setex(cacheKey, CACHE_TTL, JSON.stringify(result));\n        } catch (error) {\n            console.error('Redis set error:', error);\n        }\n\n        return result;\n    }\n}\n","\"use server\";\n\nimport { LeaderboardService } from \"@/core/services/leaderboard.service\";\nimport { cacheTag, cacheLife } from \"next/cache\";\nimport { auth } from \"@/lib/auth\";\nimport { headers } from \"next/headers\";\n\nexport type { LeaderboardEntry } from \"@/core/services/leaderboard.service\";\n\nasync function getCachedLeaderboardData(institutionId?: string, forceRefresh: boolean = false) {\n    \"use cache\";\n    if (forceRefresh) {\n        // Skip cache directive essentially\n    }\n    cacheLife({ stale: 300, revalidate: 300 });\n\n    cacheTag('leaderboard-global', 'leaderboard', institutionId ? `leaderboard-inst-${institutionId}` : 'leaderboard-none');\n\n    return LeaderboardService.getGlobalLeaderboard(institutionId, forceRefresh);\n}\n\nexport async function getLeaderboardData(requestedInstitutionId?: string, refresh: boolean = false) {\n    // Get session outside of the \"use cache\" scope because headers() is dynamic\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n\n    const isAuthorized = session?.user?.role === \"ADMIN\";\n\n    // Default to user's institution\n    let targetInstitutionId = session?.user?.institutionId;\n\n    // Only admins can request a specific institution or \"all\"\n    if (isAuthorized && requestedInstitutionId) {\n        targetInstitutionId = requestedInstitutionId === \"all\" ? undefined : requestedInstitutionId;\n    }\n\n    return getCachedLeaderboardData(targetInstitutionId || undefined, refresh);\n}\n"],"names":[],"mappings":"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"}