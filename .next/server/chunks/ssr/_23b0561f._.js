module.exports=[53112,a=>{"use strict";var b=a.i(954757);a.s(["z",0,b])},340499,a=>{"use strict";var b=a.i(167784);let c={SHORT:{ttl:30,stale:15},MEDIUM:{ttl:120,stale:60},LONG:{ttl:600,stale:300},STATIC:{ttl:3600,stale:1800}};function d(a,...b){return`algofox:${a}:${b.join(":")}`}async function e(a){try{let c=await b.default.get(a);if(!c)return null;return JSON.parse(c)}catch(a){return console.error("[Cache] Get error:",a),null}}async function f(a,d,e=c.MEDIUM.ttl){try{await b.default.setex(a,e,JSON.stringify(d))}catch(a){console.error("[Cache] Set error:",a)}}async function g(a){try{await b.default.del(a)}catch(a){console.error("[Cache] Delete error:",a)}}async function h(a,b,d=c.MEDIUM.ttl){let g=await e(a);if(null!==g)return g;let i=await b();return f(a,i,d).catch(()=>{}),i}a.s(["CACHE_CONFIG",0,c,"cacheKey",()=>d,"cachedFetch",()=>h,"deleteFromCache",()=>g])},405781,a=>{"use strict";var b=a.i(137936),c=a.i(231191),d=a.i(167784),e=a.i(409223),f=a.i(905246),g=a.i(53112),h=a.i(118558),i=a.i(340499),j=a.i(713095);let k=g.z.object({name:g.z.string().min(2,"Name must be at least 2 characters"),section:g.z.string().optional().or(g.z.literal("")),subject:g.z.string().optional().or(g.z.literal("")),institutionId:g.z.string()});async function l(a){let b=await e.auth.api.getSession({headers:await (0,f.headers)()});if(!b?.user)return{success:!1,error:"Unauthorized"};let d=b.user;if(!["ADMIN","INSTITUTION_MANAGER","TEACHER"].includes(d.role))return{success:!1,error:"Unauthorized. Only teachers or managers can create classrooms."};try{let b=k.parse(a),e="",f=!1,g=0;for(;!f&&g<10;)e=function(){let a="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",b="";for(let c=0;c<6;c++)b+=a.charAt(Math.floor(Math.random()*a.length));return b}(),await c.prisma.classroom.findUnique({where:{joinCode:e}})||(f=!0),g++;if(!f)return{success:!1,error:"Failed to generate a unique join code. Please try again."};let i=await c.prisma.classroom.create({data:{name:b.name,section:b.section||null,subject:b.subject||null,joinCode:e,institutionId:b.institutionId,teacherId:d.id}});return(0,h.revalidateTag)(`teacher-classrooms-${d.id}`,"max"),(0,h.revalidateTag)(`institution-classrooms-${b.institutionId}`,"max"),(0,h.revalidatePath)("/dashboard/institution/classrooms"),{success:!0,data:i}}catch(a){if(a instanceof g.z.ZodError)return{success:!1,error:a.issues[0].message};return console.error("Failed to create classroom:",a),{success:!1,error:"Failed to create classroom"}}}async function m(a){let b=await e.auth.api.getSession({headers:await (0,f.headers)()});if(!b?.user)return{success:!1,error:"Unauthorized"};let g=b.user;try{let b=await c.prisma.classroom.findUnique({where:{joinCode:a.toUpperCase()},include:{students:{where:{id:g.id}}}});if(!b)return{success:!1,error:"Invalid join code."};if(b.students.length>0)return{success:!1,error:"You are already enrolled in this classroom."};if(g.institutionId&&g.institutionId!==b.institutionId)return{success:!1,error:"You cannot join this classroom because it belongs to a different institution."};await c.prisma.classroom.update({where:{id:b.id},data:{students:{connect:{id:g.id}}}});let e={onboardingCompleted:!0};g.institutionId||(e.institutionId=b.institutionId),await c.prisma.user.update({where:{id:g.id},data:e});let f=`classroom:students:${b.id}`;return await d.default.sadd(f,g.id),(0,h.revalidateTag)(`student-classrooms-${g.id}`,"max"),(0,h.revalidateTag)(`classroom-${b.id}`,"max"),(0,h.revalidatePath)("/dashboard/classrooms"),{success:!0,message:`Successfully joined ${b.name}`}}catch(a){return console.error("Failed to join classroom:",a),{success:!1,error:"Failed to join classroom"}}}async function n(a){try{let b=await c.prisma.classroom.findUnique({where:{joinCode:a.toUpperCase()},select:{id:!0,name:!0,subject:!0,section:!0,teacher:{select:{id:!0,name:!0,image:!0}},_count:{select:{students:!0}}}});if(!b)return{success:!1,error:"Classroom not found"};let d=await e.auth.api.getSession({headers:await (0,f.headers)()}),g=!!d?.user&&await c.prisma.classroom.findFirst({where:{id:b.id,students:{some:{id:d.user.id}}}});return{success:!0,classroom:b,isEnrolled:!!g}}catch(a){return console.error("Failed to fetch classroom by code:",a),{success:!1,error:"Failed to fetch classroom"}}}async function o(){let a=await e.auth.api.getSession({headers:await (0,f.headers)()});if(!a?.user)return{success:!1,error:"Unauthorized"};let b=a.user.id,d=(0,h.unstable_cache)(async()=>await c.prisma.classroom.findMany({where:{teacherId:b},include:{_count:{select:{students:!0}}},orderBy:{createdAt:"desc"}}),[`teacher-classrooms-${b}`],{tags:[`teacher-classrooms-${b}`],revalidate:120});try{let a=await d();return{success:!0,classrooms:a}}catch(a){return console.error("Failed to fetch teacher classrooms:",a),{success:!1,error:"Failed to fetch classrooms"}}}async function p(){let a=await e.auth.api.getSession({headers:await (0,f.headers)()});if(!a?.user)return{success:!1,error:"Unauthorized"};let b=a.user.id,d=(0,h.unstable_cache)(async()=>{let a=await c.prisma.user.findUnique({where:{id:b},include:{enrolledClassrooms:{include:{teacher:{select:{name:!0}}},orderBy:{createdAt:"desc"}}}});return a?.enrolledClassrooms||[]},[`student-classrooms-${b}`],{tags:[`student-classrooms-${b}`],revalidate:120});try{let a=await d();return{success:!0,classrooms:a}}catch(a){return console.error("Failed to fetch student classrooms:",a),{success:!1,error:"Failed to fetch classrooms"}}}async function q(a,b=1,d=50){let g=await e.auth.api.getSession({headers:await (0,f.headers)()});if(!g?.user)return{success:!1,error:"Unauthorized"};let i=(b-1)*d,j=(0,h.unstable_cache)(async()=>{let[b,e]=await Promise.all([c.prisma.classroom.findUnique({where:{id:a},select:{id:!0,name:!0,subject:!0,section:!0,joinCode:!0,isTrackingActive:!0,trackingStartedAt:!0,teacher:{select:{name:!0,id:!0}},students:{select:{id:!0,name:!0,totalScore:!0,image:!0},orderBy:{totalScore:"desc"},skip:i,take:d}}}),c.prisma.user.count({where:{enrolledClassrooms:{some:{id:a}}}})]);return{classroom:b,totalStudents:e}},[`classroom-${a}-page-${b}`],{tags:[`classroom-${a}`],revalidate:60});try{let{classroom:a,totalStudents:c}=await j();if(!a)return{success:!1,error:"Classroom not found"};return{success:!0,classroom:a,pagination:{total:c,pages:Math.ceil(c/d),current:b,limit:d}}}catch(a){return console.error("Failed to fetch classroom detail:",a),{success:!1,error:"Failed to fetch classroom"}}}async function r(a,b){let d=await e.auth.api.getSession({headers:await (0,f.headers)()});if(!d?.user)return{success:!1,error:"Unauthorized"};let g=await c.prisma.classroom.findUnique({where:{id:a},select:{teacherId:!0}});return g&&(g.teacherId===d.user.id||"ADMIN"===d.user.role)?(await c.prisma.classroom.update({where:{id:a},data:{isTrackingActive:b,trackingStartedAt:b?new Date:null}}),await (0,i.deleteFromCache)((0,i.cacheKey)("live-tracking",a)),(0,h.revalidateTag)(`classroom-${a}`,"max"),(0,h.revalidatePath)(`/dashboard/classrooms/${a}`),{success:!0}):{success:!1,error:"Access denied"}}async function s(a){let b=await e.auth.api.getSession({headers:await (0,f.headers)()});if(!b?.user)return{success:!1,error:"Unauthorized"};let d=(0,i.cacheKey)("live-tracking",a),g=async()=>{let b=await c.prisma.classroom.findUnique({where:{id:a},select:{isTrackingActive:!0,trackingStartedAt:!0,students:{select:{id:!0,name:!0,image:!0,submissions:{where:{mode:"SUBMIT"},orderBy:{createdAt:"desc"},take:20,include:{problem:{select:{title:!0}}}}}}}});if(!b)return null;let d=b.students.map(a=>{let c=a.submissions.filter(a=>b.isTrackingActive&&b.trackingStartedAt&&new Date(a.createdAt)>=new Date(b.trackingStartedAt)).map(a=>({id:a.id,code:a.code,status:a.status,problemTitle:a.problem.title,createdAt:a.createdAt}));return{id:a.id,name:a.name,image:a.image,submissions:c}});return{isTrackingActive:b.isTrackingActive,trackingStartedAt:b.trackingStartedAt,students:d}};try{let a=await (0,i.cachedFetch)(d,g,i.CACHE_CONFIG.SHORT.ttl);if(!a)return{success:!1,error:"Classroom not found"};return{success:!0,...a}}catch(a){return console.error("Failed to fetch live tracking:",a),{success:!1,error:"Failed to fetch tracking data"}}}async function t(a=1,b=20){let d=await e.auth.api.getSession({headers:await (0,f.headers)()});if(!d?.user)return{success:!1,error:"Unauthorized"};let g=d.user;if("ADMIN"!==g.role&&"INSTITUTION_MANAGER"!==g.role)return{success:!1,error:"Unauthorized"};let i=g.institutionId,j=(a-1)*b,k=(0,h.unstable_cache)(async()=>{let[a,d]=await Promise.all([c.prisma.classroom.findMany({where:{institutionId:i},include:{teacher:{select:{name:!0,email:!0}},_count:{select:{students:!0}}},orderBy:{createdAt:"desc"},skip:j,take:b}),c.prisma.classroom.count({where:{institutionId:i}})]);return{classrooms:a,total:d}},[`institution-classrooms-${i}-page-${a}`],{tags:[`institution-classrooms-${i}`],revalidate:120});try{let{classrooms:c,total:d}=await k();return{success:!0,classrooms:c,pagination:{total:d,pages:Math.ceil(d/b),current:a,limit:b}}}catch(a){return console.error("Failed to fetch institution classrooms:",a),{success:!1,error:"Failed to fetch classrooms"}}}async function u(a,b){let g=await e.auth.api.getSession({headers:await (0,f.headers)()});if(!g?.user)return{success:!1,error:"Unauthorized"};let i=g.user,j=["ADMIN","INSTITUTION_MANAGER"].includes(i.role);try{let e=await c.prisma.classroom.findUnique({where:{id:a},select:{teacherId:!0,institutionId:!0}});if(!e)return{success:!1,error:"Classroom not found"};if(!j&&e.teacherId!==i.id)return{success:!1,error:"Unauthorized"};await c.prisma.classroom.update({where:{id:a},data:{students:{disconnect:{id:b}}}});let f=`classroom:students:${a}`;return await d.default.srem(f,b),(0,h.revalidateTag)(`classroom-${a}`,"max"),(0,h.revalidateTag)(`student-classrooms-${b}`,"max"),(0,h.revalidatePath)(`/dashboard/classrooms/${a}`),{success:!0}}catch(a){return console.error("Failed to remove student:",a),{success:!1,error:"Failed to remove student"}}}(0,j.ensureServerEntryExports)([l,m,n,o,p,q,r,s,t,u]),(0,b.registerServerReference)(l,"405d122aba3f5928800ed130a7b71a1b47271751ba",null),(0,b.registerServerReference)(m,"4052b0471161707b49db8311132ddb7c92790d847f",null),(0,b.registerServerReference)(n,"4037d92f3a67eb2428d5b2dab919914d5756aace36",null),(0,b.registerServerReference)(o,"002a588abb136c6f86adadd291e7fdda7347bfa1e9",null),(0,b.registerServerReference)(p,"00dc41dbc84f1082ddd9f6a9207eb5b406ea5c543e",null),(0,b.registerServerReference)(q,"700d160d9099ae66508f5d181cf879265ecd403e7d",null),(0,b.registerServerReference)(r,"60034d10a668ce8353cc35e9db8784a8a275d2b2e0",null),(0,b.registerServerReference)(s,"40e294f0f9e4303d3615ddc6a66cada537036c1b97",null),(0,b.registerServerReference)(t,"6029e68e22d85ff157089c99e60915beba555ec65d",null),(0,b.registerServerReference)(u,"602532808556a300ed5e0f4a5f69437cc6db044dc7",null),a.s(["createClassroom",()=>l,"getClassroomByCode",()=>n,"getClassroomLiveTracking",()=>s,"getClassroomWithStudents",()=>q,"getInstitutionClassrooms",()=>t,"getStudentClassrooms",()=>p,"getTeacherClassrooms",()=>o,"joinClassroom",()=>m,"removeStudentFromClassroom",()=>u,"toggleClassroomTracking",()=>r])},742541,a=>{"use strict";var b=a.i(191679),c=a.i(154470),d=a.i(405781);a.s([],926560),a.i(926560),a.s(["002a588abb136c6f86adadd291e7fdda7347bfa1e9",()=>d.getTeacherClassrooms,"00dc41dbc84f1082ddd9f6a9207eb5b406ea5c543e",()=>d.getStudentClassrooms,"00f4c838ce10f91796a39f1558a3b75432fa49882a",()=>b.checkSessionConflict,"4037d92f3a67eb2428d5b2dab919914d5756aace36",()=>d.getClassroomByCode,"4052b0471161707b49db8311132ddb7c92790d847f",()=>d.joinClassroom,"405d122aba3f5928800ed130a7b71a1b47271751ba",()=>d.createClassroom,"409bc5870257fe05de038549e85b0722c4e09c83d4",()=>b.resolveSessionConflict,"40e294f0f9e4303d3615ddc6a66cada537036c1b97",()=>d.getClassroomLiveTracking,"60034d10a668ce8353cc35e9db8784a8a275d2b2e0",()=>d.toggleClassroomTracking,"602532808556a300ed5e0f4a5f69437cc6db044dc7",()=>d.removeStudentFromClassroom,"6029e68e22d85ff157089c99e60915beba555ec65d",()=>d.getInstitutionClassrooms,"700d160d9099ae66508f5d181cf879265ecd403e7d",()=>d.getClassroomWithStudents,"80ee7282f708e60661ecc42477a6d2afba42f1d5ed",()=>c.getUserScore],742541)},588010,a=>{a.v(b=>Promise.all(["server/chunks/ssr/node_modules_better-auth_dist_adapters_memory-adapter_index_mjs_35d2dbfd._.js"].map(b=>a.l(b))).then(()=>b(700031)))},860484,a=>{a.v(b=>Promise.all(["server/chunks/ssr/node_modules_better-auth_dist_adapters_kysely-adapter_index_mjs_0abbd964._.js"].map(b=>a.l(b))).then(()=>b(536063)))},946014,a=>{a.v(b=>Promise.all(["server/chunks/ssr/a9bf9_better-auth_dist_adapters_kysely-adapter_bun-sqlite-dialect_mjs_23698f07._.js"].map(b=>a.l(b))).then(()=>b(496824)))},945599,a=>{a.v(b=>Promise.all(["server/chunks/ssr/a9bf9_better-auth_dist_adapters_kysely-adapter_node-sqlite-dialect_mjs_9102e2ec._.js"].map(b=>a.l(b))).then(()=>b(68928)))},1067,a=>{a.v(a=>Promise.resolve().then(()=>a(167784)))}];

//# sourceMappingURL=_23b0561f._.js.map